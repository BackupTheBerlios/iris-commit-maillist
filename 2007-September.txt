From no-reply at zwischenwelt.org  Sun Sep  2 16:20:31 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Sep 2007 14:20:31 -0000
Subject: [Iris-commit] [IRIS] r1373 - in /trunk: ./ data/lua/ data/lua/gui/
	include/ src/
Message-ID: <20070902142033.8111C1524003@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Sep  2 16:20:30 2007
New Revision: 1373

Log:
lugre built in

Added:
    trunk/SConstruct
    trunk/build_config.py
    trunk/build_support.py
    trunk/data/lua/lib.gui.iris.lua
    trunk/data/lua/lib.input.iris.lua
      - copied, changed from r1371, trunk/data/lua/lib.input.lua
    trunk/data/lua/lib.keybinds.lua
    trunk/data/lua/lib.plaingui.iris.lua
    trunk/data/lua/lib.sound.iris.lua
    trunk/src/scripting.iris.cpp
Removed:
    trunk/data/lua/lib.cam.lua
    trunk/data/lua/lib.edittext.lua
    trunk/data/lua/lib.fadelines.lua
    trunk/data/lua/lib.gui.lua
    trunk/data/lua/lib.guimaker.lua
    trunk/data/lua/lib.input.lua
    trunk/data/lua/lib.listener.lua
    trunk/data/lua/lib.plaingui.lua
    trunk/data/lua/lib.sound.lua
    trunk/data/lua/lib.time.lua
    trunk/data/lua/lib.util.lua
    trunk/data/lua/udata.lua
    trunk/include/BorderColourClipPaneOverlay.h
    trunk/include/ColourClipPaneOverlay.h
    trunk/include/ColourClipTextOverlay.h
    trunk/include/CompassOverlay.h
    trunk/include/RobRenderableOverlay.h
    trunk/include/SortedOverlayContainer.h
    trunk/include/bitmask.h
    trunk/include/camera.h
    trunk/include/fifo.h
    trunk/include/game.h
    trunk/include/gfx2D.h
    trunk/include/gfx3D.h
    trunk/include/huffman.h
    trunk/include/input.h
    trunk/include/listener.h
    trunk/include/luabind.h
    trunk/include/luaxml.h
    trunk/include/meshshape.h
    trunk/include/net.h
    trunk/include/ogrefonthelper.h
    trunk/include/ogrewrapper.h
    trunk/include/prefix.h
    trunk/include/profile.h
    trunk/include/rendertexture.h
    trunk/include/robrenderable.h
    trunk/include/robstring1.2.h
    trunk/include/scripting.h
    trunk/include/shell.h
    trunk/include/smartptr.h
    trunk/include/sound.h
    trunk/include/timer.h
    trunk/include/tinystr.h
    trunk/include/tinyxml.h
    trunk/include/viewport.h
    trunk/include/widget.h
    trunk/src/BorderColourClipPaneOverlay.cpp
    trunk/src/ColourClipPaneOverlay.cpp
    trunk/src/ColourClipTextOverlay.cpp
    trunk/src/CompassOverlay.cpp
    trunk/src/RobRenderableOverlay.cpp
    trunk/src/SortedOverlayContainer.cpp
    trunk/src/bitmask.cpp
    trunk/src/bitmask_L.cpp
    trunk/src/camera.cpp
    trunk/src/camera_L.cpp
    trunk/src/fifo_L.cpp
    trunk/src/game.cpp
    trunk/src/gfx2D.cpp
    trunk/src/gfx2D_L.cpp
    trunk/src/gfx3D.cpp
    trunk/src/gfx3D_L.cpp
    trunk/src/huffman.cpp
    trunk/src/input.cpp
    trunk/src/listener.cpp
    trunk/src/luaxml.cpp
    trunk/src/material_L.cpp
    trunk/src/meshshape.cpp
    trunk/src/net.cpp
    trunk/src/net_L.cpp
    trunk/src/ogrewrapper.cpp
    trunk/src/profile.cpp
    trunk/src/rendertexture.cpp
    trunk/src/rendertexture_L.cpp
    trunk/src/robrenderable.cpp
    trunk/src/robstring1.2.cpp
    trunk/src/scripting.cpp
    trunk/src/shell.cpp
    trunk/src/sound.cpp
    trunk/src/sound_L.cpp
    trunk/src/sound_fmod.cpp
    trunk/src/sound_openal.cpp
    trunk/src/timer.cpp
    trunk/src/tinystr.cpp
    trunk/src/tinyxml.cpp
    trunk/src/tinyxmlerror.cpp
    trunk/src/tinyxmlparser.cpp
    trunk/src/viewport.cpp
    trunk/src/viewport_L.cpp
    trunk/src/widget.cpp
    trunk/src/widget_L.cpp
Modified:
    trunk/   (props changed)
    trunk/data/lua/gui/gui.gumpmanager.lua
    trunk/data/lua/gui/gui.widget.lua
    trunk/data/lua/lib.3d.cam.lua
    trunk/data/lua/lib.3d.mousepick.lua
    trunk/data/lua/lib.3d.renderer.lua
    trunk/data/lua/lib.debugmenu.lua
    trunk/data/lua/lib.devtool.lua
    trunk/data/lua/lib.fallback.lua
    trunk/data/lua/lib.journal.lua
    trunk/data/lua/lib.mousepick.lua
    trunk/data/lua/lib.skill.lua
    trunk/data/lua/lib.test.lua
    trunk/data/lua/lib.uodragdrop.lua
    trunk/data/lua/main.lua
    trunk/data/lua/net.cursor.lua
    trunk/data/lua/net.popup.lua
    trunk/data/lua/net.sound.lua
    trunk/data/lua/net.uodragdrop.lua
    trunk/data/lua/net.walk.lua
    trunk/include/builder.h
    trunk/include/data.h
    trunk/include/grannyloader_i2.h
    trunk/include/grannyparser.h
    trunk/include/legacydata.h
    trunk/include/ogremanualloader.h
    trunk/include/radar.h
    trunk/include/spritemanager.h
    trunk/src/builder.cpp
    trunk/src/builder_L.cpp
    trunk/src/data.cpp
    trunk/src/data_L.cpp
    trunk/src/granny_L.cpp
    trunk/src/grannydump.cpp
    trunk/src/grannyloader_i2.cpp
    trunk/src/grannyogreloader.cpp
    trunk/src/grannyparser.cpp
    trunk/src/legacydata.cpp
    trunk/src/main.cpp
    trunk/src/ogremanualloader.cpp
    trunk/src/ogremanualloader_L.cpp
    trunk/src/pathsearch.cpp
    trunk/src/radar.cpp
    trunk/src/radar_L.cpp
    trunk/src/spritemanager.cpp
    trunk/src/spritemanager_L.cpp
    trunk/src/terrain.cpp
    trunk/start.sh

Modified: trunk/data/lua/gui/gui.gumpmanager.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/gui/gui.gumpmanager.lua (original)
+++ trunk/data/lua/gui/gui.gumpmanager.lua Sun Sep  2 16:20:30 2007
@@ -42,22 +42,22 @@
 	local onRightUp		=3D false
 	=

 	-- get events
-	if (gMouseButtonDown_Left and (not gGumpmanager.MouseLeftDown)) then
+	if (gKeyPressed[key_mouse1] and (not gGumpmanager.MouseLeftDown)) then
 		gGumpmanager.MouseLeftDown =3D true
 		onLeftDown =3D true
 	end
 	=

-	if ((not gMouseButtonDown_Left) and gGumpmanager.MouseLeftDown) then
+	if ((not gKeyPressed[key_mouse1]) and gGumpmanager.MouseLeftDown) then
 		gGumpmanager.MouseLeftDown =3D false
 		onLeftUp =3D true
 	end
 	=

-	if (gMouseButtonDown_Right and (not gGumpmanager.MouseRightDown)) then
+	if (gKeyPressed[key_mouse2] and (not gGumpmanager.MouseRightDown)) then
 		gGumpmanager.MouseRightDown =3D true
 		onRightDown =3D true
 	end
 	=

-	if ((not gMouseButtonDown_Right) and gGumpmanager.MouseRightDown) then
+	if ((not gKeyPressed[key_mouse2]) and gGumpmanager.MouseRightDown) then
 		gGumpmanager.MouseRightDown =3D false
 		onRightUp =3D true
 	end
@@ -132,7 +132,7 @@
 	if (onLeftDown) then
 		if (gGumpmanager.CurrentMouseOverGumpObject) then
 			gGumpmanager.CurrentMouseOverGumpObject:onLeftDown()
-			gGumpmanager.LastMouseMoveX, gGumpmanager.LastMouseMoveY =3D PollInput()
+			gGumpmanager.LastMouseMoveX, gGumpmanager.LastMouseMoveY =3D GetMousePo=
s()
 		end
 		gGumpmanager.LastLeftDownGumpObject =3D gGumpmanager.CurrentMouseOverGum=
pObject
 	end
@@ -159,7 +159,7 @@
 	end
 	=

 	if (gGumpmanager.LastLeftDownGumpObject) then
-		local MouseX, MouseY =3D PollInput()
+		local MouseX, MouseY =3D GetMousePos()
 		local dx =3D MouseX - gGumpmanager.LastMouseMoveX
 		local dy =3D MouseY - gGumpmanager.LastMouseMoveY
 		=

@@ -1034,7 +1034,7 @@
 	GumpImage.onMove =3D function( button, dx, dy )
 		local item =3D gObjectList[ GumpImage.serial ]
 		if (item) then
-			local iMouseX, iMouseY =3D PollInput()
+			local iMouseX, iMouseY =3D GetMousePos()
 			item:grab( -(iMouseX-GumpImage.gump.x-GumpImage.x-item.x), -(iMouseY-Gu=
mpImage.gump.y-GumpImage.y-item.y) )
 		end
 		return false

Modified: trunk/data/lua/gui/gui.widget.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/gui/gui.widget.lua (original)
+++ trunk/data/lua/gui/gui.widget.lua Sun Sep  2 16:20:30 2007
@@ -65,7 +65,10 @@
 	return dialog
 end
 =

-function gui.GetWidgetUnderMouse () return gCurrentWidgetUnderMouse and gC=
urrentWidgetUnderMouse._guisyswidget end
+function gui.GetWidgetUnderMouse () =

+	local w =3D GetWidgetUnderMouse()
+	return w and w._guisyswidget =

+end
 =

 -- ***** ***** ***** ***** ***** dialog Utils
 =


Modified: trunk/data/lua/lib.3d.cam.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.cam.lua (original)
+++ trunk/data/lua/lib.3d.cam.lua Sun Sep  2 16:20:30 2007
@@ -33,12 +33,12 @@
 	if (not gActiveEditText) then =

 		if (key =3D=3D gInput_CamMouseButton and (not self.gCamMoveWithMouse)) t=
hen =

 			self.gCamMoveWithMouse =3D true =

-			self.gCamMoveWithMouse_OffX,self.gCamMoveWithMouse_OffY =3D PollInput()
+			self.gCamMoveWithMouse_OffX,self.gCamMoveWithMouse_OffY =3D GetMousePos=
()
 		end
 		local camkeyname =3D self.gCamKeyName[key]
 		if (camkeyname) then self.gCamKeyDown[camkeyname] =3D true end
 		--printf("CamKeyDown(%s)\n",GetKeyName(key))
-		-- kKeyMouse1
+		-- key_mouse1
 	end
 end
 =

@@ -121,7 +121,7 @@
 	=

 	if (Renderer3D.gbNeedCorrectAspectRatio) then self:CorrectAspectRatio() e=
nd
 	=

-	local iMouseX,iMouseY =3D PollInput()
+	local iMouseX,iMouseY =3D GetMousePos()
 	local vw,vh =3D GetViewportSize()
 	local fPhysStepTime =3D Client_GetPhysStepTime()
 	=


Modified: trunk/data/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.mousepick.lua (original)
+++ trunk/data/lua/lib.3d.mousepick.lua Sun Sep  2 16:20:30 2007
@@ -285,12 +285,12 @@
 		Client_SetBottomLine(self.gMousePickTippOverride or mouseover)
 		if (self.gbShowMousePickHitBoxes) then =

 			if (entity.staticentity) then =

-				self.gMousePickBBox:SetWireBoundingBoxMeshEntity(entity.staticentity)
-				self.gMousePickBBox:SetVisible(true)
-				self.gMousePickBBox:SetPosition(entity.x,entity.y,entity.z)
-				self.gMousePickBBox:SetOrientation(entity.qw,entity.qx,entity.qy,entit=
y.qz)
-				self.gMousePickBBox:SetScale(entity.sx,entity.sy,entity.sz)
-				self.gMousePickBBox:SetNormaliseNormals(true)
+--~ 				self.gMousePickBBox:SetWireBoundingBoxMeshEntity(entity.staticenti=
ty)
+--~ 				self.gMousePickBBox:SetVisible(true)
+--~ 				self.gMousePickBBox:SetPosition(entity.x,entity.y,entity.z)
+--~ 				self.gMousePickBBox:SetOrientation(entity.qw,entity.qx,entity.qy,e=
ntity.qz)
+--~ 				self.gMousePickBBox:SetScale(entity.sx,entity.sy,entity.sz)
+--~ 				self.gMousePickBBox:SetNormaliseNormals(true)
 			end
 		end
 	elseif (o.hittype =3D=3D kMousePickHitType_Terrain) then -- terrain tile

Modified: trunk/data/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.renderer.lua (original)
+++ trunk/data/lua/lib.3d.renderer.lua Sun Sep  2 16:20:30 2007
@@ -459,7 +459,8 @@
 				mobile.hudname =3D guimaker.MakeText(gHudNamesDialogLayer.panel,0,0,te=
xt,gHudNamesFontSize,col_text)
 				mobile.hudname.gfx:SetTrackPosSceneNode(mobile.headpos)
 				--mobile.hudname.gfx:SetTrackPosSceneNode(mobile.gfx)
-				mobile.hudname.gfx:SetTrackHideIfNotVisible(true)
+				mobile.hudname.gfx.mbTrackHideIfClamped =3D true
+				mobile.hudname.gfx.mbTrackHideIfBehindCam =3D true
 				mobile.hudname.gfx:SetTextAlignment(kGfx2DAlign_Center)
 				mobile.hudname.lastn =3D mobile.notoriety
 				mobile.hudname.lastname =3D mobile.name
@@ -546,7 +547,8 @@
 			-- text parent node for position tracing
 			mobile.chattext_parent =3D guimaker.MakeSOC (gHudHeadChatDialogLayer.pa=
nel)
 			mobile.chattext_parent.gfx:SetTrackPosSceneNode(mobile.headpos)
-			mobile.chattext_parent.gfx:SetTrackHideIfNotVisible(true)
+			mobile.chattext_parent.gfx.mbTrackHideIfClamped =3D true
+			mobile.chattext_parent.gfx.mbTrackHideIfBehindCam =3D true
 			-- and text child for relative position
 			mobile.chattext =3D guimaker.MakeText(mobile.chattext_parent,0,-20,"",g=
HudNamesFontSize,col_text)
 			mobile.chattext.gfx:SetTextAlignment(kGfx2DAlign_Center)
@@ -625,7 +627,8 @@
 		if (partgfx and partgfx.SetVisible) then partgfx:SetVisible(bVisible) end
 	end
 	if (mobile.hudname and mobile.hudname.gfx) then =

-		mobile.hudname.gfx:SetTrackHideIfNotVisible(bVisible)
+		mobile.hudname.gfx.mbTrackHideIfClamped =3D bVisible
+		mobile.hudname.gfx.mbTrackHideIfBehindCam =3D bVisible
 	end
 end
 =


Modified: trunk/data/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.debugmenu.lua (original)
+++ trunk/data/lua/lib.debugmenu.lua Sun Sep  2 16:20:30 2007
@@ -205,7 +205,7 @@
 =

 function DebugMenuChangeParam1	(delta) =

 	local newval =3D gDebugMenuModelIndex
-	if ((gbShiftDown) and gCurDebugMode =3D=3D kDebugMode_Static) then
+	if ((gKeyPressed[key_lshift]) and gCurDebugMode =3D=3D kDebugMode_Static)=
 then
 		for i=3D1,math.abs(delta) do
 			local tries =3D 400
 			local add =3D (delta > 0) and 1 or -1

Modified: trunk/data/lua/lib.devtool.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.devtool.lua (original)
+++ trunk/data/lua/lib.devtool.lua Sun Sep  2 16:20:30 2007
@@ -6,7 +6,7 @@
 function ShowDevTool ()
 	gCurrentRenderer:MousePick()
 	local x,y,z =3D gCurrentRenderer:GetMouseHitTileCoords()
-	local radius =3D gbShiftDown and 0 or 2
+	local radius =3D gKeyPressed[key_lshift] and 0 or 2
 =

 	=

 	local rows =3D {
@@ -144,7 +144,7 @@
 		gCurrentRenderer:MousePick()
 		if (not gMousePickFoundHit) then return end
 		x,y,z =3D gCurrentRenderer:GetMouseHitTileCoords() =

-		radius =3D gbShiftDown and 0 or 3 =

+		radius =3D gKeyPressed[key_lshift] and 0 or 3 =

 	end
 	print("DevToolListStuffUnderMouse2",x,y,z,radius)
 	=


Modified: trunk/data/lua/lib.fallback.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.fallback.lua (original)
+++ trunk/data/lua/lib.fallback.lua Sun Sep  2 16:20:30 2007
@@ -53,7 +53,7 @@
 		gCurrentRenderer:MousePick()
 		if (not gMousePickFoundHit) then return end
 		x,y,z =3D gCurrentRenderer:GetMouseHitTileCoords() =

-		radius =3D gbShiftDown and 0 or 3 =

+		radius =3D gKeyPressed[key_lshift] and 0 or 3 =

 	end
 	local statictypes =3D ListFallBackTypesNearPos(x,y,z,radius)
 	printf("ShowFallBackTool %d,%d,%d:",x,y,z)

Modified: trunk/data/lua/lib.journal.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.journal.lua (original)
+++ trunk/data/lua/lib.journal.lua Sun Sep  2 16:20:30 2007
@@ -84,18 +84,18 @@
 		local widget =3D dialog.controls["journal_resize"]
 		widget.onMouseDown 		=3D function (widget,mousebutton) if (mousebutton =
=3D=3D 1) then =

 			widget.gfx:SetMaterial(widget.mat_pressed)
-			gJournalResizeStartX,gJournalResizeStartY =3D PollInput()
+			gJournalResizeStartX,gJournalResizeStartY =3D GetMousePos()
 			if (true) then
 				gui.bMouseBlocked =3D true
 				RegisterStepper(function ()
-					local x,y =3D PollInput()
+					local x,y =3D GetMousePos()
 					--AddFadeLines(sprintf("resize %d,%d",2.0*(x-gJournalResizeStartX),(y=
-gJournalResizeStartY)))
 					--AddFadeLines(sprintf("resize %d,%d",gJournalDialog.resize_x_total o=
r 0,gJournalDialog.resize_y_total or 0))
 					local dx =3D 2.0*(x-gJournalResizeStartX)
 					--local dx =3D 0
 					gJournalDialog:ResizeDelta(dx,(y-gJournalResizeStartY))
 					gJournalResizeStartX,gJournalResizeStartY =3D x,y
-					if (gMouseButtonDown_Left) then
+					if (gKeyPressed[key_mouse1]) then
 						return false -- continue stepping
 					else
 						gui.bMouseBlocked =3D false

Modified: trunk/data/lua/lib.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.mousepick.lua (original)
+++ trunk/data/lua/lib.mousepick.lua Sun Sep  2 16:20:30 2007
@@ -14,19 +14,15 @@
 	gCurrentRenderer:TerrainRayIntersect_Hit (tx,ty,tiletype,hit_dist,minz,ma=
xz)
 end
 =

-function IrisRightDoubleClick ()
-	-- TODO implement pathfinding and use it here
-	-- SetAutoWalkTarget()
-end
 =

 function IrisDoubleClick ()
 	gCurrentRenderer:MousePick()
 	local iSerial =3D gCurrentRenderer:GetMouseHitSerial()
-	if gbControlDown then
+	if gKeyPressed[key_lcontrol] then
 		-- open status window if control pressed and mobile targeted
 		if (iSerial and iSerial ~=3D 0) then =

 			local mobile =3D GetMobile(iSerial)
-			local iMouseX,iMouseY =3D PollInput()
+			local iMouseX,iMouseY =3D GetMousePos()
 			-- -50,-30 to place the dialog beneath the mouse
 			OpenStatus(mobile,iMouseX - 50,iMouseY - 30)
 		end

Modified: trunk/data/lua/lib.skill.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.skill.lua (original)
+++ trunk/data/lua/lib.skill.lua Sun Sep  2 16:20:30 2007
@@ -292,18 +292,18 @@
 		local widget =3D dialog.controls["skill_resize"]
 		widget.onMouseDown 		=3D function (widget,mousebutton) if (mousebutton =
=3D=3D 1) then =

 			widget.gfx:SetMaterial(widget.mat_pressed)
-			gSkillResizeStartX,gSkillResizeStartY =3D PollInput()
+			gSkillResizeStartX,gSkillResizeStartY =3D GetMousePos()
 			if (true) then
 				gui.bMouseBlocked =3D true
 				RegisterStepper(function ()
-					local x,y =3D PollInput()
+					local x,y =3D GetMousePos()
 					--AddFadeLines(sprintf("resize %d,%d",2.0*(x-gSkillResizeStartX),(y-g=
SkillResizeStartY)))
 					--AddFadeLines(sprintf("resize %d,%d",gSkillDialog.resize_x_total or =
0,gSkillDialog.resize_y_total or 0))
 					local dx =3D 2.0*(x-gSkillResizeStartX)
 					--local dx =3D 0
 					gSkillDialog:ResizeDelta(dx,(y-gSkillResizeStartY))
 					gSkillResizeStartX,gSkillResizeStartY =3D x,y
-					if (gMouseButtonDown_Left) then
+					if (gKeyPressed[key_mouse1]) then
 						return false -- continue stepping
 					else
 						gui.bMouseBlocked =3D false

Modified: trunk/data/lua/lib.test.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.test.lua (original)
+++ trunk/data/lua/lib.test.lua Sun Sep  2 16:20:30 2007
@@ -54,8 +54,8 @@
 	--SoundSetListenerPosition(100,500,0)
 	SoundSetListenerPosition(100,100,0)
 	=

-	--SoundPlayEffect(100,100,0,150)
-	SoundPlayEffect(50,100,0,20)
+	--SoundPlayEffect_UO(100,100,0,150)
+	SoundPlayEffect_UO(50,100,0,20)
 	=

 	while IsSoundEffectPlaying() do =

 		SoundStep()

Modified: trunk/data/lua/lib.uodragdrop.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.uodragdrop.lua (original)
+++ trunk/data/lua/lib.uodragdrop.lua Sun Sep  2 16:20:30 2007
@@ -42,7 +42,7 @@
 =

 function DragDropStep()
 	if (gLeftDownItem) then
-		local iMouseX, iMouseY =3D PollInput()
+		local iMouseX, iMouseY =3D GetMousePos()
 		if (iMouseX ~=3D gLeftDownItem.iMouseX or iMouseY ~=3D gLeftDownItem.iMo=
useY) then
 			gLeftDownItem.item:grab()
 			gLeftDownItem =3D nil
@@ -55,7 +55,7 @@
 	if (gMousePickFoundHit and gMousePickFoundHit.hittype =3D=3D kMousePickHi=
tType_Dynamic) then
 		gLeftDownItem =3D {}
 		gLeftDownItem.item =3D gMousePickFoundHit.dynamic
-		gLeftDownItem.iMouseX, gLeftDownItem.iMouseY =3D PollInput()
+		gLeftDownItem.iMouseX, gLeftDownItem.iMouseY =3D GetMousePos()
 	else
 		gLeftDownItem =3D nil
 	end
@@ -76,7 +76,7 @@
 				if (gGumpmanager.CurrentMouseOverGumpObject.type =3D=3D gGumpmanager.g=
umpObjectType_Item) then
 					Send_Drop_Object( gDragDropItem.serial, hex2num("0xFFFF"), hex2num("0=
xFFFF"), 0, gGumpmanager.CurrentMouseOverGumpObject.serial )
 				else
-					local iMouseX, iMouseY =3D PollInput()
+					local iMouseX, iMouseY =3D GetMousePos()
 					Send_Drop_Object( gDragDropItem.serial, iMouseX-Gump.x+gDragDropItem.=
offx, iMouseY-Gump.y+gDragDropItem.offy, 0, Gump.contserial )
 				end
 			elseif (Gump.name =3D=3D "paperdoll") then

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Sun Sep  2 16:20:30 2007
@@ -2,10 +2,14 @@
 --###        CONSTANTS        ###
 --###############################
 =

-datapath =3D "../data/"
+gMainWorkingDir =3D GetMainWorkingDir and GetMainWorkingDir() or ""
+datapath =3D gMainWorkingDir.."data/"
 libpath =3D datapath.."lua/"
+lugreluapath =3D gMainWorkingDir..(file_exists(gMainWorkingDir.."mylugre")=
 and "mylugre/lua/" or "lugre/lua/")
 gConfigPath 		=3D datapath.."config.lua"
 gConfigPathFallback	=3D datapath.."config.lua.dist"
+gSecondsSinceLastFrame =3D 0
+
 gInGameStarted =3D false
 gNet_State =3D false
 =

@@ -15,8 +19,19 @@
 --###############################
 =

 -- utils first
-dofile(libpath .. "lib.util.lua")
-dofile(libpath .. "lib.listener.lua")
+print("MainWorkingDir",gMainWorkingDir)
+print("lugreluapath",lugreluapath)
+dofile(lugreluapath .. "lugre.lua")
+lugre_include_libs(lugreluapath)
+dofile(libpath .. "lib.sound.iris.lua")
+dofile(libpath .. "lib.gui.iris.lua")
+dofile(libpath .. "lib.input.iris.lua")
+dofile(libpath .. "lib.keybinds.lua")
+dofile(libpath .. "lib.plaingui.iris.lua")
+
+dofile(libpath .. "lib.xml.lua")
+dofile(libpath .. "lib.net.lua")
+ =

 =

 -- renderer second
 gRendererList =3D {}
@@ -35,35 +50,24 @@
 end
 =

 dofile(libpath .. "lib.renderer.lua")
-dofile(libpath .. "lib.time.lua")
-dofile(libpath .. "lib.cam.lua")
 dofile(libpath .. "lib.uoids.lua")
-dofile(libpath .. "lib.input.lua")
 dofile(libpath .. "lib.season.lua")
 dofile(libpath .. "lib.terrain.lua")
 dofile(libpath .. "lib.static.lua")
-dofile(libpath .. "lib.xml.lua")
-dofile(libpath .. "lib.gui.lua")
-dofile(libpath .. "lib.guimaker.lua")
-dofile(libpath .. "lib.plaingui.lua")
 dofile(libpath .. "lib.compass.lua")
 dofile(libpath .. "lib.gfm.lua")
-dofile(libpath .. "lib.net.lua")
 dofile(libpath .. "lib.oldiristest.lua")
 dofile(libpath .. "lib.protocol.lua")
 dofile(libpath .. "lib.mousepick.lua")
 dofile(libpath .. "lib.gumpparser.lua")
 dofile(libpath .. "lib.data.lua")
 dofile(libpath .. "lib.cliloc.lua")
-dofile(libpath .. "lib.edittext.lua")
 dofile(libpath .. "lib.journal.lua")
-dofile(libpath .. "lib.fadelines.lua")
 dofile(libpath .. "lib.walking2.lua")
 dofile(libpath .. "lib.skill.lua")
 dofile(libpath .. "lib.spellbooks.lua")
 dofile(libpath .. "lib.speech.lua")
 dofile(libpath .. "lib.models.lua")
-dofile(libpath .. "lib.sound.lua")
 dofile(libpath .. "lib.test.lua")
 dofile(libpath .. "lib.filepath.lua")
 dofile(libpath .. "lib.loading.lua")
@@ -93,6 +97,11 @@
 --can be removed from release
 dofile(libpath .. "lib.meshexporter.lua")
 =

+
+--###############################
+--###        CONFIG           ###
+--###############################
+
 dofile(gConfigPathFallback)
 if (file_exists(gConfigPath)) then
 	-- execute local config
@@ -111,12 +120,61 @@
 end
 =

 --###############################
+--###     GUI STYLES          ###
+--###############################
+gGuiDefaultStyleSet =3D "ray"
+glGuiMakerStyleSet["sfz"] =3D {
+window =3D {
+		material=3D"ui_window",size=3D64,x=3D0,y=3D0,
+		cx1=3D11,cy1=3D11,cx2=3D10,cy2=3D10,cx3=3D11,cy3=3D11,
+		dx=3D0,dy=3D32,border=3D11,clipborder=3D11
+	},
+button =3D {
+		material=3D"ui_window",size=3D64,x=3D32,y=3D0,
+		cx1=3D5,cy1=3D5,cx2=3D22,cy2=3D22,cx3=3D5,cy3=3D5,
+		dx=3D0,dy=3D32,border=3D5,clipborder=3D5
+	},
+border =3D {
+		material=3D"ui_window",size=3D64,x=3D32,y=3D0,
+		cx1=3D5,cy1=3D5,cx2=3D22,cy2=3D22,cx3=3D5,cy3=3D5,
+		dx=3D0,dy=3D32,border=3D5,clipborder=3D5
+	},
+default =3D {
+		material=3D"ui_window",size=3D64,x=3D32,y=3D0,
+		cx1=3D5,cy1=3D5,cx2=3D22,cy2=3D22,cx3=3D5,cy3=3D5,
+		dx=3D0,dy=3D32,border=3D5,clipborder=3D5
+	},
+}
+glGuiMakerStyleSet["ray"] =3D {
+default =3D {
+		material=3D"ui_ray_border",size=3D32,x=3D0,y=3D0,
+		cx1=3D12,cy1=3D12,cx2=3D8,cy2=3D8,cx3=3D12,cy3=3D12,
+		dx=3D0,dy=3D0,border=3D12,clipborder=3D2
+	},
+window =3D {
+		material=3D"ui_ray_window",size=3D128,x=3D0,y=3D0,
+		cx1=3D18,cy1=3D28,cx2=3D104,cy2=3D86,cx3=3D6,cy3=3D14,
+		dx=3D0,dy=3D0,
+		border_l=3D18,border_r=3D6,border_t=3D28,border_b=3D14,
+		clipborder_l=3D7,clipborder_r=3D7,clipborder_t=3D29,clipborder_b=3D15
+	},
+button =3D {
+		material=3D"ui_ray_button",size=3D128,x=3D0,y=3D0,
+		cx1=3D8,cy1=3D8,cx2=3D112,cy2=3D9,cx3=3D8,cy3=3D8,
+		dx=3D0,dy=3D32,border=3D8,
+		clipborder_l=3D8,clipborder_r=3D5,
+		clipborder_t=3D3,clipborder_b=3D3
+	},
+}
+
+--###############################
 --###        FUNCTIONS        ###
 --###############################
 =

 --- called from c right before Main() for every commandline argument
 gCommandLineArguments =3D {}
-function CommandLineArgument (i,s) gCommandLineArguments[i] =3D s end
+gCommandLineSwitches =3D {}
+function CommandLineArgument (i,s) gCommandLineArguments[i] =3D s gCommand=
LineSwitches[s] =3D i end
 =

 -- checks if iris has found the uo directory and displays an error box if =
not
 function CheckUODir ()
@@ -174,7 +232,8 @@
 	=

 	LoadingProfile("initializing Ogre",true)
 	gPreOgreTime =3D gLoadingProfileLastTime
-	if (not InitOgre()) then Exit() end
+	if (not InitOgre("Iris2")) then Exit() end
+	SetCursorBaseOffset(0,0)
 =

 	-- set global shadow settings
 	if (gEnableShadows) then
@@ -199,6 +258,7 @@
 	SetLoadingBackground()
 	Client_RenderOneFrame() -- first frame rendered with ogre, needed for ini=
t of viewport size
 =

+	NotifyListener("Hook_PreLoad")
 	PreLoad()
 =

 	gCurrentRenderer:PreInit()
@@ -244,9 +304,12 @@
 =

 -- called every frame, after all timer-steppers, see Step() in lib.time.lua
 function MainStep (curticks)
+	gSecondsSinceLastFrame =3D (curticks - gMyTicks) / 1000.0
 	gMyTicks =3D curticks
 	UpdateStats(curticks)
 	StepTimer(curticks)
+	StepFadeLines()
+	gui.StepMoveDialog()
 	--TestGuiSystem2_Step()
 =

 	NetStep()
@@ -266,7 +329,11 @@
 =

 	StepDebugMenu()
 	gui.Step()
-
+	InputStep() -- generate mouse_left_drag_* and mouse_left_click_single eve=
nts =

+	GUIStep() -- generate mouse_enter, mouse_leave events (might adjust curso=
r -> before CursorStep)
+	CursorStep()
+
+	NotifyListener("Hook_MainStep")
 	NotifyListener( "EveryFrame" )
 	=

 	Client_RenderOneFrame()

Modified: trunk/data/lua/net.cursor.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.cursor.lua (original)
+++ trunk/data/lua/net.cursor.lua Sun Sep  2 16:20:30 2007
@@ -27,10 +27,7 @@
 	local isFirst =3D not gui.cursorGfx2D
 	if (not gui.cursorGfx2D) then
 		gui.cursorGfx2D =3D GetCursorGfx2D()
-		gui.cursorGfx2D:InitCCPO()
-		gui.cursorGfx2D:SetAlignment(kGfx2DAlign_Left,kGfx2DAlign_Top)
-		=

-	=

+		=

 		-- init dragicon holder
 		if (true) then
 			gui.cursorGfx2D_DragIcon =3D CreateGfx2D()

Modified: trunk/data/lua/net.popup.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.popup.lua (original)
+++ trunk/data/lua/net.popup.lua Sun Sep  2 16:20:30 2007
@@ -22,7 +22,7 @@
 	--- if there is already one open, close it
 	if gPopupMenu ~=3D nil then gPopupMenu:Close() end
 =

-	gPopupMenuSavedPosX,gPopupMenuSavedPosY =3D PollInput() -- TODO : maybe s=
ave mousepos at the time of contextrequest ?
+	gPopupMenuSavedPosX,gPopupMenuSavedPosY =3D GetMousePos() -- TODO : maybe=
 save mousepos at the time of contextrequest ?
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_Generic_Command)
 	out:PushNetUint16(hex2num("0x09")) -- packet size

Modified: trunk/data/lua/net.sound.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.sound.lua (original)
+++ trunk/data/lua/net.sound.lua Sun Sep  2 16:20:30 2007
@@ -10,7 +10,7 @@
 	local y =3D input:PopNetUint16()
 	local z =3D input:PopNetUint16()
 	printdebug("sound",sprintf("NET: kPacket_Sound: effect: %i singular: %i x=
: %i y: %i z: %i\n",effect,singular,x,y,z))
-	SoundPlayEffect(x,y,z * 0.1,effect)
+	SoundPlayEffect_UO(x,y,z * 0.1,effect)
 end
 =

 -- ProtocolRecv_Play_Midi

Modified: trunk/data/lua/net.uodragdrop.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.uodragdrop.lua (original)
+++ trunk/data/lua/net.uodragdrop.lua Sun Sep  2 16:20:30 2007
@@ -65,7 +65,7 @@
 	offx =3D offx or (-w / 2)
 	offy =3D offy or (-h / 2)
 	=

-	--local iMouseX,iMouseY =3D PollInput()
+	--local iMouseX,iMouseY =3D GetMousePos()
 	--local offx =3D widget.gfx:GetDerivedLeft() - iMouseX =

 	--local offy =3D widget.gfx:GetDerivedTop() - iMouseY
 	--local mat =3D GetGumpMat(gumpid)
@@ -81,7 +81,7 @@
 	local iArtID =3D item.artid + hex2num("0x4000")
 	local mat =3D GetArtMat(iArtID,item.hue)
 	local w,h =3D GetArtSize(iArtID)
-	local iMouseX,iMouseY =3D PollInput()
+	local iMouseX,iMouseY =3D GetMousePos()
 	local offx =3D widget.gfx:GetDerivedLeft() - iMouseX =

 	local offy =3D widget.gfx:GetDerivedTop() - iMouseY
 	=

@@ -117,14 +117,14 @@
 	gDragDrop.h =3D h
 	gDragDrop.offx =3D offx
 	gDragDrop.offy =3D offy
-	gDragDrop.iMouseX,gDragDrop.iMouseY =3D PollInput()
+	gDragDrop.iMouseX,gDragDrop.iMouseY =3D GetMousePos()
 	gDragDrop.started =3D false
 end
 =

 function StepUODragDrop () =

 	-- start dragdrop if the mouse is dragged for a minimum distance
 	if (gDragDrop and (not gDragDrop.started)) then =

-		local iMouseX,iMouseY =3D PollInput()
+		local iMouseX,iMouseY =3D GetMousePos()
 		local dx =3D gDragDrop.iMouseX - iMouseX
 		local dy =3D gDragDrop.iMouseY - iMouseY
 		local sqdist =3D dx*dx + dy*dy
@@ -167,7 +167,7 @@
 	-- TODO better amount handling
 	local amount =3D gDragDrop.item.amount
 	-- take only half the amount if shift is pressed
-	if gbAltDown and amount then amount =3D math.floor(amount / 2) end
+	if gKeyPressed[key_lalt] and amount then amount =3D math.floor(amount / 2=
) end
 	=

 	Send_Take_Object(gDragDrop.item.serial,amount)
 	gui.bMouseBlocked =3D true
@@ -218,7 +218,7 @@
 	=

 	if (dialog_under_mouse) then
 		if (dialog_under_mouse.rootwidget) then
-			local iMouseX,iMouseY =3D PollInput()
+			local iMouseX,iMouseY =3D GetMousePos()
 			x =3D iMouseX - dialog_under_mouse.rootwidget.gfx:GetDerivedLeft() + gD=
ragDrop.offx
 			y =3D iMouseY - dialog_under_mouse.rootwidget.gfx:GetDerivedTop() + gDr=
agDrop.offy
 		end

Modified: trunk/data/lua/net.walk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.walk.lua (original)
+++ trunk/data/lua/net.walk.lua Sun Sep  2 16:20:30 2007
@@ -129,14 +129,14 @@
 gFollowMobile =3D 0
 function WalkStep ()
 	-- runnung if shift is pressed
-	gWalk_Running =3D not gbShiftDown
+	gWalk_Running =3D not gKeyPressed[key_lshift]
 	=

 	-- handle keys if not in menu
 	if not gActiveEditText then
-		if gKeyUpDown then WalkForward() end
-		if gKeyDownDown then WalkTurn(4) end
-		if gKeyLeftDown then WalkTurn(-1) end
-		if gKeyRightDown then WalkTurn(1) end
+		if gKeyPressed[key_up]		then WalkForward() end
+		if gKeyPressed[key_down]	then WalkTurn( 4) end
+		if gKeyPressed[key_left]	then WalkTurn(-1) end
+		if gKeyPressed[key_right]	then WalkTurn( 1) end
 	end
 	=

 	-- follow target
@@ -151,7 +151,7 @@
 	=

 	-- right click pressed walk
 	=

-	if gMouseButtonDown_Right and gMouseWalkOnPressed then =

+	if gKeyPressed[key_mouse2] and gMouseWalkOnPressed then =

 		-- walk to the cursor
 		--[[if (gNextAutoWalkCheck < gMyTicks) then
 			SetAutoWalkTarget()
@@ -161,7 +161,7 @@
 		=

 		if (not GetWidgetUnderMouse()) then
 			-- walk into the direction of the cursor
-			local mx, my =3D PollInput()
+			local mx, my =3D GetMousePos()
 			local vw, vh =3D GetViewportSize()
 		=

 			local Phi =3D gCurrentRenderer:TranslateOsiWalkAngle(math.atan2( my-vh/=
2.0, mx-vw/2.0 ) / gfDeg2Rad + 450.0)

Modified: trunk/include/builder.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/builder.h (original)
+++ trunk/include/builder.h Sun Sep  2 16:20:30 2007
@@ -4,15 +4,17 @@
 #include <Ogre.h>
 #include <OgreVector3.h>
 #include <string>
-#include <smartptr.h>
+#include "lugre_smartptr.h"
 #include "data.h"
 =

 class 	lua_State;
 void	LuaRegisterBuilder 	(lua_State *L);
 =

+namespace Lugre {
+	class cOgreUserObjectWrapper;
+};
 =

-class cOgreUserObjectWrapper;
-class cMeshEntity : public cSmartPointable { public:
+class cMeshEntity : public Lugre::cSmartPointable { public:
 	Ogre::Entity*			mpOgreEntity;
 	cOgreUserObjectWrapper* mpUserObject;
 	=

@@ -33,9 +35,11 @@
 class cArtMapLoader;
 class cGumpLoader;
 class cTexMapLoader;
-class cBitMask;
 class cHueLoader;
 =

+namespace Lugre {
+	class cBitMask;
+};
 =

 void	WriteMapImageToFile	(cGroundBlockLoader& oGroundBlockLoader,cRadarCol=
orLoader& radarColors,cStaticBlockLoader* pStaticBlockLoader,const char* sz=
OutPath,const bool bBig);
 Ogre::TexturePtr	GenerateRadarImageRaw (int iPosX, int iPosY, cGroundBlock=
Loader& oGroundBlockLoader, cStaticBlockLoader& oStaticBlockLoader, cRadarC=
olorLoader& oRadarColorLoader, const char* szMatName);

Modified: trunk/include/data.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/data.h (original)
+++ trunk/include/data.h Sun Sep  2 16:20:30 2007
@@ -13,7 +13,7 @@
 #include <iostream>
 #include <fstream>
 #include <stdexcept>
-#include "smartptr.h"
+#include "lugre_smartptr.h"
 =

 /// ids below this are for ground-tiletypes, above this are for static-til=
etypes, 0x00004000 =3D 32*512
 #define TILETYPE_STATIC_ID_START 0x00004000
@@ -33,6 +33,9 @@
 // GCC packed attribute
 #define STRUCT_PACKED	__attribute__ ((packed))
 #endif
+
+
+using namespace Lugre;
 =

 class FileNotFoundException : public std::runtime_error { public:
 	FileNotFoundException(const std::string& sFilePath) : std::runtime_error(=
"FileNotFoundException : "+sFilePath) { }
@@ -213,7 +216,7 @@
 // ***** ***** ***** ***** ***** cUniFontFileLoader
 =

 	/// loads a complete uo unifont, =

-	class cUniFontFileLoader : public cFullFileLoader, public cSmartPointable=
 { public :
+	class cUniFontFileLoader : public cFullFileLoader, public Lugre::cSmartPo=
intable { public :
 		cUniFontFileLoader				(const char* szFile);
 		// returns the number of letters in the file
 		const int GetLetterNumbers();
@@ -290,7 +293,7 @@
 	};
 =

 	/// abstract base class
-	class cGroundBlockLoader : public cSmartPointable { public :
+	class cGroundBlockLoader : public Lugre::cSmartPointable { public :
 		int				miMapW;
 		int				miMapH;
 		cGroundBlockLoader						(const int iMapH);
@@ -354,7 +357,7 @@
 	};
 	=

 	/// abstract base class
-	class cStaticBlockLoader : public cSmartPointable { public :
+	class cStaticBlockLoader : public Lugre::cSmartPointable { public :
 		int				miMapW;
 		int				miMapH;
 		cStaticBlockLoader						(const int iMapH);
@@ -405,7 +408,7 @@
 	=

 	=

 	/// abstract base class
-	class cTileTypeLoader : public cSmartPointable { public :
+	class cTileTypeLoader : public Lugre::cSmartPointable { public :
 		virtual	cGroundTileType*	GetGroundTileType	(const int iID) =3D 0; ///< r=
esult of Get is only valid until next Get call
 		virtual	cStaticTileType*	GetStaticTileType	(const int iID) =3D 0; ///< r=
esult of Get is only valid until next Get call
 		virtual	int					GetEndID			() =3D 0; ///< the returned id is not valid, =
some ids right before it might also be not valid
@@ -423,7 +426,7 @@
 =

 // ***** ***** ***** ***** ***** AnimData
 =

-	class cAnimDataLoader : public cSmartPointable, public cFullFileLoader { =
public :
+	class cAnimDataLoader : public Lugre::cSmartPointable, public cFullFileLo=
ader { public :
 		RawAnimData*		mpLastAnimData;		=

 		cAnimDataLoader							(const char* szFile);
 		RawAnimData*		GetAnimDataType		(const int iID);
@@ -434,7 +437,7 @@
 	=

 	/// holds a color for each tiletype to be presented on a radar or map lik=
e display
 	/// reads entire file on construction, changes raw data so that alpha bit=
 is set to opaque, so Ogre::PF_A1R5G5B5 can be used directly
-	class cRadarColorLoader : public cSmartPointable, public cFullFileLoader =
{ public:
+	class cRadarColorLoader : public Lugre::cSmartPointable, public cFullFile=
Loader { public:
 		cRadarColorLoader	(const char* szFile);
 		inline short	GetCol16	(const int iID) { return (iID < 0 || iID >=3D miFu=
llFileSize/sizeof(short)) ? 0 : ((short*)mpFullFileBuffer)[iID]; } 	///< fo=
r Ogre::PF_A1R5G5B5
 	};
@@ -453,7 +456,7 @@
 	};
 	=

 	/// loads complete hue into one big buffer, usually around 300k, used for=
 high-speed loading of the entire hue buffer
-	class cHueLoader : public cSmartPointable, public cFullFileLoader { publi=
c :
+	class cHueLoader : public Lugre::cSmartPointable, public cFullFileLoader =
{ public :
 		cHue		mLastHue;
 		cHueLoader		(const char* szDataFile);
 		int		GetMaxHueID		();
@@ -586,7 +589,7 @@
 	};
 	=

 	/// abstract base class
-	class cTexMapLoader : public cSmartPointable { public :
+	class cTexMapLoader : public Lugre::cSmartPointable { public :
 		virtual	cTexMap*	GetTexMap	(const int iID) =3D 0; ///< result of Get is =
only valid until next Get call
 	};
 	=

@@ -687,7 +690,7 @@
 	};
 	=

 	/// abstract base class
-	class cArtMapLoader : public cSmartPointable { public :
+	class cArtMapLoader : public Lugre::cSmartPointable { public :
 		virtual	cArtMap*	GetArtMap	(const int iID) =3D 0; ///< result of Get is =
only valid until next Get call
 		virtual unsigned int	GetCount	() =3D 0;	///< number of artmaps
 	};
@@ -710,7 +713,7 @@
 // ***** ***** ***** ***** ***** multi loader
 =

 	/// abstract base class
-	class cMultiLoader : public cSmartPointable { public :
+	class cMultiLoader : public Lugre::cSmartPointable { public :
 		virtual	unsigned int	CountMultiParts	(const int iID) =3D 0; ///< number =
of parts the multi iID has
 		virtual	RawMultiPart*	GetMultiParts	(const int iID) =3D 0; ///< points t=
o the startpart of the multi iID, from this CountMultiParts(iID) parts valid
 	};
@@ -766,7 +769,7 @@
 	};
 	=

 	/// abstract base class
-	class cGumpLoader : public cSmartPointable { public :
+	class cGumpLoader : public Lugre::cSmartPointable { public :
 		virtual	cGump*	GetGump	(const int iID) =3D 0; ///< result of Get is only=
 valid until next Get call
 	};
 	=

@@ -799,7 +802,7 @@
 	};
 	=

 	/// abstract base class
-	class cSoundLoader : public cSmartPointable { public :
+	class cSoundLoader : public Lugre::cSmartPointable { public :
 		virtual	cSound*	GetSound	(const int iID) =3D 0; ///< result of Get is on=
ly valid until next Get call
 	};
 	=

@@ -918,7 +921,7 @@
 	};
 	=

 	/// abstract base class
-	class cAnimLoader : public cSmartPointable { public :
+	class cAnimLoader : public Lugre::cSmartPointable { public :
 		int mHighDetailed;
 		int mLowDetailed;
 		cAnimLoader (const int iHighDetailed, const int iLowDetailed) {};
@@ -958,7 +961,7 @@
 	};
 	=

 	/// abstract base class
-	class cLightLoader : public cSmartPointable { public :
+	class cLightLoader : public Lugre::cSmartPointable { public :
 		virtual	cLight*		GetLight	(const int iID) =3D 0; ///< result of Get is o=
nly valid until next Get call
 	};
 	=


Modified: trunk/include/grannyloader_i2.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/grannyloader_i2.h (original)
+++ trunk/include/grannyloader_i2.h Sun Sep  2 16:20:30 2007
@@ -1,14 +1,14 @@
 #ifndef GRANNYLOADER_I2_H
 #define GRANNYLOADER_I2_H
 =

-#include "robstring1.2.h"
-#include "smartptr.h"
+#include "lugre_robstring.h"
+#include "lugre_smartptr.h"
 #include "grannyparser.h"
 #include <vector>
 #include <string>
 =

 /// walks granny file to extract the data in a useful form
-class cGrannyLoader_i2 : public cGrannyVisitor, public cSmartPointable { p=
ublic:
+class cGrannyLoader_i2 : public cGrannyVisitor, public Lugre::cSmartPointa=
ble { public:
 	cGranny		mGranny;
 	=

 	class cSubMesh { public:

Modified: trunk/include/grannyparser.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/grannyparser.h (original)
+++ trunk/include/grannyparser.h Sun Sep  2 16:20:30 2007
@@ -1,7 +1,7 @@
 #ifndef GRANNYLOADER_H
 #define GRANNYLOADER_H
 =

-#include "smartptr.h"
+#include "lugre_smartptr.h"
 #include <stdexcept>
 #include <string>
 #include <map>
@@ -22,7 +22,7 @@
 =

 #define GRANNY_CHUNKTYPE_MAGIC 0xCA5E0000
 =

-
+using namespace Lugre;
 =

 class GrannyLoadException : public std::runtime_error { public:
 	GrannyLoadException(const std::string& sMsg) : std::runtime_error("Granny=
LoadException : "+sMsg) { }
@@ -197,7 +197,7 @@
 =

 =

 /// buffers a granny file, can be traversed using a custom cGrannyVisitor =
for the ParseGranny method
-class cGranny : public cSmartPointable { public:
+class cGranny : public Lugre::cSmartPointable { public:
 	char*		mpBuf;
 	int 		miBufSize;
 	std::string	msFilePath;

Modified: trunk/include/legacydata.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/legacydata.h (original)
+++ trunk/include/legacydata.h Sun Sep  2 16:20:30 2007
@@ -1,7 +1,7 @@
 #ifndef LEGACYDATALOADER_H
 #define LEGACYDATALOADER_H
 #include <OgreVector3.h>
-#include "smartptr.h"
+#include "lugre_smartptr.h"
 =

 class cArtMapLoader;
 namespace Ogre {
@@ -16,7 +16,7 @@
 /// use ogre model format and .material files instead
 =

 /// abstract base class to hide the ugly details
-class cLegacyModelAndTextureLoader : public cSmartPointable { public : =

+class cLegacyModelAndTextureLoader : public Lugre::cSmartPointable { publi=
c : =

 	static cLegacyModelAndTextureLoader*	CreateLegacyModelAndTextureLoader(co=
nst char* szFile);
 	=

 	virtual bool		HasMesh				(const int iID) =3D 0; ///< check for existence =
without loading

Modified: trunk/include/ogremanualloader.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/ogremanualloader.h (original)
+++ trunk/include/ogremanualloader.h Sun Sep  2 16:20:30 2007
@@ -1,9 +1,7 @@
 #ifndef _OGREMANUALLOADER_H_
 #define _OGREMANUALLOADER_H_
 =

-#include "prefix.h"
-
-#include "smartptr.h"
+#include "lugre_smartptr.h"
 #include <Ogre.h>
 #include "data.h"
 =

@@ -11,7 +9,7 @@
 class lua_State;
 =

 /// manual resource loader for creating art materials on the fly
-class cManualArtMaterialLoader : public Ogre::ManualResourceLoader, public=
 cSmartPointable {
+class cManualArtMaterialLoader : public Ogre::ManualResourceLoader, public=
 Lugre::cSmartPointable {
 public:
 	cManualArtMaterialLoader (const char *format, const char *material_base, =
cArtMapLoader *pArtMapLoader,bool bPixelExact,bool bInvertY,bool bInvertX);
 	virtual ~cManualArtMaterialLoader ();

Modified: trunk/include/radar.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/radar.h (original)
+++ trunk/include/radar.h Sun Sep  2 16:20:30 2007
@@ -5,7 +5,7 @@
 #include <map>
 #include <utility>
 =

-class dRadar : public cSmartPointable { =

+class dRadar : public Lugre::cSmartPointable { =

 private :
 	cSpriteManager* mSpriteManager;
 =


Modified: trunk/include/spritemanager.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/spritemanager.h (original)
+++ trunk/include/spritemanager.h Sun Sep  2 16:20:30 2007
@@ -1,8 +1,8 @@
 #ifndef _SPRITEMANAGER_H_
 #define _SPRITEMANAGER_H_
 =

-#include "smartptr.h"
-#include "robrenderable.h"
+#include "lugre_smartptr.h"
+#include "lugre_robrenderable.h"
 =

 #include <Ogre.h>
 #include <OgreRenderQueueListener.h>
@@ -15,11 +15,13 @@
 class cSpriteQueue;
 class lua_State;
 =

+using namespace Lugre;
+
 struct Normal {
 	double x, y, z;
 };
 =

-class cBaseSprite : public cSmartPointable {
+class cBaseSprite : public Lugre::cSmartPointable {
 	protected :
 		cSpriteQueue* mSpriteQueue;
 		int mPrio[6];
@@ -295,7 +297,7 @@
 		virtual void Execute( double ViewPortWidthHalf, double ViewPortHeightHal=
f, double xOffset, double yOffset );
 };
 =

-class cSpriteQueue : public cSmartPointable {
+class cSpriteQueue : public Lugre::cSmartPointable {
 	private :
 		cSpriteManager* mSpriteManager;
 		std::list<cBaseSprite*> mSpriteList;
@@ -337,7 +339,7 @@
 		void RemoveSprite( cBaseSprite* Sprite );
 };
 =

-class cSpriteManager : public Ogre::RenderQueueListener, public cSmartPoin=
table {
+class cSpriteManager : public Ogre::RenderQueueListener, public Lugre::cSm=
artPointable {
 	private :
 		std::map< int, cSpriteQueue*> mSpriteQueues;
 		=


Modified: trunk/src/builder.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/builder.cpp (original)
+++ trunk/src/builder.cpp Sun Sep  2 16:20:30 2007
@@ -1,15 +1,18 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include "builder.h"
 #include "data.h"
-#include "ogrewrapper.h"
-#include "scripting.h"
-#include "bitmask.h"
-#include "robstring1.2.h"
+#include "lugre_ogrewrapper.h"
+#include "lugre_scripting.h"
+#include "lugre_bitmask.h"
+#include "lugre_robstring.h"
 #include <Ogre.h>
 #include <OgreFont.h>
 #include <OgreFontManager.h>
 #include <OgreBitwise.h>
 #include <map>
+
+
+using namespace Lugre;
 =

 /// color format conversion from Ogre::PF_A1R5G5B5 to Ogre::PF_A8R8G8B8
 /// maps [0x00,0x1f] to [0x00,0xff] for rgb

Modified: trunk/src/builder_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/builder_L.cpp (original)
+++ trunk/src/builder_L.cpp Sun Sep  2 16:20:30 2007
@@ -1,10 +1,10 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include "data.h"
-#include "scripting.h"
-#include "luabind.h"
+#include "lugre_scripting.h"
+#include "lugre_luabind.h"
 #include "builder.h"
-#include "ogrewrapper.h"
-#include "input.h"
+#include "lugre_ogrewrapper.h"
+#include "lugre_input.h"
 #include <Ogre.h>
 =

 extern "C" {
@@ -12,6 +12,9 @@
 	#include "lauxlib.h"
 	#include "lualib.h"
 }
+
+
+using namespace Lugre;
 =

 =

 cMeshEntity::cMeshEntity(const char* szMeshName) : mpOgreEntity(0), mpUser=
Object(0) {

Modified: trunk/src/data.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data.cpp (original)
+++ trunk/src/data.cpp Sun Sep  2 16:20:30 2007
@@ -1,4 +1,4 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include "data.h"
 #include <stdio.h>
 #include "tinyxml.h"
@@ -7,7 +7,10 @@
 #include <fstream>
 #include <Ogre.h>
 #include <OgreCodec.h>
-#include "robstring1.2.h"
+#include "lugre_robstring.h"
+
+
+using namespace Lugre;
 =

 =

 /*

Modified: trunk/src/data_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data_L.cpp (original)
+++ trunk/src/data_L.cpp Sun Sep  2 16:20:30 2007
@@ -1,11 +1,11 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include "data.h"
-#include "scripting.h"
-#include "luabind.h"
-#include "ogrewrapper.h"
+#include "lugre_scripting.h"
+#include "lugre_luabind.h"
+#include "lugre_ogrewrapper.h"
 #include "builder.h"
-#include "bitmask.h"
-#include "sound.h"
+#include "lugre_bitmask.h"
+#include "lugre_sound.h"
 #include <string>
 #include <stdlib.h>
 #include <map>
@@ -15,6 +15,9 @@
 	#include "lauxlib.h"
 	#include "lualib.h"
 }
+
+
+using namespace Lugre;
 =

 class cGroundBlockLoader_L : public cLuaBind<cGroundBlockLoader> { public:
 	// implementation of cLuaBind

Modified: trunk/src/granny_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/granny_L.cpp (original)
+++ trunk/src/granny_L.cpp Sun Sep  2 16:20:30 2007
@@ -1,10 +1,10 @@
-#include "prefix.h"
-#include "luabind.h"
+#include "lugre_prefix.h"
+#include "lugre_luabind.h"
 #include "grannyparser.h"
 #include "grannyloader_i2.h"
 #include "grannyogreloader.h"
-#include "ogrewrapper.h"
-#include "smartptr.h"
+#include "lugre_ogrewrapper.h"
+#include "lugre_smartptr.h"
 #include <Ogre.h>
 =

 extern "C" {
@@ -12,6 +12,9 @@
 	#include "lauxlib.h"
 	#include "lualib.h"
 }
+
+
+using namespace Lugre;
 =

 =

 =


Modified: trunk/src/grannydump.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/grannydump.cpp (original)
+++ trunk/src/grannydump.cpp Sun Sep  2 16:20:30 2007
@@ -1,7 +1,10 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include <stdio.h>
 #include "grannyparser.h"
 #include "grannyloader_i2.h"
+
+
+using namespace Lugre;
 =

 /// utility for debugging, prints the granny into a (somewhat) human reada=
ble form
 /// also useful as an example for how to implement a visitor

Modified: trunk/src/grannyloader_i2.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/grannyloader_i2.cpp (original)
+++ trunk/src/grannyloader_i2.cpp Sun Sep  2 16:20:30 2007
@@ -1,5 +1,8 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include "grannyloader_i2.h"
+
+
+using namespace Lugre;
 =

 =

 cGrannyLoader_i2::cGrannyLoader_i2	(const char* szFilePath) : =


Modified: trunk/src/grannyogreloader.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/grannyogreloader.cpp (original)
+++ trunk/src/grannyogreloader.cpp Sun Sep  2 16:20:30 2007
@@ -1,8 +1,8 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include "grannyparser.h"
 #include "grannyloader_i2.h"
 #include "grannyogreloader.h"
-#include "fifo.h"
+#include "lugre_fifo.h"
 #undef min
 #undef max
 #include <Ogre.h>
@@ -10,7 +10,10 @@
 #include <algorithm>
 #include <vector>
 #include <map>
-#include "scripting.h"
+#include "lugre_scripting.h"
+
+
+using namespace Lugre;
 =

 //void myassert( bool cond, const char* szmessage ) { if (!cond) { printf(=
 "assert: %s\n", szmessage ); exit( 0 ); } }
 =


Modified: trunk/src/grannyparser.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/grannyparser.cpp (original)
+++ trunk/src/grannyparser.cpp Sun Sep  2 16:20:30 2007
@@ -1,12 +1,15 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include <stdio.h>
 #include <stdlib.h>
 #include <iostream>
 #include <algorithm>
 #include <functional>
 #include <fstream>
-#include "robstring1.2.h"
+#include "lugre_robstring.h"
 #include "grannyparser.h"
+
+
+using namespace Lugre;
 =

 =

 // ***** ***** ***** ***** ***** cGrannyParent

Modified: trunk/src/legacydata.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/legacydata.cpp (original)
+++ trunk/src/legacydata.cpp Sun Sep  2 16:20:30 2007
@@ -1,8 +1,11 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include "legacydata.h"
 #include "builder.h"
 #include "pathsearch.h"
 #include "data.h"
+
+
+using namespace Lugre;
 =

 =

 #define COLOR_KEY_TOLERANCE_OLDIRIS1	1000
@@ -34,9 +37,9 @@
 #include <vector>
 #include <stdexcept>
 =

-#include "robstring1.2.h"
-#include "ogrewrapper.h"
-#include "scripting.h"
+#include "lugre_robstring.h"
+#include "lugre_ogrewrapper.h"
+#include "lugre_scripting.h"
 #include <Ogre.h>
 #include <OgreFreeImageCodec.h>
 #include <OgrePrerequisites.h>

Modified: trunk/src/main.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/main.cpp (original)
+++ trunk/src/main.cpp Sun Sep  2 16:20:30 2007
@@ -1,207 +1,49 @@
-#include "prefix.h"
-#include "Ogre.h"
-
-#include "shell.h"
-#include "game.h"
-
-#include <time.h>
-#include <signal.h> // seems to be crossplatform
-
-
-void DisplayErrorMessage	(const char* szMsg);
-void MySignalHandler		(int a);
-void MyCrash				(const char* szMessage);
-
-#if OGRE_PLATFORM =3D=3D OGRE_PLATFORM_WIN32
+#include "lugre_prefix.h"
+#include "lugre_robstring.h"
+#include "lugre_main.h"
+#ifdef WIN32
 #define WIN32_LEAN_AND_MEAN
 #include "windows.h"
-
-#define WIN32_CONSOLE_APP
-
-/*
-#include <ctype.h>
-#include <iostream>
-#include "OgreException.h"
-*/
-
-#include <stdio.h>
-#include <fcntl.h>
-#include <io.h>
-#include <iostream>
-#include <string>
-#include <vector>
-#include <stdexcept>
-
-#ifndef WIN32_CONSOLE_APP
-void showWin32Console()
-{ PROFILE
-	static const WORD MAX_CONSOLE_LINES =3D 500;
-	int hConHandle;
-	long lStdHandle;
-	CONSOLE_SCREEN_BUFFER_INFO coninfo;
-	FILE *fp;
-	// allocate a console for this app
-	AllocConsole();
-	// set the screen buffer to be big enough to let us scroll text
-	GetConsoleScreenBufferInfo(GetStdHandle(STD_OUTPUT_HANDLE), &coninfo);
-	coninfo.dwSize.Y =3D MAX_CONSOLE_LINES;
-	SetConsoleScreenBufferSize(GetStdHandle(STD_OUTPUT_HANDLE),
-	coninfo.dwSize);
-	// redirect unbuffered STDOUT to the console
-	lStdHandle =3D (long)GetStdHandle(STD_OUTPUT_HANDLE);
-	hConHandle =3D _open_osfhandle(lStdHandle, _O_TEXT);
-	fp =3D _fdopen( hConHandle, "w" );
-	*stdout =3D *fp;
-	setvbuf( stdout, NULL, _IONBF, 0 );
-	// redirect unbuffered STDIN to the console
-	lStdHandle =3D (long)GetStdHandle(STD_INPUT_HANDLE);
-	hConHandle =3D _open_osfhandle(lStdHandle, _O_TEXT);
-	fp =3D _fdopen( hConHandle, "r" );
-	*stdin =3D *fp;
-	setvbuf( stdin, NULL, _IONBF, 0 );
-	// redirect unbuffered STDERR to the console
-	lStdHandle =3D (long)GetStdHandle(STD_ERROR_HANDLE);
-	hConHandle =3D _open_osfhandle(lStdHandle, _O_TEXT);
-	fp =3D _fdopen( hConHandle, "w" );
-	*stderr =3D *fp;
-	setvbuf( stderr, NULL, _IONBF, 0 );
-	// make cout, wcout, cin, wcin, wcerr, cerr, wclog and clog
-	// point to console as well
-	std::ios::sync_with_stdio();
-}
 #endif
 =

+#define PATH_MAIN_LUA		LUGRE_PATH("data/lua/main.lua")
+#define PATH_LUGRE_LUA		LUGRE_PATH("lugre/lua")
 =

-#ifdef WIN32_CONSOLE_APP
-int main(int argc, char* argv[])
+using namespace Lugre;
+
+void	Iris_RegisterLuaPlugin	();
+
+// #define USE_WINMAIN
+
+#ifdef USE_WINMAIN
+INT WINAPI	WinMain		(HINSTANCE hInst, HINSTANCE hPrevInstance, LPSTR strCm=
dLine,int nCmdShow) { // nCmdShow : show state of window
 #else
-INT WINAPI WinMain( HINSTANCE hInst, HINSTANCE hPrevInstance, LPSTR strCmd=
Line,int nCmdShow)
+int			main		(int argc, char* argv[]) {
 #endif
-{ PROFILE
-    //int nCmdShow 	// show state of window
-	#ifndef WIN32_CONSOLE_APP
-
-    //generate posix like argc/argv
-	const char* szCommandLineWithProgrammName =3D GetCommandLine();
-    printf("parsing cmdline: %s\n",GetCommandLine());
-	std::vector<std::string> myCmdLineParams;
-	const char* szCmdLineSep =3D " \t";
-	for (const char* r=3DszCommandLineWithProgrammName;*r;) {
-		int len =3D strcspn(r,szCmdLineSep);
-		myCmdLineParams.push_back(std::string(r,len));
-		r +=3D len;
-		r +=3D strspn(r,szCmdLineSep);
-	}
-
-	int i;
-    int argc =3D myCmdLineParams.size();
-    char **argv =3D (char**)malloc(argc * sizeof(char*));
-	for (i=3D0;i<argc;++i) argv[i] =3D strdup(myCmdLineParams[i].c_str());
-	//for (i=3D0;i<argc;++i) printf("cmdline %d =3D %s\n",i,argv[i]);
-
-	if (true || std::string(strCmdLine).find("-c") !=3D -1) { // always enabl=
ed until we have fully functional error output without console
-		#ifdef SET_TERM_HANDLER
-		SET_TERM_HANDLER;
-		#endif
-		showWin32Console();
-	}
-	#endif
-
-#else
-int main(int argc, char *argv[])
-{ PROFILE
-#endif
-
-	// see http://msdn.microsoft.com/library/default.asp?url=3D/library/en-us=
/vclib/html/_crt_signal.asp for details
-	signal(SIGSEGV,MySignalHandler); // seems to be cross platform
-
-    try {
-        cShell& shell =3D cShell::GetSingleton();
-
-        shell.Init(argc,argv);
-
-		cGame::GetSingleton().Run(argc,argv);
-		=

-        shell.DeInit();
-
-    } catch( Ogre::Exception& e ) {
-		printf("ogre::exception\n");
-		printf(" %s\n",e.getFullDescription().c_str());
-		MyCrash((std::string("Ogre::exception occurred, see console\n") + e.getF=
ullDescription()).c_str());
-    } catch( std::exception& e ) {
-		printf("std::exception\n");
-		printf(" %s\n",e.what());
-		MyCrash((std::string("std::exception occurred, see console\n") + e.what(=
)).c_str());
-    } catch(...) {
-		printf("unknown exception\n");
-		MyCrash("unknown exception occurred\n");
-    }
-
-#ifndef WIN32_CONSOLE_APP
-#if OGRE_PLATFORM =3D=3D OGRE_PLATFORM_WIN32
-    FreeConsole();
-#endif
-#endif
-
-    return 0;
-}
-
-
-
-void DisplayNotice (const char* szMsg) {
-	printf("NOTICE : %s\n",szMsg);
-	#ifdef WIN32
-		// MessageBox requires user32.lib in linker settings for libraries
-		MessageBox( NULL,szMsg, "Notice", MB_OK | MB_ICONERROR | MB_TASKMODAL);
-	#endif
-}
-
-void DisplayErrorMessage (const char* szMsg) {
-	printf("ERROR : %s\n",szMsg);
-	#ifdef WIN32
-		// MessageBox requires user32.lib in linker settings for libraries
-		MessageBox( NULL,szMsg, "Error!", MB_OK | MB_ICONERROR | MB_TASKMODAL);
-	#endif
-}
-
-/// defined in scripting.cpp
-void	PrintLuaStackTrace		();
-void	PrintLuaStackTrace		(const char *filename);
-
-/// called on segfault
-void MySignalHandler		(int a) {
-	// print on screen
-	MyCrash("SegFault Detected");
-}
 	=

-void MyCrash		(const char* szMessage) {
-	PROFILE_PRINT_STACKTRACE
-	PrintLuaStackTrace();
-	=

-	const char *filename =3D "stacktrace.log";
-	// print to file
-	{
-		// time
-		struct tm *ptr;
-		time_t tm;
-		tm =3D time(NULL);
-		ptr =3D localtime(&tm);
-		FILE *f =3D fopen(filename,"a");
-		if(f){
-			fprintf(f,"\n\n:: %s\n%s\n",asctime(ptr),szMessage);
-			fclose(f);
-		}
-	}
-	PROFILE_PRINT_STACKTRACE_TOFILE(filename)
-	PrintLuaStackTrace(filename);
-	=

-	std::string s(szMessage);
-	s +=3D "\n";
+	std::string s;
 	s +=3D "If this error remains after running the updater and you think thi=
s is a bug\n";
 	s +=3D "please check the BugTracker at www.iris2.de\n";
 	s +=3D "and report it if it is not already known.\n";
 	s +=3D "Please also append the logfile in bin/stacktrace.log to your bugr=
eport.";
-	DisplayErrorMessage(s.c_str());
-		=

-	abort();
+	Lugre_SetCrashText(s.c_str());
+	=

+	// create a unix-like commandline and show console in win
+	#ifdef USE_WINMAIN
+	int	argc =3D 0;
+	char **argv =3D Lugre_ParseWinCommandLine(argc);
+	Lugre_ShowWin32Console();
+	#endif
+	=

+	// register plugins
+	=

+	Iris_RegisterLuaPlugin();
+	=

+	// start mainloop
+	=

+	Lugre_Run(argc,argv,PATH_MAIN_LUA,PATH_LUGRE_LUA,"bin/");
+	=

+	return 0;
 }
+
+

Modified: trunk/src/ogremanualloader.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/ogremanualloader.cpp (original)
+++ trunk/src/ogremanualloader.cpp Sun Sep  2 16:20:30 2007
@@ -1,9 +1,12 @@
+#include "lugre_prefix.h"
 #include "ogremanualloader.h"
 =

-#include "ogrewrapper.h"
+#include "lugre_ogrewrapper.h"
 #include "data.h"
 #include "builder.h"
-#include "robstring1.2.h"
+#include "lugre_robstring.h"
+
+using namespace Lugre;
 =

 cManualArtMaterialLoader::cManualArtMaterialLoader (const char *format, co=
nst char *material_base, cArtMapLoader *pArtMapLoader,bool bPixelExact,bool=
 bInvertY,bool bInvertX) : =

 	mpArtMapLoader(pArtMapLoader), mbPixelExact(bPixelExact), mbInvertY(bInve=
rtY), mbInvertX(bInvertX), msFormat(format), msMaterialBase(material_base) =
{ PROFILE

Modified: trunk/src/ogremanualloader_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/ogremanualloader_L.cpp (original)
+++ trunk/src/ogremanualloader_L.cpp Sun Sep  2 16:20:30 2007
@@ -1,12 +1,14 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include "ogremanualloader.h"
-#include "luabind.h"
+#include "lugre_luabind.h"
 =

 extern "C" {
 	#include "lua.h"
 	#include "lauxlib.h"
 	#include "lualib.h"
-}
+}
+
+using namespace Lugre;
 =

 class cManualArtMaterialLoader_L : public cLuaBind<cManualArtMaterialLoade=
r> { public:
 	// implementation of cLuaBind

Modified: trunk/src/pathsearch.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/pathsearch.cpp (original)
+++ trunk/src/pathsearch.cpp Sun Sep  2 16:20:30 2007
@@ -1,6 +1,6 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include "pathsearch.h"
-#include "robstring1.2.h"
+#include "lugre_robstring.h"
 =

 #include <map>
 #include <vector>
@@ -16,6 +16,9 @@
 	// this is the linux code
 	#include <dirent.h>
 #endif
+
+using namespace Lugre;
+
 std::map<std::string,std::vector<std::string>* > gpDirCache_Dirs;
 std::map<std::string,std::vector<std::string>* > gpDirCache_Files;
 =


Modified: trunk/src/radar.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/radar.cpp (original)
+++ trunk/src/radar.cpp Sun Sep  2 16:20:30 2007
@@ -1,12 +1,15 @@
+#include "lugre_prefix.h"
 #include "radar.h"
 #include "builder.h"
 #include "spritemanager.h"
-#include "ogrewrapper.h"
+#include "lugre_ogrewrapper.h"
 #include <math.h>
 #include <algorithm>
 =

 #include <Ogre.h>
 #include <OgreRenderQueueListener.h>
+
+using namespace Lugre;
 =

 dRadar::dRadar( cGroundBlockLoader* oGroundBlockLoader, cStaticBlockLoader=
* oStaticBlockLoader,	cRadarColorLoader* oRadarColorLoader ) {
 	mGroundBlockLoader =3D oGroundBlockLoader;

Modified: trunk/src/radar_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/radar_L.cpp (original)
+++ trunk/src/radar_L.cpp Sun Sep  2 16:20:30 2007
@@ -1,12 +1,14 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include "data.h"
-#include "scripting.h"
-#include "luabind.h"
-#include "ogrewrapper.h"
+#include "lugre_scripting.h"
+#include "lugre_luabind.h"
+#include "lugre_ogrewrapper.h"
 #include "radar.h"
 #include <string>
 #include <stdlib.h>
 #include <map>
+
+using namespace Lugre;
 =

 extern "C" {
 	#include "lua.h"

Modified: trunk/src/spritemanager.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/spritemanager.cpp (original)
+++ trunk/src/spritemanager.cpp Sun Sep  2 16:20:30 2007
@@ -1,9 +1,12 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include "spritemanager.h"
-#include "ogrewrapper.h"
-#include "shell.h"
+#include "lugre_ogrewrapper.h"
+#include "lugre_shell.h"
 #include <Ogre.h>
 #include <math.h>
+
+
+using namespace Lugre;
 =

 void cBaseSprite::SetPrio( int i, int Prio ) { PROFILE
 	if (i < 6 && mPrio[i] !=3D Prio ) {		=


Modified: trunk/src/spritemanager_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/spritemanager_L.cpp (original)
+++ trunk/src/spritemanager_L.cpp Sun Sep  2 16:20:30 2007
@@ -1,7 +1,7 @@
-#include "prefix.h"
-#include "luabind.h"
+#include "lugre_prefix.h"
+#include "lugre_luabind.h"
 #include "spritemanager.h"
-#include "ogrewrapper.h"
+#include "lugre_ogrewrapper.h"
 #include <Ogre.h>
 =

 extern "C" {
@@ -11,6 +11,8 @@
 }
 =

 using namespace Ogre;
+
+using namespace Lugre;
 =

 class lua_State;
 =


Modified: trunk/src/terrain.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain.cpp (original)
+++ trunk/src/terrain.cpp Sun Sep  2 16:20:30 2007
@@ -1,15 +1,17 @@
-#include "prefix.h"
+#include "lugre_prefix.h"
 #include "terrain.h"
 #include "data.h"
-#include "ogrewrapper.h"
-#include "meshshape.h" // for TerrainRayIntersect
-#include "scripting.h"
-#include "fifo.h"
+#include "lugre_ogrewrapper.h"
+#include "lugre_meshshape.h" // for TerrainRayIntersect
+#include "lugre_scripting.h"
+#include "lugre_fifo.h"
 #include "data.h"
 #include <Ogre.h>
 #include <map>
 =

 #define ANTI_XMIRROR
+
+using namespace Lugre;
 =

 using std::min;
 using std::max;

Modified: trunk/start.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/start.sh (original)
+++ trunk/start.sh Sun Sep  2 16:20:30 2007
@@ -1,4 +1,5 @@
 #!/bin/bash
 pushd bin
-../src/irisogre
+#../src/irisogre
+../iris
 popd



From no-reply at zwischenwelt.org  Sun Sep  2 19:51:18 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Sep 2007 17:51:18 -0000
Subject: [Iris-commit] [IRIS] r1374 - in /trunk: include/huffman.h
 src/huffman.cpp src/scripting.iris.cpp
Message-ID: <20070902175119.4983C1524003@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Sep  2 19:51:15 2007
New Revision: 1374

Log:
removed huffman stuff from lugre, might cause license problems, and is only=
 needed by iris

Added:
    trunk/include/huffman.h
    trunk/src/huffman.cpp
Modified:
    trunk/src/scripting.iris.cpp

Modified: trunk/src/scripting.iris.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.iris.cpp (original)
+++ trunk/src/scripting.iris.cpp Sun Sep  2 19:51:15 2007
@@ -14,6 +14,7 @@
 #include "radar.h"
 #include "spritemanager.h"
 #include "ogremanualloader.h"
+#include "huffman.h"
 =

 using namespace Lugre;
 =

@@ -331,11 +332,24 @@
 }
 =

 =

+// void				HuffmanCompress		(fifo in,fifo out)
+static int		  l_HuffmanCompress		(lua_State *L) { PROFILE =

+	HuffmanCompress(cLuaBind<cFIFO>::checkudata_alive(L,1),cLuaBind<cFIFO>::c=
heckudata_alive(L,2));
+	return 0;
+}
+
+// void				HuffmanDecompress	(fifo in,fifo out)
+static int		  l_HuffmanDecompress	(lua_State *L) { PROFILE =

+	HuffmanDecompress(cLuaBind<cFIFO>::checkudata_alive(L,1),cLuaBind<cFIFO>:=
:checkudata_alive(L,2));
+	return 0;
+}
 =

 void	Iris_RegisterLuaPlugin	() {
 	=

 	class cIris_ScriptingPlugin : public cScriptingPlugin { public:
 		void	RegisterLua_GlobalFunctions	(lua_State*	L) {
+			lua_register(L,"HuffmanCompress",				l_HuffmanCompress);
+			lua_register(L,"HuffmanDecompress",				l_HuffmanDecompress);
 			lua_register(L,"BuildTerrainEntity_Simple",		l_BuildTerrainEntity_Simpl=
e);
 			lua_register(L,"BuildTerrainEntity_Shaded",		l_BuildTerrainEntity_Shade=
d);
 			lua_register(L,"TerrainRayPick",				l_TerrainRayPick);



From no-reply at zwischenwelt.org  Sun Sep  2 20:42:07 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Sep 2007 18:42:07 -0000
Subject: [Iris-commit] [IRIS] r1375 - /trunk/INSTALL
Message-ID: <20070902184207.60D961524003@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Sep  2 20:42:07 2007
New Revision: 1375

Log:
fixed compileguide for scons

Modified:
    trunk/INSTALL

Modified: trunk/INSTALL
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/INSTALL (original)
+++ trunk/INSTALL Sun Sep  2 20:42:07 2007
@@ -1,11 +1,12 @@
 :: compile ::
-sh bootstrap && sh configure && make
+scons configure && scons
+(you need scons to compile, e.g. apt-get install scons)
 =

 :: run ::
 	run start.sh in main directory =

 or
-	cd bin
-	../src/irisogre
+	./sfz =

+	=

 =

 (remove ogre.cfg if you have problems so you can change the gfx setup)
 (you might have to adjust plugins.cfg if ogre cannot find RenderSystem_GL =
Plugin_ParticleFX or scenemanagers)



From no-reply at zwischenwelt.org  Sun Sep  2 21:47:35 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Sep 2007 19:47:35 -0000
Subject: [Iris-commit] [IRIS] r1376 - in /trunk/data/lua: lib.gui.iris.lua
 lib.keybinds.lua lib.mainmenu.lua
Message-ID: <20070902194735.75F5A1524003@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Sep  2 21:47:35 2007
New Revision: 1376

Log:
chatline fixed

Modified:
    trunk/data/lua/lib.gui.iris.lua
    trunk/data/lua/lib.keybinds.lua
    trunk/data/lua/lib.mainmenu.lua

Modified: trunk/data/lua/lib.gui.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.gui.iris.lua (original)
+++ trunk/data/lua/lib.gui.iris.lua Sun Sep  2 21:47:35 2007
@@ -1,9 +1,5 @@
 gui =3D gui or {}
-gui.cur_moving_dialog_root =3D nil
 gui.bMouseBlocked =3D false
-gui.mChatLineHistory =3D {}
-gui.mChatLineHistoryIndex =3D 1
-gui.LastChatLine =3D ""
 =

 -- list of all open stats dialogs serial->dialog
 gStatusDialogs =3D {}
@@ -175,60 +171,4 @@
 	gStatusDialogs[mobile.serial] =3D nil
 end
 =

-function gui.HistoryUpDown(x)
-	if (gChatLine) then =

-		if (gChatLine.edittext =3D=3D gActiveEditText) then
-			local line =3D gui.mChatLineHistory[gui.mChatLineHistoryIndex]
-			if (line ~=3D nil) then
-				gChatLine.edittext:SetText(line)
-			end
-			gui.mChatLineHistoryIndex =3D gui.mChatLineHistoryIndex + x
-			local line =3D gui.mChatLineHistory[gui.mChatLineHistoryIndex]
-			if (line =3D=3D nil) then
-				gui.mChatLineHistoryIndex =3D gui.mChatLineHistoryIndex - x
-			end
-		end
-	end
-end
-
--- resend the last line, if its not empty
-function gui.RepeatLastChatLine ()
-	if (gui.LastChatLine ~=3D "") then =

-		Send_UnicodeSpeech(gui.LastChatLine)
-	end
-end
-
-function gui.ToggleChatLineActive ()
-	if (gChatLine) then =

-		if (gChatLine.edittext =3D=3D gActiveEditText) then
-			gChatLine.edittext:Deactivate()
-			local curtext =3D gChatLine.edittext:GetText()
-			if (curtext ~=3D "") then =

---				Send_Speech(curtext)
---	TODO : don't know where send_speech is used.
-				=

-				-- store curret line for command repeat
-				gui.LastChatLine =3D curtext
-				=

-				Send_UnicodeSpeech(curtext)
-				table.insert(gui.mChatLineHistory,1,curtext)
-			end
-			gChatLine.edittext:SetText("")
-		else
-			gChatLine.edittext:Activate()
-		end
-		gui.mChatLineHistoryIndex =3D 1
-	end
-end
-
-function gui.ChatLine()
-	-- text-input-line at the bottom of screen
-	local vw,vh =3D GetViewportSize()
-	local h =3D 18
-	local yoff =3D 12
-	local x,y,w,h =3D 0,vh-h-yoff, vw,h
-	=

-	gChatLine =3D guimaker.MyCreateDialog()
-	gChatLine.edittext =3D CreatePlainEditText(gChatLine,x,y,w,h,{0.0,0.0,0.0=
,1.0})
-	gChatLine.edittext.onReturn =3D function () end -- avoid deactivating twi=
ce or reactivating, so deactivate with ToggleChatLineActive
-end
+function SendChat (curtext) Send_UnicodeSpeech(curtext) end

Modified: trunk/data/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.keybinds.lua (original)
+++ trunk/data/lua/lib.keybinds.lua Sun Sep  2 21:47:35 2007
@@ -4,7 +4,7 @@
 	gLastCursor =3D 0
 	=

 	-- soemthing
-	Bind("return",	function (state) if (state > 0) then gui.ToggleChatLineAct=
ive() end end)
+	Bind("return",	function (state) if (state > 0) then ChatLine_ToggleActive=
() end end)
 	Bind("n",		function (state) if (not gActiveEditText) then ToggleCompass(s=
tate > 0) end end)
 	Bind("komma",	function (state) if (not gActiveEditText) then if (state > =
0) then ZoomCompass(gCompassZoomFactor) end end end)
 	Bind("point",	function (state) if (not gActiveEditText) then if (state > =
0) then ZoomCompass(1.0/gCompassZoomFactor) end end end)
@@ -68,7 +68,7 @@
 	Bind("wheeldown",	function (state) if (not gActiveEditText) then if (stat=
e > 0) then gCurrentRenderer:CamChangeZoom(-0.3) end end end)
 	=

 	-- repeat last command
-	Bind("g",		function (state) if (not gActiveEditText) then if (state > 0) =
then gui.RepeatLastChatLine() end end end)
+	Bind("g",		function (state) if (not gActiveEditText) then if (state > 0) =
then ChatLine_RepeatLast() end end end)
 	Bind("h",		function (state) if (not gActiveEditText) then if (state > 0) =
then RepeatLastDoubleClick() end end end)
 	=

 	-- select commands

Modified: trunk/data/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.mainmenu.lua (original)
+++ trunk/data/lua/lib.mainmenu.lua Sun Sep  2 21:47:35 2007
@@ -44,7 +44,7 @@
 	=

 	-- todo : move to gui ?
 	gDialog_IrisLogo:SetVisible(false)
-	gui.ChatLine()	=

+	ChatLine_Init()	=

 	=

 	gNet_State =3D NetConnectWithKey(gLoginServerIP,gLoginServerPort,gServerS=
eed)
 	if (not gNet_State) then =




From no-reply at zwischenwelt.org  Mon Sep  3 21:10:58 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 03 Sep 2007 19:10:58 -0000
Subject: [Iris-commit] [IRIS] r1377 - in /trunk: bin/iris2.exe
 data/lua/lib.gui.iris.lua data/lua/lib.gumpparser.lua
 data/skippedfallbacks.lua
Message-ID: <20070903191058.C965B1C18122@zwischenwelt.org>

Author: sience
Date: Mon Sep  3 21:10:58 2007
New Revision: 1377

Log:
-new binary
-some minor changes

Modified:
    trunk/bin/iris2.exe
    trunk/data/lua/lib.gui.iris.lua
    trunk/data/lua/lib.gumpparser.lua
    trunk/data/skippedfallbacks.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/lua/lib.gui.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.gui.iris.lua (original)
+++ trunk/data/lua/lib.gui.iris.lua Mon Sep  3 21:10:58 2007
@@ -8,7 +8,7 @@
 function GuiInit ()
 	-- create player status
 	if GetPlayerMobile() then =

-		print("########## GUI INIT")
+		print("########## Open Status")
 		OpenStatus(GetPlayerMobile(),0,0) =

 	end
 end

Modified: trunk/data/lua/lib.gumpparser.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.gumpparser.lua (original)
+++ trunk/data/lua/lib.gumpparser.lua Mon Sep  3 21:10:58 2007
@@ -198,7 +198,7 @@
 				--checkertrans <x> <y> <width> <height>
 				--Description:  Creates a transparent rectangle on position <x,y> usin=
g <width> and <height>.
 				elseif ((command =3D=3D "checkertrans") and (table.getn(bToken)>=3D 5)=
) then
-					print("todo - checkertrans")
+					--print("todo - checkertrans")
 				--text <x> <y> <hue> <textline-id>
 				--Description:  Defines the position and color of a text (data) entry.
 				-- TODO : HUE-color

Modified: trunk/data/skippedfallbacks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/skippedfallbacks.lua (original)
+++ trunk/data/skippedfallbacks.lua Mon Sep  3 21:10:58 2007
@@ -358,3 +358,5 @@
 RegisterSkippedArtBillboardFallBack(1118) -- 0x045e name=3Dfireplace
 RegisterSkippedArtBillboardFallBack(7235) -- 0x1c43 name=3Dcoffin
 RegisterSkippedArtBillboardFallBack(7233) -- 0x1c41 name=3Dcoffin
+RegisterSkippedArtBillboardFallBack(2629) -- 0x0a45 name=3Ddresser
+RegisterSkippedArtBillboardFallBack(2621) -- 0x0a3d name=3Ddresser



From no-reply at zwischenwelt.org  Mon Sep  3 21:21:27 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 03 Sep 2007 19:21:27 -0000
Subject: [Iris-commit] [IRIS] r1378 - in /trunk/cb: iris 7.1.cbp iris2.cbp
Message-ID: <20070903192127.81D171C18122@zwischenwelt.org>

Author: sience
Date: Mon Sep  3 21:21:27 2007
New Revision: 1378

Log:
-name changed for codeblocks project file

Added:
    trunk/cb/iris2.cbp
Removed:
    trunk/cb/iris 7.1.cbp



From no-reply at zwischenwelt.org  Tue Sep  4 21:45:07 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 04 Sep 2007 19:45:07 -0000
Subject: [Iris-commit] [IRIS] r1379 - /trunk/data/lua/lib.keybinds.lua
Message-ID: <20070904194508.0663C1524003@zwischenwelt.org>

Author: sience
Date: Tue Sep  4 21:45:07 2007
New Revision: 1379

Log:
-screenshots fixed

Modified:
    trunk/data/lua/lib.keybinds.lua

Modified: trunk/data/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.keybinds.lua (original)
+++ trunk/data/lua/lib.keybinds.lua Tue Sep  4 21:45:07 2007
@@ -19,8 +19,8 @@
 		end =

 		end =

 	end)
-	Bind("v",		function (state) if (not gActiveEditText) then if (state > 0) =
then Client_TakeScreenshot() end end end)
-	Bind("f12",		function (state) if (not gActiveEditText) then if (state > 0=
) then Client_TakeGridScreenshot() end end end)
+	Bind("v",		function (state) if (not gActiveEditText) then if (state > 0) =
then Client_TakeScreenshot(gMainWorkingDir.."screenshots/") end end end)
+	Bind("f12",		function (state) if (not gActiveEditText) then if (state > 0=
) then Client_TakeGridScreenshot(gMainWorkingDir.."screenshots/") end end e=
nd)
 	=

 	Bind("f2",		function (state) if (not gActiveEditText) then if (state > 0)=
 then =

 		local mobile =3D GetPlayerMobile()



From no-reply at zwischenwelt.org  Mon Sep 10 19:58:23 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 10 Sep 2007 17:58:23 -0000
Subject: [Iris-commit] [IRIS] r1380 - /trunk/data/lua/main.lua
Message-ID: <20070910175823.F20621524003@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Sep 10 19:58:22 2007
New Revision: 1380

Log:
lugre_detect_ogre_plugin_path used in InitOgre now

Modified:
    trunk/data/lua/main.lua

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Mon Sep 10 19:58:22 2007
@@ -224,15 +224,9 @@
 	=

 	gMyTicks =3D Client_GetTicks()
 	=

-	-- register pixel format constants, like PF_FLOAT16_R
-	if (OgrePixelFormatList) then
-		local mylist =3D OgrePixelFormatList()
-		for id,name in pairs(mylist) do _G[name] =3D id end
-	end
-	=

 	LoadingProfile("initializing Ogre",true)
 	gPreOgreTime =3D gLoadingProfileLastTime
-	if (not InitOgre("Iris2")) then Exit() end
+	if (not InitOgre("Iris2",lugre_detect_ogre_plugin_path())) then Exit() end
 	SetCursorBaseOffset(0,0)
 =

 	-- set global shadow settings



From no-reply at zwischenwelt.org  Wed Sep 12 14:08:04 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 12 Sep 2007 12:08:04 -0000
Subject: [Iris-commit] [IRIS] r1381 - /trunk/README
Message-ID: <20070912120804.611271524003@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Sep 12 14:08:03 2007
New Revision: 1381

Log:
added fmod notice

Modified:
    trunk/README

Modified: trunk/README
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/README (original)
+++ trunk/README Wed Sep 12 14:08:03 2007
@@ -84,6 +84,13 @@
 Sebastian Dorda (hagish)
 R=C3=BCdiger Pakmor (Varan)
 =

+=3D=3D=3D license =3D=3D=3D
+
+see COPYING for license of our code
+
+FMOD Sound System, copyright =C2=A9 Firelight Technologies Pty, Ltd., 1994=
-2007.
+http://www.fmod.org/index.php/sales
+
 =3D=3D=3D debug mode =3D=3D=3D
 a : show first model and anim =

 =




From no-reply at zwischenwelt.org  Thu Sep 13 00:55:21 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 12 Sep 2007 22:55:21 -0000
Subject: [Iris-commit] [IRIS] r1382 - in /trunk: README bin/iris2.exe
 cb/iris2.cbp data/lua/net.login.lua
Message-ID: <20070912225522.25E831524003@zwischenwelt.org>

Author: sience
Date: Thu Sep 13 00:55:21 2007
New Revision: 1382

Log:
-login problem with Sphere fixed (prob. also Pol fixed now)
-codeblocks project updated
-readme mod. a little

Modified:
    trunk/README
    trunk/bin/iris2.exe
    trunk/cb/iris2.cbp
    trunk/data/lua/net.login.lua

Modified: trunk/README
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/README (original)
+++ trunk/README Thu Sep 13 00:55:21 2007
@@ -78,12 +78,6 @@
 -g path/to/grannyfile.grn		: prints granny dump
 -gb path/to/grannyfile.grn		: prints granny bone info
 =

-=3D=3D developer =3D=3D
-Florian Fischer (SiENcE) =

-Robert Noll (Ghoulsblade) =

-Sebastian Dorda (hagish)
-R=C3=BCdiger Pakmor (Varan)
-
 =3D=3D=3D license =3D=3D=3D
 =

 see COPYING for license of our code
@@ -140,6 +134,12 @@
 =3D=3D=3D code documentation =3D=3D=3D
 doxygen syntax has been used, might be interesting to generate documentati=
on from the sourcecode
 =

+=3D=3D developer =3D=3D
+Florian Fischer (SiENcE) =

+Robert Noll (Ghoulsblade) =

+Sebastian Dorda (hagish)
+R=C3=BCdiger Pakmor (Varan)
+
 visit our wiki/website and forum at 	http://www.iris2.de/
 =

 =3D=3D=3D other projects of the iris-ogre-developers =3D=3D=3D

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/cb/iris2.cbp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/cb/iris2.cbp (original)
+++ trunk/cb/iris2.cbp Thu Sep 13 00:55:21 2007
@@ -33,6 +33,7 @@
 					<Add library=3D"..\libs\lua\LibLuaLib.lib" />
 					<Add library=3D"..\libs\zlib\libz.a" />
 					<Add library=3D"libode.a" />
+					<Add library=3D"libboost_thread.a" />
 					<Add directory=3D"$(OGRE_HOME)\bin\release" />
 					<Add directory=3D"..\libs" />
 					<Add directory=3D"..\libs\fmodx" />
@@ -40,6 +41,7 @@
 					<Add directory=3D"..\libs\sdl" />
 					<Add directory=3D"..\libs\zlib" />
 					<Add directory=3D"$(OGRE_HOME)\Lib" />
+					<Add directory=3D"..\libs\boost" />
 				</Linker>
 			</Target>
 			<Target title=3D"Debug">
@@ -93,6 +95,7 @@
 			<Add option=3D"-D_WINDOWS" />
 			<Add option=3D"-DMINGW" />
 			<Add option=3D'-DMAIN_WORKING_DIR=3D&quot;../&quot;' />
+			<Add option=3D"-DUSE_SDL_TIMER" />
 			<Add directory=3D"..\include" />
 			<Add directory=3D"$(OGRE_HOME)\include" />
 			<Add directory=3D"$(OGRE_HOME)\include\ois" />
@@ -100,7 +103,7 @@
 			<Add directory=3D"..\include\lua" />
 			<Add directory=3D"..\include\sdl" />
 			<Add directory=3D"..\include\zlib" />
-			<Add directory=3D"C:\Programme\Boost\include\boost-1_34" />
+			<Add directory=3D"..\include\boost" />
 			<Add directory=3D"..\lugre\include" />
 		</Compiler>
 		<Linker>
@@ -174,7 +177,6 @@
 		<Unit filename=3D"..\lugre\src\lugre_beam_L.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_bitmask.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_bitmask_L.cpp" />
-		<Unit filename=3D"..\lugre\src\lugre_camera.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_camera_L.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_fifo_L.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_game.cpp" />
@@ -195,7 +197,6 @@
 		<Unit filename=3D"..\lugre\src\lugre_profile.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_random.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_random_L.cpp" />
-		<Unit filename=3D"..\lugre\src\lugre_rendertexture.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_rendertexture_L.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_robrenderable.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_robstring.cpp" />
@@ -208,7 +209,6 @@
 		<Unit filename=3D"..\lugre\src\lugre_sound_fmod.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_timer.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_transform_mesh.cpp" />
-		<Unit filename=3D"..\lugre\src\lugre_viewport.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_viewport_L.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_widget.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_widget_L.cpp" />

Modified: trunk/data/lua/net.login.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.login.lua (original)
+++ trunk/data/lua/net.login.lua Thu Sep 13 00:55:21 2007
@@ -84,7 +84,7 @@
 	printdebug("login",sprintf("DEBUG IP STRINGS %s <> %s\n",NtoA(gGameServer=
IP),GetHostByName(gLoginServerIP)))
 =

 	-- login & gameserver are not the same: redirect is received
-	if ((NtoA(gGameServerIP) ~=3D GetHostByName(gLoginServerIP)) or (gGameSer=
verPort ~=3D gLoginServerPort)) then
+	if ((gServerType[gServerEmulator] =3D=3D "SpherePolUox3") or (NtoA(gGameS=
erverIP) ~=3D GetHostByName(gLoginServerIP)) or (gGameServerPort ~=3D gLogi=
nServerPort)) then
 		--disconnect from Loginserver
 		printdebug("login","NET: disconnect from loginserver")
 		NetDisconnect()



From no-reply at zwischenwelt.org  Thu Sep 13 00:58:34 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 12 Sep 2007 22:58:34 -0000
Subject: [Iris-commit] [IRIS] r1383 - /trunk/data/lua/gui/gui.paperdoll.lua
Message-ID: <20070912225834.907091524003@zwischenwelt.org>

Author: sience
Date: Thu Sep 13 00:58:33 2007
New Revision: 1383

Log:
-logoutwindow assigned

Modified:
    trunk/data/lua/gui/gui.paperdoll.lua

Modified: trunk/data/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/gui/gui.paperdoll.lua (original)
+++ trunk/data/lua/gui/gui.paperdoll.lua Thu Sep 13 00:58:33 2007
@@ -144,8 +144,7 @@
 														end
 			dialog.controls["btn_quit"].onMouseDown =3D function (widget,mousebutto=
n)
 															if (mousebutton =3D=3D 1) then
-																print("logout, terminating client")
-																Exit()
+																OpenQuit()
 															end
 														end
 			dialog.controls["btn_scroll"].onMouseDown =3D function (widget,mousebut=
ton)



From no-reply at zwischenwelt.org  Sat Sep 15 02:26:03 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Sep 2007 00:26:03 -0000
Subject: [Iris-commit] [IRIS] r1384 - /trunk/data/lua/main.lua
Message-ID: <20070915010014.7186A152400B@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Sep 15 02:26:03 2007
New Revision: 1384

Log:
some steppers moved to lugre

Modified:
    trunk/data/lua/main.lua

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Sat Sep 15 02:26:03 2007
@@ -201,7 +201,7 @@
 end
 =

 --- main function, when it returns, the program ends
-function Main ()
+function Main ()	=

 	local luaversion =3D string.sub(_VERSION, 5, 7)
 	print("Lua version : "..luaversion)
 	=

@@ -269,9 +269,7 @@
 	--TestGuiSystem3_Init()
 	=

 	-- mainloop
-	while (Client_IsAlive()) do
-		MainStep(Client_GetTicks())
-	end
+	while (Client_IsAlive()) do MainStep() end
 end
 =

 =

@@ -297,13 +295,8 @@
 end
 =

 -- called every frame, after all timer-steppers, see Step() in lib.time.lua
-function MainStep (curticks)
-	gSecondsSinceLastFrame =3D (curticks - gMyTicks) / 1000.0
-	gMyTicks =3D curticks
-	UpdateStats(curticks)
-	StepTimer(curticks)
-	StepFadeLines()
-	gui.StepMoveDialog()
+function MainStep ()
+	LugreStep()
 	--TestGuiSystem2_Step()
 =

 	NetStep()



From no-reply at zwischenwelt.org  Sat Sep 15 11:43:45 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Sep 2007 09:43:45 -0000
Subject: [Iris-commit] [IRIS] r1385 - in /trunk/bin: SDL.dll iris2.exe
Message-ID: <20070915094346.017671524003@zwischenwelt.org>

Author: sience
Date: Sat Sep 15 11:43:44 2007
New Revision: 1385

Log:
-new binary, sdl  is now removed

Removed:
    trunk/bin/SDL.dll
Modified:
    trunk/bin/iris2.exe

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Sat Sep 15 12:12:06 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Sep 2007 10:12:06 -0000
Subject: [Iris-commit] [IRIS] r1386 - /trunk/cb/iris2.cbp
Message-ID: <20070915101207.341131524003@zwischenwelt.org>

Author: sience
Date: Sat Sep 15 12:12:06 2007
New Revision: 1386

Log:
-project updated

Modified:
    trunk/cb/iris2.cbp

Modified: trunk/cb/iris2.cbp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/cb/iris2.cbp (original)
+++ trunk/cb/iris2.cbp Sat Sep 15 12:12:06 2007
@@ -27,21 +27,12 @@
 					<Add library=3D"ws2_32" />
 					<Add library=3D"OgreMain" />
 					<Add library=3D"OIS" />
-					<Add library=3D"..\libs\sdl\SDL.lib" />
 					<Add library=3D"..\libs\fmodx\libfmodex.a" />
 					<Add library=3D"..\libs\lua\LibLua.lib" />
 					<Add library=3D"..\libs\lua\LibLuaLib.lib" />
 					<Add library=3D"..\libs\zlib\libz.a" />
-					<Add library=3D"libode.a" />
-					<Add library=3D"libboost_thread.a" />
 					<Add directory=3D"$(OGRE_HOME)\bin\release" />
-					<Add directory=3D"..\libs" />
-					<Add directory=3D"..\libs\fmodx" />
-					<Add directory=3D"..\libs\lua" />
-					<Add directory=3D"..\libs\sdl" />
-					<Add directory=3D"..\libs\zlib" />
 					<Add directory=3D"$(OGRE_HOME)\Lib" />
-					<Add directory=3D"..\libs\boost" />
 				</Linker>
 			</Target>
 			<Target title=3D"Debug">
@@ -95,15 +86,12 @@
 			<Add option=3D"-D_WINDOWS" />
 			<Add option=3D"-DMINGW" />
 			<Add option=3D'-DMAIN_WORKING_DIR=3D&quot;../&quot;' />
-			<Add option=3D"-DUSE_SDL_TIMER" />
 			<Add directory=3D"..\include" />
 			<Add directory=3D"$(OGRE_HOME)\include" />
 			<Add directory=3D"$(OGRE_HOME)\include\ois" />
 			<Add directory=3D"..\include\fmodx" />
 			<Add directory=3D"..\include\lua" />
-			<Add directory=3D"..\include\sdl" />
 			<Add directory=3D"..\include\zlib" />
-			<Add directory=3D"..\include\boost" />
 			<Add directory=3D"..\lugre\include" />
 		</Compiler>
 		<Linker>



From no-reply at zwischenwelt.org  Sat Sep 15 12:19:53 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Sep 2007 10:19:53 -0000
Subject: [Iris-commit] [IRIS] r1387 - /trunk/vc8/iris.vcproj
Message-ID: <20070915101953.7F5511524003@zwischenwelt.org>

Author: sience
Date: Sat Sep 15 12:19:52 2007
New Revision: 1387

Log:
-vs8 project updated

Modified:
    trunk/vc8/iris.vcproj

Modified: trunk/vc8/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vc8/iris.vcproj (original)
+++ trunk/vc8/iris.vcproj Sat Sep 15 12:19:52 2007
@@ -124,7 +124,7 @@
 				OmitFramePointers=3D"true"
 				EnableFiberSafeOptimizations=3D"false"
 				WholeProgramOptimization=3D"true"
-				AdditionalIncludeDirectories=3D"&quot;C:\Programme\Microsoft Platform =
SDK\Include\&quot;;&quot;$(OGRE_HOME)\include\&quot;;&quot;$(OGRE_HOME)\inc=
lude\OIS\&quot;;..\include\;..\include\boost;..\include\zlib;..\include\fmo=
dx;..\include\sdl;..\include\lua"
+				AdditionalIncludeDirectories=3D"&quot;C:\Programme\Microsoft Platform =
SDK\Include\&quot;;&quot;$(OGRE_HOME)\include\&quot;;&quot;$(OGRE_HOME)\inc=
lude\OIS\&quot;;..\include\;..\include\zlib;..\include\fmodx;..\include\lua=
;..\lugre\include"
 				PreprocessorDefinitions=3D"WIN32"
 				RuntimeLibrary=3D"0"
 				EnableEnhancedInstructionSet=3D"1"
@@ -147,7 +147,7 @@
 				Name=3D"VCLinkerTool"
 				AdditionalDependencies=3D"LIBCMT.lib LIBCPMT.LIB AdvAPI32.Lib User32.L=
ib zlib.lib ws2_32.lib LibLua+CRT.lib LibLuaLib+CRT.lib OgreMain.lib SDL.li=
b OIS.lib fmodex_vc.lib"
 				OutputFile=3D"$(OutDir)\..\..\bin\iris2.exe"
-				AdditionalLibraryDirectories=3D"&quot;C:\Programme\Microsoft Platform =
SDK\Lib\&quot;;&quot;$(OGRE_HOME)\lib\&quot;;..\libs\fmodx;..\libs\zlib;..\=
libs\sdl;..\libs\lua"
+				AdditionalLibraryDirectories=3D"&quot;C:\Programme\Microsoft Platform =
SDK\Lib\&quot;;&quot;$(OGRE_HOME)\lib\&quot;;..\libs\fmodx;..\libs\zlib;..\=
libs\lua"
 				GenerateManifest=3D"true"
 				IgnoreAllDefaultLibraries=3D"true"
 				IgnoreDefaultLibraryNames=3D""
@@ -192,18 +192,6 @@
 			UniqueIdentifier=3D"{4FC737F1-C7A5-4376-A066-2A32D752A2FF}"
 			>
 			<File
-				RelativePath=3D"..\src\bitmask.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\bitmask_L.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\BorderColourClipPaneOverlay.cpp"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\src\builder.cpp"
 				>
 			</File>
@@ -212,26 +200,6 @@
 				>
 			</File>
 			<File
-				RelativePath=3D"..\src\camera.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\camera_L.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\ColourClipPaneOverlay.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\ColourClipTextOverlay.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\CompassOverlay.cpp"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\src\data.cpp"
 				>
 			</File>
@@ -240,30 +208,6 @@
 				>
 			</File>
 			<File
-				RelativePath=3D"..\src\fifo_L.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\game.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\gfx2D.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\gfx2D_L.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\gfx3D.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\gfx3D_L.cpp"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\src\granny_L.cpp"
 				>
 			</File>
@@ -288,42 +232,14 @@
 				>
 			</File>
 			<File
-				RelativePath=3D"..\src\input.cpp"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\src\legacydata.cpp"
 				>
 			</File>
 			<File
-				RelativePath=3D"..\src\listener.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\luaxml.cpp"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\src\main.cpp"
 				>
 			</File>
 			<File
-				RelativePath=3D"..\src\material_L.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\meshshape.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\net.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\net_L.cpp"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\src\ogremanualloader.cpp"
 				>
 			</File>
@@ -332,10 +248,6 @@
 				>
 			</File>
 			<File
-				RelativePath=3D"..\src\ogrewrapper.cpp"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\src\pathsearch.cpp"
 				>
 			</File>
@@ -344,10 +256,6 @@
 				>
 			</File>
 			<File
-				RelativePath=3D"..\src\profile.cpp"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\src\radar.cpp"
 				>
 			</File>
@@ -356,47 +264,7 @@
 				>
 			</File>
 			<File
-				RelativePath=3D"..\src\rendertexture.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\rendertexture_L.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\robrenderable.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\RobRenderableOverlay.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\robstring1.2.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\scripting.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\shell.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\SortedOverlayContainer.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\sound.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\sound_fmod.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\sound_L.cpp"
+				RelativePath=3D"..\src\scripting.iris.cpp"
 				>
 			</File>
 			<File
@@ -409,42 +277,6 @@
 			</File>
 			<File
 				RelativePath=3D"..\src\terrain.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\timer.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\tinystr.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\tinyxml.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\tinyxmlerror.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\tinyxmlparser.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\viewport.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\viewport_L.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\widget.cpp"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\src\widget_L.cpp"
 				>
 			</File>
 		</Filter>
@@ -454,54 +286,14 @@
 			UniqueIdentifier=3D"{93995380-89BD-4b04-88EB-625FBE52EBFB}"
 			>
 			<File
-				RelativePath=3D"..\include\bitmask.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\BorderColourClipPaneOverlay.h"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\include\builder.h"
 				>
 			</File>
 			<File
-				RelativePath=3D"..\include\camera.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\ColourClipPaneOverlay.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\ColourClipTextOverlay.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\CompassOverlay.h"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\include\data.h"
 				>
 			</File>
 			<File
-				RelativePath=3D"..\include\fifo.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\game.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\gfx2D.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\gfx3D.h"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\include\grannyloader_i2.h"
 				>
 			</File>
@@ -518,119 +310,27 @@
 				>
 			</File>
 			<File
-				RelativePath=3D"..\include\input.h"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\include\legacydata.h"
 				>
 			</File>
 			<File
-				RelativePath=3D"..\include\listener.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\luabind.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\luaxml.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\meshshape.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\net.h"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\include\ogremanualloader.h"
 				>
 			</File>
 			<File
-				RelativePath=3D"..\include\ogrewrapper.h"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\include\pathsearch.h"
 				>
 			</File>
 			<File
-				RelativePath=3D"..\include\prefix.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\profile.h"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\include\radar.h"
 				>
 			</File>
 			<File
-				RelativePath=3D"..\include\rendertexture.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\robrenderable.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\RobRenderableOverlay.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\robstring1.2.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\scripting.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\shell.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\smartptr.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\SortedOverlayContainer.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\sound.h"
-				>
-			</File>
-			<File
 				RelativePath=3D"..\include\spritemanager.h"
 				>
 			</File>
 			<File
 				RelativePath=3D"..\include\terrain.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\timer.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\tinystr.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\tinyxml.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\viewport.h"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\include\widget.h"
 				>
 			</File>
 		</Filter>
@@ -639,6 +339,434 @@
 			>
 			<File
 				RelativePath=3D".\res\resource.rc"
+				>
+			</File>
+		</Filter>
+		<Filter
+			Name=3D"lugre_src"
+			>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_beam.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_beam_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_bitmask.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_bitmask_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_BorderColourClipPaneOverlay.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_camera_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_ColourClipPaneOverlay.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_ColourClipTextOverlay.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_CompassOverlay.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_fifo_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_game.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_gfx2D.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_gfx2D_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_gfx3D.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_gfx3D_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_input.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_listener.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_luaxml.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_main.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_material_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_meshshape.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_net.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_net_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_ode.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_ogrewrapper.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_profile.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_random.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_random_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_rendertexture_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_robrenderable.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_RobRenderableOverlay.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_robstring.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_scripting.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_scripting.general.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_scripting.ogre.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_shell.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_SortedOverlayContainer.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_sound.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_sound_fmod.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_sound_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_timer.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_transform_mesh.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_viewport_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_widget.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_widget_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\tinystr.cpp"
+				>
+				<FileConfiguration
+					Name=3D"Debug|Win32"
+					>
+					<Tool
+						Name=3D"VCCLCompilerTool"
+						ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
+						XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
+					/>
+				</FileConfiguration>
+				<FileConfiguration
+					Name=3D"Release|Win32"
+					>
+					<Tool
+						Name=3D"VCCLCompilerTool"
+						ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
+						XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
+					/>
+				</FileConfiguration>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\tinyxml.cpp"
+				>
+				<FileConfiguration
+					Name=3D"Debug|Win32"
+					>
+					<Tool
+						Name=3D"VCCLCompilerTool"
+						ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
+						XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
+					/>
+				</FileConfiguration>
+				<FileConfiguration
+					Name=3D"Release|Win32"
+					>
+					<Tool
+						Name=3D"VCCLCompilerTool"
+						ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
+						XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
+					/>
+				</FileConfiguration>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\tinyxmlerror.cpp"
+				>
+				<FileConfiguration
+					Name=3D"Debug|Win32"
+					>
+					<Tool
+						Name=3D"VCCLCompilerTool"
+						ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
+						XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
+					/>
+				</FileConfiguration>
+				<FileConfiguration
+					Name=3D"Release|Win32"
+					>
+					<Tool
+						Name=3D"VCCLCompilerTool"
+						ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
+						XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
+					/>
+				</FileConfiguration>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\tinyxmlparser.cpp"
+				>
+				<FileConfiguration
+					Name=3D"Debug|Win32"
+					>
+					<Tool
+						Name=3D"VCCLCompilerTool"
+						ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
+						XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
+					/>
+				</FileConfiguration>
+				<FileConfiguration
+					Name=3D"Release|Win32"
+					>
+					<Tool
+						Name=3D"VCCLCompilerTool"
+						ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
+						XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
+					/>
+				</FileConfiguration>
+			</File>
+		</Filter>
+		<Filter
+			Name=3D"lugre_includes"
+			>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_beam.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_bitmask.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_BorderColourClipPaneOverlay.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_camera.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_ColourClipPaneOverlay.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_ColourClipTextOverlay.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_CompassOverlay.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_fifo.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_game.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_gfx2D.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_gfx3D.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_input.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_listener.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_luabind.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_luaxml.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_main.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_meshshape.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_net.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_ode.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_ogrefonthelper.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_ogrewrapper.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_prefix.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_profile.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_random.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_rendertexture.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_robrenderable.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_RobRenderableOverlay.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_robstring.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_scripting.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_shell.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_smartptr.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_SortedOverlayContainer.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_sound.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_timer.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_viewport.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\lugre_widget.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\tinystr.h"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\include\tinyxml.h"
 				>
 			</File>
 		</Filter>



From no-reply at zwischenwelt.org  Sat Sep 15 15:55:15 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Sep 2007 13:55:15 -0000
Subject: [Iris-commit] [IRIS] r1388 - in /trunk/data: config.lua.dist
 lua/lib.charcreate.lua lua/lib.gui.iris.lua lua/lib.mainmenu.lua
 lua/lib.uoids.lua lua/main.lua
Message-ID: <20070915135516.0656E1524003@zwischenwelt.org>

Author: sience
Date: Sat Sep 15 15:55:15 2007
New Revision: 1388

Log:
-memorydisplay fixed
-comments removed (to wiki)
-charcreation fixed
-back button for wrong serverlogin added
-uo version string updated

Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/lib.charcreate.lua
    trunk/data/lua/lib.gui.iris.lua
    trunk/data/lua/lib.mainmenu.lua
    trunk/data/lua/lib.uoids.lua
    trunk/data/lua/main.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Sep 15 15:55:15 2007
@@ -4,7 +4,7 @@
 =

 =

 -- Client Identification String
-gClientVersion =3D "6.0.1.4"  -- try other version for example "4.0.11c5"
+gClientVersion =3D "6.0.2.0"  -- try other version for example "4.0.11c5"
 =

 gUseNewModelLoader =3D true -- use old (models.uim) or new (many mesh file=
s) model loader
 =


Modified: trunk/data/lua/lib.charcreate.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.charcreate.lua (original)
+++ trunk/data/lua/lib.charcreate.lua Sat Sep 15 15:55:15 2007
@@ -1,7 +1,7 @@
 -- handles char creation, and loading of char templates from uo/Prof.txt
 -- see also MainMenuShowCharList in lib.mainmenu.lua
 -- see also oldiris:startup.csl
--- kPacket_CharacterCreation 			=3D { id=3Dhex2num("0x00") }
+-- kPacket_CharacterCreation
 -- kPacket_Account_Delete_Character ?
 -- kPacket_Change_Character_Password ?
 -- kPacket_Delete_Character_Failed ?
@@ -30,8 +30,6 @@
 	--print(vardump2(chardata))
 	SendCharCreate(chardata)
 	return true
-	--PlainMessageBox(" I TOLD YOU IT WAS NOT IMPLEMENTED YET =3DP")
-	--return false
 end
 =

 function GetCharCreationTemplates () =

@@ -55,28 +53,9 @@
 			elseif (tokens[2] =3D=3D "Stat")	then lastinfo.stats[trim(tokens[3])] =
=3D val
 			else lastinfo[trim(tokens[2])] =3D trim(tokens[3]) end
 		end
-		--[[
-		Begin
-			Name			Warrior
-			TrueName		"Warrior"
-			NameId			1061180
-			DescId			1061230
-			Desc			1
-			TopLevel		true
-			Gump			5577
-			Type			Profession
-			Skill			Tactics			50
-			Skill			Healing			45
-			Skill			Swordsmanship		5
-			Stat			Str			35
-			Stat			Dex			35
-			Stat			Int			10
-		End
-		]]--
 	end
 	return profinfo
 end
-
 =

 -- send characterselect to gameserver
 function SendCharCreate(chardata)
@@ -130,147 +109,11 @@
 	chardata.hairColor		=3D hex2num("0x044E") -- 0x044E(human) 0x0034(elf)
 	chardata.facialHair		=3D hex2num("0x0000")
 	chardata.facialHairColor=3D hex2num("0x0000")
-	chardata.location		=3D hex2num("0x0003")
+	chardata.location		=3D hex2num("0x0000")
 	--out:PushNetUint16(hex2num("0x0000"))
 	chardata.slot			=3D hex2num("0x0003")
 	--	out:PushNetUint32(gServerSeed) -- The user's gameplay encryption key ?=
 clientIP ?
-	chardata.shirtColor		=3D hex2num("0x0083")
-	chardata.pantsColor		=3D hex2num("0x01AC")
-	--[[
-	male elf named "mager" =

-	17:39:19.406 Client -> Server: 0x00 (CreateCharacter), frequ: 1, len: 0x68
-	0000: 00 ED ED ED  ED FF FF FF  FF 00_4D 61  67 65 72 00 ->..........Mage=
r.
-	0010: 79 65 72 00  00 00 00 00  00 00 00 00  00 00 00 00 ->yer...........=
..
-	0020: 00 00 00 00  00 00 00 00_ 00 00 00 00  00 1F 00 00 ->..............=
..
-	0030: 00 01 00 00  00 C2 02 00  00 00 00 00  00 00 00 00 ->..............=
..
-	0040: 00 00 00 00  00 00_02 19  0A 2D 19 32  2E 32 2B 00_->.........-.2.2=
+.
-	0050: 00 BF 2F C1  00 34 00 00  00 00 00 03  00 00 00 03 ->../..4........=
..
-	0060: C0 A8 30 16  00 83 01 AC                           ->..0.....
-	]]--
+	chardata.shirtColor		=3D hex2num("0x036F") --hex2num("0x0083")
+	chardata.pantsColor		=3D hex2num("0x0111") --hex2num("0x01AC")
 	return chardata
 end
-
---[[
-btbn tipps : wolfpack source
-haircolor human : return ( ( color >=3D 0x44E ) && ( color <=3D 0x47D ) ) =
? true : false;
-haircolor elf : if ( ( color >=3D 0x34 ) && ( color <=3D 0x39 ) )
-
- skin color human : return ( ( color >=3D 0x3EA ) && ( color <=3D 0x422 ) =
) ? true : false;
-
-inline bool isHairsByRace( quint16 model, bool race )
-{
-    if (!race)    // Human's Hairs
-    {
-        return    ( ( ( model >=3D 0x203B ) && ( model <=3D 0x203D ) ) || =
( ( model >=3D 0x2044 ) && ( model <=3D 0x204A ) ) ) ? true : false;
-    }
-    else        // Elf's Hairs
-    {
-        return  ( ( ( model >=3D 0x2fbf ) && ( model <=3D 0x2fc2 ) ) || ( =
( model >=3D 0x2fcc ) && ( model <=3D 0x2fd1 ) ) ) ? true : false;
-    }
-}
-
-inline bool isHairsByRaceColor( quint16 color, bool race )
-{
-    if (!race)    // Human's Hairs
-    {
-        return ( ( color >=3D 0x44E ) && ( color <=3D 0x47D ) ) ? true : f=
alse;
-    }
-    else        // Elf's Hairs
-    {
-        // Line 1 of Colors
-        if ( ( color >=3D 0x34 ) && ( color <=3D 0x39 ) )
-            return true;
-        // Line 2 of Colors
-        else if ( ( color =3D=3D 0x101 ) || ( color =3D=3D 0x6b8 ) || ( co=
lor =3D=3D 0x207 ) || ( color =3D=3D 0x211 ) || ( color =3D=3D 0x26c ) || (=
 color =3D=3D 0x2c3 ) )
-            return true;
-        // Line 3 of Colors
-        else if ( ( color =3D=3D 0x2c9 ) || ( color =3D=3D 0x1e4 ) || ( co=
lor =3D=3D 0x239 ) || ( color =3D=3D 0x369 ) || ( color =3D=3D 0x59d ) || (=
 color =3D=3D 0x853 ) )
-            return true;
-        // Line 4 of Colors
-        else if ( ( ( color >=3D 0x8e ) && ( color <=3D 0x92 ) ) || ( colo=
r =3D=3D 0x159 ) )
-            return true;
-        // Line 5 of Colors
-        else if ( ( ( color >=3D 0x15a ) && ( color <=3D 0x15e ) ) || ( co=
lor =3D=3D 0x1bd ) )
-            return true;
-        // Line 6 of Colors
-        else if ( ( color =3D=3D 0x725 ) || ( color =3D=3D 0x58 ) || ( col=
or =3D=3D 0x128 ) || ( color =3D=3D 0x12f ) || ( color =3D=3D 0x1f3 ) || ( =
color =3D=3D 0x251 ) )
-            return true;
-        // Last Lines
-        else if ( ( ( color >=3D 0x31d ) && ( color <=3D 0x322 ) ) || ( ( =
color >=3D 0x323 ) && ( color <=3D 0x326 ) ) || ( ( color >=3D 0x386 ) && (=
 color <=3D 0x38a ) ) )
-            return true;
-        else
-            return false;
-    }
-}
-]]--
-	=

---[[
-Note: Client Message
-Note: pattern3 is set to 0xFF to early signal a Krrios' client user, where=
 it expects a 0xF0 | 0x00 before login confirm
-Notes:
-Str, dex and int should always sum to 65.
-Str, dex and int should always be between 10 and 45, inclusive.
-Skill1, skill2, and skill3 should never be the same value.
-Skill1, skill2, and skill3 should always be between 0 and 45, inclusive.
-Skill1value, skill2value, and skill3value should always sum to 100.
-Skill1value, skill2value, and skill3value should always be between 0 and 5=
0, inclusive.
-SkinColor should always be between 0x3EA and 0x422, exclusive.
-HairColor and facialHairColor should always be between 0x44E and 0x4AD, ex=
clusive.
-HairStyle should be between 0x203B and 0x204A, exclusive, and it should al=
so exclude 0x203D to 0x2044, exclusive.
-FacialHairStyle should be between 0x203E and 0x204D
-Shirt color and Pants color need bounds checking too. =

-]]--
-
-gCharCreateSkillIDs =3D {}
-gCharCreateSkillIDs["Alchemy"]					=3D 0
-gCharCreateSkillIDs["Anatomy"]					=3D 1
-gCharCreateSkillIDs["Animal Lore"]				=3D 2
-gCharCreateSkillIDs["Item Identification"]		=3D 3
-gCharCreateSkillIDs["Arms Lore"]				=3D 4
-gCharCreateSkillIDs["Parrying"]					=3D 5
-gCharCreateSkillIDs["Begging"]					=3D 6
-gCharCreateSkillIDs["Blacksmithing"]			=3D 7
-gCharCreateSkillIDs["Bowcraft/Fletching"]		=3D 8
-gCharCreateSkillIDs["Peacemaking"]				=3D 9
-gCharCreateSkillIDs["Camping"]					=3D 10
-gCharCreateSkillIDs["Carpentry"]				=3D 11
-gCharCreateSkillIDs["Cartography"]				=3D 12
-gCharCreateSkillIDs["Cooking"]					=3D 13
-gCharCreateSkillIDs["Detecting Hidden"]			=3D 14
-gCharCreateSkillIDs["Discordance/Enticement"]	=3D 15
-gCharCreateSkillIDs["Evaluate Intelligence"]	=3D 16
-gCharCreateSkillIDs["Healing"]					=3D 17
-gCharCreateSkillIDs["Fishing"]					=3D 18
-gCharCreateSkillIDs["Forensic Evaluation"]		=3D 19
-gCharCreateSkillIDs["Herding"]					=3D 20
-gCharCreateSkillIDs["Hiding"]					=3D 21
-gCharCreateSkillIDs["Provocation"]				=3D 22
-gCharCreateSkillIDs["Inscription"]				=3D 23
-gCharCreateSkillIDs["Lockpicking"]				=3D 24
-gCharCreateSkillIDs["Magery"]					=3D 25
-gCharCreateSkillIDs["Resisting Spells"]			=3D 26
-gCharCreateSkillIDs["Tactics"]					=3D 27
-gCharCreateSkillIDs["Snooping"]					=3D 28
-gCharCreateSkillIDs["Musicianship"]				=3D 29
-gCharCreateSkillIDs["Poisoning"]				=3D 30
-gCharCreateSkillIDs["Archery"]					=3D 31
-gCharCreateSkillIDs["Spirit Speak"]				=3D 32
-gCharCreateSkillIDs["Stealing"]					=3D 33
-gCharCreateSkillIDs["Tailoring"]				=3D 34
-gCharCreateSkillIDs["Animal Taming"]			=3D 35
-gCharCreateSkillIDs["Taste Identification"]		=3D 36
-gCharCreateSkillIDs["Tinkering"]				=3D 37
-gCharCreateSkillIDs["Tracking"]					=3D 38
-gCharCreateSkillIDs["Veterinary"]				=3D 39
-gCharCreateSkillIDs["Swordsmanship"]			=3D 40
-gCharCreateSkillIDs["Mace Fighting"]			=3D 41
-gCharCreateSkillIDs["Fencing"]					=3D 42
-gCharCreateSkillIDs["Wrestling"]				=3D 43
-gCharCreateSkillIDs["Lumberjacking"]			=3D 44
-gCharCreateSkillIDs["Mining"]					=3D 45
-gCharCreateSkillIDs["Meditation"]				=3D 46
-gCharCreateSkillIDs["Stealth"]					=3D 47
-gCharCreateSkillIDs["Remove Trap"]				=3D 48
-gCharCreateSkillIDs["Necromancy"]				=3D 49
-gCharCreateSkillIDs["Focus"]					=3D 50
-gCharCreateSkillIDs["Chivalry"]					=3D 51

Modified: trunk/data/lua/lib.gui.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.gui.iris.lua (original)
+++ trunk/data/lua/lib.gui.iris.lua Sat Sep 15 15:55:15 2007
@@ -25,23 +25,27 @@
 -- text-line at the bottom of screen (readonly, used for mousepicking debu=
g text and for info during loading)
 function Client_SetBottomLine (text) SetBottomLine(text) end -- from lugre
 =

+gMemStats_NextUpdate =3D 0
 function DisplayMemoryUsage (memoryusage)
 	if (gHideMemoryUsage) then return end
-	local text =3D sprintf("%0.2fmb",memoryusage / 1024 / 1024)
-	if (not gMemoryUsageField) then
-		local vw,vh =3D GetViewportSize()
-		local w,h =3D 0,12
-		local x,y =3D (vw-w) / 2,0
-		local col_back =3D {0,0,0,0}
-		local col_text =3D {1,0,0,1}
-		gMemoryUsageField =3D guimaker.MyCreateDialog()
-		gMemoryUsageField.panel	=3D guimaker.MakeBorderPanel(gMemoryUsageField,x=
,y,w,h,col_back)
-		gMemoryUsageField.text	=3D guimaker.MakeText(gMemoryUsageField.panel,0,0=
,text,16,col_text)
-	else
-		gMemoryUsageField.text.gfx:SetText(text)
+	if (gMyTicks > gMemStats_NextUpdate) then
+		gMemStats_NextUpdate =3D gMyTicks + 1000
+		local text =3D sprintf("%0.2fmb",memoryusage / 1024 / 1024)
+		if (not gMemoryUsageField) then
+			local vw,vh =3D GetViewportSize()
+			local w,h =3D 0,12
+			local x,y =3D (vw-w) / 2,0
+			local col_back =3D {0,0,0,0}
+			local col_text =3D {1,0,0,1}
+			gMemoryUsageField =3D guimaker.MyCreateDialog()
+			gMemoryUsageField.panel	=3D guimaker.MakeBorderPanel(gMemoryUsageField,=
x,y,w,h,col_back)
+			gMemoryUsageField.text	=3D guimaker.MakeText(gMemoryUsageField.panel,0,=
0,text,16,col_text)
+		else
+			gMemoryUsageField.text.gfx:SetText(text)
+		end
+		local tw,th =3D gMemoryUsageField.text.gfx:GetTextBounds()
+		gMemoryUsageField.text.gfx:SetPos(-tw,0)
 	end
-	local tw,th =3D gMemoryUsageField.text.gfx:GetTextBounds()
-	gMemoryUsageField.text.gfx:SetPos(-tw,0)
 end
 =

 function gui.StartLoading () =

@@ -53,8 +57,9 @@
 =

 =

 -- called every frame
-function gui.Step () =

+function gui.Step ()
 	UpdateCompass()
+	DisplayMemoryUsage(OgreMemoryUsage("all"))
 end
 =

 =


Modified: trunk/data/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.mainmenu.lua (original)
+++ trunk/data/lua/lib.mainmenu.lua Sat Sep 15 15:55:15 2007
@@ -94,7 +94,20 @@
 		})
 		-- TODO : server.ip unused ? might not be needed when server sends redir=
ect packet
 	end
-	=

+
+	local MyGoBack =3D function(widget)
+		NetDisconnect()
+		gHuffmanDecode =3D false
+		=

+		Client_USleep( 500 )
+		StartMainMenu()
+		widget.dialog:Destroy()
+	end
+	-- back button
+	table.insert(rows,{
+		{type=3D"Button",onLeftClick=3DMyGoBack,text=3D"Back"}
+	})
+
 	gServerListDialog =3D guimaker.MakeTableDlg(rows,10,10)
 end
 =


Modified: trunk/data/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.uoids.lua (original)
+++ trunk/data/lua/lib.uoids.lua Sat Sep 15 15:55:15 2007
@@ -149,6 +149,59 @@
 kPopupStyle_FRAMED_DOUBLE		=3D hex2num("0x2422")
 kPopupStyle_FANCY				=3D hex2num("0x0053")
 =

+gCharCreateSkillIDs =3D {}
+gCharCreateSkillIDs["Alchemy"]					=3D 0
+gCharCreateSkillIDs["Anatomy"]					=3D 1
+gCharCreateSkillIDs["Animal Lore"]				=3D 2
+gCharCreateSkillIDs["Item Identification"]		=3D 3
+gCharCreateSkillIDs["Arms Lore"]				=3D 4
+gCharCreateSkillIDs["Parrying"]					=3D 5
+gCharCreateSkillIDs["Begging"]					=3D 6
+gCharCreateSkillIDs["Blacksmithing"]			=3D 7
+gCharCreateSkillIDs["Bowcraft/Fletching"]		=3D 8
+gCharCreateSkillIDs["Peacemaking"]				=3D 9
+gCharCreateSkillIDs["Camping"]					=3D 10
+gCharCreateSkillIDs["Carpentry"]				=3D 11
+gCharCreateSkillIDs["Cartography"]				=3D 12
+gCharCreateSkillIDs["Cooking"]					=3D 13
+gCharCreateSkillIDs["Detecting Hidden"]			=3D 14
+gCharCreateSkillIDs["Discordance/Enticement"]	=3D 15
+gCharCreateSkillIDs["Evaluate Intelligence"]	=3D 16
+gCharCreateSkillIDs["Healing"]					=3D 17
+gCharCreateSkillIDs["Fishing"]					=3D 18
+gCharCreateSkillIDs["Forensic Evaluation"]		=3D 19
+gCharCreateSkillIDs["Herding"]					=3D 20
+gCharCreateSkillIDs["Hiding"]					=3D 21
+gCharCreateSkillIDs["Provocation"]				=3D 22
+gCharCreateSkillIDs["Inscription"]				=3D 23
+gCharCreateSkillIDs["Lockpicking"]				=3D 24
+gCharCreateSkillIDs["Magery"]					=3D 25
+gCharCreateSkillIDs["Resisting Spells"]			=3D 26
+gCharCreateSkillIDs["Tactics"]					=3D 27
+gCharCreateSkillIDs["Snooping"]					=3D 28
+gCharCreateSkillIDs["Musicianship"]				=3D 29
+gCharCreateSkillIDs["Poisoning"]				=3D 30
+gCharCreateSkillIDs["Archery"]					=3D 31
+gCharCreateSkillIDs["Spirit Speak"]				=3D 32
+gCharCreateSkillIDs["Stealing"]					=3D 33
+gCharCreateSkillIDs["Tailoring"]				=3D 34
+gCharCreateSkillIDs["Animal Taming"]			=3D 35
+gCharCreateSkillIDs["Taste Identification"]		=3D 36
+gCharCreateSkillIDs["Tinkering"]				=3D 37
+gCharCreateSkillIDs["Tracking"]					=3D 38
+gCharCreateSkillIDs["Veterinary"]				=3D 39
+gCharCreateSkillIDs["Swordsmanship"]			=3D 40
+gCharCreateSkillIDs["Mace Fighting"]			=3D 41
+gCharCreateSkillIDs["Fencing"]					=3D 42
+gCharCreateSkillIDs["Wrestling"]				=3D 43
+gCharCreateSkillIDs["Lumberjacking"]			=3D 44
+gCharCreateSkillIDs["Mining"]					=3D 45
+gCharCreateSkillIDs["Meditation"]				=3D 46
+gCharCreateSkillIDs["Stealth"]					=3D 47
+gCharCreateSkillIDs["Remove Trap"]				=3D 48
+gCharCreateSkillIDs["Necromancy"]				=3D 49
+gCharCreateSkillIDs["Focus"]					=3D 50
+gCharCreateSkillIDs["Chivalry"]					=3D 51
 =

 -- skill ids and stuff
 glSkillNames =3D {	=


Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Sat Sep 15 15:55:15 2007
@@ -310,12 +310,12 @@
 		gCurrentRenderer:CombatGuiStep()
 		if (gCurrentRenderer.MobileAnimStep) then gCurrentRenderer:MobileAnimSte=
p() end
 		gCurrentRenderer:CamStep()
+		gui.Step()
 	else
 		StepMainMenu()
 	end
 =

 	StepDebugMenu()
-	gui.Step()
 	InputStep() -- generate mouse_left_drag_* and mouse_left_click_single eve=
nts =

 	GUIStep() -- generate mouse_enter, mouse_leave events (might adjust curso=
r -> before CursorStep)
 	CursorStep()



From no-reply at zwischenwelt.org  Sat Sep 15 17:14:12 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Sep 2007 15:14:12 -0000
Subject: [Iris-commit] [IRIS] r1389 - in /trunk: data/lua/lib.sound.iris.lua
	src/scripting.iris.cpp
Message-ID: <20070915151412.4A3A91524003@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Sep 15 17:14:11 2007
New Revision: 1389

Log:
fixed CreateSoundSource3DFromEffect

Modified:
    trunk/data/lua/lib.sound.iris.lua
    trunk/src/scripting.iris.cpp

Modified: trunk/data/lua/lib.sound.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.sound.iris.lua (original)
+++ trunk/data/lua/lib.sound.iris.lua Sat Sep 15 17:14:11 2007
@@ -6,7 +6,7 @@
 		if gSoundSystem then
 			printdebug("sound",sprintf("SoundPlayEffect(%f,%f,%f,%i)\n",x,y,z,effec=
t))
 			FlushSoundEffects()
-			local e =3D gSoundSystem:CreateSoundSource3DFromEffect(gSoundLoader,x,y=
,z,effect)
+			local e =3D CreateSoundSource3DFromEffect(gSoundSystem,gSoundLoader,x,y=
,z,effect)
 			if e then
 				e:SetMinMaxDistance(50,100000)
 				-- glSoundEffect:SetReferenceDistance(100)

Modified: trunk/src/scripting.iris.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.iris.cpp (original)
+++ trunk/src/scripting.iris.cpp Sat Sep 15 17:14:11 2007
@@ -15,6 +15,7 @@
 #include "spritemanager.h"
 #include "ogremanualloader.h"
 #include "huffman.h"
+#include "lugre_sound.h"
 =

 using namespace Lugre;
 =

@@ -344,6 +345,20 @@
 	return 0;
 }
 =

+
+		=

+// 			  CreateSoundSource3DFromEffect(SoundSystem,loader,x,y,z,effectid)
+static int	l_CreateSoundSource3DFromEffect(lua_State *L) { PROFILE
+	cSoundSource* target =3D 0;
+	cSoundLoader *loader =3D cLuaBind<cSoundLoader>::checkudata_alive(L,2);
+	cSound *s =3D loader->GetSound(luaL_checkint(L,6));
+	if (!s) return 0;
+	target =3D cLuaBind<cSoundSystem>::checkudata_alive(L)->CreateSoundSource=
3D(luaL_checknumber(L,3),luaL_checknumber(L,4),luaL_checknumber(L,5),
+		s->GetPCMBuffer(),s->GetPCMBufferSize(),s->IsMono()?1:2,s->GetBitrate(),=
s->GetKHz());
+	return target ? cLuaBind<cSoundSource>::CreateUData(L,target) : 0;
+}
+
+
 void	Iris_RegisterLuaPlugin	() {
 	=

 	class cIris_ScriptingPlugin : public cScriptingPlugin { public:
@@ -358,6 +373,7 @@
 			lua_register(L,"CreateGrannyHuedTexture",		l_CreateGrannyHuedTexture);
 			lua_register(L,"HueMesh",						l_HueMesh);
 			lua_register(L,"CreateLookupTableFromFile",		l_CreateLookupTableFromFil=
e);
+			lua_register(L,"CreateSoundSource3DFromEffect",	l_CreateSoundSource3DFr=
omEffect);
 		}
 		=

 		void	RegisterLua_Classes			(lua_State*	L) {



From no-reply at zwischenwelt.org  Sat Sep 15 17:31:57 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Sep 2007 15:31:57 -0000
Subject: [Iris-commit] [IRIS] r1390 - /trunk/data/lua/lib.sound.iris.lua
Message-ID: <20070915153157.108DA1524003@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Sep 15 17:31:56 2007
New Revision: 1390

Log:
sound pseudo filename for uo-loaded sounds

Modified:
    trunk/data/lua/lib.sound.iris.lua

Modified: trunk/data/lua/lib.sound.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.sound.iris.lua (original)
+++ trunk/data/lua/lib.sound.iris.lua Sat Sep 15 17:31:56 2007
@@ -8,6 +8,7 @@
 			FlushSoundEffects()
 			local e =3D CreateSoundSource3DFromEffect(gSoundSystem,gSoundLoader,x,y=
,z,effect)
 			if e then
+				e.file =3D "uosound:"..effect
 				e:SetMinMaxDistance(50,100000)
 				-- glSoundEffect:SetReferenceDistance(100)
 				e:Play()



From no-reply at zwischenwelt.org  Sat Sep 15 17:49:36 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Sep 2007 15:49:36 -0000
Subject: [Iris-commit] [IRIS] r1391 - in /trunk: bin/iris2.exe cb/iris2.cbp
 data/config.lua.dist data/lua/main.lua
Message-ID: <20070915154937.453C21524003@zwischenwelt.org>

Author: sience
Date: Sat Sep 15 17:49:36 2007
New Revision: 1391

Log:
-menue music fixed
-ingame music added
-soundeffects are now enabled
-codeblocks project updated
-new binary

Modified:
    trunk/bin/iris2.exe
    trunk/cb/iris2.cbp
    trunk/data/config.lua.dist
    trunk/data/lua/main.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/cb/iris2.cbp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/cb/iris2.cbp (original)
+++ trunk/cb/iris2.cbp Sat Sep 15 17:49:36 2007
@@ -86,6 +86,7 @@
 			<Add option=3D"-D_WINDOWS" />
 			<Add option=3D"-DMINGW" />
 			<Add option=3D'-DMAIN_WORKING_DIR=3D&quot;../&quot;' />
+			<Add option=3D"-DUSE_FMOD" />
 			<Add directory=3D"..\include" />
 			<Add directory=3D"$(OGRE_HOME)\include" />
 			<Add directory=3D"$(OGRE_HOME)\include\ois" />

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Sep 15 17:49:36 2007
@@ -74,7 +74,7 @@
 -- Soundeffects & Music
 -- gUseSoundSystem =3D "openal"
 gUseSoundSystem =3D "fmod"
-gUseSoundeffects =3D false
+gUseSoundeffects =3D true
 gUseMusic =3D true
 =

 gCurrentRenderer =3D Renderer3D	-- Renderer2D

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Sat Sep 15 17:49:36 2007
@@ -290,6 +290,9 @@
 =

 	-- stop menu music
 	SoundStopMusic()
+	=

+	-- start playing ingame music
+	SoundPlayMusicById(57)
 =

 	gInGameStarted =3D true
 end



From no-reply at zwischenwelt.org  Tue Sep 18 21:43:55 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Sep 2007 19:43:55 -0000
Subject: [Iris-commit] [IRIS] r1392 - /trunk/data/lua/main.lua
Message-ID: <20070918194355.5892B1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Sep 18 21:43:55 2007
New Revision: 1392

Log:
small lugre compatibility fix

Modified:
    trunk/data/lua/main.lua

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Tue Sep 18 21:43:55 2007
@@ -227,6 +227,7 @@
 	LoadingProfile("initializing Ogre",true)
 	gPreOgreTime =3D gLoadingProfileLastTime
 	if (not InitOgre("Iris2",lugre_detect_ogre_plugin_path())) then Exit() end
+	if (OgreInitResLocs) then OgreInitResLocs() end
 	SetCursorBaseOffset(0,0)
 =

 	-- set global shadow settings



From no-reply at zwischenwelt.org  Wed Sep 19 00:13:59 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Sep 2007 22:13:59 -0000
Subject: [Iris-commit] [IRIS] r1393 - in /trunk: SConstruct
	data/lua/main.lua src/main.cpp
Message-ID: <20070918221359.DADBE1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Sep 19 00:13:59 2007
New Revision: 1393

Log:
adjusted to mylugre path updates

Modified:
    trunk/SConstruct
    trunk/data/lua/main.lua
    trunk/src/main.cpp

Modified: trunk/SConstruct
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/SConstruct (original)
+++ trunk/SConstruct Wed Sep 19 00:13:59 2007
@@ -94,7 +94,7 @@
 # CPPDEFINES=3D{'B':2, 'A':None}
 =

 # working dir override
-cppdefines 		+=3D ' MAIN_WORKING_DIR=3D".." '
+cppdefines 		+=3D ' MAIN_WORKING_DIR=3D\\"..\\" '
 #cppdefines 		+=3D ' MAIN_WORKING_DIR=3D"some/where/" '
 =

 # mylugre local override

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Wed Sep 19 00:13:59 2007
@@ -226,7 +226,7 @@
 	=

 	LoadingProfile("initializing Ogre",true)
 	gPreOgreTime =3D gLoadingProfileLastTime
-	if (not InitOgre("Iris2",lugre_detect_ogre_plugin_path())) then Exit() end
+	if (not InitOgre("Iris2",lugre_detect_ogre_plugin_path(),"../bin/")) then=
 Exit() end
 	if (OgreInitResLocs) then OgreInitResLocs() end
 	SetCursorBaseOffset(0,0)
 =


Modified: trunk/src/main.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/main.cpp (original)
+++ trunk/src/main.cpp Wed Sep 19 00:13:59 2007
@@ -41,7 +41,7 @@
 	=

 	// start mainloop
 	=

-	Lugre_Run(argc,argv,PATH_MAIN_LUA,PATH_LUGRE_LUA,"bin/");
+	Lugre_Run(argc,argv,PATH_MAIN_LUA,PATH_LUGRE_LUA);
 	=

 	return 0;
 }



From no-reply at zwischenwelt.org  Wed Sep 19 01:32:46 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Sep 2007 23:32:46 -0000
Subject: [Iris-commit] [IRIS] r1394 - in /trunk: ./ bin/ cb/ data/ data/lua/
 data/lua/gui/ data/lua/net/ data/lua/obj/
Message-ID: <20070918233247.0557B1524005@zwischenwelt.org>

Author: sience
Date: Wed Sep 19 01:32:46 2007
New Revision: 1394

Log:
-soundglobals fixed for lugre
-backpack toggle fixed
-several debugprints fixed
-gz_Factor moved to lib.3d.renderer.lua
-some obsolete comments removed
-readme updated

Modified:
    trunk/README
    trunk/bin/iris2.exe
    trunk/cb/iris2.cbp
    trunk/data/config.lua.dist
    trunk/data/lua/gui/gui.paperdoll.lua
    trunk/data/lua/lib.3d.map.lua
    trunk/data/lua/lib.3d.renderer.lua
    trunk/data/lua/lib.cliloc.lua
    trunk/data/lua/lib.gfm.lua
    trunk/data/lua/lib.gui.iris.lua
    trunk/data/lua/lib.loading.lua
    trunk/data/lua/lib.sound.iris.lua
    trunk/data/lua/lib.test.lua
    trunk/data/lua/net.walk.lua
    trunk/data/lua/net/net.effect.lua
    trunk/data/lua/obj/obj.container.lua
    trunk/data/lua/obj/obj.player.lua

Modified: trunk/README
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/README (original)
+++ trunk/README Wed Sep 19 01:32:46 2007
@@ -11,6 +11,7 @@
 	- Samurai Empire and Gold Trial  (SE =3D=3D Gold)
 	- Mondain's Legacy
 	- or later.
+
 2. Install and run Ultima Online and patch it to the newest Version.
 =

 3. Run Iris2_Setup.exe
@@ -29,10 +30,10 @@
 http://www.fileplanet.com/150525/150000/fileinfo/Ultima-Online-Gold-15-day=
-Trial
 =

 INSTALL SEE
-http://www.iris2.de/
+http://iris2.de/index.php/InstallationManual		(English)
+http://iris2.de/index.php/Installations_Anleitung	(deutsch)
 =

 =3D=3D controls =3D=3D
-
 arrow keys for moving the player
 u : walk to targetted position
 =

@@ -78,13 +79,6 @@
 -g path/to/grannyfile.grn		: prints granny dump
 -gb path/to/grannyfile.grn		: prints granny bone info
 =

-=3D=3D=3D license =3D=3D=3D
-
-see COPYING for license of our code
-
-FMOD Sound System, copyright =C2=A9 Firelight Technologies Pty, Ltd., 1994=
-2007.
-http://www.fmod.org/index.php/sales
-
 =3D=3D=3D debug mode =3D=3D=3D
 a : show first model and anim =

 =

@@ -115,8 +109,7 @@
 	(this is for searching and destroying billboard-like models)
 	(careful with big changes to param1, will be slow, skipping tries to load=
 all meshes in between)
 =

-=3D=3D=3D 2d-renderer and data =3D=3D=3D
-
+=3D=3D=3D 2d-Renderer and data =3D=3D=3D
 the 2DRenderer is only available as compiled .luac file, =

 it is a optional closed source plugin that is not statically linked, =

 if you don't want it, you can delete the .luac file.
@@ -134,14 +127,27 @@
 =3D=3D=3D code documentation =3D=3D=3D
 doxygen syntax has been used, might be interesting to generate documentati=
on from the sourcecode
 =

+http://www.zwischenwelt.org/~hagish/irisdocs/doc/html/
+
 =3D=3D developer =3D=3D
 Florian Fischer (SiENcE) =

 Robert Noll (Ghoulsblade) =

 Sebastian Dorda (hagish)
 R=C3=BCdiger Pakmor (Varan)
 =

-visit our wiki/website and forum at 	http://www.iris2.de/
+=3D=3D=3D other projects of the iris-ogre-developers =3D=3D=3D
+http://schattenkind.net/		- Our mainsite (a Game developer association)
+http://www.iris2.de/			- Iris Website
+http://sfz.schattenkind.net/	- Stressfree Zone (space game)
+http://lugre.schattenkind.net	- Lugre	(middelware for Ogre3D, Lua, Fmod, O=
penAL, ODE, Boost)
 =

-=3D=3D=3D other projects of the iris-ogre-developers =3D=3D=3D
-http://schattenkind.net/
-http://sfz.schattenkind.net/
+=3D=3D=3D license =3D=3D=3D
+see COPYING for license of our code
+
+further take a look here:
+FMOD Sound System, copyright =C2=A9 Firelight Technologies Pty, Ltd., 1994=
-2007.
+http://www.fmod.org/index.php/sales
+
+Ogre3D see: README.ogre
+
+TinyXML see: README.tinyxml

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/cb/iris2.cbp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/cb/iris2.cbp (original)
+++ trunk/cb/iris2.cbp Wed Sep 19 01:32:46 2007
@@ -85,7 +85,7 @@
 			<Add option=3D"-DWIN32" />
 			<Add option=3D"-D_WINDOWS" />
 			<Add option=3D"-DMINGW" />
-			<Add option=3D'-DMAIN_WORKING_DIR=3D&quot;../&quot;' />
+			<Add option=3D'-DMAIN_WORKING_DIR=3D\&quot;../\&quot;' />
 			<Add option=3D"-DUSE_FMOD" />
 			<Add directory=3D"..\include" />
 			<Add directory=3D"$(OGRE_HOME)\include" />
@@ -151,6 +151,7 @@
 		<Unit filename=3D"..\lugre\include\lugre_shell.h" />
 		<Unit filename=3D"..\lugre\include\lugre_smartptr.h" />
 		<Unit filename=3D"..\lugre\include\lugre_sound.h" />
+		<Unit filename=3D"..\lugre\include\lugre_thread.h" />
 		<Unit filename=3D"..\lugre\include\lugre_timer.h" />
 		<Unit filename=3D"..\lugre\include\lugre_viewport.h" />
 		<Unit filename=3D"..\lugre\include\lugre_widget.h" />
@@ -196,6 +197,8 @@
 		<Unit filename=3D"..\lugre\src\lugre_sound.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_sound_L.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_sound_fmod.cpp" />
+		<Unit filename=3D"..\lugre\src\lugre_thread.cpp" />
+		<Unit filename=3D"..\lugre\src\lugre_thread_L.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_timer.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_transform_mesh.cpp" />
 		<Unit filename=3D"..\lugre\src\lugre_viewport_L.cpp" />

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Wed Sep 19 01:32:46 2007
@@ -74,7 +74,7 @@
 -- Soundeffects & Music
 -- gUseSoundSystem =3D "openal"
 gUseSoundSystem =3D "fmod"
-gUseSoundeffects =3D true
+gUseEffect =3D true
 gUseMusic =3D true
 =

 gCurrentRenderer =3D Renderer3D	-- Renderer2D

Modified: trunk/data/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/gui/gui.paperdoll.lua (original)
+++ trunk/data/lua/gui/gui.paperdoll.lua Wed Sep 19 01:32:46 2007
@@ -197,7 +197,7 @@
 		if (bodygumpid) then
 			dialog.bodywidget =3D MakeBorderGumpPart(dialog.rootwidget,bodygumpid,9=
,19 , 0, 0, 0,skinhue)
 		else =

-			print("Open_Paperdoll : unknown bodyid ",bodyid,sprintf("0x%04x",bodyid=
))
+			--print("Open_Paperdoll : unknown bodyid ",bodyid,sprintf("0x%04x",body=
id))
 			-- TODO : fallback/default bodyid ?
 		end
 	=

@@ -296,7 +296,7 @@
 =

 --Send Quest, Guild Button req. to Server -> Server returns a Serverside G=
ump
 function Send_AOSCommand(subcmd,player_serial)
-	print("NET: Send_AOSCommand: "..subcmd.." Player_Serial=3D"..player_seria=
l)
+	--print("NET: Send_AOSCommand: "..subcmd.." Player_Serial=3D"..player_ser=
ial)
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_AOS_Command)
 	if (subcmd =3D=3D kPacket_Generic_SubCommand_QuestGumpRequest) then
@@ -320,12 +320,12 @@
 	if (gPlayerBodySerial and gPaperdolls[gPlayerBodySerial]) then
 		gPaperdolls[gPlayerBodySerial]:Close()
 	else
-		printf("opening player paperdoll")
+		--printf("opening player paperdoll")
 =

 		local playermobile =3D GetPlayerMobile()
 		=

 		if (playermobile) then =

-			print("player serial",playermobile.serial)
+			--print("player serial",playermobile.serial)
 			Send_DoubleClick(playermobile.serial)
 			=

 			Send_ClientQuery(gRequest_States,playermobile.serial)

Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Wed Sep 19 01:32:46 2007
@@ -9,9 +9,6 @@
 Renderer3D.gbBlendOutTerrainVisible =3D true
 Renderer3D.gMapUpdateInterval =3D 100 -- update the map not every frame, d=
ecrease for fly-videos
 Renderer3D.gMaxMapBlocksLoadedPerUpdate =3D 1 -- increase for fly-videos
-
--- static Factor to rise the Z-Level for statics+dynamics
-Renderer3D.gZ_Factor =3D 0.01 --0.0090
 =

 -- the whole map cache consists of (ROBMAP_RECENTER_DIST*2)*(ROBMAP_RECENT=
ER_DIST*2)  chunks
 -- every chunk consists of ROBMAP_CHUNK_SIZE*ROBMAP_CHUNK_SIZE blocks
@@ -99,7 +96,7 @@
 end
 =

 function Renderer3D:ClearMapCache ()
-	print("ClearMapCache")
+	--print("ClearMapCache")
 	local y,row,x,chunk
 	for y,row in pairs(self.gMapChunks) do
 		for x,chunk in pairs(row) do

Modified: trunk/data/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.renderer.lua (original)
+++ trunk/data/lua/lib.3d.renderer.lua Wed Sep 19 01:32:46 2007
@@ -1,9 +1,10 @@
 Renderer3D =3D {}
 gRendererList[ "Renderer3d" ] =3D Renderer3D
 =

+-- static Factor to rise the Z-Level for statics+dynamics
+Renderer3D.gZ_Factor =3D 0.01 --0.0090
 		=

 gHudNamesFontSize =3D 12
-
 =

 Renderer3D.gbActive =3D false
 Renderer3D.giLastAnimStepTime =3D nil
@@ -705,8 +706,9 @@
 	-- Detect Multis
 	if item.artid >=3D gMulti_ID then
 		-- Check if Serverside Multi (Custom Multi)
-		print("-----------------------------")
-		print("ARTID",item.artid,vardump(item))
+		printdebug("multi","-----------------------------")
+		printdebug("multi", sprintf("ARTID",item.artid,vardump(item)) )
+
 		if (item.lTile) then
 			printdebug("multi","Serverside Multi detected")
 			local rootgfx =3D CreateRootGfx3D()
@@ -749,7 +751,7 @@
 				local blocknum,xloc,yloc,zloc,flags
 				blocknum,xloc,yloc,zloc,flags =3D gMultiLoader:GetMultiParts(id,p)
 				=

-				--printdebug("multi","part",p,":",blocknum,xloc,yloc,zloc,flags)
+				printdebug("multi","part",p,":",blocknum,xloc,yloc,zloc,flags)
 				=

 				-- skip invisible parts
 				if flags =3D=3D 1 then
@@ -780,9 +782,6 @@
 			for k,v in pairs(item.lMultiChildGfx) do item.gfx:SetOrientation(GetSta=
ticMeshOrientation(v.artid)) end
 =

 			self:UpdateDynamicItemPos(item)
-
-			print("+++++++++++++++++++++++++")
-			print("ITEM",vardump(item))
 		else =

 			printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed loadi=
ng mesh for dynamic (multi): artid=3D%i z_typename=3D%s\n",item.artid or -1=
,item.z_typename or ""))
 		end
@@ -806,13 +805,12 @@
 			end
 =

 			-- --------------------------------------------------------------------=
-----
-			-- todo: HACK here (zadd because dynamic street-tiles dont look good fl=
ying)
+			-- todo: HACK here (zadd because dynamic street-tiles dont look good (f=
lying).)
 			if (CountMeshTriangles(meshname) <=3D 4) then =

 				item.gfx:SetCastShadows(false)	-- groundtiles and item billboards shou=
ldn't cast shadows
 				if (gTileTypeLoader) then
 					if not(isSurface( GetStaticTileTypeFlags(item.artid) or 0 )) then
 						item.zadd =3D self.gDynamicZAdd
-						--print("Surface unter 4 triangles nicht zadd=3D"..item.artid)
 					end
 				end
 			end
@@ -931,7 +929,7 @@
 =

 -- select the given mobile
 function Renderer3D:SelectMobile (iSerial)
-	-- print ("selectmobile",iSerial)
+	printdebug("mobile",sprintf("selectmobile",iSerial))
 	self:DeselectMobile()
 	if (iSerial ~=3D 0) then
 		local mobile =3D GetMobile(iSerial)
@@ -940,8 +938,6 @@
 			-- TODO is it possible that selection is not created (mobile:Update() c=
reates selection)
 			mobile.selection:SetVisible(true)
 			giSelectedMobile =3D iSerial
-			=

-			-- CombatCreateDamageText("jupii!",mobile.xloc,mobile.yloc,mobile.zloc)
-		end
-	end
-end
+		end
+	end
+end

Modified: trunk/data/lua/lib.cliloc.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.cliloc.lua (original)
+++ trunk/data/lua/lib.cliloc.lua Wed Sep 19 01:32:46 2007
@@ -15,7 +15,7 @@
 --done reading cliloc uo/Cliloc.enu, index range from 500000 to 3011032
 =

 function GetIntLocText (intlocid,textid) =

-	print("GetIntLocText",intlocid,textid)
+	--print("GetIntLocText",intlocid,textid)
 	local intloc =3D gIntLocLoaders[intlocid]
 	return intloc and intloc:Get(textid)
 end

Modified: trunk/data/lua/lib.gfm.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.gfm.lua (original)
+++ trunk/data/lua/lib.gfm.lua Wed Sep 19 01:32:46 2007
@@ -1,7 +1,6 @@
 -- this file is for parsing the xml like data in data/gfm/
  =

 gBorderGumpIndexAdd =3D { LT=3D0,T=3D1,RT=3D2,L=3D3,M=3D4,R=3D5,LB=3D6,B=
=3D7,RB=3D8,RB_Resize=3D9 }
-
 =

 function GumpButtonSetOver		(widget) widget.gfx:SetMaterial(widget.mat_ove=
r) end
 function GumpButtonSetNormal	(widget) widget.gfx:SetMaterial(widget.mat_no=
rmal) end
@@ -197,7 +196,7 @@
 end
 =

 function GfmTest()
-	--[[
+--[[
 	-- gGumpLoader
 	--local iGumpID =3D (hex2num("0x47E")) -- small x button
 	--local iGumpID =3D (hex2num("0x1393")) -- big compass
@@ -228,7 +227,7 @@
 		--control : class=3Dbutton, name=3D'button_47e', left=3D318,270,28,21
 		--gump(): normal=3D0x47E over=3D0x47F pressed=3D0x47E
 	end
-	]]--
+]]--
 	=

 	if (true and gGumpLoader) then
 		--local path =3D "data/gfm/askquit.gfm"
@@ -238,7 +237,8 @@
 		--local path =3D "data/gfm/connecting.gfm"
 		--local path =3D "data/gfm/loading.gfm"
 		--local path =3D "data/gfm/neterror.gfm"
-		--[[local mydialog =3D CreateGumpDlgFromGfm(path)
+--[[
+		local mydialog =3D CreateGumpDlgFromGfm(path)
 		mydialog.rootwidget.gfx:SetPos(120,0)
 		local w =3D mydialog.controls["hitsbar"].gfx:GetWidth()
 		local h =3D mydialog.controls["hitsbar"].gfx:GetHeight()
@@ -247,18 +247,17 @@
 		mydialog.controls["hitsbar"].gfx:SetDimensions(w*p,h)
 		--mydialog.controls["hitsbar"].gfx:SetUV(0.0,0.0,p,1.0)
 		--GfmDump(path)
-		]]--
-	end
-	=

-	=

-	--[[
+]]--
+	end
+	=

+	=

+--[[
 	print("map_ID=3D",xmlchild(mapinfo,"ID")[1])
 	print("map_NAME=3D",xmlchild(mapinfo,"NAME")[1])
 	print("map_HEIGHT=3D",xmlchild(mapinfo,"HEIGHT")[1])
 	print("map_SKYBOX=3D",xmlchild(mapinfo,"SKYBOX")[1])
-	]]--
-end
-
+]]--
+end
 =

 function CreateGumpDlgFromGfm (path) =

 	local dialog =3D guimaker.MakeSortedDialog()
@@ -331,8 +330,6 @@
 		dialog.controls[attr.name] =3D widget
 	end
 end
-
-
 =

 function GfmDump (path)
 	print("GfmDump",path)
@@ -370,46 +367,5 @@
 			printf("\n")
 		end
 	end end
-	--[[
-	output example :
-	GfmDump datapath.."gfm/neterror.gfm"
-	width=3D  640
-	height=3D 480
-	control : class=3Dborder, name=3D'border_a28', left=3D126, top=3D146, wid=
th=3D409, height=3D182
-	  gump(0xA28):
-	  event():
-	control : class=3Dlabel, name=3D'message', left=3D218, top=3D230, width=
=3D221, height=3D24
-	  event():
-	  text(Unknown net error): hue=3D0x95 font=3D3 align=3Dcenter
-	control : class=3Dbutton, name=3D'button_47e', left=3D318, top=3D270, wid=
th=3D28, height=3D21
-	  gump(): normal=3D0x47E over=3D0x47F pressed=3D0x47E
-	  event(): onclick=3Dhandler_on_main
-	control : class=3Dlabel, name=3D'label', left=3D254, top=3D195, width=3D1=
55, height=3D24
-	  event():
-	  text(Network Error): hue=3D0x95 font=3D0 align=3Dcenter
-	]]--
-end
-
---[[
-<?xml version=3D'1.0'?>
-<form width=3D'640' height=3D'480' alpha=3D'0' flags=3D'0' shape=3D''>
- <fade alpha=3D'0' time=3D'0'/>
- <event onclick=3D'' onclose=3D'' onmouseup=3D'' onmousedown=3D'' onkeypre=
ssed=3D''/>
-<control class=3D'border' name=3D'border_a28' left=3D'126' top=3D'146' wid=
th=3D'409' height=3D'182' freezed=3D'1' visible=3D'1' alpha=3D'0' flags=3D'=
0'>
- <event onclick=3D'' onclose=3D'' onmouseup=3D'' onmousedown=3D'' onkeypre=
ssed=3D''/>
- <gump>0xA28</gump>
-</control>
-<control class=3D'label' name=3D'message' left=3D'218' top=3D'230' width=
=3D'221' height=3D'24' freezed=3D'1' visible=3D'1' alpha=3D'0' flags=3D'0'>
- <event onclick=3D'' onclose=3D'' onmouseup=3D'' onmousedown=3D'' onkeypre=
ssed=3D''/>
- <text font=3D'3' hue=3D'0x95' align=3D'center'>Unknown net error</text>
-</control>
-<control class=3D'button' name=3D'button_47e' left=3D'318' top=3D'270' wid=
th=3D'28' height=3D'21' freezed=3D'1' visible=3D'1' alpha=3D'0' flags=3D'0'>
- <event onclick=3D'handler_on_main' onclose=3D'' onmouseup=3D'' onmousedow=
n=3D'' onkeypressed=3D''/>
- <gump normal=3D'0x47E' over=3D'0x47F' pressed=3D'0x47E'/>
-</control>
-<control class=3D'label' name=3D'label' left=3D'254' top=3D'195' width=3D'=
155' height=3D'24' freezed=3D'1' visible=3D'1' alpha=3D'0' flags=3D'0'>
- <event onclick=3D'' onclose=3D'' onmouseup=3D'' onmousedown=3D'' onkeypre=
ssed=3D''/>
- <text font=3D'0' hue=3D'0x95' align=3D'center'>Network Error</text>
-</control>
-</form>
-]]--
+end
+

Modified: trunk/data/lua/lib.gui.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.gui.iris.lua (original)
+++ trunk/data/lua/lib.gui.iris.lua Wed Sep 19 01:32:46 2007
@@ -7,8 +7,8 @@
 -- creates all this fancy gui stuff
 function GuiInit ()
 	-- create player status
-	if GetPlayerMobile() then =

-		print("########## Open Status")
+	if GetPlayerMobile() then
+		printdebug("gump","########## UpdatePlayerBodySerial (serial) was called=
 -> Open Status")
 		OpenStatus(GetPlayerMobile(),0,0) =

 	end
 end

Modified: trunk/data/lua/lib.loading.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.loading.lua (original)
+++ trunk/data/lua/lib.loading.lua Wed Sep 19 01:32:46 2007
@@ -153,7 +153,7 @@
 		gMultiLoader =3D CreateMultiLoader(gMultiLoaderType,CorrectPath(gUOPath.=
."multi.idx"),CorrectPath(gUOPath.."multi.mul"))
 	end
 	=

-	if (gSoundLoaderType and gUseSoundeffects) then
+	if (gSoundLoaderType and gUseEffect) then
 		LoadingProfile("init SoundLoader")
 		gSoundLoader =3D CreateSoundLoader(gSoundLoaderType,CorrectPath(gUOPath.=
."soundidx.mul"),CorrectPath(gUOPath.."sound.mul"))
 		SoundInit(gUseSoundSystem,22050)

Modified: trunk/data/lua/lib.sound.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.sound.iris.lua (original)
+++ trunk/data/lua/lib.sound.iris.lua Wed Sep 19 01:32:46 2007
@@ -1,9 +1,10 @@
 =

 gSoundMusicLoop =3D true
 =

+-- same like lugre:SoundPlayEffect but written for UO specific sound.mul
 function SoundPlayEffect_UO (x,y,z,effect)
 	if gSoundLoader then
-		if gSoundSystem then
+		if gUseEffect and gSoundSystem then
 			printdebug("sound",sprintf("SoundPlayEffect(%f,%f,%f,%i)\n",x,y,z,effec=
t))
 			FlushSoundEffects()
 			local e =3D CreateSoundSource3DFromEffect(gSoundSystem,gSoundLoader,x,y=
,z,effect)
@@ -25,63 +26,60 @@
 end
 =

 function SoundPlayMusicById(musicid)
-	if gUseMusic then
-		printdebug("sound",sprintf("SoundPlayMusicById(%s)\n",musicid))
-		local config =3D CorrectPath(gUOPath.."Music/Digital/Config.txt")
-		local mp3 =3D nil
-		local loop =3D nil
-		local file =3D nil
+	printdebug("sound",sprintf("SoundPlayMusicById(%s)\n",musicid))
+	local config =3D CorrectPath(gUOPath.."Music/Digital/Config.txt")
+	local mp3 =3D nil
+	local loop =3D nil
+	local file =3D nil
 		=

-		-- TODO : not Config.txt not available if midi only, see ticket #32
-		if ((not config) or config =3D=3D "" or (not file_exists(config))) then =
return end
+	-- TODO : not Config.txt not available if midi only, see ticket #32
+	if ((not config) or config =3D=3D "" or (not file_exists(config))) then r=
eturn end
 		=

-		-- parse uo sound config file
-		for line in io.lines(config) do
-			local id,loop,name
-			local poss =3D string.find(line," ")
-			local posc =3D string.find(line,",")
+	-- parse uo sound config file
+	for line in io.lines(config) do
+		local id,loop,name
+		local poss =3D string.find(line," ")
+		local posc =3D string.find(line,",")
 			=

-			if poss then
-				if posc =3D=3D nil then
-					-- no loop specified
-					loop =3D 0
-					id =3D trim(string.sub(line,0,poss-1))
-					name =3D trim(string.sub(line,poss+1))
+		if poss then
+			if posc =3D=3D nil then
+				-- no loop specified
+				loop =3D 0
+				id =3D trim(string.sub(line,0,poss-1))
+				name =3D trim(string.sub(line,poss+1))
+			else
+				loop =3D 1
+				id =3D trim(string.sub(line,0,poss-1))
+				name =3D trim(string.sub(line,poss+1,posc-1))
+			end
+			=

+			if tonumber(id) =3D=3D musicid then
+				if (string.find(string.lower(name),".mp3") =3D=3D nil) then
+					-- add mp3 suffix
+					file =3D CorrectPath(gUOPath.."Music/Digital/"..name..".mp3")
 				else
-					loop =3D 1
-					id =3D trim(string.sub(line,0,poss-1))
-					name =3D trim(string.sub(line,poss+1,posc-1))
+					-- mp3 suffix aready present
+					file =3D CorrectPath(gUOPath.."Music/Digital/"..name)
 				end
 				=

-				if tonumber(id) =3D=3D musicid then
-					if (string.find(string.lower(name),".mp3") =3D=3D nil) then
-						-- add mp3 suffix
-						file =3D CorrectPath(gUOPath.."Music/Digital/"..name..".mp3")
-					else
-						-- mp3 suffix aready present
-						file =3D CorrectPath(gUOPath.."Music/Digital/"..name)
-					end
-					=

-					printdebug("sound",sprintf("load sound id=3D%d name=3D%s loop=3D%d fi=
le=3D%s\n",id,name,loop,file))
-					=

-					if loop =3D=3D 1 then
-						gSoundMusicLoop =3D true
-					else =

-						gSoundMusicLoop =3D false
-					end
+				printdebug("sound",sprintf("load sound id=3D%d name=3D%s loop=3D%d fil=
e=3D%s\n",id,name,loop,file))
+				=

+				if loop =3D=3D 1 then
+					gSoundMusicLoop =3D true
+				else =

+					gSoundMusicLoop =3D false
 				end
 			end
 		end
-		=

-		if file and (not gSoundMusicCurrent or gSoundMusicCurrent ~=3D file) then
-			-- play it :) only if new or other sound
-			if file_exists(file) then
-				SoundPlayMusic(file)
-				gSoundMusicCurrent =3D file
-			else =

-				print("ERROR sound file not found: "..file)
-			end
+	end
+	=

+	if file and (not gSoundMusicCurrent or gSoundMusicCurrent ~=3D file) then
+		-- play it :) only if new or other sound
+		if file_exists(file) then
+			SoundPlayMusic(file)
+			gSoundMusicCurrent =3D file
+		else =

+			print("ERROR sound file not found: "..file)
 		end
 	end
 end
-

Modified: trunk/data/lua/lib.test.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.test.lua (original)
+++ trunk/data/lua/lib.test.lua Wed Sep 19 01:32:46 2007
@@ -139,25 +139,6 @@
 				iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i) -- opera=
tes on the block that was last loaded using :Load()
 				total_static_count =3D total_static_count + 1
 				staticCounter[iTileTypeID] =3D (staticCounter[iTileTypeID] or 0) + 1
-				--[[
-				meshname =3D GetStaticMeshName(iTileTypeID,iHue)
-				if (meshname) then
-					entity =3D CreateMeshEntity(meshname)
-					local qw,qx,qy,qz =3D GetStaticMeshOrientation(iTileTypeID)
-					-- ApplyStaticEntityHue(entity,iHue)		=

-					entity:SetUserObject(1,2,3,4,5) -- for mousepicking
-					entity.x =3D originoffx+x*8+iX
-					entity.y =3D originoffy+y*8+iY
-					entity.z =3D iZ*0.1 + gZ_Factor		--0.01
-					entity.iBlockX =3D chunk_abs_x+x OBSOLETE !
-					entity.iBlockY =3D chunk_abs_y+y OBSOLETE !
-					entity.id =3D i
-					entity.iTileTypeID =3D iTileTypeID
-					entity.iHue =3D iHue
-					table.insert(chunk.lStaticEntities,entity)
-					chunk.pStaticGeometryTerrain:AddEntity(entity,entity.x,entity.y,entit=
y.z,qw,qx,qy,qz,-1,1,1)
-				end
-				]]--
 			end =

 	end end
 	=

@@ -172,8 +153,6 @@
 			print(obj.amount,sprintf("0x%04x",obj.typeid),obj.typeid,obj.typeobj.ms=
Name,polycount)
 		end
 	end
-	=

-	=

 	print("total statics ",total_static_count)
 	Crash()
 end
@@ -198,7 +177,6 @@
 		fifo_out:Clear()
 	end
 end
-
 =

 -- test if lua can perform bitwise operations correctly
 function LuaBitwiseTest ()
@@ -363,7 +341,6 @@
 	Crash()
 end
 =

-
 function TestUniFontLoader()
 	print(CreateUniFontLoader)
 	l =3D CreateUniFontLoader(CorrectPath(gUOPath.."unifont2.mul"))

Modified: trunk/data/lua/net.walk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.walk.lua (original)
+++ trunk/data/lua/net.walk.lua Wed Sep 19 01:32:46 2007
@@ -203,7 +203,7 @@
 		local dy =3D gAutoWalkY - y
 		if ((dx =3D=3D 0 and dy =3D=3D 0) or (gAutoWalkHaltBefore and math.abs(d=
x) <=3D 1 and math.abs(dy) <=3D 1)) then =

 			CancelAutoWalk()
-			print("autowalk canceled dx=3D"..dx.." dy=3D"..dy)
+			printdebug("walking","autowalk canceled dx=3D"..dx.." dy=3D"..dy)
 		else =

 			if (dx < 0) then dx =3D -1 end
 			if (dx > 0) then dx =3D 1 end
@@ -245,12 +245,12 @@
 function CancelAutoWalk () =

 	gAutoWalk =3D false
 	gAutoWalkHaltBefore =3D false
-	=

+
 	-- attack the follow target if warmode is activated
 	if (gActWarmode =3D=3D gWarmode_Combat) then
-		--print("#################################",gFollowMobile)
+		printdebug("walking","attack the following mobile: "..gFollowMobile)
 		if (gFollowMobile ~=3D 0) then
-			printf("CancelAutoWalk Follow Attack: serial=3D0x%08x\n",gFollowMobile)
+			printdebug("walking",sprintf("CancelAutoWalk Follow Attack: serial=3D0x=
%08x\n",gFollowMobile))
 			Send_AttackReq(gFollowMobile)
 		end
 	end
@@ -268,8 +268,9 @@
 	local fastwalkkey =3D gFastwalkStack[0]
 	if (fastwalkkey) then
 		table.remove(gFastwalkStack, 0)
-		printf("FastwalkKey removed: 0x%08x\n",fastwalkkey)
-		printf("gFastwalkStack: Number: %i\n", table.getn(gFastwalkStack)+1)
+		printdebug("walking",sprintf("FastwalkKey removed: 0x%08x\n",fastwalkkey=
))
+		printdebug("walking",sprintf("gFastwalkStack: Number: %i\n", table.getn(=
gFastwalkStack)+1))
+
 		return fastwalkkey
 	else
 		return 0
@@ -307,10 +308,10 @@
 			gNextWalkTime =3D gMyTicks + CalculateWalkTimeout(bRunning)
 		end
 		=

-		-- print("WALK IS possible",timeout,gMyTicks,gNextWalkTime)
+		--printdebug("walking",sprintf("WALK IS possible",timeout,gMyTicks,gNext=
WalkTime))
 	else
 		-- to many walk requests, ill ignore this one
-		-- print("WALK NOT possible",timeout,gMyTicks,gNextWalkTime)
+		--printdebug("walking",sprintf("WALK NOT possible",timeout,gMyTicks,gNex=
tWalkTime))
 		return
 	end
 	=

@@ -468,7 +469,7 @@
 		for k,v in pairs(gMoveQueue) do pending_walk_request =3D pending_walk_re=
quest + 1 end
 		=

 		if (pending_walk_request > gMaxPendingWalkRequests) then
-			print("too many walk requests pending, requesting resync")
+			printdebug("walking","too many walk requests pending, requesting resync=
")
 			Send_Movement_Resync_Request()
 		else
 			request.iSeqNum =3D gNextWalkSequenceNumber
@@ -507,11 +508,11 @@
 -- This Packet is send when Client thinks he is out of Sync (basicly: sequ=
ence doesn't fit)
 -- The proper response from the server is a Teleport packet kPacket_Telepo=
rt
 function Send_Movement_Resync_Request()
-	print("NET: Movement_Resync_Request")
+	printdebug("walking","NET: Movement_Resync_Request")
 	ResetWalkQueue()
 	if (gLastResyncRequest and gMyTicks - gLastResyncRequest < gLastResyncReq=
uestTimeout) then return end
 	gLastResyncRequest =3D gMyTicks
-	print("NET: Movement_Resync_Request (sending)")
+	printdebug("walking","NET: Movement_Resync_Request (sending)")
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_Accept_Movement_Resync_Request)
 	out:PushNetUint8(0)
@@ -536,7 +537,7 @@
 			if (gLastWalkRequest.iSeqNum =3D=3D iSeqNum) then gLastWalkRequest =3D =
nil end
 		end
 	else
-		printf("NET: Accept_Movement_Resync_Request: OUTofSYNC! seqnumber : %i\n=
",iSeqNum)
+		printdebug("walking",sprintf("NET: Accept_Movement_Resync_Request: OUTof=
SYNC! seqnumber : %i\n",iSeqNum))
 		Send_Movement_Resync_Request()	-- is this correct? please test
 	end
 =

@@ -593,11 +594,11 @@
 	if (gPlayerXLoc ~=3D player_xloc or gPlayerYLoc ~=3D player_yloc or
 		gPlayerZLoc ~=3D player_zloc or gPlayerDir ~=3D player_dir) then
 =

-		printf("Block_Movement seqnumber=3D%d player_dir=3D%d\n",seqnumber,playe=
r_dir)
+		printdebug("walking",sprintf("Block_Movement seqnumber=3D%d player_dir=
=3D%d\n",seqnumber,player_dir))
 		gCurrentRenderer:ClientSideMobileAnimPlayerTeleported()
 		SetPlayerPos(player_xloc,player_yloc,player_zloc,fullplayerdir)
 	else
-		print("Player not teleported, because already on the same pos+dir")
+		printdebug("walking","Player not teleported, because already on the same=
 pos+dir")
 	end
 =

 	Send_Accept_Block_Movement(seqnumber)
@@ -622,7 +623,7 @@
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
 	local player_dir =3D input:PopNetUint8()
-	printf("NET (todo): Move_Player id: %i player_dir: %i\n",id, player_dir)
+	printdebug("walking",sprintf("NET (todo): Move_Player id: %i player_dir: =
%i\n",id, player_dir))
 end
 =

 --[[

Modified: trunk/data/lua/net/net.effect.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.effect.lua (original)
+++ trunk/data/lua/net/net.effect.lua Wed Sep 19 01:32:46 2007
@@ -30,9 +30,9 @@
 	effect.rendermode =3D input:PopNetUint32()
 	effect.iseffect =3D true
 	=

-	printdebug("NET", "Hued_FX: artid=3D0x%04x locx=3D%i locy=3D%i locz=3D%i =
targetx=3D%i targety=3D%i targetz=3D%i effect_type=3D%s\n",
+	printdebug("net", sprintf("Hued_FX: artid=3D0x%04x locx=3D%i locy=3D%i lo=
cz=3D%i targetx=3D%i targety=3D%i targetz=3D%i effect_type=3D%s\n",
 			effect.itemid, effect.source_locx, effect.source_locy, effect.source_lo=
cz,
-			effect.target_locx, effect.target_locy, effect.target_locz, gEffectType=
s[effect.effect_type] or "")
+			effect.target_locx, effect.target_locy, effect.target_locz, gEffectType=
s[effect.effect_type]) )
 	=

 	if (gParticleEffectSystem) then gCurrentRenderer:AddEffect( effect ) end
 end

Modified: trunk/data/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.container.lua (original)
+++ trunk/data/lua/obj/obj.container.lua Wed Sep 19 01:32:46 2007
@@ -67,7 +67,7 @@
 function HandleOpenContainer	(containerdata)
 	--containerdata.serial
 	--containerdata.gumpid
-	print("# HandleOpenContainer",containerdata.serial,containerdata.gumpid)
+	--print("# HandleOpenContainer",containerdata.serial,containerdata.gumpid)
 	=

 	--Ignore Shop container - created somewhere else
 	if (containerdata.gumpid =3D=3D kGumpIDShopContainer) then

Modified: trunk/data/lua/obj/obj.player.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.player.lua (original)
+++ trunk/data/lua/obj/obj.player.lua Wed Sep 19 01:32:46 2007
@@ -56,7 +56,7 @@
 -- only available some time after login, see PlayerEquipmentUpdated()
 function TogglePlayerBackpack ()
 	if (gPlayerBackPack) then
-		if (IsContainerAlreadyOpen(gPlayerBackPack)) then
+		if (IsContainerAlreadyOpen(gPlayerBackPack.serial)) then
 			-- close backpack
 			CloseContainer(gPlayerBackPack.serial)
 		else



From no-reply at zwischenwelt.org  Wed Sep 19 20:43:41 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 19 Sep 2007 18:43:41 -0000
Subject: [Iris-commit] [IRIS] r1395 - in /trunk: bin/
	data/terrain/materials/ vc8/
Message-ID: <20070919184342.446DB1524004@zwischenwelt.org>

Author: sience
Date: Wed Sep 19 20:43:41 2007
New Revision: 1395

Log:
-binary build switched back to visual studio 8 (sp1)
-vs8 project updated
-terrain.material updated

Modified:
    trunk/bin/OIS.dll
    trunk/bin/OgreMain.dll
    trunk/bin/Plugin_CgProgramManager.dll
    trunk/bin/Plugin_OctreeSceneManager.dll
    trunk/bin/Plugin_ParticleFX.dll
    trunk/bin/RenderSystem_Direct3D9.dll
    trunk/bin/RenderSystem_GL.dll
    trunk/bin/iris2.exe
    trunk/data/terrain/materials/terrain.material
    trunk/vc8/iris.vcproj

Modified: trunk/bin/OIS.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/OgreMain.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/Plugin_CgProgramManager.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/Plugin_OctreeSceneManager.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/Plugin_ParticleFX.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/RenderSystem_Direct3D9.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/RenderSystem_GL.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Wed Sep 19 20:43:41 2007
@@ -300,6 +300,15 @@
 material tileid_1911 : base_dirt
 {
 }
+material tileid_16377 : base_dirt
+{
+}
+material tileid_16378 : base_dirt
+{
+}
+material tileid_16379 : base_dirt
+{
+}
 //__________________________________________________________
 //grass
 material tileid_3 : base_grass

Modified: trunk/vc8/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vc8/iris.vcproj (original)
+++ trunk/vc8/iris.vcproj Wed Sep 19 20:43:41 2007
@@ -124,8 +124,8 @@
 				OmitFramePointers=3D"true"
 				EnableFiberSafeOptimizations=3D"false"
 				WholeProgramOptimization=3D"true"
-				AdditionalIncludeDirectories=3D"&quot;C:\Programme\Microsoft Platform =
SDK\Include\&quot;;&quot;$(OGRE_HOME)\include\&quot;;&quot;$(OGRE_HOME)\inc=
lude\OIS\&quot;;..\include\;..\include\zlib;..\include\fmodx;..\include\lua=
;..\lugre\include"
-				PreprocessorDefinitions=3D"WIN32"
+				AdditionalIncludeDirectories=3D"&quot;$(INCLUDE)&quot;;&quot;$(OGRE_HO=
ME)\include\&quot;;&quot;$(OGRE_HOME)\include\OIS\&quot;;..\include\;..\inc=
lude\zlib;..\include\fmodx;..\include\lua;..\lugre\include"
+				PreprocessorDefinitions=3D"WIN32;USE_FMOD;MAIN_WORKING_DIR=3D\&quot;..=
/\&quot;"
 				RuntimeLibrary=3D"0"
 				EnableEnhancedInstructionSet=3D"1"
 				FloatingPointModel=3D"0"
@@ -145,9 +145,9 @@
 			/>
 			<Tool
 				Name=3D"VCLinkerTool"
-				AdditionalDependencies=3D"LIBCMT.lib LIBCPMT.LIB AdvAPI32.Lib User32.L=
ib zlib.lib ws2_32.lib LibLua+CRT.lib LibLuaLib+CRT.lib OgreMain.lib SDL.li=
b OIS.lib fmodex_vc.lib"
+				AdditionalDependencies=3D"LIBCMT.lib LIBCPMT.LIB AdvAPI32.Lib User32.L=
ib zlib.lib ws2_32.lib LibLua+CRT.lib LibLuaLib+CRT.lib OgreMain.lib OIS.li=
b fmodex_vc.lib"
 				OutputFile=3D"$(OutDir)\..\..\bin\iris2.exe"
-				AdditionalLibraryDirectories=3D"&quot;C:\Programme\Microsoft Platform =
SDK\Lib\&quot;;&quot;$(OGRE_HOME)\lib\&quot;;..\libs\fmodx;..\libs\zlib;..\=
libs\lua"
+				AdditionalLibraryDirectories=3D"&quot;$(LIB)&quot;;&quot;$(OGRE_HOME)\=
lib\&quot;;..\libs\fmodx;..\libs\zlib;..\libs\lua"
 				GenerateManifest=3D"true"
 				IgnoreAllDefaultLibraries=3D"true"
 				IgnoreDefaultLibraryNames=3D""
@@ -503,6 +503,14 @@
 			</File>
 			<File
 				RelativePath=3D"..\lugre\src\lugre_sound_L.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_thread.cpp"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\src\lugre_thread_L.cpp"
 				>
 			</File>
 			<File
@@ -750,6 +758,10 @@
 				>
 			</File>
 			<File
+				RelativePath=3D"..\lugre\include\lugre_thread.h"
+				>
+			</File>
+			<File
 				RelativePath=3D"..\lugre\include\lugre_timer.h"
 				>
 			</File>



From no-reply at zwischenwelt.org  Sat Sep 22 18:20:46 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 22 Sep 2007 16:20:46 -0000
Subject: [Iris-commit] [IRIS] r1396 - in /trunk: ./ bin/ data/
	license_lugre.txt screenshots/
Message-ID: <20070922162046.DD4671C1812B@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Sep 22 18:20:45 2007
New Revision: 1396

Log:
some svn ignore options added

Added:
    trunk/license_lugre.txt
Modified:
    trunk/   (props changed)
    trunk/bin/   (props changed)
    trunk/data/   (props changed)
    trunk/screenshots/   (props changed)



From no-reply at zwischenwelt.org  Sun Sep 23 03:04:18 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Sep 2007 01:04:18 -0000
Subject: [Iris-commit] [IRIS] r1397 - /trunk/data/lua/obj/obj.container.lua
Message-ID: <20070923010418.A89681C1812B@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Sep 23 03:04:17 2007
New Revision: 1397

Log:
fixed rightclick close container

Modified:
    trunk/data/lua/obj/obj.container.lua

Modified: trunk/data/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.container.lua (original)
+++ trunk/data/lua/obj/obj.container.lua Sun Sep 23 03:04:17 2007
@@ -106,10 +106,8 @@
 		dialog.rootwidget.gfx:SetPos(200,100) -- TODO : choose position
 		dialog.backpane =3D MakeBorderGumpPart(dialog.rootwidget,container.gumpi=
d,0,0)
 		dialog.backpane.mbIgnoreMouseOver =3D false
-		dialog.backpane.onMouseDown =3D function (widget,mousebutton)
-										if (mousebutton =3D=3D 2) then CloseContainer(widget.dialog.uoCo=
ntainer.serial) end
-										if (mousebutton =3D=3D 1) then widget.dialog:BringToFront() gui.=
StartMoveDialog(widget.dialog.rootwidget) end
-									  end
+		dialog.backpane.on_mouse_right_down	=3D function (widget) CloseContainer=
(widget.dialog.uoContainer.serial) end
+		dialog.backpane.on_mouse_left_down	=3D function (widget) widget.dialog:B=
ringToFront() gui.StartMoveDialog(widget.dialog.rootwidget) end
 	end
 	RefreshContainerItemWidgets(container)
 =




From no-reply at zwischenwelt.org  Sun Sep 23 16:21:13 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Sep 2007 14:21:13 -0000
Subject: [Iris-commit] [IRIS] r1398 - in /trunk/data: lua/lib.keybinds.lua
 lua/net.other.lua lua/obj/obj.container.lua lua/obj/obj.main.lua
 lua/obj/obj.mobile.lua models/materials/armoire.material
Message-ID: <20070923142113.B7DE81C18164@zwischenwelt.org>

Author: sience
Date: Sun Sep 23 16:21:12 2007
New Revision: 1398

Log:
-some initial overhead message stuff improved
-gridscreenshoot improved
-some comments moved to wiki

Modified:
    trunk/data/lua/lib.keybinds.lua
    trunk/data/lua/net.other.lua
    trunk/data/lua/obj/obj.container.lua
    trunk/data/lua/obj/obj.main.lua
    trunk/data/lua/obj/obj.mobile.lua
    trunk/data/models/materials/armoire.material

Modified: trunk/data/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.keybinds.lua (original)
+++ trunk/data/lua/lib.keybinds.lua Sun Sep 23 16:21:12 2007
@@ -20,37 +20,17 @@
 		end =

 	end)
 	Bind("v",		function (state) if (not gActiveEditText) then if (state > 0) =
then Client_TakeScreenshot(gMainWorkingDir.."screenshots/") end end end)
-	Bind("f12",		function (state) if (not gActiveEditText) then if (state > 0=
) then Client_TakeGridScreenshot(gMainWorkingDir.."screenshots/") end end e=
nd)
-	=

-	Bind("f2",		function (state) if (not gActiveEditText) then if (state > 0)=
 then =

-		local mobile =3D GetPlayerMobile()
-		if mobile then
-			local effect =3D {}
-			effect.source_locx =3D mobile.xloc
-			effect.source_locy =3D mobile.yloc
-			effect.source_locz =3D mobile.zloc
+	Bind("f12",		function (state) if (not gActiveEditText) then if (state > 0=
) then
+		ToggleCompass(state > 0)
+		Client_TakeGridScreenshot(gMainWorkingDir.."screenshots/")
+		ToggleCompass(state > 0)
+	end end end)
 =

-			effect.current_locx =3D mobile.xloc
-			effect.current_locy =3D mobile.yloc
-			effect.current_locz =3D mobile.zloc
-
-			effect.target_locx =3D mobile.xloc + 10
-			effect.target_locy =3D mobile.yloc + 1
-			effect.target_locz =3D mobile.zloc + 2
-			=

-			effect.speed =3D 5
-			effect.duration =3D 0
-			=

-			effect.itemid =3D hex2num("0x376A")
-			gCurrentRenderer:AddEffect(effect)
-		end
-	end end end)
-	=

 	-- additional movement key handling in WalkStep() (for pressed keys)
 	Bind("right",   function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end end end) =

 	Bind("left",    function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end end end) =

 	Bind("down",    function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else if (state > 0) then gui.HistoryUpDown(-=
1) end end end) =

-	Bind("up",              function (state) if (not gActiveEditText) then if=
 (state > 0) then CancelAutoWalk() end else if (state > 0) then gui.History=
UpDown(1) end end end) =

+	Bind("up",      function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else if (state > 0) then gui.HistoryUpDown(1=
) end end end) =

 	Bind("u",		function (state) if (not gActiveEditText) then if (state > 0) =
then SetAutoWalkTarget() end end end)
 	=

 	-- toggel gumps
@@ -80,7 +60,10 @@
 	Bind("f10",		function (state) if (not gActiveEditText) then if (state > 0=
) then ShowDevTool() end end end)
 	Bind("f11",		function (state) if (not gActiveEditText) then if ((state > =
0) and (gCurrentRenderer =3D=3D Renderer3D)) then ShowFallBackTool() end en=
d end)
 	Bind("tab",		function (state) if (state > 0) then if (gActWarmode=3D=3DgW=
armode_Normal) then Send_CombatMode(gWarmode_Combat) else Send_CombatMode(g=
Warmode_Normal) end end end)
-	Bind("m",		function (state) if (not gActiveEditText) then if (state > 0) =
then Mobile_DisplayTextOverHead(gPlayerBodySerial,"bla bla bla") end end en=
d)
+	Bind("m",		function (state) if (not gActiveEditText) then if (state > 0) =
then
+		local player=3DGetMobile(gPlayerBodySerial)
+		if player then player:DisplayTextOverHead("bla bla bla",10,10,10) end
+	end end end)
 =

 	Bind("f7",		function (state) if (not gActiveEditText) then if (state > 0)=
 then
 		if (gAmbientColor.r < 1.0) then
@@ -95,7 +78,7 @@
 		print("gAmbientColor.r=3D"..gAmbientColor.r)
 		Client_SetAmbientLight(gAmbientColor.r, gAmbientColor.g, gAmbientColor.b=
, 1)
  	end end end)
-		Bind("f8",		function (state) if (not gActiveEditText) then if (state > 0=
) then
+		Bind("f8",	function (state) if (not gActiveEditText) then if (state > 0)=
 then
 		if (gAmbientColor.r > 0.1) then
 			gAmbientColor.r=3DgAmbientColor.r-0.1
 			gAmbientColor.g=3DgAmbientColor.g-0.1
@@ -128,7 +111,29 @@
 			--local playermobile =3D GetPlayerMobile()
 			--if (playermobile) then  gAutoTargetMobile =3D playermobile  end =

 		end end end)
-		Bind("f2",		function (state) if (not gActiveEditText) then if (state > 0=
) then Send_Speech(commandchar.."self resurrect") end end end)
+		Bind("f2",		function (state) if (not gActiveEditText) then if (state > 0=
) then =

+			local mobile =3D GetPlayerMobile()
+			if mobile then
+				local effect =3D {}
+				effect.source_locx =3D mobile.xloc
+				effect.source_locy =3D mobile.yloc
+				effect.source_locz =3D mobile.zloc
+	=

+				effect.current_locx =3D mobile.xloc
+				effect.current_locy =3D mobile.yloc
+				effect.current_locz =3D mobile.zloc
+	=

+				effect.target_locx =3D mobile.xloc + 10
+				effect.target_locy =3D mobile.yloc + 1
+				effect.target_locz =3D mobile.zloc + 2
+				=

+				effect.speed =3D 5
+				effect.duration =3D 0
+				=

+				effect.itemid =3D hex2num("0x376A")
+				gCurrentRenderer:AddEffect(effect)
+			end
+		end end end)
 		Bind("f3",		function (state) if (not gActiveEditText) then if (state > 0=
) then Send_Speech(commandchar.."add wallofstoneeast") end end end)
 		Bind("f4",		function (state) if (not gActiveEditText) then if (state > 0=
) then Send_Speech(commandchar.."remove") end end end)
 		Bind("f5",		function (state) if (not gActiveEditText) then if (state > 0=
) then Send_Speech(commandchar.."tele") end end end)

Modified: trunk/data/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.other.lua (original)
+++ trunk/data/lua/net.other.lua Sun Sep 23 16:21:12 2007
@@ -374,7 +374,7 @@
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
 	local size =3D input:PopNetUint16()
-	local text_item_serial =3D input:PopNetUint32()
+	local mobile_serial =3D input:PopNetUint32()
 	local text_item_model =3D input:PopNetUint16() -- model ? artid ?
 	local text_type =3D input:PopNetUint8()
 	local text_color =3D input:PopNetUint16()
@@ -382,19 +382,21 @@
 	local text_charname =3D input:PopFilledString(30)
 	local text_message =3D input:PopFilledString(size-44)
 	=

-	Mobile_NameHint(text_item_serial,text_item_model,text_charname,text_messa=
ge)
-
-	if (text_item_serial =3D=3D hex2num("0xffffffff") and text_item_model =3D=
=3D hex2num("0xffff")) then
-		printf("NET: System Message %s:%s\n",text_charname,text_message)
-		-- System Message
-	end
-
-	printf("NET: Text id: 0x%08x model id: 0x%08x Message: %s\n",text_item_se=
rial,text_item_model,text_message)
+	Mobile_NameHint(mobile_serial,text_item_model,text_charname,text_message)
+
+	-- check if System Message
+	if (mobile_serial =3D=3D hex2num("0xffffffff") and text_item_model =3D=3D=
 hex2num("0xffff")) then
+		printdebug("net",sprintf("NET: System Message %s:%s\n",text_charname,tex=
t_message) )
+		return
+	end
+
+	printdebug("net",sprintf("NET: Text id: 0x%08x model id: 0x%08x Message: =
%s\n",mobile_serial,text_item_model,text_message) )
 	local plaintext =3D string.gsub(text_message,"<br>","\n")
 	AddFadeLines(sprintf("%s: %s",text_charname,plaintext)) -- TODO : color,f=
ont,...
 	=

-	Mobile_DisplayTextOverHead(text_item_serial,string.gsub(text_message,"<br=
>","\n"),Uo16Color2Rgb(text_color))
-	=

+	-- check if player -> then show text over player head
+	local mobilespeaker=3DGetMobile(mobile_serial)
+	if (mobilespeaker) then mobilespeaker:DisplayTextOverHead(string.gsub(tex=
t_message,"<br>","\n"),Uo16Color2Rgb(text_color)) end
 	-- TODO : text_item ?!?
 	-- TODO : JournalAddEntry(somefunc(text_type),text_charname,text_message)
 end
@@ -465,7 +467,7 @@
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
 	local unitext_size =3D input:PopNetUint16()
-	local unitext_speakerid =3D input:PopNetUint32()
+	local mobile_serial =3D input:PopNetUint32()
 	local unitext_item_model =3D input:PopNetUint16()
 	local unitext_type =3D input:PopNetUint8()
 	local unitext_hue =3D input:PopNetUint16()	=

@@ -474,14 +476,14 @@
 	local unitext_name =3D input:PopFilledString(30)
 	local unitext_message =3D input:PopUnicodeString((unitext_size-48)/2)
 =

-	Mobile_NameHint(unitext_speakerid,unitext_item_model,unitext_name,unitext=
_message)
- =

-	printf("NET: UnicodeText speakerid: %i name: %s txtsize: %i msg: %s\n",un=
itext_speakerid,unitext_name,(unitext_size-48)/2,unitext_message)
+	Mobile_NameHint(mobile_serial,unitext_item_model,unitext_name,unitext_mes=
sage)
+	printdebug("net",sprintf("NET: UnicodeText speakerid: %i name: %s txtsize=
: %i msg: %s\n",mobile_serial,unitext_name,(unitext_size-48)/2,unitext_mess=
age) )
 	AddFadeLines(unitext_name..": "..string.gsub(unitext_message,"<br>","\n")=
) -- TODO : unicode
 	-- TODO : JournalAddEntry(somefunc(text_type),text_charname,text_message)
-	=

-	-- show text over player head
-	Mobile_DisplayTextOverHead(unitext_speakerid,string.gsub(unitext_message,=
"<br>","\n"),Uo16Color2Rgb(unitext_hue))
+
+	-- check if player -> then show text over player head
+	local mobilespeaker=3DGetMobile(mobile_serial)
+	if (mobilespeaker) then mobilespeaker:DisplayTextOverHead(string.gsub(uni=
text_message,"<br>","\n"),Uo16Color2Rgb(unitext_hue)) end
 end
 =

 -- TODO : question : ghoulsblade : is this only for combat ? sience: don't=
 know -> verify

Modified: trunk/data/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.container.lua (original)
+++ trunk/data/lua/obj/obj.container.lua Sun Sep 23 16:21:12 2007
@@ -30,10 +30,6 @@
 	object.container =3D self
 	self:UpdateContent()
 end
-
-
-
-
 =

 -- called from kPacket_Equip_Item
 function HandleEquipItem	(dynamicdata)

Modified: trunk/data/lua/obj/obj.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.main.lua (original)
+++ trunk/data/lua/obj/obj.main.lua Sun Sep 23 16:21:12 2007
@@ -1,62 +1,62 @@
 dofile(libpath .. "obj/obj.mobile.lua")
 dofile(libpath .. "obj/obj.dynamic.lua")
-dofile(libpath .. "obj/obj.player.lua")
+dofile(libpath .. "obj/obj.player.lua")
 dofile(libpath .. "obj/obj.container.lua")
-
-gObjectList =3D {}
-gDynamics =3D {}
-gMobiles =3D {}
-
-function GetMobileEquipmentItem (mobile,layer) return mobile:GetEquipmentA=
tLayer(layer) end
-function GetMobileEquipmentList (mobile) return mobile:GetContent() end
-function GetContainerContentList (container) return container:GetContent()=
 end
-function GetObjectBySerial (serial) return GetObject(serial) end
-function GetObject (object_or_serial) =

-	if (not object_or_serial) then return nil end
-	if (type(object_or_serial) =3D=3D "table") then return object_or_serial e=
nd
-	return gObjectList[object_or_serial] -- look up by serial
-end
-
-function DynamicIsInWorld (dynamic) return not dynamic.container end  -- d=
oes not have parent container
-
-function GetDynamicList	() return gDynamics end
-function GetMobileList	() return gMobiles end
-
-function InitializeObject	(serial) =

-	local object =3D {serial=3Dserial} =

-	gObjectList[serial] =3D object
-	return object
-end
-
-
-
--- don't call directly, called from object:Destroy()
-function CleanupObject	(object)
-	local serial =3D object.serial
-	=

-	CloseContainer(serial)
-	object:DestroyContent()
-	=

-	DestroyPaperdollByMobileSerial(serial)
-	DestroyDragDropItemBySerial(serial)
-	gCurrentRenderer:DestroyMousePickItemBySerial(serial)
-	=

-	gObjectList[object.serial] =3D nil =

-	--object.serial =3D nil -- seems to cause a lot of trouble if set to nil,=
 e.g. dragdrop
-	object.bIsDead =3D true
-end
-
-
-
-function DestroyObjectBySerial (serial) =

-	local object =3D GetObject(serial)
-	if (object) then object:Destroy() end
-end
-
--- needed for mapchange
-function DestroyAllObjects () =

-	CancelUODragDrop()
-	for k,object in pairs(gObjectList) do object:Destroy() end
-end
-
-
+
+gObjectList =3D {}
+gDynamics =3D {}
+gMobiles =3D {}
+
+function GetMobileEquipmentItem (mobile,layer) return mobile:GetEquipmentA=
tLayer(layer) end
+function GetMobileEquipmentList (mobile) return mobile:GetContent() end
+function GetContainerContentList (container) return container:GetContent()=
 end
+function GetObjectBySerial (serial) return GetObject(serial) end
+function GetObject (object_or_serial) =

+	if (not object_or_serial) then return nil end
+	if (type(object_or_serial) =3D=3D "table") then return object_or_serial e=
nd
+	return gObjectList[object_or_serial] -- look up by serial
+end
+
+function DynamicIsInWorld (dynamic) return not dynamic.container end  -- d=
oes not have parent container
+
+function GetDynamicList	() return gDynamics end
+function GetMobileList	() return gMobiles end
+
+function InitializeObject	(serial) =

+	local object =3D {serial=3Dserial} =

+	gObjectList[serial] =3D object
+	return object
+end
+
+
+
+-- don't call directly, called from object:Destroy()
+function CleanupObject	(object)
+	local serial =3D object.serial
+	=

+	CloseContainer(serial)
+	object:DestroyContent()
+	=

+	DestroyPaperdollByMobileSerial(serial)
+	DestroyDragDropItemBySerial(serial)
+	gCurrentRenderer:DestroyMousePickItemBySerial(serial)
+	=

+	gObjectList[object.serial] =3D nil =

+	--object.serial =3D nil -- seems to cause a lot of trouble if set to nil,=
 e.g. dragdrop
+	object.bIsDead =3D true
+end
+
+
+
+function DestroyObjectBySerial (serial) =

+	local object =3D GetObject(serial)
+	if (object) then object:Destroy() end
+end
+
+-- needed for mapchange
+function DestroyAllObjects () =

+	CancelUODragDrop()
+	for k,object in pairs(gObjectList) do object:Destroy() end
+end
+
+

Modified: trunk/data/lua/obj/obj.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.mobile.lua (original)
+++ trunk/data/lua/obj/obj.mobile.lua Sun Sep 23 16:21:12 2007
@@ -319,40 +319,6 @@
 	gCurrentRenderer:MobileStartServerSideAnim(animdata)
 end
 =

-
-
-
---[[
-mobile.notoriety: =

-	0 =3D invalid/across server line
-	1 =3D innocent (blue)
-	2 =3D guilded/ally (green)
-	3 =3D attackable but not criminal (gray)
-	4 =3D criminal (gray)
-	5 =3D enemy (orange)
-	6 =3D murderer (red)
-	7 =3D unknown use (translucent (like 0x4000 hue)) =

-Status/flag in kPacket_Naked_MOB
-	Normal =3D 0x00,
-	Unknown =3D 0x01,
-	CanAlterPaperdoll =3D 0x02,
-	Poisoned =3D 0x04,
-	YellowHits aka GoldenHealth =3D 0x08,
-	Unknown2 =3D 0x10,
-	Unknown3 =3D 0x20,
-	WarMode =3D 0x40,
-	Hidden =3D 0x80
-Mobile Flag Byte: maybe those are similar to the kPacket_Show_Item flag/st=
atus byte ?
-	0x00 - None
-	0x02 - Female
-	0x04 - Poisoned
-	0x08 - YellowHits aka GoldenHealth // healthbar gets yellow
-	0x10 - FactionShip // unsure why client needs to know
-	0x20 - Movable if normally not
-	0x40 - War mode
-	0x80 - Hidden =

-]]--
-
 -- return r,g,b
 function GetNotorietyColor (n)
 	if (n =3D=3D  0) then return 0.0 , 0.0 , 0.0 end -- 0.0 =3D invalid/acros=
s server line

Modified: trunk/data/models/materials/armoire.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/armoire.material (original)
+++ trunk/data/models/materials/armoire.material Sun Sep 23 16:21:12 2007
@@ -5,15 +5,13 @@
 	{
 		pass
 		{
-			lighting on
+			//lighting on
 			ambient 1.0 1.0 1.0
 			diffuse 1.0 1.0 1.0
 			=

 			// needed for xmirror fix
 			//cull_hardware anticlockwise
 			//cull_software front
-			cull_hardware none
-			cull_software none
 			=

 			texture_unit
 			{
@@ -31,15 +29,13 @@
 	{
 		pass
 		{
-			lighting on
+			//lighting on
 			ambient 1.0 1.0 1.0
 			diffuse 1.0 1.0 1.0
 			=

 			// needed for xmirror fix
 			//cull_hardware anticlockwise
 			//cull_software front
-			cull_hardware none
-			cull_software none
 			=

 			texture_unit
 			{



From no-reply at zwischenwelt.org  Sun Sep 23 18:16:32 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Sep 2007 16:16:32 -0000
Subject: [Iris-commit] [IRIS] r1399 - /trunk/data/lua/lib.debugmenu.lua
Message-ID: <20070923161633.090E71C18164@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Sep 23 18:16:32 2007
New Revision: 1399

Log:
fixed model debug menu

Modified:
    trunk/data/lua/lib.debugmenu.lua

Modified: trunk/data/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.debugmenu.lua (original)
+++ trunk/data/lua/lib.debugmenu.lua Sun Sep 23 18:16:32 2007
@@ -25,6 +25,8 @@
 end
 =

 gDebugTestMobiles =3D {
+	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
+	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
 	{artid=3D 292 , content=3D{}}, --broken llamas_llama_pack (crash) -> mapp=
ed to id: 220
 =

 	{artid=3D hex2num("0xA9") , content=3D{}}, --169 broken horse
@@ -131,6 +133,12 @@
 	{artid=3D1490, content=3D{}},  -- sash, texcoords broken ? culling? (fixe=
d)
 	]]--
 }
+for k,mobile in pairs(gDebugTestMobiles) do =

+	mobile.GetContent 			=3D function (self) 			return self.content end =

+	mobile.GetEquipmentAtLayer	=3D function (self,layer)		=

+		for k,arr in pairs(self.content) do if (GetPaperdollLayerFromTileType(ar=
r.artid) =3D=3D layer) then return arr end end
+	end =

+end
 =

 -- 0:none 1:normal 2:invert 3:sample 4:sample-invert		-- bonestart
 -- 0:nothin 1:q 2:q.Inverse()							-- translationchange



From no-reply at zwischenwelt.org  Sun Sep 23 18:26:27 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Sep 2007 16:26:27 -0000
Subject: [Iris-commit] [IRIS] r1400 - in /trunk/data/lua: lib.keybinds.lua
	net.other.lua
Message-ID: <20070923162627.895D81C18164@zwischenwelt.org>

Author: sience
Date: Sun Sep 23 18:26:26 2007
New Revision: 1400

Log:
-small fixed
-ChatLine_HistoryUpDown doesn work yet

Modified:
    trunk/data/lua/lib.keybinds.lua
    trunk/data/lua/net.other.lua

Modified: trunk/data/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.keybinds.lua (original)
+++ trunk/data/lua/lib.keybinds.lua Sun Sep 23 18:26:26 2007
@@ -29,8 +29,8 @@
 	-- additional movement key handling in WalkStep() (for pressed keys)
 	Bind("right",   function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end end end) =

 	Bind("left",    function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end end end) =

-	Bind("down",    function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else if (state > 0) then gui.HistoryUpDown(-=
1) end end end) =

-	Bind("up",      function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else if (state > 0) then gui.HistoryUpDown(1=
) end end end) =

+	Bind("down",    function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else if (state > 0) then ChatLine_HistoryUpD=
own(-1) end end end) =

+	Bind("up",      function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else if (state > 0) then ChatLine_HistoryUpD=
own(1) end end end)
 	Bind("u",		function (state) if (not gActiveEditText) then if (state > 0) =
then SetAutoWalkTarget() end end end)
 	=

 	-- toggel gumps

Modified: trunk/data/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.other.lua (original)
+++ trunk/data/lua/net.other.lua Sun Sep 23 18:26:26 2007
@@ -387,7 +387,6 @@
 	-- check if System Message
 	if (mobile_serial =3D=3D hex2num("0xffffffff") and text_item_model =3D=3D=
 hex2num("0xffff")) then
 		printdebug("net",sprintf("NET: System Message %s:%s\n",text_charname,tex=
t_message) )
-		return
 	end
 =

 	printdebug("net",sprintf("NET: Text id: 0x%08x model id: 0x%08x Message: =
%s\n",mobile_serial,text_item_model,text_message) )



From no-reply at zwischenwelt.org  Mon Sep 24 23:34:53 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 24 Sep 2007 21:34:53 -0000
Subject: [Iris-commit] [IRIS] r1401 - /trunk/data/lua/lib.keybinds.lua
Message-ID: <20070924213453.B3C9C1C18171@zwischenwelt.org>

Author: sience
Date: Mon Sep 24 23:34:51 2007
New Revision: 1401

Log:
-bugfix from hagish for last chatline repeat

Modified:
    trunk/data/lua/lib.keybinds.lua

Modified: trunk/data/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.keybinds.lua (original)
+++ trunk/data/lua/lib.keybinds.lua Mon Sep 24 23:34:51 2007
@@ -29,8 +29,8 @@
 	-- additional movement key handling in WalkStep() (for pressed keys)
 	Bind("right",   function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end end end) =

 	Bind("left",    function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end end end) =

-	Bind("down",    function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else if (state > 0) then ChatLine_HistoryUpD=
own(-1) end end end) =

-	Bind("up",      function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else if (state > 0) then ChatLine_HistoryUpD=
own(1) end end end)
+	Bind("down",    function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else ChatLine_HistoryUpDown(-1) end end) =

+	Bind("up",      function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else ChatLine_HistoryUpDown(1) end end)
 	Bind("u",		function (state) if (not gActiveEditText) then if (state > 0) =
then SetAutoWalkTarget() end end end)
 	=

 	-- toggel gumps



From no-reply at zwischenwelt.org  Tue Sep 25 23:47:58 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Sep 2007 21:47:58 -0000
Subject: [Iris-commit] [IRIS] r1402 - in /trunk/data/lua: lib.debugmenu.lua
 lib.devtool.lua lib.fallback.lua lib.mainmenu.lua lib.plaingui.iris.lua
Message-ID: <20070925214758.F27681C18176@zwischenwelt.org>

Author: sience
Date: Tue Sep 25 23:47:58 2007
New Revision: 1402

Log:
-new gui style applyd from sfz

Modified:
    trunk/data/lua/lib.debugmenu.lua
    trunk/data/lua/lib.devtool.lua
    trunk/data/lua/lib.fallback.lua
    trunk/data/lua/lib.mainmenu.lua
    trunk/data/lua/lib.plaingui.iris.lua

Modified: trunk/data/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.debugmenu.lua (original)
+++ trunk/data/lua/lib.debugmenu.lua Tue Sep 25 23:47:58 2007
@@ -411,8 +411,6 @@
 		table.insert(rows,row1)
 		table.insert(rows,row2)
 	end
-	=

-	=

-	=

-	guimaker.MakeTableDlg(rows,10,10,true)
-end
+
+	guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefaultStyleSet,"window")
+end

Modified: trunk/data/lua/lib.devtool.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.devtool.lua (original)
+++ trunk/data/lua/lib.devtool.lua Tue Sep 25 23:47:58 2007
@@ -49,7 +49,7 @@
 		=

 	}
 	=

-	guimaker.MakeTableDlg(rows,100,10,true)
+	guimaker.MakeTableDlg(rows,100,10,true,true,gGuiDefaultStyleSet,"window")
 end
 =

 =

@@ -133,7 +133,8 @@
 			{type=3D"Label",		text=3Dv},
 			{type=3D"Label",		text=3Dsprintf(" %6.2fMB\n",OgreMemoryUsage(v)/1024/1=
024)}, })
 	end
-	guimaker.MakeTableDlg(rows,100,10,true)
+
+	guimaker.MakeTableDlg(rows,100,10,true,true,gGuiDefaultStyleSet,"window") =

 end
 =

 =

@@ -175,8 +176,8 @@
 		table.insert(rows[4]	,MakeUOArtImageForDialog(i,0,48,48))
 		table.insert(rows[5]	,{type=3D"Label",	text=3Dsprintf("%s\n0x%04x(=3D%d)=
\n%s",GetStaticTileTypeName(i) or "unknown",i,i,texlist)})
 	end
-	=

-	guimaker.MakeTableDlg(rows,100,10,true)
+
+	guimaker.MakeTableDlg(rows,100,10,true,true,gGuiDefaultStyleSet,"window") =

 end
 =

 =


Modified: trunk/data/lua/lib.fallback.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.fallback.lua (original)
+++ trunk/data/lua/lib.fallback.lua Tue Sep 25 23:47:58 2007
@@ -82,7 +82,7 @@
 	end
 	=

 	if (gLastFallBackToolDialog and gLastFallBackToolDialog:IsAlive()) then g=
LastFallBackToolDialog:Destroy() gLastFallBackToolDialog =3D nil end
-	gLastFallBackToolDialog =3D guimaker.MakeTableDlg(rows,100,10,true)
+	gLastFallBackToolDialog =3D guimaker.MakeTableDlg(rows,100,10,true,true,g=
GuiDefaultStyleSet,"window")
 end
 =

 -- iMaxW,iMaxH : can be nil for unlimited size

Modified: trunk/data/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.mainmenu.lua (original)
+++ trunk/data/lua/lib.mainmenu.lua Tue Sep 25 23:47:58 2007
@@ -108,7 +108,7 @@
 		{type=3D"Button",onLeftClick=3DMyGoBack,text=3D"Back"}
 	})
 =

-	gServerListDialog =3D guimaker.MakeTableDlg(rows,10,10)
+	gServerListDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefa=
ultStyleSet,"window")
 end
 =

 function MainMenuShowCharList (charlist)
@@ -157,7 +157,7 @@
 		{type=3D"Button",onLeftClick=3DMyGoBack,text=3D"Back"}
 	})
 	=

-	gCharListDialog =3D guimaker.MakeTableDlg(rows,10,10)
+	gCharListDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefaul=
tStyleSet,"window")
 end
 =

 function MainMenuShowCharCreationDialog (template,slot)
@@ -183,7 +183,7 @@
 		=

 	}
 	=

-	gCharCreateDialog =3D guimaker.MakeTableDlg(rows,10,10)
+	gCharCreateDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefa=
ultStyleSet,"window")
 end
 =

 =

@@ -228,7 +228,7 @@
 		=

 	}
 	=

-	gLoginDialog =3D guimaker.MakeTableDlg(rows,10,10)
+	gLoginDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefaultSt=
yleSet,"window")
 end
 =

 function GetShardButtonText (shard,shardname)
@@ -258,7 +258,6 @@
 =

 	local fun =3D function (widget) MainMenuShowLoginDialog(widget.shard,widg=
et.shardname) StopMainMenu() end
 	for shardname,shard in pairs(gShardList) do
-		--print(shardname,shard)
 		table.insert(rows,{ {type=3D"Button",	onLeftClick=3Dfun,shard=3Dshard,sh=
ardname=3Dshardname,text=3DGetShardButtonText(shard,shardname)} })
 	end
 	=

@@ -284,12 +283,12 @@
 			if (mousebutton =3D=3D 2 or mousebutton =3D=3D 3) then end
 			if (mousebutton =3D=3D 1) then end
 		end
-		dialog.panel =3D guimaker.MakeBorderPanel(dialog,10,10,0,0,{1,1,1,1})
+		dialog.panel =3D guimaker.MakeBorderPanel(dialog,10,10,0,0,{1,1,1,1},gGu=
iDefaultStyleSet,"window")
 =

 		dialog.rows =3D rows
 		for rownum,row in pairs(dialog.rows) do
 			for colnum,col in pairs(row) do
-				col.widget =3D guimaker.MakeWidgetFromArr(dialog.panel,col)
+				col.widget =3D guimaker.MakeWidgetFromArr(dialog.panel,col,gGuiDefault=
StyleSet)
 			end
 		end
 		table.insert(dialog.clippedWidgets,dialog.panel)

Modified: trunk/data/lua/lib.plaingui.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.plaingui.iris.lua (original)
+++ trunk/data/lua/lib.plaingui.iris.lua Tue Sep 25 23:47:58 2007
@@ -33,7 +33,7 @@
 		}	=

 		print("InitPlainGUI (offline modus)")
 		if (not gHideOfflineModeTeleportMenu) then
-			gPlainGuiTestDialog =3D guimaker.MakeTableDlg(rows,10,10)
+			gPlainGuiTestDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGui=
DefaultStyleSet,"window")
 		end
 		gDialog_IrisLogo:SetVisible(false)
 		SetUOCursor(0)



From no-reply at zwischenwelt.org  Tue Sep 25 23:48:31 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Sep 2007 21:48:31 -0000
Subject: [Iris-commit] [IRIS] r1403 - /trunk/data/base/main.material
Message-ID: <20070925214831.88AF41C18120@zwischenwelt.org>

Author: sience
Date: Tue Sep 25 23:48:29 2007
New Revision: 1403

Log:
-new gui style material

Modified:
    trunk/data/base/main.material

Modified: trunk/data/base/main.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/base/main.material (original)
+++ trunk/data/base/main.material Tue Sep 25 23:48:29 2007
@@ -648,3 +648,57 @@
 	}
 } =

 =

+material plaincolor_base
+{
+	technique
+	{
+		pass
+		{
+			lighting on
+			ambient 1.0 1.0 1.0
+			diffuse 1.0 1.0 1.0
+		}
+	}
+}
+
+material ui_ray_border : guibase
+{
+	technique
+	{
+		pass
+		{
+			texture_unit
+			{
+				texture ui/ray_border.png
+			}
+		}
+	}
+}
+
+material ui_ray_button : guibase
+{
+	technique
+	{
+		pass
+		{
+			texture_unit
+			{
+				texture ui/ray_button.png
+			}
+		}
+	}
+}
+
+material ui_ray_window : guibase
+{
+	technique
+	{
+		pass
+		{
+			texture_unit
+			{
+				texture ui/ray_window.png
+			}
+		}
+	}
+}



From no-reply at zwischenwelt.org  Tue Sep 25 23:49:20 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Sep 2007 21:49:20 -0000
Subject: [Iris-commit] [IRIS] r1404 - in /trunk/data/base/ui: ./
 ray_border.png ray_button.png ray_window.png
Message-ID: <20070925214920.B59791C18120@zwischenwelt.org>

Author: sience
Date: Tue Sep 25 23:49:20 2007
New Revision: 1404

Log:
-new gui style pictures added

Added:
    trunk/data/base/ui/
    trunk/data/base/ui/ray_border.png   (with props)
    trunk/data/base/ui/ray_button.png   (with props)
    trunk/data/base/ui/ray_window.png   (with props)



From no-reply at zwischenwelt.org  Wed Sep 26 00:00:01 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Sep 2007 22:00:01 -0000
Subject: [Iris-commit] [IRIS] r1405 - in /trunk: bin/iris2.exe
 data/lua/gui/gui.main.lua data/lua/gui/gui.styles.lua data/lua/main.lua
Message-ID: <20070925220001.B4B731C18120@zwischenwelt.org>

Author: sience
Date: Wed Sep 26 00:00:00 2007
New Revision: 1405

Log:
-styles moved to seperate gui.styles.lua file
-new binary

Added:
    trunk/data/lua/gui/gui.styles.lua
Modified:
    trunk/bin/iris2.exe
    trunk/data/lua/gui/gui.main.lua
    trunk/data/lua/main.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/lua/gui/gui.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/gui/gui.main.lua (original)
+++ trunk/data/lua/gui/gui.main.lua Wed Sep 26 00:00:00 2007
@@ -5,3 +5,4 @@
 dofile(libpath .. "gui/gui.journal.lua")
 dofile(libpath .. "gui/gui.quit.lua")
 dofile(libpath .. "gui/gui.status.lua")
+dofile(libpath .. "gui/gui.styles.lua")

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Wed Sep 26 00:00:00 2007
@@ -119,53 +119,6 @@
 	fp:close()
 end
 =

---###############################
---###     GUI STYLES          ###
---###############################
-gGuiDefaultStyleSet =3D "ray"
-glGuiMakerStyleSet["sfz"] =3D {
-window =3D {
-		material=3D"ui_window",size=3D64,x=3D0,y=3D0,
-		cx1=3D11,cy1=3D11,cx2=3D10,cy2=3D10,cx3=3D11,cy3=3D11,
-		dx=3D0,dy=3D32,border=3D11,clipborder=3D11
-	},
-button =3D {
-		material=3D"ui_window",size=3D64,x=3D32,y=3D0,
-		cx1=3D5,cy1=3D5,cx2=3D22,cy2=3D22,cx3=3D5,cy3=3D5,
-		dx=3D0,dy=3D32,border=3D5,clipborder=3D5
-	},
-border =3D {
-		material=3D"ui_window",size=3D64,x=3D32,y=3D0,
-		cx1=3D5,cy1=3D5,cx2=3D22,cy2=3D22,cx3=3D5,cy3=3D5,
-		dx=3D0,dy=3D32,border=3D5,clipborder=3D5
-	},
-default =3D {
-		material=3D"ui_window",size=3D64,x=3D32,y=3D0,
-		cx1=3D5,cy1=3D5,cx2=3D22,cy2=3D22,cx3=3D5,cy3=3D5,
-		dx=3D0,dy=3D32,border=3D5,clipborder=3D5
-	},
-}
-glGuiMakerStyleSet["ray"] =3D {
-default =3D {
-		material=3D"ui_ray_border",size=3D32,x=3D0,y=3D0,
-		cx1=3D12,cy1=3D12,cx2=3D8,cy2=3D8,cx3=3D12,cy3=3D12,
-		dx=3D0,dy=3D0,border=3D12,clipborder=3D2
-	},
-window =3D {
-		material=3D"ui_ray_window",size=3D128,x=3D0,y=3D0,
-		cx1=3D18,cy1=3D28,cx2=3D104,cy2=3D86,cx3=3D6,cy3=3D14,
-		dx=3D0,dy=3D0,
-		border_l=3D18,border_r=3D6,border_t=3D28,border_b=3D14,
-		clipborder_l=3D7,clipborder_r=3D7,clipborder_t=3D29,clipborder_b=3D15
-	},
-button =3D {
-		material=3D"ui_ray_button",size=3D128,x=3D0,y=3D0,
-		cx1=3D8,cy1=3D8,cx2=3D112,cy2=3D9,cx3=3D8,cy3=3D8,
-		dx=3D0,dy=3D32,border=3D8,
-		clipborder_l=3D8,clipborder_r=3D5,
-		clipborder_t=3D3,clipborder_b=3D3
-	},
-}
 =

 --###############################
 --###        FUNCTIONS        ###



From no-reply at zwischenwelt.org  Wed Sep 26 22:39:07 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 26 Sep 2007 20:39:07 -0000
Subject: [Iris-commit] [IRIS] r1406 - in /trunk: README
 data/lua/lib.3d.cam.lua data/lua/lib.loading.lua data/lua/lib.mainmenu.lua
 data/lua/lib.modelanim.lua data/lua/lib.sound.iris.lua start.sh
Message-ID: <20070926210002.11A051C1817C@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Sep 26 22:39:07 2007
New Revision: 1406

Log:
adjusted mainmenu window : buttons now all have max width, added -so comman=
dline switch to start in offline mode, added config for offline mode camsta=
rt, removed precaching of granny nude models to speed up startup

Modified:
    trunk/README
    trunk/data/lua/lib.3d.cam.lua
    trunk/data/lua/lib.loading.lua
    trunk/data/lua/lib.mainmenu.lua
    trunk/data/lua/lib.modelanim.lua
    trunk/data/lua/lib.sound.iris.lua
    trunk/start.sh

Modified: trunk/README
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/README (original)
+++ trunk/README Wed Sep 26 22:39:07 2007
@@ -78,6 +78,7 @@
 -c 								: shows console window under win32
 -g path/to/grannyfile.grn		: prints granny dump
 -gb path/to/grannyfile.grn		: prints granny bone info
+-so 							: start in offline mode
 =

 =3D=3D=3D debug mode =3D=3D=3D
 a : show first model and anim =


Modified: trunk/data/lua/lib.3d.cam.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.cam.lua (original)
+++ trunk/data/lua/lib.3d.cam.lua Wed Sep 26 22:39:07 2007
@@ -72,12 +72,9 @@
 =

 Renderer3D.gbCamRotChanged =3D true
 =

-function Renderer3D:InitLocalCam()
+function Renderer3D:InitLocalCam(x,y,z)
 	self.gCamMode =3D self.kCamMode_FreeMove
-	if (gGroundBlockLoader) then
-		GetMainCam():Move(-gGroundBlockLoader:GetMapW()*8/2,gGroundBlockLoader:G=
etMapH()*8/2,0)
-		--GetMainCam():Move(-183,203,0) -- city
-	end
+	GetMainCam():Move(x,y,z)
 end
 =

 function Renderer3D:IsFirstPersonCam () return self.gCamMode =3D=3D self.k=
CamMode_Ego end

Modified: trunk/data/lua/lib.loading.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.loading.lua (original)
+++ trunk/data/lua/lib.loading.lua Wed Sep 26 22:39:07 2007
@@ -19,7 +19,7 @@
 function LoadingProfile	(sCurAction,bIsPreOgre)
 	local curticks =3D Client_GetTicks()
 	if (gLoadingProfileLastAction) then =

-		printdebug("loading",sprintf("%5d msec : %s\n",(curticks-gLoadingProfile=
LastTime),gLoadingProfileLastAction))
+		printdebug("loading",sprintf("%5d msec : %s",(curticks-gLoadingProfileLa=
stTime),gLoadingProfileLastAction))
 	end
 =

 	-- if (sCurAction) then print(sCurAction) end

Modified: trunk/data/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.mainmenu.lua (original)
+++ trunk/data/lua/lib.mainmenu.lua Wed Sep 26 22:39:07 2007
@@ -237,6 +237,12 @@
 =

 function StartOfflineMode ()
 	gStartGameWithoutNetwork =3D true
+	=

+	local x,y,z =3D -183,203,0
+	--if (gGroundBlockLoader) then x,y,z =3D -gGroundBlockLoader:GetMapW()*8/=
2,gGroundBlockLoader:GetMapH()*8/2,0 end
+	if (gOfflineModeCamStart) then x,y,z =3D unpack(gOfflineModeCamStart) end
+	gCurrentRenderer:InitLocalCam(x,y,z)
+	=

 	InitPlainGUI()
 =

 	-- Binds key and Inits all InGame-Data
@@ -244,11 +250,11 @@
 =

 	-- Unbind some keys only for offline mode (rest is the same as InGame)
 	UnBindArr({"u","q","e","tab","r","c","t","k","j","b","p","g","h","y"})
-
-	gCurrentRenderer:InitLocalCam()
 end
 =

 function StartMainMenu ()
+	if (gCommandLineSwitches["-so"]) then StartOfflineMode() return end -- st=
art in offline mode
+
 	-- start menu sound
 	SoundPlayMusicById(8)
 =

@@ -277,47 +283,8 @@
 	MainMenuSetBackground_Sky()
 =

 	if (not(gMainMenuDialog)) then
-		gMainMenuDialog=3Dguimaker.MakeSortedDialog()				--CreateGumpDlgFromGfm(=
datapath.."gfm/main_menu.gfm")
-		local dialog =3D gMainMenuDialog
-		dialog.onMouseUp =3D function (widget,mousebutton)
-			if (mousebutton =3D=3D 2 or mousebutton =3D=3D 3) then end
-			if (mousebutton =3D=3D 1) then end
-		end
-		dialog.panel =3D guimaker.MakeBorderPanel(dialog,10,10,0,0,{1,1,1,1},gGu=
iDefaultStyleSet,"window")
-
-		dialog.rows =3D rows
-		for rownum,row in pairs(dialog.rows) do
-			for colnum,col in pairs(row) do
-				col.widget =3D guimaker.MakeWidgetFromArr(dialog.panel,col,gGuiDefault=
StyleSet)
-			end
-		end
-		table.insert(dialog.clippedWidgets,dialog.panel)
-		guimaker.LayoutTableDlg(dialog,dialog.panel) =

-		=

-		-- autowrap test
-		if (false) then
-			local text =3D "this is a loooooooooooooooooooooooooong text to test au=
towrapping features. This is to test autowrapping under the effects of alig=
nment. 0 1 2 3 4 5 6 7 8 9 A B C D E F 012345678901234567890123456789012345=
67890123456789012345678901234567890123456789"
-			text =3D text .. " Lorem ipsum dolor sit amet, consectetuer adipiscing =
elit. Aliquam ultricies diam at tellus. Fusce semper. Nunc egestas egestas =
diam. Integer nunc neque, fringilla ac, suscipit sed, elementum sit amet, u=
rna. Integer consequat egestas nulla. Sed euismod venenatis lacus. Phasellu=
s mollis risus vel enim. Aliquam lobortis vulputate diam. Aliquam erat volu=
tpat. Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aliquam dia=
m tortor, convallis et, lacinia in, volutpat non, magna. Nulla facilisi."
-			=

-			local vw,vh =3D GetViewportSize()
-			local w,h =3D 200,400
-			local x,y =3D 500,10
-			local col_back =3D {0.5,0.5,0.5,0.5}
-			local col_text =3D {0,0,1,1}
-			local autowraptest =3D guimaker.MyCreateDialog()
-			autowraptest.panel	=3D guimaker.MakeBorderPanel(autowraptest,x,y,w,h,co=
l_back)
-			autowraptest.panel.gfx:SetMaterial("BaseWhiteNoLighting")
-			autowraptest.panel.gfx:SetBorderMaterial("BaseWhiteNoLighting")
-			autowraptest.text	=3D guimaker.MakeText(autowraptest.panel,0,0,text,16,=
col_text)
-			--autowraptest.text	=3D guimaker.MakeText(autowraptest.panel,w/2,0,text=
,16,col_text)
-			--autowraptest.text.gfx:SetTextAlignment(kGfx2DAlign_Center)
-			--autowraptest.text.gfx:SetText(text)
-			--autowraptest.text.gfx:SetPos(x,y)
-			autowraptest.text.gfx:SetAutoWrap(w-11) -- work around some small overl=
ap bug that might take hours to find
-			local tw,th =3D autowraptest.text.gfx:GetTextBounds()
-			print("autowraptest bounds",tw,th)
-			autowraptest.panel.gfx:SetDimensions(w,th)
-		end
+		local vw,vh =3D GetViewportSize()
+		gMainMenuDialog =3D guimaker.MakeTableDlg(rows,vw/2-320,vh/2-240,false,t=
rue,gGuiDefaultStyleSet,"window") =

 	end
 end
 =

@@ -334,10 +301,8 @@
 end
 =

 function StepMainMenu ()
-	if (gMainMenuDialog) then
-		-- TODO: check screensize and center
-		local vw,vh =3D GetViewportSize()
-		gMainMenuDialog.rootwidget.gfx:SetPos(vw/2-320,vh/2-240)
+	if (gMainMenuDialog) then =

+		-- currently unused
 	end
 end
 =


Modified: trunk/data/lua/lib.modelanim.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.modelanim.lua (original)
+++ trunk/data/lua/lib.modelanim.lua Wed Sep 26 22:39:07 2007
@@ -19,8 +19,8 @@
 			gAnimInfoLists[k] =3D LoadGrannyAnimInfo(CorrectGrannyPath(filename))
 		end	=

 		=

-		GetOrCreateSkeleton(400) -- precache h_male
-		GetOrCreateSkeleton(401) -- precache h_female
+--~ 		GetOrCreateSkeleton(400) -- precache h_male
+--~ 		GetOrCreateSkeleton(401) -- precache h_female
 		return true -- currently there is no real loader object as there is no s=
ingle file to be loaded
 	else	=

 		print("unknown/unsupported granny loader type",loadertype)

Modified: trunk/data/lua/lib.sound.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.sound.iris.lua (original)
+++ trunk/data/lua/lib.sound.iris.lua Wed Sep 26 22:39:07 2007
@@ -26,6 +26,7 @@
 end
 =

 function SoundPlayMusicById(musicid)
+	if (not gUseMusic) then return end
 	printdebug("sound",sprintf("SoundPlayMusicById(%s)\n",musicid))
 	local config =3D CorrectPath(gUOPath.."Music/Digital/Config.txt")
 	local mp3 =3D nil

Modified: trunk/start.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/start.sh (original)
+++ trunk/start.sh Wed Sep 26 22:39:07 2007
@@ -1,5 +1,6 @@
 #!/bin/bash
 pushd bin
 #../src/irisogre
-../iris
+# start, and transmit up to 8 parameters (i don't know how to transmit all=
, and 8 should be enough for a while)
+../iris $1 $2 $3 $4 $5 $6 $7 $8 =

 popd



From no-reply at zwischenwelt.org  Thu Sep 27 02:48:31 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 27 Sep 2007 00:48:31 -0000
Subject: [Iris-commit] [IRIS] r1407 - in /trunk/data: config.lua.dist
 lua/lib.3d.cam.lua lua/lib.3d.mousepick.lua lua/lib.tilefreewalk.lua
 lua/main.lua lua/net.walk.lua
Message-ID: <20070927004831.44A941C1817B@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Sep 27 02:48:30 2007
New Revision: 1407

Log:
started working on tilefreewalk stuff, just setting up a testing framework =
in offline mode at first, but some problems with getting a position-debug m=
arker to draw properly

Added:
    trunk/data/lua/lib.tilefreewalk.lua
Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/lib.3d.cam.lua
    trunk/data/lua/lib.3d.mousepick.lua
    trunk/data/lua/main.lua
    trunk/data/lua/net.walk.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Thu Sep 27 02:48:30 2007
@@ -241,3 +241,5 @@
 =

 gDisableSmoothWalk =3D false
 gDisableHumanClientSideAnim =3D false
+
+gEnableTileFreeWalk =3D false

Modified: trunk/data/lua/lib.3d.cam.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.cam.lua (original)
+++ trunk/data/lua/lib.3d.cam.lua Thu Sep 27 02:48:30 2007
@@ -200,6 +200,7 @@
 end
 =

 function Renderer3D:GetExactLocalPos ()
+	if (gEnableTileFreeWalk) then return gTileFreeWalk:GetExactLocalPos() end
 	local playermobile =3D GetPlayerMobile()
 	if (playermobile and playermobile.modelgfx) then
 		local x,y,z =3D playermobile.modelgfx:GetDerivedPosition()

Modified: trunk/data/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.mousepick.lua (original)
+++ trunk/data/lua/lib.3d.mousepick.lua Thu Sep 27 02:48:30 2007
@@ -71,6 +71,7 @@
 	return widget
 end
 =

+-- CLEAR gMousePickFoundHit =3D {} if you want to use this alone !!!
 function Renderer3D:MousePick_3D ()
 	-- 3d mousepicking : mouseray
 	local rx,ry,rz,rvx,rvy,rvz =3D GetMouseRay()

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Thu Sep 27 02:48:30 2007
@@ -89,6 +89,7 @@
 dofile(libpath .. "obj/obj.main.lua")
 dofile(libpath .. "net/net.main.lua")
 dofile(libpath .. "lib.corpse.lua")
+dofile(libpath .. "lib.tilefreewalk.lua")
 =

 dofile(libpath .. "filter.art.lua")
 dofile(libpath .. "filter.granny.lua")
@@ -249,6 +250,8 @@
 	SoundPlayMusicById(57)
 =

 	gInGameStarted =3D true
+	=

+	NotifyListener("Hook_StartInGame")
 end
 =

 -- called every frame, after all timer-steppers, see Step() in lib.time.lua

Modified: trunk/data/lua/net.walk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.walk.lua (original)
+++ trunk/data/lua/net.walk.lua Thu Sep 27 02:48:30 2007
@@ -128,6 +128,8 @@
 -- if this is > 0 and the mobile (given as serial) is existing, autowalk t=
ries to follow the mobile
 gFollowMobile =3D 0
 function WalkStep ()
+	if (gEnableTileFreeWalk) then return end -- see lib.tilefreewalk.lua for =
walkstep handling
+	=

 	-- runnung if shift is pressed
 	gWalk_Running =3D not gKeyPressed[key_lshift]
 	=




From no-reply at zwischenwelt.org  Thu Sep 27 18:46:42 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 27 Sep 2007 16:46:42 -0000
Subject: [Iris-commit] [IRIS] r1409 - /trunk/data/lua/lib.compass.lua
Message-ID: <20070927170005.844AE1C1817E@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Sep 27 18:46:42 2007
New Revision: 1409

Log:
added option to disable compass

Modified:
    trunk/data/lua/lib.compass.lua

Modified: trunk/data/lua/lib.compass.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.compass.lua (original)
+++ trunk/data/lua/lib.compass.lua Thu Sep 27 18:46:42 2007
@@ -4,6 +4,7 @@
 =

 -- called from lib.gui.lua : gui.StartGame()
 function InitCompassIfNeeded () =

+	if (gDisableCompass) then return end
 	if (gIrisCompassDialog) then return end
 	local iGumpID_BigCompass =3D (hex2num("0x1393")) -- big compass
 	local iGumpID_SmallCompass =3D (hex2num("0x1392")) -- small compass
@@ -91,6 +92,7 @@
 =

 =

 function SetCompassMapIndex	(iMapIndex) =

+	if (gDisableCompass) then return end
 	InitCompassIfNeeded()
 	if (not gIrisCompassDialog) then return end
 	gIrisCompassDialog.compass.gfx:SetMaterial("tempmap_"..iMapIndex.."_small=
")
@@ -109,6 +111,7 @@
 -- factor > 1 increases sight radius
 -- zoom map in compass, called from lib.input.lua on keypress (,.)
 function ZoomCompass (factor) =

+	if (gDisableCompass) then return end
 	if (not gIrisCompassDialog) then return end
 	gCompassVisibleRad =3D gCompassVisibleRad * factor
 	--AddFadeLines("visrad=3D"..gCompassVisibleRad)
@@ -121,6 +124,7 @@
 =

 -- show/hide compass, called from lib.input.lua on keypress (n)
 function ToggleCompass (bKeyIsDown)
+	if (gDisableCompass) then return end
 	if (bKeyIsDown and gIrisCompassDialog) then
 		gIrisCompassDialog.bDoUpdate =3D not gIrisCompassDialog.bDoUpdate
 		gIrisCompassDialog:SetVisible(gIrisCompassDialog.bDoUpdate)
@@ -130,6 +134,7 @@
 =

 -- called every frame
 function UpdateCompass ()
+	if (gDisableCompass) then return end
 	if (gIrisCompassDialog and gIrisCompassDialog.bDoUpdate) then	=

 		local ax, iCamOverBlockX, iCamOverBlockY, MirrorX =3D gCurrentRenderer:U=
pdateCompass()
 		=




From no-reply at zwischenwelt.org  Thu Sep 27 18:07:58 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 27 Sep 2007 16:07:58 -0000
Subject: [Iris-commit] [IRIS] r1408 - in /trunk/data: base/main.material
	lua/lib.tilefreewalk.lua
Message-ID: <20070927170005.545B51C180EC@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Sep 27 18:07:57 2007
New Revision: 1408

Log:
investigating strange bug affecting line primitives in debugmarker for tile=
free walk code

Modified:
    trunk/data/base/main.material
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/base/main.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/base/main.material (original)
+++ trunk/data/base/main.material Thu Sep 27 18:07:57 2007
@@ -661,6 +661,24 @@
 	}
 }
 =

+material tilefreewalk_markerbase
+{
+	technique
+	{
+		pass
+		{
+			//depth_write on
+			//depth_check off
+			lighting off
+			cull_hardware none
+			cull_software none
+			=

+			ambient 1.0 1.0 1.0
+			diffuse 1.0 1.0 1.0
+		}
+	}
+}
+
 material ui_ray_border : guibase
 {
 	technique

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Thu Sep 27 18:07:57 2007
@@ -13,22 +13,34 @@
 	=

 	todo : later : autowalk : follow mobile etc, see old WalkStep() in net.wa=
lk.lua
 	=

-	if gKeyPressed[key_up]		then WalkForward() end
-	if gKeyPressed[key_down]	then WalkTurn( 4) end
-	if gKeyPressed[key_left]	then WalkTurn(-1) end
-	if gKeyPressed[key_right]	then WalkTurn( 1) end
-	gKeyPressed[key_mouse2] -- right mouse
-	=

-	-- TODO : disappearing marker.... LINECULLING ???
+	-- TODO : disappearing marker.... LINECULLING ??? height ?
+	=

+	-- TODO : 3 debugmarkers : a) clienside pos, b) last-walk-request pos c) =
last position confirmed by server
+	-- TODO : check walk-key stack and handling of blocked/teleport events
+	-- TODO : smooth clientside speed, even if server lags a bit and then sen=
ds multiple confirmations at once
+	-- TODO : util to get heightfieldpos ? (terrain only ? statics ? startz+t=
racedown ? generic raytrace util ? ...)
+	-- TODO : util to cache current pos and the 8 surrounding heights (lib.wa=
lking2.lua)
 ]]--
 =

 gTileFreeWalk =3D {}
 =

+
 -- ##### ##### ##### ##### ##### init
+
 =

 function gTileFreeWalk:Init ()
 	if (not gEnableTileFreeWalk) then return end -- set in config.lua : gEnab=
leTileFreeWalk =3D true
 	if (gCurrentRenderer ~=3D Renderer3D) then gEnableTileFreeWalk =3D false =
return end -- todo ?
+	self.iLastWalkRequestSendTime =3D 0
+	=

+	if (true) then
+		local meshgengfx =3D CreateGfx3D()
+		local r =3D 0.3
+		GfxSetSphere(meshgengfx,r,r,r,3,2)
+		meshgengfx:SetMaterial(GetPlainColourMat(0,1,0))
+		self.sDebugMarkerMeshName =3D meshgengfx:RenderableConvertToMesh()
+		meshgengfx:Destroy()
+	end
 	=

 	if (gStartGameWithoutNetwork) then -- from StartOfflineMode .. InitPlainG=
UI() StartInGame()
 		--Renderer3D:ChangeCamMode(Renderer3D.kCamMode_Third) -- centers cam aro=
und TileFreeWalk_GetExactLocalPos()
@@ -39,10 +51,19 @@
 end
 RegisterListener("Hook_StartInGame",function () gTileFreeWalk:Init() end)
 =

+
 -- ##### ##### ##### ##### ##### step
 =

-function gTileFreeWalk:Step ()
-	local bWalkInMouseDir =3D gKeyPressed[key_mouse2]
+
+function gTileFreeWalk:Step	()
+	local bWalkInMouseDir	=3D gKeyPressed[key_mouse2]
+	local bWalkForward		=3D gKeyPressed[key_up]		-- WalkForward() end
+	local bWalkBackwards	=3D gKeyPressed[key_down]		-- WalkTurn( 4) end
+	local bTurnLeft			=3D gKeyPressed[key_left]		-- WalkTurn(-1) end
+	local bTurnRight		=3D gKeyPressed[key_right]	-- WalkTurn( 1) end
+	=

+	self:SetGlobalUOPos(0,0,0)
+	self:SetGlobalUOPos_Server(0,0,0)
 	=

 	if (bWalkInMouseDir) then =

 		local dx,dy =3D self:GetCurrentMouseDir_UO()
@@ -51,20 +72,44 @@
 		self:SetDebugMarker("rightclickwalk", xloc,yloc,zloc, dx,dy,0, 0,0,0.989=
8)
 	end
 	=

-	self:UpdateAllDebugMarkers()
-end
-
-
--- ##### ##### ##### ##### ##### gathering information, walk parameters
+	=

+	-- todo : only check for send if we want to send walk requests
+	-- send walk requests to server
+	local iTimeSinceLastWalkRequest =3D gMyTicks - self.iLastWalkRequestSendT=
ime
+	local iWalkRequestInterval =3D self:GetWalkRequestInterval()
+	if (iTimeSinceLastWalkRequest >=3D iWalkRequestInterval) then
+		self.iLastWalkRequestSendTime =3D (iTimeSinceLastWalkRequest > 2*iWalkRe=
questInterval) and gMyTicks or =

+										(self.iLastWalkRequestSendTime + iWalkRequestInterval)
+		=

+		-- todo : send request
+		=

+	end =

+	=

+	=

+--~ 	self:UpdateAllDebugMarkers()
+end
+
+
+-- ##### ##### ##### ##### ##### gathering information, external walk para=
meters
 =

 =

 -- todo : in tiles per second ? depends on conditions(stamina,spells,buffs=
,debuffs...) and on mount/horse ?
-function gTileFreeWalk:GetCurrentAllowedSpeed ()
-	=

+function gTileFreeWalk:GetAllowedMaxSpeed		() return 1 end -- TODO !
+
+function gTileFreeWalk:GetWalkRequestInterval	() return 1/self:GetClientSi=
deSpeed() end
+
+function gTileFreeWalk:GetClientSideTurnSpeed	() return 45*gfDeg2Rad*self:=
GetClientSideSpeed() end =

+
+function gTileFreeWalk:GetClientSideSpeed		() =

+	local maxspeed			=3D self:GetAllowedMaxSpeed()
+	local dist				=3D self:GetDistanceToServerPos()
+	local tolerated_dist	=3D 1
+	local minspeed_dist		=3D 4 + tolerated_dist -- todo : currently slowdown =
is linear, make smoother spline here ?
+	return maxspeed * (1.0 - math.min(0.9,math.max(0,dist-tolerated_dist)/min=
speed_dist))
 end
 =

 -- returns dx,dy in uo coordinate system, vector2d(dx,dy).length =3D 1
-function gTileFreeWalk:GetCurrentMouseDir_UO ()
+function gTileFreeWalk:GetCurrentMouseDir_UO	()
 	local mx, my =3D GetMousePos()
 	local vw, vh =3D GetViewportSize()
 	local ax,ay,az =3D GetMainCam():GetEulerAng()
@@ -73,7 +118,42 @@
 	return -math.cos(mouseang),-math.sin(mouseang)
 end
 =

--- ##### ##### ##### ##### ##### debug graphics
+
+-- ##### ##### ##### ##### ##### position and coordinate system conversions
+
+
+-- todo : slow down clientside movement depending on this
+function gTileFreeWalk:GetDistanceToServerPos () =

+	local xloc,yloc,zloc =3D self:GetGlobalUOPos()
+	return Vector.len(Vector.sub(xloc,yloc,zloc,self:GetGlobalUOPos_Server()))
+end
+
+-- returns xloc,yloc,zloc
+function gTileFreeWalk:MousePickUOPos ()
+	gMousePickFoundHit =3D false
+	Renderer3D:MousePick_3D()
+	local x =3D Renderer3D.gMousePickFoundHit_ExactX
+	local y =3D Renderer3D.gMousePickFoundHit_ExactY
+	local z =3D Renderer3D.gMousePickFoundHit_ExactZ
+	return Renderer3D:LocalToUOPos(x,y,z)
+end
+
+-- returns xloc,yloc,zloc  in global UO Coordinates (warning, floats, not =
rounded)
+function gTileFreeWalk:GetGlobalUOPos () return self.xloc,self.yloc,self.z=
loc end
+function gTileFreeWalk:SetGlobalUOPos (xloc,yloc,zloc) self.xloc,self.yloc=
,self.zloc =3D xloc,yloc,zloc end
+
+-- returns the "server-position", e.g. the lowlevel uo interface position,=
 this will probably be rounded to tiles
+function gTileFreeWalk:GetGlobalUOPos_Server () return self.xloc_server,se=
lf.yloc_server,self.zloc_server end
+function gTileFreeWalk:SetGlobalUOPos_Server (xloc,yloc,zloc) self.xloc_se=
rver,self.yloc_server,self.zloc_server =3D xloc,yloc,zloc end
+
+-- returns x,y,z in local scene coordinates (e.g. can be passed to gfx:Set=
Position())
+function gTileFreeWalk:GetExactLocalPos () =

+	local xloc,yloc,zloc =3D self:GetGlobalUOPos()
+	return Renderer3D:UOPosToLocal(xloc+0.5,yloc+0.5,zloc*0.1) =

+end
+
+
+-- ##### ##### ##### ##### ##### debug markers
 =

 =

 function gTileFreeWalk:SetDebugMarker (markername, xloc,yloc,zloc, dx,dy,d=
z, r,g,b)
@@ -83,6 +163,9 @@
 		mymarker =3D CreateRootGfx3D() =

 		mymarker:SetSimpleRenderable()
 		self.debugmarkers[markername] =3D mymarker =

+		=

+		mymarker.gfx_marker2 =3D CreateRootGfx3D()
+		mymarker.gfx_marker2:SetMesh(self.sDebugMarkerMeshName)	=

 	end
 	mymarker.xloc =3D xloc
 	mymarker.yloc =3D yloc
@@ -91,7 +174,8 @@
 	mymarker.dy =3D dy
 	mymarker.dz =3D dz
 	self:UpdateDebugMarker(mymarker)
-	mymarker:SetMaterial(GetPlainColourMat(r or 1,g or 1,b or 0))
+--~ 	mymarker:SetMaterial(GetPlainColourMat(r or 1,g or 1,b or 0))
+	mymarker:SetMaterial("tilefreewalk_markerbase")
 --~ 	mymarker:SetMaterial(GetHuedMat("tilefreewalk_markerbase",r or 1,g or=
 1,b or 0))
 end
 	=

@@ -101,7 +185,8 @@
 =

 function gTileFreeWalk:UpdateDebugMarker (mymarker)
 	local x,y,z =3D Renderer3D:UOPosToLocal(mymarker.xloc+0.5,mymarker.yloc+0=
.5,mymarker.zloc + 1) =

-	print("UpdateDebugMarker",sprintf("%0.1f,%0.1f,%0.1f",x,y,z),Renderer3D.g=
iMapOriginX,Renderer3D.giMapOriginY)
+	mymarker.gfx_marker2:SetPosition(x,y,z)
+--~ 	print("UpdateDebugMarker",sprintf("%0.1f,%0.1f,%0.1f",x,y,z),Renderer=
3D.giMapOriginX,Renderer3D.giMapOriginY)
 	local e =3D 0.5
 	local gfx =3D mymarker
 	local bDynamic =3D false
@@ -117,24 +202,3 @@
 	gfx:RenderableEnd()
 end
 =

--- ##### ##### ##### ##### ##### position and coordinate system conversions
-
--- returns xloc,yloc,zloc
-function gTileFreeWalk:MousePickUOPos ()
-	gMousePickFoundHit =3D false
-	Renderer3D:MousePick_3D()
-	local x =3D Renderer3D.gMousePickFoundHit_ExactX
-	local y =3D Renderer3D.gMousePickFoundHit_ExactY
-	local z =3D Renderer3D.gMousePickFoundHit_ExactZ
-	return Renderer3D:LocalToUOPos(x,y,z)
-end
-
--- returns xloc,yloc,zloc  in global UO Coordinates (warning, floats, not =
rounded)
-function gTileFreeWalk:GetGlobalUOPos () return self.xloc,self.yloc,self.z=
loc end
-function gTileFreeWalk:SetGlobalUOPos (xloc,yloc,zloc) self.xloc,self.yloc=
,self.zloc =3D xloc,yloc,zloc end
-
--- returns x,y,z in local scene coordinates (e.g. can be passed to gfx:Set=
Position())
-function gTileFreeWalk:GetExactLocalPos () =

-	local xloc,yloc,zloc =3D self:GetGlobalUOPos()
-	return Renderer3D:UOPosToLocal(xloc+0.5,yloc+0.5,zloc*0.1) =

-end



From no-reply at zwischenwelt.org  Thu Sep 27 20:32:55 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 27 Sep 2007 18:32:55 -0000
Subject: [Iris-commit] [IRIS] r1410 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070927183255.A903A1C1817F@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Sep 27 20:32:54 2007
New Revision: 1410

Log:
linebug visible for sience : start in offline mode, place marker with right=
click and fly around it

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Thu Sep 27 20:32:54 2007
@@ -62,6 +62,20 @@
 	local bTurnLeft			=3D gKeyPressed[key_left]		-- WalkTurn(-1) end
 	local bTurnRight		=3D gKeyPressed[key_right]	-- WalkTurn( 1) end
 	=

+	=

+	if (gKeyPressed[key_j]) then
+		local cx,cy,cz =3D GetMainCam():GetPos()
+		cx =3D math.floor(cx)
+		cy =3D math.floor(cy)
+		cz =3D math.floor(cz)
+		GetMainCam():SetPos(cx,cy,cz)
+		local qw,qx,qy,qz =3D GetMainCam():GetRot()
+		print("campos",cx,cy,cz,qw,qx,qy,qz)
+	end
+	if (gKeyPressed[key_x]) then GetMainCam():SetPos(-19,32,11) GetMainCam():=
SetRot(0.05512560531497,0.047931000590324,0.65439212322235,0.75261861085892=
) end
+	if (gKeyPressed[key_c]) then GetMainCam():SetPos(-21,28,10) GetMainCam():=
SetRot(0.00030659991898574,0.00019714831432793,0.54085141420364,0.841118037=
70065) end
+		=

+	=

 	self:SetGlobalUOPos(0,0,0)
 	self:SetGlobalUOPos_Server(0,0,0)
 	=

@@ -114,7 +128,7 @@
 	local vw, vh =3D GetViewportSize()
 	local ax,ay,az =3D GetMainCam():GetEulerAng()
 	local mouseang =3D -math.atan2( my-vh/2.0, mx-vw/2.0 ) + 1.0*math.pi - ax=
 -- in radians
-	print("TODO : bugged gTileFreeWalk:GetCurrentMouseDir_UO")
+--~ 	print("TODO : bugged gTileFreeWalk:GetCurrentMouseDir_UO")
 	return -math.cos(mouseang),-math.sin(mouseang)
 end
 =

@@ -131,10 +145,14 @@
 -- returns xloc,yloc,zloc
 function gTileFreeWalk:MousePickUOPos ()
 	gMousePickFoundHit =3D false
-	Renderer3D:MousePick_3D()
-	local x =3D Renderer3D.gMousePickFoundHit_ExactX
-	local y =3D Renderer3D.gMousePickFoundHit_ExactY
-	local z =3D Renderer3D.gMousePickFoundHit_ExactZ
+	=

+	local rx,ry,rz,rvx,rvy,rvz =3D GetMouseRay()
+	local d =3D 10
+	local x,y,z =3D rx+d*rvx,ry+d*rvy,rz+d*rvz
+--~ 	Renderer3D:MousePick_3D()
+--~ 	local x =3D Renderer3D.gMousePickFoundHit_ExactX
+--~ 	local y =3D Renderer3D.gMousePickFoundHit_ExactY
+--~ 	local z =3D Renderer3D.gMousePickFoundHit_ExactZ
 	return Renderer3D:LocalToUOPos(x,y,z)
 end
 =

@@ -151,7 +169,6 @@
 	local xloc,yloc,zloc =3D self:GetGlobalUOPos()
 	return Renderer3D:UOPosToLocal(xloc+0.5,yloc+0.5,zloc*0.1) =

 end
-
 =

 -- ##### ##### ##### ##### ##### debug markers
 =

@@ -185,12 +202,16 @@
 =

 function gTileFreeWalk:UpdateDebugMarker (mymarker)
 	local x,y,z =3D Renderer3D:UOPosToLocal(mymarker.xloc+0.5,mymarker.yloc+0=
.5,mymarker.zloc + 1) =

-	mymarker.gfx_marker2:SetPosition(x,y,z)
 --~ 	print("UpdateDebugMarker",sprintf("%0.1f,%0.1f,%0.1f",x,y,z),Renderer=
3D.giMapOriginX,Renderer3D.giMapOriginY)
 	local e =3D 0.5
 	local gfx =3D mymarker
 	local bDynamic =3D false
-	gfx:RenderableBegin(2*4,0,bDynamic or false,false,OT_LINE_LIST)
+	x =3D math.floor(x)
+	y =3D math.floor(y)
+	z =3D math.floor(z)
+--~ 	x,y,z =3D -20,18,7
+	mymarker.gfx_marker2:SetPosition(x,y,z)
+	gfx:RenderableBegin(2*4,8,bDynamic or false,false,OT_LINE_LIST)
 	gfx:RenderableVertex(x-e,y,z)
 	gfx:RenderableVertex(x+e,y,z)
 	gfx:RenderableVertex(x,y-e,z)
@@ -198,7 +219,18 @@
 	gfx:RenderableVertex(x,y,z-e)
 	gfx:RenderableVertex(x,y,z+e)
 	gfx:RenderableVertex(x,y,z)
-	gfx:RenderableVertex(x+mymarker.dx,y+mymarker.dy,z+mymarker.dz)
+	gfx:RenderableVertex(x+1,y+1,z+1)
+	gfx:RenderableIndex(0)
+	gfx:RenderableIndex(1)
+	gfx:RenderableIndex(2)
+	gfx:RenderableIndex(3)
+	gfx:RenderableIndex(4)
+	gfx:RenderableIndex(5)
+	gfx:RenderableIndex(6)
+	gfx:RenderableIndex(7)
+	print("debugdata",x,y,z)
+--~ 	gfx:RenderableVertex(x+mymarker.dx,y+mymarker.dy,z+mymarker.dz)
+--~ 	print(x+mymarker.dx,y+mymarker.dy,z+mymarker.dz)
 	gfx:RenderableEnd()
 end
 =




From no-reply at zwischenwelt.org  Thu Sep 27 22:36:50 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 27 Sep 2007 20:36:50 -0000
Subject: [Iris-commit] [IRIS] r1411 - /trunk/data/lua/lib.3d.map.lua
Message-ID: <20070927203650.5E2541C1817F@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Sep 27 22:36:50 2007
New Revision: 1411

Log:
deactivated recentering world, troublesome for moving things, and probably =
not needed anyway as float precision is quite good

Modified:
    trunk/data/lua/lib.3d.map.lua

Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Thu Sep 27 22:36:50 2007
@@ -24,21 +24,22 @@
 		=

 		-- recenter world if too far away, to avoid float-rounding-errors
 		local fCamOriginDist =3D math.sqrt(camx*camx + camy*camy)
-		if (fCamOriginDist / 8 > self.ROBMAP_RECENTER_DIST) then
+		if (false and fCamOriginDist / 8 > self.ROBMAP_RECENTER_DIST) then -- de=
activated for now, so coordinates are consistent
 			printf("RecenterMap (%d,%d)\n",iCamOverBlockX,iCamOverBlockY)
 			=

 			-- calc new origin
 			local ox =3D math.floor(iCamOverBlockX / self.ROBMAP_CHUNK_SIZE)
 			local oy =3D math.floor(iCamOverBlockY / self.ROBMAP_CHUNK_SIZE)
-			local difx =3D (ox - self.giMapOriginX) * 8 * self.ROBMAP_CHUNK_SIZE
-			local dify =3D (oy - self.giMapOriginY) * 8 * self.ROBMAP_CHUNK_SIZE =

+			local difx =3D (self.giMapOriginX - ox) * 8 * self.ROBMAP_CHUNK_SIZE
+			local dify =3D (self.giMapOriginY - oy) * 8 * self.ROBMAP_CHUNK_SIZE =

 			self.giMapOriginX =3D ox
 			self.giMapOriginY =3D oy
 			=

 			-- update cam,map,dynamics,mobiles,...
-			GetMainCam():Move(-difx,-dify,0)
+			GetMainCam():Move(difx,dify,0)
 			self:ClearMapCache()
 			gCurrentRenderer:CheckForUpdateMapOrigin()
+			NotifyListener("Hook_RecenterWorld",difx,dify)
 		end
 		=

 		-- mapblocks are loaded and unloaded here  (also iCamOverBlockX will alw=
ays be negative  while over the map)



From no-reply at zwischenwelt.org  Thu Sep 27 23:02:15 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 27 Sep 2007 21:02:15 -0000
Subject: [Iris-commit] [IRIS] r1412 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070927210216.491951C1817F@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Sep 27 23:02:15 2007
New Revision: 1412

Log:
removed  line-debug stuff and capsuled uo specific stuff in tilefreewalk

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Thu Sep 27 23:02:15 2007
@@ -13,10 +13,10 @@
 	=

 	todo : later : autowalk : follow mobile etc, see old WalkStep() in net.wa=
lk.lua
 	=

-	-- TODO : disappearing marker.... LINECULLING ??? height ?
 	=

+	-- TODO : capsule all uo specific stuff so that this lib is usable in oth=
er projects
 	-- TODO : 3 debugmarkers : a) clienside pos, b) last-walk-request pos c) =
last position confirmed by server
-	-- TODO : check walk-key stack and handling of blocked/teleport events
+	-- TODO : uo-specific(capsule me) check walk-key stack and handling of bl=
ocked/teleport events
 	-- TODO : smooth clientside speed, even if server lags a bit and then sen=
ds multiple confirmations at once
 	-- TODO : util to get heightfieldpos ? (terrain only ? statics ? startz+t=
racedown ? generic raytrace util ? ...)
 	-- TODO : util to cache current pos and the 8 surrounding heights (lib.wa=
lking2.lua)
@@ -30,21 +30,19 @@
 =

 function gTileFreeWalk:Init ()
 	if (not gEnableTileFreeWalk) then return end -- set in config.lua : gEnab=
leTileFreeWalk =3D true
-	if (gCurrentRenderer ~=3D Renderer3D) then gEnableTileFreeWalk =3D false =
return end -- todo ?
+	if (gCurrentRenderer ~=3D Renderer3D) then return end
 	self.iLastWalkRequestSendTime =3D 0
 	=

 	if (true) then
-		local meshgengfx =3D CreateGfx3D()
-		local r =3D 0.3
-		GfxSetSphere(meshgengfx,r,r,r,3,2)
-		meshgengfx:SetMaterial(GetPlainColourMat(0,1,0))
-		self.sDebugMarkerMeshName =3D meshgengfx:RenderableConvertToMesh()
-		meshgengfx:Destroy()
+		self.sDebugMarkerMeshName_Big	=3D MakeSphereMesh(11,11,0.3,0.3,0.1)
+		self.sDebugMarkerMeshName_Dir	=3D MakeSphereMesh(11,11,0.1,0.1,0.1)
 	end
 	=

+	self:SetPos_All(0,0,0)
+	=

 	if (gStartGameWithoutNetwork) then -- from StartOfflineMode .. InitPlainG=
UI() StartInGame()
-		--Renderer3D:ChangeCamMode(Renderer3D.kCamMode_Third) -- centers cam aro=
und TileFreeWalk_GetExactLocalPos()
-		--self:SetGlobalUOPos(self:MousePickUOPos())
+		--Renderer3D:ChangeCamMode(Renderer3D.kCamMode_Third)
+		--self:SetGlobalUOPos(self:MousePickPos())
 	end
 =

 	RegisterStepper(function () gTileFreeWalk:Step() end) =

@@ -56,35 +54,20 @@
 =

 =

 function gTileFreeWalk:Step	()
+	if (gCurrentRenderer ~=3D Renderer3D) then return end
 	local bWalkInMouseDir	=3D gKeyPressed[key_mouse2]
 	local bWalkForward		=3D gKeyPressed[key_up]		-- WalkForward() end
 	local bWalkBackwards	=3D gKeyPressed[key_down]		-- WalkTurn( 4) end
 	local bTurnLeft			=3D gKeyPressed[key_left]		-- WalkTurn(-1) end
 	local bTurnRight		=3D gKeyPressed[key_right]	-- WalkTurn( 1) end
 	=

-	=

-	if (gKeyPressed[key_j]) then
-		local cx,cy,cz =3D GetMainCam():GetPos()
-		cx =3D math.floor(cx)
-		cy =3D math.floor(cy)
-		cz =3D math.floor(cz)
-		GetMainCam():SetPos(cx,cy,cz)
-		local qw,qx,qy,qz =3D GetMainCam():GetRot()
-		print("campos",cx,cy,cz,qw,qx,qy,qz)
+	local dx,dy =3D self:GetCurrentMouseDir()
+	if (bWalkInMouseDir) then =

+		local x,y,z =3D self:MousePickPos()
+		self.lastmarkerpos =3D {x,y,z}
 	end
-	if (gKeyPressed[key_x]) then GetMainCam():SetPos(-19,32,11) GetMainCam():=
SetRot(0.05512560531497,0.047931000590324,0.65439212322235,0.75261861085892=
) end
-	if (gKeyPressed[key_c]) then GetMainCam():SetPos(-21,28,10) GetMainCam():=
SetRot(0.00030659991898574,0.00019714831432793,0.54085141420364,0.841118037=
70065) end
-		=

-	=

-	self:SetGlobalUOPos(0,0,0)
-	self:SetGlobalUOPos_Server(0,0,0)
-	=

-	if (bWalkInMouseDir) then =

-		local dx,dy =3D self:GetCurrentMouseDir_UO()
-		local xloc,yloc,zloc =3D self:MousePickUOPos()
-		print("walk to",sprintf("%4.0f,%4.0f,%4.0f",xloc,yloc,zloc),"dir",sprint=
f("%+0.1f,%+0.1f",dx,dy))
-		self:SetDebugMarker("rightclickwalk", xloc,yloc,zloc, dx,dy,0, 0,0,0.989=
8)
-	end
+	local x,y,z =3D unpack(self.lastmarkerpos or {0,0,0})
+	self:SetDebugMarker("rightclickwalk", x,y,z, dx,dy,0, 1,1,0)
 	=

 	=

 	-- todo : only check for send if we want to send walk requests
@@ -92,145 +75,124 @@
 	local iTimeSinceLastWalkRequest =3D gMyTicks - self.iLastWalkRequestSendT=
ime
 	local iWalkRequestInterval =3D self:GetWalkRequestInterval()
 	if (iTimeSinceLastWalkRequest >=3D iWalkRequestInterval) then
-		self.iLastWalkRequestSendTime =3D (iTimeSinceLastWalkRequest > 2*iWalkRe=
questInterval) and gMyTicks or =

+		self.iLastWalkRequestSendTime =3D (iTimeSinceLastWalkRequest   > 2*iWalk=
RequestInterval) and gMyTicks or =

 										(self.iLastWalkRequestSendTime + iWalkRequestInterval)
 		=

 		-- todo : send request
 		=

-	end =

-	=

-	=

---~ 	self:UpdateAllDebugMarkers()
+	end
 end
 =

 =

 -- ##### ##### ##### ##### ##### gathering information, external walk para=
meters
 =

 =

--- todo : in tiles per second ? depends on conditions(stamina,spells,buffs=
,debuffs...) and on mount/horse ?
-function gTileFreeWalk:GetAllowedMaxSpeed		() return 1 end -- TODO !
+function gTileFreeWalk:GetMaxAllowedSpeed		() return self:Impl_GetMaxAllow=
edSpeed() end
+function gTileFreeWalk:GetMaxAllowedTurnRate	() return self:Impl_GetMaxAll=
owedTurnRate() end =

 =

 function gTileFreeWalk:GetWalkRequestInterval	() return 1/self:GetClientSi=
deSpeed() end
 =

-function gTileFreeWalk:GetClientSideTurnSpeed	() return 45*gfDeg2Rad*self:=
GetClientSideSpeed() end =

+function gTileFreeWalk:GetClientSideTurnRate	() return self:GetMaxAllowedT=
urnRate() end =

 =

 function gTileFreeWalk:GetClientSideSpeed		() =

-	local maxspeed			=3D self:GetAllowedMaxSpeed()
-	local dist				=3D self:GetDistanceToServerPos()
+	local maxspeed			=3D self:GetMaxAllowedSpeed()
+	local dist				=3D self:GetDistanceToLastConfirmedPos()
 	local tolerated_dist	=3D 1
 	local minspeed_dist		=3D 4 + tolerated_dist -- todo : currently slowdown =
is linear, make smoother spline here ?
 	return maxspeed * (1.0 - math.min(0.9,math.max(0,dist-tolerated_dist)/min=
speed_dist))
 end
 =

 -- returns dx,dy in uo coordinate system, vector2d(dx,dy).length =3D 1
-function gTileFreeWalk:GetCurrentMouseDir_UO	()
+function gTileFreeWalk:GetCurrentMouseDir	()
 	local mx, my =3D GetMousePos()
 	local vw, vh =3D GetViewportSize()
 	local ax,ay,az =3D GetMainCam():GetEulerAng()
-	local mouseang =3D -math.atan2( my-vh/2.0, mx-vw/2.0 ) + 1.0*math.pi - ax=
 -- in radians
---~ 	print("TODO : bugged gTileFreeWalk:GetCurrentMouseDir_UO")
-	return -math.cos(mouseang),-math.sin(mouseang)
+	local mouseang =3D -math.atan2( my-vh/2.0, mx-vw/2.0 ) + ax -- in radians
+	return math.cos(mouseang),math.sin(mouseang)
 end
 =

+
+-- ##### ##### ##### ##### ##### implementation (currently uo specific, wi=
ll later be inserted from extern)
+
+
+-- returns x,y,z
+function gTileFreeWalk:Impl_MousePickPos ()
+	gMousePickFoundHit =3D false
+	Renderer3D:MousePick_3D()
+	local x =3D Renderer3D.gMousePickFoundHit_ExactX
+	local y =3D Renderer3D.gMousePickFoundHit_ExactY
+	local z =3D Renderer3D.gMousePickFoundHit_ExactZ
+	return x,y,z
+end
+
+-- world-units (tiles for uo) per second
+-- todo : depends on conditions(stamina,spells,buffs,debuffs...) and on mo=
unt/horse ?
+function gTileFreeWalk:Impl_GetMaxAllowedSpeed		() return 1 end
+function gTileFreeWalk:Impl_GetMaxAllowedTurnRate	() return 45*gfDeg2Rad e=
nd
+
+
+
+-- 27.09.2007 : the code that triggers this event has been deactivated, so=
 this should no longer be neccessary
+RegisterListener("Hook_RecenterWorld",function (difx,dify)
+	if (not gEnableTileFreeWalk) then return end
+	print("ERROR, TileFreeWalk : Hook_RecenterWorld not yet implemented")
+	-- todo : move all positons...
+	Crash()
+end)
 =

 -- ##### ##### ##### ##### ##### position and coordinate system conversions
 =

 =

--- todo : slow down clientside movement depending on this
-function gTileFreeWalk:GetDistanceToServerPos () =

-	local xloc,yloc,zloc =3D self:GetGlobalUOPos()
-	return Vector.len(Vector.sub(xloc,yloc,zloc,self:GetGlobalUOPos_Server()))
+function gTileFreeWalk:GetDistanceToLastConfirmedPos () =

+	local x,y,z =3D self:GetPos_LastConfirmed()
+	return Vector.len(Vector.sub(x,y,z,self:GetPos_ClientSide()))
 end
 =

--- returns xloc,yloc,zloc
-function gTileFreeWalk:MousePickUOPos ()
-	gMousePickFoundHit =3D false
-	=

-	local rx,ry,rz,rvx,rvy,rvz =3D GetMouseRay()
-	local d =3D 10
-	local x,y,z =3D rx+d*rvx,ry+d*rvy,rz+d*rvz
---~ 	Renderer3D:MousePick_3D()
---~ 	local x =3D Renderer3D.gMousePickFoundHit_ExactX
---~ 	local y =3D Renderer3D.gMousePickFoundHit_ExactY
---~ 	local z =3D Renderer3D.gMousePickFoundHit_ExactZ
-	return Renderer3D:LocalToUOPos(x,y,z)
+-- returns x,y,z
+function gTileFreeWalk:MousePickPos 		() 			return self:Impl_MousePickPos(=
) end
+
+function gTileFreeWalk:GetPos_ClientSide	()			return unpack(self.pos_clien=
tside) end
+function gTileFreeWalk:SetPos_ClientSide	(x,y,z)		self.pos_clientside =3D =
{x,y,z} end
+
+function gTileFreeWalk:GetPos_LastConfirmed ()			return unpack(self.pos_la=
stconfirmed) end
+function gTileFreeWalk:SetPos_LastConfirmed (x,y,z)		self.pos_lastconfirme=
d =3D {x,y,z} end
+
+function gTileFreeWalk:GetPos_LastRequested ()			return unpack(self.pos_la=
strequested) end
+function gTileFreeWalk:SetPos_LastRequested (x,y,z)		self.pos_lastrequeste=
d =3D {x,y,z} end
+
+-- used for teleport and init
+function gTileFreeWalk:SetPos_All (x,y,z)		=

+	self:SetPos_ClientSide(		x,y,z)
+	self:SetPos_LastConfirmed(	x,y,z)
+	self:SetPos_LastRequested(	x,y,z)
 end
 =

--- returns xloc,yloc,zloc  in global UO Coordinates (warning, floats, not =
rounded)
-function gTileFreeWalk:GetGlobalUOPos () return self.xloc,self.yloc,self.z=
loc end
-function gTileFreeWalk:SetGlobalUOPos (xloc,yloc,zloc) self.xloc,self.yloc=
,self.zloc =3D xloc,yloc,zloc end
 =

--- returns the "server-position", e.g. the lowlevel uo interface position,=
 this will probably be rounded to tiles
-function gTileFreeWalk:GetGlobalUOPos_Server () return self.xloc_server,se=
lf.yloc_server,self.zloc_server end
-function gTileFreeWalk:SetGlobalUOPos_Server (xloc,yloc,zloc) self.xloc_se=
rver,self.yloc_server,self.zloc_server =3D xloc,yloc,zloc end
-
--- returns x,y,z in local scene coordinates (e.g. can be passed to gfx:Set=
Position())
-function gTileFreeWalk:GetExactLocalPos () =

-	local xloc,yloc,zloc =3D self:GetGlobalUOPos()
-	return Renderer3D:UOPosToLocal(xloc+0.5,yloc+0.5,zloc*0.1) =

-end
 =

 -- ##### ##### ##### ##### ##### debug markers
 =

 =

-function gTileFreeWalk:SetDebugMarker (markername, xloc,yloc,zloc, dx,dy,d=
z, r,g,b)
+function gTileFreeWalk:SetDebugMarker (markername, x,y,z, dx,dy,dz, r,g,b)
 	self.debugmarkers =3D self.debugmarkers or {}
 	local mymarker =3D self.debugmarkers[markername]
-	if (not mymarker) then =

-		mymarker =3D CreateRootGfx3D() =

-		mymarker:SetSimpleRenderable()
-		self.debugmarkers[markername] =3D mymarker =

-		=

-		mymarker.gfx_marker2 =3D CreateRootGfx3D()
-		mymarker.gfx_marker2:SetMesh(self.sDebugMarkerMeshName)	=

-	end
-	mymarker.xloc =3D xloc
-	mymarker.yloc =3D yloc
-	mymarker.zloc =3D zloc
-	mymarker.dx =3D dx
-	mymarker.dy =3D dy
-	mymarker.dz =3D dz
+	if (not mymarker) then mymarker =3D {} self.debugmarkers[markername] =3D =
mymarker end
+	mymarker.data =3D {x,y,z, dx,dy,dz, r,g,b}
 	self:UpdateDebugMarker(mymarker)
---~ 	mymarker:SetMaterial(GetPlainColourMat(r or 1,g or 1,b or 0))
-	mymarker:SetMaterial("tilefreewalk_markerbase")
---~ 	mymarker:SetMaterial(GetHuedMat("tilefreewalk_markerbase",r or 1,g or=
 1,b or 0))
-end
-	=

-function gTileFreeWalk:UpdateAllDebugMarkers () =

-	for k,mymarker in pairs(self.debugmarkers or {}) do self:UpdateDebugMarke=
r(mymarker) end
 end
 =

-function gTileFreeWalk:UpdateDebugMarker (mymarker)
-	local x,y,z =3D Renderer3D:UOPosToLocal(mymarker.xloc+0.5,mymarker.yloc+0=
.5,mymarker.zloc + 1) =

---~ 	print("UpdateDebugMarker",sprintf("%0.1f,%0.1f,%0.1f",x,y,z),Renderer=
3D.giMapOriginX,Renderer3D.giMapOriginY)
-	local e =3D 0.5
-	local gfx =3D mymarker
-	local bDynamic =3D false
-	x =3D math.floor(x)
-	y =3D math.floor(y)
-	z =3D math.floor(z)
---~ 	x,y,z =3D -20,18,7
-	mymarker.gfx_marker2:SetPosition(x,y,z)
-	gfx:RenderableBegin(2*4,8,bDynamic or false,false,OT_LINE_LIST)
-	gfx:RenderableVertex(x-e,y,z)
-	gfx:RenderableVertex(x+e,y,z)
-	gfx:RenderableVertex(x,y-e,z)
-	gfx:RenderableVertex(x,y+e,z)
-	gfx:RenderableVertex(x,y,z-e)
-	gfx:RenderableVertex(x,y,z+e)
-	gfx:RenderableVertex(x,y,z)
-	gfx:RenderableVertex(x+1,y+1,z+1)
-	gfx:RenderableIndex(0)
-	gfx:RenderableIndex(1)
-	gfx:RenderableIndex(2)
-	gfx:RenderableIndex(3)
-	gfx:RenderableIndex(4)
-	gfx:RenderableIndex(5)
-	gfx:RenderableIndex(6)
-	gfx:RenderableIndex(7)
-	print("debugdata",x,y,z)
---~ 	gfx:RenderableVertex(x+mymarker.dx,y+mymarker.dy,z+mymarker.dz)
---~ 	print(x+mymarker.dx,y+mymarker.dy,z+mymarker.dz)
-	gfx:RenderableEnd()
+function gTileFreeWalk:UpdateDebugMarker (mymarker,matname)
+	local x,y,z, dx,dy,dz, r,g,b =3D unpack(mymarker.data)
+	if (not mymarker.gfx_big) then
+		mymarker.gfx_big	=3D CreateRootGfx3D()
+		mymarker.gfx_dir	=3D CreateRootGfx3D()
+		mymarker.gfx_big:SetMesh(self.sDebugMarkerMeshName_Big)	=

+		mymarker.gfx_dir:SetMesh(self.sDebugMarkerMeshName_Dir)	=

+		mymarker.gfx_big:SetMeshSubEntityMaterial(0,GetPlainColourMat(r or 1,g o=
r 1,b or 0))	=

+		mymarker.gfx_dir:SetMeshSubEntityMaterial(0,GetPlainColourMat(r or 1,g o=
r 1,b or 0))	=

+		-- GetHuedMat("tilefreewalk_markerbase",r or 1,g or 1,b or 0)
+	end
+	dx,dy,dz =3D Vector.normalise_to_len(dx,dy,dz,0.6)
+	mymarker.gfx_big:SetPosition(x,y,z)
+	mymarker.gfx_dir:SetPosition(x+dx,y+dy,z+dz)
 end
 =




From no-reply at zwischenwelt.org  Fri Sep 28 00:03:25 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 27 Sep 2007 22:03:25 -0000
Subject: [Iris-commit] [IRIS] r1413 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070927220326.20B381C1817E@zwischenwelt.org>

Author: ghoulsblade
Date: Fri Sep 28 00:03:24 2007
New Revision: 1413

Log:
working on tilefree movement...

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Fri Sep 28 00:03:24 2007
@@ -39,11 +39,6 @@
 	end
 	=

 	self:SetPos_All(0,0,0)
-	=

-	if (gStartGameWithoutNetwork) then -- from StartOfflineMode .. InitPlainG=
UI() StartInGame()
-		--Renderer3D:ChangeCamMode(Renderer3D.kCamMode_Third)
-		--self:SetGlobalUOPos(self:MousePickPos())
-	end
 =

 	RegisterStepper(function () gTileFreeWalk:Step() end) =

 end
@@ -61,13 +56,29 @@
 	local bTurnLeft			=3D gKeyPressed[key_left]		-- WalkTurn(-1) end
 	local bTurnRight		=3D gKeyPressed[key_right]	-- WalkTurn( 1) end
 	=

-	local dx,dy =3D self:GetCurrentMouseDir()
-	if (bWalkInMouseDir) then =

-		local x,y,z =3D self:MousePickPos()
-		self.lastmarkerpos =3D {x,y,z}
-	end
-	local x,y,z =3D unpack(self.lastmarkerpos or {0,0,0})
-	self:SetDebugMarker("rightclickwalk", x,y,z, dx,dy,0, 1,1,0)
+	-- rightclick+hold : walk in mouse direction
+	if (bWalkInMouseDir) then
+		local dx,dy =3D self:GetCurrentMouseDir() =

+		=

+		if ((not self.init) and gStartGameWithoutNetwork) then
+			self.init =3D true
+			Renderer3D:ChangeCamMode(Renderer3D.kCamMode_Third)
+			local x,y,z =3D self:MousePickPos()
+			self:SetPos_All(x,y,z)
+		end
+		=

+		local x,y,z =3D self:GetPos_ClientSide()
+		local speed =3D self:GetClientSideSpeed() * gSecondsSinceLastFrame
+		x =3D x + dx * speed
+		y =3D y + dy * speed
+		self:SetPos_ClientSide(x,y,z)
+		self:SetDebugMarker("GetPos_ClientSide", x,y,z, dx,dy,0, 1,1,0)
+	end
+	=

+	local x,y,z =3D self:GetPos_LastConfirmed()
+	self:SetDebugMarker("GetPos_LastConfirmed", x,y,z, 0,0,0, 0,1,0)
+	local x,y,z =3D self:GetPos_LastRequested()
+	self:SetDebugMarker("GetPos_LastRequested", x,y,z, 0,0,0, 0,0,1)
 	=

 	=

 	-- todo : only check for send if we want to send walk requests
@@ -127,8 +138,11 @@
 =

 -- world-units (tiles for uo) per second
 -- todo : depends on conditions(stamina,spells,buffs,debuffs...) and on mo=
unt/horse ?
-function gTileFreeWalk:Impl_GetMaxAllowedSpeed		() return 1 end
+function gTileFreeWalk:Impl_GetMaxAllowedSpeed		() return 4 end
 function gTileFreeWalk:Impl_GetMaxAllowedTurnRate	() return 45*gfDeg2Rad e=
nd
+
+-- feedback for thirdpersoncam
+function gTileFreeWalk:GetExactLocalPos	() return self:GetPos_ClientSide()=
 end
 =

 =

 =

@@ -191,7 +205,7 @@
 		mymarker.gfx_dir:SetMeshSubEntityMaterial(0,GetPlainColourMat(r or 1,g o=
r 1,b or 0))	=

 		-- GetHuedMat("tilefreewalk_markerbase",r or 1,g or 1,b or 0)
 	end
-	dx,dy,dz =3D Vector.normalise_to_len(dx,dy,dz,0.6)
+	if (dx ~=3D 0 or dy ~=3D 0 or dz ~=3D 0) then dx,dy,dz =3D Vector.normali=
se_to_len(dx,dy,dz,0.6) end
 	mymarker.gfx_big:SetPosition(x,y,z)
 	mymarker.gfx_dir:SetPosition(x+dx,y+dy,z+dz)
 end



From no-reply at zwischenwelt.org  Fri Sep 28 00:55:50 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 27 Sep 2007 22:55:50 -0000
Subject: [Iris-commit] [IRIS] r1414 - /trunk/bin/iris2.exe
Message-ID: <20070927225550.B02331C1817F@zwischenwelt.org>

Author: sience
Date: Fri Sep 28 00:55:49 2007
New Revision: 1414

Log:
-new binary

Modified:
    trunk/bin/iris2.exe

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Fri Sep 28 01:34:49 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 27 Sep 2007 23:34:49 -0000
Subject: [Iris-commit] [IRIS] r1415 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070927233449.3546D1C1817E@zwischenwelt.org>

Author: ghoulsblade
Date: Fri Sep 28 01:34:48 2007
New Revision: 1415

Log:
working on tilefree movement...

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Fri Sep 28 01:34:48 2007
@@ -32,6 +32,8 @@
 	if (not gEnableTileFreeWalk) then return end -- set in config.lua : gEnab=
leTileFreeWalk =3D true
 	if (gCurrentRenderer ~=3D Renderer3D) then return end
 	self.iLastWalkRequestSendTime =3D 0
+	self.pathpoints =3D {}
+	self.debugmarkers =3D {}
 	=

 	if (true) then
 		self.sDebugMarkerMeshName_Big	=3D MakeSphereMesh(11,11,0.3,0.3,0.1)
@@ -39,6 +41,10 @@
 	end
 	=

 	self:SetPos_All(0,0,0)
+	if (gStartGameWithoutNetwork) then
+		Renderer3D:ChangeCamMode(Renderer3D.kCamMode_Third)
+		self:SetPos_All(-1675.5,284.5,5.0)
+	end
 =

 	RegisterStepper(function () gTileFreeWalk:Step() end) =

 end
@@ -58,20 +64,16 @@
 	=

 	-- rightclick+hold : walk in mouse direction
 	if (bWalkInMouseDir) then
-		local dx,dy =3D self:GetCurrentMouseDir() =

-		=

-		if ((not self.init) and gStartGameWithoutNetwork) then
-			self.init =3D true
-			Renderer3D:ChangeCamMode(Renderer3D.kCamMode_Third)
-			local x,y,z =3D self:MousePickPos()
-			self:SetPos_All(x,y,z)
-		end
+		local dx,dy,pixel_dist_from_center =3D self:GetCurrentMouseDir() =

+		--local x,y,z =3D self:MousePickPos()
 		=

 		local x,y,z =3D self:GetPos_ClientSide()
-		local speed =3D self:GetClientSideSpeed() * gSecondsSinceLastFrame
+		local slowarea_pixels =3D 50
+		local speed =3D self:GetClientSideSpeed(dx,dy,0) * gSecondsSinceLastFram=
e * math.min(1.0,pixel_dist_from_center / slowarea_pixels)
 		x =3D x + dx * speed
 		y =3D y + dy * speed
 		self:SetPos_ClientSide(x,y,z)
+		self:PathPoint_SetCur()
 		self:SetDebugMarker("GetPos_ClientSide", x,y,z, dx,dy,0, 1,1,0)
 	end
 	=

@@ -81,16 +83,28 @@
 	self:SetDebugMarker("GetPos_LastRequested", x,y,z, 0,0,0, 0,0,1)
 	=

 	=

-	-- todo : only check for send if we want to send walk requests
+
 	-- send walk requests to server
 	local iTimeSinceLastWalkRequest =3D gMyTicks - self.iLastWalkRequestSendT=
ime
 	local iWalkRequestInterval =3D self:GetWalkRequestInterval()
+	-- iWalkRequestInterval =3D 200 -- debug
 	if (iTimeSinceLastWalkRequest >=3D iWalkRequestInterval) then
-		self.iLastWalkRequestSendTime =3D (iTimeSinceLastWalkRequest   > 2*iWalk=
RequestInterval) and gMyTicks or =

-										(self.iLastWalkRequestSendTime + iWalkRequestInterval)
+		if (self:PathPoint_HasNext()) then -- only check for send if we want to =
send walk requests =

+			self.iLastWalkRequestSendTime =3D (iTimeSinceLastWalkRequest   > 2*iWal=
kRequestInterval) and gMyTicks or =

+											(self.iLastWalkRequestSendTime + iWalkRequestInterval)
+			=

+			-- todo : send request
+			local x,y,z =3D self:PathPoint_GetNth(1)
+			self:PathPoint_Pop()
+			self:SetPos_LastRequested(x,y,z)
+			=

+			print("walk request to ",x,y,z,iTimeSinceLastWalkRequest,iWalkRequestIn=
terval)
 		=

-		-- todo : send request
-		=

+			local bSelfConfirmAll =3D gStartGameWithoutNetwork
+			if (bSelfConfirmAll) then self:SetPos_LastConfirmed(x,y,z) end -- debug=
/offline mode only
+		else
+			print("no walk request pending")
+		end
 	end
 end
 =

@@ -101,25 +115,39 @@
 function gTileFreeWalk:GetMaxAllowedSpeed		() return self:Impl_GetMaxAllow=
edSpeed() end
 function gTileFreeWalk:GetMaxAllowedTurnRate	() return self:Impl_GetMaxAll=
owedTurnRate() end =

 =

-function gTileFreeWalk:GetWalkRequestInterval	() return 1/self:GetClientSi=
deSpeed() end
+function gTileFreeWalk:GetWalkRequestInterval	() return 1000/self:GetMaxAl=
lowedSpeed() end
 =

 function gTileFreeWalk:GetClientSideTurnRate	() return self:GetMaxAllowedT=
urnRate() end =

 =

-function gTileFreeWalk:GetClientSideSpeed		() =

+-- returns the movement speed, dx,dy,dz is the direction of the movement
+-- the speed is dependant on the distance of the current pos to the last c=
onfirmed pos
+-- and on the direction of the movement
+function gTileFreeWalk:GetClientSideSpeed		(dx,dy,dz)
 	local maxspeed			=3D self:GetMaxAllowedSpeed()
+	=

+	dx,dy,dz =3D Vector.normalise(dx,dy,dz)
+	local x,y,z =3D self:GetPos_ClientSide()
+	local cx,cy,cz =3D self:GetPos_LastConfirmed()
+	local vx,vy,vz =3D Vector.normalise(Vector.sub(cx,cy,cz, x,y,z)) -- vecto=
r from cur pos to last confirmed pos
+	local dot =3D Vector.dot(dx,dy,dz, vx,vy,vz) -- +1.0 if walking back, -1.=
0 if walking away
+	local slow_dir =3D math.max(0,math.min(1,1.0-dot))-- 0 =3D no slowdown =
=3D> max speed : no slowdown when dot =3D 1
+	=

 	local dist				=3D self:GetDistanceToLastConfirmedPos()
 	local tolerated_dist	=3D 1
 	local minspeed_dist		=3D 4 + tolerated_dist -- todo : currently slowdown =
is linear, make smoother spline here ?
-	return maxspeed * (1.0 - math.min(0.9,math.max(0,dist-tolerated_dist)/min=
speed_dist))
-end
-
--- returns dx,dy in uo coordinate system, vector2d(dx,dy).length =3D 1
+	local slow_dist			=3D math.min(0.9,math.max(0,dist-tolerated_dist)/minspe=
ed_dist) -- 0 =3D no slowdown =3D> max speed
+	=

+	return maxspeed * (1.0 - slow_dist * slow_dir)
+end
+
+-- returns dx,dy,pixel_dist_from_center in uo coordinate system, vector2d(=
dx,dy).length =3D 1
 function gTileFreeWalk:GetCurrentMouseDir	()
 	local mx, my =3D GetMousePos()
 	local vw, vh =3D GetViewportSize()
 	local ax,ay,az =3D GetMainCam():GetEulerAng()
 	local mouseang =3D -math.atan2( my-vh/2.0, mx-vw/2.0 ) + ax -- in radians
-	return math.cos(mouseang),math.sin(mouseang)
+	local pixel_dist_from_center =3D Vector.len( my-vh/2.0, mx-vw/2.0 , 0)
+	return math.cos(mouseang),math.sin(mouseang),pixel_dist_from_center
 end
 =

 =

@@ -154,6 +182,38 @@
 	Crash()
 end)
 =

+-- ##### ##### ##### ##### ##### pathpoints
+
+-- the system remembers which path was walked clientside, and approximates=
 it for sending to the walk requests
+
+function gTileFreeWalk:PathPoint_SetLast	(x,y,z)		self.lastMarkedWalkPos =
=3D {x,y,z} end
+function gTileFreeWalk:PathPoint_GetLast	()			return unpack(self.lastMarke=
dWalkPos) end
+function gTileFreeWalk:PathPoint_GetNext	() return self:PathPoint_GetNth(1=
) end
+function gTileFreeWalk:PathPoint_GetNth		(n) -- n=3D1 for first =3D next
+	if (not self.pathpoints[n]) then return end
+	return unpack(self.pathpoints[n])
+end
+function gTileFreeWalk:PathPoint_HasNext	() return self:PathPoint_Has(1) e=
nd
+function gTileFreeWalk:PathPoint_Has		(n) return table.getn(self.pathpoint=
s) >=3D n end
+function gTileFreeWalk:PathPoint_Pop		() =

+	if (self:PathPoint_HasNext()) then =

+		local x,y,z =3D self:PathPoint_GetNext()
+		self:DelDebugMarker("path"..x..","..y..","..z)
+		table.remove(self.pathpoints,1) =

+	end =

+end
+function gTileFreeWalk:PathPoint_Push		(x,y,z)
+	table.insert(self.pathpoints,{x,y,z})
+	self:PathPoint_SetLast(x,y,z)
+	self:SetDebugMarker("path"..x..","..y..","..z, x,y,z, 0,0,0, 0.5,0.5,0.5)
+end
+function gTileFreeWalk:PathPoint_SetCur		()
+	local x,y,z =3D self:GetPos_ClientSide_Rounded()
+	local lx,ly,lz =3D self:PathPoint_GetLast()
+	if (lx =3D=3D x and ly =3D=3D y and lz =3D=3D z) then return end
+	self:PathPoint_Push(x,y,z)
+end
+
 -- ##### ##### ##### ##### ##### position and coordinate system conversions
 =

 =

@@ -165,6 +225,12 @@
 -- returns x,y,z
 function gTileFreeWalk:MousePickPos 		() 			return self:Impl_MousePickPos(=
) end
 =

+
+function gTileFreeWalk:GetPos_ClientSide_Rounded	()
+	local x,y,z =3D self:GetPos_ClientSide()
+	local e,f =3D 0,0.5
+	return math.floor(x+e)+f,math.floor(y+e)+f,math.floor(z+e)+f
+end
 function gTileFreeWalk:GetPos_ClientSide	()			return unpack(self.pos_clien=
tside) end
 function gTileFreeWalk:SetPos_ClientSide	(x,y,z)		self.pos_clientside =3D =
{x,y,z} end
 =

@@ -179,6 +245,7 @@
 	self:SetPos_ClientSide(		x,y,z)
 	self:SetPos_LastConfirmed(	x,y,z)
 	self:SetPos_LastRequested(	x,y,z)
+	self:PathPoint_SetLast(		x,y,z)
 end
 =

 =

@@ -186,8 +253,15 @@
 -- ##### ##### ##### ##### ##### debug markers
 =

 =

+function gTileFreeWalk:DelDebugMarker (markername)
+	local mymarker =3D self.debugmarkers[markername]
+	if (not mymarker) then return end
+	self.debugmarkers[markername] =3D nil
+	mymarker.gfx_big:Destroy()
+	mymarker.gfx_dir:Destroy()
+end
+
 function gTileFreeWalk:SetDebugMarker (markername, x,y,z, dx,dy,dz, r,g,b)
-	self.debugmarkers =3D self.debugmarkers or {}
 	local mymarker =3D self.debugmarkers[markername]
 	if (not mymarker) then mymarker =3D {} self.debugmarkers[markername] =3D =
mymarker end
 	mymarker.data =3D {x,y,z, dx,dy,dz, r,g,b}



From no-reply at zwischenwelt.org  Fri Sep 28 02:21:31 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 28 Sep 2007 00:21:31 -0000
Subject: [Iris-commit] [IRIS] r1416 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070928002131.A204F1C1817F@zwischenwelt.org>

Author: ghoulsblade
Date: Fri Sep 28 02:21:30 2007
New Revision: 1416

Log:
working on tilefree movement...

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Fri Sep 28 02:21:30 2007
@@ -62,7 +62,7 @@
 	local bTurnLeft			=3D gKeyPressed[key_left]		-- WalkTurn(-1) end
 	local bTurnRight		=3D gKeyPressed[key_right]	-- WalkTurn( 1) end
 	=

-	-- rightclick+hold : walk in mouse direction
+	-- hold rightmouse button to walk in mouse direction (depends on center o=
f screen, works good for 3rd person cam)
 	if (bWalkInMouseDir) then
 		local dx,dy,pixel_dist_from_center =3D self:GetCurrentMouseDir() =

 		--local x,y,z =3D self:MousePickPos()
@@ -72,11 +72,22 @@
 		local speed =3D self:GetClientSideSpeed(dx,dy,0) * gSecondsSinceLastFram=
e * math.min(1.0,pixel_dist_from_center / slowarea_pixels)
 		x =3D x + dx * speed
 		y =3D y + dy * speed
+		=

+		local rx,ry,rz =3D self:RoundPos(x,y,z)
+		local lx,ly,lz =3D self:PathPoint_GetLast()
+		if (lx ~=3D rx or ly ~=3D ry) then =

+			self:PathPoint_Push(rx,ry,rz)
+			-- TODO : read new surrounding height info here
+		end
+		=

+		-- todo : calc correct z here
+		z =3D z
+		=

 		self:SetPos_ClientSide(x,y,z)
-		self:PathPoint_SetCur()
 		self:SetDebugMarker("GetPos_ClientSide", x,y,z, dx,dy,0, 1,1,0)
 	end
 	=

+	-- debug markers
 	local x,y,z =3D self:GetPos_LastConfirmed()
 	self:SetDebugMarker("GetPos_LastConfirmed", x,y,z, 0,0,0, 0,1,0)
 	local x,y,z =3D self:GetPos_LastRequested()
@@ -87,23 +98,29 @@
 	-- send walk requests to server
 	local iTimeSinceLastWalkRequest =3D gMyTicks - self.iLastWalkRequestSendT=
ime
 	local iWalkRequestInterval =3D self:GetWalkRequestInterval()
-	-- iWalkRequestInterval =3D 200 -- debug
 	if (iTimeSinceLastWalkRequest >=3D iWalkRequestInterval) then
 		if (self:PathPoint_HasNext()) then -- only check for send if we want to =
send walk requests =

 			self.iLastWalkRequestSendTime =3D (iTimeSinceLastWalkRequest   > 2*iWal=
kRequestInterval) and gMyTicks or =

-											(self.iLastWalkRequestSendTime + iWalkRequestInterval)
+											(self.iLastWalkRequestSendTime + iWalkRequestInterval) -- compe=
nsate low framerates a bit
+			=

+			-- determine the "next" position for the request, summarize as much int=
o one step as possible
+			local lx,ly,lz =3D self:GetPos_LastRequested()
+			local rx,ry,rz
+			local i =3D 1
+			while (self:PathPoint_HasNext()) do -- go to the furthes path point tha=
t can be reached in one step (diag)
+				local x,y,z =3D self:PathPoint_GetNext()
+				if (math.abs(x-lx) > 1 or math.abs(y-ly) > 1) then break end -- adjact=
ed ? (todo : check if walk possible ?)
+				rx,ry,rz =3D x,y,z
+				self:PathPoint_Pop()
+			end
+			self:SetPos_LastRequested(rx,ry,rz)
 			=

 			-- todo : send request
-			local x,y,z =3D self:PathPoint_GetNth(1)
-			self:PathPoint_Pop()
-			self:SetPos_LastRequested(x,y,z)
-			=

-			print("walk request to ",x,y,z,iTimeSinceLastWalkRequest,iWalkRequestIn=
terval)
-		=

+			--print("walk request to ",rx,ry,rz,iTimeSinceLastWalkRequest,iWalkRequ=
estInterval)
+		=

+			-- confirm here if there is no server
 			local bSelfConfirmAll =3D gStartGameWithoutNetwork
-			if (bSelfConfirmAll) then self:SetPos_LastConfirmed(x,y,z) end -- debug=
/offline mode only
-		else
-			print("no walk request pending")
+			if (bSelfConfirmAll) then self:SetPos_LastConfirmed(rx,ry,rz) end -- de=
bug/offline mode only
 		end
 	end
 end
@@ -115,7 +132,7 @@
 function gTileFreeWalk:GetMaxAllowedSpeed		() return self:Impl_GetMaxAllow=
edSpeed() end
 function gTileFreeWalk:GetMaxAllowedTurnRate	() return self:Impl_GetMaxAll=
owedTurnRate() end =

 =

-function gTileFreeWalk:GetWalkRequestInterval	() return 1000/self:GetMaxAl=
lowedSpeed() end
+function gTileFreeWalk:GetWalkRequestInterval	() return 1000/self:GetMaxAl=
lowedSpeed() end -- in milliseconds
 =

 function gTileFreeWalk:GetClientSideTurnRate	() return self:GetMaxAllowedT=
urnRate() end =

 =

@@ -208,13 +225,10 @@
 	self:SetDebugMarker("path"..x..","..y..","..z, x,y,z, 0,0,0, 0.5,0.5,0.5)
 end
 function gTileFreeWalk:PathPoint_SetCur		()
-	local x,y,z =3D self:GetPos_ClientSide_Rounded()
-	local lx,ly,lz =3D self:PathPoint_GetLast()
-	if (lx =3D=3D x and ly =3D=3D y and lz =3D=3D z) then return end
-	self:PathPoint_Push(x,y,z)
 end
 =

 -- ##### ##### ##### ##### ##### position and coordinate system conversions
+
 =

 =

 function gTileFreeWalk:GetDistanceToLastConfirmedPos () =

@@ -226,8 +240,7 @@
 function gTileFreeWalk:MousePickPos 		() 			return self:Impl_MousePickPos(=
) end
 =

 =

-function gTileFreeWalk:GetPos_ClientSide_Rounded	()
-	local x,y,z =3D self:GetPos_ClientSide()
+function gTileFreeWalk:RoundPos	(x,y,z)
 	local e,f =3D 0,0.5
 	return math.floor(x+e)+f,math.floor(y+e)+f,math.floor(z+e)+f
 end



From no-reply at zwischenwelt.org  Fri Sep 28 23:10:52 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 28 Sep 2007 21:10:52 -0000
Subject: [Iris-commit] [IRIS] r1417 - in /trunk/data/lua: lib.protocol.lua
	lib.tilefreewalk.lua
Message-ID: <20070928211052.39C001C18167@zwischenwelt.org>

Author: ghoulsblade
Date: Fri Sep 28 23:10:51 2007
New Revision: 1417

Log:
working on tilefree movement code ...

Modified:
    trunk/data/lua/lib.protocol.lua
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.protocol.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.protocol.lua (original)
+++ trunk/data/lua/lib.protocol.lua Fri Sep 28 23:10:51 2007
@@ -49,6 +49,11 @@
 	=

 	--OldIrisPacketLenTest()
 	=

+-- interpret dircode in ogre coordinate system
+function GetDirXLocal (dir) return -GetDirX(dir) end
+function GetDirYLocal (dir) return  GetDirY(dir) end
+
+-- interpret dircode in uo coordinate system
 function GetDirX (dir) =

 	if (dir =3D=3D 1 or dir =3D=3D 2 or dir =3D=3D 3) then return 1 -- east
 	elseif (dir =3D=3D 5 or dir =3D=3D 6 or dir =3D=3D 7) then return -1 -- w=
est

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Fri Sep 28 23:10:51 2007
@@ -36,7 +36,7 @@
 	self.debugmarkers =3D {}
 	=

 	if (true) then
-		self.sDebugMarkerMeshName_Big	=3D MakeSphereMesh(11,11,0.3,0.3,0.1)
+		self.sDebugMarkerMeshName_Big	=3D MakeSphereMesh(11,11,0.2,0.2,0.2)
 		self.sDebugMarkerMeshName_Dir	=3D MakeSphereMesh(11,11,0.1,0.1,0.1)
 	end
 	=

@@ -77,11 +77,16 @@
 		local lx,ly,lz =3D self:PathPoint_GetLast()
 		if (lx ~=3D rx or ly ~=3D ry) then =

 			self:PathPoint_Push(rx,ry,rz)
-			-- TODO : read new surrounding height info here
+			-- read new surrounding height info here
+			self.groundcache =3D self:Impl_ScanGround(rx,ry,rz)
 		end
 		=

 		-- todo : calc correct z here
-		z =3D z
+		if (self.groundcache) then
+			local ex,ey =3D x - rx,y - ry
+			print("zcorr",sprintf("%+0.1f,%+0.1f",ex,ey))
+			z =3D z
+		end
 		=

 		self:SetPos_ClientSide(x,y,z)
 		self:SetDebugMarker("GetPos_ClientSide", x,y,z, dx,dy,0, 1,1,0)
@@ -170,6 +175,64 @@
 =

 -- ##### ##### ##### ##### ##### implementation (currently uo specific, wi=
ll later be inserted from extern)
 =

+--[[
+	z					=3D GetAbsTile(bx*8+tx,by*8+ty) -- access gGroundBlockLoader
+	z 					=3D AverageGroundHeight(bx,by,tx,ty) -- average edges
+	bIsWalkable,iNewZ	=3D GetNearestGroundLevel(bx,by,tx,ty,iStartZ,iDir) =

+		-- iDir is only used for diagonal here, but the passed in position is th=
e TARGET position that is to be checked
+		-- iStartZ must be rounded
+	=

+
+	request.onSuccess_XLoc =3D tx + GetDirX(gPlayerDir)
+	request.onSuccess_YLoc =3D ty + GetDirY(gPlayerDir)
+	request.onSuccess_ZLoc =3D tz
+
+	request.bClientSidePassable, request.onSuccess_ZLoc =3D GetNearestGroundL=
evel(
+								math.floor(request.onSuccess_XLoc/8), =

+								math.floor(request.onSuccess_YLoc/8), =

+								math.mod(request.onSuccess_XLoc,8), =

+								math.mod(request.onSuccess_YLoc,8),
+								request.onSuccess_ZLoc, iDir)
+								=

+
+	local x,y,z =3D Renderer3D:UOPosToLocal(xloc,yloc,zloc * 0.1)
+]]--
+
+
+-- returns bx,by,tx,ty
+function gTileFreeWalk:Impl_UOPos2BT (xloc,yloc) return math.floor(xloc/8)=
,math.floor(yloc/8),math.mod(xloc,8),math.mod(yloc,8) end =

+
+-- input : rounded
+-- read new surrounding height info
+function gTileFreeWalk:Impl_ScanGround (rx,ry,rz)
+	local xloc,yloc,zloc =3D Renderer3D:LocalToUOPos(rx,ry,rz*10)
+	xloc =3D math.floor(xloc)
+	yloc =3D math.floor(yloc)
+	zloc =3D math.floor(zloc)
+	--print(arrdump({"Impl_ScanGround",rx,ry,rz," ",xloc,yloc,zloc}))
+	=

+	local iSelfZ =3D zloc
+	local groundcache =3D {}
+	for iDir=3D0,7 do =

+		local ldx,ldy =3D GetDirXLocal(iDir),GetDirYLocal(iDir)
+		local iNewZ =3D self:Impl_CalcWalkStep(xloc+GetDirX(iDir),yloc+GetDirY(i=
Dir),zloc,iDir)
+		=

+		-- one walkable dir : calc own z by "walking back"
+		if (iNewZ) then iSelfZ =3D self:Impl_CalcWalkStep(xloc,yloc,zloc,math.mo=
d(iDir+4,8)) or iSelfZ end
+		groundcache[ldx..","..ldy] =3D iNewZ
+		--print(ldx..","..ldy,iNewZ)
+	end
+	groundcache["0,0"] =3D iSelfZ
+	--print("0,0",iSelfZ)
+	return groundcache
+end
+
+function gTileFreeWalk:Impl_CalcWalkStep (xloc,yloc,zloc,iDir)
+	local bx,by,tx,ty =3D self:Impl_UOPos2BT(xloc,yloc)
+	local bIsWalkable,iNewZ	=3D GetNearestGroundLevel(bx,by,tx,ty,zloc,iDir)
+	return bIsWalkable and iNewZ
+end
+
 =

 -- returns x,y,z
 function gTileFreeWalk:Impl_MousePickPos ()
@@ -241,8 +304,8 @@
 =

 =

 function gTileFreeWalk:RoundPos	(x,y,z)
-	local e,f =3D 0,0.5
-	return math.floor(x+e)+f,math.floor(y+e)+f,math.floor(z+e)+f
+	local e,f,zscale =3D 0,0.5,10
+	return math.floor(x+e)+f,math.floor(y+e)+f,math.floor(z*zscale)/zscale
 end
 function gTileFreeWalk:GetPos_ClientSide	()			return unpack(self.pos_clien=
tside) end
 function gTileFreeWalk:SetPos_ClientSide	(x,y,z)		self.pos_clientside =3D =
{x,y,z} end



From no-reply at zwischenwelt.org  Sat Sep 29 01:52:20 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 28 Sep 2007 23:52:20 -0000
Subject: [Iris-commit] [IRIS] r1418 - in /trunk/data/lua: lib.bugreport.lua
 lib.protocol.lua lib.tilefreewalk.lua main.lua
Message-ID: <20070928235220.563AE1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Sep 29 01:52:19 2007
New Revision: 1418

Log:
added bug report dialog

Added:
    trunk/data/lua/lib.bugreport.lua
Modified:
    trunk/data/lua/lib.protocol.lua
    trunk/data/lua/lib.tilefreewalk.lua
    trunk/data/lua/main.lua

Modified: trunk/data/lua/lib.protocol.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.protocol.lua (original)
+++ trunk/data/lua/lib.protocol.lua Sat Sep 29 01:52:19 2007
@@ -50,8 +50,8 @@
 	--OldIrisPacketLenTest()
 	=

 -- interpret dircode in ogre coordinate system
-function GetDirXLocal (dir) return -GetDirX(dir) end
-function GetDirYLocal (dir) return  GetDirY(dir) end
+function GetDirXLocal (dir) local a =3D GetDirX(dir) return (a=3D=3D0) and=
 0 or (-a) end -- prevent "-0", float supports signed zero
+function GetDirYLocal (dir) return GetDirY(dir) end
 =

 -- interpret dircode in uo coordinate system
 function GetDirX (dir) =


Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Sat Sep 29 01:52:19 2007
@@ -13,6 +13,9 @@
 	=

 	todo : later : autowalk : follow mobile etc, see old WalkStep() in net.wa=
lk.lua
 	=

+	-- TODO : uo tricky because you can walk diagonally between two obstacles
+		-- during walking diagonally the rounded position will probably be on a =
blocked tile !
+		-- walkrequest to blocked pos may not be sent
 	=

 	-- TODO : capsule all uo specific stuff so that this lib is usable in oth=
er projects
 	-- TODO : 3 debugmarkers : a) clienside pos, b) last-walk-request pos c) =
last position confirmed by server
@@ -20,6 +23,7 @@
 	-- TODO : smooth clientside speed, even if server lags a bit and then sen=
ds multiple confirmations at once
 	-- TODO : util to get heightfieldpos ? (terrain only ? statics ? startz+t=
racedown ? generic raytrace util ? ...)
 	-- TODO : util to cache current pos and the 8 surrounding heights (lib.wa=
lking2.lua)
+	=

 ]]--
 =

 gTileFreeWalk =3D {}
@@ -79,12 +83,26 @@
 			self:PathPoint_Push(rx,ry,rz)
 			-- read new surrounding height info here
 			self.groundcache =3D self:Impl_ScanGround(rx,ry,rz)
+			=

+			asdasda()
 		end
+		=

+		-- todo : block movement here
 		=

 		-- todo : calc correct z here
 		if (self.groundcache) then
-			local ex,ey =3D x - rx,y - ry
-			print("zcorr",sprintf("%+0.1f,%+0.1f",ex,ey))
+			local l =3D (x <=3D rx) and (rx-1) or rx
+			local t =3D (y <=3D ry) and (ry-1) or ry
+			local fx,fy =3D x-l,y-t
+			local x00,y00 =3D l-rx,t-ry
+			local zSelf =3D self.groundcache["0,0"]
+			local z00 =3D self.groundcache[(x00  )..","..(y00  )]
+			local z10 =3D self.groundcache[(x00+1)..","..(y00  )]
+			local z01 =3D self.groundcache[(x00  )..","..(y00+1)]
+			local z11 =3D self.groundcache[(x00+1)..","..(y00+1)]
+			for k,v in pairs(self.groundcache) do print(k,v) end
+			--print("zcorr",sprintf("%f,%f %+0.1f,%+0.1f %f %f %f %f",l,t,fx,fy,z00=
,z10,z01,z11))
+			print("zcorr",z00,z10,z01,z11,zSelf,z)
 			z =3D z
 		end
 		=

@@ -108,6 +126,7 @@
 			self.iLastWalkRequestSendTime =3D (iTimeSinceLastWalkRequest   > 2*iWal=
kRequestInterval) and gMyTicks or =

 											(self.iLastWalkRequestSendTime + iWalkRequestInterval) -- compe=
nsate low framerates a bit
 			=

+			-- todo : pathpoints can be impassable, happens during diagonal walk, d=
on't send walk requests to those
 			-- determine the "next" position for the request, summarize as much int=
o one step as possible
 			local lx,ly,lz =3D self:GetPos_LastRequested()
 			local rx,ry,rz
@@ -219,10 +238,10 @@
 		=

 		-- one walkable dir : calc own z by "walking back"
 		if (iNewZ) then iSelfZ =3D self:Impl_CalcWalkStep(xloc,yloc,zloc,math.mo=
d(iDir+4,8)) or iSelfZ end
-		groundcache[ldx..","..ldy] =3D iNewZ
+		groundcache[ldx..","..ldy] =3D iNewZ and (iNewZ*0.1)  -- rounding avoids=
 things like "-0"
 		--print(ldx..","..ldy,iNewZ)
 	end
-	groundcache["0,0"] =3D iSelfZ
+	groundcache["0,0"] =3D iSelfZ*0.1
 	--print("0,0",iSelfZ)
 	return groundcache
 end
@@ -322,6 +341,7 @@
 	self:SetPos_LastConfirmed(	x,y,z)
 	self:SetPos_LastRequested(	x,y,z)
 	self:PathPoint_SetLast(		x,y,z)
+	print("todo : init ground")
 end
 =

 =


Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Sat Sep 29 01:52:19 2007
@@ -97,6 +97,7 @@
 =

 --can be removed from release
 dofile(libpath .. "lib.meshexporter.lua")
+dofile(libpath .. "lib.bugreport.lua")
 =

 =

 --###############################



From no-reply at zwischenwelt.org  Sat Sep 29 01:52:48 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 28 Sep 2007 23:52:48 -0000
Subject: [Iris-commit] [IRIS] r1419 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070928235248.D24691C18167@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Sep 29 01:52:47 2007
New Revision: 1419

Log:
added bug report dialog

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Sat Sep 29 01:52:47 2007
@@ -83,8 +83,6 @@
 			self:PathPoint_Push(rx,ry,rz)
 			-- read new surrounding height info here
 			self.groundcache =3D self:Impl_ScanGround(rx,ry,rz)
-			=

-			asdasda()
 		end
 		=

 		-- todo : block movement here



From no-reply at zwischenwelt.org  Sat Sep 29 02:48:21 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 29 Sep 2007 00:48:21 -0000
Subject: [Iris-commit] [IRIS] r1420 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070929004822.6705B1C18125@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Sep 29 02:48:19 2007
New Revision: 1420

Log:
freewalk height adjustments starts to work

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Sat Sep 29 02:48:19 2007
@@ -57,6 +57,17 @@
 =

 -- ##### ##### ##### ##### ##### step
 =

+function InterpolateSquare (z00,z10,z01,z11,fx,fy) -- z00=3Dleft_top:fx=3D=
fy=3D0   z10=3Dright_top:fx=3D1,fy=3D0
+	local t =3D fx * z10 + (1.0 - fx) * z00
+	local b =3D fx * z11 + (1.0 - fx) * z01
+	return fy * b + (1.0 - fy) * t
+end
+
+local z00,z10,z01,z11 =3D 1,2,3,4
+assert(InterpolateSquare(z00,z10,z01,z11, 0,0) =3D=3D z00)
+assert(InterpolateSquare(z00,z10,z01,z11, 1,0) =3D=3D z10)
+assert(InterpolateSquare(z00,z10,z01,z11, 0,1) =3D=3D z01)
+assert(InterpolateSquare(z00,z10,z01,z11, 1,1) =3D=3D z11)
 =

 function gTileFreeWalk:Step	()
 	if (gCurrentRenderer ~=3D Renderer3D) then return end
@@ -93,15 +104,15 @@
 			local t =3D (y <=3D ry) and (ry-1) or ry
 			local fx,fy =3D x-l,y-t
 			local x00,y00 =3D l-rx,t-ry
-			local zSelf =3D self.groundcache["0,0"]
+			local zSelf =3D self.groundcache["0,0"] or z
 			local z00 =3D self.groundcache[(x00  )..","..(y00  )]
 			local z10 =3D self.groundcache[(x00+1)..","..(y00  )]
 			local z01 =3D self.groundcache[(x00  )..","..(y00+1)]
 			local z11 =3D self.groundcache[(x00+1)..","..(y00+1)]
-			for k,v in pairs(self.groundcache) do print(k,v) end
+			--for k,v in pairs(self.groundcache) do print(k,v) end
 			--print("zcorr",sprintf("%f,%f %+0.1f,%+0.1f %f %f %f %f",l,t,fx,fy,z00=
,z10,z01,z11))
+			z =3D InterpolateSquare(z00 or zSelf,z10 or zSelf,z01 or zSelf,z11 or z=
Self,fx,fy)
 			print("zcorr",z00,z10,z01,z11,zSelf,z)
-			z =3D z
 		end
 		=

 		self:SetPos_ClientSide(x,y,z)
@@ -239,7 +250,7 @@
 		groundcache[ldx..","..ldy] =3D iNewZ and (iNewZ*0.1)  -- rounding avoids=
 things like "-0"
 		--print(ldx..","..ldy,iNewZ)
 	end
-	groundcache["0,0"] =3D iSelfZ*0.1
+	groundcache["0,0"] =3D iSelfZ and iSelfZ*0.1
 	--print("0,0",iSelfZ)
 	return groundcache
 end



From no-reply at zwischenwelt.org  Sat Sep 29 04:29:10 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 29 Sep 2007 02:29:10 -0000
Subject: [Iris-commit] [IRIS] r1421 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070929022910.DA1C71C18125@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Sep 29 04:29:10 2007
New Revision: 1421

Log:
tilefreewalk : debug markers for nearby ground and collision

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Sat Sep 29 04:29:10 2007
@@ -24,6 +24,7 @@
 	-- TODO : util to get heightfieldpos ? (terrain only ? statics ? startz+t=
racedown ? generic raytrace util ? ...)
 	-- TODO : util to cache current pos and the 8 surrounding heights (lib.wa=
lking2.lua)
 	=

+	-- TODO : flash/ngame review collision detection article : http://www.har=
veycartel.org/metanet/tutorials.html
 ]]--
 =

 gTileFreeWalk =3D {}
@@ -38,6 +39,7 @@
 	self.iLastWalkRequestSendTime =3D 0
 	self.pathpoints =3D {}
 	self.debugmarkers =3D {}
+	self.debugmarkergroups =3D {}
 	=

 	if (true) then
 		self.sDebugMarkerMeshName_Big	=3D MakeSphereMesh(11,11,0.2,0.2,0.2)
@@ -94,6 +96,18 @@
 			self:PathPoint_Push(rx,ry,rz)
 			-- read new surrounding height info here
 			self.groundcache =3D self:Impl_ScanGround(rx,ry,rz)
+			=

+			self:DebugMarkerGroup_Clear("nearground")
+			for x =3D -1,1 do =

+			for y =3D -1,1 do =

+				local h =3D self.groundcache[x..","..y]
+				if (h) then =

+					self:DebugMarkerGroup_AddSphere("nearground",rx+x,ry+y,h, 0.1, 0,1,0)
+				else	=

+					self:DebugMarkerGroup_AddCylinder("nearground",rx+x,ry+y,rz-1, 0.1,3,=
 1,0,0)
+				end
+			end
+			end
 		end
 		=

 		-- todo : block movement here
@@ -247,10 +261,10 @@
 		=

 		-- one walkable dir : calc own z by "walking back"
 		if (iNewZ) then iSelfZ =3D self:Impl_CalcWalkStep(xloc,yloc,zloc,math.mo=
d(iDir+4,8)) or iSelfZ end
-		groundcache[ldx..","..ldy] =3D iNewZ and (iNewZ*0.1)  -- rounding avoids=
 things like "-0"
+		groundcache[ldx..","..ldy] =3D iNewZ and (iNewZ*0.1 + Renderer3D.gZ_Fact=
or)  -- rounding avoids things like "-0"
 		--print(ldx..","..ldy,iNewZ)
 	end
-	groundcache["0,0"] =3D iSelfZ and iSelfZ*0.1
+	groundcache["0,0"] =3D iSelfZ and (iSelfZ*0.1 + Renderer3D.gZ_Factor)
 	--print("0,0",iSelfZ)
 	return groundcache
 end
@@ -357,6 +371,33 @@
 =

 -- ##### ##### ##### ##### ##### debug markers
 =

+
+
+function gTileFreeWalk:DebugMarkerGroup_Clear (groupname)
+	local myarr =3D self.debugmarkergroups[groupname]
+	if (myarr) then for k,v in pairs(myarr) do v:Destroy() end self.debugmark=
ergroups[groupname] =3D nil end
+end
+
+function gTileFreeWalk:DebugMarkerGroup_AddGfx (groupname,gfx)
+	local myarr =3D self.debugmarkergroups[groupname]
+	if (not myarr) then myarr =3D {} self.debugmarkergroups[groupname] =3D my=
arr end
+	table.insert(myarr,gfx)
+end
+
+function gTileFreeWalk:DebugMarkerGroup_AddSphere (groupname,x,y,z,fRad,r,=
g,b)
+	local gfx =3D CreateRootGfx3D()
+	gfx:SetMesh(MakeSphereMesh(11,11,fRad,fRad,fRad,r,g,b))	=

+	gfx:SetPosition(x,y,z)
+	self:DebugMarkerGroup_AddGfx(groupname,gfx)
+end
+
+function gTileFreeWalk:DebugMarkerGroup_AddCylinder (groupname,x,y,z,fRad,=
fHeight,r,g,b)
+	local gfx =3D CreateRootGfx3D()
+	GfxSetCylinder(gfx,fRad,fHeight)
+	gfx:SetMaterial(GetPlainColourMat(r,g,b))
+	gfx:SetPosition(x,y,z)
+	self:DebugMarkerGroup_AddGfx(groupname,gfx)
+end
 =

 function gTileFreeWalk:DelDebugMarker (markername)
 	local mymarker =3D self.debugmarkers[markername]



From no-reply at zwischenwelt.org  Sat Sep 29 15:41:38 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 29 Sep 2007 13:41:38 -0000
Subject: [Iris-commit] [IRIS] r1422 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070929134139.01BBF1C18129@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Sep 29 15:41:38 2007
New Revision: 1422

Log:
working on tilefree stuff

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Sat Sep 29 15:41:38 2007
@@ -98,13 +98,21 @@
 			self.groundcache =3D self:Impl_ScanGround(rx,ry,rz)
 			=

 			self:DebugMarkerGroup_Clear("nearground")
-			for x =3D -1,1 do =

-			for y =3D -1,1 do =

-				local h =3D self.groundcache[x..","..y]
-				if (h) then =

-					self:DebugMarkerGroup_AddSphere("nearground",rx+x,ry+y,h, 0.1, 0,1,0)
+			for dx =3D -1,1 do =

+			for dy =3D -1,1 do =

+				local x,y,z =3D rx+dx,ry+dy,self.groundcache[dx..","..dy]
+				if (z) then =

+					self:DebugMarkerGroup_AddSphere("nearground", x,y,z, 0.1, 0,1,0)
 				else	=

-					self:DebugMarkerGroup_AddCylinder("nearground",rx+x,ry+y,rz-1, 0.1,3,=
 1,0,0)
+					z =3D rz
+					local r,g,b =3D 1,0,0
+					local h =3D 1
+					local e =3D 0.5
+					self:DebugMarkerGroup_AddCylinder("nearground",x,y,z, 0.1,h, r,g,b)
+					self:DebugMarkerGroup_AddWall("nearground", x,y+e,z,   x+e,y,z, h, r,=
g,b)
+					self:DebugMarkerGroup_AddWall("nearground", x+e,y,z,   x,y-e,z, h, r,=
g,b)
+					self:DebugMarkerGroup_AddWall("nearground", x,y-e,z,   x-e,y,z, h, r,=
g,b)
+					self:DebugMarkerGroup_AddWall("nearground", x-e,y,z,   x,y+e,z, h, r,=
g,b)
 				end
 			end
 			end
@@ -123,10 +131,10 @@
 			local z10 =3D self.groundcache[(x00+1)..","..(y00  )]
 			local z01 =3D self.groundcache[(x00  )..","..(y00+1)]
 			local z11 =3D self.groundcache[(x00+1)..","..(y00+1)]
+			z =3D InterpolateSquare(z00 or zSelf,z10 or zSelf,z01 or zSelf,z11 or z=
Self,fx,fy)
 			--for k,v in pairs(self.groundcache) do print(k,v) end
 			--print("zcorr",sprintf("%f,%f %+0.1f,%+0.1f %f %f %f %f",l,t,fx,fy,z00=
,z10,z01,z11))
-			z =3D InterpolateSquare(z00 or zSelf,z10 or zSelf,z01 or zSelf,z11 or z=
Self,fx,fy)
-			print("zcorr",z00,z10,z01,z11,zSelf,z)
+			--print("zcorr",z00,z10,z01,z11,zSelf,z)
 		end
 		=

 		self:SetPos_ClientSide(x,y,z)
@@ -393,9 +401,20 @@
 =

 function gTileFreeWalk:DebugMarkerGroup_AddCylinder (groupname,x,y,z,fRad,=
fHeight,r,g,b)
 	local gfx =3D CreateRootGfx3D()
-	GfxSetCylinder(gfx,fRad,fHeight)
+	GfxSetCylinderZ(gfx,fRad,fHeight)
 	gfx:SetMaterial(GetPlainColourMat(r,g,b))
 	gfx:SetPosition(x,y,z)
+	self:DebugMarkerGroup_AddGfx(groupname,gfx)
+end
+
+-- up=3D+z
+function gTileFreeWalk:DebugMarkerGroup_AddWall (groupname,x1,y1,z1,x2,y2,=
z2,h,r,g,b)
+	local gfx =3D CreateRootGfx3D()
+	gfx:SetSimpleRenderable()
+	gfx:RenderableBegin(4,6,false,false,OT_TRIANGLE_LIST)
+	DrawQuad(gfx,0, x1,y1,z1, x2,y2,z2, x1,y1,z1+h, x2,y2,z2+h, 0,0, 1,0, 0,1=
, 1,1)
+	gfx:RenderableEnd()
+	gfx:SetMaterial(GetPlainColourMat(r,g,b))
 	self:DebugMarkerGroup_AddGfx(groupname,gfx)
 end
 =




From no-reply at zwischenwelt.org  Sat Sep 29 16:32:24 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 29 Sep 2007 14:32:24 -0000
Subject: [Iris-commit] [IRIS] r1423 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070929143225.E01E21C18129@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Sep 29 16:32:23 2007
New Revision: 1423

Log:
working on tilefree stuff

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Sat Sep 29 16:32:23 2007
@@ -98,23 +98,53 @@
 			self.groundcache =3D self:Impl_ScanGround(rx,ry,rz)
 			=

 			self:DebugMarkerGroup_Clear("nearground")
+			function GetGround (x,y) local z =3D self.groundcache[x..","..y] return=
 z end --  print("GetGround",x,y,z,rx,ry)
 			for dx =3D -1,1 do =

 			for dy =3D -1,1 do =

-				local x,y,z =3D rx+dx,ry+dy,self.groundcache[dx..","..dy]
+				local x,y,z =3D rx+dx,ry+dy,GetGround(dx,dy)
 				if (z) then =

 					self:DebugMarkerGroup_AddSphere("nearground", x,y,z, 0.1, 0,1,0)
 				else	=

 					z =3D rz
-					local r,g,b =3D 1,0,0
+					local colr,colg,colb =3D 1,0,0
 					local h =3D 1
 					local e =3D 0.5
-					self:DebugMarkerGroup_AddCylinder("nearground",x,y,z, 0.1,h, r,g,b)
-					self:DebugMarkerGroup_AddWall("nearground", x,y+e,z,   x+e,y,z, h, r,=
g,b)
-					self:DebugMarkerGroup_AddWall("nearground", x+e,y,z,   x,y-e,z, h, r,=
g,b)
-					self:DebugMarkerGroup_AddWall("nearground", x,y-e,z,   x-e,y,z, h, r,=
g,b)
-					self:DebugMarkerGroup_AddWall("nearground", x-e,y,z,   x,y+e,z, h, r,=
g,b)
+					--self:DebugMarkerGroup_AddCylinder("nearground",	x,y,z, 		0.1,h, 		c=
olr,colg,colb)
+					=

+					local b00 =3D true
+					local b01 =3D true
+					local b10 =3D true
+					local b11 =3D true
+			=

+					if (not GetGround(dx,dy+1)) then -- vertical
+						self:DebugMarkerGroup_AddWall("nearground", 	x-e,y,z,   x-e,y+e,z, h=
,	colr,colg,colb)
+						self:DebugMarkerGroup_AddWall("nearground", 	x+e,y,z,   x+e,y+e,z, h=
,	colr,colg,colb)
+						b01 =3D false b11 =3D false
+					end
+					if (not GetGround(dx,dy-1)) then -- vertical
+						self:DebugMarkerGroup_AddWall("nearground", 	x-e,y,z,   x-e,y-e,z, h=
,	colr,colg,colb)
+						self:DebugMarkerGroup_AddWall("nearground", 	x+e,y,z,   x+e,y-e,z, h=
,	colr,colg,colb)
+						b00 =3D false b10 =3D false
+					end
+					=

+					if (not GetGround(dx+1,dy)) then -- horizontal
+						self:DebugMarkerGroup_AddWall("nearground", 	x,y-e,z,   x+e,y-e,z, h=
,	colr,colg,colb)
+						self:DebugMarkerGroup_AddWall("nearground", 	x,y+e,z,   x+e,y+e,z, h=
,	colr,colg,colb)
+						b10 =3D false b11 =3D false
+					end                                                             =

+					if (not GetGround(dx-1,dy)) then -- horizontal              =

+						self:DebugMarkerGroup_AddWall("nearground", 	x,y-e,z,   x-e,y-e,z, h=
,	colr,colg,colb)
+						self:DebugMarkerGroup_AddWall("nearground", 	x,y+e,z,   x-e,y+e,z, h=
,	colr,colg,colb)
+						b00 =3D false b01 =3D false
+					end
+					=

+					if (b00) then self:DebugMarkerGroup_AddWall("nearground", 	x,y-e,z,  =
 x-e,y,z, h,	colr,colg,colb) end
+					if (b01) then self:DebugMarkerGroup_AddWall("nearground", 	x-e,y,z,  =
 x,y+e,z, h,	colr,colg,colb) end
+					if (b10) then self:DebugMarkerGroup_AddWall("nearground", 	x+e,y,z,  =
 x,y-e,z, h,	colr,colg,colb) end
+					if (b11) then self:DebugMarkerGroup_AddWall("nearground", 	x,y+e,z,  =
 x+e,y,z, h,	colr,colg,colb) end
 				end
 			end
+			-- warning, the rounded position of the player can be blocked, due to d=
iagonal movement
 			end
 		end
 		=

@@ -411,8 +441,10 @@
 function gTileFreeWalk:DebugMarkerGroup_AddWall (groupname,x1,y1,z1,x2,y2,=
z2,h,r,g,b)
 	local gfx =3D CreateRootGfx3D()
 	gfx:SetSimpleRenderable()
-	gfx:RenderableBegin(4,6,false,false,OT_TRIANGLE_LIST)
-	DrawQuad(gfx,0, x1,y1,z1, x2,y2,z2, x1,y1,z1+h, x2,y2,z2+h, 0,0, 1,0, 0,1=
, 1,1)
+	gfx:RenderableBegin(4*2,6*2,false,false,OT_TRIANGLE_LIST)
+	local vc =3D 0
+	vc =3D DrawQuad(gfx,vc, x1,y1,z1, x2,y2,z2, x1,y1,z1+h, x2,y2,z2+h, 0,0, =
1,0, 0,1, 1,1)
+	vc =3D DrawQuad(gfx,vc, x1,y1,z1+h, x2,y2,z2+h, x1,y1,z1, x2,y2,z2, 0,0, =
1,0, 0,1, 1,1)
 	gfx:RenderableEnd()
 	gfx:SetMaterial(GetPlainColourMat(r,g,b))
 	self:DebugMarkerGroup_AddGfx(groupname,gfx)



From no-reply at zwischenwelt.org  Sat Sep 29 22:05:51 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 29 Sep 2007 20:05:51 -0000
Subject: [Iris-commit] [IRIS] r1424 - in /trunk/data/lua: lib.protocol.lua
	net/net.mobile.lua
Message-ID: <20070929200552.2BA571C18129@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Sep 29 22:05:50 2007
New Revision: 1424

Log:
secured kPacket_Mobile_Stats a bit

Modified:
    trunk/data/lua/lib.protocol.lua
    trunk/data/lua/net/net.mobile.lua

Modified: trunk/data/lua/lib.protocol.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.protocol.lua (original)
+++ trunk/data/lua/lib.protocol.lua Sat Sep 29 22:05:50 2007
@@ -110,7 +110,10 @@
 			--Crash()
 =

 			printf("WARNING : packet was not fully processed, used_len=3D%d full_le=
n=3D%d %s\n",used_len,iPacketSize,packet_debuginfo)
-			input:PopRaw(iPacketSize-used_len)
+			local unusedlen =3D iPacketSize-used_len
+			if (unusedlen > 0) then input:PopRaw(unusedlen) end
+			if (unusedlen < 0 and input.HackRestore) then input:HackRestore(-unused=
len) end
+			=

 		end
 		-- TODO : cScripting::GetSingletonPtr()->LuaCall("ProtocolPacketRecvHand=
ler","i",cmd);	=

 	end

Modified: trunk/data/lua/net/net.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.mobile.lua (original)
+++ trunk/data/lua/net/net.mobile.lua Sat Sep 29 22:05:50 2007
@@ -123,49 +123,62 @@
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
 	local iPacketSize =3D input:PopNetUint16()
-
+	local iBytesLeft =3D iPacketSize
 	local stats =3D {}
-	local mobileserial		=3D input:PopNetUint32()
+	=

+	-- returns nil if there are enough bytes left =3D> the "or" clause gets e=
xecuted
+	function MySave_Prepare (needed)
+		if (iBytesLeft >=3D needed) then iBytesLeft =3D iBytesLeft - needed retu=
rn end
+		input:PopRaw(iBytesLeft) =

+		iBytesLeft =3D 0 =

+		print("underflow in kPacket_Mobile_Stats, flag,iPacketSize=3D",stats.fla=
g,iPacketSize) =

+		return 0 -- return 0 -> pop is skipped
+	end
+	function MySave_PopNetUint8  () return MySave_Prepare(1) or input:PopNetU=
int8()  end
+	function MySave_PopNetUint16 () return MySave_Prepare(2) or input:PopNetU=
int16() end
+	function MySave_PopNetUint32 () return MySave_Prepare(4) or input:PopNetU=
int32() end
+
+	local mobileserial		=3D MySave_PopNetUint32()
 	stats.name				=3D input:PopFilledString(30)
 	=

-	stats.curHits			=3D input:PopNetUint16()
-	stats.maxHits 			=3D input:PopNetUint16()
-	stats.bCanChangeName	=3D input:PopNetUint8() ~=3D 0	--(0x1 =3D allowed, 0=
 =3D not allowed)
-	stats.flag 				=3D input:PopNetUint8()
+	stats.curHits			=3D MySave_PopNetUint16()
+	stats.maxHits 			=3D MySave_PopNetUint16()
+	stats.bCanChangeName	=3D MySave_PopNetUint8() ~=3D 0	--(0x1 =3D allowed, =
0 =3D not allowed)
+	stats.flag 				=3D MySave_PopNetUint8()
 	=

 	-- more data following
 	if (in_array( stats.flag, {1,3,4,5})) then
-		stats.sex			=3D input:PopNetUint8() -- * 0x00 - Male  * 0x01 - Female
-		stats.str			=3D input:PopNetUint16()
-		stats.dex			=3D input:PopNetUint16()
-		stats.int			=3D input:PopNetUint16()
-		stats.curStamina	=3D input:PopNetUint16()
-		stats.maxStamina	=3D input:PopNetUint16()
-		stats.curMana		=3D input:PopNetUint16()
-		stats.maxMana		=3D input:PopNetUint16()
-		stats.gold			=3D input:PopNetUint32()
-		stats.armor			=3D input:PopNetUint16() -- resistPhysical (old clients: A=
C).
-		stats.curWeight		=3D input:PopNetUint16()
+		stats.sex			=3D MySave_PopNetUint8() -- * 0x00 - Male  * 0x01 - Female
+		stats.str			=3D MySave_PopNetUint16()
+		stats.dex			=3D MySave_PopNetUint16()
+		stats.int			=3D MySave_PopNetUint16()
+		stats.curStamina	=3D MySave_PopNetUint16()
+		stats.maxStamina	=3D MySave_PopNetUint16()
+		stats.curMana		=3D MySave_PopNetUint16()
+		stats.maxMana		=3D MySave_PopNetUint16()
+		stats.gold			=3D MySave_PopNetUint32()
+		stats.armor			=3D MySave_PopNetUint16() -- resistPhysical (old clients: =
AC).
+		stats.curWeight		=3D MySave_PopNetUint16()
 =

 		if (stats.flag =3D=3D 5) then
-			stats.maxWeight	=3D input:PopNetUint16()
-			stats.race		=3D input:PopNetUint8()
+			stats.maxWeight	=3D MySave_PopNetUint16()
+			stats.race		=3D MySave_PopNetUint8()
 		end
 =

 		if (in_array( stats.flag, {3,4,5} )) then -- Followers (pets)
-			stats.statcap	=3D input:PopNetUint16()		-- The character's total allowa=
ble sum of Strength, Intelligence, and Dexterity
-			stats.curPet	=3D input:PopNetUint8()			=

-			stats.maxPet	=3D input:PopNetUint8()
+			stats.statcap	=3D MySave_PopNetUint16()		-- The character's total allow=
able sum of Strength, Intelligence, and Dexterity
+			stats.curPet	=3D MySave_PopNetUint8()			=

+			stats.maxPet	=3D MySave_PopNetUint8()
 			=

 			if (in_array( stats.flag, {4,5} )) then -- Resistances
-				stats.fireresist	=3D input:PopNetUint16()			=

-				stats.coldresist	=3D input:PopNetUint16()			=

-				stats.poisonresist	=3D input:PopNetUint16()			=

-				stats.energyresist	=3D input:PopNetUint16()			=

-				stats.luck			=3D input:PopNetUint16()			=

-				stats.minDamage		=3D input:PopNetUint16()			=

-				stats.maxDamage		=3D input:PopNetUint16()			=

-				stats.tithing		=3D input:PopNetUint32()			=

+				stats.fireresist	=3D MySave_PopNetUint16()			=

+				stats.coldresist	=3D MySave_PopNetUint16()			=

+				stats.poisonresist	=3D MySave_PopNetUint16()			=

+				stats.energyresist	=3D MySave_PopNetUint16()			=

+				stats.luck			=3D MySave_PopNetUint16()			=

+				stats.minDamage		=3D MySave_PopNetUint16()			=

+				stats.maxDamage		=3D MySave_PopNetUint16()			=

+				stats.tithing		=3D MySave_PopNetUint32()			=

 			end
 		end
 	end



From no-reply at zwischenwelt.org  Sun Sep 30 16:07:35 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 30 Sep 2007 14:07:35 -0000
Subject: [Iris-commit] [IRIS] r1425 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070930140735.8E1A01C181BA@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Sep 30 16:07:35 2007
New Revision: 1425

Log:
tilefree experiments : control via arrow keys

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Sun Sep 30 16:07:35 2007
@@ -40,6 +40,8 @@
 	self.pathpoints =3D {}
 	self.debugmarkers =3D {}
 	self.debugmarkergroups =3D {}
+	self.movedirx =3D 0
+	self.movediry =3D 1
 	=

 	if (true) then
 		self.sDebugMarkerMeshName_Big	=3D MakeSphereMesh(11,11,0.2,0.2,0.2)
@@ -80,16 +82,46 @@
 	local bTurnRight		=3D gKeyPressed[key_right]	-- WalkTurn( 1) end
 	=

 	-- hold rightmouse button to walk in mouse direction (depends on center o=
f screen, works good for 3rd person cam)
+	local bMoved =3D false
+	local x,y,z =3D self:GetPos_ClientSide()
+	=

+	-- read input and calculate desired movement
 	if (bWalkInMouseDir) then
 		local dx,dy,pixel_dist_from_center =3D self:GetCurrentMouseDir() =

 		--local x,y,z =3D self:MousePickPos()
 		=

-		local x,y,z =3D self:GetPos_ClientSide()
 		local slowarea_pixels =3D 50
-		local speed =3D self:GetClientSideSpeed(dx,dy,0) * gSecondsSinceLastFram=
e * math.min(1.0,pixel_dist_from_center / slowarea_pixels)
-		x =3D x + dx * speed
-		y =3D y + dy * speed
-		=

+		local slowarea_factor =3D math.min(1.0,pixel_dist_from_center / slowarea=
_pixels) -- mouse near center : move slow
+		self.movedirx =3D dx
+		self.movediry =3D dy
+		local maxspeed =3D self:GetClientSideSpeed(self.movedirx,self.movediry,0=
) * gSecondsSinceLastFrame
+		x =3D x + self.movedirx * maxspeed * slowarea_factor
+		y =3D y + self.movediry * maxspeed * slowarea_factor
+		bMoved =3D true
+	else
+		local angadd =3D 0
+		if (bTurnLeft ) then  angadd =3D angadd + 240 * gfDeg2Rad * gSecondsSinc=
eLastFrame end
+		if (bTurnRight) then  angadd =3D angadd - 240 * gfDeg2Rad * gSecondsSinc=
eLastFrame end
+		if (angadd ~=3D 0) then =

+			local dx,dy =3D self.movedirx,self.movediry
+			self.movedirx =3D dx*cos(angadd) - dy*sin(angadd)
+			self.movediry =3D dx*sin(angadd) + dy*cos(angadd)
+			bMoved =3D true
+		end
+		local maxspeed =3D self:GetClientSideSpeed(self.movedirx,self.movediry,0=
) * gSecondsSinceLastFrame
+		if (bWalkForward) then
+			x =3D x + self.movedirx * maxspeed
+			y =3D y + self.movediry * maxspeed
+			bMoved =3D true
+		elseif (bWalkBackwards) then
+			x =3D x - self.movedirx * maxspeed
+			y =3D y - self.movediry * maxspeed
+			bMoved =3D true
+		end
+	end
+	=

+	-- execute movement (and collision/block handling)
+	if (bMoved) then
 		local rx,ry,rz =3D self:RoundPos(x,y,z)
 		local lx,ly,lz =3D self:PathPoint_GetLast()
 		if (lx ~=3D rx or ly ~=3D ry) then =

@@ -103,7 +135,9 @@
 			for dy =3D -1,1 do =

 				local x,y,z =3D rx+dx,ry+dy,GetGround(dx,dy)
 				if (z) then =

-					self:DebugMarkerGroup_AddSphere("nearground", x,y,z, 0.1, 0,1,0)
+					local h =3D 1
+					self:DebugMarkerGroup_AddCylinder("nearground",	x,y,z, 		0.01,h, 		0,=
1,0)
+					--self:DebugMarkerGroup_AddSphere("nearground", x,y,z, 0.1, 0,1,0)
 				else	=

 					z =3D rz
 					local colr,colg,colb =3D 1,0,0
@@ -168,7 +202,7 @@
 		end
 		=

 		self:SetPos_ClientSide(x,y,z)
-		self:SetDebugMarker("GetPos_ClientSide", x,y,z, dx,dy,0, 1,1,0)
+		self:SetDebugMarker("GetPos_ClientSide", x,y,z, self.movedirx,self.moved=
iry,0, 1,1,0)
 	end
 	=

 	-- debug markers



From no-reply at zwischenwelt.org  Sun Sep 30 17:03:28 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 30 Sep 2007 15:03:28 -0000
Subject: [Iris-commit] [IRIS] r1426 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070930150328.280501C1817E@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Sep 30 17:03:27 2007
New Revision: 1426

Log:
tilefree : preparing code for collision

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Sun Sep 30 17:03:27 2007
@@ -124,26 +124,25 @@
 	if (bMoved) then
 		local rx,ry,rz =3D self:RoundPos(x,y,z)
 		local lx,ly,lz =3D self:PathPoint_GetLast()
+		=

+		-- entered a new tile
 		if (lx ~=3D rx or ly ~=3D ry) then =

 			self:PathPoint_Push(rx,ry,rz)
-			-- read new surrounding height info here
-			self.groundcache =3D self:Impl_ScanGround(rx,ry,rz)
+			self.groundcache =3D self:Impl_ScanGround(rx,ry,rz) -- read surrounding=
 height info
 			=

 			self:DebugMarkerGroup_Clear("nearground")
 			function GetGround (x,y) local z =3D self.groundcache[x..","..y] return=
 z end --  print("GetGround",x,y,z,rx,ry)
+			self.walls =3D {}
 			for dx =3D -1,1 do =

 			for dy =3D -1,1 do =

 				local x,y,z =3D rx+dx,ry+dy,GetGround(dx,dy)
 				if (z) then =

 					local h =3D 1
-					self:DebugMarkerGroup_AddCylinder("nearground",	x,y,z, 		0.01,h, 		0,=
1,0)
-					--self:DebugMarkerGroup_AddSphere("nearground", x,y,z, 0.1, 0,1,0)
+					self:DebugMarkerGroup_AddCylinder("nearground",	x,y,z, 0.01,h,	0,1,0)
+					--self:DebugMarkerGroup_AddSphere("nearground", x,y,z, 0.1,		0,1,0)
 				else	=

 					z =3D rz
-					local colr,colg,colb =3D 1,0,0
-					local h =3D 1
 					local e =3D 0.5
-					--self:DebugMarkerGroup_AddCylinder("nearground",	x,y,z, 		0.1,h, 		c=
olr,colg,colb)
 					=

 					local b00 =3D true
 					local b01 =3D true
@@ -151,40 +150,54 @@
 					local b11 =3D true
 			=

 					if (not GetGround(dx,dy+1)) then -- vertical
-						self:DebugMarkerGroup_AddWall("nearground", 	x-e,y,z,   x-e,y+e,z, h=
,	colr,colg,colb)
-						self:DebugMarkerGroup_AddWall("nearground", 	x+e,y,z,   x+e,y+e,z, h=
,	colr,colg,colb)
+						table.insert(self.walls,{	x-e,y,   x-e,y+e	})
+						table.insert(self.walls,{	x+e,y,   x+e,y+e	})
 						b01 =3D false b11 =3D false
 					end
 					if (not GetGround(dx,dy-1)) then -- vertical
-						self:DebugMarkerGroup_AddWall("nearground", 	x-e,y,z,   x-e,y-e,z, h=
,	colr,colg,colb)
-						self:DebugMarkerGroup_AddWall("nearground", 	x+e,y,z,   x+e,y-e,z, h=
,	colr,colg,colb)
+						table.insert(self.walls,{	x-e,y,   x-e,y-e	})
+						table.insert(self.walls,{	x+e,y,   x+e,y-e	})
 						b00 =3D false b10 =3D false
 					end
 					=

 					if (not GetGround(dx+1,dy)) then -- horizontal
-						self:DebugMarkerGroup_AddWall("nearground", 	x,y-e,z,   x+e,y-e,z, h=
,	colr,colg,colb)
-						self:DebugMarkerGroup_AddWall("nearground", 	x,y+e,z,   x+e,y+e,z, h=
,	colr,colg,colb)
+						table.insert(self.walls,{	x,y-e,   x+e,y-e	})
+						table.insert(self.walls,{	x,y+e,   x+e,y+e	})
 						b10 =3D false b11 =3D false
-					end                                                             =

-					if (not GetGround(dx-1,dy)) then -- horizontal              =

-						self:DebugMarkerGroup_AddWall("nearground", 	x,y-e,z,   x-e,y-e,z, h=
,	colr,colg,colb)
-						self:DebugMarkerGroup_AddWall("nearground", 	x,y+e,z,   x-e,y+e,z, h=
,	colr,colg,colb)
+					end                                                           =

+					if (not GetGround(dx-1,dy)) then -- horizontal            =

+						table.insert(self.walls,{	x,y-e,   x-e,y-e	})
+						table.insert(self.walls,{	x,y+e,   x-e,y+e	})
 						b00 =3D false b01 =3D false
 					end
 					=

-					if (b00) then self:DebugMarkerGroup_AddWall("nearground", 	x,y-e,z,  =
 x-e,y,z, h,	colr,colg,colb) end
-					if (b01) then self:DebugMarkerGroup_AddWall("nearground", 	x-e,y,z,  =
 x,y+e,z, h,	colr,colg,colb) end
-					if (b10) then self:DebugMarkerGroup_AddWall("nearground", 	x+e,y,z,  =
 x,y-e,z, h,	colr,colg,colb) end
-					if (b11) then self:DebugMarkerGroup_AddWall("nearground", 	x,y+e,z,  =
 x+e,y,z, h,	colr,colg,colb) end
+					if (b00) then table.insert(self.walls,{	x,y-e,   x-e,y	}) end
+					if (b01) then table.insert(self.walls,{	x-e,y,   x,y+e	}) end
+					if (b10) then table.insert(self.walls,{	x+e,y,   x,y-e	}) end
+					if (b11) then table.insert(self.walls,{	x,y+e,   x+e,y	}) end
 				end
 			end
+			end
+			=

 			-- warning, the rounded position of the player can be blocked, due to d=
iagonal movement
+			=

+			local h =3D 1
+			for k,wallarr in pairs(self.walls) do
+				local x1,y1,x2,y2 =3D unpack(wallarr)
+				local dx,dy =3D x2-x1,y2-y1
+				local nx,ny =3D Vector.normalise(dy,-dx,0)
+				self.walls[k] =3D {x1,y1,x2,y2,dx,dy,nx,ny}
+				self:DebugMarkerGroup_AddWall("nearground", 	x1,y1,rz,   x2,y2,rz, h,	=
1,0,0)
 			end
+		end -- endif entered a new tile
+		=

+		-- block movement here
+		for k,wallarr in pairs(self.walls or {}) do
+			local x1,y1,x2,y2,dx,dy,nx,ny =3D unpack(wallarr)
+			=

 		end
 		=

-		-- todo : block movement here
-		=

-		-- todo : calc correct z here
+		-- calc correct z here
 		if (self.groundcache) then
 			local l =3D (x <=3D rx) and (rx-1) or rx
 			local t =3D (y <=3D ry) and (ry-1) or ry



From no-reply at zwischenwelt.org  Sun Sep 30 17:09:02 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 30 Sep 2007 15:09:02 -0000
Subject: [Iris-commit] [IRIS] r1427 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070930150902.3AADD1C1804E@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Sep 30 17:09:01 2007
New Revision: 1427

Log:
more 2d vector utils

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Sun Sep 30 17:09:01 2007
@@ -194,6 +194,7 @@
 		-- block movement here
 		for k,wallarr in pairs(self.walls or {}) do
 			local x1,y1,x2,y2,dx,dy,nx,ny =3D unpack(wallarr)
+			local vx,vy =3D x-x1,y-y1
 			=

 		end
 		=




From no-reply at zwischenwelt.org  Sun Sep 30 17:57:42 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 30 Sep 2007 15:57:42 -0000
Subject: [Iris-commit] [IRIS] r1428 - /trunk/data/lua/lib.tilefreewalk.lua
Message-ID: <20070930155743.13A571C181BA@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Sep 30 17:57:42 2007
New Revision: 1428

Log:
tilefree : collision working

Modified:
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Sun Sep 30 17:57:42 2007
@@ -137,7 +137,7 @@
 			for dy =3D -1,1 do =

 				local x,y,z =3D rx+dx,ry+dy,GetGround(dx,dy)
 				if (z) then =

-					local h =3D 1
+					local h =3D 0.5
 					self:DebugMarkerGroup_AddCylinder("nearground",	x,y,z, 0.01,h,	0,1,0)
 					--self:DebugMarkerGroup_AddSphere("nearground", x,y,z, 0.1,		0,1,0)
 				else	=

@@ -181,21 +181,35 @@
 			=

 			-- warning, the rounded position of the player can be blocked, due to d=
iagonal movement
 			=

-			local h =3D 1
+			local h =3D 0.5
 			for k,wallarr in pairs(self.walls) do
 				local x1,y1,x2,y2 =3D unpack(wallarr)
-				local dx,dy =3D x2-x1,y2-y1
-				local nx,ny =3D Vector.normalise(dy,-dx,0)
-				self.walls[k] =3D {x1,y1,x2,y2,dx,dy,nx,ny}
-				self:DebugMarkerGroup_AddWall("nearground", 	x1,y1,rz,   x2,y2,rz, h,	=
1,0,0)
+				local dx,dy =3D sub2(x2,y2,x1,y1)
+				local nx,ny =3D norm2(dy,-dx)
+				local invsqlen =3D 1.0/sqlen2(dx,dy)
+				self.walls[k] =3D {x1,y1,x2,y2,dx,dy,nx,ny,invsqlen}
+--~ 				self:DebugMarkerGroup_AddWall("nearground", 	x1,y1,rz,   x2,y2,rz,=
 h,	1,0,0)
 			end
 		end -- endif entered a new tile
 		=

 		-- block movement here
+		local r =3D 0.2 -- radius of player/human
+		local h =3D 0.7
+		local e =3D 0.05
+		self:DebugMarkerGroup_Clear("touchwalls")
 		for k,wallarr in pairs(self.walls or {}) do
-			local x1,y1,x2,y2,dx,dy,nx,ny =3D unpack(wallarr)
-			local vx,vy =3D x-x1,y-y1
-			=

+			local x1,y1,x2,y2,dx,dy,nx,ny,invsqlen =3D unpack(wallarr)
+			local vx,vy =3D sub2(x,y,x1,y1)
+			local dist =3D dot2(vx,vy,nx,ny)
+			local pushoutdist =3D r - abs(dist)
+			if (pushoutdist > 0) then
+				local pos =3D dot2(vx,vy,dx,dy) * invsqlen
+				if (pos >=3D 0-e and pos <=3D 1+e) then =

+					self:DebugMarkerGroup_AddWall("touchwalls", 	x1,y1,rz,   x2,y2,rz, h,=
	1,1,0)
+					x =3D x + nx*pushoutdist*sign(dist)
+					y =3D y + ny*pushoutdist*sign(dist)
+				end
+			end
 		end
 		=

 		-- calc correct z here



