<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r1327 - in /branches/knut/data/lua: lib.charcreate.lua lib.input.lua lib.loading.lua lib.stitchin.lua main.lua net.other.lua net.uodragdrop.lua net/net.uodragdrop.lua
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1327%20-%20in%20/branches/knut/data/lua%3A%0A%20lib.charcreate.lua%20lib.input.lua%20lib.loading.lua%20lib.stitchin.lua%20main.lua%0A%20net.other.lua%20net.uodragdrop.lua%20net/net.uodragdrop.lua&In-Reply-To=%3C20070802011921.5BEB0B140B4%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000144.html">
   <LINK REL="Next"  HREF="000140.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r1327 - in /branches/knut/data/lua: lib.charcreate.lua lib.input.lua lib.loading.lua lib.stitchin.lua main.lua net.other.lua net.uodragdrop.lua net/net.uodragdrop.lua</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1327%20-%20in%20/branches/knut/data/lua%3A%0A%20lib.charcreate.lua%20lib.input.lua%20lib.loading.lua%20lib.stitchin.lua%20main.lua%0A%20net.other.lua%20net.uodragdrop.lua%20net/net.uodragdrop.lua&In-Reply-To=%3C20070802011921.5BEB0B140B4%40localhost.localdomain%3E"
       TITLE="[Iris-commit] [IRIS] r1327 - in /branches/knut/data/lua: lib.charcreate.lua lib.input.lua lib.loading.lua lib.stitchin.lua main.lua net.other.lua net.uodragdrop.lua net/net.uodragdrop.lua">no-reply at zwischenwelt.org
       </A><BR>
    <I>Thu Aug  2 03:19:20 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000144.html">[Iris-commit] [IRIS] r1326 - in /branches/knut/src: builder.cpp scripting.cpp spritemanager.cpp
</A></li>
        <LI>Next message: <A HREF="000140.html">[Iris-commit] [IRIS] r1328 - in /trunk/data/lua: gui/gui.main.lua gui/gui.status.lua lib.charcreate.lua lib.debug.lua lib.guimaker.lua lib.listener.lua lib.loading.lua lib.skill.lua lib.test.lua lib.util.lua net/net.multi.lua net/net.uodragdrop.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#139">[ date ]</a>
              <a href="thread.html#139">[ thread ]</a>
              <a href="subject.html#139">[ subject ]</a>
              <a href="author.html#139">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ghoulsblade
Date: Thu Aug  2 03:19:19 2007
New Revision: 1327

Log:
started merging...

Modified:
    branches/knut/data/lua/lib.charcreate.lua
    branches/knut/data/lua/lib.input.lua
    branches/knut/data/lua/lib.loading.lua
    branches/knut/data/lua/lib.stitchin.lua
    branches/knut/data/lua/main.lua
    branches/knut/data/lua/net.other.lua
    branches/knut/data/lua/net.uodragdrop.lua
    branches/knut/data/lua/net/net.uodragdrop.lua

Modified: branches/knut/data/lua/lib.charcreate.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- branches/knut/data/lua/lib.charcreate.lua (original)
+++ branches/knut/data/lua/lib.charcreate.lua Thu Aug  2 03:19:19 2007
@@ -7,6 +7,7 @@
 -- kPacket_Delete_Character_Failed ?
 -- kPacket_All_Characters ?
 -- kPacket_Move_Character ?
+-- ?? kPacket_Character_Profile ?
 -- kPacket_Character_Transfer_Log ?
 =

 -- template is one element from the array of GetCharCreationTemplates

Modified: branches/knut/data/lua/lib.input.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- branches/knut/data/lua/lib.input.lua (original)
+++ branches/knut/data/lua/lib.input.lua Thu Aug  2 03:19:19 2007
@@ -315,5 +315,4 @@
 		--Bind(&quot;f10&quot;,		function (state) if (not gActiveEditText) then if (state =
&gt;<i> 0) then Send_Speech(commandchar..&quot;props&quot;) end end end)
</I> 		--Bind(&quot;f11&quot;,		function (state) if (not gActiveEditText) then if (state =
&gt;<i> 0) then Send_Speech(commandchar..&quot;add&quot;) end end end)
</I> 	end
-
-end
+end

Modified: branches/knut/data/lua/lib.loading.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- branches/knut/data/lua/lib.loading.lua (original)
+++ branches/knut/data/lua/lib.loading.lua Thu Aug  2 03:19:19 2007
@@ -101,7 +101,7 @@
 =

 -- load bigger data chunks while menu is visible
 function PreLoad ()
-	DebugCallLogStartIgnore()
+	--DebugCallLogStartIgnore()
 	LoadingProfile(&quot;init unifonts&quot;)
 	if (gUniFontLoaderType) then
 		CreateUniFont(CorrectPath(gUOPath..&quot;unifont.mul&quot;),&quot;font_unifont0&quot;)
@@ -210,7 +210,7 @@
 	gLoadingProfileLastTime =3D 0
 	gLoadingProfileLastAction =3D false
 	=

-	DebugCallLogStopIgnore()
+	--DebugCallLogStopIgnore()
 	--MeshExporter()
 	--Crash()
 end

Modified: branches/knut/data/lua/lib.stitchin.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- branches/knut/data/lua/lib.stitchin.lua (original)
+++ branches/knut/data/lua/lib.stitchin.lua Thu Aug  2 03:19:19 2007
@@ -73,6 +73,7 @@
 			end
 		end
 	end
+
 	--print(&quot; pushups   &quot;,table.concat(stitchininfo.pushups,&quot;,&quot;)) -- 1924,360=
4,1925,3605
 	return stitchininfo
 end

Modified: branches/knut/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- branches/knut/data/lua/main.lua (original)
+++ branches/knut/data/lua/main.lua Thu Aug  2 03:19:19 2007
@@ -98,10 +98,15 @@
 	-- execute local config
 	dofile(gConfigPath)
 else
-	-- no local config file, create empty
+	-- no local config file, copy dist config
 	local fp =3D io.open(gConfigPath,&quot;w&quot;)
-	fp:write(&quot;# this is your local config file, here you can override the opt=
ions from &quot;..gConfigPathFallback..&quot;\n&quot;)
+	fp:write(&quot;-- this is your local config file, here you can override the de=
fault options\n&quot;)
 	fp:write(&quot;-- gUOPath =3D \&quot;C:\\\\stuff\\\\iris\\\\uo\\\\\&quot; -- enter the p=
ath to your uo data dir here\n&quot;)
+	for line in io.lines(gConfigPathFallback) do =

+		if (not string.find(line,&quot;DO NOT EDIT THIS FILE DIRECTLY&quot;)) then =

+			fp:write(line..&quot;\n&quot;) =

+		end =

+	end
 	fp:close()
 end
 =


Modified: branches/knut/data/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- branches/knut/data/lua/net.other.lua (original)
+++ branches/knut/data/lua/net.other.lua Thu Aug  2 03:19:19 2007
@@ -610,10 +610,10 @@
 	out:SendPacket()
 end
 =

--- send combat request to server, triggers kPacket_Combat
+-- send combat request to server, triggers kPacket_SetPlayerWarmode
 function Send_CombatMode(iWarMode)
 	local out =3D GetSendFIFO()
-	out:PushNetUint8(kPacket_Combat)
+	out:PushNetUint8(kPacket_SetPlayerWarmode)
 	out:PushNetUint8(iWarMode)
 	out:PushNetUint16(hex2num(&quot;0x0032&quot;))
 	out:PushNetUint8(hex2num(&quot;0x00&quot;))

Modified: branches/knut/data/lua/net.uodragdrop.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- branches/knut/data/lua/net.uodragdrop.lua (original)
+++ branches/knut/data/lua/net.uodragdrop.lua Thu Aug  2 03:19:19 2007
@@ -53,82 +53,6 @@
 =

 gDragStartDist =3D 5 -- in pixels
 gSquareDragStartDist =3D gDragStartDist * gDragStartDist
-
-
--- Equip Item Request   (answer is 0x2E, see also 0x78). 0x13
-function Send_Equip_Item_Request(serial,layer,player_serial)
-	print(&quot;NET: Send_Equip_Item_Request:&quot;,sprintf(&quot;0x%08x&quot;,serial),layer,play=
er_serial)
-	local out =3D GetSendFIFO()
-	out:PushNetUint8(kPacket_Equip_Item_Request)
-	out:PushNetUint32(serial)
-	out:PushNetUint8(layer)
-	out:PushNetUint32(player_serial)
-	out:SendPacket()
-end
-
--- This is sent by the client when the player picks up an item. 0x07
-function Send_Take_Object(serial,amount)
-	print(&quot;NET: Send_Take_Object:&quot;,sprintf(&quot;0x%08x&quot;,serial),serial,amount)
-	local out =3D GetSendFIFO()
-	out:PushNetUint8(kPacket_Take_Object)
-	out:PushNetUint32(serial)
-	out:PushNetUint16(amount or 1)
-	out:SendPacket()
-end
-
--- This is sent by the client when the player drops an item. 0x08
--- containerid =3D 0xFFFFFFFF  when the container is the ground
-function Send_Drop_Object(serial,x,y,z,containerid)
-	print(&quot;NET: Send_Drop_Object:&quot;,sprintf(&quot;0x%08x&quot;,serial),x,y,z,containerid)
-	local out =3D GetSendFIFO()
-	out:PushNetUint8(kPacket_Drop_Object)
-	out:PushNetUint32(serial)
-	out:PushNetUint16(x)
-	out:PushNetUint16(y)
-	out:PushInt8(z) -- SIGNED !!
-	out:PushNetUint32(containerid)
-	out:SendPacket()
-end
- =

--- This is sent to deny the player's request to get an item. (servers resp=
onse to 0x07)
-function gPacketHandler.kPacket_Get_Item_Failed() -- 0x27
-	local input =3D GetRecvFIFO()
-	local id =3D input:PopNetUint8()
-	local reason =3D input:PopNetUint8()
-	local reasontxt =3D &quot;unknown_Get_Item_Failed&quot;
-	if (reason =3D=3D hex2num(&quot;0x00&quot;)) then reasontxt =3D &quot;You cannot pick th=
at up.&quot; end
-	if (reason =3D=3D hex2num(&quot;0x01&quot;)) then reasontxt =3D &quot;That is too far aw=
ay.&quot; end
-	if (reason =3D=3D hex2num(&quot;0x02&quot;)) then reasontxt =3D &quot;That is out of sig=
ht.&quot; end
-	if (reason =3D=3D hex2num(&quot;0x03&quot;)) then reasontxt =3D &quot;That item does not=
 belong to you. You will have to steal it.&quot; end
-	if (reason =3D=3D hex2num(&quot;0x04&quot;)) then reasontxt =3D &quot;You are already ho=
lding an item.&quot; end
-	if (reason =3D=3D hex2num(&quot;0x05&quot;)) then =

-		reasontxt =3D &quot;The item was destroyed.&quot;  -- TODO : no message ??
-		-- TODO : Destroy the item.
-	end
-	if (reason =3D=3D hex2num(&quot;0x06&quot;)) then -- No message.
-		reasontxt =3D false
-	end
-	print(&quot;NET : Get_Item_Failed&quot;,reasontxt)
-	CleanUpUODragDrop() -- server side cancel
-end
-
--- Clear Square or Drop Failed ? (servers response to 0x08 ?)
-function gPacketHandler.kPacket_Drop_Item_Failed() -- 0x28
-	local input =3D GetRecvFIFO()
-	local id =3D input:PopNetUint8()
-	local xloc =3D input:PopNetUint16()
-	local yloc =3D input:PopNetUint16()
-	-- TODO ?
-	print(&quot;NET : Drop_Item_Failed&quot;)
-end
-
--- Drop Item OK ? Paperdoll Clothing Added ? (servers response to 0x08 ?)
-function gPacketHandler.kPacket_Drop_Item_OK() -- 0x29
-	local input =3D GetRecvFIFO()
-	local id =3D input:PopNetUint8()
-	-- TODO ?
-	print(&quot;NET : Drop_Item_OK&quot;)
-end
  =

 gDragDrop =3D false
 =


Modified: branches/knut/data/lua/net/net.uodragdrop.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- branches/knut/data/lua/net/net.uodragdrop.lua (original)
+++ branches/knut/data/lua/net/net.uodragdrop.lua Thu Aug  2 03:19:19 2007
@@ -11,7 +11,7 @@
 =

 -- This is sent by the client when the player picks up an item. 0x07
 function Send_Take_Object(serial,amount)
-	printdebug(&quot;NET&quot;,&quot;NET: Send_Take_Object:&quot;,sprintf(&quot;0x%08x&quot;,serial),serial=
,amount)
+	print(&quot;NET: Send_Take_Object:&quot;,sprintf(&quot;0x%08x&quot;,serial),serial,amount)
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_Take_Object)
 	out:PushNetUint32(serial)
@@ -28,7 +28,7 @@
 	out:PushNetUint32(serial)
 	out:PushNetUint16(x)
 	out:PushNetUint16(y)
-	out:PushInt8(z)
+	out:PushInt8(z) -- SIGNED !!
 	out:PushNetUint32(containerid)
 	out:SendPacket()
 end
@@ -70,3 +70,4 @@
 	local id =3D input:PopNetUint8()
 	printdebug(&quot;NET&quot;,&quot;NET : Drop_Item_OK --&gt; nothing todo?&quot;)
 end
+


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000144.html">[Iris-commit] [IRIS] r1326 - in /branches/knut/src: builder.cpp scripting.cpp spritemanager.cpp
</A></li>
	<LI>Next message: <A HREF="000140.html">[Iris-commit] [IRIS] r1328 - in /trunk/data/lua: gui/gui.main.lua gui/gui.status.lua lib.charcreate.lua lib.debug.lua lib.guimaker.lua lib.listener.lua lib.loading.lua lib.skill.lua lib.test.lua lib.util.lua net/net.multi.lua net/net.uodragdrop.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#139">[ date ]</a>
              <a href="thread.html#139">[ thread ]</a>
              <a href="subject.html#139">[ subject ]</a>
              <a href="author.html#139">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
