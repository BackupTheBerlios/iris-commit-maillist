<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r1328 - in /trunk/data/lua: gui/gui.main.lua gui/gui.status.lua lib.charcreate.lua lib.debug.lua lib.guimaker.lua lib.listener.lua lib.loading.lua lib.skill.lua lib.test.lua lib.util.lua net/net.multi.lua net/net.uodragdrop.lua
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1328%20-%20in%20/trunk/data/lua%3A%20gui/gui.main.lua%0A%20gui/gui.status.lua%20lib.charcreate.lua%20lib.debug.lua%20lib.guimaker.lua%0A%20lib.listener.lua%20lib.loading.lua%20lib.skill.lua%20lib.test.lua%20lib.util.lua%0A%20net/net.multi.lua%20net/net.uodragdrop.lua&In-Reply-To=%3C20070802011958.2CEB0B140B4%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000139.html">
   <LINK REL="Next"  HREF="000145.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r1328 - in /trunk/data/lua: gui/gui.main.lua gui/gui.status.lua lib.charcreate.lua lib.debug.lua lib.guimaker.lua lib.listener.lua lib.loading.lua lib.skill.lua lib.test.lua lib.util.lua net/net.multi.lua net/net.uodragdrop.lua</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1328%20-%20in%20/trunk/data/lua%3A%20gui/gui.main.lua%0A%20gui/gui.status.lua%20lib.charcreate.lua%20lib.debug.lua%20lib.guimaker.lua%0A%20lib.listener.lua%20lib.loading.lua%20lib.skill.lua%20lib.test.lua%20lib.util.lua%0A%20net/net.multi.lua%20net/net.uodragdrop.lua&In-Reply-To=%3C20070802011958.2CEB0B140B4%40localhost.localdomain%3E"
       TITLE="[Iris-commit] [IRIS] r1328 - in /trunk/data/lua: gui/gui.main.lua gui/gui.status.lua lib.charcreate.lua lib.debug.lua lib.guimaker.lua lib.listener.lua lib.loading.lua lib.skill.lua lib.test.lua lib.util.lua net/net.multi.lua net/net.uodragdrop.lua">no-reply at zwischenwelt.org
       </A><BR>
    <I>Thu Aug  2 03:19:57 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000139.html">[Iris-commit] [IRIS] r1327 - in /branches/knut/data/lua: lib.charcreate.lua lib.input.lua lib.loading.lua lib.stitchin.lua main.lua net.other.lua net.uodragdrop.lua net/net.uodragdrop.lua
</A></li>
        <LI>Next message: <A HREF="000145.html">[Iris-commit] [IRIS] r1329 - in /branches/knut/data/lua: ./ gui/	net/ obj/
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#140">[ date ]</a>
              <a href="thread.html#140">[ thread ]</a>
              <a href="subject.html#140">[ subject ]</a>
              <a href="author.html#140">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ghoulsblade
Date: Thu Aug  2 03:19:56 2007
New Revision: 1328

Log:
started merging ...

Added:
    trunk/data/lua/gui/gui.status.lua
    trunk/data/lua/lib.debug.lua
    trunk/data/lua/lib.listener.lua
Modified:
    trunk/data/lua/gui/gui.main.lua
    trunk/data/lua/lib.charcreate.lua
    trunk/data/lua/lib.guimaker.lua
    trunk/data/lua/lib.loading.lua
    trunk/data/lua/lib.skill.lua
    trunk/data/lua/lib.test.lua
    trunk/data/lua/lib.util.lua
    trunk/data/lua/net/net.multi.lua
    trunk/data/lua/net/net.uodragdrop.lua

Modified: trunk/data/lua/gui/gui.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/gui/gui.main.lua (original)
+++ trunk/data/lua/gui/gui.main.lua Thu Aug  2 03:19:56 2007
@@ -4,4 +4,4 @@
 dofile(libpath .. &quot;gui/gui.paperdoll.lua&quot;)
 --~ dofile(libpath .. &quot;gui/gui.journal.lua&quot;)
 --~ dofile(libpath .. &quot;gui/gui.quit.lua&quot;)
---~ dofile(libpath .. &quot;gui/gui.status.lua&quot;)
+dofile(libpath .. &quot;gui/gui.status.lua&quot;)

Modified: trunk/data/lua/lib.charcreate.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.charcreate.lua (original)
+++ trunk/data/lua/lib.charcreate.lua Thu Aug  2 03:19:56 2007
@@ -7,7 +7,7 @@
 -- kPacket_Delete_Character_Failed ?
 -- kPacket_All_Characters ?
 -- kPacket_Move_Character ?
--- kPacket_Character_Profile ?
+-- ?? kPacket_Character_Profile ?
 -- kPacket_Character_Transfer_Log ?
 =

 -- template is one element from the array of GetCharCreationTemplates

Modified: trunk/data/lua/lib.guimaker.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.guimaker.lua (original)
+++ trunk/data/lua/lib.guimaker.lua Thu Aug  2 03:19:56 2007
@@ -55,10 +55,10 @@
 end
 =

 -- sorted overlay container (keeps zorder from beeing optimized away by re=
nder-state sorting)
-function guimaker.MakeSOC (parent)
+function guimaker.MakeSOC (parent,x,y)
 	local widget =3D parent:CreateChild()
 	widget.gfx:InitSOC()
-	widget.gfx:SetPos(0,0)
+	widget.gfx:SetPos(x or 0,y or 0)
 	widget.gfx:SetRankFactor(2) -- z order interval between childs, should be=
 a tiny bit greater than 1
 	widget.mbClipChildsHitTest =3D false
 	widget.mbIgnoreMouseOver =3D true

Modified: trunk/data/lua/lib.loading.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.loading.lua (original)
+++ trunk/data/lua/lib.loading.lua Thu Aug  2 03:19:56 2007
@@ -101,9 +101,11 @@
 =

 -- load bigger data chunks while menu is visible
 function PreLoad ()
+	--DebugCallLogStartIgnore()
 	LoadingProfile(&quot;init unifonts&quot;)
 	if (gUniFontLoaderType) then
-		for i=3D1,1 do
+		CreateUniFont(CorrectPath(gUOPath..&quot;unifont.mul&quot;),&quot;font_unifont0&quot;)
+		for i=3D1,2 do
 			gUniFontName[i] =3D &quot;font_unifont&quot;..i
 			gUniFontHeight[i] =3D CreateUniFont(CorrectPath(gUOPath..&quot;unifont&quot;..i..=
&quot;.mul&quot;),gUniFontName[i])
 		end
@@ -207,6 +209,10 @@
 	=

 	gLoadingProfileLastTime =3D 0
 	gLoadingProfileLastAction =3D false
+	=

+	--DebugCallLogStopIgnore()
+	--MeshExporter()
+	--Crash()
 end
 =

 -- don't load new map immediately, several mapchanges might be sent at log=
in quickly

Modified: trunk/data/lua/lib.skill.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.skill.lua (original)
+++ trunk/data/lua/lib.skill.lua Thu Aug  2 03:19:56 2007
@@ -323,134 +323,6 @@
 	end
 end
 =

--- update the aos stats display
-function UpdateStatusAos ()
-	if gStatusAosDialog then
-		gStatusAosDialog:UpdateStats()
-	end
-end
-
-
-		=

--- toggles the display of the extended aos stats
-gStatusAosDialog_LastPositionX =3D nil
-gStatusAosDialog_LastPositionY =3D nil
-function ToggleStatusAos ()
-	if (gStatusAosDialog) then
-		-- store current positoin
-		gStatusAosDialog_LastPositionX, gStatusAosDialog_LastPositionY =3D gStat=
usAosDialog.rootwidget.gfx:GetPos()
-		-- and close
-		gStatusAosDialog:Close()
-	else
-		-- request stats update of player body
-		if gPlayerBodySerial then Send_ClientQuery(gRequest_States,gPlayerBodySe=
rial) end
-	=

-		gStatusAosDialog =3D CreateGumpDlgFromGfm(datapath..&quot;gfm/status_aos.gfm&quot;)
-
-		-- restore last positoin if available
-		if gStatusAosDialog_LastPositionX and gStatusAosDialog_LastPositionY the=
n gStatusAosDialog.rootwidget.gfx:SetPos(gStatusAosDialog_LastPositionX, gS=
tatusAosDialog_LastPositionY) end
-		=

-		-- init StatusAos dialog
-		local dialog =3D gStatusAosDialog
-		dialog.Close =3D function (dialog)
-			gStatusAosDialog:Destroy()
-			gStatusAosDialog =3D nil
-		end
-		dialog.onMouseDown =3D function (widget,mousebutton)
-			if (mousebutton =3D=3D 2) then widget.dialog:Close() end
-			if (mousebutton =3D=3D 1) then widget.dialog:BringToFront() gui.StartMo=
veDialog(widget.dialog.rootwidget) end
-		end
-	=

-		--[[
-		stats.char_sex		=3D input:PopNetUint8() -- * 0x00 - Male     * 0x01 - Fe=
male
-		stats.char_gold		=3D input:PopNetUint32()
-		stats.char_armorC	=3D input:PopNetUint16() -- resistPhysical (old client=
s: AC).
-		stats.char_curWeight=3D input:PopNetUint16()
-		stats.char_maxWeight =3D input:PopNetUint16()
-		stats.char_race		 =3D input:PopNetUint8()
-		stats.char_statcap	=3D input:PopNetUint16()		-- The character's total al=
lowable sum of Strength, Intelligence, and Dexterity
-		stats.char_curPet	=3D input:PopNetUint8()			=

-		stats.char_maxPet	=3D input:PopNetUint8()
-		stats.char_fireresist	=3D input:PopNetUint16()			=

-		stats.char_coldresist	=3D input:PopNetUint16()			=

-		stats.char_poisonresist	=3D input:PopNetUint16()			=

-		stats.char_energyresist	=3D input:PopNetUint16()			=

-		stats.char_minDamage	=3D input:PopNetUint16()			=

-		stats.char_maxDamage	=3D input:PopNetUint16()			=

-		stats.char_tithing		=3D input:PopNetUint32()		=

-		]]--		=

-
-				-- stats update function
-		dialog.UpdateStats =3D function (dialog)
-			if gPlayerBodySerial and gMobiles then
-				local m =3D gMobiles[gPlayerBodySerial]
-				if m and m.stats then
-					local s =3D m.stats
-					=

-					local l =3D {	char_str =3D &quot;status_str&quot;, char_dex =3D &quot;status_dex&quot;, c=
har_int =3D &quot;status_int&quot;,
-								currentHitpoints =3D &quot;status_hits&quot;, maxHitpoints =3D &quot;status_maxhi=
ts&quot;,
-								char_curMana =3D &quot;status_mana&quot;, char_maxMana =3D &quot;status_maxmana&quot;,
-								char_curSta =3D &quot;status_stamina&quot;, char_maxSta =3D &quot;status_maxstami=
na&quot;,
-								char_luck =3D &quot;status_luck&quot;, char_gold =3D &quot;status_gold&quot;,
-								char_armorC =3D &quot;status_armor&quot;, char_statcap =3D &quot;status_statcap&quot;,=
 char_fireresist =3D &quot;status_fireres&quot;,
-								char_coldresist =3D &quot;status_coldres&quot;, char_poisonresist =3D &quot;statu=
s_poisres&quot;,
-								char_energyresist =3D &quot;status_energres&quot; }
-					=

-					-- set all textfields (single)
-					for k,v in pairs(l) do
-						if s[k] then dialog.controls[v].gfx:SetText(s[k])
-						else dialog.controls[v].gfx:SetText(&quot;?&quot;) end =

-					end
-
-					local r,g,b =3D GetNotorietyColor(m.notoriety)
-			=

-					-- set name
-					if m.name then dialog.controls[&quot;status_name&quot;].gfx:SetCharHeight(16) d=
ialog.controls[&quot;status_name&quot;].gfx:SetColour({r,g,b,1.0}) dialog.controls[&quot;s=
tatus_name&quot;].gfx:SetText(m.name)
-					else dialog.controls[&quot;status_name&quot;].gfx:SetText(&quot;?&quot;) end
-
-					-- multi part textfields, like &quot;10 / 20&quot;
-					-- pets
-					if s[&quot;char_curPet&quot;] and s[&quot;char_maxPet&quot;] then =

-						dialog.controls[&quot;status_pets&quot;].gfx:SetText(s[&quot;char_curPet&quot;]..&quot;/&quot;..s[=
&quot;char_maxPet&quot;]) =

-					else dialog.controls[&quot;status_pets&quot;].gfx:SetText(&quot;?&quot;) end =

-					-- damage
-					if s[&quot;char_minDamage&quot;] and s[&quot;char_maxDamage&quot;] then =

-						dialog.controls[&quot;status_minmaxdamage&quot;].gfx:SetText(s[&quot;char_minDamage=
&quot;]..&quot;-&quot;..s[&quot;char_maxDamage&quot;]) =

-					else dialog.controls[&quot;status_minmaxdamage&quot;].gfx:SetText(&quot;?&quot;) end =

-					-- weight
-					if s[&quot;char_curWeight&quot;] then =

-						if s[&quot;char_maxWeight&quot;] then =

-							-- max weight given
-							dialog.controls[&quot;status_weight&quot;].gfx:SetText(s[&quot;char_curWeight&quot;])
-							dialog.controls[&quot;status_maxweight&quot;].gfx:SetText(s[&quot;char_maxWeight&quot;])
-						else =

-							-- no maxweight present
-							dialog.controls[&quot;status_weight&quot;].gfx:SetText(s[&quot;char_curWeight&quot;]) =

-							-- hardcoded fallback: 40 + floor(str*35/10)
-							dialog.controls[&quot;status_maxweight&quot;].gfx:SetText(&quot;&quot;..
-								(40 + math.floor(s[&quot;char_str&quot;]*35/10)))
-						end
-					else dialog.controls[&quot;status_weight&quot;].gfx:SetText(&quot;?&quot;) end =

-				end
-			end
-		end
-		=

-		-- handle mouse events
-		for k,v in pairs(dialog.childs) do v.mbIgnoreMouseOver =3D false end
-
--- SiENcE: ??? for what ??? commented out
---		local curparent =3D dialog.rootwidget
---		local x,y =3D 40,80
-		=

-		-- set stats
-		dialog:UpdateStats()
-		=

-		dialog.lStatusAos =3D {}
-	end
-end
-
-
-
 glQuickCastDialog =3D {}
 -- creates a quickcast button at the given position
 function CreateQuickCastButton (x,y,name,fun)

Modified: trunk/data/lua/lib.test.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.test.lua (original)
+++ trunk/data/lua/lib.test.lua Thu Aug  2 03:19:56 2007
@@ -1,4 +1,30 @@
 -- contains all sorts of tests for checking the runtime environment and de=
bugging
+
+-- april 2007
+function TestGuiSystem2_Init ()
+	--local dialog =3D gui.CreateDialog(300,100)
+	--local w1 =3D dialog:CreateImage(&quot;checker&quot;,0,0,100,100)
+	--local w2 =3D dialog:CreateText(&quot;blub&quot;,10,10)
+	--w1.mytext =3D &quot;myimage&quot;
+	--w2.mytext =3D &quot;mytext&quot;
+end
+function TestGuiSystem2_Step ()
+	local widget =3D gui.GetWidgetUnderMouse()
+	Client_SetBottomLine(&quot;TestGuiSystem2 WidgetUnderMouse : &quot;..(widget and (w=
idget.mytext or &quot;unknown&quot;) or &quot;NONE&quot;))
+end
+
+function TestGuiSystem3_Init()
+	--[[local gump =3D gGumpmanager.CreateGump( 40, 40 )
+	gump:addImage( 0, 0, 1, 0, 0 ) =

+	gump:addTiledImage( 0, 0, 150, 150, hex2num(&quot;0x588&quot;), 0, 0 )
+	gump:addButton( 10, 10, hex2num(&quot;0x1589&quot;), hex2num(&quot;0x158B&quot;), hex2num(&quot;0x=
1589&quot;), 1, 0, 0 )
+	gump:addText( 10, 30, &quot;Bla blub&quot;, 1, 0, 0 )
+	gump:addBackground( 150, 100, 200, 25, hex2num(&quot;0xBB8&quot;), 0, 0 )
+	gump:addImage( 60, 175, hex2num(&quot;0xD5&quot;), 0, 0 )
+        gump:addTiledImage( 73, 175, 74, 14, hex2num(&quot;0xD6&quot;), 0, 0 )
+        gump:addImage( 147, 175, hex2num(&quot;0xD7&quot;), 0, 0 )
+        gump:addScrollbar( 60, 175, true, 100, hex2num(&quot;0xD8&quot;), hex2num(&quot;0=
xD8&quot;), 1, 0 )]]--
+end
 =

 function TestZLib()
 	local c =3D CreateFIFO()

Modified: trunk/data/lua/lib.util.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.util.lua (original)
+++ trunk/data/lua/lib.util.lua Thu Aug  2 03:19:56 2007
@@ -12,6 +12,12 @@
 	if (string.sub(line, -1) =3D=3D &quot;\n&quot; or string.sub(line, -1) =3D=3D &quot;\r&quot;)=
 then line =3D string.sub(line,1,string.len(line)-1) end
 	return line
 end
+
+-- adds all fields from second to first, but does not overwrite fields tha=
t are already set
+function ArrayMergeToFirst (first,second) for k,v in pairs(second) do if (=
first[k] =3D=3D nil) then first[k] =3D v end end end
+
+-- shallow copy
+function CopyArray (arr) res =3D {} for k,v in pairs(arr) do res[k] =3D v =
end return res end
 =

 function countarr(arr) local c =3D 0 for k,v in pairs(arr) do c =3D c + 1 =
end return c end
 function isempty(arr) return not (next(arr)) end

Modified: trunk/data/lua/net/net.multi.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.multi.lua (original)
+++ trunk/data/lua/net/net.multi.lua Thu Aug  2 03:19:56 2007
@@ -297,3 +297,34 @@
 		end
 	end
 end
+
+
+
+-- Custom Multis - aka - Serverside Multis
+--X/Y of this packet is probably wrong. May be 2 Byte portions instead of =
1. Information was submitted and as of yet untested.
+-- OLD version from knut.. above is new version from trunk
+--[[
+function gPacketHandler.kPacket_Custom_House()	--0xD8
+	local input =3D GetRecvFIFO()
+	local id =3D input:PopNetUint8()
+	local iPacketSize =3D input:PopNetUint16()
+	local compresstype =3D input:PopNetUint8()	-- (0=3Dnothing, 3=3Dzlib)
+	local unknown1 =3D input:PopNetUint8()
+	local multiserial =3D input:PopNetUint32()
+	local revision =3D input:PopNetUint32()
+	local itemcount =3D input:PopNetUint16()
+	local bufferlen =3D input:PopNetUint16()			-- item list (Number of tiles =
* 5), compressed
+
+	printf(&quot;NET: Custom_House: iPacketSize=3D0x%04x compresstype=3D%i unknown=
1=3D0x%02x multiserial=3D0x%08x revision=3D0x%08x itemcount=3D%i buffer=3D%=
i\n&quot;,
+			iPacketSize, compresstype, unknown1, multiserial, revision, itemcount, =
buffer)
+	=

+	for i =3D 1, tilenum do
+		local newitem =3D {}
+		newitem.artid =3D input:PopNetUint16()
+		newitem.xloc =3D input:PopNetUint8()
+		newitem.yloc =3D input:PopNetUint8()
+		newitem.zloc =3D input:PopNetUint8()
+		printdebug(&quot;NET&quot;, &quot;Custom_House: artid=3D0x%04x locx=3D%i locy=3D%i locz=
=3D%i\n&quot;, newitem.artid, newitem.xloc, newitem.yloc, newitem.zloc)
+	end
+end
+]]--

Modified: trunk/data/lua/net/net.uodragdrop.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.uodragdrop.lua (original)
+++ trunk/data/lua/net/net.uodragdrop.lua Thu Aug  2 03:19:56 2007
@@ -1,6 +1,6 @@
 -- Equip Item Request   (answer is 0x2E, see also 0x78). 0x13
 function Send_Equip_Item_Request(serial,layer,player_serial)
-	print(&quot;NET: Send_Equip_Item_Request:&quot;,sprintf(&quot;0x%08x&quot;,serial),layer,play=
er_serial)
+	printdebug(&quot;NET&quot;,&quot;NET: Send_Equip_Item_Request:&quot;,sprintf(&quot;0x%08x&quot;,serial)=
,layer,player_serial)
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_Equip_Item_Request)
 	out:PushNetUint32(serial)
@@ -22,7 +22,7 @@
 -- This is sent by the client when the player drops an item. 0x08
 -- containerid =3D 0xFFFFFFFF  when the container is the ground
 function Send_Drop_Object(serial,x,y,z,containerid)
-	print(&quot;NET: Send_Drop_Object:&quot;,sprintf(&quot;0x%08x&quot;,serial),x,y,z,containerid)
+	printdebug(&quot;NET&quot;,&quot;NET: Send_Drop_Object:&quot;,sprintf(&quot;0x%08x&quot;,serial),x,y,z,=
containerid)
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_Drop_Object)
 	out:PushNetUint32(serial)
@@ -45,14 +45,13 @@
 	if (reason =3D=3D hex2num(&quot;0x03&quot;)) then reasontxt =3D &quot;That item does not=
 belong to you. You will have to steal it.&quot; end
 	if (reason =3D=3D hex2num(&quot;0x04&quot;)) then reasontxt =3D &quot;You are already ho=
lding an item.&quot; end
 	if (reason =3D=3D hex2num(&quot;0x05&quot;)) then =

-		reasontxt =3D &quot;The item was destroyed.&quot;  -- TODO : no message ??
-		-- TODO : Destroy the item.
+		reasontxt =3D &quot;The item was destroyed.&quot;
 	end
 	if (reason =3D=3D hex2num(&quot;0x06&quot;)) then -- No message.
 		reasontxt =3D false
 	end
-	print(&quot;NET : Get_Item_Failed&quot;,reasontxt)
-	CleanUpUODragDrop() -- server side cancel
+	printdebug(&quot;NET&quot;,&quot;NET : Get_Item_Failed&quot;,reasontxt)
+	CancelUODragDrop() -- server side cancel
 end
 =

 -- Clear Square or Drop Failed ? (servers response to 0x08 ?)
@@ -62,14 +61,13 @@
 	local xloc =3D input:PopNetUint16()
 	local yloc =3D input:PopNetUint16()
 	-- TODO ?
-	print(&quot;NET : Drop_Item_Failed&quot;)
+	printdebug(&quot;NET&quot;,&quot;NET : Drop_Item_Failed --&gt; nothing todo?&quot;)
 end
 =

 -- Drop Item OK ? Paperdoll Clothing Added ? (servers response to 0x08 ?)
 function gPacketHandler.kPacket_Drop_Item_OK() -- 0x29
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
-	-- TODO ?
-	print(&quot;NET : Drop_Item_OK&quot;)
+	printdebug(&quot;NET&quot;,&quot;NET : Drop_Item_OK --&gt; nothing todo?&quot;)
 end
  =



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000139.html">[Iris-commit] [IRIS] r1327 - in /branches/knut/data/lua: lib.charcreate.lua lib.input.lua lib.loading.lua lib.stitchin.lua main.lua net.other.lua net.uodragdrop.lua net/net.uodragdrop.lua
</A></li>
	<LI>Next message: <A HREF="000145.html">[Iris-commit] [IRIS] r1329 - in /branches/knut/data/lua: ./ gui/	net/ obj/
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#140">[ date ]</a>
              <a href="thread.html#140">[ thread ]</a>
              <a href="subject.html#140">[ subject ]</a>
              <a href="author.html#140">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
