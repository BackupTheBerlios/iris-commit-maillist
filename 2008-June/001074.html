<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r2266 - in /trunk: lua/gui/gui.gumpparser.lua lua/lib.gump.samples.lua widgets/widget.gumpdialog.lua widgets/widget.uoimage.lua widgets/widget.uotext.lua
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2008-June/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r2266%20-%20in%20/trunk%3A%20lua/gui/gui.gumpparser.lua%0A%20lua/lib.gump.samples.lua%20widgets/widget.gumpdialog.lua%0A%20widgets/widget.uoimage.lua%20widgets/widget.uotext.lua&In-Reply-To=%3C20080629195327.5160A1C180A1%40zwischenwelt.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001073.html">
   <LINK REL="Next"  HREF="001075.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r2266 - in /trunk: lua/gui/gui.gumpparser.lua lua/lib.gump.samples.lua widgets/widget.gumpdialog.lua widgets/widget.uoimage.lua widgets/widget.uotext.lua</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r2266%20-%20in%20/trunk%3A%20lua/gui/gui.gumpparser.lua%0A%20lua/lib.gump.samples.lua%20widgets/widget.gumpdialog.lua%0A%20widgets/widget.uoimage.lua%20widgets/widget.uotext.lua&In-Reply-To=%3C20080629195327.5160A1C180A1%40zwischenwelt.org%3E"
       TITLE="[Iris-commit] [IRIS] r2266 - in /trunk: lua/gui/gui.gumpparser.lua lua/lib.gump.samples.lua widgets/widget.gumpdialog.lua widgets/widget.uoimage.lua widgets/widget.uotext.lua">no-reply at zwischenwelt.org
       </A><BR>
    <I>Sun Jun 29 21:53:27 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001073.html">[Iris-commit] [IRIS] r2265 - in /trunk: lua/gui/gui.gumpparser.lua lua/lib.iris_atlasgroup.lua widgets/widget.uoimage.lua
</A></li>
        <LI>Next message: <A HREF="001075.html">[Iris-commit] [IRIS] r2267 - in /trunk: lua/gui/gui.gumpparser.lua lua/lib.unifont.lua lua/lib.uoutils.lua lua/net/net.other.lua widgets/widget.uotext.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1074">[ date ]</a>
              <a href="thread.html#1074">[ thread ]</a>
              <a href="subject.html#1074">[ subject ]</a>
              <a href="author.html#1074">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ghoulsblade
Date: Sun Jun 29 21:53:26 2008
New Revision: 2266

Log:
guisystem : added gump samples for testing

Added:
    trunk/lua/lib.gump.samples.lua
    trunk/widgets/widget.uotext.lua
Modified:
    trunk/lua/gui/gui.gumpparser.lua
    trunk/widgets/widget.gumpdialog.lua
    trunk/widgets/widget.uoimage.lua

Modified: trunk/lua/gui/gui.gumpparser.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.gumpparser.lua (original)
+++ trunk/lua/gui/gui.gumpparser.lua Sun Jun 29 21:53:26 2008
@@ -8,6 +8,7 @@
 Description:  Similar to xmfhtmlgumpcolor command, but the parameter order=
 is different and an additionally [argument]
 entry enclosed with @'s can be used. With this you can specify texts that =
will be added to the CliLoc entry.
 ]]--
+dofile(libpath .. &quot;lib.gump.samples.lua&quot;)
 =

 =

 function GumpParserTest ()
@@ -18,6 +19,7 @@
 	Load_Hue()
 	Load_ArtMap()
 	Load_Gump()	=

+	Load_Cliloc()	=

 	--[[
 	kClientSideGump_HealthBar_Own		=3D healthbarGump -- own, includes mana,sta
 	kClientSideGump_HealthBar_Other		=3D npchealthGump -- other, only hp
@@ -30,9 +32,15 @@
 	kClientSideGump_Skill			=3D skillGump			-- the big skill list dialog with=
 up/down/lock boxes, grab icons and scrollbar
 	kClientSideGump_Journal			=3D journalGump	-- a very simple message log in=
 papyrus-scroll look
 	]]--
-	local dialog =3D GumpParser_New(kClientSideGump_Paperdoll_Own,true)
-	dialog:SetLeftTop(400,100)
-	local dialog2 =3D GumpParser(kClientSideGump_Paperdoll_Own,true)
+	-- kGumpSample_RuneBook kGumpSample_ChangeLog kGumpSample_Reward
+	--~ GumpParser_New(kGumpSample_RuneBook,false):SetLeftTop(0,240)
+	--~ GumpParser(kGumpSample_RuneBook,false)
+	local dialog =3D GumpParser_New(kClientSideGump_Paperdoll_Own,true) dialo=
g:SetLeftTop(400,100)
+	GumpParser(kClientSideGump_Paperdoll_Own,true)
+	=

+	local p =3D dialog:GetPage(0)
+	local cl =3D p:ForAllChilds(function (child,k) print(&quot;ordered_childlist_p=
age0:&quot;,k,child:GetClassName()) end)
+	=

 	-- TODO : html-center : glyphlist : glyphs to change h-alignment during p=
arsing ? needs line width.. and full text width (unless wrap specified !)
 	=

 	GUITest_MainLoop()
@@ -227,17 +235,7 @@
 =

 -- returns widget
 -- param : x,y,width,height,cliloc_id/textline_id,background,scrollbar,hue=
  : background=3D0/1=3Dtransparent?  scrollbar=3D0/1=3Ddisplayed
-function GumpParser_MakeText (parent,param,textlines) -- param.cliloc_id o=
r param.textline_id , param.color =3D hue
-	print(&quot;TODO:GumpParser_MakeText&quot;)
-	--[[ pre-gui2 :
-	widget =3D guimaker.MakeWrappedClippedText (parent, param.x, param.y+htex=
t_correction,
-													param.width,param.height,param.msgid, msg.charh, gFontDefs[&quot;G=
ump&quot;].col,
-													msg.center, msg.div, gFontDefs[&quot;Gump&quot;].name)
-	local rawtext =3D param.textline_id and textlines[param.textline_id] or (=
gClilocLoader and gClilocLoader:Get(param.cliloc_id) or &quot;no_cliloc&quot;)
-	local text =3D UnicodeFix(HtmlParser(widget,rawtext)) =

-	]]-- =

-end
-	=

+function GumpParser_MakeText (parent,param,textlines) return parent:Create=
Child(&quot;UOText&quot;,param,textlines) end
 =

 -- returns widget
 -- param : x,y,gump_id_normal,gump_id_pressed,quit,page_id,return_value
@@ -559,16 +557,18 @@
 	dialog:ShowPage(1)
 =

 	if (not bClientSideMode) then
-		gServerSideGump[Gumpdata.dialogId] =3D dialog
-	else
-		return dialog
-	end
+		if (Gumpdata.dialogId) then gServerSideGump[Gumpdata.dialogId] =3D dialo=
g end
+	end
+	return dialog
 end
 =

 =

 function GumpParser(Gumpdata, Clientsidemode)
 	if (not gGumpLoader) then return end
 =

+	=

+	--~ if (not Clientsidemode) then print(&quot;\n\n##### GUMP #####\n\n&quot;..Gumpda=
ta.Data..&quot;\n\ntextline=3D{&quot;) for k,v in pairs(Gumpdata.textline or {}) do p=
rint(k..&quot;=3D\&quot;&quot;..v..&quot;\&quot;\n&quot;) end print(&quot;}\n#######\n\n&quot;) end
+	=

 	local htext_correction=3D5
 =

 	-- close already existing dialog with the same id
@@ -971,8 +971,7 @@
 	dialog:ShowPage(1)
 =

 	if not(Clientsidemode) then
-		gServerSideGump[Gumpdata.dialogId] =3D dialog
-	else
-		return dialog
-	end
+		if (Gumpdata.dialogId) then gServerSideGump[Gumpdata.dialogId] =3D dialo=
g end
+	end
+	return dialog
 end

Modified: trunk/widgets/widget.gumpdialog.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/widgets/widget.gumpdialog.lua (original)
+++ trunk/widgets/widget.gumpdialog.lua Sun Jun 29 21:53:26 2008
@@ -47,6 +47,7 @@
 	local page =3D self.pages[pagenum]
 	if (page) then return page end
 	page =3D self:CreateChild(&quot;Group&quot;) -- for sub-widgets
+	page.pagenum =3D pagenum
 	self.pages[pagenum] =3D page
 	return page
 end

Modified: trunk/widgets/widget.uoimage.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/widgets/widget.uoimage.lua (original)
+++ trunk/widgets/widget.uoimage.lua Sun Jun 29 21:53:26 2008
@@ -16,7 +16,7 @@
 		self:AddToDestroyList(self.rendergroup2d)
 		print(&quot;widget.UOImage : multipart not yet implemented&quot;)
 		-- TODO : multiple child widgets for bitmask
-		-- TODO : skip_rows_from_top =3D 1 for middle
+		-- TODO : skip_rows_from_top =3D 1 for middle : widget.gfx:SetUV(0,(skip=
_rows_from_top)/th,cx/tw,(cy+skip_rows_from_top)/th)
 		-- TODO : gBorderGumpIndexAdd =3D { LT=3D0,T=3D1,RT=3D2,L=3D3,M=3D4,R=3D=
5,LB=3D6,B=3D7,RB=3D8,RB_Resize=3D9 }  -- from gui.gumpmaker.lua
 	else
 		local matname,u0,v0,uvw,uvh,origw,origh,bitmask
@@ -41,19 +41,6 @@
 	if (bitmask) then self:SetBitMask(bitmask) end
 end
 =

-
---~ local mat =3D GetArtMat(art_id,hue)
---~ local w,h =3D GetArtSize(art_id,hue)
---~ local bitmask =3D GetArtBitMask(art_id)
-
---~ local mat =3D GetGumpMat(iGumpID,hueid)
---~ local w,h =3D GetGumpSize(iGumpID)
---~ widget.gfx:SetUV(0,(skip_rows_from_top)/th,cx/tw,(cy+skip_rows_from_to=
p)/th)
---~ local bitmask =3D GetGumpBitMask(iGumpID)
-
--- returns matname,u0,v0,uvw,uvh,origw,origh,bitmask =

--- TODO : skip_rows_from_top needed for multipart/resizepic
-
 -- returns matname,u0,v0,uvw,uvh,origw,origh
 -- TODO : temporary fix, should really be a checker texture tiled using te=
xcoords, but spritepanel doesn't support that yet
 function gWidgetPrototype.UOImage:LoadChecker 	() =



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001073.html">[Iris-commit] [IRIS] r2265 - in /trunk: lua/gui/gui.gumpparser.lua lua/lib.iris_atlasgroup.lua widgets/widget.uoimage.lua
</A></li>
	<LI>Next message: <A HREF="001075.html">[Iris-commit] [IRIS] r2267 - in /trunk: lua/gui/gui.gumpparser.lua lua/lib.unifont.lua lua/lib.uoutils.lua lua/net/net.other.lua widgets/widget.uotext.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1074">[ date ]</a>
              <a href="thread.html#1074">[ thread ]</a>
              <a href="subject.html#1074">[ subject ]</a>
              <a href="author.html#1074">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
