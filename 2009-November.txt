From no-reply at zwischenwelt.org  Sat Nov 14 17:13:45 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 14 Nov 2009 16:13:45 -0000
Subject: [Iris-commit] [IRIS] r3137 - /trunk/installdeps.ubuntu.sh
Message-ID: <20091114161345.666D37A9812E@simon>

Author: ghoulsblade
Date: Sat Nov 14 17:13:44 2009
New Revision: 3137

Log:
installdeps.ubuntu.sh adjusted : boost thread separate for ubuntu karmic

Modified:
    trunk/installdeps.ubuntu.sh

Modified: trunk/installdeps.ubuntu.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/installdeps.ubuntu.sh (original)
+++ trunk/installdeps.ubuntu.sh Sat Nov 14 17:13:44 2009
@@ -1,10 +1,14 @@
 #!/bin/bash
 # old :  libogre14 libogre-dev  (dependencies might still be needed? )
 OGREDEPS=3D"automake libtool libzzip-dev libxt-dev libx11-dev libxaw7-dev =
libxxf86vm-dev libxrandr-dev libfreeimage-dev libfreetype6-dev libglut3-dev"
-DEPS=3D"$OGREDEPS libboost-thread1.37-dev nvidia-cg-toolkit libwxbase2.8-d=
ev libwxgtk2.8-dev wx2.8-headers ccache liblua50-dev liblualib50-dev libalu=
t-dev libopenal-dev libvorbisfile3 libvorbis-dev libogg-dev libois-dev g++ =
gcc"
+DEPS=3D"$OGREDEPS nvidia-cg-toolkit libwxbase2.8-dev libwxgtk2.8-dev wx2.8=
-headers ccache liblua50-dev liblualib50-dev libalut-dev libopenal-dev libv=
orbisfile3 libvorbis-dev libogg-dev libois-dev g++ gcc"
 echo "libboost-dev included in libboost-thread1.37-dev ?"
 echo apt-get install $DEPS
 sudo apt-get install $DEPS
+DEPS2=3D"libboost-thread1.37-dev" # ubuntu jaunty
+DEPS2=3D"libboost-thread1.40-dev" # ubuntu karmic
+echo apt-get install $DEPS2
+sudo apt-get install $DEPS2
 echo ------------------------------
 echo iris 2 uses fmod ex 4.* to play music files. alternatively you can us=
e openal, but that has no music then.
 echo you can download fmod ex 4.* stable for linux from http://www.fmod.or=
g/index.php/download



From no-reply at zwischenwelt.org  Sat Nov 14 19:43:34 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 14 Nov 2009 18:43:34 -0000
Subject: [Iris-commit] [IRIS] r3138 - /trunk/lua/lib.gfxconfig.lua
Message-ID: <20091114184334.0F4617A9812E@simon>

Author: ghoulsblade
Date: Sat Nov 14 19:43:33 2009
New Revision: 3138

Log:
commandline : resolution override with -res 640x480

Modified:
    trunk/lua/lib.gfxconfig.lua

Modified: trunk/lua/lib.gfxconfig.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gfxconfig.lua (original)
+++ trunk/lua/lib.gfxconfig.lua Sat Nov 14 19:43:33 2009
@@ -76,10 +76,12 @@
 	if (not gGfxConfig_AntiAliasing) then gGfxConfig_AntiAliasing =3D "0" end
 	if (gGfxConfig_Fullscreen =3D=3D nil) then gGfxConfig_Fullscreen =3D fals=
e end
 	=

+	local resolution_override =3D false
 	local cmd_res =3D gCommandLineSwitches["-res"] =

 	if (cmd_res) then =

 		local a,b,cx,cy =3D string.find(gCommandLineArguments[cmd_res+1],"(%d+)x=
(%d+)")
 		gGfxConfig_Resolution =3D GfxConfig_FindResolution(cx,cy) =

+		resolution_override =3D cx.." x "..cy
 	end =

 	=

 	print(">>>gGfxConfig_RenderSystem",WrapString(gGfxConfig_RenderSystem))
@@ -122,7 +124,12 @@
 	end
 	GfxConfig_SetOgreConfig({"FSAA","Anti aliasing"},gGfxConfig_AntiAliasing)
 	GfxConfig_SetOgreConfig({"Full Screen"},gGfxConfig_Fullscreen and "Yes" o=
r "No")
-	GfxConfig_SetOgreConfig({"Video Mode"},gGfxConfig_Resolution)
+	=

+	if (resolution_override) then =

+		Ogre_SetConfigOption("Video Mode","1024 x 768")
+	else
+		GfxConfig_SetOgreConfig({"Video Mode"},gGfxConfig_Resolution)
+	end
 	=

 	for k,v in pairs(gGfxConfig_CustomOptions or {}) do Ogre_SetConfigOption(=
k,v) end
 	 --~ sConfigOptionName      FSAA    0 2 4



From no-reply at zwischenwelt.org  Sat Nov 14 21:39:09 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 14 Nov 2009 20:39:09 -0000
Subject: [Iris-commit] [IRIS] r3139 - /trunk/lua/lib.bodygfx.lua
Message-ID: <20091114203909.12B0E7A9812E@simon>

Author: ghoulsblade
Date: Sat Nov 14 21:39:08 2009
New Revision: 3139

Log:
lib.bodygfx.lua : centralized step to avoid registering a new callback for =
every body

Modified:
    trunk/lua/lib.bodygfx.lua

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Sat Nov 14 21:39:08 2009
@@ -22,7 +22,16 @@
 function gBodyGfxPrototype:Init (parentgfx)
     self.modelgfx =3D parentgfx and parentgfx:CreateChild() or CreateRootG=
fx3D() -- main
     self.groupgfx =3D self.modelgfx:CreateChild() -- seperate for mount-z-=
mod , contains only bodyparts
-    RegisterListener("Hook_PreRenderOneFrame",function() self:Step() retur=
n self.bDead end)
+	gBodyGfxMainStepList[self] =3D true
+end
+
+gBodyGfxMainStepList =3D {}
+RegisterListener("Hook_PreRenderOneFrame",function() BodyGfxMainStep() end)
+function BodyGfxMainStep ()
+	for body,v in pairs(gBodyGfxMainStepList) do =

+		body:Step()
+		if (body.bDead) then gBodyGfxMainStepList[body] =3D nil end
+	end
 end
 =

 function gBodyGfxPrototype:Destroy ()



From no-reply at zwischenwelt.org  Sun Nov 15 21:31:57 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 15 Nov 2009 20:31:57 -0000
Subject: [Iris-commit] [IRIS] r3140 - /trunk/installdeps.ubuntu.sh
Message-ID: <20091115203157.DDD9A7A9807B@simon>

Author: ghoulsblade
Date: Sun Nov 15 21:31:57 2009
New Revision: 3140

Log:
added infos about fmod-symlink, fmod-disable and link to installguide for h=
otkeys+macros to installdeps.ubuntu.sh

Modified:
    trunk/installdeps.ubuntu.sh

Modified: trunk/installdeps.ubuntu.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/installdeps.ubuntu.sh (original)
+++ trunk/installdeps.ubuntu.sh Sun Nov 15 21:31:57 2009
@@ -2,19 +2,29 @@
 # old :  libogre14 libogre-dev  (dependencies might still be needed? )
 OGREDEPS=3D"automake libtool libzzip-dev libxt-dev libx11-dev libxaw7-dev =
libxxf86vm-dev libxrandr-dev libfreeimage-dev libfreetype6-dev libglut3-dev"
 DEPS=3D"$OGREDEPS nvidia-cg-toolkit libwxbase2.8-dev libwxgtk2.8-dev wx2.8=
-headers ccache liblua50-dev liblualib50-dev libalut-dev libopenal-dev libv=
orbisfile3 libvorbis-dev libogg-dev libois-dev g++ gcc"
-echo "libboost-dev included in libboost-thread1.37-dev ?"
-echo apt-get install $DEPS
-sudo apt-get install $DEPS
+#~ echo "libboost-dev included in libboost-thread1.37-dev ?"
 DEPS2=3D"libboost-thread1.37-dev" # ubuntu jaunty
 DEPS2=3D"libboost-thread1.40-dev" # ubuntu karmic
+echo apt-get install $DEPS
 echo apt-get install $DEPS2
+sudo apt-get install $DEPS
 sudo apt-get install $DEPS2
 echo ------------------------------
-echo iris 2 uses fmod ex 4.* to play music files. alternatively you can us=
e openal, but that has no music then.
-echo you can download fmod ex 4.* stable for linux from http://www.fmod.or=
g/index.php/download
-echo please install the 32 bit version of fmod, even if you have a 64 bit =
system, our buildscript wont be able to find it otherwise
+echo "FMOD"
+echo "iris 2 uses fmod ex 4.* to play music files. alternatively you can u=
se openal, but that has no music then."
+echo "you can download fmod ex 4.* stable for linux from http://www.fmod.o=
rg/index.php/download"
+echo "please install the 32 bit version of fmod, even if you have a 64 bit=
 system, our buildscript wont be able to find it otherwise"
 echo "direct download link (august 2009) : http://www.fmod.org/index.php/r=
elease/version/fmodapi42706linux.tar.gz"
+echo "you probably have to add a symbolic link so that iris can find the f=
mod lib, since the filename contains the version"
+echo "to do that run"
+echo "#> locate libfmod"
+echo "if it lists something like /usr/local/lib/libfmodex-4.27.06.so"
+echo "then you should make a symbolic link like this :"
+echo "#> sudo ln -s /usr/local/lib/libfmodex-4.27.06.so /usr/local/lib/lib=
fmodex.so"
+echo "then iris will find it during compile : ./makeclean.sh && ./premakel=
inux.sh"
+echo "if you get linker errors like 'undefined reference to ... FMOD_...' =
(64 bit problem) you can disable fmod by editing premake.lua and setting 'g=
bUseSoundFmod =3D true' to false "
 echo ------------------------------
+echo "Ogre1.6"
 echo iris 2 uses ogre1.6 now, there is no package for that yet, so you wil=
l need to compile that from source
 echo to do that, download the source from =

 echo http://sourceforge.net/projects/ogre/files/ogre/1.6.1/ogre-v1-6-1.tar=
.bz2/download
@@ -27,6 +37,7 @@
 echo    add a line \"/usr/local/lib\" to /etc/ld.so.conf
 echo sudo /sbin/ldconfig
 echo ---------------------------------------------
+echo "Ogre1.6 package"
 #~ DISTRO_CODENAME=3Dhardy
 # /etc/apt/sources.list.d
 DISTRO_CODENAME=3D`cat /etc/lsb-release | grep DISTRIB_CODENAME | awk -F =
=3D '{print $2}'`
@@ -40,4 +51,9 @@
 echo "WARNING ! currently (august 2009) this is not recommended, as there =
are crashes with ogre 1.6.2"
 echo "  we'd recommend using 1.6.1  (compiled from source as described abo=
ve) as we haven't tried 1.6.3 under linux yet."
 echo "  you can download ogre 1.6.1 source here : http://sourceforge.net/p=
rojects/ogre/files/ogre/1.6.1/ogre-v1-6-1.tar.bz2/download"
+echo ---------------------------------------------
+echo "further infos"
+echo "iris homepage : http://iris2.de"
+echo "for more infos and instructions on how to set hotkeys and macros see=
 the install guide : http://iris.schattenkind.net/index.php/InstallationMan=
ual"
 =

+



From no-reply at zwischenwelt.org  Mon Nov 16 09:20:16 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 16 Nov 2009 08:20:16 -0000
Subject: [Iris-commit] [IRIS] r3141 - in /trunk: ./ lua/ lua/filter/
Message-ID: <20091116082016.8F3527A98142@simon>

Author: ghoulsblade
Date: Mon Nov 16 09:20:16 2009
New Revision: 3141

Log:
main : directx download url updated to aug2009, old was nov2008.  mount ske=
leton override fix (beetle horse anim), started a bit on particle system an=
d granny code

Added:
    trunk/lua/lib.debugmode.lua
    trunk/lua/lib.granny.debug.lua
    trunk/lua/lib.particle.debug.lua
    trunk/lua/lib.particle.effects.lua
    trunk/lua/lib.particle.lua
Modified:
    trunk/lib.premake.lua
    trunk/lua/filter/filter.granny.lua
    trunk/lua/lib.granny.loader.lua
    trunk/lua/lib.granny.lua
    trunk/lua/lib.mainmenu.lua
    trunk/lua/main.lua

Modified: trunk/lib.premake.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lib.premake.lua (original)
+++ trunk/lib.premake.lua Mon Nov 16 09:20:16 2009
@@ -66,6 +66,11 @@
 		end
 	end
 	=

+	-- TODO : extra-brute-force for fmod... default install has filenames lik=
e this
+	--~ /usr/local/lib/libfmodex-4.27.06.so
+	--~ /usr/local/lib/libfmodexp-4.27.06.so
+
+	=

     if path then
 		tinsert (package.libpaths,path)
 		tinsert (package.links, libname)

Modified: trunk/lua/filter/filter.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.granny.lua (original)
+++ trunk/lua/filter/filter.granny.lua Mon Nov 16 09:20:16 2009
@@ -5,21 +5,15 @@
 =

 -- FILTER: Grannys
 function GrannyOverride(bodyid)
-	if (gGrannyFilter[bodyid]) then
-		local grannyid =3D gGrannyFilter[bodyid].grannyid
-		if (grannyid) then
-			printdebug("granny","Override: GrannyID to new GrannyID ",bodyid," -> "=
,grannyid)
-			return grannyid
-		end
-	end
-	return bodyid
+	local o =3D gGrannyFilter[bodyid]
+	return (o and o.grannyid) or gMountGrannyOverride[bodyid] or bodyid
 end
 =

 function GrannyMeshOverride(bodyid)
 	if (gGrannyFilter[bodyid]) then
 		local meshname =3D gGrannyFilter[bodyid].meshname
 		if (meshname) then
-			printdebug("granny","OverrideMesh: GrannyID to Mesh ",bodyid," -> ",mes=
hname)
+			--~ printdebug("granny","OverrideMesh: GrannyID to Mesh ",bodyid," -> "=
,meshname) -- might be executed very often here -> disabled for now
 			return meshname
 		end
 	end

Modified: trunk/lua/lib.granny.loader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.loader.lua (original)
+++ trunk/lua/lib.granny.loader.lua Mon Nov 16 09:20:16 2009
@@ -20,7 +20,7 @@
 include/grannyparser.h
 ]]--
 =

-cGrannyFile =3D cGrannyFile or {}
+cGrannyFile =3D cGrannyFile or CreateClass()
 =

 dofile(libpath .. "lib.granny.types.lua")
 =

@@ -41,6 +41,8 @@
 end
 =

 =

+function cGrannyFile:New (...) return CreateClassInstance(self,...) end
+
 function cGrannyFile:LoadFile (filepath) =

 	print("cGrannyFile:LoadFile",filepath)
 	self.filepath =3D filepath
@@ -48,9 +50,9 @@
 	fifo:Clear()
 	fifo:ReadFromFile(filepath)
 	self:Parse(fifo)
-	self:XMLDump("../mygranny.xml") =

+	--~ self:XMLDump("../mygranny.xml") =

 	fifo:Destroy()
-	os.exit(0)
+	self.fifo =3D nil
 end
 =

 =

@@ -97,27 +99,29 @@
 		pQuaternion		=3DMyDumpObjList, =

 		pScale			=3DMyDumpObjList, =

 	}
-	local quickfifo =3D self.fifo:GetQuickHandle()
+	local quickfifo =3D self.fifo and self.fifo:GetQuickHandle()
 	function MyHexDumpNode (offset,len) =

 		local node =3D {name=3D"hexdump",attr=3D{offset=3Doffset,len=3Dlen}}
 		local pos =3D 0
-		while (len > 0) do =

-			local partlen =3D min(len,16)
-			local hex	=3D ""
-			local asci	=3D ""
-			for i=3D1,16 do =

-				if (i <=3D partlen) then =

-					local c =3D FIFO_PeekUint8(quickfifo,offset+pos+i)
-					hex =3D hex .. sprintf("%02x ",c)
-					asci =3D asci .. ((c >=3D 32 and c < 128) and sprintf("%c",c) or "?")
-				else =

-					hex =3D hex .. "   "
+		if (quickfifo) then =

+			while (len > 0) do =

+				local partlen =3D min(len,16)
+				local hex	=3D ""
+				local asci	=3D ""
+				for i=3D1,16 do =

+					if (i <=3D partlen) then =

+						local c =3D FIFO_PeekUint8(quickfifo,offset+pos+i)
+						hex =3D hex .. sprintf("%02x ",c)
+						asci =3D asci .. ((c >=3D 32 and c < 128) and sprintf("%c",c) or "?")
+					else =

+						hex =3D hex .. "   "
+					end
+					if (i =3D=3D 8) then hex =3D hex .. " " end
 				end
-				if (i =3D=3D 8) then hex =3D hex .. " " end
+				XMLNodeAddChild(node,{name=3D"hexline",attr=3D{pos=3Dsprintf("0x%04x",=
pos)},n=3D1,[1]=3Dhex..asci})
+				len =3D len - partlen
+				pos =3D pos + partlen
 			end
-			XMLNodeAddChild(node,{name=3D"hexline",attr=3D{pos=3Dsprintf("0x%04x",p=
os)},n=3D1,[1]=3Dhex..asci})
-			len =3D len - partlen
-			pos =3D pos + partlen
 		end
 		return node
 	end

Modified: trunk/lua/lib.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.lua (original)
+++ trunk/lua/lib.granny.lua Mon Nov 16 09:20:16 2009
@@ -84,6 +84,7 @@
     -- Models.txt : 234 2   0   FFFFFFFF    0   1.3 1.3 1.3 deer_stag
     --if (bodyid =3D=3D 400) then bodyid =3D 401 end
     --if (bodyid =3D=3D 401) then bodyid =3D 400 end
+	bodyid =3D GrannyOverride(bodyid)
     local modelinfo =3D GetGrannyModelInfo(bodyid)
 =

     assert(modelinfo,"ERROR bodyinfo for skeleton not found "..tostring(bo=
dyid))
@@ -426,7 +427,7 @@
     return grannymodelinfo
 end
 =

-function GetGrannyModelInfo (modelid) =

+function GetGrannyModelInfo (modelid,bAllowBroken) =

     if (not gGrannyModelInfo) then =

         gGrannyModelInfo =3D LoadGrannyModelInfo( CorrectGrannyPath(gGrann=
yConfigFile) ) =

         --~ local kmax =3D 0
@@ -434,8 +435,14 @@
         --~ print("GetGrannyModelInfo : maxmodelid =3D ",kmax,sprintf("0x%=
04x",kmax))
     end
     =

-    if (gBrokenGrannyModelIdList[modelid]) then return nil end
+    if (gBrokenGrannyModelIdList[modelid] and (not bAllowBroken)) then ret=
urn nil end
     return gGrannyModelInfo[modelid]
+end
+
+gGrannyFilePathCache =3D MakeCache(function (modelinfo) return CorrectGran=
nyPath(gGrannyTypeDirs[modelinfo.typeid] .. modelinfo.modelname .. "_LOD2.g=
rn") end)
+function GetGrannyFilePath (modelid,bAllowBroken) =

+	local modelinfo =3D GetGrannyModelInfo(modelid,bAllowBroken)
+	return modelinfo and gGrannyFilePathCache[modelinfo]
 end
 =

 function TestGranny (modelid)

Modified: trunk/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.lua (original)
+++ trunk/lua/lib.mainmenu.lua Mon Nov 16 09:20:16 2009
@@ -46,6 +46,7 @@
     if (gCommandLineSwitches["-mt"]) then ToggleMacroList() return true en=
d -- macrolist-test
     if (gCommandLineSwitches["-so"]) then StartOfflineMode(gCommandLineArg=
uments[gCommandLineSwitches["-so"]+1]) return true end -- start in offline =
mode
     if (gCommandLineSwitches["-sd"]) then StartDebugMenu() return true end=
 -- start in debug mode
+    if (gCommandLineSwitches["-sdg"]) then StartDebugGrannyMenu() return t=
rue end -- start in debug mode
     if (gCommandLineSwitches["-grannytest"]) then StartGrannyTest() return=
 true end
     if (gCommandLineSwitches["-co"]) then =

         local name =3D gCommandLineArguments[gCommandLineSwitches["-co"]+1]

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Mon Nov 16 09:20:16 2009
@@ -65,8 +65,13 @@
 dofile(libpath .. "lib.spellbooks.lua")
 dofile(libpath .. "lib.spellinfo.lua")
 dofile(libpath .. "lib.speech.lua")
+dofile(libpath .. "lib.debugmode.lua")
+dofile(libpath .. "lib.particle.lua")
+dofile(libpath .. "lib.particle.effects.lua")
+dofile(libpath .. "lib.particle.debug.lua")
 dofile(libpath .. "lib.granny.lua")
 dofile(libpath .. "lib.granny.loader.lua")
+dofile(libpath .. "lib.granny.debug.lua")
 dofile(libpath .. "lib.bodygfx.lua")
 dofile(libpath .. "lib.stitchin.lua")
 dofile(libpath .. "lib.test.lua")
@@ -365,7 +370,8 @@
     print(descr)
     print("#################")
     if (StringContains(descr,"Could not load dynamic library") and StringC=
ontains(descr,"Direct3D9")) then =

-        local url =3D "http://www.microsoft.com/downloads/details.aspx?Fam=
ilyID=3D886acb56-c91a-4a8e-8bb8-9f20f1244a8e&DisplayLang=3Den" -- nov2008
+        local url =3D "http://www.microsoft.com/downloads/details.aspx?fam=
ilyid=3D04AC064B-00D1-474E-B7B1-442D8712D553&displaylang=3Den" -- aug2009
+        --~ local url =3D "http://www.microsoft.com/downloads/details.aspx=
?FamilyID=3D886acb56-c91a-4a8e-8bb8-9f20f1244a8e&DisplayLang=3Den" -- nov20=
08
         -- old : "http://download.microsoft.com/download/5/c/8/5c8b7216-bb=
c2-4215-8aa5-9dfef9cdb3df/directx_aug2008_redist.exe" -- aug2008
         -- generic : http://www.microsoft.com/downloads/details.aspx?famil=
yid=3D2DA43D38-DB71-4C1B-BC6A-9B6652CD92A3&displaylang=3Dde (todo:displayla=
ng=3Den?) (link to newest, but requires windows validation procedure)
         local tipp =3D    "Your DirectX9 version is too old to run Iris.\n=
"..
@@ -449,6 +455,8 @@
     -- if (false) then TestMultiLoader() end
     -- if (false) then TestZLib() end
     -- if (false) then TestUniFontLoader() end
+    if (gCommandLineSwitches["-sdg"]) then StartDebugGrannyMenu() end
+    if (gCommandLineSwitches["-sdp"]) then StartDebugParticleMenu() end
     if (gCommandLineSwitches["-guitest"]) then GUITest() end
     if (gCommandLineSwitches["-gumptest"]) then GumpParserTest() end
     ----------------------------------------------------------------------=
------------------------------------



From no-reply at zwischenwelt.org  Mon Nov 16 23:22:09 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 16 Nov 2009 22:22:09 -0000
Subject: [Iris-commit] [IRIS] r3142 - /trunk/bin/iris2.exe
Message-ID: <20091116222209.93DC07A98127@simon>

Author: sience
Date: Mon Nov 16 23:22:09 2009
New Revision: 3142

Log:
-new win32 binary

Modified:
    trunk/bin/iris2.exe

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Tue Nov 17 00:28:24 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 16 Nov 2009 23:28:24 -0000
Subject: [Iris-commit] [IRIS] r3143 - /trunk/bin/updater.exe
Message-ID: <20091116232824.54F197A98127@simon>

Author: sience
Date: Tue Nov 17 00:28:24 2009
New Revision: 3143

Log:
more static updater (hope this helps)

Modified:
    trunk/bin/updater.exe

Modified: trunk/bin/updater.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Tue Nov 17 20:29:28 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 17 Nov 2009 19:29:28 -0000
Subject: [Iris-commit] [IRIS] r3144 - /tools/updater/updater_vs9.vcproj
Message-ID: <20091117192928.854B37A98006@simon>

Author: sience
Date: Tue Nov 17 20:29:26 2009
New Revision: 3144

Log:
-changes project settings

Modified:
    tools/updater/updater_vs9.vcproj

Modified: tools/updater/updater_vs9.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/updater/updater_vs9.vcproj (original)
+++ tools/updater/updater_vs9.vcproj Tue Nov 17 20:29:26 2009
@@ -97,7 +97,7 @@
 			OutputDirectory=3D"$(SolutionDir)$(ConfigurationName)"
 			IntermediateDirectory=3D"$(ConfigurationName)"
 			ConfigurationType=3D"1"
-			UseOfMFC=3D"0"
+			UseOfMFC=3D"1"
 			CharacterSet=3D"0"
 			WholeProgramOptimization=3D"1"
 			>
@@ -120,7 +120,7 @@
 				Name=3D"VCCLCompilerTool"
 				AdditionalIncludeDirectories=3D"./;&quot;svn-win32-1.4.3\include&quot;=
;&quot;svn-win32-1.4.3\include\apr&quot;;&quot;svn-win32-1.4.3\include\apr-=
util&quot;;&quot;wxMSW-2.8.3\include\&quot;;&quot;wxMSW-2.8.3\include\msvc\=
&quot;"
 				PreprocessorDefinitions=3D"NDEBUG;WIN32;_WINDOWS;__WINDOWS__;__WXMSW__=
;__WIN95__;__WIN32__;WINVER=3D0x0400;STRICT"
-				RuntimeLibrary=3D"2"
+				RuntimeLibrary=3D"0"
 				UsePrecompiledHeader=3D"0"
 				WarningLevel=3D"3"
 				Detect64BitPortabilityProblems=3D"false"



From no-reply at zwischenwelt.org  Tue Nov 17 20:59:13 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 17 Nov 2009 19:59:13 -0000
Subject: [Iris-commit] [IRIS] r3145 - in /trunk/lua: lib.3d.renderer.lua
 lib.bodygfx.lua lib.granny.debug.lua lib.granny.lua lib.granny.types.lua
 main.lua
Message-ID: <20091117195913.E85FE7A98006@simon>

Author: ghoulsblade
Date: Tue Nov 17 20:59:13 2009
New Revision: 3145

Log:
fileopen choose uodir :  select map0.mul now, less confusing.  improved gra=
nny check, helpful error message, worked a bit on new granny loader

Modified:
    trunk/lua/lib.3d.renderer.lua
    trunk/lua/lib.bodygfx.lua
    trunk/lua/lib.granny.debug.lua
    trunk/lua/lib.granny.lua
    trunk/lua/lib.granny.types.lua
    trunk/lua/main.lua

Modified: trunk/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.renderer.lua (original)
+++ trunk/lua/lib.3d.renderer.lua Tue Nov 17 20:59:13 2009
@@ -48,6 +48,7 @@
     self.gbActive =3D true
     self.mfPersonalLight =3D 0
     self.mfSunLight =3D 1
+	GrannyTest3DData()
 end
 =

 -- deactivating Renderer3D

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Tue Nov 17 20:59:13 2009
@@ -171,6 +171,7 @@
         if ((not mountbodyid) or mountbodyid =3D=3D 0) then mountbodyid =
=3D gStandardHorse end
         if (mountbodyid and mountbodyid ~=3D 0) then
             local mountskeleton =3D GetOrCreateSkeleton(mountbodyid) -- sk=
eleton is determined by the bodyid, not possible from the wearables
+			if (not mountskeleton) then return end
             local meshname =3D GetGrannyMeshName(mountbodyid,mountskeleton=
.name,mount.hue or 0)
             =

             -- fallback to standard horse mount
@@ -293,6 +294,7 @@
 function CreateBodyGfxPartsFromModelIDArray (bodyid,parentgfx,partsarr,mod=
elidarr,iPrimaryHandItem,iSecondaryHandItem)
     if (not gGrannyLoaderType) then return end
     local skeleton =3D GetOrCreateSkeleton(bodyid) -- skeleton is determin=
ed by the bodyid, not possible from the wearables
+	if (not skeleton) then return end
     local skeleton_name =3D skeleton and skeleton.name or "unknown_skeleto=
n"
     printdebug("granny","CreateBodyGfxPartsFromModelIDArray...",bodyid,bod=
yid,skeleton_name)
     local leftHandEntity1

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Tue Nov 17 20:59:13 2009
@@ -49,31 +49,20 @@
 	Load_Granny() -- needs Renderer3D
 	Load_Stitchin()
 	=

-	self:PrintBrokenGrannyInfos()
+	--~ self:PrintBrokenGrannyInfos()
 	--~ self:ClearGrannyOverrides()
 	=

-	local grannyartid =3D gCommandLineArguments[gCommandLineSwitches["-sdg"]+=
1]
-	local grannyartid =3D 400
-	print("grannyartid",grannyartid)
 	self:MakeGrid({0,0,0},{1,0,0},{0,1,0},5,5,true)
 	=

 	local modelid =3D 791 -- giant_beetle
 	--~ local modelid =3D 200 -- standard horse
-	self:MakeOldGranny(modelid)
+	--~ self:MakeOldGranny(modelid)
 	self:MakeNewGranny(modelid)
 	=

 	self:StartMainLoop()
 end
 =

 =

-function cDebugGrannyMenu:MakeNewGranny (artid) =

-	print("=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D MakeNewGranny")
-	local filepath =3D GetGrannyFilePath(artid)
-	print("granny path for artid",artid,filepath)
-	local grn =3D cGrannyFile:New()
-	grn:LoadFile(filepath)
-	grn:XMLDump("../mygranny.xml") =

-end
 	=

 function cDebugGrannyMenu:MakeOldGranny (artid) =

 	local mobile =3D {artid=3Dartid}
@@ -133,3 +122,32 @@
 	-- todo : stitchin ? gStitchinLoader[oldelement.modelid] ..
 end
 	=

+
+function cDebugGrannyMenu:MakeNewGranny (artid) =

+	print("=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D MakeNewGranny")
+	local filepath =3D GetGrannyFilePath(artid)
+	print("granny path for artid",artid,filepath)
+	local grn =3D cGrannyFile:New()
+	grn:LoadFile(filepath)
+	grn:XMLDump("../mygranny.xml") =

+	=

+	function MyGetChunkT (iChunkType) return iChunkType and grn.kTypeNames[iC=
hunkType] or nil end
+	function MyDump (obj) =

+		print("dump:",obj,MyGetChunkT(obj.miChunkType or obj.iChunkType))
+		for k,v in pairs(obj) do print(" ",k,v,MyGetChunkT(v and type(v) =3D=3D =
"table" and v.iChunkType)) end
+	end
+	function GetByField (arr,fieldname,search) for k,obj in pairs(arr) do if =
(obj[fieldname] =3D=3D search) then return obj end end end
+	=

+	-- MainChunk/Object=3D2/mesh_list/mesh=3D1/point_block/point_container=3D=
1/points/list_points
+	--~ local points =3D grn:GetPath("MainChunk/Object/mesh_list/mesh/point_b=
lock/point_container/points/list_points")
+	--~ local points =3D grn:Path().MainChunk.Object.mesh_list.mesh.point_blo=
ck.point_container.points.list_points -- metatable,selfmod?
+	MyDump(GetByField(GetByField(	GetByField(grn.pMainChunk.childs[2].childs
+									,"iChunkType",grn.kTypeByName.mesh_list).childs[1].childs
+									,"iChunkType",grn.kTypeByName.point_block).childs[1].childs
+									,"iChunkType",grn.kTypeByName.points).list_points)
+	=

+	=

+	=

+	os.exit(0)
+end
+

Modified: trunk/lua/lib.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.lua (original)
+++ trunk/lua/lib.granny.lua Tue Nov 17 20:59:13 2009
@@ -77,6 +77,24 @@
     end
 end
 =

+
+function GrannyTest3DData ()
+    local bodyid =3D 400 -- human male
+	if (not GetGrannyModelInfo(bodyid)) then =

+		GrannyShowNo3DDataError(bodyid)
+		gGrannyLoaderType =3D false
+		gGrannyLoader =3D false
+	end
+end
+function GrannyShowNo3DDataError (bodyid)
+	if (gGrannyNo3DDataErrorShown) then return end
+	gGrannyNo3DDataErrorShown =3D true
+	LugreMessageBox(kLugreMessageBoxType_Ok,	"No 3D Data in UO-dir",
+												"Iris couldn't find 3D Character Models in your UO folder (bod=
yid:"..(bodyid or "startup-check")..").\n"..
+												"To fix this, you should install Ultima Online Mondains Legacy=
 using one of the installers on the iris2.de website.\n"..
+												"The installer on the original UO-Website will not work as the=
 data was removed because the original 3D-Mode is no longer supported.")
+end
+
 -- retrieves or creates a skeleton and fills it with bones from the first =
animation
 -- local skeleton =3D GetOrCreateSkeleton(bodyid)
 -- create the skeleton before creating any entities of this bodyid
@@ -86,7 +104,8 @@
     --if (bodyid =3D=3D 401) then bodyid =3D 400 end
 	bodyid =3D GrannyOverride(bodyid)
     local modelinfo =3D GetGrannyModelInfo(bodyid)
-
+	=

+	if (not modelinfo) then GrannyShowNo3DDataError(bodyid) return end
     assert(modelinfo,"ERROR bodyinfo for skeleton not found "..tostring(bo=
dyid))
 =

     while (modelinfo.animid ~=3D 0) do modelinfo =3D GetGrannyModelInfo(mo=
delinfo.animid) end

Modified: trunk/lua/lib.granny.types.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.types.lua (original)
+++ trunk/lua/lib.granny.types.lua Tue Nov 17 20:59:13 2009
@@ -189,4 +189,5 @@
 	self.kTypeNames[0xCA5E1205] =3D "animation_list"
 =

 	self.kTypeNames[0xCA5Effff] =3D "end" =

+	self.kTypeByName =3D FlipTable(self.kTypeNames)
 end

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Tue Nov 17 20:59:13 2009
@@ -314,7 +314,7 @@
         if (not file_exists(CorrectPath(Addfilepath(gArtFile)))) then
             gUOPath =3D gRegistry:Get("gUOPath")
             if ((not gUOPath) or (not file_exists(CorrectPath(Addfilepath(=
gArtFile))))) then
-                gUOPath =3D FileOpenDialog("..","*","Select a FILE in your=
 Ultima-Online Folder")
+                gUOPath =3D FileOpenDialog("..","map0.mul","Select the map=
0.mul in your Ultima-Online Folder")
                 if (gUOPath) then =

                     gUOPath =3D string.gsub(gUOPath,"\\","/") =

                     gUOPath =3D string.gsub(gUOPath,"/[^/]+$","/") =

@@ -332,6 +332,7 @@
     if (gCurrentRenderer =3D=3D Renderer3D and (not file_exists( CorrectGr=
annyPath(gGrannyConfigFile) ))) then
         gCurrentRenderer =3D Renderer2D
         print("WARNING ! using 2d mode because Iris2 could not find 3d cha=
racter models in your uo dir (try the ML/Mondains legacy installer linked o=
n http://iris2.de)")
+		GrannyShowNo3DDataError()
     end
 end
 =




From no-reply at zwischenwelt.org  Tue Nov 17 22:39:55 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 17 Nov 2009 21:39:55 -0000
Subject: [Iris-commit] [IRIS] r3146 - /trunk/lua/lib.granny.lua
Message-ID: <20091117213957.8FDCF7A98130@simon>

Author: ghoulsblade
Date: Tue Nov 17 22:39:53 2009
New Revision: 3146

Log:
improved 3d-char-models not found warning text a bit

Modified:
    trunk/lua/lib.granny.lua

Modified: trunk/lua/lib.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.lua (original)
+++ trunk/lua/lib.granny.lua Tue Nov 17 22:39:53 2009
@@ -80,19 +80,24 @@
 =

 function GrannyTest3DData ()
     local bodyid =3D 400 -- human male
-	if (not GetGrannyModelInfo(bodyid)) then =

+    local modelinfo =3D GetGrannyModelInfo(bodyid)
+	if (not modelinfo) then =

 		GrannyShowNo3DDataError(bodyid)
 		gGrannyLoaderType =3D false
 		gGrannyLoader =3D false
+		print("GrannyTest3DData:fail")
+	else
+		print("GrannyTest3DData:ok",SmartDump(modelinfo))
 	end
 end
 function GrannyShowNo3DDataError (bodyid)
 	if (gGrannyNo3DDataErrorShown) then return end
 	gGrannyNo3DDataErrorShown =3D true
-	LugreMessageBox(kLugreMessageBoxType_Ok,	"No 3D Data in UO-dir",
+	LugreMessageBox(kLugreMessageBoxType_Ok,	"No 3D Character Models found in=
 UO-dir",
 												"Iris couldn't find 3D Character Models in your UO folder (bod=
yid:"..(bodyid or "startup-check")..").\n"..
 												"To fix this, you should install Ultima Online Mondains Legacy=
 using one of the installers on the iris2.de website.\n"..
-												"The installer on the original UO-Website will not work as the=
 data was removed because the original 3D-Mode is no longer supported.")
+												"The installer on the original UO website will not work as the=
 data was removed because the original 3D-Mode is no longer supported.\n"..
+												"Patching the UO-Client up does not remove the 3D Character Mo=
dels")
 end
 =

 -- retrieves or creates a skeleton and fills it with bones from the first =
animation



From no-reply at zwischenwelt.org  Tue Nov 17 23:06:55 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 17 Nov 2009 22:06:55 -0000
Subject: [Iris-commit] [IRIS] r3147 - /trunk/lua/main.lua
Message-ID: <20091117220655.1861B7A98130@simon>

Author: ghoulsblade
Date: Tue Nov 17 23:06:54 2009
New Revision: 3147

Log:
removed old global.reg , replaced by config/registry.xml

Modified:
    trunk/lua/main.lua

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Tue Nov 17 23:06:54 2009
@@ -312,7 +312,7 @@
     if (not file_exists(CorrectPath(Addfilepath(gArtFile)))) then
         gUOPath =3D gUOPath .. "/"  -- append slash and try again
         if (not file_exists(CorrectPath(Addfilepath(gArtFile)))) then
-            gUOPath =3D gRegistry:Get("gUOPath")
+            gUOPath =3D gRegistrySlow:Get("gUOPath")
             if ((not gUOPath) or (not file_exists(CorrectPath(Addfilepath(=
gArtFile))))) then
                 gUOPath =3D FileOpenDialog("..","map0.mul","Select the map=
0.mul in your Ultima-Online Folder")
                 if (gUOPath) then =

@@ -323,7 +323,7 @@
                 if ((not gUOPath) or (not file_exists(CorrectPath(Addfilep=
ath(gArtFile))))) then
                     FatalErrorMessage(sprintf("Iris2 couldn't find your Ul=
tima-Online Folder (searchpath : %s),\n please set gUOPath in config/config=
.lua",gUOPath or "??"))
                 else =

-                    gRegistry:Set("gUOPath",gUOPath)
+                    gRegistrySlow:Set("gUOPath",gUOPath)
                 end
             end
         end
@@ -398,8 +398,6 @@
 	end
     if (gCommandLineSwitches["-grannytest"]) then GrannyTest_PreOgreInit()=
 end
 	if (OgreWrapperSetEnableUnicode) then OgreWrapperSetEnableUnicode(true) e=
nd -- ois init param
-	=

-    gRegistry =3D cRegistry:New(gTempPath.."global.reg")
 =

     -- detect UOPath
     if (not gUOPath) then AutoDetectUOPath() end
@@ -510,9 +508,6 @@
     NotifyListener("Hook_Terminate")
 	local t2 =3D Client_GetTicks()
 	print("Hook_Terminate:",t2-t1)
-    gRegistry:Destroy() gRegistry =3D nil
-	local t3 =3D Client_GetTicks()
-	print("gRegistry:Destroy:",t3-t2)
 	=

 	-- avoid ogre shutdown crash, so users aren't scared by weird error messa=
ge after closing iris
 	os.exit(0)



From no-reply at zwischenwelt.org  Tue Nov 17 23:34:35 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 17 Nov 2009 22:34:35 -0000
Subject: [Iris-commit] [IRIS] r3148 - in /trunk/lua: lib.granny.debug.lua
 lib.granny.loader.lua lib.granny.types.lua
Message-ID: <20091117223435.6E0EC7A98130@simon>

Author: ghoulsblade
Date: Tue Nov 17 23:34:35 2009
New Revision: 3148

Log:
new granny loader : added path-like access to child-hierarchy

Modified:
    trunk/lua/lib.granny.debug.lua
    trunk/lua/lib.granny.loader.lua
    trunk/lua/lib.granny.types.lua

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Tue Nov 17 23:34:35 2009
@@ -133,18 +133,22 @@
 	=

 	function MyGetChunkT (iChunkType) return iChunkType and grn.kTypeNames[iC=
hunkType] or nil end
 	function MyDump (obj) =

-		print("dump:",obj,MyGetChunkT(obj.miChunkType or obj.iChunkType))
+		print("dump:",obj,MyGetChunkT(obj.iChunkType))
 		for k,v in pairs(obj) do print(" ",k,v,MyGetChunkT(v and type(v) =3D=3D =
"table" and v.iChunkType)) end
 	end
 	function GetByField (arr,fieldname,search) for k,obj in pairs(arr) do if =
(obj[fieldname] =3D=3D search) then return obj end end end
 	=

+	=

+		=

+	=

 	-- MainChunk/Object=3D2/mesh_list/mesh=3D1/point_block/point_container=3D=
1/points/list_points
-	--~ local points =3D grn:GetPath("MainChunk/Object/mesh_list/mesh/point_b=
lock/point_container/points/list_points")
-	--~ local points =3D grn:Path().MainChunk.Object.mesh_list.mesh.point_blo=
ck.point_container.points.list_points -- metatable,selfmod?
-	MyDump(GetByField(GetByField(	GetByField(grn.pMainChunk.childs[2].childs
-									,"iChunkType",grn.kTypeByName.mesh_list).childs[1].childs
-									,"iChunkType",grn.kTypeByName.point_block).childs[1].childs
-									,"iChunkType",grn.kTypeByName.points).list_points)
+	--~ local points =3D GetByField(GetByField(	GetByField(grn.pMainChunk.chi=
lds[2].childs
+									--~ ,"iChunkType",grn.kTypeByName.mesh_list).childs[1].childs
+									--~ ,"iChunkType",grn.kTypeByName.point_block).childs[1].childs
+									--~ ,"iChunkType",grn.kTypeByName.points)
+	local points =3D grn:GetData("Object/mesh_list/mesh/point_block/point_con=
tainer/points")
+	--~ local points =3D grn:Data().Object.mesh_list.mesh.point_block.point_c=
ontainer.points -- metatable,selfmod? metatables for all subobj?
+	MyDump(points) -- .list_points
 	=

 	=

 	=


Modified: trunk/lua/lib.granny.loader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.loader.lua (original)
+++ trunk/lua/lib.granny.loader.lua Tue Nov 17 23:34:35 2009
@@ -39,9 +39,6 @@
 function StartGrannyTest () =

 	=

 end
-
-
-function cGrannyFile:New (...) return CreateClassInstance(self,...) end
 =

 function cGrannyFile:LoadFile (filepath) =

 	print("cGrannyFile:LoadFile",filepath)
@@ -55,9 +52,22 @@
 	self.fifo =3D nil
 end
 =

+--~ local points =3D grn:GetData("Object/mesh_list/mesh/point_block/point_=
container/points").list_points
+function cGrannyFile:GetData (path,pStart) =

+	pStart =3D pStart or self.pMainChunk
+	for typename in string.gmatch(path, "[^/]+") do
+		local typeid =3D self.kTypeByName[typename]
+		print(typeid,typename)
+		local found
+		for k,obj in pairs(pStart.childs) do if (obj.iChunkType =3D=3D typeid) t=
hen found =3D obj break end end
+		if (not found) then return nil end
+		pStart =3D found
+	end
+	return pStart
+end
 =

 function cGrannyFile:XMLDump (filepath) =

-	local ignoredkeys =3D { childs=3Dtrue,hexdump=3Dtrue,iChunkType=3Dtrue,mi=
ChunkType=3Dtrue,childsleft=3Dtrue,iChildren=3Dtrue,iOffset=3Dtrue }
+	local ignoredkeys =3D { childs=3Dtrue,hexdump=3Dtrue,iChunkType=3Dtrue,ch=
ildsleft=3Dtrue,iChildren=3Dtrue,iOffset=3Dtrue }
 	--~ function MyDumpObjList (node,k,v) for k2,obj in pairs(v) do XMLNodeAd=
dChild(node,{name=3Dk,attr=3D{bla=3DSmartDump(obj)}}) end end
 	function MyToString (v)
 		if (type(v) =3D=3D "table") then
@@ -138,7 +148,7 @@
 		end
 		if (obj.childs) then =

 			for k,v in ipairs(obj.childs) do =

-				local chunktype =3D v.iChunkType or v.miChunkType
+				local chunktype =3D v.iChunkType
 				local name =3D (chunktype and (self.kTypeNames[chunktype] or ("unknown=
_"..hex(chunktype)))) or "unknown"
 				XMLNodeAddChild(node,MyNode(name,v))
 			end
@@ -183,7 +193,7 @@
 	pMainChunk.childs =3D {}
 	=

 	--~ print("cGrannyFile:Parse:pMainChunk",SmartDump(pMainChunk))
-	assert(pMainChunk.miChunkType =3D=3D self.kChunkType_Main,"unexpected chu=
nktype:"..hex(pMainChunk.miChunkType))
+	assert(pMainChunk.iChunkType =3D=3D self.kChunkType_Main,"unexpected chun=
ktype:"..hex(pMainChunk.iChunkType))
 	self:Visit("MainChunk",pMainChunk,0)
 	=

 	local p =3D self.size.MainChunk
@@ -201,14 +211,14 @@
 		end
 		assert(pChunkDataEnd <=3D pFileEnd,"ParseGranny : illegal offset")
 		=

-		local t =3D pItemList.miChunkType
+		local t =3D pItemList.iChunkType
 		if (t =3D=3D 0xCA5E0100 or		-- SiENcE:  Chunk is new to ML/SE Models may=
be Texture: case 0xca5e0100 =

 			t =3D=3D 0xCA5E0101 or      -- Final Chunk (End-of-File?)	=

 			t =3D=3D 0xCA5E0102 or      -- Copyright Chunk
 			t =3D=3D 0xCA5E0103) then   -- Object Chunk
 			self:ParseItemListData(pItemList,pChunkDataStart,pChunkDataEnd-pChunkDa=
taStart);
 		else
-			assert(false,"ParseGranny : unknown subchunktype : "..hex(pItemList.miC=
hunkType))
+			assert(false,"ParseGranny : unknown subchunktype : "..hex(pItemList.iCh=
unkType))
 		end
 	end
 	self:Visit("EOF")

Modified: trunk/lua/lib.granny.types.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.types.lua (original)
+++ trunk/lua/lib.granny.types.lua Tue Nov 17 23:34:35 2009
@@ -19,13 +19,13 @@
 	=

 	self.structs.MainChunk =3D {
 		{uint8	,"mHeader",0x40};	--/< unknown, Could be FileType magic
-		{uint32	,"miChunkType"},	--/< kChunkType
+		{uint32	,"iChunkType"},		--/< kChunkType
 		{uint32	,"miChildCount"},
 		{uint32	,"miUnknown",6},	--/< CRC?
 	}
 =

 	self.structs.ItemList =3D {
-		{uint32	,"miChunkType"},
+		{uint32	,"iChunkType"},
 		{uint32	,"miUnknown1"},
 		{uint32	,"miListOffset"},
 		{uint32	,"miUnknown2",2},



From no-reply at zwischenwelt.org  Wed Nov 18 00:03:23 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 17 Nov 2009 23:03:23 -0000
Subject: [Iris-commit] [IRIS] r3149 - in /trunk/lua: lib.granny.debug.lua
 lib.granny.loader.lua lib.granny.types.lua
Message-ID: <20091117230323.68A347A98130@simon>

Author: ghoulsblade
Date: Wed Nov 18 00:03:23 2009
New Revision: 3149

Log:
grannyloader : metatable to allow comfortable path-like data access, granny=
 types,structs and enums defined statically instead of copying for every ob=
ject

Modified:
    trunk/lua/lib.granny.debug.lua
    trunk/lua/lib.granny.loader.lua
    trunk/lua/lib.granny.types.lua

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Wed Nov 18 00:03:23 2009
@@ -129,28 +129,18 @@
 	print("granny path for artid",artid,filepath)
 	local grn =3D cGrannyFile:New()
 	grn:LoadFile(filepath)
-	grn:XMLDump("../mygranny.xml") =

+	--~ grn:XMLDump("../mygranny.xml") =

 	=

 	function MyGetChunkT (iChunkType) return iChunkType and grn.kTypeNames[iC=
hunkType] or nil end
 	function MyDump (obj) =

-		print("dump:",obj,MyGetChunkT(obj.iChunkType))
+		print("dump:",obj,MyGetChunkT(obj and obj.iChunkType))
 		for k,v in pairs(obj) do print(" ",k,v,MyGetChunkT(v and type(v) =3D=3D =
"table" and v.iChunkType)) end
 	end
-	function GetByField (arr,fieldname,search) for k,obj in pairs(arr) do if =
(obj[fieldname] =3D=3D search) then return obj end end end
 	=

-	=

-		=

-	=

-	-- MainChunk/Object=3D2/mesh_list/mesh=3D1/point_block/point_container=3D=
1/points/list_points
-	--~ local points =3D GetByField(GetByField(	GetByField(grn.pMainChunk.chi=
lds[2].childs
-									--~ ,"iChunkType",grn.kTypeByName.mesh_list).childs[1].childs
-									--~ ,"iChunkType",grn.kTypeByName.point_block).childs[1].childs
-									--~ ,"iChunkType",grn.kTypeByName.points)
-	local points =3D grn:GetData("Object/mesh_list/mesh/point_block/point_con=
tainer/points")
-	--~ local points =3D grn:Data().Object.mesh_list.mesh.point_block.point_c=
ontainer.points -- metatable,selfmod? metatables for all subobj?
-	MyDump(points) -- .list_points
-	=

-	=

+	--~ MyDump(grn.pMainChunk.Object.mesh_list.mesh)
+	local list_points =3D grn.pMainChunk.Object.mesh_list.mesh.point_block.po=
int_container.points.list_points
+	print("#points:",#list_points)
+	for k,entry in ipairs(list_points) do print(k,entry.x,entry.y,entry.z) if=
 (k>10) then print("...") break end end
 	=

 	os.exit(0)
 end

Modified: trunk/lua/lib.granny.loader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.loader.lua (original)
+++ trunk/lua/lib.granny.loader.lua Wed Nov 18 00:03:23 2009
@@ -52,19 +52,13 @@
 	self.fifo =3D nil
 end
 =

---~ local points =3D grn:GetData("Object/mesh_list/mesh/point_block/point_=
container/points").list_points
-function cGrannyFile:GetData (path,pStart) =

-	pStart =3D pStart or self.pMainChunk
-	for typename in string.gmatch(path, "[^/]+") do
-		local typeid =3D self.kTypeByName[typename]
-		print(typeid,typename)
-		local found
-		for k,obj in pairs(pStart.childs) do if (obj.iChunkType =3D=3D typeid) t=
hen found =3D obj break end end
-		if (not found) then return nil end
-		pStart =3D found
-	end
-	return pStart
-end
+-- allow access like grn.pMainChunk.Object.mesh_list.mesh.point_block.poin=
t_container.points.list_points  =

+function cGrannyFile:MetaIndex (typename) =

+	local typeid =3D cGrannyFile.kTypeByName[typename]
+	--~ print("cGrannyFile:MetaIndex",self,typename,typeid) =

+	if (typeid) then for k,obj in ipairs(self.childs) do if (obj.iChunkType =
=3D=3D typeid) then return obj end end end -- self is not a cGrannyFile here
+end
+cGrannyFile.pItemMetaTable =3D { __index =3D cGrannyFile.MetaIndex }
 =

 function cGrannyFile:XMLDump (filepath) =

 	local ignoredkeys =3D { childs=3Dtrue,hexdump=3Dtrue,iChunkType=3Dtrue,ch=
ildsleft=3Dtrue,iChildren=3Dtrue,iOffset=3Dtrue }
@@ -165,7 +159,7 @@
 	local structsize =3D self.size[structname] assert(structsize)
 	assert(offset >=3D 0,"AssertSize : negative offset : "..offset)
 	local missing =3D offset+structsize - self.miBufSize assert(missing <=3D =
0,"AssertSize : buffer too small, expected "..missing.." more bytes")
-	local res =3D {}
+	local res =3D setmetatable({},cGrannyFile.pItemMetaTable)
 	local struct =3D self.structs[structname]
 	for k,memberdef in ipairs(struct) do =

 		local basetype,name,arraysize =3D unpack(memberdef)
@@ -187,7 +181,6 @@
 	self.fifo =3D fifo
 	self.miBufSize =3D fifo:Size()
 	self.quickfifo =3D fifo:GetQuickHandle()
-	self:DefineTypes()
 	local pMainChunk =3D self:Read(0,"MainChunk")
 	self.pMainChunk =3D pMainChunk
 	pMainChunk.childs =3D {}
@@ -277,7 +270,7 @@
 		local myoffset =3D pItemList.miListOffset+iOffset
 		assert(myoffset <=3D miBufSize)
 		=

-		local chunk =3D {iChunkType=3DiChunkType,iOffset=3DiOffset,iChildren=3Di=
Children} -- ,iChildSize=3DiChildSize
+		local chunk =3D setmetatable({iChunkType=3DiChunkType,iOffset=3DiOffset,=
iChildren=3DiChildren},cGrannyFile.pItemMetaTable) -- ,iChildSize=3DiChildS=
ize
 		local handler =3D self.chunkHandlers[iChunkType]
 		if (handler) then =

 			handler(self,myoffset,iChildSize,chunk) =


Modified: trunk/lua/lib.granny.types.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.types.lua (original)
+++ trunk/lua/lib.granny.types.lua Wed Nov 18 00:03:23 2009
@@ -1,10 +1,9 @@
 =

 =

-function cGrannyFile:DefineTypes () =

-	if (self.structs) then return end
-	self.kChunkType_Main =3D 0xCA5E0000
-	self:DefineStructs()
-	self:DefineTypeNames()
+function GrannyFile_Global_DefineTypes () =

+	cGrannyFile.kChunkType_Main =3D 0xCA5E0000
+	cGrannyFile:DefineStructs()
+	cGrannyFile:DefineTypeNames()
 end
 =

 function cGrannyFile:DefineStructs ()
@@ -191,3 +190,5 @@
 	self.kTypeNames[0xCA5Effff] =3D "end" =

 	self.kTypeByName =3D FlipTable(self.kTypeNames)
 end
+
+GrannyFile_Global_DefineTypes()



From no-reply at zwischenwelt.org  Wed Nov 18 00:41:12 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 17 Nov 2009 23:41:12 -0000
Subject: [Iris-commit] [IRIS] r3150 - /trunk/lua/lib.granny.debug.lua
Message-ID: <20091117234112.47F6454D0039@simon>

Author: ghoulsblade
Date: Wed Nov 18 00:41:12 2009
New Revision: 3150

Log:
experiments with new granny loader path syntax

Modified:
    trunk/lua/lib.granny.debug.lua

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Wed Nov 18 00:41:12 2009
@@ -138,10 +138,128 @@
 	end
 	=

 	--~ MyDump(grn.pMainChunk.Object.mesh_list.mesh)
-	local list_points =3D grn.pMainChunk.Object.mesh_list.mesh.point_block.po=
int_container.points.list_points
-	print("#points:",#list_points)
-	for k,entry in ipairs(list_points) do print(k,entry.x,entry.y,entry.z) if=
 (k>10) then print("...") break end end
-	=

+	local mesh =3D grn.pMainChunk.Object.mesh_list.mesh
+	local point_container =3D mesh.point_block.point_container
+	for k,entry in ipairs(point_container.points.list_points) do if (k<=3D3) =
then print("point",k,SmartDump(entry)) end end
+	for k,entry in ipairs(point_container.normals.list_normals) do if (k<=3D3=
) then print("normal",k,SmartDump(entry)) end end
+	print("texcoords:unknown:",point_container.texture_container.texcoords.un=
known)
+	for k,entry in ipairs(point_container.texture_container.texcoords.list_te=
xcoords) do if (k<=3D3) then print("texcoord",k,SmartDump(entry)) end end
+	=

+	print("weights:",SmartDump(mesh.weights))
+	for k,entry in ipairs(mesh.weights.list_weights) do if (k<=3D3) then prin=
t("weight",k,SmartDump(entry)) end end
+	for k,entry in ipairs(mesh.polygons.list_polygons) do if (k<=3D3) then pr=
int("polygon",k,SmartDump(entry)) end end
+	=

+	--[[
+		<Object miListOffset=3D"440" miUnknown1=3D"0">
+        <miUnknown2 1=3D"0" 0=3D"2149427081" />
+        <textChunk iNumEntries=3D"60" iTextLen=3D"856">
+            <texts>
+                <entry>__Standard</entry>
+                <entry>__FileName</entry>
+			..
+		</textChunk>
+        <object_list>
+            <object unknown_b=3D"1" unknown_a=3D"1">
+                <object_key_list>
+                    <object_key key=3D"2">
+                        <object_value_list>
+                            <object_value unknown_b=3D"3" unknown_a=3D"0" =
/>
+                        </object_value_list>
+                    </object_key>
+                    <object_key key=3D"4">
+                        <object_value_list>
+                            <object_value unknown_b=3D"5" unknown_a=3D"0" =
/>
+                        </object_value_list>
+                    </object_key>
+                    <object_key key=3D"6">
+                        <object_value_list>
+                            <object_value unknown_b=3D"0" unknown_a=3D"0" =
/>
+                        </object_value_list>
+                    </object_key>
+                </object_key_list>
+            </object>
+            <object unknown_b=3D"1" unknown_a=3D"1">...</object>
+			...
+        <boneTies1>
+            <boneobject>
+                <id iID=3D"1" />
+            </boneobject>
+            <boneobject>...</boneobject>
+			=

+		=

+		<mesh_list>
+			...
+        </mesh_list>
+        <bones>
+            <skeleton>
+                <bonelist>
+                    <bone>
+                        <bone fTranslate=3D"{[1]=3D0,[2]=3D0,[0]=3D0,}" iP=
arent=3D"0" fMatrix=3D"{[1]=3D0,[2]=3D0,[3]=3D0,[4]=3D1,[5]=3D0,[6]=3D0,[7]=
=3D0,[8]=3D1,[0]=3D1,}" fQuaternion=3D"{[1]=3D0,[2]=3D0,[3]=3D1,[0]=3D0,}" =
/>
+                    </bone>
+                    <bone>
+                        <bone fTranslate=3D"{[1]=3D0,[2]=3D0,[0]=3D0,}" iP=
arent=3D"0" fMatrix=3D"{[1]=3D0,[2]=3D0,[3]=3D0,[4]=3D1,[5]=3D0,[6]=3D0,[7]=
=3D0,[8]=3D1,[0]=3D1,}" fQuaternion=3D"{[1]=3D0,[2]=3D0,[3]=3D1,[0]=3D0,}" =
/>
+                    </bone>
+			...
+		</bones>
+        <texture_info_list>
+            <texture_info>
+                <unknown_0xca5e0305>
+                    <texinfo>
+                        <texinfo iWidth=3D"256" iHeight=3D"256" iDepth=3D"=
7" />
+                    </texinfo>
+                </unknown_0xca5e0305>
+                <id iID=3D"3" />
+            </texture_info>
+        </texture_info_list>
+        <unhandled_0d01>
+            <unknown_0xca5e0d00>
+                <unknown_0xca5e0d03>
+                    <hexdump offset=3D"92132" len=3D"12" />
+                </unknown_0xca5e0d03>
+                <id iID=3D"53" />
+            </unknown_0xca5e0d00>
+        </unhandled_0d01>
+        <boneTies2>
+            <boneties_container>
+                <bone_objptrs_container>
+                    <bone_objptr iBoneTie2ID=3D"1">
+                        <bone_objptrs iNum=3D"51">
+                            <BoneTies2 43=3D"1" 51=3D"37" 41=3D"2" 47=3D"2=
5" 37=3D"19" 45=3D"21" 35=3D"43" 49=3D"47" 39=3D"6" 29=3D"50" 1=3D"18" 3=3D=
"5" 2=3D"30" 5=3D"14" 4=3D"35" 7=3D"40" 6=3D"16" 9=3D"3" 8=3D"27" 27=3D"41"=
 17=3D"46" 13=3D"45" 21=3D"12" 11=3D"20" 23=3D"11" 42=3D"15" 40=3D"28" 50=
=3D"36" 36=3D"32" 46=3D"17" 34=3D"9" 44=3D"44" 48=3D"48" 28=3D"51" 38=3D"31=
" 33=3D"10" 32=3D"8" 31=3D"22" 30=3D"33" 15=3D"23" 18=3D"26" 19=3D"29" 25=
=3D"49" 14=3D"4" 24=3D"24" 16=3D"42" 26=3D"7" 20=3D"13" 12=3D"34" 22=3D"38"=
 10=3D"39" />
+                        </bone_objptrs>
+                        <end_bone_objptrs />
+                    </bone_objptr>
+                </bone_objptrs_container>
+                <bonetie_container>
+                    <bonetie_group iBoneTie2GroupID=3D"1">
+                        <bonetie_data />
+                        <bonetie_list>
+                            <bonetie>
+                                <bonetie iBone=3D"3" iUnknown=3D"{[1]=3D-7=
9.053795,[2]=3D-10.501988,[3]=3D-28.238644,[4]=3D78.682823,[5]=3D90.721489,=
[6]=3D107.114021,[0]=3D107.116005,}" />
+                            </bonetie>
+                            <bonetie>
+                                <bonetie iBone=3D"4" iUnknown=3D"{[1]=3D-7=
2.256584,[2]=3D-53.965584,[3]=3D-3.319712,[4]=3D93.162865,[5]=3D73.596008,[=
6]=3D98.508713,[0]=3D117.996071,}" />
+                            </bonetie>
+			...
+        </boneTies2>
+        <texture_list>
+            <texture iTextureID=3D"1">
+                <texture_sublist>
+                    <texture_poly>
+                        <iTexturePoly a=3D"0" b=3D"1" />
+                        <texture_poly_datalist>
+                            <texture_poly_data2>
+                                <hexdump offset=3D"93204" len=3D"12" />
+                            </texture_poly_data2>
+                            <texture_poly_data1 iTexturePolyData=3D"0" />
+                        </texture_poly_datalist>
+                        <texture_poly_list iElementSize=3D"16" iNum=3D"110=
2">
+                            <list_texpoly_normal>
+                                <entry iUnknown=3D"0" iTexCoord=3D"{[1]=3D=
724=3D0x02d4,[2]=3D736=3D0x02e0,[0]=3D723=3D0x02d3,}" />
+                                <entry iUnknown=3D"1" iTexCoord=3D"{[1]=3D=
734=3D0x02de,[2]=3D723=3D0x02d3,[0]=3D735=3D0x02df,}" />
+			...
+			=

+	]]--
+					=

 	os.exit(0)
 end
 =




From no-reply at zwischenwelt.org  Wed Nov 18 22:51:54 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 18 Nov 2009 21:51:54 -0000
Subject: [Iris-commit] [IRIS] r3151 - /trunk/bin/iris2.exe
Message-ID: <20091118215155.6501A7A9813B@simon>

Author: sience
Date: Wed Nov 18 22:51:41 2009
New Revision: 3151

Log:
-new win32 binary

Modified:
    trunk/bin/iris2.exe

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Wed Nov 18 22:54:16 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 18 Nov 2009 21:54:16 -0000
Subject: [Iris-commit] [IRIS] r3152 - /branches/stable_release/
Message-ID: <20091118215416.A5A337A9813B@simon>

Author: ghoulsblade
Date: Wed Nov 18 22:53:53 2009
New Revision: 3152

Log:
removing stable for trunk -> stable update

Removed:
    branches/stable_release/



From no-reply at zwischenwelt.org  Wed Nov 18 22:54:17 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 18 Nov 2009 21:54:17 -0000
Subject: [Iris-commit] [IRIS] r3153 - /branches/stable_release/
Message-ID: <20091118215417.5BE927A9813B@simon>

Author: ghoulsblade
Date: Wed Nov 18 22:54:17 2009
New Revision: 3153

Log:
copying trunk to stable

Added:
    branches/stable_release/
      - copied from r3152, trunk/



From no-reply at zwischenwelt.org  Wed Nov 18 22:54:17 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 18 Nov 2009 21:54:17 -0000
Subject: [Iris-commit] [IRIS] r3154 - /branches/stable_release/
Message-ID: <20091118215417.B43DA7A9813B@simon>

Author: ghoulsblade
Date: Wed Nov 18 22:54:17 2009
New Revision: 3154

Log:
lugre -r770 svn://zwischenwelt.org/lugre/trunk/lugre

Modified:
    branches/stable_release/   (props changed)



From no-reply at zwischenwelt.org  Thu Nov 19 17:52:49 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 19 Nov 2009 16:52:49 -0000
Subject: [Iris-commit] [IRIS] r3155 - in /trunk/lua: lib.gfxconfig.lua
 lib.granny.debug.lua lib.granny.loader.lua
Message-ID: <20091119165256.42ED57A9812B@simon>

Author: ghoulsblade
Date: Thu Nov 19 17:52:48 2009
New Revision: 3155

Log:
gfxconfig : fix for direct3d9 anti-alias default value, grannydebug: loadin=
g and outputting a bunch of data with new path access succeeded

Modified:
    trunk/lua/lib.gfxconfig.lua
    trunk/lua/lib.granny.debug.lua
    trunk/lua/lib.granny.loader.lua

Modified: trunk/lua/lib.gfxconfig.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gfxconfig.lua (original)
+++ trunk/lua/lib.gfxconfig.lua Thu Nov 19 17:52:48 2009
@@ -8,6 +8,10 @@
 =

 function GfxConfig_ListPossibleRenderSystems	() return {Ogre_ListRenderSys=
tems()} end
 function GfxConfig_ListPossibleResolutions		() return {Ogre_ListPossibleVa=
luesForConfigOption("","Video Mode")} end
+function GfxConfig_ListPossibleAntiAliasing		() =

+	local a =3D {Ogre_ListPossibleValuesForConfigOption("","Anti aliasing")} =
 if (#a > 0) then return a end
+	return {Ogre_ListPossibleValuesForConfigOption("","FSAA")} =

+end
 function GfxConfig_FindFromList 				(list,pattern) for k,v in ipairs(list)=
 do if (string.find(string.lower(v),pattern)) then return v end end end
 =

 function GfxConfig_FindDefaultRenderSystem ()
@@ -28,6 +32,15 @@
 					GfxConfig_FindFromList(list,cx..".+"..cy) or =

 					list[#list]
 	print("GfxConfig_FindResolution",best,cx,cy)
+	return best
+end
+function GfxConfig_FindDefaultAntiAliasing ()
+	local list =3D	GfxConfig_ListPossibleAntiAliasing()
+	print("################## fsaa:",SmartDump(list))
+	local best =3D	GfxConfig_FindFromList(list,"none") or -- d3d9 :  "None","=
NonMaskable 1", ... "Level 2"
+					GfxConfig_FindFromList(list,"0") or  -- opengl ?
+					list[#list]
+	print("GfxConfig_FindDefaultAntiAliasing",best)
 	return best
 end
 function GfxConfig_FindDefaultResolution ()
@@ -73,7 +86,7 @@
 	Ogre_SetRenderSystemByName(gGfxConfig_RenderSystem)
 	=

 	if (not gGfxConfig_Resolution) then gGfxConfig_Resolution =3D GfxConfig_F=
indDefaultResolution() end
-	if (not gGfxConfig_AntiAliasing) then gGfxConfig_AntiAliasing =3D "0" end
+	if (not gGfxConfig_AntiAliasing) then gGfxConfig_AntiAliasing =3D GfxConf=
ig_FindDefaultAntiAliasing() end
 	if (gGfxConfig_Fullscreen =3D=3D nil) then gGfxConfig_Fullscreen =3D fals=
e end
 	=

 	local resolution_override =3D false

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Thu Nov 19 17:52:48 2009
@@ -1,4 +1,5 @@
 --~ ./start.sh -sdg -res 640x480
+--~ ./start.sh -grannytest
 =

 cDebugGrannyMenu =3D CreateClass(cDebugMode)
 =

@@ -44,6 +45,7 @@
 =

 function StartDebugGrannyMenu () cDebugGrannyMenu:StartMenu() end
 =

+
 function cDebugGrannyMenu:StartMenu ()
 	gCurrentRenderer =3D Renderer3D   =

 	Load_Granny() -- needs Renderer3D
@@ -137,8 +139,11 @@
 		for k,v in pairs(obj) do print(" ",k,v,MyGetChunkT(v and type(v) =3D=3D =
"table" and v.iChunkType)) end
 	end
 	=

-	--~ MyDump(grn.pMainChunk.Object.mesh_list.mesh)
-	local mesh =3D grn.pMainChunk.Object.mesh_list.mesh
+	local Object =3D grn.pMainChunk.Object
+	for k,entry in ipairs(Object.textChunk.texts) do if (k<=3D3) then print("=
text",k,SmartDump(entry)) end end
+	=

+	--~ MyDump(Object.mesh_list.mesh)
+	local mesh =3D Object.mesh_list.mesh
 	local point_container =3D mesh.point_block.point_container
 	for k,entry in ipairs(point_container.points.list_points) do if (k<=3D3) =
then print("point",k,SmartDump(entry)) end end
 	for k,entry in ipairs(point_container.normals.list_normals) do if (k<=3D3=
) then print("normal",k,SmartDump(entry)) end end
@@ -158,6 +163,102 @@
                 <entry>__FileName</entry>
 			..
 		</textChunk>
+	]]--
+	--[[
+        <boneTies1>
+            <boneobject>
+                <id iID=3D"1" />
+            </boneobject>
+            <boneobject>...</boneobject>
+			=

+	]]--
+	for k,entry in ipairs(Object.boneTies1) do if (k<=3D3) then print("boneTi=
es1:boneobject",k,SmartDump(entry)) end end
+	--[[
+        <bones>
+            <skeleton>
+                <bonelist>
+                    <bone>
+                        <bone fTranslate=3D"{[1]=3D0,[2]=3D0,[0]=3D0,}" iP=
arent=3D"0" fMatrix=3D"{[1]=3D0,[2]=3D0,[3]=3D0,[4]=3D1,[5]=3D0,[6]=3D0,[7]=
=3D0,[8]=3D1,[0]=3D1,}" fQuaternion=3D"{[1]=3D0,[2]=3D0,[3]=3D1,[0]=3D0,}" =
/>
+                    </bone>
+                    <bone>
+                        <bone fTranslate=3D"{[1]=3D0,[2]=3D0,[0]=3D0,}" iP=
arent=3D"0" fMatrix=3D"{[1]=3D0,[2]=3D0,[3]=3D0,[4]=3D1,[5]=3D0,[6]=3D0,[7]=
=3D0,[8]=3D1,[0]=3D1,}" fQuaternion=3D"{[1]=3D0,[2]=3D0,[3]=3D1,[0]=3D0,}" =
/>
+                    </bone>
+			...
+		</bones>
+	]]--
+	for k,entry in ipairs(Object.bones.skeleton.bonelist) do if (k<=3D3) then=
 print("bone",k,SmartDump(entry)) end end
+	--[[
+        <texture_info_list>
+            <texture_info>
+                <unknown_0xca5e0305>
+                    <texinfo>
+                        <texinfo iWidth=3D"256" iHeight=3D"256" iDepth=3D"=
7" />
+                    </texinfo>
+                </unknown_0xca5e0305>
+                <id iID=3D"3" />
+            </texture_info>
+        </texture_info_list>
+	]]--
+	--[[
+        <unhandled_0d01>
+            <unknown_0xca5e0d00>
+                <unknown_0xca5e0d03>
+                    <hexdump offset=3D"92132" len=3D"12" />
+                </unknown_0xca5e0d03>
+                <id iID=3D"53" />
+            </unknown_0xca5e0d00>
+        </unhandled_0d01>
+	]]--
+	--[[
+        <boneTies2>
+            <boneties_container>
+                <bone_objptrs_container>
+                    <bone_objptr iBoneTie2ID=3D"1">
+                        <bone_objptrs iNum=3D"51">
+                            <BoneTies2 43=3D"1" 51=3D"37" 41=3D"2" 47=3D"2=
5" 37=3D"19" 45=3D"21" 35=3D"43" 49=3D"47" 39=3D"6" 29=3D"50" 1=3D"18" 3=3D=
"5" 2=3D"30" 5=3D"14" 4=3D"35" 7=3D"40" 6=3D"16" 9=3D"3" 8=3D"27" 27=3D"41"=
 17=3D"46" 13=3D"45" 21=3D"12" 11=3D"20" 23=3D"11" 42=3D"15" 40=3D"28" 50=
=3D"36" 36=3D"32" 46=3D"17" 34=3D"9" 44=3D"44" 48=3D"48" 28=3D"51" 38=3D"31=
" 33=3D"10" 32=3D"8" 31=3D"22" 30=3D"33" 15=3D"23" 18=3D"26" 19=3D"29" 25=
=3D"49" 14=3D"4" 24=3D"24" 16=3D"42" 26=3D"7" 20=3D"13" 12=3D"34" 22=3D"38"=
 10=3D"39" />
+                        </bone_objptrs>
+                        <end_bone_objptrs />
+                    </bone_objptr>
+                </bone_objptrs_container>
+                <bonetie_container>
+                    <bonetie_group iBoneTie2GroupID=3D"1">
+                        <bonetie_data />
+                        <bonetie_list>
+                            <bonetie>
+                                <bonetie iBone=3D"3" iUnknown=3D"{[1]=3D-7=
9.053795,[2]=3D-10.501988,[3]=3D-28.238644,[4]=3D78.682823,[5]=3D90.721489,=
[6]=3D107.114021,[0]=3D107.116005,}" />
+                            </bonetie>
+                            <bonetie>
+                                <bonetie iBone=3D"4" iUnknown=3D"{[1]=3D-7=
2.256584,[2]=3D-53.965584,[3]=3D-3.319712,[4]=3D93.162865,[5]=3D73.596008,[=
6]=3D98.508713,[0]=3D117.996071,}" />
+                            </bonetie>
+			...
+        </boneTies2>
+	]]--
+	for k,entry in ipairs(Object.boneTies2.boneties_container.bone_objptrs_co=
ntainer.bone_objptr) do if (k<=3D3) then print("bt2:bone_objptr",k,SmartDum=
p(entry)) end end
+	for k,entry in ipairs(Object.boneTies2.boneties_container.bonetie_contain=
er.bonetie_group.bonetie_list) do if (k<=3D3) then print("bt2:bonetie",k,Sm=
artDump(entry)) end end
+	--[[
+        <texture_list>
+            <texture iTextureID=3D"1">
+                <texture_sublist>
+                    <texture_poly>
+                        <iTexturePoly a=3D"0" b=3D"1" />
+                        <texture_poly_datalist>
+                            <texture_poly_data2>
+                                <hexdump offset=3D"93204" len=3D"12" />
+                            </texture_poly_data2>
+                            <texture_poly_data1 iTexturePolyData=3D"0" />
+                        </texture_poly_datalist>
+                        <texture_poly_list iElementSize=3D"16" iNum=3D"110=
2">
+                            <list_texpoly_normal>
+                                <entry iUnknown=3D"0" iTexCoord=3D"{[1]=3D=
724=3D0x02d4,[2]=3D736=3D0x02e0,[0]=3D723=3D0x02d3,}" />
+                                <entry iUnknown=3D"1" iTexCoord=3D"{[1]=3D=
734=3D0x02de,[2]=3D723=3D0x02d3,[0]=3D735=3D0x02df,}" />
+			...
+			=

+	]]--
+	for k,entry in ipairs(Object.texture_list.texture.texture_sublist.texture=
_poly.texture_poly_list.list_texpoly_normal) do if (k<=3D3) then print("lis=
t_texpoly_normal",k,SmartDump(entry)) end end
+	=

+	=

+	=

+	--[[
         <object_list>
             <object unknown_b=3D"1" unknown_a=3D"1">
                 <object_key_list>
@@ -180,86 +281,36 @@
             </object>
             <object unknown_b=3D"1" unknown_a=3D"1">...</object>
 			...
-        <boneTies1>
-            <boneobject>
-                <id iID=3D"1" />
-            </boneobject>
-            <boneobject>...</boneobject>
-			=

-		=

-		<mesh_list>
-			...
-        </mesh_list>
-        <bones>
-            <skeleton>
-                <bonelist>
-                    <bone>
-                        <bone fTranslate=3D"{[1]=3D0,[2]=3D0,[0]=3D0,}" iP=
arent=3D"0" fMatrix=3D"{[1]=3D0,[2]=3D0,[3]=3D0,[4]=3D1,[5]=3D0,[6]=3D0,[7]=
=3D0,[8]=3D1,[0]=3D1,}" fQuaternion=3D"{[1]=3D0,[2]=3D0,[3]=3D1,[0]=3D0,}" =
/>
-                    </bone>
-                    <bone>
-                        <bone fTranslate=3D"{[1]=3D0,[2]=3D0,[0]=3D0,}" iP=
arent=3D"0" fMatrix=3D"{[1]=3D0,[2]=3D0,[3]=3D0,[4]=3D1,[5]=3D0,[6]=3D0,[7]=
=3D0,[8]=3D1,[0]=3D1,}" fQuaternion=3D"{[1]=3D0,[2]=3D0,[3]=3D1,[0]=3D0,}" =
/>
-                    </bone>
-			...
-		</bones>
-        <texture_info_list>
-            <texture_info>
-                <unknown_0xca5e0305>
-                    <texinfo>
-                        <texinfo iWidth=3D"256" iHeight=3D"256" iDepth=3D"=
7" />
-                    </texinfo>
-                </unknown_0xca5e0305>
-                <id iID=3D"3" />
-            </texture_info>
-        </texture_info_list>
-        <unhandled_0d01>
-            <unknown_0xca5e0d00>
-                <unknown_0xca5e0d03>
-                    <hexdump offset=3D"92132" len=3D"12" />
-                </unknown_0xca5e0d03>
-                <id iID=3D"53" />
-            </unknown_0xca5e0d00>
-        </unhandled_0d01>
-        <boneTies2>
-            <boneties_container>
-                <bone_objptrs_container>
-                    <bone_objptr iBoneTie2ID=3D"1">
-                        <bone_objptrs iNum=3D"51">
-                            <BoneTies2 43=3D"1" 51=3D"37" 41=3D"2" 47=3D"2=
5" 37=3D"19" 45=3D"21" 35=3D"43" 49=3D"47" 39=3D"6" 29=3D"50" 1=3D"18" 3=3D=
"5" 2=3D"30" 5=3D"14" 4=3D"35" 7=3D"40" 6=3D"16" 9=3D"3" 8=3D"27" 27=3D"41"=
 17=3D"46" 13=3D"45" 21=3D"12" 11=3D"20" 23=3D"11" 42=3D"15" 40=3D"28" 50=
=3D"36" 36=3D"32" 46=3D"17" 34=3D"9" 44=3D"44" 48=3D"48" 28=3D"51" 38=3D"31=
" 33=3D"10" 32=3D"8" 31=3D"22" 30=3D"33" 15=3D"23" 18=3D"26" 19=3D"29" 25=
=3D"49" 14=3D"4" 24=3D"24" 16=3D"42" 26=3D"7" 20=3D"13" 12=3D"34" 22=3D"38"=
 10=3D"39" />
-                        </bone_objptrs>
-                        <end_bone_objptrs />
-                    </bone_objptr>
-                </bone_objptrs_container>
-                <bonetie_container>
-                    <bonetie_group iBoneTie2GroupID=3D"1">
-                        <bonetie_data />
-                        <bonetie_list>
-                            <bonetie>
-                                <bonetie iBone=3D"3" iUnknown=3D"{[1]=3D-7=
9.053795,[2]=3D-10.501988,[3]=3D-28.238644,[4]=3D78.682823,[5]=3D90.721489,=
[6]=3D107.114021,[0]=3D107.116005,}" />
-                            </bonetie>
-                            <bonetie>
-                                <bonetie iBone=3D"4" iUnknown=3D"{[1]=3D-7=
2.256584,[2]=3D-53.965584,[3]=3D-3.319712,[4]=3D93.162865,[5]=3D73.596008,[=
6]=3D98.508713,[0]=3D117.996071,}" />
-                            </bonetie>
-			...
-        </boneTies2>
-        <texture_list>
-            <texture iTextureID=3D"1">
-                <texture_sublist>
-                    <texture_poly>
-                        <iTexturePoly a=3D"0" b=3D"1" />
-                        <texture_poly_datalist>
-                            <texture_poly_data2>
-                                <hexdump offset=3D"93204" len=3D"12" />
-                            </texture_poly_data2>
-                            <texture_poly_data1 iTexturePolyData=3D"0" />
-                        </texture_poly_datalist>
-                        <texture_poly_list iElementSize=3D"16" iNum=3D"110=
2">
-                            <list_texpoly_normal>
-                                <entry iUnknown=3D"0" iTexCoord=3D"{[1]=3D=
724=3D0x02d4,[2]=3D736=3D0x02e0,[0]=3D723=3D0x02d3,}" />
-                                <entry iUnknown=3D"1" iTexCoord=3D"{[1]=3D=
734=3D0x02de,[2]=3D723=3D0x02d3,[0]=3D735=3D0x02df,}" />
-			...
-			=

-	]]--
-					=

+	]]--
+	local objlist =3D {}
+	-- TODO : testrun for asserts on all granny files
+	for k,obj in ipairs(Object.object_list.childs) do
+		local myobj =3D {a=3Dobj.unknown_a,b=3Dobj.unknown_b,keys=3D{}}
+		table.insert(objlist,myobj)
+		for k2,key in ipairs(obj.object_key_list.childs) do
+			local values =3D key.object_value_list.childs
+			assert(#values =3D=3D 1)
+			assert(values[1].unknown_a =3D=3D 0)
+			myobj.keys[key.key] =3D values[1].unknown_b
+			--~ local myvalues =3D {}
+			--~ myobj.keys[key.key] =3D myvalues
+			--~ for k3,value in ipairs(key.object_value_list.childs) do
+				--~ print("value",value.unknown_a,value.unknown_b)
+				--~ table.insert(myvalues,(value.unknown_b))
+				--~ assert(value.unknown_a =3D=3D 0,value.unknown_a)
+			--~ end
+		end
+		print("obj",myobj.a,myobj.b,SmartDump(myobj.keys,3))
+	end
+	=

+	=

 	os.exit(0)
 end
 =

+function GrannyTest_PreOgreInit2 ()
+    if (not gUOPath) then AutoDetectUOPath() end
+	CheckUODir()
+	cDebugGrannyMenu:MakeNewGranny(791)
+	os.exit()
+end
+

Modified: trunk/lua/lib.granny.loader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.loader.lua (original)
+++ trunk/lua/lib.granny.loader.lua Thu Nov 19 17:52:48 2009
@@ -25,6 +25,7 @@
 dofile(libpath .. "lib.granny.types.lua")
 =

 function GrannyTest_PreOgreInit () =

+	GrannyTest_PreOgreInit2()
 	gDebugCategories["granny"] =3D true
 	local folderpath =3D "/cavern/uoml/Models/Monsters/"
 	local arr_dirs	=3D dirlist(folderpath,true,false)



From no-reply at zwischenwelt.org  Sat Nov 21 13:00:59 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 21 Nov 2009 12:00:59 -0000
Subject: [Iris-commit] [IRIS] r3156 - in /trunk/lua: lib.2d.map.lua
 lib.2d.spriteblock.lua lib.mapblock.2d.statics.lua
 lib.mapblock.2d.terrain.lua lib.mapblock.3d.multis.lua
 lib.mapblock.base.lua lib.uoutils.lua
Message-ID: <20091121120059.D65B87A9814F@simon>

Author: ghoulsblade
Date: Sat Nov 21 13:00:58 2009
New Revision: 3156

Log:
2d: fixed terrain and statics being loaded too late, now the loader calcula=
tes the screen area, before it just loaded a circle. util:PixelOffsetToTile=
Offset

Modified:
    trunk/lua/lib.2d.map.lua
    trunk/lua/lib.2d.spriteblock.lua
    trunk/lua/lib.mapblock.2d.statics.lua
    trunk/lua/lib.mapblock.2d.terrain.lua
    trunk/lua/lib.mapblock.3d.multis.lua
    trunk/lua/lib.mapblock.base.lua
    trunk/lua/lib.uoutils.lua

Modified: trunk/lua/lib.2d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.2d.map.lua (original)
+++ trunk/lua/lib.2d.map.lua Sat Nov 21 13:00:58 2009
@@ -28,6 +28,8 @@
 --~ dofile(libpath .. "lib.mapblock.2d.water.lua")
 cMapBlock_2D_Water		=3D CreateClass(cMapBlockGrid)
 =

+
+
 cMapBlock_2D_Terrain.kLOD_Detail		=3D kMapLoad_2D_Terrain_Detail
 cMapBlock_2D_Terrain.kLOD_Rough			=3D kMapLoad_2D_Terrain_Rough
 cMapBlock_2D_Statics.kLOD_Detail		=3D kMapLoad_2D_Statics_Detail
@@ -47,10 +49,11 @@
 	if (not self.bMapLoadSystemInitialized) then
 		self.bMapLoadSystemInitialized =3D true
 		local scheduler =3D CreateScheduler()
+		self.map2d_nextAreaCalc =3D 0
 		self.map2d_scheduler =3D scheduler
 		self.map2d_spawners =3D {}
-		self.map2d_spawners.terrain		=3D CreateMapBlockSpawner(cMapBlock_2D_Terr=
ain,scheduler)
-		self.map2d_spawners.statics		=3D CreateMapBlockSpawner(cMapBlock_2D_Stat=
ics,scheduler)
+		self.map2d_spawners.terrain		=3D CreateMapBlockSpawner2D(cMapBlock_2D_Te=
rrain,scheduler)
+		self.map2d_spawners.statics		=3D CreateMapBlockSpawner2D(cMapBlock_2D_St=
atics,scheduler)
 		--~ self.map2d_spawners.water		=3D CreateMapBlockSpawner(cMapBlock_2D_Wa=
ter,scheduler)
 	end
 end
@@ -96,9 +99,35 @@
 	return fMinZ,fMaxZ
 end
 =

+
+-- local l,t,r,b =3D Renderer2D:GetScreenAreaInTileCoords ()  (relative co=
ords, add xloc,yloc of cam center)
+function Renderer2D:GetScreenAreaInTileCoords () return unpack(self.screen=
AreaInTileCoords) end
+
+function Renderer2D:MapRecalcScreenArea		(x,y)
+	-- calc view area for current window size
+	local vw,vh =3D GetViewportSize()
+	local x0,y0 =3D PixelOffsetToTileOffset(-vw/2,-vh/2)
+	local x1,y1 =3D PixelOffsetToTileOffset( vw/2,-vh/2)
+	local x2,y2 =3D PixelOffsetToTileOffset(-vw/2, vh/2)
+	local x3,y3 =3D PixelOffsetToTileOffset( vw/2, vh/2)
+	local e =3D 3 -- should cope with different zlevels
+	local l =3D floor(min(x0,x1,x2,x3))-e
+	local t =3D floor(min(y0,y1,y2,y3))-e
+	local r =3D ceil(max(x0,x1,x2,x3))+e
+	local b =3D ceil(max(y0,y1,y2,y3))+e
+	--~ print("Renderer2D:MapStep : dx,dy=3D",dx,dy,"x,y=3D",floor(xloc),floo=
r(yloc),"l,t:",l,t,"r,b:",r,b)
+	self.screenAreaInTileCoords =3D {l,t,r,b}
+end
+
 function Renderer2D:MapStep		()
 	local t =3D Client_GetTicks()
 	local x,y,z =3D self:GetCamPos()
+	=

+	if (self.map2d_nextAreaCalc < t) then =

+		self.map2d_nextAreaCalc =3D t + 1000
+		self:MapRecalcScreenArea(x,y)
+	end
+	=

 	for k,spawner in pairs(self.map2d_spawners) do spawner:Step(t,x,y,z) end
 	self.map2d_scheduler:Step(x,y,z)
 end
@@ -110,3 +139,60 @@
 -- water : block.terrain[10*ty+tx] =3D MapGetGround(block.bx*8+tx,block.by=
*8+ty)
 -- water : analyze terrain infos and determine where water should be, Filt=
erIsMapWater(tiletype) -- 3D: chunk:SetWaterZ(tx,ty,z) ??
 =

+
+-- ***** ***** ***** cMapBlockSpawner2D
+
+cMapBlockSpawner2D =3D CreateClass(cMapBlockSpawner)
+cMapBlockSpawner2D.kStepInterval =3D 100
+function CreateMapBlockSpawner2D (pBlockClass,pScheduler) local o =3D Crea=
teClassInstance(cMapBlockSpawner2D, pBlockClass,pScheduler) return o end
+
+
+function cMapBlockSpawner2D:Step	(t,x,y) =

+	if ((self.iNextStep or 0) > t) then return end
+	self.iNextStep =3D t + self.kStepInterval
+	=

+	local xloc,yloc =3D x,y
+	local l,t,r,b =3D Renderer2D:GetScreenAreaInTileCoords()
+	local minx =3D floor((xloc+l)/self.iBlockSize)
+	local miny =3D floor((yloc+t)/self.iBlockSize)
+	local maxx =3D floor((xloc+r)/self.iBlockSize)
+	local maxy =3D floor((yloc+b)/self.iBlockSize)
+	=

+	-- destroy blocks outside radius
+	for block,v in pairs(self.pMapBlocks) do =

+		if (block.bx < minx or =

+			block.by < miny or =

+			block.bx > maxx or =

+			block.by > maxy) then
+			-- outside, destroyed
+			self.mlToBeDestroyedBlock[block] =3D true
+			--~ self:DestroyMapBlock(block)
+		end
+	end
+	=

+	-- create blocks inside radius if needed
+	for by =3D miny,maxy do
+	for bx =3D minx,maxx do
+		self:GetOrCreateMapBlock(bx,by)
+	end
+	end
+	=

+	giShowLoadingUnfinished =3D countarr(self.mlUnfinishedBlock) + countarr(s=
elf.mlToBeDestroyedBlock)
+	=

+	-- check unfinished jobs and remove them if finished
+	for k,v in pairs(self.mlUnfinishedBlock) do
+		if k:IsDead() then
+			--~ print("REMOVE UNFINISHED JOB")
+			self.pScheduler:RemoveProcess(k)
+			self.mlUnfinishedBlock[k] =3D nil
+		end
+	end
+	=

+	-- destroy blocks
+	for k,v in pairs(self.mlToBeDestroyedBlock) do
+		self.mlToBeDestroyedBlock[k] =3D nil
+		self:DestroyMapBlock(k)
+		if not TimeLeftInFrame() then break end
+	end
+end
+

Modified: trunk/lua/lib.2d.spriteblock.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.2d.spriteblock.lua (original)
+++ trunk/lua/lib.2d.spriteblock.lua Sat Nov 21 13:00:58 2009
@@ -43,11 +43,6 @@
 	self:ClearGfx()
 	self.pSpritesByAtlas =3D {}
 	self.pWaterTiles =3D {}
-end
-
-function TileOffsetToPixelOffset (tx,ty)
-	return	tx *  22 + ty * -22,
-			tx *  22 + ty *  22
 end
 =

 function ArtCheckBitMask(artid,px,py)

Modified: trunk/lua/lib.mapblock.2d.statics.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mapblock.2d.statics.lua (original)
+++ trunk/lua/lib.mapblock.2d.statics.lua Sat Nov 21 13:00:58 2009
@@ -11,6 +11,8 @@
 	if (not self.spriteblock) then return end
 	return self.spriteblock:RayPick(rx,ry,rz, rvx,rvy,rvz) =

 end
+
+function cMapBlock_2D_Statics:RecalcLOD () return self.kLOD_Detail end
 =

 function cMapBlock_2D_Statics:RebuildForBlendout ()
 	if (not self.bMyDetailLoaded) then return end

Modified: trunk/lua/lib.mapblock.2d.terrain.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mapblock.2d.terrain.lua (original)
+++ trunk/lua/lib.mapblock.2d.terrain.lua Sat Nov 21 13:00:58 2009
@@ -1,6 +1,6 @@
 cMapBlock_2D_Terrain	=3D CreateClass(cMapBlockGrid)
-cMapBlock_2D_Terrain.iBlockSize		=3D 8*2 -- in tiles
-cMapBlock_2D_Terrain.iLoadRadius	=3D 4 -- in iBlockSize-blocks
+cMapBlock_2D_Terrain.iBlockSize				=3D 8*2 -- in tiles
+cMapBlock_2D_Terrain.iLoadRadius			=3D 4 -- in iBlockSize-blocks
 --~ cMapBlock_2D_Terrain.kMaxDist_Visible		=3D 8*4 -- camdist in tiles  se=
e mapblock.base for default
 --~ cMapBlock_2D_Terrain.kMaxDist_Detail		=3D 8*2 -- camdist in tiles
 =

@@ -11,6 +11,8 @@
 function cMapBlock_2D_Terrain:UpdateBlendOutVisibility ()
 	if (self.gfx_terrain) then self.gfx_terrain:SetVisible(gCurrentRenderer.g=
bBlendOutTerrainVisible) end
 end
+
+function cMapBlock_2D_Terrain:RecalcLOD () return self.kLOD_Detail end
 =

 -- returns dist,xloc,yloc   if hit, or nil if not hit.    sprite=3D{artid=
=3D?,hue=3D?,static=3D?}
 function cMapBlock_2D_Terrain:RayPick (rx,ry,rz, rvx,rvy,rvz) =


Modified: trunk/lua/lib.mapblock.3d.multis.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mapblock.3d.multis.lua (original)
+++ trunk/lua/lib.mapblock.3d.multis.lua Sat Nov 21 13:00:58 2009
@@ -1,7 +1,7 @@
 -- todo
 =

 cMapBlock_3D_Multis	=3D CreateClass(cMapBlockAABB)
-cMapBlock_3D_Multis.iLoadRadius				=3D 64 -- in tiles
+cMapBlock_3D_Multis.iLoadRadius				=3D 64 -- in tiles  -- TODO : all other=
 mapblock loaders are in iBlockSize-blocks, is this here a bug ?
 cMapBlock_3D_Multis.kMaxDist_Visible		=3D 32 -- camdist in tiles  see mapb=
lock.base for default
 cMapBlock_3D_Multis.kMaxDist_Detail			=3D 64 -- camdist in tiles
 =


Modified: trunk/lua/lib.mapblock.base.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mapblock.base.lua (original)
+++ trunk/lua/lib.mapblock.base.lua Sat Nov 21 13:00:58 2009
@@ -115,19 +115,19 @@
 function cMapBlock:ShortStep (t,x,y,z)
 	if ((self.iNextLODUpdate or 0) < t) then
 		self.iNextLODUpdate =3D t + self.kLODUpdateInterval
+		self:SetLOD(self:RecalcLOD(x,y,z))
+	end
+end
 		=

-		local bx,by,w,h =3D self:GetAABB()
-		=

-		local camdist =3D hypot(	(bx+w/2)-x,
-								(by+h/2)-y)
-		self.last_camdist =3D camdist
+function cMapBlock:RecalcLOD (x,y,z)
+	local bx,by,w,h =3D self:GetAABB()
+	=

+	local camdist =3D hypot(	(bx+w/2)-x,
+							(by+h/2)-y)
+	self.last_camdist =3D camdist
 =

-		local newlod
-		if (	camdist <  self.kMaxDist_Detail ) then newlod =3D self.kLOD_Detail =

-		elseif (camdist <  self.kMaxDist_Visible) then newlod =3D self.kLOD_Roug=
h end
-		--~ if (newlod) then print("cMapBlock:ShortStep",newlod,camdist,self.kMa=
xDist_Detail) end
-		self:SetLOD(newlod)
-	end
+	if (	camdist <  self.kMaxDist_Detail ) then return self.kLOD_Detail =

+	elseif (camdist <  self.kMaxDist_Visible) then return self.kLOD_Rough end
 end
 =

 -- a single step during the thread

Modified: trunk/lua/lib.uoutils.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoutils.lua (original)
+++ trunk/lua/lib.uoutils.lua Sat Nov 21 13:00:58 2009
@@ -19,6 +19,24 @@
 	function res:Set	(name,val) 	self:Reload()			self.data[name] =3D val	self=
:Save() end
 	res:Reload()
 	return res
+end
+
+function TileOffsetToPixelOffset (tx,ty)
+	return	tx *  22 + ty * -22,
+			tx *  22 + ty *  22
+end
+function PixelOffsetToTileOffset (px,py)
+	--~ px =3D tx *  22 + ty * -22 -- TileOffsetToPixelOffset
+	--~ (px + ty * 22) / 22 =3D tx
+	=

+	--~ py =3D tx *  22 + ty *  22 -- TileOffsetToPixelOffset
+	--~ py =3D (px + ty * 22) / 22 *  22 + ty *  22
+	--~ py =3D px + ty * 22 + ty *  22
+	--~ py =3D px + ty * 44
+	--~ (py - px)/44 =3D ty
+	local ty =3D (py - px)/44
+	local tx =3D (px + ty * 22) / 22
+	return tx,ty
 end
 =

 function ApplyDir (dir,posx,posy) =




From no-reply at zwischenwelt.org  Sat Nov 21 14:06:19 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 21 Nov 2009 13:06:19 -0000
Subject: [Iris-commit] [IRIS] r3157 - /trunk/lua/lib.gfxconfig.lua
Message-ID: <20091121130620.0327D7A9814F@simon>

Author: ghoulsblade
Date: Sat Nov 21 14:06:19 2009
New Revision: 3157

Log:
gfx-crash-detect : dialogbox asking if the user wants to change render-syst=
em, maybe this helps with win-directx crash ? needs testing under win.

Modified:
    trunk/lua/lib.gfxconfig.lua

Modified: trunk/lua/lib.gfxconfig.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gfxconfig.lua (original)
+++ trunk/lua/lib.gfxconfig.lua Sat Nov 21 14:06:19 2009
@@ -14,12 +14,13 @@
 end
 function GfxConfig_FindFromList 				(list,pattern) for k,v in ipairs(list)=
 do if (string.find(string.lower(v),pattern)) then return v end end end
 =

-function GfxConfig_FindDefaultRenderSystem ()
+function GfxConfig_FindDefaultRenderSystem (bPreferOpenGL)
 	local list =3D	GfxConfig_ListPossibleRenderSystems()
-	local best =3D	GfxConfig_FindFromList(list,"direct") or  -- "Direct3D9 Re=
ndering Subsystem"
+	local best =3D	(bPreferOpenGL and GfxConfig_FindFromList(list,"opengl")) =
or  -- "OpenGL Rendering Subsystem"(win)
+					GfxConfig_FindFromList(list,"direct") or  -- "Direct3D9 Rendering Sub=
system"
 					GfxConfig_FindFromList(list,"d3d") or =

 					list[#list]
-	print("GfxConfig_FindDefaultRenderSystem",best)
+	print("GfxConfig_FindDefaultRenderSystem",best,"bPreferOpenGL:",bPreferOp=
enGL)
 	return best
 end
 =

@@ -69,10 +70,33 @@
 function GfxConfig_Apply ()
 	print("######################")
 	print("### GfxConfig_Apply...")
-	if (GfxConfig_HasCrashed()) then =

+	local bTestCrash =3D false
+	if (GfxConfig_HasCrashed() or bTestCrash) then =

 		print("######################")
 		print("### gfx config detected a crash, restoring factory settings")
+		=

+		local list	=3D GfxConfig_ListPossibleRenderSystems()
+		--~ if (bTestCrash) then table.insert(list,"Direct3D9 Rendering Subsyste=
m") end
+		print("##############")
+		print("############## gfxconfig ",SmartDump(list))
+		local newrendersystem
+		if (#list > 1) then =

+			local current =3D gGfxConfig_RenderSystem or GfxConfig_FindDefaultRende=
rSystem()
+			local other
+			for i,name in ipairs(list) do if (name ~=3D current) then other =3D nam=
e end end
+			=

+			if (other) then =

+				local text =3D table.concat({	"Iris detected a crash during the last s=
tartup of the rendering system.\n",
+											"Currently used rendering system : '"..tostring(current).."'\n",
+											"Do you want to change to : '"..tostring(other).."' ?\n",
+										},"")
+				local res =3D LugreMessageBox(kLugreMessageBoxType_YesNo,"Use differen=
t rendering system ?",text)
+				newrendersystem =3D (res =3D=3D kLugreMessageBoxResult_Yes) and other
+			end
+		end
 		GfxConfig_ResetToFactorySettings()
+		if (newrendersystem) then gGfxConfig_RenderSystem =3D newrendersystem end
+		--~ if (bTestCrash) then print("bTestCrash:",newrendersystem) os.exit(0)=
 end
 	end
 	=

 	function WrapString(txt) return ">"..tostring(txt).."<" end



From no-reply at zwischenwelt.org  Sat Nov 21 17:09:16 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 21 Nov 2009 16:09:16 -0000
Subject: [Iris-commit] [IRIS] r3158 - in /trunk/lua: lib.export.lua
 lib.granny.debug.lua lib.granny.loader.lua main.lua
Message-ID: <20091121160916.717337A98155@simon>

Author: ghoulsblade
Date: Sat Nov 21 17:09:16 2009
New Revision: 3158

Log:
granny debug tweaked a bit, main.lua : moved exports to separate file

Added:
    trunk/lua/lib.export.lua
Modified:
    trunk/lua/lib.granny.debug.lua
    trunk/lua/lib.granny.loader.lua
    trunk/lua/main.lua

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Sat Nov 21 17:09:16 2009
@@ -139,20 +139,26 @@
 		for k,v in pairs(obj) do print(" ",k,v,MyGetChunkT(v and type(v) =3D=3D =
"table" and v.iChunkType)) end
 	end
 	=

+	function MyGrannyDump(arr,name)
+		for k,entry in ipairs(arr) do if (k<=3D3) then print(name,k.."/"..#arr,S=
martDump(entry)) end end
+	end
+	=

 	local Object =3D grn.pMainChunk.Object
-	for k,entry in ipairs(Object.textChunk.texts) do if (k<=3D3) then print("=
text",k,SmartDump(entry)) end end
+	MyGrannyDump(Object.textChunk.texts,"text")
 	=

 	--~ MyDump(Object.mesh_list.mesh)
 	local mesh =3D Object.mesh_list.mesh
 	local point_container =3D mesh.point_block.point_container
-	for k,entry in ipairs(point_container.points.list_points) do if (k<=3D3) =
then print("point",k,SmartDump(entry)) end end
-	for k,entry in ipairs(point_container.normals.list_normals) do if (k<=3D3=
) then print("normal",k,SmartDump(entry)) end end
+	MyGrannyDump(point_container.points.list_points,"point")
+	MyGrannyDump(point_container.normals.list_normals,"normal")
 	print("texcoords:unknown:",point_container.texture_container.texcoords.un=
known)
-	for k,entry in ipairs(point_container.texture_container.texcoords.list_te=
xcoords) do if (k<=3D3) then print("texcoord",k,SmartDump(entry)) end end
+	MyGrannyDump(point_container.texture_container.texcoords.list_texcoords,"=
texcoord")
 	=

 	print("weights:",SmartDump(mesh.weights))
-	for k,entry in ipairs(mesh.weights.list_weights) do if (k<=3D3) then prin=
t("weight",k,SmartDump(entry)) end end
-	for k,entry in ipairs(mesh.polygons.list_polygons) do if (k<=3D3) then pr=
int("polygon",k,SmartDump(entry)) end end
+	MyGrannyDump(mesh.weights.list_weights,"weight")
+	MyGrannyDump(mesh.polygons.list_polygons,"polygon")
+	=

+	=

 	=

 	--[[
 		<Object miListOffset=3D"440" miUnknown1=3D"0">
@@ -172,7 +178,7 @@
             <boneobject>...</boneobject>
 			=

 	]]--
-	for k,entry in ipairs(Object.boneTies1) do if (k<=3D3) then print("boneTi=
es1:boneobject",k,SmartDump(entry)) end end
+	MyGrannyDump(Object.boneTies1,"boneTies1:boneobject")
 	--[[
         <bones>
             <skeleton>
@@ -186,7 +192,7 @@
 			...
 		</bones>
 	]]--
-	for k,entry in ipairs(Object.bones.skeleton.bonelist) do if (k<=3D3) then=
 print("bone",k,SmartDump(entry)) end end
+	MyGrannyDump(Object.bones.skeleton.bonelist,"bone")
 	--[[
         <texture_info_list>
             <texture_info>
@@ -233,8 +239,8 @@
 			...
         </boneTies2>
 	]]--
-	for k,entry in ipairs(Object.boneTies2.boneties_container.bone_objptrs_co=
ntainer.bone_objptr) do if (k<=3D3) then print("bt2:bone_objptr",k,SmartDum=
p(entry)) end end
-	for k,entry in ipairs(Object.boneTies2.boneties_container.bonetie_contain=
er.bonetie_group.bonetie_list) do if (k<=3D3) then print("bt2:bonetie",k,Sm=
artDump(entry)) end end
+	MyGrannyDump(Object.boneTies2.boneties_container.bone_objptrs_container.b=
one_objptr,"bt2:bone_objptr")
+	MyGrannyDump(Object.boneTies2.boneties_container.bonetie_container.boneti=
e_group.bonetie_list,"bt2:bonetie")
 	--[[
         <texture_list>
             <texture iTextureID=3D"1">
@@ -254,7 +260,7 @@
 			...
 			=

 	]]--
-	for k,entry in ipairs(Object.texture_list.texture.texture_sublist.texture=
_poly.texture_poly_list.list_texpoly_normal) do if (k<=3D3) then print("lis=
t_texpoly_normal",k,SmartDump(entry)) end end
+	MyGrannyDump(Object.texture_list.texture.texture_sublist.texture_poly.tex=
ture_poly_list.list_texpoly_normal,"list_texpoly_normal")
 	=

 	=

 	=

@@ -282,16 +288,22 @@
             <object unknown_b=3D"1" unknown_a=3D"1">...</object>
 			...
 	]]--
+	=

+	=

 	local objlist =3D {}
 	-- TODO : testrun for asserts on all granny files
 	for k,obj in ipairs(Object.object_list.childs) do
-		local myobj =3D {a=3Dobj.unknown_a,b=3Dobj.unknown_b,keys=3D{}}
+		local keys =3D {}
+		--~ local myobj =3D {a=3Dobj.unknown_a,b=3Dobj.unknown_b,keys=3Dkeys}
+		assert(obj.unknown_a =3D=3D 1)
+		assert(obj.unknown_b =3D=3D 1)
+		local myobj =3D keys
 		table.insert(objlist,myobj)
 		for k2,key in ipairs(obj.object_key_list.childs) do
 			local values =3D key.object_value_list.childs
 			assert(#values =3D=3D 1)
 			assert(values[1].unknown_a =3D=3D 0)
-			myobj.keys[key.key] =3D values[1].unknown_b
+			keys[key.key] =3D values[1].unknown_b
 			--~ local myvalues =3D {}
 			--~ myobj.keys[key.key] =3D myvalues
 			--~ for k3,value in ipairs(key.object_value_list.childs) do
@@ -300,8 +312,9 @@
 				--~ assert(value.unknown_a =3D=3D 0,value.unknown_a)
 			--~ end
 		end
-		print("obj",myobj.a,myobj.b,SmartDump(myobj.keys,3))
+		--~ print("obj",myobj.a,myobj.b,SmartDump(myobj.keys,3))
 	end
+	MyGrannyDump(objlist,"obj")
 	=

 	=

 	os.exit(0)

Modified: trunk/lua/lib.granny.loader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.loader.lua (original)
+++ trunk/lua/lib.granny.loader.lua Sat Nov 21 17:09:16 2009
@@ -41,16 +41,22 @@
 	=

 end
 =

+function cGrannyFile:_CreateAndLoadFIFO () =

+	if (self.fifo) then return end -- still open
+	local fifo =3D CreateFIFO()
+	fifo:Clear()
+	fifo:ReadFromFile(self.filepath)
+	self.fifo =3D fifo
+end
+function cGrannyFile:_FreeFIFO () =

+	if (self.fifo) then self.fifo:Destroy() self.fifo =3D nil end
+end
 function cGrannyFile:LoadFile (filepath) =

 	print("cGrannyFile:LoadFile",filepath)
 	self.filepath =3D filepath
-	local fifo =3D CreateFIFO()
-	fifo:Clear()
-	fifo:ReadFromFile(filepath)
-	self:Parse(fifo)
-	--~ self:XMLDump("../mygranny.xml") =

-	fifo:Destroy()
-	self.fifo =3D nil
+	self:_CreateAndLoadFIFO()
+	self:Parse(self.fifo)
+	self:_FreeFIFO()
 end
 =

 -- allow access like grn.pMainChunk.Object.mesh_list.mesh.point_block.poin=
t_container.points.list_points  =

@@ -104,6 +110,7 @@
 		pQuaternion		=3DMyDumpObjList, =

 		pScale			=3DMyDumpObjList, =

 	}
+	self:_CreateAndLoadFIFO()
 	local quickfifo =3D self.fifo and self.fifo:GetQuickHandle()
 	function MyHexDumpNode (offset,len) =

 		local node =3D {name=3D"hexdump",attr=3D{offset=3Doffset,len=3Dlen}}
@@ -153,6 +160,7 @@
 		return node
 	end
 	LuaXML_SaveFile(filepath,MyNode("MainChunk",self.pMainChunk))
+	self:_FreeFIFO()
 end
 =

 function cGrannyFile:Read (offset,structname) =


Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Nov 21 17:09:16 2009
@@ -44,6 +44,7 @@
 dofile(libpath .. "lib.2d.renderer.lua")
 dofile(libpath .. "lib.null.renderer.lua")
 =

+dofile(libpath .. "lib.export.lua")
 dofile(libpath .. "lib.renderer.lua")
 dofile(libpath .. "lib.hue.lua")
 dofile(libpath .. "lib.uoids.lua")
@@ -701,124 +702,3 @@
     gLastFrameTime =3D Client_GetTicks()
 end
 =

--- exports data if some commandline parameters are set
-function InvokeExporters ()
-    if (gCommandLineArguments[1] =3D=3D "-tree") then -- export trees
-        print("# # # # # # # # # #  #  #    #     #      starting tree exp=
orter")
-        local treetypes =3D {}
-        for iFacet =3D 0,0 do -- 0 Felucca, 1 Trammel, 2 Ilshenar, 3 Malas=
, 4 Tokuno
-            MapChangeRequest(iFacet)
-            local mapw =3D MapGetWInBlocks()
-            local maph =3D MapGetHInBlocks()
-            for bx =3D 0,mapw-1 do
-                for by =3D 0,maph-1 do
-                    for k,static in pairs(MapGetBlockStatics(bx,by)) do =

-                        local iTileTypeID =3D static.artid
-                        local bIsTree =3D treetypes[iTileTypeID]
-                        if (bIsTree =3D=3D nil) then
-                            bIsTree =3D string.find(string.lower(GetStatic=
TileTypeName(iTileTypeID)),"tree")
-                            treetypes[iTileTypeID] =3D bIsTree
-                        end
-                        if (bIsTree) then
-                            local o =3D static
-                            print("Tree("..iFacet..","..o.xloc..","..o.ylo=
c..","..o.zloc..","..o.artid,")")
-                        end
-                    end
-                end
-            end
-        end
-        os.exit(0)
-    end
-    if (gCommandLineArguments[1] =3D=3D "-em") then -- export map xloc,ylo=
c,mapblocksw,mapblocksh
-        local img =3D CreateImage()
-        local bx        =3D math.floor(tonumber(gCommandLineArguments[2])/=
8)
-        local by        =3D math.floor(tonumber(gCommandLineArguments[3])/=
8)
-        local dbx       =3D math.floor(tonumber(gCommandLineArguments[4] o=
r 10))
-        local dby       =3D math.floor(tonumber(gCommandLineArguments[5] o=
r 10))
-        local facet     =3D math.floor(tonumber(gCommandLineArguments[6] o=
r 1))  -- 1 =3D tram
-        MapChangeRequest(facet)
-        local bx0,by0 =3D math.floor(bx-dbx/2),math.floor(by-dby/2)
-        GenerateRadarImage(img,bx0,by0,dbx,dby,gGroundBlockLoader,gStaticB=
lockLoader,gRadarColorLoader)
-        img:SaveAsFile("../mapexport.png")
-        img:Destroy()
-        os.exit(0)
-    end
-    =

-    if (gCommandLineArguments[1] =3D=3D "-ehouseland") then -- export map =
xloc,yloc,mapblocksw,mapblocksh
-        dofile(libpath .. "lib.export_houseland.lua")
-    end
-    =

-    if (gCommandLineArguments[1] =3D=3D "-eg") then -- export gumps
-        local iGumpIDMin =3D gCommandLineArguments[gCommandLineSwitches["-=
eg"]+1]
-        local iGumpIDMax =3D gCommandLineArguments[gCommandLineSwitches["-=
eg"]+2]
-        for iGumpID =3D iGumpIDMin,iGumpIDMax do
-            local iHue =3D 0
-            print("exporting gump : ",iGumpID)
-            local mat =3D GetGumpMat(iGumpID,iHue)
-            local tex =3D GetTexture(mat)
-            if (tex) then
-                local img =3D LoadImageFromTexture(tex)
-                local sFilePath =3D sprintf("../mygumps/gump%08d.png",iGum=
pID)
-                img:SaveAsFile(sFilePath)
-                img:Destroy()
-            end
-        end
-        print("done")
-        os.exit(0)
-    end
-    =

-    if (gCommandLineArguments[1] =3D=3D "-ea") then -- export artmaps
-        local count =3D hex2num("0x00004000")
-        print("exporting artmaps : ",count)
-        for iArtMapID =3D 0,count-1 do =

-            local sFilePath =3D sprintf("../myartmaps/artmap%08d.png",iArt=
MapID)
-            local bSuccess =3D        gArtMapLoader:ExportToFile(sFilePath=
,iArtMapID)
-            --~ local bSuccess =3D    gArtMapLoader:ExportToFile(sFilePath=
,iArtMapID,pHueLoader=3Dnil,iHue=3D0)
-            print("export",iArtMapID,sFilePath,bSuccess)
-            --~ if (bSuccess) then break end
-        end
-        print("done")
-        os.exit(0)
-    end
-    =

-    if (gCommandLineArguments[1] =3D=3D "-et") then -- export texmaps
-        local count =3D gTexMapLoader:GetCount()
-        print("exporting texmaps : ",count)
-        for iTexMapID =3D 0,count-1 do =

-            local sFilePath =3D sprintf("../mytexmaps/texmap%08d.png",iTex=
MapID)
-            -- iTexMapID =3D iTranslatedTileTypeID
-            local bSuccess =3D    gTexMapLoader:ExportToFile(sFilePath,iTe=
xMapID)
-            --~ local bSuccess =3D    gTexMapLoader:ExportToFile(sFilePath=
,iTexMapID,pHueLoader=3Dnil,iHue=3D0)
-            print("export",iTexMapID,sFilePath,bSuccess)
-            --~ if (bSuccess) then break end
-        end
-        print("done")
-        os.exit(0)
-    end
-    =

-    if (gCommandLineArguments[1] =3D=3D "-egt") then -- export ground tile=
typecounter
-        local iMapIndex =3D 4
-        LoadMap(iMapIndex)
-        local counter =3D gGroundBlockLoader:CountTileTypes()
-        for k,v in pairs(counter) do print("$gTileTypeCount["..iMapIndex..=
"]["..k.."] =3D "..v..";") end
-        print("done")
-        os.exit(0)
-    end
-    =

-    if (gCommandLineArguments[1] =3D=3D "-ett") then -- export tiletype-in=
fos
-        local iTileTypeEndID =3D gTileTypeLoader:GetEndID()
-
-        -- dump tiletype infos
-        local iGroundTileTypeIDEnd =3D hex2num("0x00004000")
-        for iGroundTileTypeID =3D 0,iGroundTileTypeIDEnd-1 do
-            local miFlags,miTexID,msName =3D gTileTypeLoader:GetGroundTile=
Type(iGroundTileTypeID)
-            if (miFlags) then
-                printf("$gTileType[0x%04x] =3D array(0x%04x,0x%04x,'%s');\=
n",iGroundTileTypeID,miFlags,miTexID,msName)
-            end
-        end
-        =

-        print("done")
-        os.exit(0)
-    end
-    NotifyListener("Hook_Exporters")
-end



From no-reply at zwischenwelt.org  Sat Nov 21 17:10:47 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 21 Nov 2009 16:10:47 -0000
Subject: [Iris-commit] [IRIS] r3159 - in /trunk/lua: lib.profile.top.lua
	main.lua
Message-ID: <20091121161047.F38BA54D0039@simon>

Author: ghoulsblade
Date: Sat Nov 21 17:10:47 2009
New Revision: 3159

Log:
main.lua : moved profile-top-5 code to separate file

Added:
    trunk/lua/lib.profile.top.lua
Modified:
    trunk/lua/main.lua

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Nov 21 17:10:47 2009
@@ -44,6 +44,7 @@
 dofile(libpath .. "lib.2d.renderer.lua")
 dofile(libpath .. "lib.null.renderer.lua")
 =

+dofile(libpath .. "lib.profile.top.lua")
 dofile(libpath .. "lib.export.lua")
 dofile(libpath .. "lib.renderer.lua")
 dofile(libpath .. "lib.hue.lua")
@@ -515,66 +516,6 @@
 end
 =

 =

-gMyProfilerTopCPUTSum =3D 0
-gMyProfilerTopGPUTSum =3D 0
-function MyProfilerTop ()
-    if (not gEnableRoughProfileSum) then return end
-    print(Client_GetTicks(),"=3D=3D=3D MyProfilerTop cpu time =3D=3D=3D")
-    local arr_t =3D {}
-    local arr_memL =3D {}
-    local arr_memO =3D {}
-    local arr_tspike =3D {}
-    local arr_tspikeframe =3D {}
-    for k,profiler in pairs(gAllRoughProfilers) do
-        for secname,v in pairs(profiler.sum         ) do table.insert(arr_=
t         ,{name=3Dprofiler.name..":"..secname,v=3Dv}) end
-        for secname,v in pairs(profiler.sum_memL    ) do table.insert(arr_=
memL      ,{name=3Dprofiler.name..":"..secname,v=3Dv}) end
-        for secname,v in pairs(profiler.sum_memO    ) do table.insert(arr_=
memO      ,{name=3Dprofiler.name..":"..secname,v=3Dv}) end
-        for secname,v in pairs(profiler.sum_tspike  ) do table.insert(arr_=
tspike    ,{name=3Dprofiler.name..":"..secname,v=3Dv}) end
-        for secname,v in pairs(profiler.sum_tspikeframe_total   ) do table=
.insert(arr_tspikeframe   ,{name=3Dprofiler.name..":"..secname,v=3Dv}) end
-        profiler.sum        =3D {}
-        profiler.sum_memL   =3D {}
-        profiler.sum_memO   =3D {}
-        profiler.sum_tspike =3D {}
-        profiler.sum_tspikeframe_total  =3D {}
-    end =

-    table.sort(arr_t            ,function (a,b) return a.v > b.v end)
-    table.sort(arr_memL         ,function (a,b) return a.v > b.v end)
-    table.sort(arr_memO         ,function (a,b) return a.v > b.v end)
-    table.sort(arr_tspike       ,function (a,b) return a.v > b.v end)
-    table.sort(arr_tspike       ,function (a,b) return a.v > b.v end)
-    table.sort(arr_tspikeframe  ,function (a,b) return a.v > b.v end)
-    local topx =3D gRoughProfileSumHowMany or 10
-    for k,o in pairs(arr_t) do =

-        if (k <=3D topx and (not gEnableRoughProfileSum_SkipCPU)) then pri=
nt(" #"..k,sprintf("%5dmsec (%3d%%)",o.v,floor(100*o.v/gMyProfilerTopCPUTSu=
m)),o.name) end =

-    end
-    print(sprintf(" total time=3D%dsec cpu=3D%d%% gpu=3D%d%% idle/maxfpswa=
it=3D%d%%"    =

-                                                            ,   floor(gMyP=
rofilerTopInterval/1000)
-                                                            ,   floor(100*=
gMyProfilerTopCPUTSum/gMyProfilerTopInterval)
-                                                            ,   floor(100*=
gMyProfilerTopGPUTSum/gMyProfilerTopInterval)
-                                                            ,   floor(100*=
(gMyProfilerTopInterval-(gMyProfilerTopCPUTSum+gMyProfilerTopGPUTSum))/gMyP=
rofilerTopInterval)
-                                                            ))
-                                                            =

-    print(Client_GetTicks(),"=3D=3D=3D MyProfilerTop tspike (single sectio=
ns causing delays/lags) =3D=3D=3D")
-    for k,o in pairs(arr_tspike) do =

-        if (k <=3D topx and (not gEnableRoughProfileSum_SkipSpike)) then p=
rint(" #"..k,sprintf("%5dmsec",o.v),o.name) end =

-    end
-    print(Client_GetTicks(),"=3D=3D=3D MyProfilerTop tspikeframe (the summ=
ed cpu usage of all things during delay/lag-frames) =3D=3D=3D")
-    for k,o in pairs(arr_tspikeframe) do =

-        if (k <=3D topx and (not gEnableRoughProfileSum_SkipSpikeFrame)) t=
hen print(" #"..k,sprintf("%5dmsec",o.v),o.name) end =

-    end
-    print(Client_GetTicks(),"=3D=3D=3D MyProfilerTop memLua allocations =
=3D=3D=3D")
-    for k,o in pairs(arr_memL) do =

-        if (k <=3D topx and o.v > 0 and (not gEnableRoughProfileSum_SkipMe=
mL)) then print(" #"..k,sprintf("%5dkb",floor(o.v/1024)),o.name) end =

-    end
-    print(Client_GetTicks(),"=3D=3D=3D MyProfilerTop memOgre allocations =
=3D=3D=3D")
-    for k,o in pairs(arr_memO) do =

-        if (k <=3D topx and o.v > 0 and (not gEnableRoughProfileSum_SkipMe=
mO)) then print(" #"..k,sprintf("%5dkb",floor(o.v/1024)),o.name) end =

-    end
-    print(Client_GetTicks()," . . . . . ")
-    =

-    gMyProfilerTopCPUTSum =3D 0
-    gMyProfilerTopGPUTSum =3D 0
-end
 =

 =

 -- called when kPacket_Login_Confirm is received



From no-reply at zwischenwelt.org  Sat Nov 21 17:46:52 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 21 Nov 2009 16:46:52 -0000
Subject: [Iris-commit] [IRIS] r3160 - /trunk/lua/lib.granny.debug.lua
Message-ID: <20091121164652.3F4B354D0039@simon>

Author: ghoulsblade
Date: Sat Nov 21 17:46:51 2009
New Revision: 3160

Log:
granny debug tweaking

Modified:
    trunk/lua/lib.granny.debug.lua

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Sat Nov 21 17:46:51 2009
@@ -139,8 +139,16 @@
 		for k,v in pairs(obj) do print(" ",k,v,MyGetChunkT(v and type(v) =3D=3D =
"table" and v.iChunkType)) end
 	end
 	=

-	function MyGrannyDump(arr,name)
-		for k,entry in ipairs(arr) do if (k<=3D3) then print(name,k.."/"..#arr,S=
martDump(entry)) end end
+	function MyFilterFields (arr) =

+		if (type(arr) ~=3D "table") then return arr end
+		local res =3D {}
+		local blocked =3D {iChildren=3Dtrue,childsleft=3Dtrue,iChunkType=3Dtrue,=
iOffset=3Dtrue,} -- ,childs=3Dtable: 0x9532d20
+		for k,v in pairs(arr) do if (not blocked[k]) then res[k] =3D v end end
+		return res
+	end
+	function MyGrannyDump(arr,name,subfield,levels)
+		if (#arr =3D=3D 0) then print(name,"!!EMPTY!!",SmartDump(MyFilterFields(=
arr))) end
+		for k,entry in ipairs(arr) do if (k<=3D6) then print(name,k.."/"..#arr,S=
martDump(MyFilterFields(subfield and entry[subfield] or entry),levels or 2)=
) end end
 	end
 	=

 	local Object =3D grn.pMainChunk.Object
@@ -154,31 +162,22 @@
 	print("texcoords:unknown:",point_container.texture_container.texcoords.un=
known)
 	MyGrannyDump(point_container.texture_container.texcoords.list_texcoords,"=
texcoord")
 	=

-	print("weights:",SmartDump(mesh.weights))
+	print("weights:",SmartDump(MyFilterFields(mesh.weights)))
 	MyGrannyDump(mesh.weights.list_weights,"weight")
 	MyGrannyDump(mesh.polygons.list_polygons,"polygon")
 	=

 	=

 	=

-	--[[
-		<Object miListOffset=3D"440" miUnknown1=3D"0">
-        <miUnknown2 1=3D"0" 0=3D"2149427081" />
-        <textChunk iNumEntries=3D"60" iTextLen=3D"856">
-            <texts>
-                <entry>__Standard</entry>
-                <entry>__FileName</entry>
-			..
-		</textChunk>
-	]]--
 	--[[
         <boneTies1>
             <boneobject>
                 <id iID=3D"1" />
             </boneobject>
             <boneobject>...</boneobject>
-			=

-	]]--
-	MyGrannyDump(Object.boneTies1,"boneTies1:boneobject")
+	]]--
+	MyGrannyDump(Object.boneTies1.childs,"boneTies1:boneobject")
+	=

+	=

 	--[[
         <bones>
             <skeleton>
@@ -192,7 +191,7 @@
 			...
 		</bones>
 	]]--
-	MyGrannyDump(Object.bones.skeleton.bonelist,"bone")
+	MyGrannyDump(Object.bones.skeleton.bonelist.childs,"bone","bone")
 	--[[
         <texture_info_list>
             <texture_info>
@@ -239,8 +238,12 @@
 			...
         </boneTies2>
 	]]--
-	MyGrannyDump(Object.boneTies2.boneties_container.bone_objptrs_container.b=
one_objptr,"bt2:bone_objptr")
-	MyGrannyDump(Object.boneTies2.boneties_container.bonetie_container.boneti=
e_group.bonetie_list,"bt2:bonetie")
+	local btcont =3D Object.boneTies2.boneties_container
+	local a =3D btcont.bone_objptrs_container.bone_objptr
+	local b =3D btcont.bonetie_container.bonetie_group.bonetie_list
+	print("iBoneTie2ID=3D",a.iBoneTie2ID,"bone_objptrs.iNum=3D",a.bone_objptr=
s.iNum)
+	MyGrannyDump(a.bone_objptrs.BoneTies2,"bt2:bone_objptr")
+	MyGrannyDump(b.childs,"bt2:bonetie","bonetie")
 	--[[
         <texture_list>
             <texture iTextureID=3D"1">



From no-reply at zwischenwelt.org  Sun Nov 22 01:14:21 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 22 Nov 2009 00:14:21 -0000
Subject: [Iris-commit] [IRIS] r3161 - in /trunk/lua: lib.granny.debug.lua
	lib.granny.types.lua
Message-ID: <20091122001422.12FB87A98073@simon>

Author: ghoulsblade
Date: Sun Nov 22 01:14:19 2009
New Revision: 3161

Log:
grannydebug : vertex-combos done, collecting vertexdata in fifo works, now =
we need to build the actual ogre things around it : vertexbuffer,renderable=
,movable

Modified:
    trunk/lua/lib.granny.debug.lua
    trunk/lua/lib.granny.types.lua

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Sun Nov 22 01:14:19 2009
@@ -165,32 +165,7 @@
 	print("weights:",SmartDump(MyFilterFields(mesh.weights)))
 	MyGrannyDump(mesh.weights.list_weights,"weight")
 	MyGrannyDump(mesh.polygons.list_polygons,"polygon")
-	=

-	=

-	=

-	--[[
-        <boneTies1>
-            <boneobject>
-                <id iID=3D"1" />
-            </boneobject>
-            <boneobject>...</boneobject>
-	]]--
 	MyGrannyDump(Object.boneTies1.childs,"boneTies1:boneobject")
-	=

-	=

-	--[[
-        <bones>
-            <skeleton>
-                <bonelist>
-                    <bone>
-                        <bone fTranslate=3D"{[1]=3D0,[2]=3D0,[0]=3D0,}" iP=
arent=3D"0" fMatrix=3D"{[1]=3D0,[2]=3D0,[3]=3D0,[4]=3D1,[5]=3D0,[6]=3D0,[7]=
=3D0,[8]=3D1,[0]=3D1,}" fQuaternion=3D"{[1]=3D0,[2]=3D0,[3]=3D1,[0]=3D0,}" =
/>
-                    </bone>
-                    <bone>
-                        <bone fTranslate=3D"{[1]=3D0,[2]=3D0,[0]=3D0,}" iP=
arent=3D"0" fMatrix=3D"{[1]=3D0,[2]=3D0,[3]=3D0,[4]=3D1,[5]=3D0,[6]=3D0,[7]=
=3D0,[8]=3D1,[0]=3D1,}" fQuaternion=3D"{[1]=3D0,[2]=3D0,[3]=3D1,[0]=3D0,}" =
/>
-                    </bone>
-			...
-		</bones>
-	]]--
 	MyGrannyDump(Object.bones.skeleton.bonelist.childs,"bone","bone")
 	--[[
         <texture_info_list>
@@ -213,30 +188,6 @@
                 <id iID=3D"53" />
             </unknown_0xca5e0d00>
         </unhandled_0d01>
-	]]--
-	--[[
-        <boneTies2>
-            <boneties_container>
-                <bone_objptrs_container>
-                    <bone_objptr iBoneTie2ID=3D"1">
-                        <bone_objptrs iNum=3D"51">
-                            <BoneTies2 43=3D"1" 51=3D"37" 41=3D"2" 47=3D"2=
5" 37=3D"19" 45=3D"21" 35=3D"43" 49=3D"47" 39=3D"6" 29=3D"50" 1=3D"18" 3=3D=
"5" 2=3D"30" 5=3D"14" 4=3D"35" 7=3D"40" 6=3D"16" 9=3D"3" 8=3D"27" 27=3D"41"=
 17=3D"46" 13=3D"45" 21=3D"12" 11=3D"20" 23=3D"11" 42=3D"15" 40=3D"28" 50=
=3D"36" 36=3D"32" 46=3D"17" 34=3D"9" 44=3D"44" 48=3D"48" 28=3D"51" 38=3D"31=
" 33=3D"10" 32=3D"8" 31=3D"22" 30=3D"33" 15=3D"23" 18=3D"26" 19=3D"29" 25=
=3D"49" 14=3D"4" 24=3D"24" 16=3D"42" 26=3D"7" 20=3D"13" 12=3D"34" 22=3D"38"=
 10=3D"39" />
-                        </bone_objptrs>
-                        <end_bone_objptrs />
-                    </bone_objptr>
-                </bone_objptrs_container>
-                <bonetie_container>
-                    <bonetie_group iBoneTie2GroupID=3D"1">
-                        <bonetie_data />
-                        <bonetie_list>
-                            <bonetie>
-                                <bonetie iBone=3D"3" iUnknown=3D"{[1]=3D-7=
9.053795,[2]=3D-10.501988,[3]=3D-28.238644,[4]=3D78.682823,[5]=3D90.721489,=
[6]=3D107.114021,[0]=3D107.116005,}" />
-                            </bonetie>
-                            <bonetie>
-                                <bonetie iBone=3D"4" iUnknown=3D"{[1]=3D-7=
2.256584,[2]=3D-53.965584,[3]=3D-3.319712,[4]=3D93.162865,[5]=3D73.596008,[=
6]=3D98.508713,[0]=3D117.996071,}" />
-                            </bonetie>
-			...
-        </boneTies2>
 	]]--
 	local btcont =3D Object.boneTies2.boneties_container
 	local a =3D btcont.bone_objptrs_container.bone_objptr
@@ -263,41 +214,20 @@
 			...
 			=

 	]]--
+	function MyPrintField (obj,fieldname) print(fieldname,obj[fieldname]) end
+	MyPrintField(Object.texture_list.texture,"iTextureID")
+	MyPrintField(Object.texture_list.texture.texture_sublist.texture_poly.tex=
ture_poly_list,"iElementSize")
+	MyPrintField(Object.texture_list.texture.texture_sublist.texture_poly.tex=
ture_poly_list,"iNum")
 	MyGrannyDump(Object.texture_list.texture.texture_sublist.texture_poly.tex=
ture_poly_list.list_texpoly_normal,"list_texpoly_normal")
 	=

-	=

-	=

-	--[[
-        <object_list>
-            <object unknown_b=3D"1" unknown_a=3D"1">
-                <object_key_list>
-                    <object_key key=3D"2">
-                        <object_value_list>
-                            <object_value unknown_b=3D"3" unknown_a=3D"0" =
/>
-                        </object_value_list>
-                    </object_key>
-                    <object_key key=3D"4">
-                        <object_value_list>
-                            <object_value unknown_b=3D"5" unknown_a=3D"0" =
/>
-                        </object_value_list>
-                    </object_key>
-                    <object_key key=3D"6">
-                        <object_value_list>
-                            <object_value unknown_b=3D"0" unknown_a=3D"0" =
/>
-                        </object_value_list>
-                    </object_key>
-                </object_key_list>
-            </object>
-            <object unknown_b=3D"1" unknown_a=3D"1">...</object>
-			...
-	]]--
-	=

-	=

+	for k,entry in pairs(Object.texture_list.texture.texture_sublist.texture_=
poly.texture_poly_list.list_texpoly_normal) do assert(k-1 =3D=3D entry.iUnk=
nown) end -- todo : add as sanity check
+	=

+	=

+	=

+	-- TODO : testrun for asserts on all granny files
 	local objlist =3D {}
-	-- TODO : testrun for asserts on all granny files
 	for k,obj in ipairs(Object.object_list.childs) do
 		local keys =3D {}
-		--~ local myobj =3D {a=3Dobj.unknown_a,b=3Dobj.unknown_b,keys=3Dkeys}
 		assert(obj.unknown_a =3D=3D 1)
 		assert(obj.unknown_b =3D=3D 1)
 		local myobj =3D keys
@@ -307,19 +237,83 @@
 			assert(#values =3D=3D 1)
 			assert(values[1].unknown_a =3D=3D 0)
 			keys[key.key] =3D values[1].unknown_b
-			--~ local myvalues =3D {}
-			--~ myobj.keys[key.key] =3D myvalues
-			--~ for k3,value in ipairs(key.object_value_list.childs) do
-				--~ print("value",value.unknown_a,value.unknown_b)
-				--~ table.insert(myvalues,(value.unknown_b))
-				--~ assert(value.unknown_a =3D=3D 0,value.unknown_a)
-			--~ end
 		end
-		--~ print("obj",myobj.a,myobj.b,SmartDump(myobj.keys,3))
 	end
 	MyGrannyDump(objlist,"obj")
 	=

 	=

+	if (1 =3D=3D 1) then =

+		local bSkeletalAnimation =3D true
+		local bVertexAnimation =3D false
+		local vdecl =3D cVertexDecl:New()
+		vdecl:addElement(0,VET_FLOAT3,VES_POSITION)
+		vdecl:addElement(0,VET_FLOAT3,VES_NORMAL)
+		vdecl:addElement(1,VET_FLOAT2,VES_TEXTURE_COORDINATES)
+		--~ vdecl:PrintAutoOrganised(bSkeletalAnimation,bVertexAnimation)
+		=

+		local polygons		=3D mesh.polygons.list_polygons
+		local texpolys		=3D Object.texture_list.texture.texture_sublist.texture_=
poly.texture_poly_list.list_texpoly_normal
+		local positions		=3D point_container.points.list_points
+		local normals		=3D point_container.normals.list_normals
+		local texcoords		=3D point_container.texture_container.texcoords.list_te=
xcoords
+		local texcoords		=3D point_container.texture_container.texcoords.list_te=
xcoords
+		=

+		-- sanity checks
+		assert(#polygons =3D=3D #texpolys)
+		for k,texpoly in ipairs(texpolys) do assert(texpoly.iUnknown =3D=3D k-1)=
 end
+		=

+		local vb0 =3D cVertexBuffer:New()
+		local vb1 =3D cVertexBuffer:New()
+		local ib =3D cIndexBuffer:New()
+		local combo_next_i =3D 0
+		local combos =3D {}
+		=

+		for k,poly in pairs(polygons) do =

+			local texpoly =3D texpolys[k] =

+			for i=3D0,2 do =

+				local pi =3D poly.iVertex[i] + 1
+				local ni =3D poly.iNormal[i] + 1
+				local ti =3D (texpoly and texpoly.iTexCoord[i] or 0) + 1
+				--~ print("v",pi.."/"..#positions,ni.."/"..#normals,ti.."/"..#texcoord=
s)
+				local comboname =3D pi..","..ni..","..ti
+				local comboi =3D combos[comboname]
+				if (not comboi) then =

+					comboi =3D combo_next_i
+					combo_next_i =3D combo_next_i + 1
+					vb0:Vertex(	positions[pi].x,
+								positions[pi].y,
+								positions[pi].z,
+								normals[ni].x,
+								normals[ni].y,
+								normals[ni].z)
+					vb1:Vertex(	texcoords[ti].x,
+								texcoords[ti].y)
+					combos[comboname] =3D comboi
+				end
+				ib:Index(comboi)
+			end
+		end
+		vb0:CheckSize()
+		vb1:CheckSize()
+		print("vb0.vc",vb0.vc,vb0.iFirstSize)
+		print("vb1.vc",vb1.vc,vb1.iFirstSize)
+		print("ib.ic",ib.ic)
+		=

+		-- cRobRenderable
+		--~ cLugreLuaBind_Ogre_RenderOperation
+		--~ createAndBindVertexBuffer	(iVertexSize,iNumVerts,iUsage,bUseShadowBu=
ffer=3Dfalse,iBindIndex=3D0)
+		--~ createAndBindIndexBuffer	(iIndexType,iNumIndexes,iUsage,bUseShadowBu=
ffer=3Dfalse)
+		=

+		--[[                                                                    =
                                                                           =
        =

+			point   				1/557   {y=3D-0.710749,x=3D-0.767177,z=3D1.416132,}        =
                                                                           =
                                                                     =

+			normal 					1/553   {y=3D0,x=3D0,z=3D0,}                               =
                                                                           =
                                       =

+			texcoord   				1/2286  {y=3D0.082323,x=3D0.089491,z=3D0.418126,}       =
      2286/6/3 =3D 127                                                     =
                                           =

+			polygon 				1/1102  {iVertex1=3D3,iNormal2=3D4,iVertex2=3D4,iNormal3=3D=
140=3D0x8c,iNormal1=3D3,iVertex3=3D140=3D0x8c,}     =

+			polygon 				1/1102  {iVertex=3D{[1]=3D4,[2]=3D140=3D0x8c,[0]=3D3,},iNor=
mal=3D{[1]=3D4,[2]=3D140=3D0x8c,[0]=3D3,},}      =

+			list_texpoly_normal     1/1102  {iUnknown=3D0,iTexCoord=3D{[1]=3D724=3D=
0x02d4,[2]=3D736=3D0x02e0,[0]=3D723=3D0x02d3,},}
+		]]--
+		=

+	end
 	os.exit(0)
 end
 =

@@ -330,3 +324,57 @@
 	os.exit()
 end
 =

+-- ***** ***** ***** cVertexBuffer
+
+cVertexBuffer =3D CreateClass()
+function cVertexBuffer:Init() =

+	self.vc =3D 0
+	self.fifo =3D CreateFIFO()
+	self.quickfifo =3D self.fifo:GetQuickHandle()
+	self.bGetFirstSize =3D true
+	self.iFirstSize =3D 0
+end
+function cVertexBuffer:Destroy() =

+	self.fifo:Destroy() self.fifo =3D nil
+end
+
+local function cVertexBuffer_AddFloat(quickfifo,f,...)
+	if (not f) then return end
+	FIFO_PushF(quickfifo,f)
+	cVertexBuffer_AddFloat(quickfifo,...) -- recurse
+end
+
+function cVertexBuffer:Vertex(...)
+	local quickfifo =3D self.quickfifo
+	cVertexBuffer_AddFloat(quickfifo,...)
+	self.vc =3D self.vc + 1
+	if (self.bGetFirstSize) then =

+		self.bGetFirstSize =3D false
+		self.iFirstSize =3D self.fifo:Size()
+	end
+end
+
+function cVertexBuffer:CheckSize()
+	local a =3D self.iFirstSize * self.vc
+	local b =3D self.fifo:Size()
+	assert(a =3D=3D b,"size mismatch vc*first=3D"..a.." real=3D"..b)
+end
+
+-- ***** ***** ***** cIndexBuffer
+
+cIndexBuffer =3D CreateClass()
+function cIndexBuffer:Init() =

+	self.ic =3D 0
+	self.fifo =3D CreateFIFO()
+	self.quickfifo =3D self.fifo:GetQuickHandle()
+end
+function cIndexBuffer:Destroy() =

+	self.fifo:Destroy() self.fifo =3D nil
+end
+function cIndexBuffer:Index(i) =

+	FIFO_PushUint32(self.quickfifo,i)
+	self.ic =3D self.ic + 1
+end
+
+-- ***** ***** ***** end
+

Modified: trunk/lua/lib.granny.types.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.types.lua (original)
+++ trunk/lua/lib.granny.types.lua Sun Nov 22 01:14:19 2009
@@ -54,14 +54,14 @@
 	}
 =

 	self.structs.Polygon =3D {
-		{uint32	,"iVertex1"},
-		{uint32	,"iVertex2"},
-		{uint32	,"iVertex3"},
-		{uint32	,"iNormal1"},
-		{uint32	,"iNormal2"},
-		{uint32	,"iNormal3"},
-		--~ {uint32	,"iVertex",3},
-		--~ {uint32	,"iNormal",3},
+		--~ {uint32	,"iVertex1"},
+		--~ {uint32	,"iVertex2"},
+		--~ {uint32	,"iVertex3"},
+		--~ {uint32	,"iNormal1"},
+		--~ {uint32	,"iNormal2"},
+		--~ {uint32	,"iNormal3"},
+		{uint32	,"iVertex",3},
+		{uint32	,"iNormal",3},
 	}
 =

 	self.structs.TexturePolySmall =3D {



From no-reply at zwischenwelt.org  Sun Nov 22 14:17:15 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 22 Nov 2009 13:17:15 -0000
Subject: [Iris-commit] [IRIS] r3162 - /trunk/lua/lib.granny.debug.lua
Message-ID: <20091122131718.6E4157A9815D@simon>

Author: ghoulsblade
Date: Sun Nov 22 14:17:13 2009
New Revision: 3162

Log:
grannydebug : construction of ogre objects works ok, but it still crashes i=
n Client_RenderOneFrame

Modified:
    trunk/lua/lib.granny.debug.lua

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Sun Nov 22 14:17:13 2009
@@ -150,6 +150,7 @@
 		if (#arr =3D=3D 0) then print(name,"!!EMPTY!!",SmartDump(MyFilterFields(=
arr))) end
 		for k,entry in ipairs(arr) do if (k<=3D6) then print(name,k.."/"..#arr,S=
martDump(MyFilterFields(subfield and entry[subfield] or entry),levels or 2)=
) end end
 	end
+	function MyGrannyDump() end -- block output
 	=

 	local Object =3D grn.pMainChunk.Object
 	MyGrannyDump(Object.textChunk.texts,"text")
@@ -299,10 +300,54 @@
 		print("vb1.vc",vb1.vc,vb1.iFirstSize)
 		print("ib.ic",ib.ic)
 		=

-		-- cRobRenderable
-		--~ cLugreLuaBind_Ogre_RenderOperation
-		--~ createAndBindVertexBuffer	(iVertexSize,iNumVerts,iUsage,bUseShadowBu=
ffer=3Dfalse,iBindIndex=3D0)
-		--~ createAndBindIndexBuffer	(iIndexType,iNumIndexes,iUsage,bUseShadowBu=
ffer=3Dfalse)
+		=

+		=

+		--~ now ogre stuff : vertexbuffer,renderop,renderable,movable
+		=

+		local robmovable =3D CreateRobMovable()
+		local robrenderable =3D CreateRobRenderable(robmovable)
+		robmovable:AddRenderable(robrenderable)
+		=

+		local e =3D 10
+		robmovable:SetBounds({-e,-e,-e},{e,e,e})
+		robrenderable:SetMaterial("BaseWhiteNoLighting")
+		=

+		-- Ogre::Renderable::getRenderOperation(RenderOperation &op) ? hard to l=
uabind, also we'd get only a copy...
+		local renderop =3D robrenderable:GetRenderOperationPtr() -- Ogre::Render=
Operation
+		=

+		renderop:setOperationType(OT_TRIANGLE_LIST)
+		renderop:setVertexDecl(vdecl:GetOgreVertexDecl())
+		print("vb0:GetVertexSize()",vb0:GetVertexSize(),vb0:GetVertexNum())
+		print("vb1:GetVertexSize()",vb1:GetVertexSize(),vb1:GetVertexNum())
+		renderop:createAndBindVertexBuffer(vb0:GetVertexSize(),vb0:GetVertexNum(=
),HBU_DYNAMIC_WRITE_ONLY,false,0) -- (iVertexSize,iNumVerts,iUsage,bUseShad=
owBuffer=3Dfalse,iBindIndex=3D0)
+		renderop:createAndBindVertexBuffer(vb1:GetVertexSize(),vb1:GetVertexNum(=
),HBU_DYNAMIC_WRITE_ONLY,false,1) -- (iVertexSize,iNumVerts,iUsage,bUseShad=
owBuffer=3Dfalse,iBindIndex=3D0)
+		renderop:createAndBindIndexBuffer(IT_32BIT,ib:GetIndexNum(),HBU_DYNAMIC_=
WRITE_ONLY,false) -- (iIndexType,iNumIndexes,iUsage,bUseShadowBuffer=3Dfals=
e)
+		=

+		renderop:setVertexCount(vb0:GetVertexNum())
+		renderop:setIndexCount(ib:GetIndexNum())
+		=

+		renderop:writeToVertexBuffer(vb0:GetFIFO(),0)
+		renderop:writeToVertexBuffer(vb1:GetFIFO(),1)
+		renderop:writeToIndexBuffer(ib:GetFIFO())
+		=

+		local gfx =3D CreateRootGfx3D()
+		local scenenode =3D gfx:GetSceneNode()
+		scenenode:attachObject(robmovable)
+		=

+		=

+		--[[
+		=

+		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_STATIC)
+		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_DYNAMIC)
+		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_WRITE_ONLY)
+		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_DISCARDABLE)
+		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_STATIC_WRITE_ONLY)
+		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_DYNAMIC_WRITE_ONLY)
+		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_DYNAMIC_WRITE_ONLY_DISCA=
RDABLE)
+		=

+		]]--
+		=

+		-- todo : mousepick
 		=

 		--[[                                                                    =
                                                                           =
        =

 			point   				1/557   {y=3D-0.710749,x=3D-0.767177,z=3D1.416132,}        =
                                                                           =
                                                                     =

@@ -314,7 +359,7 @@
 		]]--
 		=

 	end
-	os.exit(0)
+	--~ os.exit(0)
 end
 =

 function GrannyTest_PreOgreInit2 ()
@@ -354,6 +399,9 @@
 	end
 end
 =

+function cVertexBuffer:GetFIFO() return self.fifo end
+function cVertexBuffer:GetVertexNum() return self.vc end
+function cVertexBuffer:GetVertexSize() return self.iFirstSize end
 function cVertexBuffer:CheckSize()
 	local a =3D self.iFirstSize * self.vc
 	local b =3D self.fifo:Size()
@@ -371,6 +419,8 @@
 function cIndexBuffer:Destroy() =

 	self.fifo:Destroy() self.fifo =3D nil
 end
+function cIndexBuffer:GetFIFO() return self.fifo end
+function cIndexBuffer:GetIndexNum() return self.ic end
 function cIndexBuffer:Index(i) =

 	FIFO_PushUint32(self.quickfifo,i)
 	self.ic =3D self.ic + 1



From no-reply at zwischenwelt.org  Sun Nov 22 19:58:47 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 22 Nov 2009 18:58:47 -0000
Subject: [Iris-commit] [IRIS] r3163 - /trunk/lua/lib.granny.debug.lua
Message-ID: <20091122185848.A4BB87A9815D@simon>

Author: ghoulsblade
Date: Sun Nov 22 19:58:46 2009
New Revision: 3163

Log:
grannydebug : neutral pose successfully rendered

Modified:
    trunk/lua/lib.granny.debug.lua

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Sun Nov 22 19:58:46 2009
@@ -300,52 +300,41 @@
 		print("vb1.vc",vb1.vc,vb1.iFirstSize)
 		print("ib.ic",ib.ic)
 		=

-		=

-		=

 		--~ now ogre stuff : vertexbuffer,renderop,renderable,movable
 		=

 		local robmovable =3D CreateRobMovable()
+		=

 		local robrenderable =3D CreateRobRenderable(robmovable)
 		robmovable:AddRenderable(robrenderable)
 		=

 		local e =3D 10
 		robmovable:SetBounds({-e,-e,-e},{e,e,e})
+		robmovable:ParentNeedsUpdate()
 		robrenderable:SetMaterial("BaseWhiteNoLighting")
 		=

 		-- Ogre::Renderable::getRenderOperation(RenderOperation &op) ? hard to l=
uabind, also we'd get only a copy...
 		local renderop =3D robrenderable:GetRenderOperationPtr() -- Ogre::Render=
Operation
-		=

 		renderop:setOperationType(OT_TRIANGLE_LIST)
 		renderop:setVertexDecl(vdecl:GetOgreVertexDecl())
 		print("vb0:GetVertexSize()",vb0:GetVertexSize(),vb0:GetVertexNum())
 		print("vb1:GetVertexSize()",vb1:GetVertexSize(),vb1:GetVertexNum())
 		renderop:createAndBindVertexBuffer(vb0:GetVertexSize(),vb0:GetVertexNum(=
),HBU_DYNAMIC_WRITE_ONLY,false,0) -- (iVertexSize,iNumVerts,iUsage,bUseShad=
owBuffer=3Dfalse,iBindIndex=3D0)
 		renderop:createAndBindVertexBuffer(vb1:GetVertexSize(),vb1:GetVertexNum(=
),HBU_DYNAMIC_WRITE_ONLY,false,1) -- (iVertexSize,iNumVerts,iUsage,bUseShad=
owBuffer=3Dfalse,iBindIndex=3D0)
-		renderop:createAndBindIndexBuffer(IT_32BIT,ib:GetIndexNum(),HBU_DYNAMIC_=
WRITE_ONLY,false) -- (iIndexType,iNumIndexes,iUsage,bUseShadowBuffer=3Dfals=
e)
-		=

+		renderop:createAndBindIndexBuffer(IT_32BIT,ib:GetIndexNum(),HBU_STATIC_W=
RITE_ONLY) -- (iIndexType,iNumIndexes,iUsage,bUseShadowBuffer=3Dfalse)
+		=

+		renderop:setVertexStart(0)
+		renderop:setIndexStart(0)
 		renderop:setVertexCount(vb0:GetVertexNum())
 		renderop:setIndexCount(ib:GetIndexNum())
 		=

 		renderop:writeToVertexBuffer(vb0:GetFIFO(),0)
 		renderop:writeToVertexBuffer(vb1:GetFIFO(),1)
-		renderop:writeToIndexBuffer(ib:GetFIFO())
+		renderop:writeToIndexBuffer(ib:GetFIFO()) =

 		=

 		local gfx =3D CreateRootGfx3D()
 		local scenenode =3D gfx:GetSceneNode()
 		scenenode:attachObject(robmovable)
 		=

-		=

-		--[[
-		=

-		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_STATIC)
-		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_DYNAMIC)
-		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_WRITE_ONLY)
-		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_DISCARDABLE)
-		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_STATIC_WRITE_ONLY)
-		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_DYNAMIC_WRITE_ONLY)
-		LUABIND_PrefixConstant(Ogre::HardwareBuffer,HBU_DYNAMIC_WRITE_ONLY_DISCA=
RDABLE)
-		=

-		]]--
 		=

 		-- todo : mousepick
 		=




From no-reply at zwischenwelt.org  Tue Nov 24 17:54:25 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 24 Nov 2009 16:54:25 -0000
Subject: [Iris-commit] [IRIS] r3164 - /trunk/lua/main.lua
Message-ID: <20091124165425.A72D87A98162@simon>

Author: ghoulsblade
Date: Tue Nov 24 17:54:24 2009
New Revision: 3164

Log:
gfxconfig : crashdetect for crashes inside CollectOgreResLocs

Modified:
    trunk/lua/main.lua

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Tue Nov 24 17:54:24 2009
@@ -438,9 +438,9 @@
 			GfxConfig_Apply()
 			GfxConfig_PreWindowCreate()
 			if (not OgreCreateWindow(false)) then os.exit(0) end
-			GfxConfig_PostWindowCreate()
 		end
         CollectOgreResLocs()
+		GfxConfig_PostWindowCreate()
     end
     print("initializing ogre done")
     SetCursorBaseOffset(0,0)



From no-reply at zwischenwelt.org  Tue Nov 24 19:34:19 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 24 Nov 2009 18:34:19 -0000
Subject: [Iris-commit] [IRIS] r3165 - in /trunk/lua: lib.granny.debug.lua
	lib.granny.loader.lua
Message-ID: <20091124183420.32AAB7A98162@simon>

Author: ghoulsblade
Date: Tue Nov 24 19:34:19 2009
New Revision: 3165

Log:
grannydebug : beetle walk anim : multiple submeshes

Modified:
    trunk/lua/lib.granny.debug.lua
    trunk/lua/lib.granny.loader.lua

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Tue Nov 24 19:34:19 2009
@@ -11,7 +11,6 @@
     --~ {artid=3D400, content=3D{}},
     --~ {artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D542=
2,animid=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{ar=
tid=3D5441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=
=3D700},})},
 =

-	   =

 	--~ PrintBrokenGrannyInfo   257                               DreadHorn  =
   gBrokenGrannyModelIdList
 	--~ PrintBrokenGrannyInfo   774                               Dawn_Girl  =
   gBrokenGrannyModelIdList
 	--~ PrintBrokenGrannyInfo   276                                Raptalon  =
   gGrannyFilter   60      nil
@@ -40,7 +39,6 @@
 	--~ PrintBrokenGrannyInfo   276                                Raptalon  =
   gMountGrannyOverride    105
 	--~ PrintBrokenGrannyInfo   179                 equines_horse_nightmare  =
   gMountGrannyOverride    200
 	--~ PrintBrokenGrannyInfo   115                  equines_horse_ethereal  =
   gMountGrannyOverride    200
-
 }
 =

 function StartDebugGrannyMenu () cDebugGrannyMenu:StartMenu() end
@@ -57,7 +55,7 @@
 	self:MakeGrid({0,0,0},{1,0,0},{0,1,0},5,5,true)
 	=

 	local modelid =3D 791 -- giant_beetle
-	--~ local modelid =3D 200 -- standard horse
+	local modelid =3D 200 -- standard horse
 	--~ self:MakeOldGranny(modelid)
 	self:MakeNewGranny(modelid)
 	=

@@ -123,15 +121,63 @@
 	=

 	-- todo : stitchin ? gStitchinLoader[oldelement.modelid] ..
 end
-	=

-
-function cDebugGrannyMenu:MakeNewGranny (artid) =

+
+
+gGrannyDebug_Anims_Horse =3D {			"Equines_Horse_Dappled_Brown_Attack1.grn"=
,     =

+										"Equines_Horse_Dappled_Brown_Fidget.grn",      =

+										"Equines_Horse_Dappled_Brown_Lod2.grn",        =

+										"Equines_Horse_Dappled_Brown_Walk.grn",
+										"Equines_Horse_Dappled_Brown_Die1.grn",        =

+										"Equines_Horse_Dappled_Brown_Gethit.grn",      =

+										"Equines_Horse_Dappled_Brown_Pack_Lod2.grn",
+										"Equines_Horse_Dappled_Brown_Eat.grn",         =

+										"Equines_Horse_Dappled_Brown_Idle.grn",        =

+										"Equines_Horse_Dappled_Brown_Run.grn",
+									}
+gGrannyDebug_Anims_Beetle =3D {			"Giant_Beetle_Fire_LOD2.grn",           =
           =

+										"Giant_Beetle_Attack1.grn",                        =

+										"Giant_Beetle_Idle.grn",                           =

+										"Giant_Beetle_Fidget.grn",                         =

+										"Giant_Beetle_Fidget2.grn",                        =

+										"Giant_Beetle_Attack3.grn",                        =

+										"Giant_Beetle_ethereal_LOD2.grn",                  =

+										"Giant_Beetle_Lod2.grn",                           =

+										"Giant_Beetle_Walk.grn",                           =

+										"Giant_Beetle_Die1.grn",
+										"Giant_Beetle_Attack2.grn",
+										"Giant_Beetle_GetHit.grn",
+										"Giant_Beetle_Run.grn",
+									}
+
+function cDebugGrannyMenu:MakeNewGranny (artid)
+	artid =3D 791 -- beetle
+	--~ artid =3D 200 -- horse
+	=

+	gDebugCategories.granny 	=3D true
+	local folder =3D "/cavern/uoml_freshinstall.4.x/Models/Animals/"
+	=

+	local matname =3D GetGrannyMat(artid,0,GetGrannyModelLoader(artid))
 	print("=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D MakeNewGranny")
 	local filepath =3D GetGrannyFilePath(artid)
+	--~ filepath =3D folder.."Giant_Beetle_Walk.grn"
 	print("granny path for artid",artid,filepath)
 	local grn =3D cGrannyFile:New()
 	grn:LoadFile(filepath)
-	--~ grn:XMLDump("../mygranny.xml") =

+	=

+	if (1 =3D=3D 2) then =

+			for k,filename in pairs(gGrannyDebug_Anims_Horse) do =

+				local grn2 =3D cGrannyFile:New()
+				grn2:LoadFile(folder..filename)
+				--~ grn2:XMLDump("../mygranny/mygranny.horse."..filename..".xml") =

+			end
+			local folder =3D "/cavern/uoml_freshinstall.4.x/Models/Animals/"
+			for k,filename in pairs(gGrannyDebug_Anims_Beetle) do =

+				local grn2 =3D cGrannyFile:New()
+				grn2:LoadFile(folder..filename)
+				--~ grn2:XMLDump("../mygranny/mygranny.beetle."..filename..".xml") =

+			end
+	end
+	=

 	=

 	function MyGetChunkT (iChunkType) return iChunkType and grn.kTypeNames[iC=
hunkType] or nil end
 	function MyDump (obj) =

@@ -147,10 +193,11 @@
 		return res
 	end
 	function MyGrannyDump(arr,name,subfield,levels)
+		if (not arr) then print(name,"!!NIL!!") return end
 		if (#arr =3D=3D 0) then print(name,"!!EMPTY!!",SmartDump(MyFilterFields(=
arr))) end
 		for k,entry in ipairs(arr) do if (k<=3D6) then print(name,k.."/"..#arr,S=
martDump(MyFilterFields(subfield and entry[subfield] or entry),levels or 2)=
) end end
 	end
-	function MyGrannyDump() end -- block output
+	--~ function MyGrannyDump() end -- block output
 	=

 	local Object =3D grn.pMainChunk.Object
 	MyGrannyDump(Object.textChunk.texts,"text")
@@ -160,68 +207,28 @@
 	local point_container =3D mesh.point_block.point_container
 	MyGrannyDump(point_container.points.list_points,"point")
 	MyGrannyDump(point_container.normals.list_normals,"normal")
-	print("texcoords:unknown:",point_container.texture_container.texcoords.un=
known)
-	MyGrannyDump(point_container.texture_container.texcoords.list_texcoords,"=
texcoord")
+	if (point_container.texture_container.texcoords) then
+		print("texcoords:unknown:",	point_container.texture_container.texcoords.=
unknown)
+		MyGrannyDump(point_container.texture_container.texcoords.list_texcoords,=
"texcoord")
+	end
 	=

 	print("weights:",SmartDump(MyFilterFields(mesh.weights)))
 	MyGrannyDump(mesh.weights.list_weights,"weight")
 	MyGrannyDump(mesh.polygons.list_polygons,"polygon")
 	MyGrannyDump(Object.boneTies1.childs,"boneTies1:boneobject")
 	MyGrannyDump(Object.bones.skeleton.bonelist.childs,"bone","bone")
-	--[[
-        <texture_info_list>
-            <texture_info>
-                <unknown_0xca5e0305>
-                    <texinfo>
-                        <texinfo iWidth=3D"256" iHeight=3D"256" iDepth=3D"=
7" />
-                    </texinfo>
-                </unknown_0xca5e0305>
-                <id iID=3D"3" />
-            </texture_info>
-        </texture_info_list>
-	]]--
-	--[[
-        <unhandled_0d01>
-            <unknown_0xca5e0d00>
-                <unknown_0xca5e0d03>
-                    <hexdump offset=3D"92132" len=3D"12" />
-                </unknown_0xca5e0d03>
-                <id iID=3D"53" />
-            </unknown_0xca5e0d00>
-        </unhandled_0d01>
-	]]--
 	local btcont =3D Object.boneTies2.boneties_container
 	local a =3D btcont.bone_objptrs_container.bone_objptr
 	local b =3D btcont.bonetie_container.bonetie_group.bonetie_list
 	print("iBoneTie2ID=3D",a.iBoneTie2ID,"bone_objptrs.iNum=3D",a.bone_objptr=
s.iNum)
 	MyGrannyDump(a.bone_objptrs.BoneTies2,"bt2:bone_objptr")
 	MyGrannyDump(b.childs,"bt2:bonetie","bonetie")
-	--[[
-        <texture_list>
-            <texture iTextureID=3D"1">
-                <texture_sublist>
-                    <texture_poly>
-                        <iTexturePoly a=3D"0" b=3D"1" />
-                        <texture_poly_datalist>
-                            <texture_poly_data2>
-                                <hexdump offset=3D"93204" len=3D"12" />
-                            </texture_poly_data2>
-                            <texture_poly_data1 iTexturePolyData=3D"0" />
-                        </texture_poly_datalist>
-                        <texture_poly_list iElementSize=3D"16" iNum=3D"110=
2">
-                            <list_texpoly_normal>
-                                <entry iUnknown=3D"0" iTexCoord=3D"{[1]=3D=
724=3D0x02d4,[2]=3D736=3D0x02e0,[0]=3D723=3D0x02d3,}" />
-                                <entry iUnknown=3D"1" iTexCoord=3D"{[1]=3D=
734=3D0x02de,[2]=3D723=3D0x02d3,[0]=3D735=3D0x02df,}" />
-			...
-			=

-	]]--
 	function MyPrintField (obj,fieldname) print(fieldname,obj[fieldname]) end
 	MyPrintField(Object.texture_list.texture,"iTextureID")
 	MyPrintField(Object.texture_list.texture.texture_sublist.texture_poly.tex=
ture_poly_list,"iElementSize")
 	MyPrintField(Object.texture_list.texture.texture_sublist.texture_poly.tex=
ture_poly_list,"iNum")
 	MyGrannyDump(Object.texture_list.texture.texture_sublist.texture_poly.tex=
ture_poly_list.list_texpoly_normal,"list_texpoly_normal")
-	=

-	for k,entry in pairs(Object.texture_list.texture.texture_sublist.texture_=
poly.texture_poly_list.list_texpoly_normal) do assert(k-1 =3D=3D entry.iUnk=
nown) end -- todo : add as sanity check
+	--~ for k,entry in pairs(Object.texture_list.texture.texture_sublist.text=
ure_poly.texture_poly_list.list_texpoly_normal) do assert(k-1 =3D=3D entry.=
iUnknown) end -- todo : add as sanity check
 	=

 	=

 	=

@@ -242,8 +249,7 @@
 	end
 	MyGrannyDump(objlist,"obj")
 	=

-	=

-	if (1 =3D=3D 1) then =

+	function MyMakeGrannyGfx (mesh,texture_poly) =

 		local bSkeletalAnimation =3D true
 		local bVertexAnimation =3D false
 		local vdecl =3D cVertexDecl:New()
@@ -252,16 +258,19 @@
 		vdecl:addElement(1,VET_FLOAT2,VES_TEXTURE_COORDINATES)
 		--~ vdecl:PrintAutoOrganised(bSkeletalAnimation,bVertexAnimation)
 		=

-		local polygons		=3D mesh.polygons.list_polygons
-		local texpolys		=3D Object.texture_list.texture.texture_sublist.texture_=
poly.texture_poly_list.list_texpoly_normal
-		local positions		=3D point_container.points.list_points
-		local normals		=3D point_container.normals.list_normals
-		local texcoords		=3D point_container.texture_container.texcoords.list_te=
xcoords
-		local texcoords		=3D point_container.texture_container.texcoords.list_te=
xcoords
+		local polygons			=3D mesh.polygons.list_polygons
+		local point_container 	=3D mesh.point_block.point_container
+		local positions			=3D point_container.points.list_points
+		local normals			=3D point_container.normals.list_normals
+		local texcoords			=3D point_container.texture_container.texcoords and
+								  point_container.texture_container.texcoords.list_texcoords
+		local texpolys			=3D texture_poly.texture_poly_list.list_texpoly_normal
 		=

 		-- sanity checks
-		assert(#polygons =3D=3D #texpolys)
-		for k,texpoly in ipairs(texpolys) do assert(texpoly.iUnknown =3D=3D k-1)=
 end
+		if (texpolys) then =

+			assert(#polygons =3D=3D #texpolys)
+			for k,texpoly in ipairs(texpolys) do assert(texpoly.iUnknown =3D=3D k-1=
) end
+		end
 		=

 		local vb0 =3D cVertexBuffer:New()
 		local vb1 =3D cVertexBuffer:New()
@@ -270,12 +279,11 @@
 		local combos =3D {}
 		=

 		for k,poly in pairs(polygons) do =

-			local texpoly =3D texpolys[k] =

+			local texpoly =3D texpolys and texpolys[k] =

 			for i=3D0,2 do =

 				local pi =3D poly.iVertex[i] + 1
 				local ni =3D poly.iNormal[i] + 1
 				local ti =3D (texpoly and texpoly.iTexCoord[i] or 0) + 1
-				--~ print("v",pi.."/"..#positions,ni.."/"..#normals,ti.."/"..#texcoord=
s)
 				local comboname =3D pi..","..ni..","..ti
 				local comboi =3D combos[comboname]
 				if (not comboi) then =

@@ -287,8 +295,12 @@
 								normals[ni].x,
 								normals[ni].y,
 								normals[ni].z)
-					vb1:Vertex(	texcoords[ti].x,
-								texcoords[ti].y)
+					if (texcoords) then =

+						vb1:Vertex(	texcoords[ti].x,
+									texcoords[ti].y)
+					else
+						vb1:Vertex(math.random(),math.random())
+					end
 					combos[comboname] =3D comboi
 				end
 				ib:Index(comboi)
@@ -296,9 +308,10 @@
 		end
 		vb0:CheckSize()
 		vb1:CheckSize()
-		print("vb0.vc",vb0.vc,vb0.iFirstSize)
-		print("vb1.vc",vb1.vc,vb1.iFirstSize)
-		print("ib.ic",ib.ic)
+		--~ print("vb0.vc",vb0.vc,vb0.iFirstSize)
+		--~ print("vb1.vc",vb1.vc,vb1.iFirstSize)
+		--~ print("ib.ic",ib.ic)
+		=

 		=

 		--~ now ogre stuff : vertexbuffer,renderop,renderable,movable
 		=

@@ -310,14 +323,15 @@
 		local e =3D 10
 		robmovable:SetBounds({-e,-e,-e},{e,e,e})
 		robmovable:ParentNeedsUpdate()
-		robrenderable:SetMaterial("BaseWhiteNoLighting")
+		robrenderable:SetMaterial(matname)
+		--~ robrenderable:SetMaterial("BaseWhiteNoLighting")
 		=

 		-- Ogre::Renderable::getRenderOperation(RenderOperation &op) ? hard to l=
uabind, also we'd get only a copy...
 		local renderop =3D robrenderable:GetRenderOperationPtr() -- Ogre::Render=
Operation
 		renderop:setOperationType(OT_TRIANGLE_LIST)
 		renderop:setVertexDecl(vdecl:GetOgreVertexDecl())
-		print("vb0:GetVertexSize()",vb0:GetVertexSize(),vb0:GetVertexNum())
-		print("vb1:GetVertexSize()",vb1:GetVertexSize(),vb1:GetVertexNum())
+		--~ print("vb0:GetVertexSize()",vb0:GetVertexSize(),vb0:GetVertexNum())
+		--~ print("vb1:GetVertexSize()",vb1:GetVertexSize(),vb1:GetVertexNum())
 		renderop:createAndBindVertexBuffer(vb0:GetVertexSize(),vb0:GetVertexNum(=
),HBU_DYNAMIC_WRITE_ONLY,false,0) -- (iVertexSize,iNumVerts,iUsage,bUseShad=
owBuffer=3Dfalse,iBindIndex=3D0)
 		renderop:createAndBindVertexBuffer(vb1:GetVertexSize(),vb1:GetVertexNum(=
),HBU_DYNAMIC_WRITE_ONLY,false,1) -- (iVertexSize,iNumVerts,iUsage,bUseShad=
owBuffer=3Dfalse,iBindIndex=3D0)
 		renderop:createAndBindIndexBuffer(IT_32BIT,ib:GetIndexNum(),HBU_STATIC_W=
RITE_ONLY) -- (iIndexType,iNumIndexes,iUsage,bUseShadowBuffer=3Dfalse)
@@ -335,21 +349,77 @@
 		local scenenode =3D gfx:GetSceneNode()
 		scenenode:attachObject(robmovable)
 		=

-		=

 		-- todo : mousepick
 		=

-		--[[                                                                    =
                                                                           =
        =

-			point   				1/557   {y=3D-0.710749,x=3D-0.767177,z=3D1.416132,}        =
                                                                           =
                                                                     =

-			normal 					1/553   {y=3D0,x=3D0,z=3D0,}                               =
                                                                           =
                                       =

-			texcoord   				1/2286  {y=3D0.082323,x=3D0.089491,z=3D0.418126,}       =
      2286/6/3 =3D 127                                                     =
                                           =

-			polygon 				1/1102  {iVertex1=3D3,iNormal2=3D4,iVertex2=3D4,iNormal3=3D=
140=3D0x8c,iNormal1=3D3,iVertex3=3D140=3D0x8c,}     =

-			polygon 				1/1102  {iVertex=3D{[1]=3D4,[2]=3D140=3D0x8c,[0]=3D3,},iNor=
mal=3D{[1]=3D4,[2]=3D140=3D0x8c,[0]=3D3,},}      =

-			list_texpoly_normal     1/1102  {iUnknown=3D0,iTexCoord=3D{[1]=3D724=3D=
0x02d4,[2]=3D736=3D0x02e0,[0]=3D723=3D0x02d3,},}
-		]]--
-		=

-	end
+		=

+	end
+	=

+	=

+	--~ local mesh			=3D Object.mesh_list.childs[1] -- .mesh*26
+	--~ local texture_poly	=3D Object.texture_list.texture.texture_sublist.ch=
ilds[1] -- .texture_poly -- *26
+	for k,mesh in ipairs(Object.mesh_list.childs) do
+		local texture_poly =3D Object.texture_list.texture.texture_sublist.child=
s[k]
+		MyMakeGrannyGfx (mesh,texture_poly) =

+	end
+	=

 	--~ os.exit(0)
 end
+
+
+--[[                                                                      =
                                                                           =
      =

+	point   				1/557   {y=3D-0.710749,x=3D-0.767177,z=3D1.416132,}          =
                                                                           =
                                                                   =

+	normal 					1/553   {y=3D0,x=3D0,z=3D0,}                                 =
                                                                           =
                                     =

+	texcoord   				1/2286  {y=3D0.082323,x=3D0.089491,z=3D0.418126,}         =
    2286/6/3 =3D 127                                                       =
                                         =

+	polygon 				1/1102  {iVertex1=3D3,iNormal2=3D4,iVertex2=3D4,iNormal3=3D14=
0=3D0x8c,iNormal1=3D3,iVertex3=3D140=3D0x8c,}     =

+	polygon 				1/1102  {iVertex=3D{[1]=3D4,[2]=3D140=3D0x8c,[0]=3D3,},iNorma=
l=3D{[1]=3D4,[2]=3D140=3D0x8c,[0]=3D3,},}      =

+	list_texpoly_normal     1/1102  {iUnknown=3D0,iTexCoord=3D{[1]=3D724=3D0x=
02d4,[2]=3D736=3D0x02e0,[0]=3D723=3D0x02d3,},}
+
+
+-- animation : =

+-- GetOrCreateSkeleton : load all bodyparts, load all anims, add to skelet=
on : (single CreateSkeleton(skeletonname))   mygrannyanim:AddAnimToSkeleton=
(skeleton.name,animname,bodypartsamples)
+-- grannyogreloader.cpp : int iCurBoneNum =3D mpGrannyLoader->FindBone(mpG=
rannyLoader->GetBoneName2(pAnim.mpAnim->iID-1));
+-- beetle : walk hat eigenes mesh ?!? (MEHRERE SUBMESHES!)    /cavern/uoml=
_freshinstall.4.x/Models/Animals/Giant_Beetle_Walk.grn   ne, nur so hilfobj=
ekte krams oder sowas...
+
+-- bones
+
+
+
+-- comparison beetle vs horse =

+beetle...meshlist.mesh	: <id iID=3D"5" />
+horse...meshlist.mesh	: <id iID=3D"1" />
+				 =

+				 =

+one anim per file!
+[ghoul at washu] /cavern/code/iris> dir /cavern/uoml_freshinstall.4.x/Models/=
Animals/Equines_Horse_Dappled_Brown
+Equines_Horse_Dappled_Brown_Attack1.grn     Equines_Horse_Dappled_Brown_Fi=
dget.grn      Equines_Horse_Dappled_Brown_Lod2.grn        Equines_Horse_Dap=
pled_Brown_Walk.grn
+Equines_Horse_Dappled_Brown_Die1.grn        Equines_Horse_Dappled_Brown_Ge=
thit.grn      Equines_Horse_Dappled_Brown_Pack_Lod2.grn
+Equines_Horse_Dappled_Brown_Eat.grn         Equines_Horse_Dappled_Brown_Id=
le.grn        Equines_Horse_Dappled_Brown_Run.grn
+
+																															  =

+point  					1/223   {y=3D0.547549,x=3D-0.281395,z=3D1.035676,}            =
                                                                 =

+texcoord        		1/222   {y=3D0.689825,x=3D-0.101103,z=3D1,}   =

+polygon 				1/442   {iVertex=3D{[1]=3D83=3D0x53,[2]=3D72=3D0x48,[0]=3D82=
=3D0x52,},iNormal=3D{[1]=3D83=3D0x53,[2]=3D72=3D0x48,[0]=3D82=3D0x52,},}   =

+list_texpoly_normal     1/442   {iUnknown=3D0,iTexCoord=3D{[1]=3D45=3D0x2d=
,[2]=3D43=3D0x2b,[0]=3D29=3D0x1d,},}
+
+	=

+
+weights:       					 {unknown_b=3D2,wnum=3D223=3D0xdf,unknown_a=3D32=3D0x2=
0,list_weights=3Dtable: 0xaf93098,}  =

+weight  				1/809   {w=3D0.000000,}            =

+boneTies1:boneobject    1/37    {childs=3D{[1]=3Dtable: 0xa538fd0,},} =

+bone   					1/37    {fTranslate=3D{[1]=3D0,[2]=3D0,[0]=3D0,},iParent=3D0,f=
Matrix=3D{[1]=3D0,[2]=3D0,[3]=3D0,[4]=3D1,[5]=3D0,[6]=3D0,[7]=3D0,[8]=3D1,[=
0]=3D1,},fQuaternion=3D{[1]=3D0,[2]=3D0,[3]=3D1,[0]=3D0,},}
+iBoneTie2ID=3D    				1       bone_objptrs.iNum=3D      37
+bt2:bone_objptr 		1/37    4
+bt2:bonetie     		1/33    {iBone=3D5,iUnknown=3D{[1]=3D-0.058629,[2]=3D-0.=
237984,[3]=3D-0.162302,[4]=3D0.358194,[5]=3D0.183488,[6]=3D0.102694,[0]=3D0=
.367406,},}
+obj    					1/40    {[2]=3D3,[4]=3D5,[6]=3D0,}
+
+Ogre::Quaternion	GetBoneRotate		(const GrannyBone* pGrannyBone) {
+	return Ogre::Quaternion(pGrannyBone ? pGrannyBone->fQuaternion[3]:1, // o=
gre:w,x,y,z  granny:x,y,z,w
+							pGrannyBone ? pGrannyBone->fQuaternion[0]:0,
+							pGrannyBone ? pGrannyBone->fQuaternion[1]:0,
+							pGrannyBone ? pGrannyBone->fQuaternion[2]:0);
+}
+			=

+]]--
 =

 function GrannyTest_PreOgreInit2 ()
     if (not gUOPath) then AutoDetectUOPath() end
@@ -358,62 +428,5 @@
 	os.exit()
 end
 =

--- ***** ***** ***** cVertexBuffer
-
-cVertexBuffer =3D CreateClass()
-function cVertexBuffer:Init() =

-	self.vc =3D 0
-	self.fifo =3D CreateFIFO()
-	self.quickfifo =3D self.fifo:GetQuickHandle()
-	self.bGetFirstSize =3D true
-	self.iFirstSize =3D 0
-end
-function cVertexBuffer:Destroy() =

-	self.fifo:Destroy() self.fifo =3D nil
-end
-
-local function cVertexBuffer_AddFloat(quickfifo,f,...)
-	if (not f) then return end
-	FIFO_PushF(quickfifo,f)
-	cVertexBuffer_AddFloat(quickfifo,...) -- recurse
-end
-
-function cVertexBuffer:Vertex(...)
-	local quickfifo =3D self.quickfifo
-	cVertexBuffer_AddFloat(quickfifo,...)
-	self.vc =3D self.vc + 1
-	if (self.bGetFirstSize) then =

-		self.bGetFirstSize =3D false
-		self.iFirstSize =3D self.fifo:Size()
-	end
-end
-
-function cVertexBuffer:GetFIFO() return self.fifo end
-function cVertexBuffer:GetVertexNum() return self.vc end
-function cVertexBuffer:GetVertexSize() return self.iFirstSize end
-function cVertexBuffer:CheckSize()
-	local a =3D self.iFirstSize * self.vc
-	local b =3D self.fifo:Size()
-	assert(a =3D=3D b,"size mismatch vc*first=3D"..a.." real=3D"..b)
-end
-
--- ***** ***** ***** cIndexBuffer
-
-cIndexBuffer =3D CreateClass()
-function cIndexBuffer:Init() =

-	self.ic =3D 0
-	self.fifo =3D CreateFIFO()
-	self.quickfifo =3D self.fifo:GetQuickHandle()
-end
-function cIndexBuffer:Destroy() =

-	self.fifo:Destroy() self.fifo =3D nil
-end
-function cIndexBuffer:GetFIFO() return self.fifo end
-function cIndexBuffer:GetIndexNum() return self.ic end
-function cIndexBuffer:Index(i) =

-	FIFO_PushUint32(self.quickfifo,i)
-	self.ic =3D self.ic + 1
-end
-
 -- ***** ***** ***** end
 =


Modified: trunk/lua/lib.granny.loader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.loader.lua (original)
+++ trunk/lua/lib.granny.loader.lua Tue Nov 24 19:34:19 2009
@@ -63,7 +63,7 @@
 function cGrannyFile:MetaIndex (typename) =

 	local typeid =3D cGrannyFile.kTypeByName[typename]
 	--~ print("cGrannyFile:MetaIndex",self,typename,typeid) =

-	if (typeid) then for k,obj in ipairs(self.childs) do if (obj.iChunkType =
=3D=3D typeid) then return obj end end end -- self is not a cGrannyFile here
+	if (typeid and self.childs) then for k,obj in ipairs(self.childs) do if (=
obj.iChunkType =3D=3D typeid) then return obj end end end -- self is not a =
cGrannyFile here
 end
 cGrannyFile.pItemMetaTable =3D { __index =3D cGrannyFile.MetaIndex }
 =

@@ -450,7 +450,7 @@
 cGrannyFile.chunkHandlers[0xCA5E0303] =3D function (self,iOffset,iSize,chu=
nk) =

 	assert(self:GetRootParentType() =3D=3D 0XCA5E0304) =

 	if (iSize ~=3D self.size.TexInfo) then printdebug("granny","WARNING ! gra=
nny 0xCA5E0303 : size1=3D%d size2=3D%d",iSize,self.size.TexInfo) end
-	assert(iSize =3D=3D self.size.TexInfo) =

+	--~ assert(iSize =3D=3D self.size.TexInfo) =

 	assert(iSize >=3D self.size.TexInfo)
 	chunk.texinfo =3D self:Read(iOffset,"TexInfo") -- VisitTexInfo
 end
@@ -579,6 +579,6 @@
 ]]--	=

 		=

 		=

---~ cGrannyFile:LoadFile    /cavern/uoml/Models/Monsters/Changling_idle.gr=
n			DEBUG[granny]   WARNING ! granny 0xCA5E0303 : size1=3D%d size2=3D%d 224=
28   12 =

---~ cGrannyFile:LoadFile    /cavern/uoml/Models/Monsters/Denkou_Yajuu_Pill=
age.grn	DEBUG[granny]   WARNING ! granny 0xCA5E0303 : size1=3D%d size2=3D%d=
 6244    12                       =

---~ cGrannyFile:LoadFile    /cavern/uoml/Models/Monsters/Devourer_Attack2.=
grn		DEBUG[granny]   WARNING ! granny 0xCA5E0303 : size1=3D%d size2=3D%d 26=
4     12 =

+--~ cGrannyFile:LoadFile    /cavern/uoml/Models/Monsters/Changling_idle.gr=
n",			DEBUG[granny]   WARNING ! granny 0xCA5E0303 : size1=3D%d size2=3D%d 2=
2428   12 =

+--~ cGrannyFile:LoadFile    /cavern/uoml/Models/Monsters/Denkou_Yajuu_Pill=
age.grn",	DEBUG[granny]   WARNING ! granny 0xCA5E0303 : size1=3D%d size2=3D=
%d 6244    12                       =

+--~ cGrannyFile:LoadFile    /cavern/uoml/Models/Monsters/Devourer_Attack2.=
grn",		DEBUG[granny]   WARNING ! granny 0xCA5E0303 : size1=3D%d size2=3D%d =
264     12 =




From no-reply at zwischenwelt.org  Tue Nov 24 20:26:42 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 24 Nov 2009 19:26:42 -0000
Subject: [Iris-commit] [IRIS] r3166 - /trunk/lua/lib.3d.mousepick.lua
Message-ID: <20091124192642.B03F67A98162@simon>

Author: ghoulsblade
Date: Tue Nov 24 20:26:42 2009
New Revision: 3166

Log:
3d mousepick dynamic assert

Modified:
    trunk/lua/lib.3d.mousepick.lua

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Tue Nov 24 20:26:42 2009
@@ -201,9 +201,10 @@
     end
     =

     -- dynamics
+	assert(gMulti_ID)
     for k,dynamic in pairs(GetDynamicList()) do
         -- if Dynamic is in World (if it's not an Container) & if it's not=
 an Multi & if it's not a skipped Fallback (multitile mesh)
-        if (DynamicIsInWorld(dynamic) and (dynamic.artid < gMulti_ID) and =
not(IsArtBillboardFallBackSkipped(dynamic.artid))) then
+        if (DynamicIsInWorld(dynamic) and dynamic.artid and (dynamic.artid=
 < gMulti_ID) and not(IsArtBillboardFallBackSkipped(dynamic.artid))) then
             -- WARNING copy & paste code
             if (self:IsZLayerVisible(dynamic.zloc)) then
                 if (dynamic.corpsegfx) then



From no-reply at zwischenwelt.org  Wed Nov 25 18:31:22 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 25 Nov 2009 17:31:22 -0000
Subject: [Iris-commit] [IRIS] r3167 - in /trunk/lua:
	filter/filter.granny.lua lib.bodygfx.lua
Message-ID: <20091125173122.9259B7A98166@simon>

Author: ghoulsblade
Date: Wed Nov 25 18:31:22 2009
New Revision: 3167

Log:
grannyfilter : added override for scaling

Modified:
    trunk/lua/filter/filter.granny.lua
    trunk/lua/lib.bodygfx.lua

Modified: trunk/lua/filter/filter.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.granny.lua (original)
+++ trunk/lua/filter/filter.granny.lua Wed Nov 25 18:31:22 2009
@@ -21,6 +21,8 @@
 end
 =

 -- custom models can be applyed instead to grannys, just tell the meshname
+--for custom scaling use gGrannyFilter[400]	=3D{scale=3D{x=3D2,y=3D2,z=3D2=
}}
+
 --gGrannyFilter[153]	=3D{meshname=3D"Lich.mesh"}
 --gGrannyFilter[154]	=3D{meshname=3D"mummy.mesh"}
 --gGrannyFilter[618]	=3D{meshname=3D"sword.mesh"}

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Wed Nov 25 18:31:22 2009
@@ -281,6 +281,13 @@
         local myscalex =3D forcescalex or modelinfo.scalex * gGrannyScaleF=
actor
         local myscaley =3D forcescaley or modelinfo.scaley * gGrannyScaleF=
actor
         local myscalez =3D forcescalez or modelinfo.scalez * gGrannyScaleF=
actor
+		local filter =3D gGrannyFilter[modelid]
+		if (filter and filter.scale) then =

+			myscalex =3D myscalex * filter.scale.x
+			myscaley =3D myscaley * filter.scale.y
+			myscalez =3D myscalez * filter.scale.z
+		end
+		=

         if (myscalex ~=3D 1 or myscaley ~=3D 1 or myscalez ~=3D 1) then
             partgfx:SetScale(myscalex,myscaley,myscalez)
             partgfx:SetNormaliseNormals(true)



From no-reply at zwischenwelt.org  Wed Nov 25 23:54:03 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 25 Nov 2009 22:54:03 -0000
Subject: [Iris-commit] [IRIS] r3169 - /trunk/scripts/luabindheader.lua
Message-ID: <20091125225407.0361C7A98166@simon>

Author: ghoulsblade
Date: Wed Nov 25 23:53:49 2009
New Revision: 3169

Log:
luabind-generator improvements

Modified:
    trunk/scripts/luabindheader.lua

Modified: trunk/scripts/luabindheader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/scripts/luabindheader.lua (original)
+++ trunk/scripts/luabindheader.lua Wed Nov 25 23:53:49 2009
@@ -1,35 +1,63 @@
 -- generates lua binding code for quickwrap/quickbind system
+-- TODO: scenemanager : SceneManager : PushOGRE_MUTEX(sceneGraphMutex)Stri=
ng,			getName
+-- TODO: ,(ParamLight::LightTypes(L,2),ParamInt(L,3))  Light::LightTypes  =
 ParamLightTypes
+-- TODO:LUABIND_PrefixConstant(Ogre::SceneManager,SCRQM_INCLUD)  -- E fehl=
t  SCRQM_INCLUDE,
 =

 function Main ()
-	local basepath =3D "/usr/src/ogre164/ogre/OgreMain/include/"
-	scenenode		=3D LoadHeader(basepath.."OgreSceneNode.h","SceneNode")
-	node			=3D LoadHeader(basepath.."OgreNode.h","Node")
-	renderable		=3D LoadHeader(basepath.."OgreRenderable.h","Renderable")
-	movable			=3D LoadHeader(basepath.."OgreMovableObject.h","MovableObject")
-	camera			=3D LoadHeader(basepath.."OgreCamera.h","Camera")
-	frustum			=3D LoadHeader(basepath.."OgreFrustum.h","Frustum")
-	scenemanager	=3D LoadHeader(basepath.."OgreSceneManager.h","SceneManager")
-	light			=3D LoadHeader(basepath.."OgreLight.h","Light")
-	--~ robrenderable	=3D =

-	--~ robmovable		=3D =

+	local basepath =3D "/usr/local/include/OGRE/"
+	for k,arr in pairs({	{basepath.."OgreLight.h"				,"Light"},	=

+							{basepath.."OgreSceneManager.h"			,"SceneManager"},
+							{basepath.."OgreFrustum.h"				,"Frustum"},
+							{basepath.."OgreCamera.h"				,"Camera"},
+							{basepath.."OgreSceneNode.h"			,"SceneNode"},
+							{basepath.."OgreNode.h"					,"Node"},
+							{basepath.."OgreMovableObject.h"		,"MovableObject"},
+							{basepath.."OgreRenderable.h"			,"Renderable"},
+							{basepath.."OgreRenderOperation.h"		,"RenderOperation"},
+							{basepath.."OgreHardwareVertexBuffer.h"	,"VertexDeclaration"},
+							=

+						}) do
+		local filepath,classname =3D unpack(arr)
+		local c =3D {}
+		c.code =3D LoadHeader(filepath,classname)
+		c.classname =3D classname
+		_G[classname] =3D c
+	end
+	=

+	--~ RobRenderable	=3D =

+	--~ RobMovable		=3D =

+	=

+	gOutLines =3D {}
 =

 	RegisterVarTypes()
-	--~ GenerateBinding(movable)
-	--~ GenerateBinding(renderable)
-	--~ GenerateBinding(node,{renderable})
-	GenerateBinding(light,{movable})
-	--~ GenerateBinding(frustum)
-	--~ GenerateBinding(scenemanager)
-	--~ GenerateBinding(camera,{frustum}) -- renderable,movable}
-	--~ GenerateBinding(robmovable,{movable})
-	--~ GenerateBinding(robrenderable,{renderable})
-	--~ GenerateBinding(scenenode,{node,renderable})
+	GenerateBinding(Light,{MovableObject})
+	GenerateBinding(SceneManager)
+	GenerateBinding(Frustum)
+	GenerateBinding(Camera,{Frustum}) -- Renderable,MovableObject}
+	GenerateBinding(SceneNode,{Node,Renderable})
+	GenerateBinding(Node,{Renderable})
+	GenerateBinding(MovableObject	)
+	GenerateBinding(Renderable)
+	GenerateBinding(RenderOperation)
+	GenerateBinding(VertexDeclaration)
+	=

+	--~ GenerateBinding(RobMovable,{MovableObject})
+	--~ GenerateBinding(RobRenderable,{Renderable})
+	=

+	-- output to file
+	local outlines =3D gOutLines
+	outlines =3D MyEqualizeTabs(outlines)
+	outlines =3D table.concat(outlines,"\n")
+	print(outlines)
+	local filepath =3D "luabindheader.out"
+	FilePutContents(filepath,outlines)
+	print("// output also written to ",filepath," to conserve tabs")
 end
 =

 =

 function LoadHeader (filepath,classname)
 	local txt =3D FileGetContents(filepath)
-	assert(txt and #txt > 0)
+	assert(txt and #txt > 0,"failed to load "..filepath)
 	=

 	-- class _OgreExport MovableObject : public ShadowCaster, public Animable=
Object, public MovableAlloc {
 	local a,b,code =3D string.find(txt,"class[^{;:]+"..classname.."[^{;]*(%b{=
})")  assert(code)  -- firstspaces: : to avoid inheritance, problems with n=
amespaces, subclasses etc ?
@@ -124,32 +152,52 @@
 =

 =

 =

-function GenerateBinding (code,parentlist) =

-	code =3D ParseAndNormalize(code)
+function GenerateBinding (classData,parentlist) =

+	local sBindingName =3D classData.classname
+	local code,enums =3D ParseAndNormalize(classData.code)
+	=

+	print("#############")
+	local outlines =3D gOutLines
+	sBindingName =3D sBindingName or "UnnamedBinding"
+	table.insert(outlines,{"class cLugreLuaBind_Ogre_"..sBindingName.." : pub=
lic cLuaBindDirect<Ogre::"..sBindingName..">, public cLuaBindDirectOgreHelp=
er { public:"})
+	table.insert(outlines,{"\tvirtual void RegisterMethods	(lua_State *L) { P=
ROFILE"})
+	=

+	-- baseclass
 	local parentlines =3D {}
-	for k1,parentcode in pairs(parentlist or {}) do =

-		for k2,parentline in pairs(ParseAndNormalize(parentcode)) do =

+	for k1,parentClassData in pairs(parentlist or {}) do =

+		table.insert(outlines,{"\t\tLUABIND_DIRECTWRAP_BASECLASS(Ogre::"..parent=
ClassData.classname..");"})
+		table.insert(outlines,{"\t\t"})
+		for k2,parentline in pairs(ParseAndNormalize(parentClassData.code)) do =

 			table.insert(parentlines,parentline)
 		end
 	end
 	=

-	print("#############")
-	local outlines =3D {}
+	-- methods
+	gMethodNameOverloadCounter =3D {}
 	for k,line in pairs(code) do =

 		if (line =3D=3D "") then =

+		elseif (line =3D=3D ";") then =

 		elseif (in_array(line,parentlines)) then =

-			local text =3D "// in parent: " .. line
+			local text =3D "\t\t// in parent: " .. line
 			table.insert(outlines,{text})
 		else =

-			table.insert(outlines,LineToLuaBind(line))
-		end
-	end
-	outlines =3D MyEqualizeTabs(outlines)
-	outlines =3D table.concat(outlines,"\n")
-	print(outlines)
-	local filepath =3D "luabindheader.out"
-	FilePutContents(filepath,outlines)
-	print("// output also written to ",filepath," to conserve tabs")
+			table.insert(outlines,LineToLuaBind(line,"\t\t"))
+		end
+	end
+	=

+	-- enums
+	table.insert(outlines,{"\t\t"})
+	for enumname,values in pairs(enums) do =

+		for k,valuename in pairs(values) do =

+			table.insert(outlines,{"\t\tLUABIND_PrefixConstant(Ogre::"..sBindingNam=
e..","..valuename..")"})
+		end =

+	end
+	=

+	=

+	table.insert(outlines,{"\t}"})
+	table.insert(outlines,{'\tvirtual const char* GetLuaTypeName () { return =
"lugre.ogre.'..sBindingName..'"; }'})
+	table.insert(outlines,{"};"})
+	table.insert(outlines,{""})
 	--~ print("############# types:")
 	--~ print(table.concat(gTypes,"\n"))
 	--~ print(table.concat(code,"\n"))
@@ -191,29 +239,47 @@
 function RegisterType (s) s =3D NormalizeType(s) if (not in_array(s,gTypes=
)) then table.insert(gTypes,s) end end =

 =

 function NormalizeType (s) return string.gsub(s,"&","") end
-function LineToLuaBind (line)
+function LineToLuaBind (line,prefix)
 	local a,b,ret,name,params =3D string.find(line,"(.+) ([^ %(]+)%((.*)%)")
-	if (not a) then return {"// unknown syntax:"..line} end
+	if (not a) then return {prefix.."// unknown syntax:"..line} end
 	RegisterType(ret)
-	local retpush =3D gPusher[NormalizeType(ret)] or ret
+	local retpush =3D gPusher[NormalizeType(ret)]
+	local bReturnVoid =3D ret =3D=3D "void"
+	local bCommentedOut =3D false
+	if ((not retpush) and (not bReturnVoid)) then =

+		retpush =3D "Push"..ret
+		bCommentedOut =3D true
+	end
 	=

 	local paramtext =3D {}
 	if (params ~=3D "void") then
 		params =3D strsplit(",",params)
 		for k,param in pairs(params) do =

 			param =3D string.gsub(param," [^ ]+","") -- remove name
-			local reader =3D gReader[NormalizeType(param)]
-			if (reader) then param =3D reader.."(L,"..(k+1)..")" end
+			local reader =3D gReader[NormalizeType(string.gsub(param,"^.+::",""))]
+			if (reader) then =

+				param =3D reader.."(L,"..(k+1)..")"
+			elseif (param ~=3D "") then
+				bCommentedOut =3D true
+				param =3D "Param"..param.."(L,"..(k+1)..")"
+			end
 			table.insert(paramtext,param)
 		end
 	end
 	paramtext =3D table.concat(paramtext,",")
 	=

-	=

-	if (ret =3D=3D "void") then
-		return {"LUABIND_DIRECTWRAP_RETURN_VOID(",	"",					""..name.."",		",("..=
paramtext..")\t);"}
-	else                                                                     =

-		return {"LUABIND_DIRECTWRAP_RETURN_ONE(",	""..retpush..",",	""..name..""=
,		",("..paramtext..")\t);"}
+	-- name-overloading : count the number of times a methodname occurs, and =
append number to name to avoid overloading (performance problems?)
+	local namec =3D (gMethodNameOverloadCounter[name] or 0) + 1
+	gMethodNameOverloadCounter[name] =3D namec
+	local nameadd =3D ""
+	if (namec > 1) then nameadd =3D namec end
+	=

+	local prefix2 =3D bCommentedOut and "//~ " or ""
+	=

+	if (bReturnVoid) then
+		return {prefix..prefix2.."LUABIND_DIRECTWRAP_RETURN_VOID_NAMEADD(",	"",	=
				""..name..","..nameadd,		",("..paramtext..")\t);"}
+	else                                                                   =

+		return {prefix..prefix2.."LUABIND_DIRECTWRAP_RETURN_ONE_NAMEADD(",	""..r=
etpush..",",	""..name..","..nameadd,		",("..paramtext..")\t);"}
 	end
 end
 =

@@ -277,6 +343,26 @@
 function ParseAndNormalize (code) =

 	local access =3D {"public%s*:","private%s*:","protected%s*:"} -- access/v=
isibility
 	=

+	-- remove comments
+	code =3D string.gsub(code,"//[^\n]*","") =

+	code =3D string.gsub(code,"#","") =

+	code =3D string.gsub(code,"/%*","#")  -- remove block comments
+	code =3D string.gsub(code,"%*/","#") =

+	code =3D string.gsub(code,"%b##","") =

+	=

+	local enums =3D {}
+	for enumname,subcode in string.gmatch(code,"enum%s+([^%s;{]+)[^;]*(%b{})"=
) do
+		--~ print("enum",enumname)
+		local enum =3D {}
+		enums[enumname] =3D enum
+		--~ print("=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D\n"..subcode.."\n=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D")
+		for valuename in string.gmatch(string.sub(subcode,2,-2),"([^%s=3D,]+)[^,=
]*,") do =

+			--~ print(" ",valuename) =

+			table.insert(enum,valuename)
+		end
+	end
+
+	-- enum LightTypes { LT_POINT =3D 0, };
 	=

 	code =3D string.gsub(code,"%b{}",";") -- balanced : remove code (avoid in=
terferance with private: ...
 	code =3D RemoveAll(code,access[2],access) -- private should be filtered o=
ut
@@ -292,13 +378,6 @@
 	code =3D string.gsub(code,"&","")
 	code =3D string.gsub(code,"Ogre::","")
 	=

-	-- remove comments
-	code =3D string.gsub(code,"//[^\n]*","") =

-	code =3D string.gsub(code,"#","") =

-	code =3D string.gsub(code,"/%*","#")  -- remove block comments
-	code =3D string.gsub(code,"%*/","#") =

-	code =3D string.gsub(code,"%b##","") =

-	=

 	=

 	code =3D string.gsub(code,"%*","* ") -- paramname workaround : add whites=
pace
 	code =3D string.gsub(code,"%&","& ") -- paramname workaround : add whites=
pace
@@ -311,7 +390,7 @@
 	code =3D string.gsub(code," *([,%)%(]) *","%1") -- remove whitespace doub=
lesided =

 	code =3D string.gsub(code," *([&%*])","%1") -- remove whitespace before =

 	code =3D string.gsub(code," *; *",";\n")
-	return strsplit("\n",code)
+	return strsplit("\n",code),enums
 end
 =

 =




From no-reply at zwischenwelt.org  Thu Nov 26 20:32:32 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 26 Nov 2009 19:32:32 -0000
Subject: [Iris-commit] [IRIS] r3170 - /trunk/scripts/luabindheader.lua
Message-ID: <20091126193232.10EDB7A98167@simon>

Author: ghoulsblade
Date: Thu Nov 26 20:32:31 2009
New Revision: 3170

Log:
improved luabindheader

Modified:
    trunk/scripts/luabindheader.lua

Modified: trunk/scripts/luabindheader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/scripts/luabindheader.lua (original)
+++ trunk/scripts/luabindheader.lua Thu Nov 26 20:32:31 2009
@@ -356,7 +356,7 @@
 		local enum =3D {}
 		enums[enumname] =3D enum
 		--~ print("=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D\n"..subcode.."\n=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D")
-		for valuename in string.gmatch(string.sub(subcode,2,-2),"([^%s=3D,]+)[^,=
]*,") do =

+		for valuename in string.gmatch(string.sub(subcode,2,-2),"([^%s=3D,]+)[^,=
]*") do =

 			--~ print(" ",valuename) =

 			table.insert(enum,valuename)
 		end
@@ -377,6 +377,7 @@
 	code =3D string.gsub(code,"unsigned","")
 	code =3D string.gsub(code,"&","")
 	code =3D string.gsub(code,"Ogre::","")
+	code =3D string.gsub(code,"OGRE_MUTEX%b()","")
 	=

 	=

 	code =3D string.gsub(code,"%*","* ") -- paramname workaround : add whites=
pace



From no-reply at zwischenwelt.org  Thu Nov 26 20:34:41 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 26 Nov 2009 19:34:41 -0000
Subject: [Iris-commit] [IRIS] r3171 - in /trunk/lua: lib.granny.debug.lua
 lib.granny.loader.lua lib.granny.types.lua
Message-ID: <20091126193444.6E3117A98167@simon>

Author: ghoulsblade
Date: Thu Nov 26 20:34:40 2009
New Revision: 3171

Log:
granny loader : fixed bone-weight loader

Modified:
    trunk/lua/lib.granny.debug.lua
    trunk/lua/lib.granny.loader.lua
    trunk/lua/lib.granny.types.lua

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Thu Nov 26 20:34:40 2009
@@ -151,7 +151,7 @@
 =

 function cDebugGrannyMenu:MakeNewGranny (artid)
 	artid =3D 791 -- beetle
-	--~ artid =3D 200 -- horse
+	artid =3D 200 -- horse
 	=

 	gDebugCategories.granny 	=3D true
 	local folder =3D "/cavern/uoml_freshinstall.4.x/Models/Animals/"
@@ -160,6 +160,7 @@
 	print("=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D MakeNewGranny")
 	local filepath =3D GetGrannyFilePath(artid)
 	--~ filepath =3D folder.."Giant_Beetle_Walk.grn"
+	--~ filepath =3D folder.."Equines_Horse_Dappled_Brown_Walk.grn"
 	print("granny path for artid",artid,filepath)
 	local grn =3D cGrannyFile:New()
 	grn:LoadFile(filepath)
@@ -168,13 +169,13 @@
 			for k,filename in pairs(gGrannyDebug_Anims_Horse) do =

 				local grn2 =3D cGrannyFile:New()
 				grn2:LoadFile(folder..filename)
-				--~ grn2:XMLDump("../mygranny/mygranny.horse."..filename..".xml") =

+				grn2:XMLDump("../mygranny/mygranny.horse."..filename..".xml") =

 			end
 			local folder =3D "/cavern/uoml_freshinstall.4.x/Models/Animals/"
 			for k,filename in pairs(gGrannyDebug_Anims_Beetle) do =

 				local grn2 =3D cGrannyFile:New()
 				grn2:LoadFile(folder..filename)
-				--~ grn2:XMLDump("../mygranny/mygranny.beetle."..filename..".xml") =

+				grn2:XMLDump("../mygranny/mygranny.beetle."..filename..".xml") =

 			end
 	end
 	=

@@ -195,7 +196,7 @@
 	function MyGrannyDump(arr,name,subfield,levels)
 		if (not arr) then print(name,"!!NIL!!") return end
 		if (#arr =3D=3D 0) then print(name,"!!EMPTY!!",SmartDump(MyFilterFields(=
arr))) end
-		for k,entry in ipairs(arr) do if (k<=3D6) then print(name,k.."/"..#arr,S=
martDump(MyFilterFields(subfield and entry[subfield] or entry),levels or 2)=
) end end
+		for k,entry in ipairs(arr) do if (k<=3D11) then print(name,k.."/"..#arr,=
SmartDump(MyFilterFields(subfield and entry[subfield] or entry),levels or 2=
)) end end
 	end
 	--~ function MyGrannyDump() end -- block output
 	=

@@ -213,7 +214,7 @@
 	end
 	=

 	print("weights:",SmartDump(MyFilterFields(mesh.weights)))
-	MyGrannyDump(mesh.weights.list_weights,"weight")
+	MyGrannyDump(mesh.weights.list_weightchunks,"weight",nil,3)
 	MyGrannyDump(mesh.polygons.list_polygons,"polygon")
 	MyGrannyDump(Object.boneTies1.childs,"boneTies1:boneobject")
 	MyGrannyDump(Object.bones.skeleton.bonelist.childs,"bone","bone")
@@ -387,19 +388,58 @@
 -- comparison beetle vs horse =

 beetle...meshlist.mesh	: <id iID=3D"5" />
 horse...meshlist.mesh	: <id iID=3D"1" />
-				 =

-				 =

 one anim per file!
-[ghoul at washu] /cavern/code/iris> dir /cavern/uoml_freshinstall.4.x/Models/=
Animals/Equines_Horse_Dappled_Brown
-Equines_Horse_Dappled_Brown_Attack1.grn     Equines_Horse_Dappled_Brown_Fi=
dget.grn      Equines_Horse_Dappled_Brown_Lod2.grn        Equines_Horse_Dap=
pled_Brown_Walk.grn
-Equines_Horse_Dappled_Brown_Die1.grn        Equines_Horse_Dappled_Brown_Ge=
thit.grn      Equines_Horse_Dappled_Brown_Pack_Lod2.grn
-Equines_Horse_Dappled_Brown_Eat.grn         Equines_Horse_Dappled_Brown_Id=
le.grn        Equines_Horse_Dappled_Brown_Run.grn
-
+
+horse : =

+	text    				1/46    "__Standard"
+	point   				1/223   {y=3D0.547549,x=3D-0.281395,z=3D1.035676,}
+	normal  				1/223   {y=3D0.281497,x=3D-0.956108,z=3D-0.081349,}
+	texcoord        		1/222   {y=3D0.689825,x=3D-0.101103,z=3D1,}
+	list_texpoly_normal     1/442   {iUnknown=3D0,iTexCoord=3D{[1]=3D45=3D0x2=
d,[2]=3D43=3D0x2b,[0]=3D29=3D0x1d,},}
+	polygon 				1/442   {iVertex=3D{[1]=3D83=3D0x53,[2]=3D72=3D0x48,[0]=3D82=
=3D0x52,},iNormal=3D{[1]=3D83=3D0x53,[2]=3D72=3D0x48,[0]=3D82=3D0x52,},}
+	=

+	weights:        		{unknown_b=3D2,wnum=3D223=3D0xdf,unknown_a=3D32=3D0x20,=
list_weights=3Dtable: 0xa6208c8,}                                          =
                   =

+	weight  1/223   {iNumBones=3D1,list_pairs=3D{[1]=3D{iWeightBoneIndex=3D0,=
fWeight=3D1,},},}     =

+	boneTies1:boneobject    1/37    {childs=3D{[1]=3Dtable: 0xa762850,},}
+	bone    				1/37    {fTranslate=3D{[1]=3D0,[2]=3D0,[0]=3D0,},iParent=3D0,=
fMatrix=3D{[1]=3D0,[2]=3D0,[3]=3D0,[4]=3D1,[5]=3D0,[6]=3D0,[7]=3D0,[8]=3D1,=
[0]=3D1,},fQuaternion=3D{[1]=3D0,[2]=3D0,[3]=3D1,[0]=3D0,},}
+	bt2:bone_objptr 		1/37    4
+	bt2:bonetie     		1/33    {iBone=3D5,iUnknown=3D{[1]=3D-0.058629,[2]=3D-0=
.237984,[3]=3D-0.162302,[4]=3D0.358194,[5]=3D0.183488,[6]=3D0.102694,[0]=3D=
0.367406,},}
+	obj     				1/40    {[2]=3D3,[4]=3D5,[6]=3D0,}
+
+	weights : =

+		<weights unknown_b=3D"2" unknown_a=3D"32" wnum=3D"223">
+		case 0XCA5E0702: VisitWeights(pInts[0],pInts[1],pInts[2],pData+3*4,iSize=
-3*4); ... mpLastSubMesh->mWeights =3D std::make_pair(pData,iNum);
+	=

+		// prepare bone-weight data
+		if (bUseSkeleton) {
+			sub->clearBoneAssignments();
+			myBoneWeights.reserve(pLoaderSubMesh.mWeights.second);
+			=

+			// WARNING ! buffersize not checked, but as long as the granny files ar=
e intakt thats ok
+			// foreach point : bonenum, index,weight, index,weight,... =

+			const ::uint32* p =3D (::uint32*)pLoaderSubMesh.mWeights.first;   -----=
----- pData
+			for (int i=3D0;i<pLoaderSubMesh.mWeights.second;++i) {
+				::uint32 iNumBones =3D *(p++);
+				=

+				tMyBoneWeightList* pBoneList =3D new tMyBoneWeightList();
+				myBoneWeights.push_back(pBoneList);
+				pBoneList->reserve(iNumBones);
+				=

+				for (int k=3D0;k<iNumBones;++k) {
+					::uint32	iWeightBoneIndex =3D *(p++);
+					float		fWeight =3D *(float*)(p++);
+					pBoneList->push_back(std::make_pair(iWeightBoneIndex,fWeight));
+				}
+			}
+		}
+
+unknown : =

 																															  =

 point  					1/223   {y=3D0.547549,x=3D-0.281395,z=3D1.035676,}            =
                                                                 =

 texcoord        		1/222   {y=3D0.689825,x=3D-0.101103,z=3D1,}   =

 polygon 				1/442   {iVertex=3D{[1]=3D83=3D0x53,[2]=3D72=3D0x48,[0]=3D82=
=3D0x52,},iNormal=3D{[1]=3D83=3D0x53,[2]=3D72=3D0x48,[0]=3D82=3D0x52,},}   =

 list_texpoly_normal     1/442   {iUnknown=3D0,iTexCoord=3D{[1]=3D45=3D0x2d=
,[2]=3D43=3D0x2b,[0]=3D29=3D0x1d,},}
+
 =

 	=

 =

@@ -417,6 +457,9 @@
 							pGrannyBone ? pGrannyBone->fQuaternion[0]:0,
 							pGrannyBone ? pGrannyBone->fQuaternion[1]:0,
 							pGrannyBone ? pGrannyBone->fQuaternion[2]:0);
+
+							=

+							=

 }
 			=

 ]]--

Modified: trunk/lua/lib.granny.loader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.loader.lua (original)
+++ trunk/lua/lib.granny.loader.lua Thu Nov 26 20:34:40 2009
@@ -410,13 +410,28 @@
 	chunk.list_texcoords =3D self:ReadArray("Vector",iOffset+4,iSize-4) -- Vi=
sitTexCoords
 end
 =

-cGrannyFile.chunkHandlers[0XCA5E0702] =3D function (self,iOffset,iSize,chu=
nk) =

+cGrannyFile.chunkHandlers[0XCA5E0702] =3D function (self,iOffset,iSize,chu=
nk)  -- structure is wnum*{ iNumBones, iNumBones*{iWeightBoneIndex,fWeight}=
 }
 	assert(self:GetRootParentType() =3D=3D 0XCA5E0602)
 	assert(iSize >=3D 3*4) =

 	chunk.wnum		=3D self:ReadInt(iOffset)
 	chunk.unknown_a	=3D self:ReadInt(iOffset+4)
 	chunk.unknown_b	=3D self:ReadInt(iOffset+8)
-	chunk.list_weights =3D self:ReadArray("Weight",iOffset+12,iSize-12) -- Vi=
sitWeights
+	local iWeightPairSize =3D self.size.WeightPair
+	iSize =3D iSize - 12
+	iOffset =3D iOffset + 12
+	local list_weightchunks =3D {}
+	chunk.list_weightchunks =3D list_weightchunks
+	for i=3D1,chunk.wnum do
+		assert(iSize > 4)
+		local iNumBones =3D self:ReadInt(iOffset)
+		assert(iSize-4 >=3D iNumBones*iWeightPairSize)
+		local iPairListSize =3D min(iSize-4,iNumBones*iWeightPairSize)
+		local list_pairs =3D self:ReadArray("WeightPair",iOffset+4,iPairListSize)
+		table.insert(list_weightchunks,{iNumBones=3DiNumBones,list_pairs=3Dlist_=
pairs})
+		iOffset =3D iOffset + 4 + iPairListSize
+		iSize =3D iSize - 4 - iPairListSize
+	end
+	assert(iSize=3D=3D0)
 end
 =

 cGrannyFile.chunkHandlers[0xCA5E0e06] =3D function (self,iOffset,iSize,chu=
nk) =


Modified: trunk/lua/lib.granny.types.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.types.lua (original)
+++ trunk/lua/lib.granny.types.lua Thu Nov 26 20:34:40 2009
@@ -35,8 +35,9 @@
 		{uint32	,"miUnknown",3},
 	}
 =

-	self.structs.Weight =3D {
-		{float	,"w"},
+	self.structs.WeightPair =3D {
+		{uint32	,"iWeightBoneIndex"},
+		{float	,"fWeight"},
 	}
 	self.structs.Vector =3D {
 		{float	,"x"},



From no-reply at zwischenwelt.org  Thu Nov 26 21:12:32 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 26 Nov 2009 20:12:32 -0000
Subject: [Iris-commit] [IRIS] r3172 - /trunk/scripts/luabindheader.lua
Message-ID: <20091126201232.7789C7A98167@simon>

Author: ghoulsblade
Date: Thu Nov 26 21:12:30 2009
New Revision: 3172

Log:
luabind header : disabled renderop and vertexdecl, custom binding needed

Modified:
    trunk/scripts/luabindheader.lua

Modified: trunk/scripts/luabindheader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/scripts/luabindheader.lua (original)
+++ trunk/scripts/luabindheader.lua Thu Nov 26 21:12:30 2009
@@ -13,8 +13,8 @@
 							{basepath.."OgreNode.h"					,"Node"},
 							{basepath.."OgreMovableObject.h"		,"MovableObject"},
 							{basepath.."OgreRenderable.h"			,"Renderable"},
-							{basepath.."OgreRenderOperation.h"		,"RenderOperation"},
-							{basepath.."OgreHardwareVertexBuffer.h"	,"VertexDeclaration"},
+							--~ {basepath.."OgreRenderOperation.h"		,"RenderOperation"},	-- cus=
tom binding made, not good for auto-bind
+							--~ {basepath.."OgreHardwareVertexBuffer.h"	,"VertexDeclaration"},	=
-- custom binding made, not good for auto-bind
 							=

 						}) do
 		local filepath,classname =3D unpack(arr)



From no-reply at zwischenwelt.org  Thu Nov 26 21:18:35 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 26 Nov 2009 20:18:35 -0000
Subject: [Iris-commit] [IRIS] r3173 - /trunk/scripts/luabindheader.lua
Message-ID: <20091126201836.497837A98167@simon>

Author: ghoulsblade
Date: Thu Nov 26 21:18:35 2009
New Revision: 3173

Log:
small fix

Modified:
    trunk/scripts/luabindheader.lua

Modified: trunk/scripts/luabindheader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/scripts/luabindheader.lua (original)
+++ trunk/scripts/luabindheader.lua Thu Nov 26 21:18:35 2009
@@ -38,8 +38,8 @@
 	GenerateBinding(Node,{Renderable})
 	GenerateBinding(MovableObject	)
 	GenerateBinding(Renderable)
-	GenerateBinding(RenderOperation)
-	GenerateBinding(VertexDeclaration)
+	--~ GenerateBinding(RenderOperation)
+	--~ GenerateBinding(VertexDeclaration)
 	=

 	--~ GenerateBinding(RobMovable,{MovableObject})
 	--~ GenerateBinding(RobRenderable,{Renderable})



From no-reply at zwischenwelt.org  Sat Nov 28 14:46:57 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 28 Nov 2009 13:46:57 -0000
Subject: [Iris-commit] [IRIS] r3174 - in /trunk: lua/lib.granny.debug.lua
	scripts/luabindheader.lua
Message-ID: <20091128134657.6445F54D0039@simon>

Author: ghoulsblade
Date: Sat Nov 28 14:46:57 2009
New Revision: 3174

Log:
luabind adjustments, grannydebug : started animloader code

Modified:
    trunk/lua/lib.granny.debug.lua
    trunk/scripts/luabindheader.lua

Modified: trunk/lua/lib.granny.debug.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.debug.lua (original)
+++ trunk/lua/lib.granny.debug.lua Sat Nov 28 14:46:57 2009
@@ -352,6 +352,34 @@
 		=

 		-- todo : mousepick
 		=

+		--[[
+		function LoadGrannyAsOgreMesh (...)
+			local meshname =3D "bla"
+			local mesh =3D MeshManager_createManual(meshname)
+			mesh:_setBounds({0,0,0,0,0,0}, true)
+			mesh:_setBoundingSphereRadius(0)
+			=

+			if (bHasBoneWeights) then =

+				local skeletonname =3D "blub"
+				local skeleton =3D SkeletonManager_load(skeletonname)
+				mesh:setSkeletonName(skeleton:getName())
+			end
+			-- for ... cSubMeshConstructor
+			mesh:load()
+			return meshname
+		end
+		=

+		function LoadGrannyAsOgreAnim (...)
+				local skeletonname =3D "blub"
+				local skeleton =3D SkeletonManager_load(skeletonname)
+				-- fTotalTime =3D cAnimationTotalTimeConstructor
+				local anim =3D skeleton:createAnimation(szAnimName,fTotalTime) // in s=
econds	=

+				-- cAnimationConstructor anim
+		end
+		=

+		=

+		]]--
+		=

 		=

 	end
 	=


Modified: trunk/scripts/luabindheader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/scripts/luabindheader.lua (original)
+++ trunk/scripts/luabindheader.lua Sat Nov 28 14:46:57 2009
@@ -13,6 +13,16 @@
 							{basepath.."OgreNode.h"					,"Node"},
 							{basepath.."OgreMovableObject.h"		,"MovableObject"},
 							{basepath.."OgreRenderable.h"			,"Renderable"},
+							=

+							{basepath.."OgreResource.h"				,"Resource"},
+							=

+							{basepath.."OgreSkeleton.h"				,"Skeleton"},
+							{basepath.."OgreBone.h"					,"Bone"},
+							{basepath.."OgreAnimation.h"			,"Animation"},
+							{basepath.."OgreMesh.h"					,"Mesh"},
+							{basepath.."OgreSubMesh.h"				,"SubMesh"},
+							=

+							=

 							--~ {basepath.."OgreRenderOperation.h"		,"RenderOperation"},	-- cus=
tom binding made, not good for auto-bind
 							--~ {basepath.."OgreHardwareVertexBuffer.h"	,"VertexDeclaration"},	=
-- custom binding made, not good for auto-bind
 							=

@@ -38,6 +48,13 @@
 	GenerateBinding(Node,{Renderable})
 	GenerateBinding(MovableObject	)
 	GenerateBinding(Renderable)
+	=

+	GenerateBinding(Resource)
+	GenerateBinding(Skeleton,{Resource})
+	GenerateBinding(Bone,{Node,Renderable})
+	GenerateBinding(Animation)
+	GenerateBinding(Mesh,{Resource})
+	GenerateBinding(SubMesh)
 	--~ GenerateBinding(RenderOperation)
 	--~ GenerateBinding(VertexDeclaration)
 	=

@@ -78,7 +95,6 @@
 =

 function RegisterVarTypes ()
 	gPusher =3D {}
-	gPusher.AxisAlignedBox		=3D"PushAxisAlignedBox"
 	gPusher.float				=3D"PushNumber"
 	gPusher.Real				=3D"PushNumber"
 	gPusher.bool				=3D"PushBool"
@@ -96,6 +112,7 @@
 	gDirectWrappedTypes.Vector3			=3D true
 	gDirectWrappedTypes.Vector4			=3D true
 	gDirectWrappedTypes.Matrix4			=3D true
+	gDirectWrappedTypes.AxisAlignedBox	=3D true
 	gDirectWrappedTypes.Radian			=3D true
 	gDirectWrappedTypes.ColourValue		=3D true
 	for k,v in pairs(gDirectWrappedTypes) do =

@@ -114,6 +131,11 @@
 	gBoundPointerClasses.Viewport			=3D true
 	gBoundPointerClasses.Camera				=3D true
 	gBoundPointerClasses.Light				=3D true
+	gBoundPointerClasses.Skeleton			=3D true
+	gBoundPointerClasses.Bone				=3D true
+	gBoundPointerClasses.Animation			=3D true
+	gBoundPointerClasses.SubMesh			=3D true
+	gBoundPointerClasses.Mesh				=3D true
 	for k,v in pairs(gBoundPointerClasses) do =

 		gPusher[k.."*"] =3D "Push"..k
 		gReader[k.."*"] =3D "Param"..k



From no-reply at zwischenwelt.org  Sun Nov 29 01:48:35 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 29 Nov 2009 00:48:35 -0000
Subject: [Iris-commit] [IRIS] r3175 - in /tools/updater: MyMainFrame.cpp
 MyMainFrame.h exec.cpp exec.h noname.cpp noname.h readme.txt
 res/screenshot1.bmp res/screenshot2.bmp res/screenshot3.bmp svn.cpp svn.h
 updater.exe updater.fbp updater_vs9.vcproj
Message-ID: <20091129004835.E8C677A98167@simon>

Author: hagish
Date: Sun Nov 29 01:48:35 2009
New Revision: 3175

Log:
new update binary (dynamic screenshot loading and uptodate svn lib)

Added:
    tools/updater/updater.exe   (with props)
Modified:
    tools/updater/MyMainFrame.cpp
    tools/updater/MyMainFrame.h
    tools/updater/exec.cpp
    tools/updater/exec.h
    tools/updater/noname.cpp
    tools/updater/noname.h
    tools/updater/readme.txt
    tools/updater/res/screenshot1.bmp
    tools/updater/res/screenshot2.bmp
    tools/updater/res/screenshot3.bmp
    tools/updater/svn.cpp
    tools/updater/svn.h
    tools/updater/updater.fbp
    tools/updater/updater_vs9.vcproj

Modified: tools/updater/MyMainFrame.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/updater/MyMainFrame.cpp (original)
+++ tools/updater/MyMainFrame.cpp Sun Nov 29 01:48:35 2009
@@ -20,8 +20,8 @@
 =

 #include "exec.h"
 =

-const char *gszTag_stable =3D "stable / stabil";
-const char *gszTag_unstable =3D "unstable / in Entwicklung";
+const char *gszTag_stable =3D "stable";
+const char *gszTag_unstable =3D "latest";
 =

 DECLARE_APP(MyApp)
 =

@@ -77,12 +77,31 @@
 	m_bitmapScreenshot1->SetBitmap(wxBitmap(_T("BITMAP_SCREENSHOT1")));
 	m_bitmapScreenshot2->SetBitmap(wxBitmap(_T("BITMAP_SCREENSHOT2")));
 	m_bitmapScreenshot3->SetBitmap(wxBitmap(_T("BITMAP_SCREENSHOT3")));
+
+	// on demand screenshot overloading
+	if(FileExists("screenshot1.bmp")){
+		m_bitmapScreenshot1->SetBitmap(wxBitmap(wxString("screenshot1.bmp"),wxBI=
TMAP_TYPE_BMP));
+	}
+	if(FileExists("screenshot2.bmp")){
+		m_bitmapScreenshot2->SetBitmap(wxBitmap(wxString("screenshot2.bmp"),wxBI=
TMAP_TYPE_BMP));
+	}
+	if(FileExists("screenshot3.bmp")){
+		m_bitmapScreenshot3->SetBitmap(wxBitmap(wxString("screenshot3.bmp"),wxBI=
TMAP_TYPE_BMP));
+	}
 }
 =

 void MyMainFrame::onUrlClick( wxHtmlLinkEvent& event ){
 	std::string cmd;//("start ");
 	cmd +=3D std::string(event.GetLinkInfo().GetHref().c_str());
 	OpenUrl(cmd);
+}
+
+void MyMainFrame::svnError(const char *szMessage, int errorCode){
+	wxMessageBox( wxString::Format("Error during update!\nErrorcode: %d", err=
orCode), wxT("Error"), wxICON_ERROR );
+	wxMutexGuiEnter();
+	m_textCtrlLog->AppendText(szMessage);
+	m_textCtrlLog->AppendText("\n");
+	wxMutexGuiLeave();
 }
 =

 void MyMainFrame::svnNotify(const char *szMessage){

Modified: tools/updater/MyMainFrame.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/updater/MyMainFrame.h (original)
+++ tools/updater/MyMainFrame.h Sun Nov 29 01:48:35 2009
@@ -50,6 +50,7 @@
 =

 	// svn log message listener notification
 	virtual void svnNotify(const char *szMessage);
+	virtual void svnError(const char *szMessage, int errorCode);
 	virtual bool svnCancel();
 =

 	// notifies the end of svn thread

Modified: tools/updater/exec.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/updater/exec.cpp (original)
+++ tools/updater/exec.cpp Sun Nov 29 01:48:35 2009
@@ -23,6 +23,7 @@
 #include <algorithm>
 #include <vector>
 #include <stdio.h>
+#include <fstream>
 =

 #include "exec.h"
 =

@@ -159,6 +160,10 @@
 	*/
 }
 =

+bool FileExists(const std::string &file){
+	std::ifstream fin(file.c_str());
+	return fin.good();
+}
 =

 /*
 	std::string sCmdLine =3D std::string(lpCmdLine);

Modified: tools/updater/exec.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/updater/exec.h (original)
+++ tools/updater/exec.h Sun Nov 29 01:48:35 2009
@@ -23,5 +23,6 @@
 void ExecuteProcess(const std::string cmd);
 void RemoveFile(const std::string path);
 void CreatePathToFile(const std::string &path);
+bool FileExists(const std::string &file);
 =

 #endif

Modified: tools/updater/noname.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/updater/noname.cpp (original)
+++ tools/updater/noname.cpp Sun Nov 29 01:48:35 2009
@@ -1,5 +1,5 @@
 ///////////////////////////////////////////////////////////////////////////
-// C++ code generated with wxFormBuilder (version Feb  1 2007)
+// C++ code generated with wxFormBuilder (version Feb  6 2009)
 // http://www.wxformbuilder.org/
 //
 // PLEASE DO "NOT" EDIT THIS FILE!
@@ -18,13 +18,8 @@
 #include "noname.h"
 =

 ///////////////////////////////////////////////////////////////////////////
-BEGIN_EVENT_TABLE( MainFrame, wxFrame )
-	EVT_CLOSE( MainFrame::_wxFB_onClose )
-	EVT_BUTTON( ID_BUTTON_UPDATE, MainFrame::_wxFB_updateGame )
-	EVT_BUTTON( ID_BUTTON_START, MainFrame::_wxFB_startGame )
-END_EVENT_TABLE()
 =

-MainFrame::MainFrame( wxWindow* parent, int id, wxString title, wxPoint po=
s, wxSize size, int style ) : wxFrame( parent, id, title, pos, size, style )
+MainFrame::MainFrame( wxWindow* parent, wxWindowID id, const wxString& tit=
le, const wxPoint& pos, const wxSize& size, long style ) : wxFrame( parent,=
 id, title, pos, size, style )
 {
 	this->SetSizeHints( wxDefaultSize, wxDefaultSize );
 	this->SetForegroundColour( wxColour( 0, 0, 0 ) );
@@ -37,11 +32,11 @@
 	wxBoxSizer* bSizer4;
 	bSizer4 =3D new wxBoxSizer( wxVERTICAL );
 	=

-	m_bitmapBanner =3D new wxStaticBitmap( this, wxID_ANY, wxBitmap(), wxDefa=
ultPosition, wxSize( -1,-1 ), 0 );
+	m_bitmapBanner =3D new wxStaticBitmap( this, wxID_ANY, wxBitmap( wxT("BIT=
MAP_BANNER"), wxBITMAP_TYPE_RESOURCE ), wxDefaultPosition, wxSize( -1,-1 ),=
 0 );
 	bSizer4->Add( m_bitmapBanner, 0, wxALIGN_CENTER_HORIZONTAL, 5 );
 	=

 	m_textCtrlMotd =3D new wxTextCtrl( this, wxID_ANY, wxT("Welcome to Iris!"=
), wxDefaultPosition, wxDefaultSize, wxTE_MULTILINE|wxSIMPLE_BORDER|wxSTATI=
C_BORDER );
-	m_textCtrlMotd->SetFont( wxFont( 8, 74, 90, 90, false, wxT("Arial") ) );
+	m_textCtrlMotd->SetFont( wxFont( 8, 70, 90, 90, false, wxT("Arial") ) );
 	m_textCtrlMotd->SetForegroundColour( wxColour( 0, 0, 0 ) );
 	m_textCtrlMotd->SetBackgroundColour( wxColour( 255, 255, 255 ) );
 	m_textCtrlMotd->Enable( false );
@@ -49,8 +44,8 @@
 	=

 	bSizer4->Add( m_textCtrlMotd, 1, wxALL|wxEXPAND, 5 );
 	=

-	m_htmlWinMotd =3D new wxHtmlWindow( this, wxID_ANY, wxDefaultPosition, wx=
DefaultSize, wxHW_SCROLLBAR_AUTO);
-	m_htmlWinMotd->SetFont( wxFont( 8, 74, 90, 90, false, wxT("Arial") ) );
+	m_htmlWinMotd =3D new wxHtmlWindow( this, wxID_ANY, wxDefaultPosition, wx=
DefaultSize, wxHW_SCROLLBAR_AUTO );
+	m_htmlWinMotd->SetFont( wxFont( 8, 70, 90, 90, false, wxT("Arial") ) );
 	=

 	bSizer4->Add( m_htmlWinMotd, 1, wxALL|wxEXPAND|wxALIGN_CENTER_HORIZONTAL,=
 5 );
 	=

@@ -63,16 +58,18 @@
 	bSizer5 =3D new wxBoxSizer( wxVERTICAL );
 	=

 	m_staticText3 =3D new wxStaticText( this, wxID_ANY, wxT("Version"), wxDef=
aultPosition, wxDefaultSize, 0 );
-	m_staticText3->SetFont( wxFont( 10, 74, 90, 90, false, wxT("Arial") ) );
+	m_staticText3->Wrap( -1 );
+	m_staticText3->SetFont( wxFont( 10, 70, 90, 90, false, wxT("Arial") ) );
 	=

 	bSizer5->Add( m_staticText3, 0, wxALL, 5 );
 	=

 	wxBoxSizer* bSizer6;
 	bSizer6 =3D new wxBoxSizer( wxHORIZONTAL );
 	=

-	wxString m_choiceVersionChoices[] =3D { wxT("stable / stabil"), wxT("unst=
able / in Entwicklung") };
+	wxString m_choiceVersionChoices[] =3D { wxT("stable"), wxT("latest") };
 	int m_choiceVersionNChoices =3D sizeof( m_choiceVersionChoices ) / sizeof=
( wxString );
 	m_choiceVersion =3D new wxChoice( this, wxID_ANY, wxDefaultPosition, wxDe=
faultSize, m_choiceVersionNChoices, m_choiceVersionChoices, 0 );
+	m_choiceVersion->SetSelection( 0 );
 	m_choiceVersion->SetMinSize( wxSize( 150,-1 ) );
 	=

 	bSizer6->Add( m_choiceVersion, 1, wxALL|wxEXPAND, 5 );
@@ -82,8 +79,9 @@
 	=

 	bSizer5->Add( bSizer6, 0, wxEXPAND, 5 );
 	=

-	m_staticText4 =3D new wxStaticText( this, wxID_ANY, wxT("You can chose be=
tween two different versions of Iris.\n\nstable =3D should work quite well =
(if unsure take this)\nunstable =3D bleeding edge features and crashes ;)\n=
\nMan kann zwischen zwei Iris Versionen auswaehlen.\n\nstabil =3D sollte gu=
t arbeiten (normal will man diese Version)\nin Entwicklung =3D das Neueste =
vom Neuesten - Abstuerze eingeschlossen\n"), wxDefaultPosition, wxDefaultSi=
ze, 0 );
-	m_staticText4->SetFont( wxFont( 8, 74, 90, 90, false, wxT("Arial") ) );
+	m_staticText4 =3D new wxStaticText( this, wxID_ANY, wxT("You can chose be=
tween two different versions of Iris.\n\nlatest =3D most recent iris versio=
n\nstable =3D should work quite well (if latest does not work try this)\n\n=
Man kann zwischen zwei Iris Versionen auswaehlen.\n\nlatest =3D neueste Iri=
s Version\nstable =3D sollte gut arbeiten (falls latest nicht funktioniert)=
\n"), wxDefaultPosition, wxDefaultSize, 0 );
+	m_staticText4->Wrap( -1 );
+	m_staticText4->SetFont( wxFont( 8, 70, 90, 90, false, wxT("Arial") ) );
 	=

 	bSizer5->Add( m_staticText4, 0, wxALL, 5 );
 	=

@@ -93,13 +91,13 @@
 	wxBoxSizer* bSizer7;
 	bSizer7 =3D new wxBoxSizer( wxHORIZONTAL );
 	=

-	m_bitmapScreenshot1 =3D new wxStaticBitmap( this, wxID_ANY, wxBitmap(), w=
xDefaultPosition, wxDefaultSize, 0 );
+	m_bitmapScreenshot1 =3D new wxStaticBitmap( this, wxID_ANY, wxBitmap( wxT=
("BITMAP_SCREENSHOT1"), wxBITMAP_TYPE_RESOURCE ), wxDefaultPosition, wxDefa=
ultSize, 0 );
 	bSizer7->Add( m_bitmapScreenshot1, 0, wxALL, 2 );
 	=

-	m_bitmapScreenshot2 =3D new wxStaticBitmap( this, wxID_ANY, wxBitmap(), w=
xDefaultPosition, wxDefaultSize, 0 );
+	m_bitmapScreenshot2 =3D new wxStaticBitmap( this, wxID_ANY, wxBitmap( wxT=
("BITMAP_SCREENSHOT2"), wxBITMAP_TYPE_RESOURCE ), wxDefaultPosition, wxDefa=
ultSize, 0 );
 	bSizer7->Add( m_bitmapScreenshot2, 0, wxALL, 2 );
 	=

-	m_bitmapScreenshot3 =3D new wxStaticBitmap( this, wxID_ANY, wxBitmap(), w=
xDefaultPosition, wxDefaultSize, 0 );
+	m_bitmapScreenshot3 =3D new wxStaticBitmap( this, wxID_ANY, wxBitmap( wxT=
("BITMAP_SCREENSHOT3"), wxBITMAP_TYPE_RESOURCE ), wxDefaultPosition, wxDefa=
ultSize, 0 );
 	bSizer7->Add( m_bitmapScreenshot3, 0, wxALL, 2 );
 	=

 	bSizer5->Add( bSizer7, 0, wxALIGN_CENTER_HORIZONTAL, 5 );
@@ -108,7 +106,7 @@
 	bSizer5->Add( m_staticline11, 0, wxALL|wxEXPAND, 5 );
 	=

 	m_textCtrlLog =3D new wxTextCtrl( this, wxID_ANY, wxT("Click update to ge=
t the new version!\n"), wxDefaultPosition, wxDefaultSize, wxTE_MULTILINE|wx=
SIMPLE_BORDER|wxSTATIC_BORDER );
-	m_textCtrlLog->SetFont( wxFont( 8, 74, 90, 90, false, wxT("Arial") ) );
+	m_textCtrlLog->SetFont( wxFont( 8, 70, 90, 90, false, wxT("Arial") ) );
 	m_textCtrlLog->SetForegroundColour( wxColour( 0, 0, 0 ) );
 	m_textCtrlLog->SetBackgroundColour( wxColour( 255, 255, 255 ) );
 	m_textCtrlLog->Enable( false );
@@ -125,4 +123,17 @@
 	=

 	this->SetSizer( bSizer3 );
 	this->Layout();
+	=

+	// Connect Events
+	this->Connect( wxEVT_CLOSE_WINDOW, wxCloseEventHandler( MainFrame::onClos=
e ) );
+	m_buttonUpdate->Connect( wxEVT_COMMAND_BUTTON_CLICKED, wxCommandEventHand=
ler( MainFrame::updateGame ), NULL, this );
+	m_buttonStart->Connect( wxEVT_COMMAND_BUTTON_CLICKED, wxCommandEventHandl=
er( MainFrame::startGame ), NULL, this );
 }
+
+MainFrame::~MainFrame()
+{
+	// Disconnect Events
+	this->Disconnect( wxEVT_CLOSE_WINDOW, wxCloseEventHandler( MainFrame::onC=
lose ) );
+	m_buttonUpdate->Disconnect( wxEVT_COMMAND_BUTTON_CLICKED, wxCommandEventH=
andler( MainFrame::updateGame ), NULL, this );
+	m_buttonStart->Disconnect( wxEVT_COMMAND_BUTTON_CLICKED, wxCommandEventHa=
ndler( MainFrame::startGame ), NULL, this );
+}

Modified: tools/updater/noname.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/updater/noname.h (original)
+++ tools/updater/noname.h Sun Nov 29 01:48:35 2009
@@ -1,5 +1,5 @@
 ///////////////////////////////////////////////////////////////////////////
-// C++ code generated with wxFormBuilder (version Feb  1 2007)
+// C++ code generated with wxFormBuilder (version Feb  6 2009)
 // http://www.wxformbuilder.org/
 //
 // PLEASE DO "NOT" EDIT THIS FILE!
@@ -8,22 +8,24 @@
 #ifndef __noname__
 #define __noname__
 =

-// Define WX_GCH in order to support precompiled headers with GCC compiler.
-// You have to create the header "wx_pch.h" and include all files needed
-// for compile your gui inside it.
-// Then, compile it and place the file "wx_pch.h.gch" into the same
-// directory that "wx_pch.h".
-#ifdef WX_GCH
-#include <wx_pch.h>
-#else
-#include <wx/wx.h>
-#endif
-
+#include <wx/statusbr.h>
+#include <wx/gdicmn.h>
+#include <wx/font.h>
+#include <wx/colour.h>
+#include <wx/settings.h>
+#include <wx/string.h>
+#include <wx/bitmap.h>
+#include <wx/image.h>
+#include <wx/icon.h>
 #include <wx/statbmp.h>
+#include <wx/textctrl.h>
 #include <wx/html/htmlwin.h>
+#include <wx/sizer.h>
 #include <wx/statline.h>
+#include <wx/stattext.h>
 #include <wx/choice.h>
 #include <wx/button.h>
+#include <wx/frame.h>
 =

 ///////////////////////////////////////////////////////////////////////////
 =

@@ -32,14 +34,7 @@
 //////////////////////////////////////////////////////////////////////////=
/////
 class MainFrame : public wxFrame =

 {
-	DECLARE_EVENT_TABLE()
 	private:
-		=

-		// Private event handlers
-		void _wxFB_onClose( wxCloseEvent& event ){ onClose( event ); }
-		void _wxFB_updateGame( wxCommandEvent& event ){ updateGame( event ); }
-		void _wxFB_startGame( wxCommandEvent& event ){ startGame( event ); }
-		=

 	=

 	protected:
 		enum
@@ -67,13 +62,15 @@
 		wxButton* m_buttonStart;
 		=

 		// Virtual event handlers, overide them in your derived class
-		virtual void onClose( wxCloseEvent& event ){ event.Skip(); }
-		virtual void updateGame( wxCommandEvent& event ){ event.Skip(); }
-		virtual void startGame( wxCommandEvent& event ){ event.Skip(); }
+		virtual void onClose( wxCloseEvent& event ) { event.Skip(); }
+		virtual void updateGame( wxCommandEvent& event ) { event.Skip(); }
+		virtual void startGame( wxCommandEvent& event ) { event.Skip(); }
 		=

 	=

 	public:
-		MainFrame( wxWindow* parent, int id =3D wxID_ANY, wxString title =3D wxT=
("Iris Updater"), wxPoint pos =3D wxDefaultPosition, wxSize size =3D wxSize=
( 800,600 ), int style =3D wxDEFAULT_FRAME_STYLE|wxTAB_TRAVERSAL );
+		=

+		MainFrame( wxWindow* parent, wxWindowID id =3D wxID_ANY, const wxString&=
 title =3D wxT("Iris Updater"), const wxPoint& pos =3D wxDefaultPosition, c=
onst wxSize& size =3D wxSize( 800,600 ), long style =3D wxDEFAULT_FRAME_STY=
LE|wxTAB_TRAVERSAL );
+		~MainFrame();
 	=

 };
 =


Modified: tools/updater/readme.txt
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/updater/readme.txt (original)
+++ tools/updater/readme.txt Sun Nov 29 01:48:35 2009
@@ -83,3 +83,6 @@
 	CVTRES : fatal error CVT1100: Doppelte Ressource. type:MANIFEST, name:1, =
language:0x0409.
 	you've made a debug compile, =

 	use release instead.
+
+=3D=3D other stuff =3D=3D
+you can replace the screenshots by putting a screenshot[1-3].bmp file next=
 to the binary

Modified: tools/updater/res/screenshot1.bmp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: tools/updater/res/screenshot2.bmp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: tools/updater/res/screenshot3.bmp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: tools/updater/svn.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/updater/svn.cpp (original)
+++ tools/updater/svn.cpp Sun Nov 29 01:48:35 2009
@@ -26,8 +26,8 @@
 =

 #include "svn.h"
 =

-#pragma comment(lib,"libapr.lib")
-#pragma comment(lib,"libaprutil.lib")
+#pragma comment(lib,"libapr-1.lib")
+#pragma comment(lib,"libaprutil-1.lib")
 =

 #pragma comment(lib,"libsvn_client-1.lib")
 #pragma comment(lib,"libsvn_subr-1.lib")
@@ -37,7 +37,7 @@
 #pragma comment(lib,"libsvn_fs_fs-1.lib")
 #pragma comment(lib,"libsvn_fs_base-1.lib")
 #pragma comment(lib,"libsvn_ra-1.lib")
-#pragma comment(lib,"libsvn_ra_dav-1.lib")
+#pragma comment(lib,"libsvn_ra_neon-1.lib")
 #pragma comment(lib,"libsvn_ra_svn-1.lib")
 #pragma comment(lib,"libsvn_ra_local-1.lib")
 #pragma comment(lib,"libsvn_diff-1.lib")
@@ -223,7 +223,7 @@
 			return std::string();
 		}
 	} =

-	catch(svn::ClientException &e) {
+	catch(svn::ClientException &) {
 		//if(listener)listener->Notify(e.message());
 		return std::string();
 	}
@@ -277,6 +277,6 @@
 		//printf("rev=3D%d\n",rev);
 	}
 	catch(svn::ClientException &e){
-		if(listener)listener->svnNotify(e.message());
+		if(listener)listener->svnError(e.message(), e.apr_err());
 	}
 }

Modified: tools/updater/svn.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/updater/svn.h (original)
+++ tools/updater/svn.h Sun Nov 29 01:48:35 2009
@@ -23,6 +23,8 @@
 class iSvnContextNotifyListerner { public:
 	// shows a log message
 	virtual void svnNotify(const char *szMessage) =3D 0;
+	// shows a error message
+	virtual void svnError(const char *szMessage, int errorCode) =3D 0;
 	// should svn cancel? true -> to close svn
 	virtual bool svnCancel() =3D 0;
 };

Modified: tools/updater/updater.fbp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/updater/updater.fbp (original)
+++ tools/updater/updater.fbp Sun Nov 29 01:48:35 2009
@@ -1,22 +1,28 @@
 <?xml version=3D"1.0" encoding=3D"UTF-8" standalone=3D"yes" ?>
 <wxFormBuilder_Project>
-    <FileVersion major=3D"1" minor=3D"5" />
+    <FileVersion major=3D"1" minor=3D"9" />
     <object class=3D"Project" expanded=3D"1">
-        <property name=3D"bitmaps"></property>
+        <property name=3D"class_decoration"></property>
         <property name=3D"code_generation">C++</property>
+        <property name=3D"disconnect_events">1</property>
+        <property name=3D"encoding">UTF-8</property>
+        <property name=3D"event_generation">connect</property>
+        <property name=3D"event_handler">impl_virtual</property>
         <property name=3D"file"></property>
         <property name=3D"first_id">1000</property>
-        <property name=3D"icons"></property>
+        <property name=3D"help_provider">none</property>
         <property name=3D"internationalize">0</property>
         <property name=3D"name">Iris Updater</property>
+        <property name=3D"namespace"></property>
         <property name=3D"path">.</property>
-        <property name=3D"precompiled_header">wx/wxprec.h</property>
+        <property name=3D"precompiled_header">#include &quot;wx/wxprec.h&q=
uot;&#x0A;&#x0A;#ifdef __BORLANDC__&#x0A;#pragma hdrstop&#x0A;#endif //__BO=
RLANDC__&#x0A;&#x0A;#ifndef WX_PRECOMP&#x0A;#include &lt;wx/wx.h&gt;&#x0A;#=
endif //WX_PRECOMP</property>
         <property name=3D"relative_path">1</property>
         <property name=3D"use_enum">1</property>
         <property name=3D"use_microsoft_bom">0</property>
         <object class=3D"Frame" expanded=3D"1">
             <property name=3D"bg">255,255,255</property>
             <property name=3D"center"></property>
+            <property name=3D"context_help"></property>
             <property name=3D"enabled">1</property>
             <property name=3D"extra_style"></property>
             <property name=3D"fg">0,0,0</property>
@@ -32,13 +38,46 @@
             <property name=3D"subclass"></property>
             <property name=3D"title">Iris Updater</property>
             <property name=3D"tooltip"></property>
+            <property name=3D"validator_data_type"></property>
+            <property name=3D"validator_style">wxFILTER_NONE</property>
+            <property name=3D"validator_type">wxDefaultValidator</property>
+            <property name=3D"validator_variable"></property>
             <property name=3D"window_extra_style"></property>
+            <property name=3D"window_name"></property>
             <property name=3D"window_style">wxTAB_TRAVERSAL</property>
             <property name=3D"xrc_skip_sizer">1</property>
+            <event name=3D"OnActivate"></event>
+            <event name=3D"OnActivateApp"></event>
+            <event name=3D"OnChar"></event>
             <event name=3D"OnClose">onClose</event>
+            <event name=3D"OnEnterWindow"></event>
+            <event name=3D"OnEraseBackground"></event>
+            <event name=3D"OnHibernate"></event>
+            <event name=3D"OnIconize"></event>
+            <event name=3D"OnIdle"></event>
+            <event name=3D"OnKeyDown"></event>
+            <event name=3D"OnKeyUp"></event>
+            <event name=3D"OnKillFocus"></event>
+            <event name=3D"OnLeaveWindow"></event>
+            <event name=3D"OnLeftDClick"></event>
+            <event name=3D"OnLeftDown"></event>
+            <event name=3D"OnLeftUp"></event>
+            <event name=3D"OnMiddleDClick"></event>
+            <event name=3D"OnMiddleDown"></event>
+            <event name=3D"OnMiddleUp"></event>
+            <event name=3D"OnMotion"></event>
+            <event name=3D"OnMouseEvents"></event>
+            <event name=3D"OnMouseWheel"></event>
+            <event name=3D"OnPaint"></event>
+            <event name=3D"OnRightDClick"></event>
+            <event name=3D"OnRightDown"></event>
+            <event name=3D"OnRightUp"></event>
+            <event name=3D"OnSetFocus"></event>
             <event name=3D"OnSize"></event>
+            <event name=3D"OnUpdateUI"></event>
             <object class=3D"wxStatusBar" expanded=3D"1">
                 <property name=3D"bg"></property>
+                <property name=3D"context_help"></property>
                 <property name=3D"enabled">1</property>
                 <property name=3D"fg"></property>
                 <property name=3D"fields">1</property>
@@ -54,13 +93,42 @@
                 <property name=3D"style">wxST_SIZEGRIP</property>
                 <property name=3D"subclass"></property>
                 <property name=3D"tooltip"></property>
+                <property name=3D"validator_data_type"></property>
+                <property name=3D"validator_style">wxFILTER_NONE</property>
+                <property name=3D"validator_type">wxDefaultValidator</prop=
erty>
+                <property name=3D"validator_variable"></property>
                 <property name=3D"window_extra_style"></property>
+                <property name=3D"window_name"></property>
                 <property name=3D"window_style"></property>
+                <event name=3D"OnChar"></event>
+                <event name=3D"OnEnterWindow"></event>
+                <event name=3D"OnEraseBackground"></event>
+                <event name=3D"OnKeyDown"></event>
+                <event name=3D"OnKeyUp"></event>
+                <event name=3D"OnKillFocus"></event>
+                <event name=3D"OnLeaveWindow"></event>
+                <event name=3D"OnLeftDClick"></event>
+                <event name=3D"OnLeftDown"></event>
+                <event name=3D"OnLeftUp"></event>
+                <event name=3D"OnMiddleDClick"></event>
+                <event name=3D"OnMiddleDown"></event>
+                <event name=3D"OnMiddleUp"></event>
+                <event name=3D"OnMotion"></event>
+                <event name=3D"OnMouseEvents"></event>
+                <event name=3D"OnMouseWheel"></event>
+                <event name=3D"OnPaint"></event>
+                <event name=3D"OnRightDClick"></event>
+                <event name=3D"OnRightDown"></event>
+                <event name=3D"OnRightUp"></event>
+                <event name=3D"OnSetFocus"></event>
+                <event name=3D"OnSize"></event>
+                <event name=3D"OnUpdateUI"></event>
             </object>
             <object class=3D"wxBoxSizer" expanded=3D"1">
                 <property name=3D"minimum_size"></property>
                 <property name=3D"name">bSizer3</property>
                 <property name=3D"orient">wxHORIZONTAL</property>
+                <property name=3D"permission">none</property>
                 <object class=3D"sizeritem" expanded=3D"1">
                     <property name=3D"border">5</property>
                     <property name=3D"flag">wxALL|wxEXPAND</property>
@@ -69,13 +137,15 @@
                         <property name=3D"minimum_size"></property>
                         <property name=3D"name">bSizer4</property>
                         <property name=3D"orient">wxVERTICAL</property>
+                        <property name=3D"permission">none</property>
                         <object class=3D"sizeritem" expanded=3D"1">
                             <property name=3D"border">5</property>
                             <property name=3D"flag">wxALIGN_CENTER_HORIZON=
TAL</property>
                             <property name=3D"proportion">0</property>
                             <object class=3D"wxStaticBitmap" expanded=3D"1=
">
                                 <property name=3D"bg"></property>
-                                <property name=3D"bitmap">res/banner.bmp; =
Load From File</property>
+                                <property name=3D"bitmap">BITMAP_BANNER; L=
oad From Resource</property>
+                                <property name=3D"context_help"></property>
                                 <property name=3D"enabled">1</property>
                                 <property name=3D"fg"></property>
                                 <property name=3D"font"></property>
@@ -89,8 +159,36 @@
                                 <property name=3D"size">-1,-1</property>
                                 <property name=3D"subclass"></property>
                                 <property name=3D"tooltip"></property>
+                                <property name=3D"validator_data_type"></p=
roperty>
+                                <property name=3D"validator_style">wxFILTE=
R_NONE</property>
+                                <property name=3D"validator_type">wxDefaul=
tValidator</property>
+                                <property name=3D"validator_variable"></pr=
operty>
                                 <property name=3D"window_extra_style"></pr=
operty>
+                                <property name=3D"window_name"></property>
                                 <property name=3D"window_style"></property>
+                                <event name=3D"OnChar"></event>
+                                <event name=3D"OnEnterWindow"></event>
+                                <event name=3D"OnEraseBackground"></event>
+                                <event name=3D"OnKeyDown"></event>
+                                <event name=3D"OnKeyUp"></event>
+                                <event name=3D"OnKillFocus"></event>
+                                <event name=3D"OnLeaveWindow"></event>
+                                <event name=3D"OnLeftDClick"></event>
+                                <event name=3D"OnLeftDown"></event>
+                                <event name=3D"OnLeftUp"></event>
+                                <event name=3D"OnMiddleDClick"></event>
+                                <event name=3D"OnMiddleDown"></event>
+                                <event name=3D"OnMiddleUp"></event>
+                                <event name=3D"OnMotion"></event>
+                                <event name=3D"OnMouseEvents"></event>
+                                <event name=3D"OnMouseWheel"></event>
+                                <event name=3D"OnPaint"></event>
+                                <event name=3D"OnRightDClick"></event>
+                                <event name=3D"OnRightDown"></event>
+                                <event name=3D"OnRightUp"></event>
+                                <event name=3D"OnSetFocus"></event>
+                                <event name=3D"OnSize"></event>
+                                <event name=3D"OnUpdateUI"></event>
                             </object>
                         </object>
                         <object class=3D"sizeritem" expanded=3D"1">
@@ -99,6 +197,7 @@
                             <property name=3D"proportion">1</property>
                             <object class=3D"wxTextCtrl" expanded=3D"1">
                                 <property name=3D"bg">255,255,255</propert=
y>
+                                <property name=3D"context_help"></property>
                                 <property name=3D"enabled">0</property>
                                 <property name=3D"fg">0,0,0</property>
                                 <property name=3D"font">Arial,90,90,8</pro=
perty>
@@ -114,13 +213,41 @@
                                 <property name=3D"style">wxTE_MULTILINE</p=
roperty>
                                 <property name=3D"subclass"></property>
                                 <property name=3D"tooltip"></property>
+                                <property name=3D"validator_data_type"></p=
roperty>
+                                <property name=3D"validator_style">wxFILTE=
R_NONE</property>
+                                <property name=3D"validator_type">wxDefaul=
tValidator</property>
+                                <property name=3D"validator_variable"></pr=
operty>
                                 <property name=3D"value">Welcome to Iris!<=
/property>
                                 <property name=3D"window_extra_style"></pr=
operty>
+                                <property name=3D"window_name"></property>
                                 <property name=3D"window_style">wxSIMPLE_B=
ORDER|wxSTATIC_BORDER</property>
+                                <event name=3D"OnChar"></event>
+                                <event name=3D"OnEnterWindow"></event>
+                                <event name=3D"OnEraseBackground"></event>
+                                <event name=3D"OnKeyDown"></event>
+                                <event name=3D"OnKeyUp"></event>
+                                <event name=3D"OnKillFocus"></event>
+                                <event name=3D"OnLeaveWindow"></event>
+                                <event name=3D"OnLeftDClick"></event>
+                                <event name=3D"OnLeftDown"></event>
+                                <event name=3D"OnLeftUp"></event>
+                                <event name=3D"OnMiddleDClick"></event>
+                                <event name=3D"OnMiddleDown"></event>
+                                <event name=3D"OnMiddleUp"></event>
+                                <event name=3D"OnMotion"></event>
+                                <event name=3D"OnMouseEvents"></event>
+                                <event name=3D"OnMouseWheel"></event>
+                                <event name=3D"OnPaint"></event>
+                                <event name=3D"OnRightDClick"></event>
+                                <event name=3D"OnRightDown"></event>
+                                <event name=3D"OnRightUp"></event>
+                                <event name=3D"OnSetFocus"></event>
+                                <event name=3D"OnSize"></event>
                                 <event name=3D"OnText"></event>
                                 <event name=3D"OnTextEnter"></event>
                                 <event name=3D"OnTextMaxLen"></event>
                                 <event name=3D"OnTextURL"></event>
+                                <event name=3D"OnUpdateUI"></event>
                             </object>
                         </object>
                         <object class=3D"sizeritem" expanded=3D"1">
@@ -129,6 +256,7 @@
                             <property name=3D"proportion">1</property>
                             <object class=3D"wxHtmlWindow" expanded=3D"1">
                                 <property name=3D"bg"></property>
+                                <property name=3D"context_help"></property>
                                 <property name=3D"enabled">1</property>
                                 <property name=3D"fg"></property>
                                 <property name=3D"font">Arial,90,90,8</pro=
perty>
@@ -143,8 +271,39 @@
                                 <property name=3D"style">wxHW_SCROLLBAR_AU=
TO</property>
                                 <property name=3D"subclass"></property>
                                 <property name=3D"tooltip"></property>
+                                <property name=3D"validator_data_type"></p=
roperty>
+                                <property name=3D"validator_style">wxFILTE=
R_NONE</property>
+                                <property name=3D"validator_type">wxDefaul=
tValidator</property>
+                                <property name=3D"validator_variable"></pr=
operty>
                                 <property name=3D"window_extra_style"></pr=
operty>
+                                <property name=3D"window_name"></property>
                                 <property name=3D"window_style"></property>
+                                <event name=3D"OnChar"></event>
+                                <event name=3D"OnEnterWindow"></event>
+                                <event name=3D"OnEraseBackground"></event>
+                                <event name=3D"OnHtmlCellClicked"></event>
+                                <event name=3D"OnHtmlCellHover"></event>
+                                <event name=3D"OnHtmlLinkClicked"></event>
+                                <event name=3D"OnKeyDown"></event>
+                                <event name=3D"OnKeyUp"></event>
+                                <event name=3D"OnKillFocus"></event>
+                                <event name=3D"OnLeaveWindow"></event>
+                                <event name=3D"OnLeftDClick"></event>
+                                <event name=3D"OnLeftDown"></event>
+                                <event name=3D"OnLeftUp"></event>
+                                <event name=3D"OnMiddleDClick"></event>
+                                <event name=3D"OnMiddleDown"></event>
+                                <event name=3D"OnMiddleUp"></event>
+                                <event name=3D"OnMotion"></event>
+                                <event name=3D"OnMouseEvents"></event>
+                                <event name=3D"OnMouseWheel"></event>
+                                <event name=3D"OnPaint"></event>
+                                <event name=3D"OnRightDClick"></event>
+                                <event name=3D"OnRightDown"></event>
+                                <event name=3D"OnRightUp"></event>
+                                <event name=3D"OnSetFocus"></event>
+                                <event name=3D"OnSize"></event>
+                                <event name=3D"OnUpdateUI"></event>
                             </object>
                         </object>
                     </object>
@@ -155,6 +314,7 @@
                     <property name=3D"proportion">0</property>
                     <object class=3D"wxStaticLine" expanded=3D"1">
                         <property name=3D"bg"></property>
+                        <property name=3D"context_help"></property>
                         <property name=3D"enabled">1</property>
                         <property name=3D"fg"></property>
                         <property name=3D"font"></property>
@@ -169,8 +329,36 @@
                         <property name=3D"style">wxLI_VERTICAL</property>
                         <property name=3D"subclass"></property>
                         <property name=3D"tooltip"></property>
+                        <property name=3D"validator_data_type"></property>
+                        <property name=3D"validator_style">wxFILTER_NONE</=
property>
+                        <property name=3D"validator_type">wxDefaultValidat=
or</property>
+                        <property name=3D"validator_variable"></property>
                         <property name=3D"window_extra_style"></property>
+                        <property name=3D"window_name"></property>
                         <property name=3D"window_style"></property>
+                        <event name=3D"OnChar"></event>
+                        <event name=3D"OnEnterWindow"></event>
+                        <event name=3D"OnEraseBackground"></event>
+                        <event name=3D"OnKeyDown"></event>
+                        <event name=3D"OnKeyUp"></event>
+                        <event name=3D"OnKillFocus"></event>
+                        <event name=3D"OnLeaveWindow"></event>
+                        <event name=3D"OnLeftDClick"></event>
+                        <event name=3D"OnLeftDown"></event>
+                        <event name=3D"OnLeftUp"></event>
+                        <event name=3D"OnMiddleDClick"></event>
+                        <event name=3D"OnMiddleDown"></event>
+                        <event name=3D"OnMiddleUp"></event>
+                        <event name=3D"OnMotion"></event>
+                        <event name=3D"OnMouseEvents"></event>
+                        <event name=3D"OnMouseWheel"></event>
+                        <event name=3D"OnPaint"></event>
+                        <event name=3D"OnRightDClick"></event>
+                        <event name=3D"OnRightDown"></event>
+                        <event name=3D"OnRightUp"></event>
+                        <event name=3D"OnSetFocus"></event>
+                        <event name=3D"OnSize"></event>
+                        <event name=3D"OnUpdateUI"></event>
                     </object>
                 </object>
                 <object class=3D"sizeritem" expanded=3D"1">
@@ -181,12 +369,14 @@
                         <property name=3D"minimum_size"></property>
                         <property name=3D"name">bSizer5</property>
                         <property name=3D"orient">wxVERTICAL</property>
+                        <property name=3D"permission">none</property>
                         <object class=3D"sizeritem" expanded=3D"1">
                             <property name=3D"border">5</property>
                             <property name=3D"flag">wxALL</property>
                             <property name=3D"proportion">0</property>
                             <object class=3D"wxStaticText" expanded=3D"1">
                                 <property name=3D"bg"></property>
+                                <property name=3D"context_help"></property>
                                 <property name=3D"enabled">1</property>
                                 <property name=3D"fg"></property>
                                 <property name=3D"font">Arial,90,90,10</pr=
operty>
@@ -202,8 +392,37 @@
                                 <property name=3D"style"></property>
                                 <property name=3D"subclass"></property>
                                 <property name=3D"tooltip"></property>
+                                <property name=3D"validator_data_type"></p=
roperty>
+                                <property name=3D"validator_style">wxFILTE=
R_NONE</property>
+                                <property name=3D"validator_type">wxDefaul=
tValidator</property>
+                                <property name=3D"validator_variable"></pr=
operty>
                                 <property name=3D"window_extra_style"></pr=
operty>
+                                <property name=3D"window_name"></property>
                                 <property name=3D"window_style"></property>
+                                <property name=3D"wrap">-1</property>
+                                <event name=3D"OnChar"></event>
+                                <event name=3D"OnEnterWindow"></event>
+                                <event name=3D"OnEraseBackground"></event>
+                                <event name=3D"OnKeyDown"></event>
+                                <event name=3D"OnKeyUp"></event>
+                                <event name=3D"OnKillFocus"></event>
+                                <event name=3D"OnLeaveWindow"></event>
+                                <event name=3D"OnLeftDClick"></event>
+                                <event name=3D"OnLeftDown"></event>
+                                <event name=3D"OnLeftUp"></event>
+                                <event name=3D"OnMiddleDClick"></event>
+                                <event name=3D"OnMiddleDown"></event>
+                                <event name=3D"OnMiddleUp"></event>
+                                <event name=3D"OnMotion"></event>
+                                <event name=3D"OnMouseEvents"></event>
+                                <event name=3D"OnMouseWheel"></event>
+                                <event name=3D"OnPaint"></event>
+                                <event name=3D"OnRightDClick"></event>
+                                <event name=3D"OnRightDown"></event>
+                                <event name=3D"OnRightUp"></event>
+                                <event name=3D"OnSetFocus"></event>
+                                <event name=3D"OnSize"></event>
+                                <event name=3D"OnUpdateUI"></event>
                             </object>
                         </object>
                         <object class=3D"sizeritem" expanded=3D"1">
@@ -214,13 +433,15 @@
                                 <property name=3D"minimum_size"></property>
                                 <property name=3D"name">bSizer6</property>
                                 <property name=3D"orient">wxHORIZONTAL</pr=
operty>
+                                <property name=3D"permission">none</proper=
ty>
                                 <object class=3D"sizeritem" expanded=3D"1">
                                     <property name=3D"border">5</property>
                                     <property name=3D"flag">wxALL|wxEXPAND=
</property>
                                     <property name=3D"proportion">1</prope=
rty>
                                     <object class=3D"wxChoice" expanded=3D=
"1">
                                         <property name=3D"bg"></property>
-                                        <property name=3D"choices">&apos;s=
table / stabil&apos; &apos;unstable / in Entwicklung&apos;</property>
+                                        <property name=3D"choices">&quot;s=
table&quot; &quot;latest&quot;</property>
+                                        <property name=3D"context_help"></=
property>
                                         <property name=3D"enabled">1</prop=
erty>
                                         <property name=3D"fg"></property>
                                         <property name=3D"font"></property>
@@ -231,12 +452,41 @@
                                         <property name=3D"name">m_choiceVe=
rsion</property>
                                         <property name=3D"permission">prot=
ected</property>
                                         <property name=3D"pos"></property>
+                                        <property name=3D"selection">0</pr=
operty>
                                         <property name=3D"size"></property>
                                         <property name=3D"subclass"></prop=
erty>
                                         <property name=3D"tooltip"></prope=
rty>
+                                        <property name=3D"validator_data_t=
ype"></property>
+                                        <property name=3D"validator_style"=
>wxFILTER_NONE</property>
+                                        <property name=3D"validator_type">=
wxDefaultValidator</property>
+                                        <property name=3D"validator_variab=
le"></property>
                                         <property name=3D"window_extra_sty=
le"></property>
+                                        <property name=3D"window_name"></p=
roperty>
                                         <property name=3D"window_style"></=
property>
+                                        <event name=3D"OnChar"></event>
                                         <event name=3D"OnChoice"></event>
+                                        <event name=3D"OnEnterWindow"></ev=
ent>
+                                        <event name=3D"OnEraseBackground">=
</event>
+                                        <event name=3D"OnKeyDown"></event>
+                                        <event name=3D"OnKeyUp"></event>
+                                        <event name=3D"OnKillFocus"></even=
t>
+                                        <event name=3D"OnLeaveWindow"></ev=
ent>
+                                        <event name=3D"OnLeftDClick"></eve=
nt>
+                                        <event name=3D"OnLeftDown"></event>
+                                        <event name=3D"OnLeftUp"></event>
+                                        <event name=3D"OnMiddleDClick"></e=
vent>
+                                        <event name=3D"OnMiddleDown"></eve=
nt>
+                                        <event name=3D"OnMiddleUp"></event>
+                                        <event name=3D"OnMotion"></event>
+                                        <event name=3D"OnMouseEvents"></ev=
ent>
+                                        <event name=3D"OnMouseWheel"></eve=
nt>
+                                        <event name=3D"OnPaint"></event>
+                                        <event name=3D"OnRightDClick"></ev=
ent>
+                                        <event name=3D"OnRightDown"></even=
t>
+                                        <event name=3D"OnRightUp"></event>
+                                        <event name=3D"OnSetFocus"></event>
+                                        <event name=3D"OnSize"></event>
+                                        <event name=3D"OnUpdateUI"></event>
                                     </object>
                                 </object>
                                 <object class=3D"sizeritem" expanded=3D"1">
@@ -245,6 +495,8 @@
                                     <property name=3D"proportion">0</prope=
rty>
                                     <object class=3D"wxButton" expanded=3D=
"1">
                                         <property name=3D"bg"></property>
+                                        <property name=3D"context_help"></=
property>
+                                        <property name=3D"default">0</prop=
erty>
                                         <property name=3D"enabled">1</prop=
erty>
                                         <property name=3D"fg"></property>
                                         <property name=3D"font"></property>
@@ -260,9 +512,37 @@
                                         <property name=3D"style"></propert=
y>
                                         <property name=3D"subclass"></prop=
erty>
                                         <property name=3D"tooltip"></prope=
rty>
+                                        <property name=3D"validator_data_t=
ype"></property>
+                                        <property name=3D"validator_style"=
>wxFILTER_NONE</property>
+                                        <property name=3D"validator_type">=
wxDefaultValidator</property>
+                                        <property name=3D"validator_variab=
le"></property>
                                         <property name=3D"window_extra_sty=
le"></property>
+                                        <property name=3D"window_name"></p=
roperty>
                                         <property name=3D"window_style"></=
property>
                                         <event name=3D"OnButtonClick">upda=
teGame</event>
+                                        <event name=3D"OnChar"></event>
+                                        <event name=3D"OnEnterWindow"></ev=
ent>
+                                        <event name=3D"OnEraseBackground">=
</event>
+                                        <event name=3D"OnKeyDown"></event>
+                                        <event name=3D"OnKeyUp"></event>
+                                        <event name=3D"OnKillFocus"></even=
t>
+                                        <event name=3D"OnLeaveWindow"></ev=
ent>
+                                        <event name=3D"OnLeftDClick"></eve=
nt>
+                                        <event name=3D"OnLeftDown"></event>
+                                        <event name=3D"OnLeftUp"></event>
+                                        <event name=3D"OnMiddleDClick"></e=
vent>
+                                        <event name=3D"OnMiddleDown"></eve=
nt>
+                                        <event name=3D"OnMiddleUp"></event>
+                                        <event name=3D"OnMotion"></event>
+                                        <event name=3D"OnMouseEvents"></ev=
ent>
+                                        <event name=3D"OnMouseWheel"></eve=
nt>
+                                        <event name=3D"OnPaint"></event>
+                                        <event name=3D"OnRightDClick"></ev=
ent>
+                                        <event name=3D"OnRightDown"></even=
t>
+                                        <event name=3D"OnRightUp"></event>
+                                        <event name=3D"OnSetFocus"></event>
+                                        <event name=3D"OnSize"></event>
+                                        <event name=3D"OnUpdateUI"></event>
                                     </object>
                                 </object>
                             </object>
@@ -273,12 +553,13 @@
                             <property name=3D"proportion">0</property>
                             <object class=3D"wxStaticText" expanded=3D"1">
                                 <property name=3D"bg"></property>
+                                <property name=3D"context_help"></property>
                                 <property name=3D"enabled">1</property>
                                 <property name=3D"fg"></property>
                                 <property name=3D"font">Arial,90,90,8</pro=
perty>
                                 <property name=3D"hidden">0</property>
                                 <property name=3D"id">wxID_ANY</property>
-                                <property name=3D"label">You can chose bet=
ween two different versions of Iris.&#x0A;&#x0A;stable =3D should work quit=
e well (if unsure take this)&#x0A;unstable =3D bleeding edge features and c=
rashes ;)&#x0A;&#x0A;Man kann zwischen zwei Iris Versionen auswaehlen.&#x0A=
;&#x0A;stabil =3D sollte gut arbeiten (normal will man diese Version)&#x0A;=
in Entwicklung =3D das Neueste vom Neuesten - Abstuerze eingeschlossen&#x0A=
;</property>
+                                <property name=3D"label">You can chose bet=
ween two different versions of Iris.&#x0A;&#x0A;latest =3D most recent iris=
 version&#x0A;stable =3D should work quite well (if latest does not work tr=
y this)&#x0A;&#x0A;Man kann zwischen zwei Iris Versionen auswaehlen.&#x0A;&=
#x0A;latest =3D neueste Iris Version&#x0A;stable =3D sollte gut arbeiten (f=
alls latest nicht funktioniert)&#x0A;</property>
                                 <property name=3D"maximum_size"></property>
                                 <property name=3D"minimum_size"></property>
                                 <property name=3D"name">m_staticText4</pro=
perty>
@@ -288,8 +569,37 @@
                                 <property name=3D"style"></property>
                                 <property name=3D"subclass"></property>
                                 <property name=3D"tooltip"></property>
+                                <property name=3D"validator_data_type"></p=
roperty>
+                                <property name=3D"validator_style">wxFILTE=
R_NONE</property>
+                                <property name=3D"validator_type">wxDefaul=
tValidator</property>
+                                <property name=3D"validator_variable"></pr=
operty>
                                 <property name=3D"window_extra_style"></pr=
operty>
+                                <property name=3D"window_name"></property>
                                 <property name=3D"window_style"></property>
+                                <property name=3D"wrap">-1</property>
+                                <event name=3D"OnChar"></event>
+                                <event name=3D"OnEnterWindow"></event>
+                                <event name=3D"OnEraseBackground"></event>
+                                <event name=3D"OnKeyDown"></event>
+                                <event name=3D"OnKeyUp"></event>
+                                <event name=3D"OnKillFocus"></event>
+                                <event name=3D"OnLeaveWindow"></event>
+                                <event name=3D"OnLeftDClick"></event>
+                                <event name=3D"OnLeftDown"></event>
+                                <event name=3D"OnLeftUp"></event>
+                                <event name=3D"OnMiddleDClick"></event>
+                                <event name=3D"OnMiddleDown"></event>
+                                <event name=3D"OnMiddleUp"></event>
+                                <event name=3D"OnMotion"></event>
+                                <event name=3D"OnMouseEvents"></event>
+                                <event name=3D"OnMouseWheel"></event>
+                                <event name=3D"OnPaint"></event>
+                                <event name=3D"OnRightDClick"></event>
+                                <event name=3D"OnRightDown"></event>
+                                <event name=3D"OnRightUp"></event>
+                                <event name=3D"OnSetFocus"></event>
+                                <event name=3D"OnSize"></event>
+                                <event name=3D"OnUpdateUI"></event>
                             </object>
                         </object>
                         <object class=3D"sizeritem" expanded=3D"1">
@@ -298,6 +608,7 @@
                             <property name=3D"proportion">0</property>
                             <object class=3D"wxStaticLine" expanded=3D"1">
                                 <property name=3D"bg"></property>
+                                <property name=3D"context_help"></property>
                                 <property name=3D"enabled">1</property>
                                 <property name=3D"fg"></property>
                                 <property name=3D"font"></property>
@@ -312,8 +623,36 @@
                                 <property name=3D"style">wxLI_HORIZONTAL</=
property>
                                 <property name=3D"subclass"></property>
                                 <property name=3D"tooltip"></property>
+                                <property name=3D"validator_data_type"></p=
roperty>
+                                <property name=3D"validator_style">wxFILTE=
R_NONE</property>
+                                <property name=3D"validator_type">wxDefaul=
tValidator</property>
+                                <property name=3D"validator_variable"></pr=
operty>
                                 <property name=3D"window_extra_style"></pr=
operty>
+                                <property name=3D"window_name"></property>
                                 <property name=3D"window_style"></property>
+                                <event name=3D"OnChar"></event>
+                                <event name=3D"OnEnterWindow"></event>
+                                <event name=3D"OnEraseBackground"></event>
+                                <event name=3D"OnKeyDown"></event>
+                                <event name=3D"OnKeyUp"></event>
+                                <event name=3D"OnKillFocus"></event>
+                                <event name=3D"OnLeaveWindow"></event>
+                                <event name=3D"OnLeftDClick"></event>
+                                <event name=3D"OnLeftDown"></event>
+                                <event name=3D"OnLeftUp"></event>
+                                <event name=3D"OnMiddleDClick"></event>
+                                <event name=3D"OnMiddleDown"></event>
+                                <event name=3D"OnMiddleUp"></event>
+                                <event name=3D"OnMotion"></event>
+                                <event name=3D"OnMouseEvents"></event>
+                                <event name=3D"OnMouseWheel"></event>
+                                <event name=3D"OnPaint"></event>
+                                <event name=3D"OnRightDClick"></event>
+                                <event name=3D"OnRightDown"></event>
+                                <event name=3D"OnRightUp"></event>
+                                <event name=3D"OnSetFocus"></event>
+                                <event name=3D"OnSize"></event>
+                                <event name=3D"OnUpdateUI"></event>
                             </object>
                         </object>
                         <object class=3D"sizeritem" expanded=3D"1">
@@ -324,13 +663,15 @@
                                 <property name=3D"minimum_size"></property>
                                 <property name=3D"name">bSizer7</property>
                                 <property name=3D"orient">wxHORIZONTAL</pr=
operty>
+                                <property name=3D"permission">none</proper=
ty>
                                 <object class=3D"sizeritem" expanded=3D"1">
                                     <property name=3D"border">2</property>
                                     <property name=3D"flag">wxALL</propert=
y>
                                     <property name=3D"proportion">0</prope=
rty>
                                     <object class=3D"wxStaticBitmap" expan=
ded=3D"1">
                                         <property name=3D"bg"></property>
-                                        <property name=3D"bitmap">res/scre=
enshot1.bmp; Load From File</property>
+                                        <property name=3D"bitmap">BITMAP_S=
CREENSHOT1; Load From Resource</property>
+                                        <property name=3D"context_help"></=
property>
                                         <property name=3D"enabled">1</prop=
erty>
                                         <property name=3D"fg"></property>
                                         <property name=3D"font"></property>
@@ -344,8 +685,36 @@
                                         <property name=3D"size"></property>
                                         <property name=3D"subclass"></prop=
erty>
                                         <property name=3D"tooltip"></prope=
rty>
+                                        <property name=3D"validator_data_t=
ype"></property>
+                                        <property name=3D"validator_style"=
>wxFILTER_NONE</property>
+                                        <property name=3D"validator_type">=
wxDefaultValidator</property>
+                                        <property name=3D"validator_variab=
le"></property>
                                         <property name=3D"window_extra_sty=
le"></property>
+                                        <property name=3D"window_name"></p=
roperty>
                                         <property name=3D"window_style"></=
property>
+                                        <event name=3D"OnChar"></event>
+                                        <event name=3D"OnEnterWindow"></ev=
ent>
+                                        <event name=3D"OnEraseBackground">=
</event>
+                                        <event name=3D"OnKeyDown"></event>
+                                        <event name=3D"OnKeyUp"></event>
+                                        <event name=3D"OnKillFocus"></even=
t>
+                                        <event name=3D"OnLeaveWindow"></ev=
ent>
+                                        <event name=3D"OnLeftDClick"></eve=
nt>
+                                        <event name=3D"OnLeftDown"></event>
+                                        <event name=3D"OnLeftUp"></event>
+                                        <event name=3D"OnMiddleDClick"></e=
vent>
+                                        <event name=3D"OnMiddleDown"></eve=
nt>
+                                        <event name=3D"OnMiddleUp"></event>
+                                        <event name=3D"OnMotion"></event>
+                                        <event name=3D"OnMouseEvents"></ev=
ent>
+                                        <event name=3D"OnMouseWheel"></eve=
nt>
+                                        <event name=3D"OnPaint"></event>
+                                        <event name=3D"OnRightDClick"></ev=
ent>
+                                        <event name=3D"OnRightDown"></even=
t>
+                                        <event name=3D"OnRightUp"></event>
+                                        <event name=3D"OnSetFocus"></event>
+                                        <event name=3D"OnSize"></event>
+                                        <event name=3D"OnUpdateUI"></event>
                                     </object>
                                 </object>
                                 <object class=3D"sizeritem" expanded=3D"1">
@@ -354,7 +723,8 @@
                                     <property name=3D"proportion">0</prope=
rty>
                                     <object class=3D"wxStaticBitmap" expan=
ded=3D"1">
                                         <property name=3D"bg"></property>
-                                        <property name=3D"bitmap">res/scre=
enshot2.bmp; Load From File</property>
+                                        <property name=3D"bitmap">BITMAP_S=
CREENSHOT2; Load From Resource</property>
+                                        <property name=3D"context_help"></=
property>
                                         <property name=3D"enabled">1</prop=
erty>
                                         <property name=3D"fg"></property>
                                         <property name=3D"font"></property>
@@ -368,8 +738,36 @@
                                         <property name=3D"size"></property>
                                         <property name=3D"subclass"></prop=
erty>
                                         <property name=3D"tooltip"></prope=
rty>
+                                        <property name=3D"validator_data_t=
ype"></property>
+                                        <property name=3D"validator_style"=
>wxFILTER_NONE</property>
+                                        <property name=3D"validator_type">=
wxDefaultValidator</property>
+                                        <property name=3D"validator_variab=
le"></property>
                                         <property name=3D"window_extra_sty=
le"></property>
+                                        <property name=3D"window_name"></p=
roperty>
                                         <property name=3D"window_style"></=
property>
+                                        <event name=3D"OnChar"></event>
+                                        <event name=3D"OnEnterWindow"></ev=
ent>
+                                        <event name=3D"OnEraseBackground">=
</event>
+                                        <event name=3D"OnKeyDown"></event>
+                                        <event name=3D"OnKeyUp"></event>
+                                        <event name=3D"OnKillFocus"></even=
t>
+                                        <event name=3D"OnLeaveWindow"></ev=
ent>
+                                        <event name=3D"OnLeftDClick"></eve=
nt>
+                                        <event name=3D"OnLeftDown"></event>
+                                        <event name=3D"OnLeftUp"></event>
+                                        <event name=3D"OnMiddleDClick"></e=
vent>
+                                        <event name=3D"OnMiddleDown"></eve=
nt>
+                                        <event name=3D"OnMiddleUp"></event>
+                                        <event name=3D"OnMotion"></event>
+                                        <event name=3D"OnMouseEvents"></ev=
ent>
+                                        <event name=3D"OnMouseWheel"></eve=
nt>
+                                        <event name=3D"OnPaint"></event>
+                                        <event name=3D"OnRightDClick"></ev=
ent>
+                                        <event name=3D"OnRightDown"></even=
t>
+                                        <event name=3D"OnRightUp"></event>
+                                        <event name=3D"OnSetFocus"></event>
+                                        <event name=3D"OnSize"></event>
+                                        <event name=3D"OnUpdateUI"></event>
                                     </object>
                                 </object>
                                 <object class=3D"sizeritem" expanded=3D"1">
@@ -378,7 +776,8 @@
                                     <property name=3D"proportion">0</prope=
rty>
                                     <object class=3D"wxStaticBitmap" expan=
ded=3D"1">
                                         <property name=3D"bg"></property>
-                                        <property name=3D"bitmap">res/scre=
enshot3.bmp; Load From File</property>
+                                        <property name=3D"bitmap">BITMAP_S=
CREENSHOT3; Load From Resource</property>
+                                        <property name=3D"context_help"></=
property>
                                         <property name=3D"enabled">1</prop=
erty>
                                         <property name=3D"fg"></property>
                                         <property name=3D"font"></property>
@@ -392,8 +791,36 @@
                                         <property name=3D"size"></property>
                                         <property name=3D"subclass"></prop=
erty>
                                         <property name=3D"tooltip"></prope=
rty>
+                                        <property name=3D"validator_data_t=
ype"></property>
+                                        <property name=3D"validator_style"=
>wxFILTER_NONE</property>
+                                        <property name=3D"validator_type">=
wxDefaultValidator</property>
+                                        <property name=3D"validator_variab=
le"></property>
                                         <property name=3D"window_extra_sty=
le"></property>
+                                        <property name=3D"window_name"></p=
roperty>
                                         <property name=3D"window_style"></=
property>
+                                        <event name=3D"OnChar"></event>
+                                        <event name=3D"OnEnterWindow"></ev=
ent>
+                                        <event name=3D"OnEraseBackground">=
</event>
+                                        <event name=3D"OnKeyDown"></event>
+                                        <event name=3D"OnKeyUp"></event>
+                                        <event name=3D"OnKillFocus"></even=
t>
+                                        <event name=3D"OnLeaveWindow"></ev=
ent>
+                                        <event name=3D"OnLeftDClick"></eve=
nt>
+                                        <event name=3D"OnLeftDown"></event>
+                                        <event name=3D"OnLeftUp"></event>
+                                        <event name=3D"OnMiddleDClick"></e=
vent>
+                                        <event name=3D"OnMiddleDown"></eve=
nt>
+                                        <event name=3D"OnMiddleUp"></event>
+                                        <event name=3D"OnMotion"></event>
+                                        <event name=3D"OnMouseEvents"></ev=
ent>
+                                        <event name=3D"OnMouseWheel"></eve=
nt>
+                                        <event name=3D"OnPaint"></event>
+                                        <event name=3D"OnRightDClick"></ev=
ent>
+                                        <event name=3D"OnRightDown"></even=
t>
+                                        <event name=3D"OnRightUp"></event>
+                                        <event name=3D"OnSetFocus"></event>
+                                        <event name=3D"OnSize"></event>
+                                        <event name=3D"OnUpdateUI"></event>
                                     </object>
                                 </object>
                             </object>
@@ -404,6 +831,7 @@
                             <property name=3D"proportion">0</property>
                             <object class=3D"wxStaticLine" expanded=3D"1">
                                 <property name=3D"bg"></property>
+                                <property name=3D"context_help"></property>
                                 <property name=3D"enabled">1</property>
                                 <property name=3D"fg"></property>
                                 <property name=3D"font"></property>
@@ -418,8 +846,36 @@
                                 <property name=3D"style">wxLI_HORIZONTAL</=
property>
                                 <property name=3D"subclass"></property>
                                 <property name=3D"tooltip"></property>
+                                <property name=3D"validator_data_type"></p=
roperty>
+                                <property name=3D"validator_style">wxFILTE=
R_NONE</property>
+                                <property name=3D"validator_type">wxDefaul=
tValidator</property>
+                                <property name=3D"validator_variable"></pr=
operty>
                                 <property name=3D"window_extra_style"></pr=
operty>
+                                <property name=3D"window_name"></property>
                                 <property name=3D"window_style"></property>
+                                <event name=3D"OnChar"></event>
+                                <event name=3D"OnEnterWindow"></event>
+                                <event name=3D"OnEraseBackground"></event>
+                                <event name=3D"OnKeyDown"></event>
+                                <event name=3D"OnKeyUp"></event>
+                                <event name=3D"OnKillFocus"></event>
+                                <event name=3D"OnLeaveWindow"></event>
+                                <event name=3D"OnLeftDClick"></event>
+                                <event name=3D"OnLeftDown"></event>
+                                <event name=3D"OnLeftUp"></event>
+                                <event name=3D"OnMiddleDClick"></event>
+                                <event name=3D"OnMiddleDown"></event>
+                                <event name=3D"OnMiddleUp"></event>
+                                <event name=3D"OnMotion"></event>
+                                <event name=3D"OnMouseEvents"></event>
+                                <event name=3D"OnMouseWheel"></event>
+                                <event name=3D"OnPaint"></event>
+                                <event name=3D"OnRightDClick"></event>
+                                <event name=3D"OnRightDown"></event>
+                                <event name=3D"OnRightUp"></event>
+                                <event name=3D"OnSetFocus"></event>
+                                <event name=3D"OnSize"></event>
+                                <event name=3D"OnUpdateUI"></event>
                             </object>
                         </object>
                         <object class=3D"sizeritem" expanded=3D"1">
@@ -428,6 +884,7 @@
                             <property name=3D"proportion">1</property>
                             <object class=3D"wxTextCtrl" expanded=3D"1">
                                 <property name=3D"bg">255,255,255</propert=
y>
+                                <property name=3D"context_help"></property>
                                 <property name=3D"enabled">0</property>
                                 <property name=3D"fg">0,0,0</property>
                                 <property name=3D"font">Arial,90,90,8</pro=
perty>
@@ -443,13 +900,41 @@
                                 <property name=3D"style">wxTE_MULTILINE</p=
roperty>
                                 <property name=3D"subclass"></property>
                                 <property name=3D"tooltip"></property>
+                                <property name=3D"validator_data_type"></p=
roperty>
+                                <property name=3D"validator_style">wxFILTE=
R_NONE</property>
+                                <property name=3D"validator_type">wxDefaul=
tValidator</property>
+                                <property name=3D"validator_variable"></pr=
operty>
                                 <property name=3D"value">Click update to g=
et the new version!&#x0A;</property>
                                 <property name=3D"window_extra_style"></pr=
operty>
+                                <property name=3D"window_name"></property>
                                 <property name=3D"window_style">wxSIMPLE_B=
ORDER|wxSTATIC_BORDER</property>
+                                <event name=3D"OnChar"></event>
+                                <event name=3D"OnEnterWindow"></event>
+                                <event name=3D"OnEraseBackground"></event>
+                                <event name=3D"OnKeyDown"></event>
+                                <event name=3D"OnKeyUp"></event>
+                                <event name=3D"OnKillFocus"></event>
+                                <event name=3D"OnLeaveWindow"></event>
+                                <event name=3D"OnLeftDClick"></event>
+                                <event name=3D"OnLeftDown"></event>
+                                <event name=3D"OnLeftUp"></event>
+                                <event name=3D"OnMiddleDClick"></event>
+                                <event name=3D"OnMiddleDown"></event>
+                                <event name=3D"OnMiddleUp"></event>
+                                <event name=3D"OnMotion"></event>
+                                <event name=3D"OnMouseEvents"></event>
+                                <event name=3D"OnMouseWheel"></event>
+                                <event name=3D"OnPaint"></event>
+                                <event name=3D"OnRightDClick"></event>
+                                <event name=3D"OnRightDown"></event>
+                                <event name=3D"OnRightUp"></event>
+                                <event name=3D"OnSetFocus"></event>
+                                <event name=3D"OnSize"></event>
                                 <event name=3D"OnText"></event>
                                 <event name=3D"OnTextEnter"></event>
                                 <event name=3D"OnTextMaxLen"></event>
                                 <event name=3D"OnTextURL"></event>
+                                <event name=3D"OnUpdateUI"></event>
                             </object>
                         </object>
                         <object class=3D"sizeritem" expanded=3D"1">
@@ -458,6 +943,7 @@
                             <property name=3D"proportion">0</property>
                             <object class=3D"wxStaticLine" expanded=3D"1">
                                 <property name=3D"bg"></property>
+                                <property name=3D"context_help"></property>
                                 <property name=3D"enabled">1</property>
                                 <property name=3D"fg"></property>
                                 <property name=3D"font"></property>
@@ -472,8 +958,36 @@
                                 <property name=3D"style">wxLI_HORIZONTAL</=
property>
                                 <property name=3D"subclass"></property>
                                 <property name=3D"tooltip"></property>
+                                <property name=3D"validator_data_type"></p=
roperty>
+                                <property name=3D"validator_style">wxFILTE=
R_NONE</property>
+                                <property name=3D"validator_type">wxDefaul=
tValidator</property>
+                                <property name=3D"validator_variable"></pr=
operty>
                                 <property name=3D"window_extra_style"></pr=
operty>
+                                <property name=3D"window_name"></property>
                                 <property name=3D"window_style"></property>
+                                <event name=3D"OnChar"></event>
+                                <event name=3D"OnEnterWindow"></event>
+                                <event name=3D"OnEraseBackground"></event>
+                                <event name=3D"OnKeyDown"></event>
+                                <event name=3D"OnKeyUp"></event>
+                                <event name=3D"OnKillFocus"></event>
+                                <event name=3D"OnLeaveWindow"></event>
+                                <event name=3D"OnLeftDClick"></event>
+                                <event name=3D"OnLeftDown"></event>
+                                <event name=3D"OnLeftUp"></event>
+                                <event name=3D"OnMiddleDClick"></event>
+                                <event name=3D"OnMiddleDown"></event>
+                                <event name=3D"OnMiddleUp"></event>
+                                <event name=3D"OnMotion"></event>
+                                <event name=3D"OnMouseEvents"></event>
+                                <event name=3D"OnMouseWheel"></event>
+                                <event name=3D"OnPaint"></event>
+                                <event name=3D"OnRightDClick"></event>
+                                <event name=3D"OnRightDown"></event>
+                                <event name=3D"OnRightUp"></event>
+                                <event name=3D"OnSetFocus"></event>
+                                <event name=3D"OnSize"></event>
+                                <event name=3D"OnUpdateUI"></event>
                             </object>
                         </object>
                         <object class=3D"sizeritem" expanded=3D"1">
@@ -482,6 +996,8 @@
                             <property name=3D"proportion">0</property>
                             <object class=3D"wxButton" expanded=3D"1">
                                 <property name=3D"bg"></property>
+                                <property name=3D"context_help"></property>
+                                <property name=3D"default">0</property>
                                 <property name=3D"enabled">1</property>
                                 <property name=3D"fg"></property>
                                 <property name=3D"font"></property>
@@ -497,9 +1013,37 @@
                                 <property name=3D"style"></property>
                                 <property name=3D"subclass"></property>
                                 <property name=3D"tooltip"></property>
+                                <property name=3D"validator_data_type"></p=
roperty>
+                                <property name=3D"validator_style">wxFILTE=
R_NONE</property>
+                                <property name=3D"validator_type">wxDefaul=
tValidator</property>
+                                <property name=3D"validator_variable"></pr=
operty>
                                 <property name=3D"window_extra_style"></pr=
operty>
+                                <property name=3D"window_name"></property>
                                 <property name=3D"window_style"></property>
                                 <event name=3D"OnButtonClick">startGame</e=
vent>
+                                <event name=3D"OnChar"></event>
+                                <event name=3D"OnEnterWindow"></event>
+                                <event name=3D"OnEraseBackground"></event>
+                                <event name=3D"OnKeyDown"></event>
+                                <event name=3D"OnKeyUp"></event>
+                                <event name=3D"OnKillFocus"></event>
+                                <event name=3D"OnLeaveWindow"></event>
+                                <event name=3D"OnLeftDClick"></event>
+                                <event name=3D"OnLeftDown"></event>
+                                <event name=3D"OnLeftUp"></event>
+                                <event name=3D"OnMiddleDClick"></event>
+                                <event name=3D"OnMiddleDown"></event>
+                                <event name=3D"OnMiddleUp"></event>
+                                <event name=3D"OnMotion"></event>
+                                <event name=3D"OnMouseEvents"></event>
+                                <event name=3D"OnMouseWheel"></event>
+                                <event name=3D"OnPaint"></event>
+                                <event name=3D"OnRightDClick"></event>
+                                <event name=3D"OnRightDown"></event>
+                                <event name=3D"OnRightUp"></event>
+                                <event name=3D"OnSetFocus"></event>
+                                <event name=3D"OnSize"></event>
+                                <event name=3D"OnUpdateUI"></event>
                             </object>
                         </object>
                     </object>

Modified: tools/updater/updater_vs9.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/updater/updater_vs9.vcproj (original)
+++ tools/updater/updater_vs9.vcproj Sun Nov 29 01:48:35 2009
@@ -118,9 +118,10 @@
 			/>
 			<Tool
 				Name=3D"VCCLCompilerTool"
-				AdditionalIncludeDirectories=3D"./;&quot;svn-win32-1.4.3\include&quot;=
;&quot;svn-win32-1.4.3\include\apr&quot;;&quot;svn-win32-1.4.3\include\apr-=
util&quot;;&quot;wxMSW-2.8.3\include\&quot;;&quot;wxMSW-2.8.3\include\msvc\=
&quot;"
+				AdditionalIncludeDirectories=3D"./;&quot;svn-win32-1.6.6\include&quot;=
;&quot;svn-win32-1.6.6\include\apr&quot;;&quot;svn-win32-1.6.6\include\apr-=
util&quot;;C:\wxWidgets2.8\include;C:\wxWidgets2.8\include\msvc"
 				PreprocessorDefinitions=3D"NDEBUG;WIN32;_WINDOWS;__WINDOWS__;__WXMSW__=
;__WIN95__;__WIN32__;WINVER=3D0x0400;STRICT"
 				RuntimeLibrary=3D"0"
+				BufferSecurityCheck=3D"false"
 				UsePrecompiledHeader=3D"0"
 				WarningLevel=3D"3"
 				Detect64BitPortabilityProblems=3D"false"
@@ -131,7 +132,7 @@
 			/>
 			<Tool
 				Name=3D"VCResourceCompilerTool"
-				AdditionalIncludeDirectories=3D"&quot;wxMSW-2.8.3\include\&quot;"
+				AdditionalIncludeDirectories=3D"&quot;C:\wxWidgets2.8\include\&quot;"
 			/>
 			<Tool
 				Name=3D"VCPreLinkEventTool"
@@ -141,9 +142,9 @@
 				AdditionalDependencies=3D"kernel32.lib user32.lib gdi32.lib winspool.l=
ib comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib uuid.lib co=
mctl32.lib rpcrt4.lib wsock32.lib winmm.lib wxbase28.lib wxmsw28_core.lib w=
xpng.lib wxzlib.lib wxjpeg.lib wxtiff.lib wxmsw28_html.lib wxbase28_net.lib=
 wxmsw28_media.lib"
 				OutputFile=3D"$(SolutionDir)\$(ProjectName).exe"
 				LinkIncremental=3D"1"
-				AdditionalLibraryDirectories=3D"&quot;wxMSW-2.8.3\lib\vc_lib\&quot;;&q=
uot;svn-win32-1.4.3\lib\apr\&quot;;&quot;svn-win32-1.4.3\lib\apr-util\&quot=
;;&quot;svn-win32-1.4.3\lib\&quot;;&quot;svn-win32-libintl\lib\&quot;;&quot=
;db4-win32-4.4.20\lib\&quot;;&quot;svn-win32-1.4.3\lib\neon\&quot;"
+				AdditionalLibraryDirectories=3D"C:\wxWidgets2.8\lib\vc_lib\;&quot;svn-=
win32-1.6.6\lib\apr\&quot;;&quot;svn-win32-1.6.6\lib\apr-util\&quot;;&quot;=
svn-win32-1.6.6\lib\&quot;;&quot;svn-win32-libintl\lib\&quot;;&quot;db4-win=
32-4.4.20\lib\&quot;;&quot;svn-win32-1.6.6\lib\neon\&quot;"
 				IgnoreAllDefaultLibraries=3D"false"
-				IgnoreDefaultLibraryNames=3D"LIBCMT.lib"
+				IgnoreDefaultLibraryNames=3D""
 				GenerateDebugInformation=3D"false"
 				SubSystem=3D"2"
 				OptimizeReferences=3D"2"



From no-reply at zwischenwelt.org  Sun Nov 29 02:25:27 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 29 Nov 2009 01:25:27 -0000
Subject: [Iris-commit] [IRIS] r3176 - in /tools/updater/deps: ./
 apr-1.3.9-win32-src.zip db-4.4.20-win32.zip svn-win32-1.6.6_dev.zip
 svn-win32-libintl.zip
Message-ID: <20091129012527.AD0FE7A98167@simon>

Author: hagish
Date: Sun Nov 29 02:25:27 2009
New Revision: 3176

Log:
windows deps added

Added:
    tools/updater/deps/
    tools/updater/deps/apr-1.3.9-win32-src.zip   (with props)
    tools/updater/deps/db-4.4.20-win32.zip   (with props)
    tools/updater/deps/svn-win32-1.6.6_dev.zip   (with props)
    tools/updater/deps/svn-win32-libintl.zip   (with props)



From no-reply at zwischenwelt.org  Mon Nov 30 00:50:45 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 29 Nov 2009 23:50:45 -0000
Subject: [Iris-commit] [IRIS] r3177 - /trunk/bin/updater.exe
Message-ID: <20091129235046.6AA747A9813A@simon>

Author: sience
Date: Mon Nov 30 00:50:38 2009
New Revision: 3177

Log:
-new updater but using old dependencies for now

Modified:
    trunk/bin/updater.exe

Modified: trunk/bin/updater.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Mon Nov 30 01:04:44 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 30 Nov 2009 00:04:44 -0000
Subject: [Iris-commit] [IRIS] r3178 - /trunk/bin/iris2.exe
Message-ID: <20091130000444.599867A9813A@simon>

Author: sience
Date: Mon Nov 30 01:04:44 2009
New Revision: 3178

Log:
-new win32 binary

Modified:
    trunk/bin/iris2.exe

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



