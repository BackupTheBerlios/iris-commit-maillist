<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r2346 - in /trunk: lua/gui/gui.gumpparser.lua lua/lib.2d.map.lua lua/lib.gump.samples.lua lua/lib.mapblock.base.lua widgets/widget.uoedittext.lua widgets/widget.uotext.lua
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2008-August/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r2346%20-%20in%20/trunk%3A%20lua/gui/gui.gumpparser.lua%0A%20lua/lib.2d.map.lua%20lua/lib.gump.samples.lua%20lua/lib.mapblock.base.lua%0A%20widgets/widget.uoedittext.lua%20widgets/widget.uotext.lua&In-Reply-To=%3C20080804131033.355B61C185D8%40zwischenwelt.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001153.html">
   <LINK REL="Next"  HREF="001155.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r2346 - in /trunk: lua/gui/gui.gumpparser.lua lua/lib.2d.map.lua lua/lib.gump.samples.lua lua/lib.mapblock.base.lua widgets/widget.uoedittext.lua widgets/widget.uotext.lua</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r2346%20-%20in%20/trunk%3A%20lua/gui/gui.gumpparser.lua%0A%20lua/lib.2d.map.lua%20lua/lib.gump.samples.lua%20lua/lib.mapblock.base.lua%0A%20widgets/widget.uoedittext.lua%20widgets/widget.uotext.lua&In-Reply-To=%3C20080804131033.355B61C185D8%40zwischenwelt.org%3E"
       TITLE="[Iris-commit] [IRIS] r2346 - in /trunk: lua/gui/gui.gumpparser.lua lua/lib.2d.map.lua lua/lib.gump.samples.lua lua/lib.mapblock.base.lua widgets/widget.uoedittext.lua widgets/widget.uotext.lua">no-reply at zwischenwelt.org
       </A><BR>
    <I>Mon Aug  4 15:10:33 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001153.html">[Iris-commit] [IRIS] r2345 - in /trunk/lua: lib.mapblock.2d.statics.lua lib.mapblock.2d.terrain.lua lib.mapblock.base.lua lib.mapblock.spawner.lua
</A></li>
        <LI>Next message: <A HREF="001155.html">[Iris-commit] [IRIS] r2347 - in /trunk/widgets:	widget.uoedittext.lua widget.uotext.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1154">[ date ]</a>
              <a href="thread.html#1154">[ thread ]</a>
              <a href="subject.html#1154">[ subject ]</a>
              <a href="author.html#1154">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ghoulsblade
Date: Mon Aug  4 15:10:32 2008
New Revision: 2346

Log:
serverside gumps : fixed edittext

Modified:
    trunk/lua/gui/gui.gumpparser.lua
    trunk/lua/lib.2d.map.lua
    trunk/lua/lib.gump.samples.lua
    trunk/lua/lib.mapblock.base.lua
    trunk/widgets/widget.uoedittext.lua
    trunk/widgets/widget.uotext.lua

Modified: trunk/lua/gui/gui.gumpparser.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.gumpparser.lua (original)
+++ trunk/lua/gui/gui.gumpparser.lua Mon Aug  4 15:10:32 2008
@@ -71,7 +71,7 @@
 		HealthBarSetWarMode()
 	end
 	=

-	local testgump,x,y,kDebugName =3D kGumpSample_VM_ChatMenu,0,300,&quot;kGumpSam=
ple_RuneBook2&quot;
+	local testgump,x,y,kDebugName =3D kGumpSample_PM,0,300,&quot;bla&quot;
 	local d2 =3D GumpParser_New(testgump,false) -- d2:SetPos(x,y) d2.sDebugNa=
me =3D kDebugName
 	=

 	--~ local dialog =3D GumpParser_New(kClientSideGump_Paperdoll_Own,true) d=
ialog:SetLeftTop(400,100)

Modified: trunk/lua/lib.2d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.2d.map.lua (original)
+++ trunk/lua/lib.2d.map.lua Mon Aug  4 15:10:32 2008
@@ -10,7 +10,7 @@
 --~ local bWeHaveSpareTime =3D gSecondsSinceLastFrame*1000 &lt; Renderer2D.kG=
oodTicksBetweenFrames
 =

 kMapLoad_2D_Terrain_Rough		=3D {prio=3D0}
-kMapLoad_2D_Water_Rough			=3D {prio=3D1} -- similar to rough water, just o=
ne poly per block
+kMapLoad_2D_Water_Rough			=3D {prio=3D1} -- similar to rough terrain, just=
 one poly per block
 kMapLoad_2D_Statics_Rough		=3D {prio=3D2}
 kMapLoad_2D_Multis_Rough		=3D {prio=3D3}
 kMapLoad_2D_Terrain_Detail		=3D {prio=3D4}

Modified: trunk/lua/lib.gump.samples.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gump.samples.lua (original)
+++ trunk/lua/lib.gump.samples.lua Mon Aug  4 15:10:32 2008
@@ -1,4 +1,22 @@
 -- a few recorded example gumps for testing
+
+
+
+kGumpSample_PM =3D {
+	Data=3D&quot;{ resizepic 0 0 5120 300 255 }{ htmlgump 0 10 300 21 0 0 0 }{ gum=
ppic 30 12 57 }{ gumppic 240 12 59 }{ gumppictiled 30 30 240 21 3004 }{ tex=
tentry 30 30 240 21 1152 7442 1 }{ gumppictiled 20 60 260 150 3004 }{ texte=
ntry 20 60 260 150 1152 13108 1 }{ button 50 225 9704 9705 1 0 13956 }{ gum=
ppic 140 225 9026 hue=3D1152 }{ button 144 229 10006 10006 1 0 10659 }{ htm=
lgump 215 225 50 21 2 0 0 }{ button 200 228 10006 10006 1 0 14175 }{ page 0=
 }{ gumppic 300 255 10460 hue=3D903 }{ button 310 259 2362 2362 1 0 7310 }{=
 button 310 270 2360 2360 1 0 19710 }{ button 295 257 9766 9767 1 0 145 }{ =
button 319 257 9762 9763 1 0 5685 }{ button 295 268 9766 9767 1 0 10529 }{ =
button 319 268 9762 9763 1 0 13966 }&quot;,
+
+
+	textline=3D{
+	[1]=3D&quot;&quot;,
+	[2]=3D&quot;&lt;BASEFONT COLOR=3D#FFFFFF&gt;&lt;BASEFONT COLOR=3D#FFFFFF&gt;Send&quot;,
+	[0]=3D&quot;&lt;BASEFONT COLOR=3D#FFFFFF&gt;&lt;BASEFONT COLOR=3D#FFFFFF&gt;&lt;CENTER&gt;Messag=
e to Hagish&quot;,
+	},
+	textline_unicode=3D{
+	[1]=3D{},
+	[2]=3D{60,66,65,83,69,70,79,78,84,32,67,79,76,79,82,61,35,70,70,70,70,70,=
70,62,60,66,65,83,69,70,79,78,84,32,67,79,76,79,82,61,35,70,70,70,70,70,70,=
62,83,101,110,100,},
+	[0]=3D{60,66,65,83,69,70,79,78,84,32,67,79,76,79,82,61,35,70,70,70,70,70,=
70,62,60,66,65,83,69,70,79,78,84,32,67,79,76,79,82,61,35,70,70,70,70,70,70,=
62,60,67,69,78,84,69,82,62,77,101,115,115,97,103,101,32,116,111,32,72,97,10=
3,105,115,104,},
+	},
+}
 =

 =

 	=


Modified: trunk/lua/lib.mapblock.base.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mapblock.base.lua (original)
+++ trunk/lua/lib.mapblock.base.lua Mon Aug  4 15:10:32 2008
@@ -67,8 +67,20 @@
 -- a single step during the thread
 function cMapBlock:WorkStep ()
 	if (self.lod_finished =3D=3D self.lod) then return end -- nothing to do
-	if (self.lod =3D=3D self.kLOD_Rough ) then self:WorkStep_LoadRough()  sel=
f:ClearDetail() self.lod_finished =3D self.lod return end
-	if (self.lod =3D=3D self.kLOD_Detail) then self:WorkStep_LoadDetail() sel=
f:ClearRough() self.lod_finished =3D self.lod return end
+	if (self.lod =3D=3D self.kLOD_Rough ) then =

+		self:WorkStep_LoadRough()  =

+		self:ClearDetail() =

+		self.lod_finished =3D self.lod =

+		self:SetPriority(kSchedulerIdlePriority)
+		return =

+	end
+	if (self.lod =3D=3D self.kLOD_Detail) then =

+		self:WorkStep_LoadDetail() =

+		self:ClearRough() =

+		self.lod_finished =3D self.lod =

+		self:SetPriority(kSchedulerIdlePriority)
+		return =

+	end
 end
 =

 function cMapBlock:ClearRough   () end -- override me !

Modified: trunk/widgets/widget.uoedittext.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/widgets/widget.uoedittext.lua (original)
+++ trunk/widgets/widget.uoedittext.lua Mon Aug  4 15:10:32 2008
@@ -18,25 +18,21 @@
 	=

 	local p =3D params
 	self.textwidget =3D self:CreateChild(&quot;UOText&quot;,{x=3D0,y=3D0,width=3Dp.widt=
h,height=3Dp.height,textline_id=3Dp.textline_id_default,hue=3Dp.hue},textli=
nes)
+	--~ self.textwidget:SetUOHtml(&quot;blabla&quot;)
 	self:SetText(self.textwidget:GetUOHtml())
 	self:UpdateTextDisplay()
+	self:SetSize(p.width,p.height)
+	self:SetPos(p.x,p.y)
 end
 =

 function gWidgetPrototype.UOEditText:GetReturnVal	() return self.params.re=
turn_value end
 =

 function gWidgetPrototype.UOEditText:GetPlainText ()
-	if (type(self.text) =3D=3D &quot;table&quot;) then
-		local plaintext =3D &quot;&quot;
-		for k,unicode_charcode in ipairs(self.text) do =

-			plaintext =3D plaintext .. string.format(&quot;%c&quot;,unicode_charcode) -- non-=
asci specifics are lost
-		end
-		return plaintext
-	end
-	return self.text
+	return (type(self.text) =3D=3D &quot;table&quot;) and UnicodeToPlainText_KeepLength=
(self.text) or self.text
 end
 =

 function gWidgetPrototype.UOEditText:GetText ()		return self.text end -- w=
arning ! might be an array of unicode charcodes (usually)
-function gWidgetPrototype.UOEditText:SetText (text)	self.text =3D text sel=
f:UpdateTextDisplay() end
+function gWidgetPrototype.UOEditText:SetText (text) self.text =3D text sel=
f:UpdateTextDisplay() end
 =

 function gWidgetPrototype.UOEditText:UpdateTextDisplay () self.textwidget:=
SetUOHtml(self.text) end
 =

@@ -53,8 +49,10 @@
 end
 =

 function gWidgetPrototype.UOEditText:AppendChar			(char) =

+	--~ print(&quot;UOEditText:AppendChar&quot;,type(self.text) =3D=3D &quot;table&quot;,char)
 	if (type(self.text) =3D=3D &quot;table&quot;) then
-		table.insert(self.text,string.byte(char,1))
+		local c =3D string.byte(char,1)
+		if (c) then table.insert(self.text,c) end
 	else
 		self.text =3D self.text .. char
 	end

Modified: trunk/widgets/widget.uotext.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/widgets/widget.uotext.lua (original)
+++ trunk/widgets/widget.uotext.lua Mon Aug  4 15:10:32 2008
@@ -42,6 +42,8 @@
 -- see also HtmlParser in lib.gumpparser.lua
 function gWidgetPrototype.UOText:GetUOHtml () return self.uohtml end
 function gWidgetPrototype.UOText:SetUOHtml (uohtml,bParseHTML)
+	local bIsUniCode =3D type(uohtml) =3D=3D &quot;table&quot;
+	if (bIsUniCode) then uohtml =3D CopyArray(uohtml) end
 	self.uohtml =3D uohtml
 	local fontsize =3D nil
 	local fontid =3D 1
@@ -52,7 +54,6 @@
 	if (self.params.hue) then local r,g,b =3D gHueLoader:GetColor(self.params=
.hue,31) col =3D {r=3Dr,g=3Dg,b=3Db} end
 	=

 	local glyphlist =3D self.glyphlist
-	local bIsUniCode =3D type(uohtml) =3D=3D &quot;table&quot;
 	local plaintext =3D bIsUniCode and UnicodeToPlainText_KeepLength(uohtml) =
or uohtml
 	=

 	glyphlist:Clear()
@@ -112,6 +113,7 @@
 		end
 	end
 	self:UpdateGeometry()
+	self:SetPos(self:GetPos())
 end
 --[[
 -- vetus-mundus changelog : big text =3D htmlgump.. todo : clip


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001153.html">[Iris-commit] [IRIS] r2345 - in /trunk/lua: lib.mapblock.2d.statics.lua lib.mapblock.2d.terrain.lua lib.mapblock.base.lua lib.mapblock.spawner.lua
</A></li>
	<LI>Next message: <A HREF="001155.html">[Iris-commit] [IRIS] r2347 - in /trunk/widgets:	widget.uoedittext.lua widget.uotext.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1154">[ date ]</a>
              <a href="thread.html#1154">[ thread ]</a>
              <a href="subject.html#1154">[ subject ]</a>
              <a href="author.html#1154">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
