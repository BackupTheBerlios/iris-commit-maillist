<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r2750 - in /trunk: lua/lib.namegumps.lua lua/lib.spellbooks.lua lua/lib.uoids.lua lua/widgets/widget.uopaperdollitem.lua plugins/itemcounter.lua plugins/lib.spellbar.lua
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2008-November/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r2750%20-%20in%20/trunk%3A%20lua/lib.namegumps.lua%0A%20lua/lib.spellbooks.lua%20lua/lib.uoids.lua%0A%20lua/widgets/widget.uopaperdollitem.lua%20plugins/itemcounter.lua%0A%20plugins/lib.spellbar.lua&In-Reply-To=%3C20081124200217.A95431C187E4%40zwischenwelt.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001553.html">
   <LINK REL="Next"  HREF="001555.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r2750 - in /trunk: lua/lib.namegumps.lua lua/lib.spellbooks.lua lua/lib.uoids.lua lua/widgets/widget.uopaperdollitem.lua plugins/itemcounter.lua plugins/lib.spellbar.lua</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r2750%20-%20in%20/trunk%3A%20lua/lib.namegumps.lua%0A%20lua/lib.spellbooks.lua%20lua/lib.uoids.lua%0A%20lua/widgets/widget.uopaperdollitem.lua%20plugins/itemcounter.lua%0A%20plugins/lib.spellbar.lua&In-Reply-To=%3C20081124200217.A95431C187E4%40zwischenwelt.org%3E"
       TITLE="[Iris-commit] [IRIS] r2750 - in /trunk: lua/lib.namegumps.lua lua/lib.spellbooks.lua lua/lib.uoids.lua lua/widgets/widget.uopaperdollitem.lua plugins/itemcounter.lua plugins/lib.spellbar.lua">no-reply at zwischenwelt.org
       </A><BR>
    <I>Mon Nov 24 21:02:17 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001553.html">[Iris-commit] [IRIS] r2749 - in /trunk: lua/gui/gui.healthbar.lua lua/lib.macrolist.lua lua/lib.mousepick.lua lua/lib.namegumps.lua lua/lib.uotooltip.lua lua/main.lua lua/widgets/widget.uotooltip.lua plugins/itemcounter.lua plugins/moblist.lua
</A></li>
        <LI>Next message: <A HREF="001555.html">[Iris-commit] [IRIS] r2751 - in /trunk: lua/lib.uodragdrop.lua	plugins/itemcounter.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1554">[ date ]</a>
              <a href="thread.html#1554">[ thread ]</a>
              <a href="subject.html#1554">[ subject ]</a>
              <a href="author.html#1554">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ghoulsblade
Date: Mon Nov 24 21:02:16 2008
New Revision: 2750

Log:
spellbar interrupt detection improved, namegump:uohtml parsing activated (c=
olored:game master in tooltip), paperdoll gump fallback to cloak (arcane cl=
oak gfx was broken and unclickable)

Modified:
    trunk/lua/lib.namegumps.lua
    trunk/lua/lib.spellbooks.lua
    trunk/lua/lib.uoids.lua
    trunk/lua/widgets/widget.uopaperdollitem.lua
    trunk/plugins/itemcounter.lua
    trunk/plugins/lib.spellbar.lua

Modified: trunk/lua/lib.namegumps.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.namegumps.lua (original)
+++ trunk/lua/lib.namegumps.lua Mon Nov 24 21:02:16 2008
@@ -71,7 +71,7 @@
 	=

 	--~ local txt =3D self:CreateChild(&quot;UOHuePickerButton&quot;,{x=3Dx*10,y=3Dy*10=
,hue=3Dhue,gfxparam_init=3Dgfxparam_init})
 	=

-	self.maintext =3D self:CreateChild(&quot;UOText&quot;,{x=3D0,y=3D0,text=3Dplaintext=
,col=3D{r=3D0,g=3D0,b=3D0},bold=3Dfalse})
+	self.maintext =3D self:CreateChild(&quot;UOText&quot;,{x=3D0,y=3D0,text=3Dplaintext=
,col=3D{r=3D0,g=3D0,b=3D0},html=3Dtrue,bold=3Dfalse})
 	--~ self.gfx_maintarget_line =3D gRootWidget.tooltip:CreateChild(&quot;LineLis=
t&quot;,{matname=3D&quot;BaseWhiteNoLighting&quot;,bDynamic=3Dtrue,r=3D1,g=3D0,b=3D0})
 	=

 	local e =3D 2

Modified: trunk/lua/lib.spellbooks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.spellbooks.lua (original)
+++ trunk/lua/lib.spellbooks.lua Mon Nov 24 21:02:16 2008
@@ -419,7 +419,17 @@
 	return GetSpellCastTime(spellid,equipprop.fc,IsBuffActive_Protection(),Is=
BuffActive_EssenceOfWind())
 end
 =

-gSpellInterruptMessages =3D { [500946 ]=3Dtrue,[502632 ]=3Dtrue,[500641 ]=
=3Dtrue,[502625 ]=3Dtrue,[1049645]=3Dtrue, } -- notintown,fizz,disturbed,no=
mana,toomanyfollowers
+gSpellInterruptMessages =3D {}
+gSpellInterruptMessages[500946 ] =3D true -- You cannot cast this in town!=
							=

+gSpellInterruptMessages[502632 ] =3D true -- The spell fizzles.										=

+gSpellInterruptMessages[500641 ] =3D true -- Your concentration is disturb=
ed, thus ruining thy spell.	=

+gSpellInterruptMessages[502625 ] =3D true -- Insufficient mana for this sp=
ell.						=

+gSpellInterruptMessages[1049645] =3D true -- You have too many followers t=
o summon that creature.  	   =

+gSpellInterruptMessages[500015 ] =3D true -- You do not have that spell!
+gSpellInterruptMessages[502630 ] =3D true -- More reagents are needed for =
this spell.
+gSpellInterruptMessages[502644 ] =3D true -- You have not yet recovered fr=
om casting a spell.
+gSpellInterruptMessages[1061091] =3D true -- You cannot cast that spell in=
 this form.    =

+
 RegisterListener(&quot;Hook_Packet_Localized_Text&quot;,function (serial,plaintext,t=
ext_messagenum) =

 	if (gSpellInterruptMessages[text_messagenum]) then NotifyListener(&quot;Hook_S=
pell_Interrupt&quot;,serial,plaintext,text_messagenum) end
 end)

Modified: trunk/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoids.lua (original)
+++ trunk/lua/lib.uoids.lua Mon Nov 24 21:02:16 2008
@@ -128,69 +128,74 @@
 =

 -- Paperdoll Layer
 gLayerType =3D {}
-gLayerType.kLayer_OneHanded 		=3D hex2num(&quot;0x01&quot;) -- weapon
-gLayerType.kLayer_TwoHanded 		=3D hex2num(&quot;0x02&quot;) -- weapon , shield, or m=
isc.	=

-gLayerType.kLayer_Shoes				=3D hex2num(&quot;0x03&quot;)
-gLayerType.kLayer_Pants				=3D hex2num(&quot;0x04&quot;)
-gLayerType.kLayer_Shirt				=3D hex2num(&quot;0x05&quot;)
-gLayerType.kLayer_Helm				=3D hex2num(&quot;0x06&quot;) -- or Hat
-gLayerType.kLayer_Gloves			=3D hex2num(&quot;0x07&quot;)
-gLayerType.kLayer_Ring				=3D hex2num(&quot;0x08&quot;)
-gLayerType.kLayer_Unused			=3D hex2num(&quot;0x09&quot;)
-gLayerType.kLayer_Neck				=3D hex2num(&quot;0x0A&quot;)
-gLayerType.kLayer_Hair				=3D hex2num(&quot;0x0B&quot;)
-gLayerType.kLayer_Waist 			=3D hex2num(&quot;0x0C&quot;) -- (half apron)
-gLayerType.kLayer_TorsoInner 		=3D hex2num(&quot;0x0D&quot;) -- (inner) (chest armor=
)		=

-gLayerType.kLayer_Bracelet			=3D hex2num(&quot;0x0E&quot;)
-gLayerType.kLayer_Unused			=3D hex2num(&quot;0x0F&quot;) --  (backpack, but backpack=
s go to 0x15)		=

-gLayerType.kLayer_FacialHair		=3D hex2num(&quot;0x10&quot;)
-gLayerType.kLayer_TorsoMiddle		=3D hex2num(&quot;0x11&quot;) --  (middle) (sircoat, =
tunic, full apron, sash)			=

-gLayerType.kLayer_Earrings			=3D hex2num(&quot;0x12&quot;)
-gLayerType.kLayer_Arms				=3D hex2num(&quot;0x13&quot;)
-gLayerType.kLayer_Back 				=3D hex2num(&quot;0x14&quot;) -- (cloak)
-gLayerType.kLayer_Backpack			=3D hex2num(&quot;0x15&quot;)
-gLayerType.kLayer_TorsoOuter		=3D hex2num(&quot;0x16&quot;) -- (outer) (robe)
-gLayerType.kLayer_LegsOuter			=3D hex2num(&quot;0x17&quot;) -- (outer) (skirt/kilt)
-gLayerType.kLayer_LegsInner			=3D hex2num(&quot;0x18&quot;) -- (inner) (leg armor)
-gLayerType.kLayer_Mount 			=3D hex2num(&quot;0x19&quot;) -- (horse, ostard, etc)	=

-gLayerType.kLayer_NPCBuyRestock 	=3D hex2num(&quot;0x1A&quot;) -- container	=

-gLayerType.kLayer_NPCBuyNoRestock 	=3D hex2num(&quot;0x1B&quot;) -- container	=

-gLayerType.kLayer_NPCSellContainer	=3D hex2num(&quot;0x1C&quot;)
-gLayerType.kLayer_PCBankBox 		=3D hex2num(&quot;0x1D&quot;)
+gLayerType.kLayer_OneHanded 		=3D 0x01 -- weapon
+gLayerType.kLayer_TwoHanded 		=3D 0x02 -- weapon , shield, or misc.	=

+gLayerType.kLayer_Shoes				=3D 0x03
+gLayerType.kLayer_Pants				=3D 0x04
+gLayerType.kLayer_Shirt				=3D 0x05
+gLayerType.kLayer_Helm				=3D 0x06 -- or Hat
+gLayerType.kLayer_Gloves			=3D 0x07
+gLayerType.kLayer_Ring				=3D 0x08
+gLayerType.kLayer_Unused			=3D 0x09
+gLayerType.kLayer_Neck				=3D 0x0A
+gLayerType.kLayer_Hair				=3D 0x0B
+gLayerType.kLayer_Waist 			=3D 0x0C -- (half apron)
+gLayerType.kLayer_TorsoInner 		=3D 0x0D -- (inner) (chest armor)		=

+gLayerType.kLayer_Bracelet			=3D 0x0E
+gLayerType.kLayer_Unused			=3D 0x0F --  (backpack, but backpacks go to 0x1=
5)		=

+gLayerType.kLayer_FacialHair		=3D 0x10
+gLayerType.kLayer_TorsoMiddle		=3D 0x11 --  (middle) (sircoat, tunic, full=
 apron, sash)			=

+gLayerType.kLayer_Earrings			=3D 0x12
+gLayerType.kLayer_Arms				=3D 0x13
+gLayerType.kLayer_Back 				=3D 0x14 -- (cloak)
+gLayerType.kLayer_Backpack			=3D 0x15
+gLayerType.kLayer_TorsoOuter		=3D 0x16 -- (outer) (robe)
+gLayerType.kLayer_LegsOuter			=3D 0x17 -- (outer) (skirt/kilt)
+gLayerType.kLayer_LegsInner			=3D 0x18 -- (inner) (leg armor)
+gLayerType.kLayer_Mount 			=3D 0x19 -- (horse, ostard, etc)	=

+gLayerType.kLayer_NPCBuyRestock 	=3D 0x1A -- container	=

+gLayerType.kLayer_NPCBuyNoRestock 	=3D 0x1B -- container	=

+gLayerType.kLayer_NPCSellContainer	=3D 0x1C
+gLayerType.kLayer_PCBankBox 		=3D 0x1D
 for k,v in pairs(gLayerType) do _G[k] =3D v end -- make names available as=
 global constants
 gLayerTypeName =3D {}
 for k,v in pairs(gLayerType) do gLayerTypeName[v] =3D k end -- make names =
available as global constants
 =

+gPaperdollFallbackGfx =3D {}
+gPaperdollFallbackGfx[kLayer_Back] =3D 0x1515 -- fallback : normal cloak f=
or broken arcane cloak
+kPaperdollFallbackLast =3D 0x1515 -- robe
+
+
 gPaperdollBlockingLayers =3D {
 	[kLayer_TorsoOuter] =3D {kLayer_Arms,kLayer_TorsoInner} -- kLayer_Helm, =

 }
 =

 -- WARNING ! this is not a complete list (see gLayerType for that) , e.g. =
kLayer_Mound =3D 0x19 is not in here
 gLayerOrder =3D {
-	hex2num(&quot;0x09&quot;),					   -- - N/A (not used)
-    hex2num(&quot;0x14&quot;),                       -- - Back (Cloak)
-    hex2num(&quot;0x10&quot;),                       -- - Facial Hair
-    hex2num(&quot;0x12&quot;),                       -- - Earrings
-    hex2num(&quot;0x04&quot;),                       -- - Leg Covering (including Pa=
nts&quot;), Shorts&quot;), Bone/Chain/Ring legs)
-    hex2num(&quot;0x0E&quot;),                       -- - Bracelet
-    hex2num(&quot;0x03&quot;),                       -- - Foot Covering/Armor
-    hex2num(&quot;0x08&quot;),                       -- - Ring
-    hex2num(&quot;0x18&quot;),                       -- - Legs (inner)(Leg Armor)
-    hex2num(&quot;0x05&quot;),                       -- - Chest Clothing/Female Ches=
t Armor
-    hex2num(&quot;0x0D&quot;),                       -- - Torso (inner)(Chest Armor)
-    hex2num(&quot;0x11&quot;),                       -- - Torso (Middle)(Surcoat&quot;), =
Tunic&quot;), Full Apron&quot;), Sash)
-    hex2num(&quot;0x0A&quot;),                       -- - Neck Covering/Armor
-    hex2num(&quot;0x13&quot;),                       -- - Arm Covering/Armor
-    hex2num(&quot;0x07&quot;),                       -- - Hand Covering/Armor
-    hex2num(&quot;0x17&quot;),                       -- - Legs (outer)(Skirt/Kilt)
-    hex2num(&quot;0x0B&quot;),                       -- - Hair
-    hex2num(&quot;0x06&quot;),                       -- - Head Covering/Armor
-    hex2num(&quot;0x16&quot;),                       -- - Torso (outer)(Robe) =

-    hex2num(&quot;0x0C&quot;),                       -- - Waist (Half-Apron)
-    hex2num(&quot;0x01&quot;),                       -- - Single-Hand item/weapon
-    hex2num(&quot;0x02&quot;),                       -- - Two-Hand item/weapon (incl=
uding Shield)
-    hex2num(&quot;0x15&quot;),                       -- - BackPack
-    hex2num(&quot;0x0F&quot;)
+	0x09,					   -- - N/A (not used)
+    0x14,                       -- - Back (Cloak)
+    0x10,                       -- - Facial Hair
+    0x12,                       -- - Earrings
+    0x04,                       -- - Leg Covering (including Pants&quot;), Shor=
ts&quot;), Bone/Chain/Ring legs)
+    0x0E,                       -- - Bracelet
+    0x03,                       -- - Foot Covering/Armor
+    0x08,                       -- - Ring
+    0x18,                       -- - Legs (inner)(Leg Armor)
+    0x05,                       -- - Chest Clothing/Female Chest Armor
+    0x0D,                       -- - Torso (inner)(Chest Armor)
+    0x11,                       -- - Torso (Middle)(Surcoat&quot;), Tunic&quot;), Fu=
ll Apron&quot;), Sash)
+    0x0A,                       -- - Neck Covering/Armor
+    0x13,                       -- - Arm Covering/Armor
+    0x07,                       -- - Hand Covering/Armor
+    0x17,                       -- - Legs (outer)(Skirt/Kilt)
+    0x0B,                       -- - Hair
+    0x06,                       -- - Head Covering/Armor
+    0x16,                       -- - Torso (outer)(Robe) =

+    0x0C,                       -- - Waist (Half-Apron)
+    0x01,                       -- - Single-Hand item/weapon
+    0x02,                       -- - Two-Hand item/weapon (including Shiel=
d)
+    0x15,                       -- - BackPack
+    0x0F
 }
 =

 -- you can add a paperdoll layer here with a position to overwrite the pos=
ition in paperdoll (centered)

Modified: trunk/lua/widgets/widget.uopaperdollitem.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/widgets/widget.uopaperdollitem.lua (original)
+++ trunk/lua/widgets/widget.uopaperdollitem.lua Mon Nov 24 21:02:16 2008
@@ -20,7 +20,16 @@
 	local imageparams =3D {x=3D0,y=3D0,hue=3Ditem.hue}
 	self.uoPaperdoll	=3D params.paperdoll
 	=

-	imageparams.gump_id =3D (not params.useart) and GetPaperdollItemGumpID(it=
em.artid,base_id)
+	local artid =3D item.artid
+	imageparams.gump_id =3D (not params.useart) and GetPaperdollItemGumpID(ar=
tid,base_id)
+	if (imageparams.gump_id and (not PreLoadGump(imageparams.gump_id,item.hue=
))) then =

+		local layer =3D GetPaperdollLayerFromTileType(artid) or 0
+		local fallbackartid =3D gPaperdollFallbackGfx[layer] or kPaperdollFallba=
ckLast
+		print(&quot;warning:paperdoll gump load failed layer,orig,fallback=3D&quot;,layer,=
artid,fallbackartid)
+		if (fallbackartid) then imageparams.gump_id =3D GetPaperdollItemGumpID(f=
allbackartid,base_id) end
+	end
+	=

+	=

 	if (not imageparams.gump_id) then =

 		imageparams.art_id =3D item.artid -- fallback and sidebar (jewelry,helme=
t,gorget)
 		--~ local art_atlas_piece =3D PreLoadArt(item.artid + 0x4000)

Modified: trunk/plugins/itemcounter.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/plugins/itemcounter.lua (original)
+++ trunk/plugins/itemcounter.lua Mon Nov 24 21:02:16 2008
@@ -8,28 +8,36 @@
 =

 kItemCounterLowAmount =3D 10
 kItemCounterBagType =3D 0xe76
-gItemCounterTypes 				=3D {
-	{name=3D&quot;blackperl&quot;	,artid=3D0xf7a},
-	{name=3D&quot;bloodmoss&quot;	,artid=3D0xf7b}, =

-	{name=3D&quot;mandrake&quot;	,artid=3D0xf86},
-	{name=3D&quot;garlic&quot;		,artid=3D0xf84},
-	{name=3D&quot;ginseng&quot;		,artid=3D0xf85},
-	{name=3D&quot;nightshade&quot;	,artid=3D0xf88},
-	{name=3D&quot;spidersilk&quot;	,artid=3D0xf8d},    =

-	{name=3D&quot;sulfurusash&quot;	,artid=3D0xf8c},  =

-									 =

-	{name=3D&quot;gheal&quot;		,artid=3D3852},
-	{name=3D&quot;gcure&quot;		,artid=3D3847},
-	{name=3D&quot;refresh&quot;		,artid=3D3851},
-	{name=3D&quot;explo&quot;		,artid=3D3853},
-	=

-	{name=3D&quot;gold&quot;		,artid=3D0xeef},
-	{name=3D&quot;bandas&quot;		,artid=3D0xe21},
-	{name=3D&quot;arrows&quot;		,artid=3D3903},
-	}     =

-                                                  =

-gItemCounterTypesByArtID 	=3D {}
-for k,v in pairs(gItemCounterTypes) do gItemCounterTypesByArtID[v.artid] =
=3D true end
+
+function InitItemCounterTypes () =

+	gItemCounterTypes =3D {}
+	table.insert(gItemCounterTypes,{name=3D&quot;blackperl&quot;	,artid=3D0xf7a})
+	table.insert(gItemCounterTypes,{name=3D&quot;bloodmoss&quot;	,artid=3D0xf7b}) =

+	table.insert(gItemCounterTypes,{name=3D&quot;mandrake&quot;		,artid=3D0xf86})
+	table.insert(gItemCounterTypes,{name=3D&quot;garlic&quot;		,artid=3D0xf84})
+	table.insert(gItemCounterTypes,{name=3D&quot;ginseng&quot;		,artid=3D0xf85})
+	table.insert(gItemCounterTypes,{name=3D&quot;nightshade&quot;	,artid=3D0xf88})
+	table.insert(gItemCounterTypes,{name=3D&quot;spidersilk&quot;	,artid=3D0xf8d})    =

+	table.insert(gItemCounterTypes,{name=3D&quot;sulfurusash&quot;	,artid=3D0xf8c})  =

+
+	table.insert(gItemCounterTypes,{name=3D&quot;pigiron&quot;		,artid=3D0xf8a})
+	table.insert(gItemCounterTypes,{name=3D&quot;noxcrystal&quot;	,artid=3D0xf8e})
+	table.insert(gItemCounterTypes,{name=3D&quot;demonblood&quot;	,artid=3D0xf7d})
+	table.insert(gItemCounterTypes,{name=3D&quot;gravedust&quot;	,artid=3D0xf8f})
+	table.insert(gItemCounterTypes,{name=3D&quot;batwing&quot;		,artid=3D0xf78})
+								 =

+	table.insert(gItemCounterTypes,{name=3D&quot;gheal&quot;		,artid=3D3852})
+	table.insert(gItemCounterTypes,{name=3D&quot;gcure&quot;		,artid=3D3847})
+	table.insert(gItemCounterTypes,{name=3D&quot;refresh&quot;		,artid=3D3851})
+	table.insert(gItemCounterTypes,{name=3D&quot;explo&quot;		,artid=3D3853})
+
+	table.insert(gItemCounterTypes,{name=3D&quot;gold&quot;			,artid=3D0xeef})
+	table.insert(gItemCounterTypes,{name=3D&quot;bandas&quot;		,artid=3D0xe21})
+	table.insert(gItemCounterTypes,{name=3D&quot;arrows&quot;		,artid=3D3903})
+	gItemCounterTypesByArtID 	=3D {}
+	for k,v in pairs(gItemCounterTypes) do gItemCounterTypesByArtID[v.artid] =
=3D true end
+end
+InitItemCounterTypes()
 =

 function ItemCounterOne (artid,baglist) =

 	local c =3D MacroCmd_Item_SumByArtID(artid) =

@@ -38,9 +46,9 @@
 end
 =

 -- dynamicdata.iContainerSerial
-RegisterListener(&quot;Mobile_UpdateStats&quot;, function (mobile) if (IsPlayerMobil=
e(mobile)) then gItemCounterNeedsUpdate =3D true end end)
-RegisterListener(&quot;Dynamic_Update&quot;, function (item) if (gItemCounterTypesBy=
ArtID[item.artid]) then gItemCounterNeedsUpdate =3D true end end)
-RegisterListener(&quot;Dynamic_Destroy&quot;, function (item) if (gItemCounterTypesB=
yArtID[item.artid]) then gItemCounterNeedsUpdate =3D true end end)
+RegisterListener(&quot;Mobile_UpdateStats&quot;,	function (mobile) if (IsPlayerMobil=
e(mobile)) then gItemCounterNeedsUpdate =3D true end end)
+RegisterListener(&quot;Dynamic_Update&quot;,		function (item) if (gItemCounterTypesB=
yArtID[item.artid]) then gItemCounterNeedsUpdate =3D true end end)
+RegisterListener(&quot;Dynamic_Destroy&quot;,		function (item) if (gItemCounterTypes=
ByArtID[item.artid]) then gItemCounterNeedsUpdate =3D true end end)
 RegisterStepper(function () if (gItemCounterNeedsUpdate) then ItemCounterU=
pdate() end end)
 -- item:IsInContainer(GetPlayerBackPackSerial())
 =


Modified: trunk/plugins/lib.spellbar.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/plugins/lib.spellbar.lua (original)
+++ trunk/plugins/lib.spellbar.lua Mon Nov 24 21:02:16 2008
@@ -146,7 +146,11 @@
 gSpellbarShortMessages[1049645] =3D {r=3D1,g=3D0,b=3D0,txt=3D&quot;too many fol=
lowers&quot;	,bInterrupt=3Dtrue} -- You have too many followers to summon that c=
reature.  	   =

 gSpellbarShortMessages[500015 ] =3D {r=3D1,g=3D0,b=3D0,txt=3D&quot;don't have s=
pell&quot;	,bInterrupt=3Dtrue} -- You do not have that spell!
 gSpellbarShortMessages[502630 ] =3D {r=3D1,g=3D0,b=3D0,txt=3D&quot;regs&quot;				,bI=
nterrupt=3Dtrue} -- More reagents are needed for this spell.
-
+gSpellbarShortMessages[502644 ] =3D {r=3D1,g=3D0,b=3D0,txt=3D&quot;recover&quot;			,=
bInterrupt=3Dtrue} -- You have not yet recovered from casting a spell.
+gSpellbarShortMessages[1061091 ] =3D {r=3D1,g=3D0,b=3D0,txt=3D&quot;form&quot;				,b=
Interrupt=3Dtrue} -- You cannot cast that spell in this form.
+gSpellbarShortMessages[1061605 ] =3D {r=3D1,g=3D0,b=3D0,txt=3D&quot;already&quot;			=
,bInterrupt=3Dtrue} -- You already have a familiar.
+
+for k,v in pairs(gSpellbarShortMessages) do if (v.bInterrupt) then gSpellI=
nterruptMessages[k] =3D true end end
 =

 -- weapon specials
 gSpellbarShortMessages[1060163] =3D {r=3D0.5,g=3D0.5,b=3D0.5,txt=3D&quot;PARABL=
OW&quot;			}--~ You deliver a paralyzing blow!  =

@@ -174,6 +178,8 @@
 gSpellbarShortMessages[1060757] =3D {r=3D1.0,g=3D0.0,b=3D0.0,txt=3D&quot;bleeds=
tart&quot; 		} -- You are bleeding profusely  (serial=3Dself=3D899675)
 gSpellbarShortMessages[1060167] =3D {r=3D0.0,g=3D0.5,b=3D0.0,txt=3D&quot;bleeds=
top&quot; 		} -- The bleeding wounds have healed, you are no longer bleeding!
 gSpellbarShortMessages[1042809] =3D {r=3D1,g=3D0.5,b=3D0.0,txt=3D&quot;EscortDo=
ne&quot;			} -- We have arrived! I thank thee, CHARNAME! I have no further need =
of thy services. Here is thy pay.
+
+
 =

 --[[
 =



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001553.html">[Iris-commit] [IRIS] r2749 - in /trunk: lua/gui/gui.healthbar.lua lua/lib.macrolist.lua lua/lib.mousepick.lua lua/lib.namegumps.lua lua/lib.uotooltip.lua lua/main.lua lua/widgets/widget.uotooltip.lua plugins/itemcounter.lua plugins/moblist.lua
</A></li>
	<LI>Next message: <A HREF="001555.html">[Iris-commit] [IRIS] r2751 - in /trunk: lua/lib.uodragdrop.lua	plugins/itemcounter.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1554">[ date ]</a>
              <a href="thread.html#1554">[ thread ]</a>
              <a href="subject.html#1554">[ subject ]</a>
              <a href="author.html#1554">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
