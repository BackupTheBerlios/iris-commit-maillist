From no-reply at zwischenwelt.org  Tue Aug  4 12:52:49 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 04 Aug 2009 10:52:49 -0000
Subject: [Iris-commit] [IRIS] r3089 - /trunk/config/shards/welt-pergon.de.xml
Message-ID: <20090804105256.64F567A980E2@simon>

Author: ghoulsblade
Date: Tue Aug  4 12:52:47 2009
New Revision: 3089

Log:
added welt-pergon.de shardconfig

Added:
    trunk/config/shards/welt-pergon.de.xml



From no-reply at zwischenwelt.org  Wed Aug  5 13:08:54 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 05 Aug 2009 11:08:54 -0000
Subject: [Iris-commit] [IRIS] r3090 - /trunk/lua/net/net.uodragdrop.lua
Message-ID: <20090805110855.0262A7A980A5@simon>

Author: ghoulsblade
Date: Wed Aug  5 13:08:54 2009
New Revision: 3090

Log:
secured net.uodragdrop.lua

Modified:
    trunk/lua/net/net.uodragdrop.lua

Modified: trunk/lua/net/net.uodragdrop.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.uodragdrop.lua (original)
+++ trunk/lua/net/net.uodragdrop.lua Wed Aug  5 13:08:54 2009
@@ -1,5 +1,8 @@
 -- Equip Item Request   (answer is 0x2E, see also 0x78). 0x13
 function Send_Equip_Item_Request(serial,layer,player_serial)
+	if (not serial) then print("Send_Equip_Item_Request:no serial") return end
+	if (not layer) then print("Send_Equip_Item_Request:no layer") return end
+	if (not player_serial) then print("Send_Equip_Item_Request:no player_seri=
al") return end
 	printdebug("net","NET: Send_Equip_Item_Request:",sprintf("0x%08x",serial)=
,layer,player_serial)
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_Equip_Item_Request)



From no-reply at zwischenwelt.org  Thu Aug  6 12:49:38 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 06 Aug 2009 10:49:38 -0000
Subject: [Iris-commit] [IRIS] r3091 - /trunk/lua/lib.null.renderer.lua
Message-ID: <20090806104938.B00557A980F1@simon>

Author: ghoulsblade
Date: Thu Aug  6 12:49:38 2009
New Revision: 3091

Log:
fixed damage crash in null renderer

Modified:
    trunk/lua/lib.null.renderer.lua

Modified: trunk/lua/lib.null.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.null.renderer.lua (original)
+++ trunk/lua/lib.null.renderer.lua Thu Aug  6 12:49:38 2009
@@ -66,3 +66,4 @@
 function RendererNull:ClearMapCache					() end
 function RendererNull:AddEffect						() end
 function RendererNull:HUDFX_AddRisingTextOnMob		() end
+function RendererNull:NotifyDamage		() end =




From no-reply at zwischenwelt.org  Sat Aug  8 14:38:24 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 08 Aug 2009 12:38:24 -0000
Subject: [Iris-commit] [IRIS] r3092 - in /trunk/lua: ./ net/
Message-ID: <20090808123825.1865E7A980FF@simon>

Author: sience
Date: Sat Aug  8 14:38:24 2009
New Revision: 3092

Log:
-last network packages seperated and moved to /net folder
-weapon abilities seperated from network packets and moved to lib.weaponabi=
lity.lua

Added:
    trunk/lua/lib.weaponability.lua
    trunk/lua/net/net.book.lua
    trunk/lua/net/net.huepicker.lua
    trunk/lua/net/net.objectpicker.lua
    trunk/lua/net/net.tooltips.lua
Modified:
    trunk/lua/lib.book.lua
    trunk/lua/lib.equipment.lua
    trunk/lua/lib.huepicker.lua
    trunk/lua/lib.keybinds.lua
    trunk/lua/lib.objectpicker.lua
    trunk/lua/lib.uotooltip.lua
    trunk/lua/main.lua
    trunk/lua/net/net.aoscommand.lua
    trunk/lua/net/net.effect.lua
    trunk/lua/net/net.main.lua

Modified: trunk/lua/lib.book.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.book.lua (original)
+++ trunk/lua/lib.book.lua Sat Aug  8 14:38:24 2009
@@ -10,66 +10,8 @@
 --~ PacketHandlers.Register( 0x66,  0, true, new OnPacketReceive( ContentC=
hange ) );
 --~ PacketHandlers.Register( 0x93, 99, true, new OnPacketReceive( OldHeade=
rChange ) );
 =

---[[
-### kPacket_Book_Info header:   {author=3D"Ghongolas",authorlen=3D10=3D0x0=
a,title=3D"a book",unknown=3D1,numpages=3D20=3D0x14,writable=3D1,serial=3D0=
x41b0a207,titlelen=3D7,}
-### kPacket_Book_Contents pages:  {numpages=3D20=3D0x14,serial=3D0x41b0a20=
7,pages=3D{
-    1=3D{numlines=3D0,pagenum=3D1,lines=3D{},},
-    2=3D{numlines=3D0,pagenum=3D2,lines=3D{},},
-    ....
-    20=3D{numlines=3D0,pagenum=3D20=3D0x14,lines=3D{},},},}
-]]--
-
 gBooks =3D {}
-
 RegisterWidgetClass("UOBookDialog")
-
-function gPacketHandler.kPacket_Book_Info () -- 0xd4 : runuo:BookHeader
-    local input     =3D GetRecvFIFO()
-    local id        =3D input:PopNetUint8()
-    local size      =3D input:PopNetUint16()  -- 2
-    local data      =3D {}
-    data.serial     =3D input:PopNetUint32()
-    data.unknown    =3D input:PopNetUint8() -- runuo:always 1
-    data.writable   =3D input:PopNetUint8() =

-    data.numpages   =3D input:PopNetUint16() =

-    data.titlelen   =3D input:PopNetUint16() =

-    data.title      =3D input:PopFilledString(data.titlelen)
- =

-    data.authorlen  =3D input:PopNetUint16() =

-    data.author     =3D input:PopFilledString(data.authorlen)
-    local book =3D gBooks[data.serial]
-    if (not book) then book =3D {} gBooks[data.serial] =3D book end
-    book.header =3D data
-    --~ print("### kPacket_Book_Info header:",SmartDump(data))
-end
-
-function gPacketHandler.kPacket_Book_Contents () -- 0x66
-    local input     =3D GetRecvFIFO()
-    local id        =3D input:PopNetUint8()
-    local size      =3D input:PopNetUint16()  -- 2
-    local data      =3D {}
-    data.serial     =3D input:PopNetUint32()
-    data.numpages   =3D input:PopNetUint16()
-    data.pages      =3D {}
-    size =3D size - (3+4+2)
-    for i=3D1,data.numpages do =

-        local page =3D {}
-        page.pagenum    =3D input:PopNetUint16()
-        page.numlines   =3D input:PopNetUint16()
-        page.lines      =3D {}
-        size =3D size - 4
-        for j=3D1,page.numlines do =

-            page.lines[j],size =3D FIFO_PopZeroTerminatedString(input,size)
-        end
-        data.pages[page.pagenum] =3D page
-    end
-            =

-    local book =3D gBooks[data.serial]
-    if (not book) then book =3D {} gBooks[data.serial] =3D book end
-    book.pagedata =3D data
-    --~ print("### kPacket_Book_Contents pages:",size,SmartDump(data,4))
-    UpdateBookDialog(book)
-end
 =

 function UpdateBookDialog (book)
     local text =3D ""
@@ -89,33 +31,6 @@
     --~ print("#### book : ",text)
     book.plaintext =3D text
     book.dialog =3D GetDesktopWidget():CreateChild("UOBookDialog",book)
-end
-
--- ***** ***** ***** ***** ***** UOBookDialog widget
-
-function UOBookTest ()
-    Load_Font() -- iris specific
-    local book =3D {}
-    book.header =3D {author=3D"Staff of Vetus-Mundus",authorlen=3D22,title=
=3D"a small introduction",unknown=3D1,numpages=3D15,writable=3D0,serial=3D0=
x4040c1ce,titlelen=3D21,}
-    book.pagedata =3D {numpages=3D15,serial=3D0x4040c1ce,pages=3D{
-        {numlines=3D8,pagenum=3D1,lines=3D{"We welcome thee","traveler",""=
,"we're glad to see","thy journey led","thee to Vetus Mundus","The gods of =
this","",},},
-        {numlines=3D8,pagenum=3D2,lines=3D{"world will not bother","with m=
uch rules,","nonetheless","there's something to","follow here.","Rules are =
as listened:","'One can do whatever","",},},
-        {numlines=3D8,pagenum=3D3,lines=3D{"provides fun. Note,","that PvP=
 is only","possible on the facette","called felucca.","The second rule is:"=
,"'We all treat each other","with respect', the gods","",},},
-        {numlines=3D8,pagenum=3D4,lines=3D{"don't wish to hear","excessive=
 slang, nor","any indignities","from the mortal","or speaking to","oneself.=
 Dost you wish","to live peacefully","",},},
-        {numlines=3D8,pagenum=3D5,lines=3D{"here on Vetus Mundus, ","it's =
indispensable","to follow this rule.","","To make thy beginning","as comfor=
table as possible,","we will grant thee some","",},},
-        {numlines=3D8,pagenum=3D6,lines=3D{"commands. Listen carefully.","=
To communicate with other","mortal in the public","Channel, one has to use"=
,"the following","Combination:",".c (thy message)","",},},
-        {numlines=3D8,pagenum=3D7,lines=3D{"This will refer thy","message =
to the","public channel.","One can use:",".pm (name)(message)","to send a",=
"private message to","",},},
-        {numlines=3D8,pagenum=3D8,lines=3D{"another mortal,","which only c=
an be read","by him or her. It","will arrive him or her","even if he or she=
 is","not in our world","at the moment. It will","",},},
-        {numlines=3D8,pagenum=3D9,lines=3D{"be sent to him or her","as soo=
n as he visits","our world the next time.","If thee can gather the","pleasu=
re to join a guild","someday, thee can send ","them a message with the","",=
},},
-        {numlines=3D8,pagenum=3D10,lines=3D{"following command:",".g (mess=
age).","This message can only","be read by thy","guildmates.","There are se=
veral other","commands availabe,","",},},
-        {numlines=3D8,pagenum=3D11,lines=3D{"which can be shown by","typin=
g .help.","If thee has any further.","questions, don't hesitate","to ask ou=
r gods,","as they surely will","grant you as much help","",},},
-        {numlines=3D8,pagenum=3D12,lines=3D{"they can give.","","Last we w=
ant to add","the following rules:","Bugusing is not allowed","and won't be =
tolerated.","If thy find a bug,","",},},
-        {numlines=3D8,pagenum=3D13,lines=3D{"make sure to report","it as s=
oon as possible","to us. Bugusing will be","punished with a ban.","We'd lik=
e to add something","to the choice of your name:","discriminatory or","",},=
},
-        {numlines=3D8,pagenum=3D14,lines=3D{"racialist names,","as well as=
 names ","from the third reich ","will be deleted immediately","and be bann=
ed.","","","",},},
-        {numlines=3D8,pagenum=3D15,lines=3D{"","","","","Signed:","The sta=
ff of","Vetus Mundus","",},},
-        },}                                   =

-    --~ print("######",SmartDump(book,4))
-    UpdateBookDialog(book) =

 end
                                         =

 function gWidgetPrototype.UOBookDialog:Init (parentwidget,params)
@@ -146,3 +61,40 @@
 =

 function gWidgetPrototype.UOBookDialog:on_mouse_left_down   () self:BringT=
oFront() self:StartMouseMove() end
 function gWidgetPrototype.UOBookDialog:on_mouse_right_down  () self:Destro=
y() end
+
+-- ***** ***** ***** ***** ***** UOBookDialog widget
+--[[
+### kPacket_Book_Info header:   {author=3D"Ghongolas",authorlen=3D10=3D0x0=
a,title=3D"a book",unknown=3D1,numpages=3D20=3D0x14,writable=3D1,serial=3D0=
x41b0a207,titlelen=3D7,}
+### kPacket_Book_Contents pages:  {numpages=3D20=3D0x14,serial=3D0x41b0a20=
7,pages=3D{
+    1=3D{numlines=3D0,pagenum=3D1,lines=3D{},},
+    2=3D{numlines=3D0,pagenum=3D2,lines=3D{},},
+    ....
+    20=3D{numlines=3D0,pagenum=3D20=3D0x14,lines=3D{},},},}
+]]--
+
+--[[
+function UOBookTest ()
+    Load_Font() -- iris specific
+    local book =3D {}
+    book.header =3D {author=3D"Staff of Vetus-Mundus",authorlen=3D22,title=
=3D"a small introduction",unknown=3D1,numpages=3D15,writable=3D0,serial=3D0=
x4040c1ce,titlelen=3D21,}
+    book.pagedata =3D {numpages=3D15,serial=3D0x4040c1ce,pages=3D{
+        {numlines=3D8,pagenum=3D1,lines=3D{"We welcome thee","traveler",""=
,"we're glad to see","thy journey led","thee to Vetus Mundus","The gods of =
this","",},},
+        {numlines=3D8,pagenum=3D2,lines=3D{"world will not bother","with m=
uch rules,","nonetheless","there's something to","follow here.","Rules are =
as listened:","'One can do whatever","",},},
+        {numlines=3D8,pagenum=3D3,lines=3D{"provides fun. Note,","that PvP=
 is only","possible on the facette","called felucca.","The second rule is:"=
,"'We all treat each other","with respect', the gods","",},},
+        {numlines=3D8,pagenum=3D4,lines=3D{"don't wish to hear","excessive=
 slang, nor","any indignities","from the mortal","or speaking to","oneself.=
 Dost you wish","to live peacefully","",},},
+        {numlines=3D8,pagenum=3D5,lines=3D{"here on Vetus Mundus, ","it's =
indispensable","to follow this rule.","","To make thy beginning","as comfor=
table as possible,","we will grant thee some","",},},
+        {numlines=3D8,pagenum=3D6,lines=3D{"commands. Listen carefully.","=
To communicate with other","mortal in the public","Channel, one has to use"=
,"the following","Combination:",".c (thy message)","",},},
+        {numlines=3D8,pagenum=3D7,lines=3D{"This will refer thy","message =
to the","public channel.","One can use:",".pm (name)(message)","to send a",=
"private message to","",},},
+        {numlines=3D8,pagenum=3D8,lines=3D{"another mortal,","which only c=
an be read","by him or her. It","will arrive him or her","even if he or she=
 is","not in our world","at the moment. It will","",},},
+        {numlines=3D8,pagenum=3D9,lines=3D{"be sent to him or her","as soo=
n as he visits","our world the next time.","If thee can gather the","pleasu=
re to join a guild","someday, thee can send ","them a message with the","",=
},},
+        {numlines=3D8,pagenum=3D10,lines=3D{"following command:",".g (mess=
age).","This message can only","be read by thy","guildmates.","There are se=
veral other","commands availabe,","",},},
+        {numlines=3D8,pagenum=3D11,lines=3D{"which can be shown by","typin=
g .help.","If thee has any further.","questions, don't hesitate","to ask ou=
r gods,","as they surely will","grant you as much help","",},},
+        {numlines=3D8,pagenum=3D12,lines=3D{"they can give.","","Last we w=
ant to add","the following rules:","Bugusing is not allowed","and won't be =
tolerated.","If thy find a bug,","",},},
+        {numlines=3D8,pagenum=3D13,lines=3D{"make sure to report","it as s=
oon as possible","to us. Bugusing will be","punished with a ban.","We'd lik=
e to add something","to the choice of your name:","discriminatory or","",},=
},
+        {numlines=3D8,pagenum=3D14,lines=3D{"racialist names,","as well as=
 names ","from the third reich ","will be deleted immediately","and be bann=
ed.","","","",},},
+        {numlines=3D8,pagenum=3D15,lines=3D{"","","","","Signed:","The sta=
ff of","Vetus Mundus","",},},
+        },}                                   =

+    --~ print("######",SmartDump(book,4))
+    UpdateBookDialog(book) =

+end
+]]

Modified: trunk/lua/lib.equipment.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.equipment.lua (original)
+++ trunk/lua/lib.equipment.lua Sat Aug  8 14:38:24 2009
@@ -5,6 +5,22 @@
 =

 gEquipPropCache =3D nil
 gEquipmentSerials =3D {}
+
+gShortProps =3D {}
+gShortProps.fcr		=3D {num=3D"faster cast recovery "}
+gShortProps.fc		=3D {num=3D"faster casting "}
+
+-- returns props=3D{fcr=3D?,fc=3D?,...}
+function ParseProps (tooltip) =

+	local res =3D {}
+	for k,v in pairs(gShortProps) do
+		if (v.num) then
+			local a,b,num =3D string.find(tooltip,v.num.."(%d+)")
+			if (num) then res[k] =3D tonumber(num) end
+		end
+	end
+	return res
+end
 =

 -- returns proparr=3D{fc=3D?,fcr=3D?}
 function GetEquipProps ()

Modified: trunk/lua/lib.huepicker.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.huepicker.lua (original)
+++ trunk/lua/lib.huepicker.lua Sat Aug  8 14:38:24 2009
@@ -27,41 +27,9 @@
 RegisterWidgetClass("UOHuePicker")
 RegisterWidgetClass("UOHuePickerButton")
 =

-function gPacketHandler.kPacket_Hue_Picker () -- 0x95
-    local input     =3D GetRecvFIFO()
-    local id        =3D input:PopNetUint8()
-    local data      =3D {}
-    data.serial     =3D input:PopNetUint32()
-    data.unknown    =3D input:PopNetUint16() -- always zero on runuo
-    data.itemid     =3D input:PopNetUint16() -- not on uogamers-hybrid:pre=
aos?
-    ShowHuePicker(data)
-end
-
--- value =3D itemid from request ?  but ignored by runuo
-function SendHuePickerResponse (serial,value,hue) -- 0x95 kPacket_Hue_Pick=
er =

-    local out =3D GetSendFIFO()
-    out:PushNetUint8(kPacket_Hue_Picker)
-    out:PushNetUint32(serial)
-    out:PushNetUint16(value)
-    out:PushNetUint16(hue) -- & 0x3FFF  in runuo ...  see also Utility.Cli=
pDyedHue   max(2,min(1001,hue)
-    out:SendPacket()
-end
-
 function ShowHuePicker (data) GetDesktopWidget():CreateChild("UOHuePicker"=
,data) end
 =

 -- ***** ***** ***** ***** ***** UOHuePicker widget
-
-function HueTest ()
-    Load_Hue()
-    ShowHuePicker({serial=3D0x1234,itemid=3D0x4567})
-    --~ for hue =3D 1,102 do =

-        --~ local r,g,b =3D GetHueColor(hue-1)
-        --~ local txt =3D sprintf("0x%04x:%03x,",hue,floor(r*16)*16*16+flo=
or(g*16)*16+floor(b*16))
-        --~ print(txt)
-    --~ end
-    --~ os.exit(0)
-end
-                                        =

 function gWidgetPrototype.UOHuePicker:Init (parentwidget,params)
     self:InitAsGroup(parentwidget,params)
     self.items =3D {}
@@ -106,4 +74,17 @@
 end
 =

 function gWidgetPrototype.UOHuePickerButton:on_button_click () self:GetPar=
ent():ChooseHue(self.params.hue) end
-        =

+
+--[[
+function HueTest ()
+    Load_Hue()
+    ShowHuePicker({serial=3D0x1234,itemid=3D0x4567})
+    --~ for hue =3D 1,102 do =

+        --~ local r,g,b =3D GetHueColor(hue-1)
+        --~ local txt =3D sprintf("0x%04x:%03x,",hue,floor(r*16)*16*16+flo=
or(g*16)*16+floor(b*16))
+        --~ print(txt)
+    --~ end
+    --~ os.exit(0)
+end
+]]--
+       =


Modified: trunk/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.keybinds.lua (original)
+++ trunk/lua/lib.keybinds.lua Sat Aug  8 14:38:24 2009
@@ -119,12 +119,13 @@
         Bind("f9",      function (state) if (not gActiveEditText) then if =
(state > 0) then
             if (gCompositor) then
                 print("remove compositor")
-                OgreRemoveCompositor(GetMainViewport(),"B&W")
+                OgreRemoveCompositor(GetMainViewport(), "ssao")
                 gCompositor =3D false
             else
                 print("add compositor")
-                OgreAddCompositor(GetMainViewport(), "B&W")
+                OgreAddCompositor(GetMainViewport(), "ssao")
                 gCompositor =3D true
+                --mgr.ssao->addListener(&ssaoParamUpdater);
             end
          end end end)
 =


Modified: trunk/lua/lib.objectpicker.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.objectpicker.lua (original)
+++ trunk/lua/lib.objectpicker.lua Sat Aug  8 14:38:24 2009
@@ -1,54 +1,12 @@
--- clienside object list dialog, crafting gumps on pre-aos-pol
--- example shard : http://zulu2000.nsn3.net/
+--[[ ***** see Iris2 COPYING for license info ***** ]]--
+--[[ \brief
+			clienside object list dialog, crafting gumps on pre-aos-pol
+			example shard : http://zulu2000.nsn3.net/
+]]--
 =

---~ packet  typeid=3D0x7c,size=3D90,typename=3DkPacket_Object_Picker
-
--- opens a dialogbox displaying multiple choices, client sends response as=
 0x7D
-function gPacketHandler.kPacket_Object_Picker() -- 0x7C
-	local input =3D GetRecvFIFO()
-	local popped_start =3D input:GetTotalPopped()
-	local id =3D input:PopNetUint8()
-	local size =3D input:PopNetUint16()
-	local data =3D {}
-	data.dialogid		=3D input:PopNetUint32() -- echo'd back to server in 0x7d
-	data.menuid			=3D input:PopNetUint16() -- echo'd back to server in 0x7d  =
   runuo:0
-	data.questionlen	=3D input:PopNetUint8()
-	data.questiontxt	=3D ""
-	if (data.questionlen > 0) then =

-		data.questiontxt =3D input:PopFilledString(data.questionlen)
-	end
-	local sizeleft =3D size - 1 - 2 - 4 - 2 - 1 - data.questionlen
-	data.entrynum		=3D input:PopNetUint8()
-	print("kPacket_Object_Picker",SmartDump(data))
-	data.entrylist =3D {}
-	for i =3D 1,data.entrynum do
-		if (sizeleft <=3D 0) then break end
-		local entry =3D {}
-		entry.artid		=3D input:PopNetUint16() -- (e.ItemID & 0x3FFF)
-		entry.hue		=3D 0
-		sizeleft =3D sizeleft - 2
-		if (entry.artid > 0) then =

-			entry.hue		=3D input:PopNetUint16()
-			sizeleft =3D sizeleft - 2
-		end
-		entry.namelen	=3D input:PopNetUint8()
-		entry.name		=3D ""
-		sizeleft =3D sizeleft - 1
-		entry.namelen =3D min(entry.namelen,sizeleft)
-		sizeleft =3D sizeleft - entry.namelen
-		--~ print()
-		=

-		if (entry.namelen > 0) then entry.name =3D input:PopFilledString(entry.n=
amelen) end
-		print("kPacket_Object_Picker entry",SmartDump(entry))
-		table.insert(data.entrylist,entry)
-	end
-	=

-	OpenObjectPicker(data)
-end
 =

 function OpenObjectPicker(data)
 	local question =3D (data.questiontxt ~=3D "") and data.questiontxt or "pi=
ck one:"
-
 	local a =3D {}
 	local b =3D {}
 	local c =3D {}
@@ -65,84 +23,6 @@
 	local dialog =3D guimaker.MakeTableDlg(rows,100,10,true,true,gGuiDefaultS=
tyleSet,"window")
 end
 =

---[[
-kPacket_Object_Picker   {entrynum=3D4,questionlen=3D28=3D0x1c,questiontxt=
=3D"What would you like to make?",unknown=3D0,serial=3D0,}
-kPacket_Object_Picker entry     {hue=3D0,artid=3D5141=3D0x1415,name=3D"Arm=
ors",namelen=3D6,}
-kPacket_Object_Picker entry     {hue=3D0,artid=3D7029=3D0x1b75,name=3D"Shi=
elds",namelen=3D7,}
-kPacket_Object_Picker entry     {hue=3D0,artid=3D3915=3D0x0f4b,name=3D"Wea=
pons",namelen=3D7,}
-kPacket_Object_Picker entry     {hue=3D0,artid=3D5402=3D0x151a,name=3D"Dec=
orations",namelen=3D11=3D0x0b,}
-
-
-BYTE[1] cmd  =

-BYTE[4] dialogID (echoed back from 7C packet)
-BYTE[2] menuid (echoed back from 7C packet)
-BYTE[2] 1-based index of choice
-BYTE[2] model # of choice
-BYTE[2] color
-
-
-]]--
-
-
--- response to 0x7C
-function Send_Picked_Object (dialogid,menuid,choice,artid,hue) -- 0x7D
-	local out =3D GetSendFIFO()
-	out:PushNetUint8(kPacket_Picked_Object)
-	out:PushNetUint32(dialogid)
-	out:PushNetUint16(menuid)
-	out:PushNetUint16(choice) -- 1based
-	out:PushNetUint16(artid)
-	out:PushNetUint16(hue)
-	out:SendPacket()
-end
-
-
-
-
---~ gPacketType.kPacket_String_Query									=3D { id=3D0xAB }
---~ gPacketType.kPacket_String_Response									=3D { id=3D0xAC }
--- text entry dialog ? comes at the end of pre-aos crafter gump ?
--- response =3D 0xAC
-function gPacketHandler.kPacket_String_Query() -- 0xAB
-	local input =3D GetRecvFIFO()
-	local popped_start =3D input:GetTotalPopped()
-	local id =3D input:PopNetUint8()
-	local size =3D input:PopNetUint16()
-	local data =3D {}
-	data.id			=3D input:PopNetUint32()
-	data.parentid	=3D input:PopNetUint8()
-	data.buttonid	=3D input:PopNetUint8()
-	data.textlen	=3D input:PopNetUint16() -- ??? not quite sure about the mea=
ning, but one byte was too few
-	data.text		=3D input:PopFilledString(data.textlen)
-	--~ local datalenleft2 =3D size-1-2-4-1-1-1-data.textlen
-	--~ for i=3D0,datalenleft2-1 do local v =3D input:PeekNetUint8(i) print("=
+",i,v,sprintf("%c",v)) end
-	=

-	data.cancel		=3D input:PopNetUint8() -- (0=3Ddisable, 1=3Denable)
-	data.style		=3D input:PopNetUint8() -- (0=3Ddisable, 1=3Dnormal, 2=3Dnume=
rical)
-	data.format		=3D input:PopNetUint32() -- (if style 1, max text len, if st=
yle2, max numeric value)
-	data.text2len	=3D input:PopNetUint8()
-	=

-	data.datalenleft =3D size-1-2-4-1-1-2-data.textlen-1-1-4-1
-	data.text2		=3D (data.datalenleft > 0) and input:PopFilledString(data.dat=
alenleft) or ""
-	HandleStringQuery(data)
-	--~ print("kPacket_String_Query",SmartDump(data))
-	--[[
-	kPacket_String_Query    {
-		datalenleft=3D2
-		id=3D0x00039bcb
-		parentid=3D0
-		buttonid=3D0
-		textlen=3D24=3D0x18
-		text=3D"How many loops? [0-100]"
-		cancel=3D1
-		style=3D1
-		format=3D4
-		text2=3D""
-		text2len=3D0
-		}
-	]]--
-end
-
 function HandleStringQuery (data)
 	print("HandleStringQuery",data.id,data.parentid,data.buttonid)
 	local rows =3D {
@@ -157,20 +37,3 @@
 		}
 	local dialog =3D guimaker.MakeTableDlg(rows,100,100,false,true,gGuiDefaul=
tStyleSet,"window")
 end
-
--- response to 0xAB
-function Send_String_Query_Response (id,mytype,myidx,response) -- 0xAC
-	local responselen =3D string.len(response)
-	local out =3D GetSendFIFO()
-	out:PushNetUint8(kPacket_String_Response)
-	out:PushNetUint16(responselen+3+1+1+4+2+1)
-	out:PushNetUint32(id)
-	out:PushNetUint8(mytype)
-	out:PushNetUint8(myidx)
-	out:PushNetUint8(0) -- unknown
-	out:PushNetUint8(0) -- unknown
-	out:PushNetUint8(0) -- unknown
-	out:PushFilledString(response,responselen)
-	out:SendPacket()
-	-- doesn't seemt to work yet =3D(
-end

Modified: trunk/lua/lib.uotooltip.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uotooltip.lua (original)
+++ trunk/lua/lib.uotooltip.lua Sat Aug  8 14:38:24 2009
@@ -1,81 +1,22 @@
+--[[ ***** see Iris2 COPYING for license info ***** ]]--
+--[[ \brief
+			handles ToolTips
+]]--
+
+gMyNextToolTipCycleCount =3D 0
+
+gAosToolTipHash =3D {}
+gAosToolTipText =3D {}
+gAosToolTipRequested =3D {}
+
 gUOToolTipSerial =3D nil
 gUOToolTipDialog =3D nil
-
 kToolTipHashMask =3D 0x3fffFFFF
 =

-
-gShortProps =3D {}
-gShortProps.fcr		=3D {num=3D"faster cast recovery "}
-gShortProps.fc		=3D {num=3D"faster casting "}
-
--- returns props=3D{fcr=3D?,fc=3D?,...}
-function ParseProps (tooltip) =

-	local res =3D {}
-	for k,v in pairs(gShortProps) do
-		if (v.num) then
-			local a,b,num =3D string.find(tooltip,v.num.."(%d+)")
-			if (num) then res[k] =3D tonumber(num) end
-		end
-	end
-	return res
-end
-
-
-
-
-
-function StartUOToolTipAtMouse_Serial (serial)
-	if (gUOToolTipSerial =3D=3D serial) then return end
-	CloseOldUOToolTip()
-	gUOToolTipSerial =3D serial
-	if (not serial) then return end
-	=

-	local item =3D GetDynamic(serial)
-	if (item and item.multi) then return end -- no tooltips for multi parts
-	=

-	local iMouseX,iMouseY =3D GetMousePos()
-	gUOToolTipDialog =3D gRootWidget.tooltip:CreateChild("UOToolTip",{serial=
=3Dserial,x=3DiMouseX,y=3DiMouseY+32})
-	return gUOToolTipDialog
-end
-
-function CloseOldUOToolTip ()
-	if (gUOToolTipDialog) then =

-		if (gUOToolTipDialog:IsAlive()) then gUOToolTipDialog:Destroy() end
-		gUOToolTipDialog =3D nil =

-	end
-	gUOToolTipSerial =3D nil
-end
-
-function StartUOToolTipAtMouse_Text (text)
-	CloseOldUOToolTip()
-	local iMouseX,iMouseY =3D GetMousePos()
-	gUOToolTipDialog =3D gRootWidget.tooltip:CreateChild("UOToolTip",{text=3D=
text,x=3DiMouseX,y=3DiMouseY+32})
-	return gUOToolTipDialog
-end
-
-
-function GetToolTipTextForSerial (serial) =

-	if (not serial) then return end
-	local item =3D GetDynamic(serial)
-	local res =3D GetItemTooltipOrLabel(serial)
-	if (not res) then =

-		local mobile =3D GetMobile(serial)
-		if (mobile) then return mobile.name end
-		if (item) then =

-			res =3D string.gsub(GetStaticTileTypeName(item.artid) or "","%%s%%",(it=
em.amount > 1) and "s" or "")
-		end
-	end
-	if (item and item.amount > 1 and (not IsCorpseArtID(item.artid))) then =

-		res =3D item.amount .. " " .. string.gsub(res,": *%d+$","")
-	end
-	return res
-end
-
-
+------------------------------------------------------------------------
 =

 -- if clilochash is wrong, request new megacliloc tooltip from server
 -- used in function gPacketHandler.kPacket_AOSObjProp()  &  gPacketHandler=
.kPacket_Generic_Command()
-gMyNextToolTipCycleCount =3D 0
 function Send_ToolTipRequest(objserial)
 	if (gDisableAosToolTipRequests) then return end
 	=

@@ -96,31 +37,8 @@
 	Send_ToolTipRequest_Aux(objserial)
 end
 =

-function Send_ToolTipRequest_Aux(objserial)
-	local out =3D GetSendFIFO()
-	out:PushNetUint8(kPacket_Generic_Command)
-	out:PushNetUint16(hex2num("0x0009"))
-	out:PushNetUint16(hex2num("0x0010"))
-	out:PushNetUint32(objserial)
-	out:SendPacket()
-end
+------------------------------------------------------------------------
 =

---Client -> Server: 0xD6 (AOSToolTip), frequ: 1, len: 0x07
---word	- Packet Size
---loop	- Item Info; count =3D (Packet Size-3)/4
---dword	- Serial
---endloop	- Item Info
-function Send_AosToolTipRequest(objserial)
-	local out =3D GetSendFIFO()
-	out:PushNetUint8(kPacket_Mega_Cliloc) -- 0xD6 runuo : BatchQueryProperties
-	out:PushNetUint16(7) -- packetsize
-	out:PushNetUint32(objserial)
-	out:SendPacket()
-end
-
-gAosToolTipHash =3D {}
-gAosToolTipText =3D {}
-gAosToolTipRequested =3D {}
 function AosToolTip_GetHash (serial) return gAosToolTipHash[serial] end
 function AosToolTip_GetText (serial,bNoRequest) =

 	local tip =3D gAosToolTipText[serial]
@@ -137,80 +55,50 @@
 	gAosToolTipRequested =3D {}
 end
 =

--- Newer packet as of late 2004.
--- Is now used on OSI to handle the Revision of Tooltips instead of the or=
iginal 0xBF methods it appears.
--- server sends these automatically when a new object appears, doesn't hav=
e to be requested
-function gPacketHandler.kPacket_AOSObjProp()	--0xDC (9 bytes)
-	local input =3D GetRecvFIFO()
-	local id =3D input:PopNetUint8()
-	local objserial =3D input:PopNetUint32()			--Item/Mob-Serial
-	local objrevision_hash =3D input:PopNetUint32()
-	local hash =3D BitwiseAND(objrevision_hash,kToolTipHashMask)
-	--~ print("kPacket_AOSObjProp",SmartDump(objserial))
-	printdebug("net",sprintf("NET: AOSObjProp objserial=3D0x%08x hash=3D0x%08=
x\n",objserial,hash))
-	if (AosToolTip_GetHash(objserial) ~=3D hash) then
-		AosToolTip_SetHash(objserial,hash)
-		-- print("Send_ToolTipRequest",objserial,hash)
-		Send_ToolTipRequest(objserial)
+------------------------------------------------------------------------
+
+function CloseOldUOToolTip ()
+	if (gUOToolTipDialog) then =

+		if (gUOToolTipDialog:IsAlive()) then gUOToolTipDialog:Destroy() end
+		gUOToolTipDialog =3D nil =

 	end
+	gUOToolTipSerial =3D nil
 end
 =

--- Mega Cliloc - server sends new Clilocs - just add them to the Cliloc
--- TODO : this cliloc additions might be local to a specific mobile, e.g. =
vendor or container...
-function gPacketHandler.kPacket_Mega_Cliloc()	--0xD6
-	local input				=3D GetRecvFIFO()
-	local id				=3D input:PopNetUint8()
-	local size				=3D input:PopNetUint16()
-	local data =3D {}
-	data.unknown1			=3D input:PopNetUint16()	--0x0001 or 0x4000 !?
-	local serial			=3D input:PopNetUint32()	--Serial of item/creature
-	data.unknown2			=3D input:PopNetUint16()	--0x0000 !?
-	data.objrevision_hash	=3D input:PopNetUint32()	--another serial? hash? we=
ird flags ? position ? 0x030c0ca3
-	local hash =3D BitwiseAND(data.objrevision_hash,kToolTipHashMask) =

-		-- objrevision_hash in old iris code : obj/character->SetAOSTooltipID(li=
stID);
+function StartUOToolTipAtMouse_Serial (serial)
+	if (gUOToolTipSerial =3D=3D serial) then return end
+	CloseOldUOToolTip()
+	gUOToolTipSerial =3D serial
+	if (not serial) then return end
 	=

-	local totaltext =3D ""
-	local bFirst =3D true
+	local item =3D GetDynamic(serial)
+	if (item and item.multi) then return end -- no tooltips for multi parts
 	=

-	while true do =

-		local cliloc_id =3D input:PopNetUint32()
-		if (cliloc_id =3D=3D 0x00000000) then break end
-		local cliloctext =3D gClilocLoader and gClilocLoader:Get(cliloc_id) or ""
-		=

-		local number_of_unicode_chars =3D input:PopNetUint16() / 2
-		local text =3D ""
-		local totalparamtext =3D ""
-		local debugtxt =3D ""
-		local params =3D {}
-		for i =3D 1,number_of_unicode_chars do  -- read unicode text and split b=
y 0x09 =3D tab
-			local head =3D input:PopUint8()
-			local data =3D input:PopUint8()
-			local c =3D ((head~=3D0) and string.char(head) or "?")
-			if (head =3D=3D 9 and data =3D=3D 0) then -- delimiter =3D tab=3D0x09
-				table.insert(params,text)
-				text =3D ""
-			else
-				text =3D text..c
-			end
-			totalparamtext =3D totalparamtext..c
-			debugtxt =3D debugtxt.."("..head..","..data..":"..c..")"
-		end
-		table.insert(params,text)
-		=

-		local text =3D string.gsub(ParameterizedClilocText(cliloc_id,params),"<b=
r>","\n")
-		=

-		if (bFirst) then bFirst =3D false else totaltext =3D totaltext.."\n" end
-		totaltext =3D totaltext..text
-		--~ printf("NET: Mega_Cliloc LINE : text=3D'%s' clilocbase=3D'%s' totalp=
aramtext=3D'%s' debug=3D%s\n",text,cliloctext,totalparamtext,debugtxt)
-	end
-	printdebug("net", sprintf("NET: Mega_Cliloc : serial=3D%d u3=3D%d text=3D=
'%s'\n",serial,hash,totaltext) )
-	--~ print("recv-tooltip",SmartDump(serial),hash=3D=3DAosToolTip_GetHash(s=
erial),sprintf("0x%08x",hash),sprintf("0x%08x",AosToolTip_GetHash(serial) o=
r 0),SmartDump(data.unknown2),SmartDump(data.unknown1),totaltext and string=
.len(totaltext))
-	AosToolTip_SetHash(serial,hash)
-	AosToolTip_SetText(serial,totaltext)
-	NotifyListener("Hook_ToolTipUpdate",serial,data)
-	=

-	--~ print("gPacketHandler.kPacket_Mega_Cliloc",serial,string.gsub(totalte=
xt,"\n",";"))
+	local iMouseX,iMouseY =3D GetMousePos()
+	gUOToolTipDialog =3D gRootWidget.tooltip:CreateChild("UOToolTip",{serial=
=3Dserial,x=3DiMouseX,y=3DiMouseY+32})
+	return gUOToolTipDialog
 end
 =

+function StartUOToolTipAtMouse_Text (text)
+	CloseOldUOToolTip()
+	local iMouseX,iMouseY =3D GetMousePos()
+	gUOToolTipDialog =3D gRootWidget.tooltip:CreateChild("UOToolTip",{text=3D=
text,x=3DiMouseX,y=3DiMouseY+32})
+	return gUOToolTipDialog
+end
 =

-
+function GetToolTipTextForSerial (serial) =

+	if (not serial) then return end
+	local item =3D GetDynamic(serial)
+	local res =3D GetItemTooltipOrLabel(serial)
+	if (not res) then =

+		local mobile =3D GetMobile(serial)
+		if (mobile) then return mobile.name end
+		if (item) then =

+			res =3D string.gsub(GetStaticTileTypeName(item.artid) or "","%%s%%",(it=
em.amount > 1) and "s" or "")
+		end
+	end
+	if (item and item.amount > 1 and (not IsCorpseArtID(item.artid))) then =

+		res =3D item.amount .. " " .. string.gsub(res,": *%d+$","")
+	end
+	return res
+end

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Aug  8 14:38:24 2009
@@ -110,6 +110,7 @@
 dofile(libpath .. "lib.registry.slow.lua")
 dofile(libpath .. "lib.proxy.lua")
 dofile(libpath .. "lib.randomname.lua")
+dofile(libpath .. "lib.weaponability.lua")
 =

 dofile(libpath .. "gui/gui.main.lua")
 dofile(libpath .. "obj/obj.main.lua")

Modified: trunk/lua/net/net.aoscommand.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.aoscommand.lua (original)
+++ trunk/lua/net/net.aoscommand.lua Sat Aug  8 14:38:24 2009
@@ -1,12 +1,48 @@
--- combatskills/weaponskills =

--- http://uo.stratics.com/content/arms-armor/specialmoves.php
--- http://uo.stratics.com/content/arms-armor/special_moves_chart.shtml
--- runuo : WeaponAbility.cs:319: ClearCurrentAbility : send ClearWeaponAbi=
lity.Instance 0xBF 0x21
+--[[ ***** see Iris2 COPYING for license info ***** ]]--
+--[[ \brief
+			handles Combat- & Weaponskills network packages
+			see also:
+			lib.weaponability.lua
+
+			see:
+			runuo : WeaponAbility.cs:319: ClearCurrentAbility : send ClearWeaponAbi=
lity.Instance 0xBF 0x21
+]]--
 =

 kPacket_AOS_Command_WeaponAbilityRequest	=3D hex2num("0x19")	-- Client -> =
Server message
 kPacket_AOS_Command_GuildGumpRequest		=3D hex2num("0x28")	-- Client -> Ser=
ver message
 kPacket_AOS_Command_QuestGumpRequest		=3D hex2num("0x32")	-- Client -> Ser=
ver message
 =

+--12:25:58.812 Client -> Server: 0xD7 (AOSStuff), frequ: 1, len: 0x0F
+--D7 0F00 00000001 0019 00000000 05 0A
+--Send Quest, Guild Button req. to Server -> Server returns a Serverside G=
ump
+function Send_AOSCommand(subcmd,mobile_serial,weaponability)
+	local weaponabilitytype =3D weaponability or 0
+	=

+	local out =3D GetSendFIFO()
+	out:PushNetUint8(kPacket_AOS_Command)
+
+	if (subcmd =3D=3D kPacket_AOS_Command_QuestGumpRequest) then
+		out:PushNetUint16(hex2num("0x0A"))
+		out:PushNetUint32(mobile_serial)
+		out:PushNetUint16(subcmd)
+		out:PushNetUint8(hex2num("0x0A"))
+	elseif (subcmd =3D=3D kPacket_AOS_Command_GuildGumpRequest) then
+		out:PushNetUint16(hex2num("0x0A"))
+		out:PushNetUint32(mobile_serial)
+		out:PushNetUint16(subcmd)
+		out:PushNetUint8(hex2num("0x0A"))
+	elseif (subcmd =3D=3D kPacket_AOS_Command_WeaponAbilityRequest) then
+		out:PushNetUint16(hex2num("0x0F"))
+		out:PushNetUint32(mobile_serial)
+		out:PushNetUint16(subcmd)
+		out:PushNetUint32(0)
+		out:PushNetUint8(weaponabilitytype)
+		out:PushNetUint8(hex2num("0x0A"))
+	end
+
+	out:SendPacket()
+	printdebug("mobile",sprintf("NET: kPacket_AOS_Command: mobile_serial=3D0x=
%08x ability=3D%d\n",mobile_serial,weaponabilitytype))
+end
 =

 --[[
 Packet Build: BYTE[1] cmd =

@@ -54,260 +90,3 @@
 0x1C =3D Serpent Arrow =

 0x1D =3D Force of Nature
 ]]--
---12:25:58.812 Client -> Server: 0xD7 (AOSStuff), frequ: 1, len: 0x0F
---D7 0F00 00000001 0019 00000000 05 0A
---Send Quest, Guild Button req. to Server -> Server returns a Serverside G=
ump
-function Send_AOSCommand(subcmd,mobile_serial,weaponability)
-	local weaponabilitytype =3D weaponability or 0
-	=

-	local out =3D GetSendFIFO()
-	out:PushNetUint8(kPacket_AOS_Command)
-
-	if (subcmd =3D=3D kPacket_AOS_Command_QuestGumpRequest) then
-		out:PushNetUint16(hex2num("0x0A"))
-		out:PushNetUint32(mobile_serial)
-		out:PushNetUint16(subcmd)
-		out:PushNetUint8(hex2num("0x0A"))
-	elseif (subcmd =3D=3D kPacket_AOS_Command_GuildGumpRequest) then
-		out:PushNetUint16(hex2num("0x0A"))
-		out:PushNetUint32(mobile_serial)
-		out:PushNetUint16(subcmd)
-		out:PushNetUint8(hex2num("0x0A"))
-	elseif (subcmd =3D=3D kPacket_AOS_Command_WeaponAbilityRequest) then
-		out:PushNetUint16(hex2num("0x0F"))
-		out:PushNetUint32(mobile_serial)
-		out:PushNetUint16(subcmd)
-		out:PushNetUint32(0)
-		out:PushNetUint8(weaponabilitytype)
-		out:PushNetUint8(hex2num("0x0A"))
-	end
-
-	out:SendPacket()
-	printdebug("mobile",sprintf("NET: kPacket_AOS_Command: mobile_serial=3D0x=
%08x ability=3D%d\n",mobile_serial,weaponabilitytype))
-end
-
-
-gWeaponAbilityIcons =3D {}
-gActiveWeaponAbility =3D 0
-gLastSelectedWeaponAbility =3D 0
-gLastWeaponAbilityClearT =3D 0
-
--- should only be called by ToggleWeaponAbility
-function Send_AOSCommand_WeaponAbility	(weaponabilityid)
-	local mobile_serial =3D GetPlayerSerial()
-	if (not mobile_serial) then return end
-	--~ print("##### WeaponAbility send",floor(Client_GetTicks()/1000),weapon=
abilityid)
-	Send_AOSCommand(kPacket_AOS_Command_WeaponAbilityRequest, mobile_serial, =
weaponabilityid)
-	gActiveWeaponAbility =3D weaponabilityid
-	gLastSelectedWeaponAbility =3D weaponabilityid
-	UpdateWeaponAbilityIcons()
-end
-
--- changes or deactivates weapon ability
-function ToggleWeaponAbility (weaponabilityid)
-	if (gActiveWeaponAbility =3D=3D weaponabilityid) then weaponabilityid =3D=
 0 end
-	Send_AOSCommand_WeaponAbility(weaponabilityid)
-end
-
--- send from server via kPacket_Generic_SubCommand_Ability_Icon
-function EndWeaponAbility ()
-	--~ print("##### WeaponAbility  end",floor(Client_GetTicks()/1000))
-	gActiveWeaponAbility =3D 0
-	gLastWeaponAbilityClearT =3D Client_GetTicks()
-	UpdateWeaponAbilityIcons()
-end
-
-
-RegisterStepper(function ()
-	-- warning : manacost is much higher if used more often than every 3s
-	if (not gReActivateWeaponAbilityInterval) then return end
-	if (gActiveWeaponAbility ~=3D 0) then return end
-	if (gLastSelectedWeaponAbility =3D=3D 0) then return end
-	local t =3D Client_GetTicks()
-	if (t - gLastWeaponAbilityClearT > gReActivateWeaponAbilityInterval) then
-		gLastWeaponAbilityClearT =3D t
-		Send_AOSCommand_WeaponAbility(gLastSelectedWeaponAbility)
-	end
-end)
-
-function GetWeaponSpecialsForMobile (mobile) =

-	if (not mobile) then return end
-	local item1 =3D GetMobileEquipmentItem(mobile,gLayerType.kLayer_OneHanded)
-	local item2 =3D GetMobileEquipmentItem(mobile,gLayerType.kLayer_TwoHanded=
) -- might be shield,lantern...
-	local artid =3D (item1 and item1.artid) or (item2 and item2.artid) or 0 -=
- 0 if barehanded
-	local skills =3D glWeaponAbilitiesWeapons[artid] or glWeaponAbilitiesWeap=
ons[0] -- could have a nonweapon in second hand : fall back to barehanded
-	if skills then return skills.first,skills.second end
-end =

-
--- icon hueing
-function UpdateWeaponAbilityIcons ()
-	for weaponabilityid,widget in pairs(gWeaponAbilityIcons) do =

-		if (widget:IsAlive()) then =

-			widget.gfx_main:ChangeParams({hue=3D(weaponabilityid =3D=3D gActiveWeap=
onAbility) and gQuickCastClickedHue or gQuickCastNormalHue})
-		end
-	end
-end
-
-
---[[
-objectId,primaryAbility,secondaryAbility,primaryId,secondaryId
-0,DISARM,PARALYZING_BLOW,5,11
-3568,WHIRLWIND_STRIKE,PARALYZING_BLOW ,13,11
-3569,WHIRLWIND_STRIKE,PARALYZING_BLOW ,13,11
-3570,DISMOUNT,DISARM ,6,5
-3571,DISMOUNT,DISARM ,6,5
-3572,DISMOUNT,DISARM ,6,5
-3573,DISMOUNT,DISARM ,6,5
-3713,CRUSHING_BLOW,DISARM ,4,5
-3714,CRUSHING_BLOW,DISARM ,4,5
-3717,DOUBLESTRIKE,DISARM ,7,5
-3718,DOUBLESTRIKE,DISARM ,7,5
-3719,BLEED_ATTACK,DISMOUNT ,2,6
-3720,BLEED_ATTACK,DISMOUNT ,2,6
-3721,DOUBLESTRIKE,CONCUSSION_BLOW ,7,3
-3722,DOUBLESTRIKE,CONCUSSION_BLOW ,7,3
-3778,BLEED_ATTACK,INFECTING ,2,8
-3779,BLEED_ATTACK,INFECTING ,2,8
-3780,SHADOWSTRIKE,DISARM ,12,5
-3781,SHADOWSTRIKE,DISARM ,12,5
-3907,ARMOR_IGNORE,DISARM ,1,5
-3908,ARMOR_IGNORE,DISARM ,1,5
-3909,BLEED_ATTACK,MORTALSTRIKE ,2,9
-3910,BLEED_ATTACK,MORTALSTRIKE ,2,9
-3911,BLEED_ATTACK,CONCUSSION_BLOW ,2,3
-3912,BLEED_ATTACK,CONCUSSION_BLOW ,2,3
-3913,CRUSHING_BLOW,DISMOUNT ,4,6
-3914,CRUSHING_BLOW,DISMOUNT ,4,6
-3915,DOUBLESTRIKE,WHIRLWIND_STRIKE ,7,13
-3916,DOUBLESTRIKE,WHIRLWIND_STRIKE ,7,13
-3917,PARALYZING_BLOW,DISMOUNT ,11,6
-3918,PARALYZING_BLOW,DISMOUNT ,11,6
-3919,CONCUSSION_BLOW,MORTALSTRIKE ,3,9
-3920,CONCUSSION_BLOW,MORTALSTRIKE ,3,9
-3921,INFECTING,SHADOWSTRIKE ,8,12
-3922,INFECTING,SHADOWSTRIKE ,8,12
-3932,CONCUSSION_BLOW,DISARM ,3,5
-3933,CONCUSSION_BLOW,DISARM ,3,5
-3934,CRUSHING_BLOW,ARMOR_IGNORE ,4,1
-3935,CRUSHING_BLOW,ARMOR_IGNORE ,4,1
-3936,ARMOR_IGNORE,CONCUSSION_BLOW ,1,3
-3937,ARMOR_IGNORE,CONCUSSION_BLOW ,1,3
-3938,ARMOR_IGNORE,PARALYZING_BLOW ,1,11
-3939,ARMOR_IGNORE,PARALYZING_BLOW ,1,11
-4020,CRUSHING_BLOW,SHADOWSTRIKE ,4,12
-4021,CRUSHING_BLOW,SHADOWSTRIKE ,4,12
-5039,ARMOR_IGNORE,BLEED_ATTACK ,1,2
-5040,ARMOR_IGNORE,BLEED_ATTACK ,1,2
-5041,PARALYZING_BLOW,MORTALSTRIKE ,11,9
-5042,PARALYZING_BLOW,MORTALSTRIKE ,11,9
-5043,SHADOWSTRIKE,DISMOUNT ,12,6
-5044,SHADOWSTRIKE,DISMOUNT ,12,6
-5045,DOUBLESTRIKE,PARALYZING_BLOW ,7,11
-5046,DOUBLESTRIKE,PARALYZING_BLOW ,7,11
-5047,ARMOR_IGNORE,CONCUSSION_BLOW ,1,3
-5048,ARMOR_IGNORE,CONCUSSION_BLOW ,1,3
-5049,CRUSHING_BLOW,PARALYZING_BLOW ,4,11
-5050,CRUSHING_BLOW,PARALYZING_BLOW ,4,11
-5091,CRUSHING_BLOW,SHADOWSTRIKE ,4,12
-5092,CRUSHING_BLOW,SHADOWSTRIKE ,4,12
-5108,CRUSHING_BLOW,DISARM ,4,5
-5109,CRUSHING_BLOW,DISARM ,4,5
-5110,INFECTING,DISARM ,8,5
-5111,INFECTING,DISARM ,8,5
-5112,CONCUSSION_BLOW,PARALYZING_BLOW ,3,11
-5113,CONCUSSION_BLOW,PARALYZING_BLOW ,3,11
-5114,WHIRLWIND_STRIKE,BLEED_ATTACK ,13,2
-5115,WHIRLWIND_STRIKE,BLEED_ATTACK ,13,2
-5116,MOVING_SHOT,DISMOUNT ,10,6
-5117,MOVING_SHOT,DISMOUNT ,10,6
-5118,DOUBLESTRIKE,ARMOR_IGNORE ,7,1
-5119,DOUBLESTRIKE,ARMOR_IGNORE ,7,1
-5120,ARMOR_IGNORE,INFECTING ,1,8
-5121,ARMOR_IGNORE,INFECTING ,1,8
-5122,SHADOWSTRIKE,MORTALSTRIKE ,12,9
-5123,SHADOWSTRIKE,MORTALSTRIKE ,12,9
-5124,BLEED_ATTACK,DISARM ,2,5
-5125,BLEED_ATTACK,DISARM ,2,5
-5126,CRUSHING_BLOW,BLEED_ATTACK ,4,2
-5127,CRUSHING_BLOW,BLEED_ATTACK ,4,2
-5176,WHIRLWIND_STRIKE,CRUSHING_BLOW ,13,4
-5177,WHIRLWIND_STRIKE,CRUSHING_BLOW ,13,4
-5178,CRUSHING_BLOW,CONCUSSION_BLOW ,4,3
-5179,CRUSHING_BLOW,CONCUSSION_BLOW ,4,3
-5180,ARMOR_IGNORE,MORTALSTRIKE ,1,9
-5181,ARMOR_IGNORE,MORTALSTRIKE ,1,9
-5182,WHIRLWIND_STRIKE,CONCUSSION_BLOW ,13,3
-5183,WHIRLWIND_STRIKE,CONCUSSION_BLOW ,13,3
-5184,BLEED_ATTACK,SHADOWSTRIKE ,2,12
-5185,BLEED_ATTACK,SHADOWSTRIKE ,2,12
-5186,DOUBLESTRIKE,SHADOWSTRIKE ,7,12
-5187,DOUBLESTRIKE,SHADOWSTRIKE ,7,12
-9914,BLEED_ATTACK,PARALYZING_BLOW ,2,11
-9915,PARALYZING_BLOW,MORTALSTRIKE ,11,9
-9916,CRUSHING_BLOW,MORTALSTRIKE ,4,9
-9917,ARMOR_IGNORE,DISMOUNT ,1,6
-9918,PARALYZING_BLOW,INFECTING ,11,8
-9919,DOUBLESTRIKE,INFECTING ,7,8
-9920,DISMOUNT,CONCUSSION_BLOW ,6,3
-9921,DOUBLESTRIKE,MORTALSTRIKE ,7,9
-9922,ARMOR_IGNORE,MOVING_SHOT ,1,10
-9923,DOUBLESTRIKE,MOVING_SHOT ,7,10
-9924,BLEED_ATTACK,PARALYZING_BLOW ,2,11
-9925,PARALYZING_BLOW,MORTALSTRIKE ,11,9
-9926,CRUSHING_BLOW,MORTALSTRIKE ,4,9
-9927,ARMOR_IGNORE,DISMOUNT ,1,6
-9928,PARALYZING_BLOW,INFECTING ,11,8
-9929,DOUBLESTRIKE,INFECTING ,7,8
-9930,DISMOUNT,CONCUSSION_BLOW ,6,3
-9931,DOUBLESTRIKE,MORTALSTRIKE ,7,9
-9932,ARMOR_IGNORE,MOVING_SHOT ,1,10
-9933,DOUBLESTRIKE,MOVING_SHOT ,7,10
-10146,CRUSHING_BLOW,RIDINGSWIPE ,4,14
-10147,FEINT,BLOCK ,20,16
-10148,FRENZIEDWHIRLWIND,DOUBLESTRIKE ,15,7
-10149,ARMORPIERCE,DOUBLESHOT ,23,22
-10150,FRENZIEDWHIRLWIND,CRUSHING_BLOW ,15,4
-10151,DEFENSEMASTERY,FRENZIEDWHIRLWIND ,17,15
-10152,FEINT,NERVESTRIKE ,20,18
-10153,FEINT,DOUBLESTRIKE ,20,7
-10155,DUALWIELD,TALONSTRIKE ,21,19
-10157,WHIRLWIND_STRIKE,DEFENSEMASTERY ,13,17
-10158,BLOCK,FEINT ,16,20
-10159,BLOCK,ARMORPIERCE ,16,23
-10221,CRUSHING_BLOW,RIDINGSWIPE ,4,14
-10222,FEINT,BLOCK ,20,16
-10223,FRENZIEDWHIRLWIND,DOUBLESTRIKE ,15,7
-10224,ARMORPIERCE,DOUBLESHOT ,23,22
-10225,FRENZIEDWHIRLWIND,CRUSHING_BLOW ,15,4
-10226,DEFENSEMASTERY,FRENZIEDWHIRLWIND ,17,15
-10227,FEINT,NERVESTRIKE ,20,18
-10228,FEINT,DOUBLESTRIKE ,20,7
-10230,DUALWIELD,TALONSTRIKE ,21,19
-10232,WHIRLWIND_STRIKE,DEFENSEMASTERY ,13,17
-10233,BLOCK,FEINT ,16,20
-10234,BLOCK,ARMORPIERCE ,16,23
-11550,FORCE_ARROW,SERPENT_ARROW ,25,28
-11551,LIGHTNING_ARROW,PSYCHIC_ATTACK ,26,27
-11552,PSYCHIC_ATTACK,BLEED_ATTACK ,27,2
-11553,INFECTING,SHADOWSTRIKE ,8,12
-11554,FEINT,ARMOR_IGNORE ,20,1
-11555,DISARM,BLADEWEAVE ,5,24
-11556,CONCUSSION_BLOW,CRUSHING_BLOW ,3,4
-11557,BLOCK,FORCE_OF_NATURE ,16,29
-11558,DISARM,BLADEWEAVE ,5,24
-11559,WHIRLWIND_STRIKE,BLADEWEAVE ,13,24
-11560,DISARM,CRUSHING_BLOW ,5,4
-11561,DEFENSEMASTERY,BLADEWEAVE ,17,24
-11562,FORCE_ARROW,SERPENT_ARROW ,25,28
-11563,LIGHTNING_ARROW,PSYCHIC_ATTACK ,26,27
-11564,PSYCHIC_ATTACK,BLEED_ATTACK ,27,2
-11565,INFECTING,SHADOWSTRIKE ,8,12
-11566,FEINT,ARMOR_IGNORE ,20,1
-11567,DISARM,BLADEWEAVE ,5,24
-11568,CONCUSSION_BLOW,CRUSHING_BLOW ,3,4
-11569,BLOCK,FORCE_OF_NATURE ,16,29
-11570,DISARM,BLADEWEAVE ,5,24
-11571,WHIRLWIND_STRIKE,BLADEWEAVE ,13,24
-11572,DISARM,CRUSHING_BLOW ,5,4
-11573,DEFENSEMASTERY,BLADEWEAVE,17,24
-]]--

Modified: trunk/lua/net/net.effect.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.effect.lua (original)
+++ trunk/lua/net/net.effect.lua Sat Aug  8 14:38:24 2009
@@ -1,8 +1,12 @@
+--[[ ***** see Iris2 COPYING for license info ***** ]]--
+--[[ \brief
+			handles Effect network packages
+]]--
+
 kEffectType_FromSourceToDest =3D 0
 kEffectType_LightningStrikeAtSource =3D 1
 kEffectType_StayAtCurrentPosition =3D 2
 kEffectType_FollowSource =3D 3
-
 =

 --[[ used for  RunUO-2.0-SVN/Server/Effects.cs:55:  public static bool Sen=
dParticlesTo( NetState state )
 		return ( m_ParticleSupportType =3D=3D ParticleSupportType.Full || (m_Par=
ticleSupportType =3D=3D ParticleSupportType.Detect && state.IsUOTDClient) );

Modified: trunk/lua/net/net.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.main.lua (original)
+++ trunk/lua/net/net.main.lua Sat Aug  8 14:38:24 2009
@@ -22,6 +22,10 @@
 dofile(libpath .. "net/net.trade.lua")
 dofile(libpath .. "net/net.uoam.lua")
 dofile(libpath .. "net/net.walk.lua")
+dofile(libpath .. "net/net.book.lua")
+dofile(libpath .. "net/net.huepicker.lua")
+dofile(libpath .. "net/net.objectpicker.lua")
+dofile(libpath .. "net/net.tooltips.lua")
 =

 -- only things that have at least 2 packets get its own file, everything e=
lse is handled here:
 dofile(libpath .. "net/net.packethandlers.lua")



From no-reply at zwischenwelt.org  Sat Aug  8 14:41:57 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 08 Aug 2009 12:41:57 -0000
Subject: [Iris-commit] [IRIS] r3093 - /trunk/lua/main.lua
Message-ID: <20090808124157.F3B0E7A980FE@simon>

Author: sience
Date: Sat Aug  8 14:41:57 2009
New Revision: 3093

Log:
-discriptions fixed

Modified:
    trunk/lua/main.lua

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Aug  8 14:41:57 2009
@@ -309,14 +309,14 @@
         if (not file_exists(CorrectPath(Addfilepath(gArtFile)))) then
             gUOPath =3D gRegistry:Get("gUOPath")
             if ((not gUOPath) or (not file_exists(CorrectPath(Addfilepath(=
gArtFile))))) then
-                gUOPath =3D FileOpenDialog("..","*","Select a file in the =
UO Folder")
+                gUOPath =3D FileOpenDialog("..","*","Select a FILE in your=
 Ultima-Online Folder")
                 if (gUOPath) then =

                     gUOPath =3D string.gsub(gUOPath,"\\","/") =

                     gUOPath =3D string.gsub(gUOPath,"/[^/]+$","/") =

                     print("gUOPath browsed",gUOPath) =

                 end
                 if ((not gUOPath) or (not file_exists(CorrectPath(Addfilep=
ath(gArtFile))))) then
-                    FatalErrorMessage(sprintf("iris2 could not find your u=
ltima-online directory (searchpath : %s),\n please set gUOPath in data/conf=
ig.lua",gUOPath or "??"))
+                    FatalErrorMessage(sprintf("Iris2 couldn't find your Ul=
tima-Online Folder (searchpath : %s),\n please set gUOPath in config/config=
.lua",gUOPath or "??"))
                 else =

                     gRegistry:Set("gUOPath",gUOPath)
                 end
@@ -326,7 +326,7 @@
     -- check for character(granny) models
     if (gCurrentRenderer =3D=3D Renderer3D and (not file_exists( CorrectGr=
annyPath(gGrannyConfigFile) ))) then
         gCurrentRenderer =3D Renderer2D
-        print("WARNING ! using 2d mode because iris could not find 3d char=
acter models in your uo dir (try the ML/Mondains legacy installer linked on=
 http://iris2.de)")
+        print("WARNING ! using 2d mode because Iris2 could not find 3d cha=
racter models in your uo dir (try the ML/Mondains legacy installer linked o=
n http://iris2.de)")
     end
 end
 =

@@ -579,7 +579,6 @@
     print("##################################")
 =

     gCurrentRenderer:Init()
-
     gCurrentRenderer:BlendOutLayersAbovePlayer()
     =

     -- Binds all InGame-Keys
@@ -589,12 +588,10 @@
 =

     -- stop menu music
     SoundStopMusic()
-    =

     -- start playing ingame music
     SoundPlayMusicById(57)
 =

     gInGameStarted =3D true
-    =

     GuiInitChat()
     =

     NotifyListener("Hook_StartInGame")
@@ -672,15 +669,11 @@
     =

     gProfiler_MainStep:End()
 =

-    =

-    =

     local t_gpu_start =3D Client_GetTicks()
-    =

-	=

+
     if (AtlasGroups_UpdateDelayed) then AtlasGroups_UpdateDelayed() end
     Client_RenderOneFrame()
-    =

-    =

+
     local t_gpu_end =3D Client_GetTicks()
     local dt_cpu =3D t_gpu_start - t_cpu_start
     local dt_gpu =3D t_gpu_end   - t_gpu_start



From no-reply at zwischenwelt.org  Sat Aug  8 14:43:11 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 08 Aug 2009 12:43:11 -0000
Subject: [Iris-commit] [IRIS] r3094 - in /trunk/bin: OgreMain.dll
 Plugin_CgProgramManager.dll Plugin_ParticleFX.dll
 RenderSystem_Direct3D9.dll RenderSystem_GL.dll iris2.exe
Message-ID: <20090808124311.7F8207A980FE@simon>

Author: sience
Date: Sat Aug  8 14:43:11 2009
New Revision: 3094

Log:
-Iris2 win32 binaries updated to Ogre 1.6.3 !

Modified:
    trunk/bin/OgreMain.dll
    trunk/bin/Plugin_CgProgramManager.dll
    trunk/bin/Plugin_ParticleFX.dll
    trunk/bin/RenderSystem_Direct3D9.dll
    trunk/bin/RenderSystem_GL.dll
    trunk/bin/iris2.exe

Modified: trunk/bin/OgreMain.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/Plugin_CgProgramManager.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/Plugin_ParticleFX.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/RenderSystem_Direct3D9.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/RenderSystem_GL.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Sun Aug  9 23:21:53 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 09 Aug 2009 21:21:53 -0000
Subject: [Iris-commit] [IRIS] r3095 - in /trunk/lua: gui/gui.paperdoll.lua
 gui/gui.skill.lua net/net.login.lua
Message-ID: <20090809212153.95DB87A980F8@simon>

Author: sience
Date: Sun Aug  9 23:21:53 2009
New Revision: 3095

Log:
-bugfix for opening skill windows (before has to be a skillrequest packet)
-bugfix skillrequest where not called during login

Modified:
    trunk/lua/gui/gui.paperdoll.lua
    trunk/lua/gui/gui.skill.lua
    trunk/lua/net/net.login.lua

Modified: trunk/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.paperdoll.lua (original)
+++ trunk/lua/gui/gui.paperdoll.lua Sun Aug  9 23:21:53 2009
@@ -63,7 +63,11 @@
 			end
 		  end,
  -- skills
- [5]	=3D function (widget,mousebutton) if (mousebutton =3D=3D 1) then Togg=
leSkill() end end,
+ [5]	=3D function (widget,mousebutton)
+ 			if (mousebutton =3D=3D 1) then
+ 				ToggleSkill()
+ 		  	end
+ 		  end,
  -- guild
  [6]	=3D function (widget,mousebutton)
 			if (mousebutton =3D=3D 1) then

Modified: trunk/lua/gui/gui.skill.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.skill.lua (original)
+++ trunk/lua/gui/gui.skill.lua Sun Aug  9 23:21:53 2009
@@ -206,12 +206,17 @@
 gSkillDialog_LastPositionY =3D nil
 gSkillDialog_LastPositionScrollIndex =3D nil
 function ToggleSkill ()
+	--OSI does so; Request Skills and stats if gPlayerSkills is already nil
+	if (gPlayerSkills=3D=3Dnil) then
+		Send_ClientQuery(gRequest_Skills,GetPlayerSerial())
+	end
+
 	if (gSkillDialog) then
 		-- store current position
 		gSkillDialog_LastPositionX, gSkillDialog_LastPositionY =3D gSkillDialog.=
rootwidget.gfx:GetPos()
 		-- and close
 		gSkillDialog:Close()
-	elseif gPlayerSkills then
+	elseif (gPlayerSkills) then
 		-- scrollbar middle part hardcoded positions
 		local scrollbar_x =3D 256
 		local scrollbar_y_start =3D 74

Modified: trunk/lua/net/net.login.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.login.lua (original)
+++ trunk/lua/net/net.login.lua Sun Aug  9 23:21:53 2009
@@ -277,18 +277,16 @@
 	=

 	mobiledata.hue	=3D 0
 	local playerid =3D mobiledata.serial
-	=

-	=

+
 	gLoginConfirmPlayerSerial =3D mobiledata.serial
 	print("#########!!!!!!!!!gLoginConfirmPlayerSerial",gLoginConfirmPlayerSe=
rial)
 =

-	--Request Skills and stats
-	Send_ClientQuery(gRequest_Skills,playerid)
-
 	--Send Client ident string
-	if (gAltenatePostLoginHandling) then =

+	if (gAltenatePostLoginHandling) then
+		-- this is only for special shards =

 		InvokeLater(1000,SendLoginConfirmSpecials)
 	else
+		-- normally call this
 		SendLoginConfirmSpecials()
 	end
 	--~ Send_UpdateRangeRequest(gUpdateRange_Base)
@@ -302,7 +300,9 @@
 =

 function SendLoginConfirmSpecials ()
 	print("#########!!!!!!!!!SendLoginConfirmSpecials",gAltenatePostLoginHand=
ling,gLoginConfirmPlayerSerial)
-	if (gAltenatePostLoginHandling and gLoginConfirmPlayerSerial) then Send_C=
lientQuery(0x05,gLoginConfirmPlayerSerial,true) end
+	if (gLoginConfirmPlayerSerial) then
+		Send_ClientQuery(gRequest_Skills,gLoginConfirmPlayerSerial,true)
+	end
 	Send_ClientVersion(gClientVersion or "4.0.11c5 3D") =

 	Send_Screensize()
 	Send_ClientLanguage(gLanguage or "ENU") =

@@ -311,7 +311,7 @@
 	if (gPlayerBackPack) then Send_DoubleClick(gPlayerBackPack.serial) end
 	gSendSelfDoubleClickAtNextContainerContents =3D true
 	--~ if (gLoginConfirmPlayerSerial) then Send_DoubleClick(BitwiseOR(gLogin=
ConfirmPlayerSerial,0x80000000)) end -- 0x800... : prevents dismount, and o=
nly opens paperdoll
-	Send_ClientQuery(0x04,gLoginConfirmPlayerSerial,true)
+	Send_ClientQuery(gRequest_States,gLoginConfirmPlayerSerial,true)
 	if (gAltenatePostLoginHandling) then =

 		gNet_AlternatePostLogin_UnknownSESenderRevision =3D (gNet_AlternatePostL=
ogin_UnknownSESenderRevision or 0) + 1
 		local myrev =3D gNet_AlternatePostLogin_UnknownSESenderRevision



From no-reply at zwischenwelt.org  Tue Aug 11 19:23:35 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 11 Aug 2009 17:23:35 -0000
Subject: [Iris-commit] [IRIS] r3096 - /trunk/lua/lib.macrolist.lua
Message-ID: <20090811172335.E432A7A980FD@simon>

Author: ghoulsblade
Date: Tue Aug 11 19:23:35 2009
New Revision: 3096

Log:
small macro improvements

Modified:
    trunk/lua/lib.macrolist.lua

Modified: trunk/lua/lib.macrolist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.macrolist.lua (original)
+++ trunk/lua/lib.macrolist.lua Tue Aug 11 19:23:35 2009
@@ -136,6 +136,11 @@
     for skillid,name in pairs(glSkillNames) do
         if skillname =3D=3D name then return gPlayerSkills and gPlayerSkil=
ls[skillid] and gPlayerSkills[skillid][partname] end
     end
+end
+function MacroRead_SkillBaseSum () =

+	local c =3D 0
+	for skillid,name in pairs(glSkillNames) do c =3D c + MacroRead_SkillBase(=
name) end
+	return c
 end
 function MacroRead_SkillBase			(skillname) return (MacroRead_SkillDataPart=
(skillname,"base_value") or -1)  * 0.1 end =

 function MacroRead_SkillCap				(skillname) return (MacroRead_SkillDataPart=
(skillname,"skill_cap") or -1)  * 0.1 end =

@@ -195,6 +200,7 @@
 	if (not serial) then return end
 	if (type(serial) ~=3D "number") then return end
     local timeout_endt =3D Client_GetTicks() + (timeout or 1000)
+	ClosePopUpMenu() -- close old
     Send_PopupRequest(serial)
     RegisterListener("Hook_OpenPopupMenu",function (popupmenu)
         if (popupmenu.serial =3D=3D serial or Client_GetTicks() < timeout_=
endt) then =

@@ -332,7 +338,7 @@
         end) =

 end
 =

--- method:  nil=3Drecall "gate"=3Dgate "chivalry"=3Dsacred-journey "use"=
=3Drunebookcharge =

+-- method:  nil=3Drecall "gate"=3Dgate "chivalry"=3Dsacred-journey "use"=
=3Drunebookcharge  "default":set as runebook default
 function MacroCmd_UseRuneBookPostAOS (runebookid,runeidx,method,timeout) -=
- for post-aos (vetus-mundus)   runeidx:0-15      =

     Send_DoubleClick(runebookid)
     MacroCmd_NextGumpContaining("Charges",timeout or 1000,function (dialog=
) =

@@ -345,6 +351,8 @@
                     dialog:SendClick((side =3D=3D 0) and 140 or 300,160) -=
- gate travel
                 elseif (method =3D=3D "chivalry") then
                     dialog:SendClick((side =3D=3D 0) and 140 or 300,180) -=
- chivalry : sacred journey
+                elseif (method =3D=3D "default") then
+                    dialog:SendClick((side =3D=3D 0) and 165 or 305,25) --=
 recall
                 else    =

                     dialog:SendClick((side =3D=3D 0) and 140 or 300,145) -=
- recall
                 end
@@ -485,7 +493,7 @@
 	end
 end
 =

-function MacroCmd_EquipItem (serial)
+function MacroCmd_EquipItem (serial,bOkIfNotInBackPack)
     if (type(serial) =3D=3D "table") then =

         local cmd,param =3D unpack(serial)
         if (cmd =3D=3D "use") then Send_DoubleClick(param) end =

@@ -495,8 +503,9 @@
     if (not item) then item =3D MacroCmd_Item_FindFirstByArtID(serial) end
     if (not item) then return end
     if (item.iContainerSerial =3D=3D GetPlayerSerial()) then return end --=
 already equipped
-    if (item.iContainerSerial ~=3D GetPlayerBackPackSerial()) then return =
end -- not in backpack, other char?
+    if (item.iContainerSerial ~=3D GetPlayerBackPackSerial() and (not bOkI=
fNotInBackPack)) then return end -- not in backpack, other char?
     local layer =3D GetPaperdollLayerFromTileType(item.artid)
+	if (not layer) then return end -- unknown layer
 	if (MacroCmd_GetPlayerEquipment(layer)) then return end -- something else=
 already equipped there
     print("MacroCmd_EquipItem",serial,item.amount,layer)
     Send_Take_Object(item.serial,item.amount)
@@ -985,13 +994,17 @@
 function MacroCmd_PathFindTo	(xloc,yloc,tolerance,timeout,bNoLog)
 	tolerance =3D tolerance or 0
 	local bLog =3D not bNoLog
-	if (GetUODistToPlayer(xloc,yloc) <=3D tolerance) then return true end -- =
already there
+	if (bLog) then print("MacroCmd_PathFindTo : start",xloc,yloc,tolerance,ti=
meout) end
+	if (GetUODistToPlayer(xloc,yloc) <=3D tolerance) then =

+		if (bLog) then print("MacroCmd_PathFindTo : already there") end
+		return true =

+	end
+	local iJobWaitInterval =3D 50
 	timeout =3D timeout or 0
 	local endt =3D (timeout > 0) and (Client_GetTicks() + timeout)
 	repeat -- repeat the pathfinding calc every few seconds in case dynamics =
show up
 		local t =3D Client_GetTicks()
-		local iJobWaitInterval =3D 50
-		local res =3D cPathFind2:CalcRouteFromPlayerToPos(xloc,yloc,tolerance,iJ=
obWaitInterval) =

+		local res =3D cPathFind2:CalcRouteFromPlayerToPos(xloc,yloc,tolerance,iJ=
obWaitInterval,endt and (endt-t)) =

 		local t2 =3D Client_GetTicks()
 		local nextstept =3D t2 + 1000
 		local dt =3D t2-t



From no-reply at zwischenwelt.org  Tue Aug 11 19:24:40 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 11 Aug 2009 17:24:40 -0000
Subject: [Iris-commit] [IRIS] r3097 - /trunk/lua/lib.pathfind.lua
Message-ID: <20090811172440.818A57A980FD@simon>

Author: ghoulsblade
Date: Tue Aug 11 19:24:40 2009
New Revision: 3097

Log:
small pathfinding improvements

Modified:
    trunk/lua/lib.pathfind.lua

Modified: trunk/lua/lib.pathfind.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.pathfind.lua (original)
+++ trunk/lua/lib.pathfind.lua Tue Aug 11 19:24:40 2009
@@ -3,9 +3,9 @@
 cPathFind2 =3D {}
 kPathFind2_MaxSteps =3D 4000
 =

-function cPathFind2:CalcRouteFromPlayerToPos (xloc,yloc,tolerance,iJobWait=
Interval) =

+function cPathFind2:CalcRouteFromPlayerToPos (xloc,yloc,tolerance,iJobWait=
Interval,iTimeOut) =

 	local xloc0,yloc0,zloc0 =3D GetPlayerPos()
-	return self:CalcRouteFromPosToPos(xloc0,yloc0,zloc0,GetPlayerDir(),xloc,y=
loc,tolerance,WalkGetInterval(true),gWalkTimeout_DirectionChange,iJobWaitIn=
terval)
+	return self:CalcRouteFromPosToPos(xloc0,yloc0,zloc0,GetPlayerDir(),xloc,y=
loc,tolerance,WalkGetInterval(true),gWalkTimeout_DirectionChange,iJobWaitIn=
terval,iTimeOut)
 end
 =

 -- returns an array with {pos1,pos2,pos3,...} where each pos =3D {xloc,ylo=
c,zloc,and,some,data,vars...}
@@ -23,7 +23,7 @@
 	return res
 end
 =

-function cPathFind2:CalcRouteFromPosToPos (xloc0,yloc0,zloc0,dir0,xloc1,yl=
oc1,tolerance,walktime,turntime,iJobWaitInterval)
+function cPathFind2:CalcRouteFromPosToPos (xloc0,yloc0,zloc0,dir0,xloc1,yl=
oc1,tolerance,walktime,turntime,iJobWaitInterval,iTimeOut)
 	tolerance =3D tolerance or 0
 	walktime =3D walktime or WalkGetInterval(true) -- defaults to current pla=
yer run speed
 	turntime =3D turntime or gWalkTimeout_DirectionChange
@@ -32,7 +32,9 @@
 	self:PushPos(xloc0,yloc0,zloc0,DirWrap(dir0),0,GetUODistToPos(xloc0,yloc0=
,xloc1,yloc1))
 	local isteps =3D 0
 	local next_wait_t =3D iJobWaitInterval and (Client_GetTicks() + iJobWaitI=
nterval)
+	local endt =3D iTimeOut and (Client_GetTicks() + iTimeOut)
 	while true do
+		if (iTimeOut and Client_GetTicks() > endt) then return end
 		if (next_wait_t) then
 			local t =3D Client_GetTicks()
 			if (t > next_wait_t) then next_wait_t =3D t + iJobWaitInterval job.wait=
(1) end



From no-reply at zwischenwelt.org  Tue Aug 11 19:25:43 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 11 Aug 2009 17:25:43 -0000
Subject: [Iris-commit] [IRIS] r3098 -
	/trunk/lua/widgets/widget.gumpdialog.lua
Message-ID: <20090811172543.1124B7A980FD@simon>

Author: ghoulsblade
Date: Tue Aug 11 19:25:42 2009
New Revision: 3098

Log:
small gump api improvement

Modified:
    trunk/lua/widgets/widget.gumpdialog.lua

Modified: trunk/lua/widgets/widget.gumpdialog.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/widgets/widget.gumpdialog.lua (original)
+++ trunk/lua/widgets/widget.gumpdialog.lua Tue Aug 11 19:25:42 2009
@@ -88,6 +88,28 @@
 		end
 	end
 end
+
+function gWidgetPrototype.GumpDialog:SearchI	(search)
+	search =3D string.lower(search)
+	for k,text in pairs(self:ListTexts()) do if (StringContains(string.lower(=
text),search)) then return text end end
+end
+function gWidgetPrototype.GumpDialog:ListTexts		(search)
+	local res =3D {}
+	local gumpdata =3D self.Gumpdata
+	if (not gumpdata) then return end
+	=

+	if (gumpdata.Data) then table.insert(res,gumpdata.Data) end =

+	if (gumpdata.textline) then =

+		for k,line in pairs(gumpdata.textline) do table.insert(res,line) end
+	end
+	if (gClilocLoader) then
+		for cliloc_id,v in pairs(self.usedClilocs) do
+			table.insert(res,gClilocLoader:Get(cliloc_id))
+		end
+	end
+	return res
+end
+
 function gWidgetPrototype.GumpDialog:GetCtrlByName	(name) return self.cont=
rols[name] end -- see gumpparser
 =

 function gWidgetPrototype.GumpDialog:GetDialog	() return self end -- overr=
ide, normaly parent:GetDialog(), so this ends recursion



From no-reply at zwischenwelt.org  Tue Aug 11 19:26:34 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 11 Aug 2009 17:26:34 -0000
Subject: [Iris-commit] [IRIS] r3099 - /trunk/lua/lib.uoids.lua
Message-ID: <20090811172634.DABFE7A980FD@simon>

Author: ghoulsblade
Date: Tue Aug 11 19:26:33 2009
New Revision: 3099

Log:
uoids : made facet constants enumerable

Modified:
    trunk/lua/lib.uoids.lua

Modified: trunk/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoids.lua (original)
+++ trunk/lua/lib.uoids.lua Tue Aug 11 19:26:33 2009
@@ -224,11 +224,15 @@
 	[gLayerType.kLayer_Bracelet	] =3D {14,95 + 23*4},
 }
 =

-kMapIndex_Felucca	=3D 0
-kMapIndex_Trammel	=3D 1
-kMapIndex_Ilshenar	=3D 2
-kMapIndex_Malas		=3D 3
-kMapIndex_Tokuno	=3D 4
+kMapIndex =3D {}
+kMapIndex.Felucca	=3D 0
+kMapIndex.Trammel	=3D 1
+kMapIndex.Ilshenar	=3D 2
+kMapIndex.Malas		=3D 3
+kMapIndex.Tokuno	=3D 4
+kMapNameByIndex =3D {} for k,v in pairs(kMapIndex) do kMapNameByIndex[v] =
=3D k end
+
+
 =

 -- Tiledata Flags
 kTileDataFlag_Background		=3D hex2num("0x00000001")



From no-reply at zwischenwelt.org  Tue Aug 11 19:27:35 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 11 Aug 2009 17:27:35 -0000
Subject: [Iris-commit] [IRIS] r3100 - /trunk/lua/lib.mainmenu.accountlist.lua
Message-ID: <20090811172736.058507A980FD@simon>

Author: ghoulsblade
Date: Tue Aug 11 19:27:35 2009
New Revision: 3100

Log:
facet constants

Modified:
    trunk/lua/lib.mainmenu.accountlist.lua

Modified: trunk/lua/lib.mainmenu.accountlist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.accountlist.lua (original)
+++ trunk/lua/lib.mainmenu.accountlist.lua Tue Aug 11 19:27:35 2009
@@ -83,11 +83,11 @@
 					local placename =3D "unknown"
 					=

 					local mymap =3D chardata.map or 1
-					if (mymap =3D=3D kMapIndex_Felucca	) then placename =3D "felucca" end
-					if (mymap =3D=3D kMapIndex_Trammel	) then placename =3D "trammel" end
-					if (mymap =3D=3D kMapIndex_Ilshenar	) then placename =3D "ilshenar" e=
nd
-					if (mymap =3D=3D kMapIndex_Malas	) then placename =3D "malas" end
-					if (mymap =3D=3D kMapIndex_Tokuno	) then placename =3D "tokuno" end
+					if (mymap =3D=3D kMapIndex.Felucca	) then placename =3D "felucca" end
+					if (mymap =3D=3D kMapIndex.Trammel	) then placename =3D "trammel" end
+					if (mymap =3D=3D kMapIndex.Ilshenar	) then placename =3D "ilshenar" e=
nd
+					if (mymap =3D=3D kMapIndex.Malas	) then placename =3D "malas" end
+					if (mymap =3D=3D kMapIndex.Tokuno	) then placename =3D "tokuno" end
 					if (mymap =3D=3D 0) then mymap =3D 1 end -- same places on fellu as o=
n tram
 					for k,v in pairs(places) do =

 						local map,xloc,yloc,radius =3D unpack(v)



From no-reply at zwischenwelt.org  Fri Aug 14 23:16:48 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 14 Aug 2009 21:16:48 -0000
Subject: [Iris-commit] [IRIS] r3101 - /trunk/installdeps.ubuntu.sh
Message-ID: <20090814211649.024667A980FE@simon>

Author: ghoulsblade
Date: Fri Aug 14 23:16:47 2009
New Revision: 3101

Log:
added ogre compile dependencies

Modified:
    trunk/installdeps.ubuntu.sh

Modified: trunk/installdeps.ubuntu.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/installdeps.ubuntu.sh (original)
+++ trunk/installdeps.ubuntu.sh Fri Aug 14 23:16:47 2009
@@ -1,6 +1,7 @@
 #!/bin/bash
 # old :  libogre14 libogre-dev  (dependencies might still be needed? )
-DEPS=3D"libboost-thread1.37-dev nvidia-cg-toolkit libwxbase2.8-dev libwxgt=
k2.8-dev wx2.8-headers ccache liblua50-dev liblualib50-dev libalut-dev libo=
penal-dev libvorbisfile3 libvorbis-dev libogg-dev libois-dev g++ gcc"
+OGREDEPS=3D"automake libtool libzzip-dev libxt-dev libx11-dev libxaw7-dev =
libxxf86vm-dev libxrandr-dev libfreeimage-dev libfreetype6-dev libglut3-dev"
+DEPS=3D"$OGREDEPS libboost-thread1.37-dev nvidia-cg-toolkit libwxbase2.8-d=
ev libwxgtk2.8-dev wx2.8-headers ccache liblua50-dev liblualib50-dev libalu=
t-dev libopenal-dev libvorbisfile3 libvorbis-dev libogg-dev libois-dev g++ =
gcc"
 echo "libboost-dev included in libboost-thread1.37-dev ?"
 echo apt-get install $DEPS
 sudo apt-get install $DEPS
@@ -9,7 +10,6 @@
 echo you can download fmod ex 4.* stable for linux from http://www.fmod.or=
g/index.php/download
 echo please install the 32 bit version of fmod, even if you have a 64 bit =
system, our buildscript wont be able to find it otherwise
 echo ------------------------------
-
 echo iris 2 uses ogre1.6 now, there is no package for that yet, so you wil=
l need to compile that from source
 echo to do that, download the source from =

 echo http://downloads.sourceforge.net/ogre/ogre-v1-6-0.tar.bz2?use_mirror=
=3D



From no-reply at zwischenwelt.org  Sat Aug 15 17:09:29 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Aug 2009 15:09:29 -0000
Subject: [Iris-commit] [IRIS] r3102 - in /trunk: lua/lib.2d.mobile.lua
 lua/lib.granny.loader.lua lua/lib.null.renderer.lua lua/lib.uodragdrop.lua
 lua/net/net.trade.lua lua/obj/obj.container.lua plugins/itemcounter.lua
 plugins/moblist.lua
Message-ID: <20090815150929.42B5B7A980FE@simon>

Author: ghoulsblade
Date: Sat Aug 15 17:09:28 2009
New Revision: 3102

Log:
small improvements :moblist shortcut, itemcouter baglist, 2d:workaround for=
 elven models, nullrenderer walk and containers

Modified:
    trunk/lua/lib.2d.mobile.lua
    trunk/lua/lib.granny.loader.lua
    trunk/lua/lib.null.renderer.lua
    trunk/lua/lib.uodragdrop.lua
    trunk/lua/net/net.trade.lua
    trunk/lua/obj/obj.container.lua
    trunk/plugins/itemcounter.lua
    trunk/plugins/moblist.lua

Modified: trunk/lua/lib.2d.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.2d.mobile.lua (original)
+++ trunk/lua/lib.2d.mobile.lua Sat Aug 15 17:09:28 2009
@@ -144,13 +144,17 @@
 	=

 	local main_spritearr =3D mobile.r2d_main_spritearr
 	if (not main_spritearr) then main_spritearr =3D {} mobile.r2d_main_sprite=
arr =3D main_spritearr end
-	if (mobile.artid ~=3D 402 and
-		mobile.artid ~=3D 403) then table.insert(parts,{mobile.artid,mobile.hue,=
13,main_spritearr}) end -- fallback=3D13=3Devortex  402=3Dghost
+	if (mobile.artid =3D=3D 605) then mobile.artid =3D 400 end -- elf
+	if (mobile.artid =3D=3D 606) then mobile.artid =3D 401 end
+	if (mobile.artid =3D=3D 607) then mobile.artid =3D 402 end -- elf ghost
+	if (mobile.artid =3D=3D 608) then mobile.artid =3D 403 end
+	local bIsGhost =3D mobile.artid =3D=3D 402 or mobile.artid =3D=3D 403
+	if (not bIsGhost) then table.insert(parts,{mobile.artid,mobile.hue,13,mai=
n_spritearr}) end -- fallback=3D13=3Devortex  402=3Dghost
 	=

 	=

 	--~ print("######### mobart",mobile.artid)
 	gProfiler_R2D_MobileStep:Section("UpdateMobileGfx:human")
-	if (self:MobileHasVisibleEquip(mobile.artid) and (not bSimpleMob)) then -=
- only humans have equip
+	if (self:MobileHasVisibleEquip(mobile.artid) and ((not bSimpleMob) or bIs=
Ghost)) then -- only humans have equip
 		for index,layer in pairs(gLayerOrderByDir[DirWrap(mobile.dir)]) do =

 			local item =3D GetMobileEquipmentItem(mobile,layer)
 			if (item) then =


Modified: trunk/lua/lib.granny.loader.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.loader.lua (original)
+++ trunk/lua/lib.granny.loader.lua Sat Aug 15 17:09:28 2009
@@ -540,6 +540,29 @@
 	--~ print("cGrannyFile:Visit",name,...) =

 end =

 =

+--[[
+		--~ case 0XCA5E0601: StartSubMesh(); break;
+	=

+	VisitTextChunk:mTextChunks
+	VisitObj:mParamGroups start
+	VisitObjKey:miLastKey
+	VisitObjValue:mParamGroups (miLastKey,val)
+	=

+	// main params are in mParamGroups and mTextChunks[1]
+	if (mTextChunks.size() >=3D 2) {
+		for (int i=3D0;i<mParamGroups.size();++i) {
+			for (int j=3D0;j<mParamGroups[i].size();++j) {
+				uint32 key		=3D mParamGroups[i][j].first;
+				uint32 value	=3D mParamGroups[i][j].second;
+				if (key < mTextChunks[1].size() && value < mTextChunks[1].size()) {
+					mMainParams[i][mTextChunks[1][key] ] =3D strtolower(mTextChunks[1][va=
lue]);
+				}
+			}
+		}
+	}
+]]--	=

+		=

+		=

 --~ cGrannyFile:LoadFile    /cavern/uoml/Models/Monsters/Changling_idle.gr=
n			DEBUG[granny]   WARNING ! granny 0xCA5E0303 : size1=3D%d size2=3D%d 224=
28   12 =

 --~ cGrannyFile:LoadFile    /cavern/uoml/Models/Monsters/Denkou_Yajuu_Pill=
age.grn	DEBUG[granny]   WARNING ! granny 0xCA5E0303 : size1=3D%d size2=3D%d=
 6244    12                       =

 --~ cGrannyFile:LoadFile    /cavern/uoml/Models/Monsters/Devourer_Attack2.=
grn		DEBUG[granny]   WARNING ! granny 0xCA5E0303 : size1=3D%d size2=3D%d 26=
4     12 =


Modified: trunk/lua/lib.null.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.null.renderer.lua (original)
+++ trunk/lua/lib.null.renderer.lua Sat Aug 15 17:09:28 2009
@@ -67,3 +67,5 @@
 function RendererNull:AddEffect						() end
 function RendererNull:HUDFX_AddRisingTextOnMob		() end
 function RendererNull:NotifyDamage		() end =

+function RendererNull:SetLastRequestedUOPos		() end =

+function RendererNull:SetLastConfirmedUOPos		() end =


Modified: trunk/lua/lib.uodragdrop.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uodragdrop.lua (original)
+++ trunk/lua/lib.uodragdrop.lua Sat Aug 15 17:09:28 2009
@@ -197,6 +197,7 @@
 -- SiENcE: just skip Multis here
 -- Todo: Multi support
 function PrepareDragDynamic (dynamic)
+	--~ if dynamic.artid >=3D gMulti_ID then dynamic.artid =3D 0xeef end -- v=
m hausklau bug
 	if dynamic.artid < gMulti_ID then
 		local iArtID =3D dynamic.artid + 0x4000
 		local matname =3D GetArtMat(iArtID,dynamic.hue)

Modified: trunk/lua/net/net.trade.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.trade.lua (original)
+++ trunk/lua/net/net.trade.lua Sat Aug 15 17:09:28 2009
@@ -242,10 +242,12 @@
 			local nameint =3D tonumber(good.name)
 			if (nameint and good.name =3D=3D ""..nameint) then good.name =3D gClilo=
cLoader:Get(nameint) or ("unknown_cliloc_"..nameint) end
 			=

+			print("shopitem",hex(good.item.artid),good.name) =

 			--~ if (not knownartids[good.item.artid]) then print("shopitem",good.it=
em.artid,good.name) knownartids[good.item.artid] =3D true end
 			local bBlendout =3D false =

 			for k,v in pairs(gShopBlendoutGroups) do =

-				if (good.item and in_array(good.item.artid,gShopBlendoutGroupArtIds[k]=
)) then bBlendout =3D true end =

+				local blendoutlist =3D (type(v) =3D=3D "table") and v or gShopBlendout=
GroupArtIds[k]
+				if (good.item and in_array(good.item.artid,blendoutlist)) then bBlendo=
ut =3D true end =

 			end			=

 			=

 			if (not bBlendout) then shop.goods[i] =3D good end

Modified: trunk/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.container.lua (original)
+++ trunk/lua/obj/obj.container.lua Sat Aug 15 17:09:28 2009
@@ -75,7 +75,11 @@
 =

 -- called from kPacket_Open_Container
 function HandleOpenContainer	(containerdata)
-	if (not gGumpLoader) then return end
+	if (not gGumpLoader) then =

+		local container =3D GetOrCreateContainer(containerdata.serial)
+		container.bIsOpen =3D true
+		return =

+	end
 	--~ print("HandleOpenContainer",SmartDump(containerdata))
 	=

 	--Ignore Shop container - created somewhere else
@@ -131,8 +135,10 @@
 =

 function CloseContainer (serial) =

 	local container =3D GetContainer(serial)
+	if (container) then
+		container.bIsOpen =3D false
+	end
 	if (container and container.dialog) then
-		container.bIsOpen =3D false
 		NotifyListener("Hook_CloseContainer",container.dialog,serial)
 		container.dialog:Destroy()
 		container.dialog =3D nil

Modified: trunk/plugins/itemcounter.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/plugins/itemcounter.lua (original)
+++ trunk/plugins/itemcounter.lua Sat Aug 15 17:09:28 2009
@@ -69,7 +69,7 @@
 =

 function ItemCounterOne (artid,baglist) =

 	local c =3D MacroCmd_Item_SumByArtID(artid) =

-	for k,bag in pairs(baglist or {}) do c =3D c + MacroCmd_Item_SumByArtID(a=
rtid,nil,bag) end
+	for k,bag in pairs(baglist or ItemCounterGetBagList() or {}) do c =3D c +=
 MacroCmd_Item_SumByArtID(artid,nil,bag) end
 	return c
 end
 =

@@ -80,6 +80,8 @@
 RegisterStepper(function () if (gItemCounterNeedsUpdate) then ItemCounterU=
pdate() end end)
 -- item:IsInContainer(GetPlayerBackPackSerial())
 =

+function ItemCounterGetBagList () return MacroCmd_Item_FindByArtID(kItemCo=
unterBagType) end
+
 function ItemCounterUpdate ()
 	if (not gInGameStarted) then return end
 	if (gNoOgre) then return end
@@ -91,7 +93,7 @@
 	gItemCounterDialog:Clear()
 	=

 	-- items
-	local baglist =3D MacroCmd_Item_FindByArtID(kItemCounterBagType)
+	local baglist =3D ItemCounterGetBagList()
 	=

 	for k,group in pairs(gItemCounterTypeGroups) do =

 		local bGroupVisible =3D false

Modified: trunk/plugins/moblist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/plugins/moblist.lua (original)
+++ trunk/plugins/moblist.lua Sat Aug 15 17:09:28 2009
@@ -21,6 +21,7 @@
 	["[TINK]"]			=3D " the tinker",
 	["[CARP]"]			=3D " the carpenter",
 	["[ARCH]"]			=3D " the architect",
+	["[BOW]"]			=3D " the bowyer",
 	["[ESTA]"]			=3D " the real estate broker",
 	["[HAIR]"]			=3D " the hairstylist",
 	["[PROV]"]			=3D " the provisioner",



From no-reply at zwischenwelt.org  Sat Aug 15 17:32:31 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Aug 2009 15:32:31 -0000
Subject: [Iris-commit] [IRIS] r3103 - /trunk/lua/gui/gui.helper.lua
Message-ID: <20090815153231.6CFC37A980FE@simon>

Author: ghoulsblade
Date: Sat Aug 15 17:32:30 2009
New Revision: 3103

Log:
small fix if Client_GetMemoryUsage is undefined

Modified:
    trunk/lua/gui/gui.helper.lua

Modified: trunk/lua/gui/gui.helper.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.helper.lua (original)
+++ trunk/lua/gui/gui.helper.lua Sat Aug 15 17:32:30 2009
@@ -93,7 +93,7 @@
 			fps, t, b, =

 			DisplayMemoryUsageFormatHelper(memoryusage),
 			DisplayMemoryUsageFormatHelper(mem_dyn), =

-			DisplayMemoryUsageFormatHelper(Client_GetMemoryUsage()), =

+			DisplayMemoryUsageFormatHelper(Client_GetMemoryUsage and Client_GetMemo=
ryUsage() or 0), =

 			floor((gFrameTimeCPUFraction or 0)*100),
 			j, l, lu   -- #"job.create()-jobs"    blockloader: working/killme
 		)



From no-reply at zwischenwelt.org  Sat Aug 22 19:23:54 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 22 Aug 2009 17:23:54 -0000
Subject: [Iris-commit] [IRIS] r3104 - in /trunk: bin/iris2.exe
 lua/lib.3d.renderer.lua lua/lib.loading.lua lua/lib.test.lua
 lua/lib.unifont.lua lua/net/net.multi.lua lua/profiles/gfx_ultrahigh.lua
 src/data_font.cpp src/data_font_L.cpp vc9/iris.vcproj
Message-ID: <20090822172354.C2EB17A9810A@simon>

Author: sience
Date: Sat Aug 22 19:23:54 2009
New Revision: 3104

Log:
-old fontsystem outcommented
-added new files from lugre to VC9 project files
-activated Caelum & Watershader in UltraHigh Profile
-added comment to net.multi.lua
-new win32 binary

Modified:
    trunk/bin/iris2.exe
    trunk/lua/lib.3d.renderer.lua
    trunk/lua/lib.loading.lua
    trunk/lua/lib.test.lua
    trunk/lua/lib.unifont.lua
    trunk/lua/net/net.multi.lua
    trunk/lua/profiles/gfx_ultrahigh.lua
    trunk/src/data_font.cpp
    trunk/src/data_font_L.cpp
    trunk/vc9/iris.vcproj

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.renderer.lua (original)
+++ trunk/lua/lib.3d.renderer.lua Sat Aug 22 19:23:54 2009
@@ -317,6 +317,7 @@
 =

 function Renderer3D:SetupShadows (strShadowTechnique)
     local shadowfardist=3D5*cMapBlock_3D_Terrain.iLoadRadius+gFogValue
+    print("setShadowFarDistance =3D " .. shadowfardist)
 =

     if ((strShadowTechnique =3D=3D "stencil_modulative") or (strShadowTech=
nique =3D=3D "stencil_additive")) then
         ----- currently doesn't work with Fastbatch

Modified: trunk/lua/lib.loading.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.loading.lua (original)
+++ trunk/lua/lib.loading.lua Sat Aug 22 19:23:54 2009
@@ -10,12 +10,12 @@
 gLoadingProfileLastAction =3D false
 =

 -- store global uni font infos
-gUniFontHeight =3D {}
-gUniFontName =3D {}
+--gUniFontHeight =3D {}
+--gUniFontName =3D {}
 gUniFontLoaderList =3D {}
 =

 -- which uni font chat should be used in chat over the head
-gChatText_UniFontNumber =3D 1
+--gChatText_UniFontNumber =3D 1
 =

 -- profiles the time took by the different loading phases, and displays a =
text about what is currently being loaded
 function LoadingProfile (sCurAction,bIsPreOgre)
@@ -75,6 +75,8 @@
     end
 end
 =

+--[[
+-- deprecated, old guisystem, doesn't support unicode well, see lib.unifon=
t.lua for an alternative
 -- create a ogre font from a uo unifont file
 -- name =3D resourcename
 -- filename =3D unifont filename
@@ -87,6 +89,7 @@
     end
     return 0
 end
+]]--
 =

 function CreateUniFontLoaderIfFileExists(filename)
     if not file_exists(filename) then return end
@@ -101,7 +104,8 @@
         gUniFontLoaderList[0] =3D CreateUniFontLoaderIfFileExists(CorrectP=
ath(Addfilepath(gUnifontFile))) -- unifont.mul
         for i=3D1,6 do gUniFontLoaderList[i] =3D CreateUniFontLoaderIfFile=
Exists(CorrectPath(Addfilepath(gUnifonts..i..".mul"))) end -- unifont1.mul =
 - 6
     end
-    =

+--[[
+    -- deprecated, old guisystem, doesn't support unicode well, see lib.un=
ifont.lua for an alternative
     if (gGenerateOldUnifontTextures) then
         LoadingProfile("generate old font textures")
         CreateUniFontTexture(gUniFontLoaderList,"font_unifont0")
@@ -110,6 +114,7 @@
             gUniFontHeight[i] =3D CreateUniFontTexture(gUniFontLoaderList[=
i],gUniFontName[i])
         end
     end
+]]--
 end
 =

 function Load_Cliloc ()

Modified: trunk/lua/lib.test.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.test.lua (original)
+++ trunk/lua/lib.test.lua Sat Aug 22 19:23:54 2009
@@ -432,6 +432,8 @@
 	Crash()
 end
 =

+--[[
+--deprecated, old guisystem, doesn't support unicode well, see lib.unifont=
.lua for an alternative
 function TestUniFontLoader()
 	print(CreateUniFontLoader)
 	l =3D CreateUniFontLoader(CorrectPath( Addfilepath(gUnifonts.."2.mul") ))
@@ -441,6 +443,7 @@
 	l:Destroy()
 	Crash()
 end
+]]--
 =

 function StartMeshLoaderTest ()
 	if (gDialog_IrisLogo) then gDialog_IrisLogo:SetVisible(false) end

Modified: trunk/lua/lib.unifont.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.unifont.lua (original)
+++ trunk/lua/lib.unifont.lua Sat Aug 22 19:23:54 2009
@@ -1,50 +1,12 @@
--- handles uo unicode fonts textureatlas =

--- see also lugre/lib.gui.flow.lua
--- todo : use lib.atlasgroup.lua here ?
+--[[ ***** see Iris2 COPYING for license info ***** ]]--
+--[[ \brief
+        handles uo unicode fonts textureatlas
+        see also lugre/lib.gui.flow.lua
+        todo : use lib.atlasgroup.lua here ?
+]]--
 =

 gUniFontTexAtlasSize =3D 512
 gUniFontLastTextureAtlas =3D nil
-
---~ gUniFontLoaderList[0] =3D unifont.mul
---~ gUniFontLoaderList[i] =3D unifont(1-6).mul
-
---[[
-	-- texatlas
-	local w =3D 1024
-	local iArtMapIDList =3D {65,129,321,449,513}
-	local sFilePath =3D "mytexatlas.png"
-	local sFileNameOrPath =3D "art_fallback.png"
-	local pTexAtlas =3D CreateTexAtlas(w,w)
-	local img =3D CreateImage()
-	for k,id in pairs(iArtMapIDList) do
-		local iArtMapID =3D hex2num("0x00004000") + id
-		if (gArtMapLoader:ExportToImage(img,iArtMapID)) then
-			local b =3D 4
-			local img2 =3D ImageScale(img,64-b-b,64-b-b)
-			local bSuccess,l,r,t,b =3D pTexAtlas:AddImage(img2)
-			img2:Destroy()
-		end
-	end
-	--~ local sTexName =3D	pTexAtlas:MakeTexture()
-	pTexAtlas:MakeImage(img)
-	img:SaveAsFile(sFilePath)
-	pTexAtlas:Destroy()
-	img:Destroy()
-	=

-	=

-	-- spritelist
-	local spritelist =3D CreateSpriteList(GetGUILayer_Dialogs(),false,true)
-	spritelist.asgroup =3D spritelist:CastToRenderGroup2D()
-	spritelist.asgroup:SetClip(24,4,122,22)
-	spritelist:SetMaterial(GetPlainTextureMat("guibase.png"))
-	spritelist:ResizeList(1)
-	print("--SpriteList_Open")
-	SpriteList_Open(spritelist)
-	local iSpriteIndex, l,t,w,h, u0,v0, uvw, uvh, z, r,g,b,a =3D 0, 0,0,32*4,=
32*4, 0,0, 1,1, 0,  1,0,0,0
-	--~ SpriteList_SetSprite(iSpriteIndex, l,t,w,h, u0,v0, uvw, uvh, z)
-	SpriteList_SetSpriteEx(iSpriteIndex, l,t,w,h, u0,v0, uvw,0, 0,uvh, z, r,g=
,b,a)
-	SpriteList_Close()
-]]--
 =

 function UniFont_AtlasUpdate ()
 	if (not gUniFontLastTextureAtlas.bDirty) then return end
@@ -174,4 +136,43 @@
 	return myfont
 end
 =

+--~ gUniFontLoaderList[0] =3D unifont.mul
+--~ gUniFontLoaderList[i] =3D unifont(1-6).mul
 =

+--[[
+	-- texatlas
+	local w =3D 1024
+	local iArtMapIDList =3D {65,129,321,449,513}
+	local sFilePath =3D "mytexatlas.png"
+	local sFileNameOrPath =3D "art_fallback.png"
+	local pTexAtlas =3D CreateTexAtlas(w,w)
+	local img =3D CreateImage()
+	for k,id in pairs(iArtMapIDList) do
+		local iArtMapID =3D hex2num("0x00004000") + id
+		if (gArtMapLoader:ExportToImage(img,iArtMapID)) then
+			local b =3D 4
+			local img2 =3D ImageScale(img,64-b-b,64-b-b)
+			local bSuccess,l,r,t,b =3D pTexAtlas:AddImage(img2)
+			img2:Destroy()
+		end
+	end
+	--~ local sTexName =3D	pTexAtlas:MakeTexture()
+	pTexAtlas:MakeImage(img)
+	img:SaveAsFile(sFilePath)
+	pTexAtlas:Destroy()
+	img:Destroy()
+	=

+	=

+	-- spritelist
+	local spritelist =3D CreateSpriteList(GetGUILayer_Dialogs(),false,true)
+	spritelist.asgroup =3D spritelist:CastToRenderGroup2D()
+	spritelist.asgroup:SetClip(24,4,122,22)
+	spritelist:SetMaterial(GetPlainTextureMat("guibase.png"))
+	spritelist:ResizeList(1)
+	print("--SpriteList_Open")
+	SpriteList_Open(spritelist)
+	local iSpriteIndex, l,t,w,h, u0,v0, uvw, uvh, z, r,g,b,a =3D 0, 0,0,32*4,=
32*4, 0,0, 1,1, 0,  1,0,0,0
+	--~ SpriteList_SetSprite(iSpriteIndex, l,t,w,h, u0,v0, uvw, uvh, z)
+	SpriteList_SetSpriteEx(iSpriteIndex, l,t,w,h, u0,v0, uvw,0, 0,uvh, z, r,g=
,b,a)
+	SpriteList_Close()
+]]--

Modified: trunk/lua/net/net.multi.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.multi.lua (original)
+++ trunk/lua/net/net.multi.lua Sat Aug 22 19:23:54 2009
@@ -53,7 +53,7 @@
 	local id =3D input:PopNetUint8()
 	local iPacketSize =3D input:PopNetUint16()
 	local compresstype =3D input:PopNetUint8()	-- (0=3Dnothing, 3=3Dzlib)
-	local unknown1 =3D input:PopNetUint8()
+	local unknown1 =3D input:PopNetUint8()	--Enable Response (0x01 =3D yes, 0=
x00 =3D no)
 	local customhouseserial =3D input:PopNetUint32()
 	local customhouserevision =3D input:PopNetUint32()
 	local tilecount =3D input:PopNetUint16()	--components.size()
@@ -99,11 +99,13 @@
 				local planetype =3D BitwiseAND(planeid,0x20)
 				=

 				-- calculate planeid
-				if planetype =3D=3D 0x20 then planeid =3D BitwiseXOR(planeid,0x20) =

-				else planeid =3D planeid - 9 end
+				if ( planetype =3D=3D 0x20 ) then
+					planeid =3D BitwiseXOR(planeid,0x20) =

+				else
+					planeid =3D planeid - 9
+				end
 							=

 				local uncompressedsize =3D input:PopNetUint8()
-
 				local compressedsize =3D input:PopNetUint8()
 				local bothsizes =3D input:PopNetUint8()		--? Write( (byte)(((size >> 4=
) & 0xF0) | ((deflatedLength >> 8) & 0xF)) );
 				=

@@ -114,7 +116,7 @@
 						planeid,planetype,uncompressedsize,compressedsize,bothsizes))
 			=

 				-- switch between stair and plane buffers
-				if planetype =3D=3D 0x20 then
+				if ( planetype =3D=3D 0x20 ) then
 					-- ------------------------------------------------------------------=
--------
 					-- planelayers
 					-- ------------------------------------------------------------------=
--------

Modified: trunk/lua/profiles/gfx_ultrahigh.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/profiles/gfx_ultrahigh.lua (original)
+++ trunk/lua/profiles/gfx_ultrahigh.lua Sat Aug 22 19:23:54 2009
@@ -9,7 +9,11 @@
 =

 gConfig:Set("gPreloadStaticMesh",true)
 =

---~ gConfig:Set("gUseCaelumSkysystem",true)  19.10 : deactivated, as this =
seems to trigger crash when recalling into/outside a cave : =

+gConfig:Set("gUseCaelumSkysystem",true)
+    -- SiENcE: this bug seems to be fixed with the shaderbug
+    --  19.10 : deactivated, as this seems to trigger crash when recalling=
 into/outside a cave : =

 	-- http://www.vetus-mundus.de/phpbb2/viewtopic.php?p=3D107468#107468
 =

+gConfig:Set("gUseWaterShader",true)
+	=

 gConfig:Set("gArtMapLoaderType","FullFile")

Modified: trunk/src/data_font.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data_font.cpp (original)
+++ trunk/src/data_font.cpp Sat Aug 22 19:23:54 2009
@@ -69,7 +69,6 @@
 	*/
 }
 =

-
 const int cUniFontFileLoader::GetLetterNumbers(){return 0xFFFF;}
 const float cUniFontFileLoader::GetLetterUsage(){
 	std::map<const char *,int> lCache;
@@ -160,11 +159,7 @@
 }
 =

 =

-
-
 // ***** ***** ***** ***** ***** builder
-
-
 =

 =

 bool	WriteFontGlyphToImage		(Ogre::Image& pDest,cUniFontFileLoader& oUniFo=
ntFileLoader,const int iCharCode,
@@ -193,10 +188,7 @@
 	return true;
 }
 =

-
-
-
-
+/*
 // deprecated, old guisystem, doesn't support unicode well, see lib.unifon=
t.lua for an alternative
 Ogre::FontPtr	GenerateUniFont	(cUniFontFileLoader& oUniFontFileLoader, con=
st char *szName, =

 	const int code_first, const int code_last,
@@ -341,12 +333,10 @@
 	//img.resize(texw*2,texh*2,Ogre::Image::FILTER_NEAREST);
 	=

 	// save on disk
-	/*
-	printf("save image...\n");
-	std::string filename =3D std::string(szName) + std::string(".png");
-	img.save(filename);
-	printf("done\n");
-	*/
+// 	printf("save image...\n");
+// 	std::string filename =3D std::string(szName) + std::string(".png");
+// 	img.save(filename);
+// 	printf("done\n");
 	=

 	// generate texture name from the fontname
 	std::string sTexName =3D std::string(szName) + std::string("_tex");
@@ -355,11 +345,11 @@
 	Ogre::TexturePtr t =3D Ogre::TextureManager::getSingleton().loadImage(sTe=
xName,Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME,
 		img,Ogre::TEX_TYPE_2D,0);
 	=

-	/*
-	Ogre::DataStreamPtr imgstream(new Ogre::MemoryDataStream(buffer,buffersiz=
e));
-	Ogre::TexturePtr t =3D Ogre::TextureManager::getSingleton().loadRawData(s=
TexName,
-		Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME,
-		imgstream, texw, texh, Ogre::PF_A4R4G4B4 );*/
+	=

+// 	Ogre::DataStreamPtr imgstream(new Ogre::MemoryDataStream(buffer,buffer=
size));
+// 	Ogre::TexturePtr t =3D Ogre::TextureManager::getSingleton().loadRawDat=
a(sTexName,
+// 		Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME,
+// 		imgstream, texw, texh, Ogre::PF_A4R4G4B4 );
 	=

 	// assign texture to font
 	font->setSource(sTexName);
@@ -384,3 +374,4 @@
 	=

 	return font;
 }
+*/

Modified: trunk/src/data_font_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data_font_L.cpp (original)
+++ trunk/src/data_font_L.cpp Sat Aug 22 19:23:54 2009
@@ -1,5 +1,4 @@
 #include "data_luabind_common.h"
-
 =

 class cUniFontFileLoader_L : public cLuaBind<cUniFontFileLoader> { public:
 	// implementation of cLuaBind
@@ -16,7 +15,7 @@
 			REGISTER_METHOD(WriteGlyphToImage);
 			REGISTER_METHOD(GetGlyphInfo);
 			REGISTER_METHOD(GetDefaultHeight);
-			REGISTER_METHOD(CreateOgreFont);
+//			REGISTER_METHOD(CreateOgreFont);
 			#undef REGISTER_METHOD
 		}
 =

@@ -62,7 +61,7 @@
 			lua_pushnumber(L,h->miHeight);
 			return 4;
 		}	=

-
+/*
 		/// for lua CreateOgreFont(fontname)
 		static int	CreateOgreFont				(lua_State *L) { PROFILE =

 			cUniFontFileLoader* target =3D checkudata_alive(L);
@@ -75,15 +74,12 @@
 			=

 			return 0; =

 		}	=

-		=

+*/		=

 		// see also l_ExportOgreFont in lugre/src/lugre_scripting.ogre.cpp
 		=

 		virtual const char* GetLuaTypeName () { return "iris.unifontloader"; }
 };
 =

-
-
 void	LuaRegisterData_Font		 	(lua_State *L) {
 	cLuaBind<cUniFontFileLoader>::GetSingletonPtr(new cUniFontFileLoader_L())=
->LuaRegister(L);
 }
-

Modified: trunk/vc9/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vc9/iris.vcproj (original)
+++ trunk/vc9/iris.vcproj Sat Aug 22 19:23:54 2009
@@ -613,6 +613,10 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\include\lugre_luabind_direct.h"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\include\lugre_luacallback.h"
 					>
 				</File>
@@ -1002,6 +1006,10 @@
 				</File>
 				<File
 					RelativePath=3D"..\lugre\src\lugre_utils.cpp"
+					>
+				</File>
+				<File
+					RelativePath=3D"..\lugre\src\lugre_vertexbuffer_L.cpp"
 					>
 				</File>
 				<File



From no-reply at zwischenwelt.org  Sat Aug 22 20:49:52 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 22 Aug 2009 18:49:52 -0000
Subject: [Iris-commit] [IRIS] r3105 - in /trunk/lua: config_declarations.lua
 lib.3d.renderer.lua lib.configdialog.lua main.lua
Message-ID: <20090822184952.4A94D7A9810A@simon>

Author: ghoulsblade
Date: Sat Aug 22 20:49:52 2009
New Revision: 3105

Log:
bloom shader, can be activated in config dialog

Modified:
    trunk/lua/config_declarations.lua
    trunk/lua/lib.3d.renderer.lua
    trunk/lua/lib.configdialog.lua
    trunk/lua/main.lua

Modified: trunk/lua/config_declarations.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/config_declarations.lua (original)
+++ trunk/lua/config_declarations.lua Sat Aug 22 20:49:52 2009
@@ -498,6 +498,7 @@
 gConfig:DeclareBoolean("gIgnoreGlobalLightLevel", "gfx", "ignore global li=
ght", 'if this is true the world is always day bright', false)
 =

 gConfig:DeclareBoolean("gEnable2DWaterAnim", "gfx", "2D : Water Animation"=
, 'enable/disable Water Animation in 2d mode', false)
+gConfig:DeclareBoolean("gEnableBloomShader", "gfx", "bloom shader", 'TODO'=
, false)
 gConfig:DeclareBoolean("gUseWaterShader", "gfx", "water shader", 'TODO', f=
alse)
 gConfig:DeclareBoolean("gWaterAsGroundTiles", "gfx", "water as ground tile=
s", 'TODO', false)
 =


Modified: trunk/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.renderer.lua (original)
+++ trunk/lua/lib.3d.renderer.lua Sat Aug 22 20:49:52 2009
@@ -107,6 +107,12 @@
 gProfiler_R3D_MainStep =3D CreateRoughProfiler(" 3D:MainStep")
 =

 function Renderer3D:MainStep    ()
+	if (gEnableBloomShader) then
+		if (not gRegisteredBloomShader) then
+			gRegisteredBloomShader =3D true =

+			OgreAddCompositor(GetMainViewport(),"Bloom")
+		end
+	end
     gProfiler_R3D_MainStep:Start(gEnableProfiler_R3D_MainStep)
     =

     gProfiler_R3D_MainStep:Section("CombatGuiStep")     self:CombatGuiStep=
()

Modified: trunk/lua/lib.configdialog.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.configdialog.lua (original)
+++ trunk/lua/lib.configdialog.lua Sat Aug 22 20:49:52 2009
@@ -267,6 +267,7 @@
 	local gfx_profile_list =3D {"ultralow", "low", "med", "high", "ultrahigh"=
} -- "none" ??
 	MyAddConfig_GlobalEnum("Quality","gGraphicProfile",gfx_profile_list)
 	=

+	MyAddConfig_GlobalBool("(3D)bloom Shader","gEnableBloomShader")
 	MyAddConfig_GlobalBool("(3D)water Shader","gUseWaterShader")
 	MyAddConfig_GlobalBool("(3D)distance fog","gUseDistanceFog")
 	MyAddConfig_GlobalBool("(3D)static 2D fallback","gUseStaticFallbacks")

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Aug 22 20:49:52 2009
@@ -273,7 +273,7 @@
 =

     OgreAddResLoc(gMainWorkingDir..CorrectPath("lugre/lib/caelum/resources=
"),"FileSystem","Caelum")
 	=

-	if (gDebugModeTestSkeletalAnimShader) then =

+	if (gDebugModeTestSkeletalAnimShader or gEnableBloomShader) then =

 		local myOgreSampleMedia =3D mydatapath.."ogreSampleMedia/"
 		=

 		OgreAddResLoc(myOgreSampleMedia.."/packs/OgreCore.zip"			,"Zip","Bootstr=
ap")



From no-reply at zwischenwelt.org  Sun Aug 23 00:40:51 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 22 Aug 2009 22:40:51 -0000
Subject: [Iris-commit] [IRIS] r3106 - /trunk/lua/lib.3d.mousepick.lua
Message-ID: <20090822224051.618B67A9810A@simon>

Author: hagish
Date: Sun Aug 23 00:40:50 2009
New Revision: 3106

Log:
tooltips in 3d work

Modified:
    trunk/lua/lib.3d.mousepick.lua

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Sun Aug 23 00:40:50 2009
@@ -27,8 +27,18 @@
 function Renderer3D:MousePickStep ()
     if (not self.gbActive) then return end
     if (gMyTicks > self.gNextMousePick) then
-        self.gNextMousePick =3D gMyTicks + 100
+        self.gNextMousePick =3D gMyTicks + 400
+        =

         -- self:MousePick() -- obsolete, don't do mousepicking every frame
+        =

+        local serial
+		if (not gKeyPressed[key_mouse_right]) then
+			serial =3D GetMouseHitSerial(true) -- executes mousepick
+			if (serial =3D=3D 0) then serial =3D nil end
+			if (gMousePickFoundHit and gMousePickFoundHit.hittype =3D=3D kMousePick=
HitType_Container) then serial =3D nil end -- backpane
+		end
+		=

+		StartUOToolTipAtMouse_Serial(serial)
     end
 end
 =




From no-reply at zwischenwelt.org  Sun Aug 23 00:55:33 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 22 Aug 2009 22:55:33 -0000
Subject: [Iris-commit] [IRIS] r3107 - in /trunk/lua: lib.bodygfx.lua
	lib.configdialog.lua
Message-ID: <20090822225533.4C7B77A9810A@simon>

Author: ghoulsblade
Date: Sun Aug 23 00:55:33 2009
New Revision: 3107

Log:
option to disable anims, tripples fps in luna

Modified:
    trunk/lua/lib.bodygfx.lua
    trunk/lua/lib.configdialog.lua

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Sun Aug 23 00:55:33 2009
@@ -385,7 +385,9 @@
     end
     gProfiler_BodyGfxStep:Section("sec3")
     if (self.bIsCorpse) then self.animtime =3D self.animlen end =

-    for k,partgfx in pairs(self.modelparts or {}) do partgfx:SetAnimTimePo=
s(self.animtime) end -- update parts
+	if (not gGrannyAnimDisabled) then =

+		for k,partgfx in pairs(self.modelparts or {}) do partgfx:SetAnimTimePos(=
self.animtime) end -- update parts
+	end
 	=

     gProfiler_BodyGfxStep:End()
 end

Modified: trunk/lua/lib.configdialog.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.configdialog.lua (original)
+++ trunk/lua/lib.configdialog.lua Sun Aug 23 00:55:33 2009
@@ -271,6 +271,7 @@
 	MyAddConfig_GlobalBool("(3D)water Shader","gUseWaterShader")
 	MyAddConfig_GlobalBool("(3D)distance fog","gUseDistanceFog")
 	MyAddConfig_GlobalBool("(3D)static 2D fallback","gUseStaticFallbacks")
+	MyAddConfig_GlobalBool("(3D)disable Character anims","gGrannyAnimDisabled=
")
 	=

 	page:AddWidget(CreateWidgetFromXMLString(nil,"<UOText bold=3D1 text=3D'".=
."changes require restart".."'>"))
 end



From no-reply at zwischenwelt.org  Sun Aug 23 01:02:45 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 22 Aug 2009 23:02:45 -0000
Subject: [Iris-commit] [IRIS] r3108 - in /trunk/lua: config_declarations.lua
 lib.bodygfx.lua lib.configdialog.lua profiles/gfx_ultrahigh.lua
Message-ID: <20090822230245.E21CC7A9810A@simon>

Author: ghoulsblade
Date: Sun Aug 23 01:02:45 2009
New Revision: 3108

Log:
gGrannyAnimEnabled var instead of gGrannyAnimDisabled, disabled by default,=
 enabled in ultrahigh

Modified:
    trunk/lua/config_declarations.lua
    trunk/lua/lib.bodygfx.lua
    trunk/lua/lib.configdialog.lua
    trunk/lua/profiles/gfx_ultrahigh.lua

Modified: trunk/lua/config_declarations.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/config_declarations.lua (original)
+++ trunk/lua/config_declarations.lua Sun Aug 23 01:02:45 2009
@@ -499,6 +499,7 @@
 =

 gConfig:DeclareBoolean("gEnable2DWaterAnim", "gfx", "2D : Water Animation"=
, 'enable/disable Water Animation in 2d mode', false)
 gConfig:DeclareBoolean("gEnableBloomShader", "gfx", "bloom shader", 'TODO'=
, false)
+gConfig:DeclareBoolean("gGrannyAnimEnabled", "gfx", "granny anims, bad for=
 performance as long as we don't use anim-shader", 'TODO', false) =

 gConfig:DeclareBoolean("gUseWaterShader", "gfx", "water shader", 'TODO', f=
alse)
 gConfig:DeclareBoolean("gWaterAsGroundTiles", "gfx", "water as ground tile=
s", 'TODO', false)
 =


Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Sun Aug 23 01:02:45 2009
@@ -385,7 +385,7 @@
     end
     gProfiler_BodyGfxStep:Section("sec3")
     if (self.bIsCorpse) then self.animtime =3D self.animlen end =

-	if (not gGrannyAnimDisabled) then =

+	if (gGrannyAnimEnabled) then =

 		for k,partgfx in pairs(self.modelparts or {}) do partgfx:SetAnimTimePos(=
self.animtime) end -- update parts
 	end
 	=


Modified: trunk/lua/lib.configdialog.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.configdialog.lua (original)
+++ trunk/lua/lib.configdialog.lua Sun Aug 23 01:02:45 2009
@@ -269,9 +269,9 @@
 	=

 	MyAddConfig_GlobalBool("(3D)bloom Shader","gEnableBloomShader")
 	MyAddConfig_GlobalBool("(3D)water Shader","gUseWaterShader")
+	MyAddConfig_GlobalBool("(3D)character anims","gGrannyAnimEnabled")
 	MyAddConfig_GlobalBool("(3D)distance fog","gUseDistanceFog")
 	MyAddConfig_GlobalBool("(3D)static 2D fallback","gUseStaticFallbacks")
-	MyAddConfig_GlobalBool("(3D)disable Character anims","gGrannyAnimDisabled=
")
 	=

 	page:AddWidget(CreateWidgetFromXMLString(nil,"<UOText bold=3D1 text=3D'".=
."changes require restart".."'>"))
 end

Modified: trunk/lua/profiles/gfx_ultrahigh.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/profiles/gfx_ultrahigh.lua (original)
+++ trunk/lua/profiles/gfx_ultrahigh.lua Sun Aug 23 01:02:45 2009
@@ -7,6 +7,7 @@
 gConfig:Set("gDynamicsCastShadows",true)
 gConfig:Set("gMobileCastShadows",true)
 =

+gConfig:Set("gGrannyAnimEnabled",true) =

 gConfig:Set("gPreloadStaticMesh",true)
 =

 gConfig:Set("gUseCaelumSkysystem",true)



From no-reply at zwischenwelt.org  Sun Aug 23 02:09:03 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Aug 2009 00:09:03 -0000
Subject: [Iris-commit] [IRIS] r3109 - /trunk/lua/lib.bodygfx.lua
Message-ID: <20090823000903.BEC827A9810A@simon>

Author: ghoulsblade
Date: Sun Aug 23 02:09:03 2009
New Revision: 3109

Log:
fixed death pose for disabled anims

Modified:
    trunk/lua/lib.bodygfx.lua

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Sun Aug 23 02:09:03 2009
@@ -384,8 +384,15 @@
         while (self.animlen > 0 and self.animtime > self.animlen) do self.=
animtime =3D self.animtime - self.animlen end =

     end
     gProfiler_BodyGfxStep:Section("sec3")
-    if (self.bIsCorpse) then self.animtime =3D self.animlen end =

-	if (gGrannyAnimEnabled) then =

+	local bForceUpdateEvenIfAnimDisabled =3D false
+    if (self.bIsCorpse) then =

+		self.animtime =3D self.animlen =

+		if (not self.bCorpseAnimSet) then
+			self.bCorpseAnimSet =3D true
+			bForceUpdateEvenIfAnimDisabled =3D true
+		end
+	end =

+	if (gGrannyAnimEnabled or bForceUpdateEvenIfAnimDisabled) then =

 		for k,partgfx in pairs(self.modelparts or {}) do partgfx:SetAnimTimePos(=
self.animtime) end -- update parts
 	end
 	=




From no-reply at zwischenwelt.org  Sun Aug 23 02:33:24 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Aug 2009 00:33:24 -0000
Subject: [Iris-commit] [IRIS] r3110 - /trunk/lua/lib.gfxconfig.lua
Message-ID: <20090823003324.07F737A9810A@simon>

Author: ghoulsblade
Date: Sun Aug 23 02:33:23 2009
New Revision: 3110

Log:
resolution config debug

Modified:
    trunk/lua/lib.gfxconfig.lua

Modified: trunk/lua/lib.gfxconfig.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gfxconfig.lua (original)
+++ trunk/lua/lib.gfxconfig.lua Sun Aug 23 02:33:23 2009
@@ -103,7 +103,9 @@
 				if (string.lower(sConfigOptionName) =3D=3D string.lower(name)) then =

 					local possibleValues =3D {Ogre_ListPossibleValuesForConfigOption(sRen=
derSysName,sConfigOptionName)}
 					for k3,sConfigOptionValue in ipairs(possibleValues) do =

-						if (string.find(MyNormalizeValue(sConfigOptionValue),"^"..MyNormaliz=
eValue(val))) then =

+						local bCompareResult =3D string.find(MyNormalizeValue(sConfigOptionV=
alue),"^"..MyNormalizeValue(val)) ~=3D nil
+						print("GfxConfig_SetOgreConfig: compare:",bCompareResult,WrapString(=
val),WrapString(sConfigOptionValue))
+						if (bCompareResult) then =

 							print("GfxConfig_SetOgreConfig: value set",WrapString(sConfigOption=
Name),WrapString(sConfigOptionValue))
 							Ogre_SetConfigOption(sConfigOptionName,sConfigOptionValue)
 							return true =




From no-reply at zwischenwelt.org  Sun Aug 23 02:38:04 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Aug 2009 00:38:04 -0000
Subject: [Iris-commit] [IRIS] r3111 - /trunk/lua/lib.gfxconfig.lua
Message-ID: <20090823003804.50B317A9810A@simon>

Author: ghoulsblade
Date: Sun Aug 23 02:38:04 2009
New Revision: 3111

Log:
resolution config bugfix

Modified:
    trunk/lua/lib.gfxconfig.lua

Modified: trunk/lua/lib.gfxconfig.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gfxconfig.lua (original)
+++ trunk/lua/lib.gfxconfig.lua Sun Aug 23 02:38:04 2009
@@ -103,7 +103,9 @@
 				if (string.lower(sConfigOptionName) =3D=3D string.lower(name)) then =

 					local possibleValues =3D {Ogre_ListPossibleValuesForConfigOption(sRen=
derSysName,sConfigOptionName)}
 					for k3,sConfigOptionValue in ipairs(possibleValues) do =

-						local bCompareResult =3D string.find(MyNormalizeValue(sConfigOptionV=
alue),"^"..MyNormalizeValue(val)) ~=3D nil
+						local a =3D MyNormalizeValue(sConfigOptionValue)
+						local b =3D MyNormalizeValue(val)
+						local bCompareResult =3D a =3D=3D b or (string.find(a,"^"..b) ~=3D n=
il)
 						print("GfxConfig_SetOgreConfig: compare:",bCompareResult,WrapString(=
val),WrapString(sConfigOptionValue))
 						if (bCompareResult) then =

 							print("GfxConfig_SetOgreConfig: value set",WrapString(sConfigOption=
Name),WrapString(sConfigOptionValue))



From no-reply at zwischenwelt.org  Sun Aug 23 18:48:18 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Aug 2009 16:48:18 -0000
Subject: [Iris-commit] [IRIS] r3112 - in /trunk/lua: config_declarations.lua
	profiles/gfx_high.lua
Message-ID: <20090823164818.80EFE7A980FE@simon>

Author: sience
Date: Sun Aug 23 18:48:18 2009
New Revision: 3112

Log:
-graphicprofile high is now standard and has grannyAnims=3Don

Modified:
    trunk/lua/config_declarations.lua
    trunk/lua/profiles/gfx_high.lua

Modified: trunk/lua/config_declarations.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/config_declarations.lua (original)
+++ trunk/lua/config_declarations.lua Sun Aug 23 18:48:18 2009
@@ -481,7 +481,7 @@
 =

 gConfig:DeclareBoolean("gUseHumanSkinShader", "gfx", "human skin shader", =
'shaderbased characterrendering (beta)', false)
 =

-gConfig:DeclareEnum("gGraphicProfile", "gfx", "gfx profile", 'shaderbased =
characterrendering (beta)', "med", {"ultralow", "low", "med", "high", "ultr=
ahigh", "none"})
+gConfig:DeclareEnum("gGraphicProfile", "gfx", "gfx profile", 'shaderbased =
characterrendering (beta)', "high", {"ultralow", "low", "med", "high", "ult=
rahigh", "none"})
 =

 gConfig:DeclareBoolean("gEnableGotoOnClick", "input", "goto on click", 'TO=
DO', false)
 =


Modified: trunk/lua/profiles/gfx_high.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/profiles/gfx_high.lua (original)
+++ trunk/lua/profiles/gfx_high.lua Sun Aug 23 18:48:18 2009
@@ -7,4 +7,5 @@
 gConfig:Set("gDynamicsCastShadows",true)
 gConfig:Set("gMobileCastShadows",true)
 =

-gConfig:Set("gPreloadStaticMesh",true)
+gConfig:Set("gGrannyAnimEnabled",true) =

+--gConfig:Set("gPreloadStaticMesh",true)



From no-reply at zwischenwelt.org  Mon Aug 24 17:49:24 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 24 Aug 2009 15:49:24 -0000
Subject: [Iris-commit] [IRIS] r3113 - /trunk/makeclean.sh
Message-ID: <20090824154924.0C1CC7A9810A@simon>

Author: ghoulsblade
Date: Mon Aug 24 17:49:23 2009
New Revision: 3113

Log:
added makeclean.sh

Added:
    trunk/makeclean.sh   (with props)



From no-reply at zwischenwelt.org  Mon Aug 24 21:57:17 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 24 Aug 2009 19:57:17 -0000
Subject: [Iris-commit] [IRIS] r3114 - in /trunk/lua:
 config_macros_declarations.lua lib.3d.mousepick.lua lib.fallback.lua
 lib.macrolist.lua
Message-ID: <20090824195717.C46947A9810A@simon>

Author: sience
Date: Mon Aug 24 21:57:17 2009
New Revision: 3114

Log:
-some old mouspick code removed
-fallbacktool disabled because it uses old mapcode which doesn't work

Modified:
    trunk/lua/config_macros_declarations.lua
    trunk/lua/lib.3d.mousepick.lua
    trunk/lua/lib.fallback.lua
    trunk/lua/lib.macrolist.lua

Modified: trunk/lua/config_macros_declarations.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/config_macros_declarations.lua (original)
+++ trunk/lua/config_macros_declarations.lua Mon Aug 24 21:57:17 2009
@@ -33,8 +33,12 @@
 SetMacro("k",		function() MacroCmd_Open("Skill") end)	-- Open Skills
 SetMacro("c",		function() MacroCmd_NextCamMode() end)	-- change cam mode
 =

--- SetMacro("ctrl+h",	function() MacroCmd_Spell("Heal") end)
--- SetMacro("ctrl+a",	function() MacroCmd_Skill("Anatomy") end)
+--[[ old uo pre-set default :  (not yet implemented in iris)
+--~  SetMacro("ctrl+h",	function() MacroCmd_Spell("Heal") end)
+--~  SetMacro("ctrl+a",	function() MacroCmd_Skill("Anatomy") end)
+--~ SetMacro("alt+b",function() MacroCmd_Open("Spellbook") end) -- Open Sp=
ellbook -- not yet implemented
+--~ SetMacro("alt+r",function() MacroCmd_Open("") end)  -- Open Overhead V=
iew -- not yet implemented
+--~ SetMacro("alt+o",function() MacroCmd_Open("") end)  -- Open Options wi=
ndow -- not yet implemented
 =

 SetMacro("l",			function() MacroCmd_Open("Logo") end)
 SetMacro("n",			function() MacroCmd_Open("Compass") end)
@@ -42,7 +46,6 @@
 SetMacro("komma",		function() MacroCmd_ZoomCompass(1*1.5) end)
 SetMacro("point",		function() MacroCmd_ZoomCompass(1/1.5) end)
 SetMacro("f10",			function() MacroCmd_ShowDevTool() end)
-SetMacro("f11",			function() MacroCmd_ShowFallBackTool() end)
 SetMacro("shift+f12",	function() MacroCmd_GridScreenshot() end)
 SetMacro("f12",			function() FadeLineToggleShowAll() end)
 SetMacro("v",			function() MacroCmd_Screenshot() end)
@@ -56,7 +59,6 @@
 SetMacro("h",			function() MacroCmd_RepeatLastDoubleClick() end)
 SetMacro("q",			function() MacroCmd_SelectNearestMobile() end)
 SetMacro("e",			function() MacroCmd_SelectNextMobile() end)
---SetMacro("space",		function() MacroCmd_AttackSelectedMobile() end) -- cu=
rrently broken
 SetMacro("ctrl+r",			function() MacroCmd_ActivateNextRenderer() end)
 =

 SetMacro("ctrl+f1",		function() MacroCmd_ItemSlot_Set(1) end)
@@ -79,6 +81,12 @@
 SetMacro("home",		function() MacroCmd_Say("[tele") end)
 SetMacro("end",			function() MacroCmd_Say("[get z") end)
 =

+SetMacro("shift+f11",	function() ImportRazorProfileDialog() end)
+ImportRazorProfile("C:\\Program Files\\Razor\\Profiles\\default.xml") -- i=
mport default config
+
+--~ SetMacro("space",		function() MacroCmd_AttackSelectedMobile() end) -- =
currently broken
+--~ SetMacro("f11",			function() MacroCmd_ShowFallBackTool() end) -- curre=
ntly broken
+
 --[[
 SetMacro("F1",	function() MacroCmd_Item_UseByArtID(3852) end)	-- greater h=
ealth
 SetMacro("F2",	function() MacroCmd_Item_UseByArtID(3847) end)	-- greater c=
ure
@@ -98,6 +106,3 @@
 SetMacro("alt+Z",	function() MacroCmd_Spell("Invisibility") end)
 SetMacro("alt+X",	function() MacroCmd_Spell("Meteor Swarm") end)
 ]]--
-
-SetMacro("shift+f11",	function() ImportRazorProfileDialog() end)
-ImportRazorProfile("C:\\Program Files\\Razor\\Profiles\\default.xml") -- i=
mport default config

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Mon Aug 24 21:57:17 2009
@@ -199,69 +199,6 @@
         gCustomQuadInfoWritten =3D true
         print("mousepick info numgfx=3D",numgfx,"numcustomquads=3D",numcus=
tomquads," (each has its own scenenode)")
     end
-	--[[
-	for chunky,row in pairs(self.gMapChunks) do
-		for chunkx,chunk in pairs(row) do
-			if (not chunk.bIsDead) then
-				-- terrain
-				if (gGroundBlockLoader and self.gbBlendOutTerrainVisible) then
-					local iBlockUO_X =3D chunk.miX * self.ROBMAP_CHUNK_SIZE
-					local iBlockUO_Y =3D chunk.miY * self.ROBMAP_CHUNK_SIZE
-													=

-					if (chunk.pStaticGeometryTerrain) then -- old terrain : static-geom
-						local x,y =3D self:UOPosToLocal(iBlockUO_X*8,iBlockUO_Y*8)
-						bHit,fHitDist =3D chunk.pTerrainEntity:RayPick(rx,ry,rz,rvx,rvy,rvz,=
x,y,0)
-					elseif (chunk.terrain_multitex_gfx) then -- new terrain multitex
-						local gfx =3D chunk.terrain_multitex_gfx
-						local d =3D kMultiTexTerrainChunkSize
-						local bx,by =3D gfx.bx,gfx.by
-						local tx,ty
-
-						bHit,fHitDist,tx,ty =3D TerrainMultiTex_RayPick(gGroundBlockLoader,g=
fx.bx,gfx.by,d,d,0.1, rx-gfx.x,ry-gfx.y,rz-gfx.z, rvx,rvy,rvz)
-						if (bHit) then
-							if (tx >=3D 8) then bx =3D bx + 1   tx =3D tx - 8 end
-							if (ty >=3D 8) then by =3D by + 1   ty =3D ty - 8 end
-						end
-					else
-						if (chunk.terraingfx) then -- old terrain : meshentities
-							bHit,fHitDist =3D chunk.terraingfx:RayPick(rx,ry,rz,rvx,rvy,rvz)
-						else
-							bHit =3D false
-						end
-					end
-					=

-					if (bHit and ((not gMousePickFoundHit) or fHitDist < self.gMousePickF=
oundDist)) then
-						self.gMousePickFoundDist =3D fHitDist
-						gMousePickFoundHit =3D {}
-						gMousePickFoundHit.hittype =3D kMousePickHitType_Terrain
-						gMousePickFoundHit.chunk =3D chunk
-						=

-						local x,y =3D Renderer3D:LocalToUOPos(rx + fHitDist * rvx, ry + fHit=
Dist * rvy)
-						x,y =3D math.floor(x),math.floor(y)
-						local iTileType,iZLoc =3D GetAbsTile(x,y) =

-						local bx =3D math.floor((x - iBlockUO_X)/8)
-						local by =3D math.floor((y - iBlockUO_Y)/8)
-						local origin_abs_x =3D self.giMapOriginX * self.ROBMAP_CHUNK_SIZE
-						local origin_abs_y =3D self.giMapOriginY * self.ROBMAP_CHUNK_SIZE
-						local originoffx =3D 8.0*(iBlockUO_X-origin_abs_x)
-						local originoffy =3D 8.0*(iBlockUO_Y-origin_abs_y)
-						=

-						gMousePickFoundHit.tiletype =3D iTileType
-						gMousePickFoundHit.minz =3D iZLoc*0.1 =

-						gMousePickFoundHit.maxz =3D iZLoc*0.1
-						gMousePickFoundHit.x =3D x
-						gMousePickFoundHit.y =3D y
-						gMousePickFoundHit.tx =3D math.mod(x,8)
-						gMousePickFoundHit.ty =3D math.mod(y,8)
-						gMousePickFoundHit.iBlockX =3D iBlockUO_X+bx
-						gMousePickFoundHit.iBlockY =3D iBlockUO_Y+by
-						gMousePickFoundHit.blockorigin_x =3D originoffx+bx*8
-						gMousePickFoundHit.blockorigin_y =3D originoffy+by*8
-					end
-				end
-			end
-	end end
-	]]--
     =

     -- dynamics
     for k,dynamic in pairs(GetDynamicList()) do

Modified: trunk/lua/lib.fallback.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.fallback.lua (original)
+++ trunk/lua/lib.fallback.lua Mon Aug 24 21:57:17 2009
@@ -37,6 +37,8 @@
     gCurrentRenderer:ClearMapCache()
 end
 =

+-- currently broken (uses old mapcode)
+--[[
 function ShowFallBackTool (x,y,z,radius)
     if (gCurrentRenderer ~=3D Renderer3D) then return end
     if (not x) then =

@@ -110,6 +112,7 @@
     end
     return res
 end
+]]--
 =

 function GetFallBackBoxMesh ()
     if not gFallBackBoxMesh then

Modified: trunk/lua/lib.macrolist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.macrolist.lua (original)
+++ trunk/lua/lib.macrolist.lua Mon Aug 24 21:57:17 2009
@@ -3,11 +3,6 @@
         handles macro list
 ]]--
 =

---[[ old uo pre-set default :  (not yet implemented in iris)
---~ SetMacro("alt+b",function() MacroCmd_Open("Spellbook") end) -- Open Sp=
ellbook -- not yet implemented
---~ SetMacro("alt+r",function() MacroCmd_Open("") end)  -- Open Overhead V=
iew -- not yet implemented
---~ SetMacro("alt+o",function() MacroCmd_Open("") end)  -- Open Options wi=
ndow -- not yet implemented
-]]--
 gMacroList =3D {}
 =

 gMacroOpenCommands =3D {}
@@ -467,7 +462,8 @@
         end)
 end
 =

-function MacroCmd_ShowFallBackTool      ()              if (gInGameStarted=
) then ShowFallBackTool() end end
+-- currently broken
+--~ function MacroCmd_ShowFallBackTool      ()              if (gInGameSta=
rted) then ShowFallBackTool() end end
 function MacroCmd_ShowDevTool           ()              if (gInGameStarted=
) then ShowDevTool() end end =

 function MacroCmd_ZoomCompass           (zoomfactor)    if (gInGameStarted=
) then ZoomCompass(zoomfactor) end end
 function MacroCmd_ActivateNextRenderer  ()              if (gInGameStarted=
) then ActivateNextRenderer() end end



From no-reply at zwischenwelt.org  Mon Aug 24 23:56:17 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 24 Aug 2009 21:56:17 -0000
Subject: [Iris-commit] [IRIS] r3115 -
	/trunk/lua/config_macros_declarations.lua
Message-ID: <20090824215617.AEAF77A9810A@simon>

Author: sience
Date: Mon Aug 24 23:56:17 2009
New Revision: 3115

Log:
-small comment fix

Modified:
    trunk/lua/config_macros_declarations.lua

Modified: trunk/lua/config_macros_declarations.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/config_macros_declarations.lua (original)
+++ trunk/lua/config_macros_declarations.lua Mon Aug 24 23:56:17 2009
@@ -33,7 +33,8 @@
 SetMacro("k",		function() MacroCmd_Open("Skill") end)	-- Open Skills
 SetMacro("c",		function() MacroCmd_NextCamMode() end)	-- change cam mode
 =

---[[ old uo pre-set default :  (not yet implemented in iris)
+--[[
+--old uo pre-set default :  (not yet implemented in iris)
 --~  SetMacro("ctrl+h",	function() MacroCmd_Spell("Heal") end)
 --~  SetMacro("ctrl+a",	function() MacroCmd_Skill("Anatomy") end)
 --~ SetMacro("alt+b",function() MacroCmd_Open("Spellbook") end) -- Open Sp=
ellbook -- not yet implemented
@@ -83,6 +84,7 @@
 =

 SetMacro("shift+f11",	function() ImportRazorProfileDialog() end)
 ImportRazorProfile("C:\\Program Files\\Razor\\Profiles\\default.xml") -- i=
mport default config
+]]--
 =

 --~ SetMacro("space",		function() MacroCmd_AttackSelectedMobile() end) -- =
currently broken
 --~ SetMacro("f11",			function() MacroCmd_ShowFallBackTool() end) -- curre=
ntly broken



From no-reply at zwischenwelt.org  Tue Aug 25 00:55:23 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 24 Aug 2009 22:55:23 -0000
Subject: [Iris-commit] [IRIS] r3116 - /trunk/installdeps.ubuntu.sh
Message-ID: <20090824225523.1EA5B7A9810A@simon>

Author: ghoulsblade
Date: Tue Aug 25 00:55:22 2009
New Revision: 3116

Log:
a few hints for installdeps.ubuntu.sh

Modified:
    trunk/installdeps.ubuntu.sh

Modified: trunk/installdeps.ubuntu.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/installdeps.ubuntu.sh (original)
+++ trunk/installdeps.ubuntu.sh Tue Aug 25 00:55:22 2009
@@ -9,10 +9,11 @@
 echo iris 2 uses fmod ex 4.* to play music files. alternatively you can us=
e openal, but that has no music then.
 echo you can download fmod ex 4.* stable for linux from http://www.fmod.or=
g/index.php/download
 echo please install the 32 bit version of fmod, even if you have a 64 bit =
system, our buildscript wont be able to find it otherwise
+echo "direct download link (august 2009) : http://www.fmod.org/index.php/r=
elease/version/fmodapi42706linux.tar.gz"
 echo ------------------------------
 echo iris 2 uses ogre1.6 now, there is no package for that yet, so you wil=
l need to compile that from source
 echo to do that, download the source from =

-echo http://downloads.sourceforge.net/ogre/ogre-v1-6-0.tar.bz2?use_mirror=
=3D
+echo http://sourceforge.net/projects/ogre/files/ogre/1.6.1/ogre-v1-6-1.tar=
.bz2/download
 echo cd ogrenew
 echo aclocal
 echo ./bootstrap
@@ -32,4 +33,7 @@
 echo "		deb http://ppa.launchpad.net/andrewfenn/ppa/ubuntu $DISTRO_CODENAM=
E main"
 echo "		deb-src http://ppa.launchpad.net/andrewfenn/ppa/ubuntu $DISTRO_COD=
ENAME main"
 echo "apt-get install libogre16-dev"
+echo "WARNING ! currently (august 2009) this is not recommended, as there =
are crashes with ogre 1.6.2"
+echo "  we'd recommend using 1.6.1  (compiled from source as described abo=
ve) as we haven't tried 1.6.3 under linux yet."
+echo "  you can download ogre 1.6.1 source here : http://sourceforge.net/p=
rojects/ogre/files/ogre/1.6.1/ogre-v1-6-1.tar.bz2/download"
 =




From no-reply at zwischenwelt.org  Tue Aug 25 00:55:57 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 24 Aug 2009 22:55:57 -0000
Subject: [Iris-commit] [IRIS] r3117 - in /trunk/lua: gui/gui.map.lua
	lib.gfxconfig.lua
Message-ID: <20090824225557.A1AE37A9810A@simon>

Author: ghoulsblade
Date: Tue Aug 25 00:55:56 2009
New Revision: 3117

Log:
restored note

Modified:
    trunk/lua/gui/gui.map.lua
    trunk/lua/lib.gfxconfig.lua

Modified: trunk/lua/gui/gui.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.map.lua (original)
+++ trunk/lua/gui/gui.map.lua Tue Aug 25 00:55:56 2009
@@ -50,6 +50,30 @@
 end)
 ]]--
 =

+-- ##### ##### ##### ##### #####  map pieces =

+	 	 =

+function GuiMap_UpdateBla_CodeSample ()
+	-- update image codesample from compass
+	if (gGroundBlockLoader and gStaticBlockLoader and gRadarColorLoader) then =

+		local bx0,dbx =3D math.floor((xloc-kDetailMapCacheSize/2)/8),kDetailMapC=
acheSize/8 =

+		local by0,dby =3D math.floor((yloc-kDetailMapCacheSize/2)/8),kDetailMapC=
acheSize/8 =

+		GenerateRadarImage(gDetailMapCacheImage,bx0,by0,dbx,dby,gGroundBlockLoad=
er,gStaticBlockLoader,gRadarColorLoader) =

+		gDetailMapCacheBX =3D bx0 =

+		gDetailMapCacheBY =3D by0 =

+
+		-- create or update texture =

+		if (gDetailMapCacheTexture) then  =

+			gDetailMapCacheImage:LoadToTexture(gDetailMapCacheTexture) -- update ex=
isting texture =

+		else =

+			gDetailMapCacheTexture =3D gDetailMapCacheImage:MakeTexture() -- genera=
te new texture =

+		end =

+
+		-- create material on first time init =

+		if (not gDetailMapCacheMaterial) then =

+			gDetailMapCacheMaterial =3D GetPlainTextureMat(gDetailMapCacheTexture) =

+		end =

+	end =

+end =

 =

 -- ##### ##### ##### ##### #####  map
 -- ##### ##### ##### ##### #####  window

Modified: trunk/lua/lib.gfxconfig.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gfxconfig.lua (original)
+++ trunk/lua/lib.gfxconfig.lua Tue Aug 25 00:55:56 2009
@@ -106,7 +106,7 @@
 						local a =3D MyNormalizeValue(sConfigOptionValue)
 						local b =3D MyNormalizeValue(val)
 						local bCompareResult =3D a =3D=3D b or (string.find(a,"^"..b) ~=3D n=
il)
-						print("GfxConfig_SetOgreConfig: compare:",bCompareResult,WrapString(=
val),WrapString(sConfigOptionValue))
+						--~ print("GfxConfig_SetOgreConfig: compare:",bCompareResult,WrapStr=
ing(val),WrapString(sConfigOptionValue))
 						if (bCompareResult) then =

 							print("GfxConfig_SetOgreConfig: value set",WrapString(sConfigOption=
Name),WrapString(sConfigOptionValue))
 							Ogre_SetConfigOption(sConfigOptionName,sConfigOptionValue)



From no-reply at zwischenwelt.org  Tue Aug 25 14:17:04 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Aug 2009 12:17:04 -0000
Subject: [Iris-commit] [IRIS] r3118 - /trunk/scripts/luabindheader.lua
Message-ID: <20090825121704.C8A5F7A98101@simon>

Author: ghoulsblade
Date: Tue Aug 25 14:17:04 2009
New Revision: 3118

Log:
helper script to generate luabindings

Added:
    trunk/scripts/luabindheader.lua



From no-reply at zwischenwelt.org  Sat Aug 29 12:47:26 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 29 Aug 2009 10:47:26 -0000
Subject: [Iris-commit] [IRIS] r3119 - /trunk/data/models/programs/README
Message-ID: <20090829104726.4A2147A9810D@simon>

Author: sience
Date: Sat Aug 29 12:47:24 2009
New Revision: 3119

Log:
Hinweis das ich es bald l=C3=B6schen werde....wenn kein sinnvoller grund ge=
nannt wird...das es doppel in den Iris2 sourcen enthalten ist!

Modified:
    trunk/data/models/programs/README

Modified: trunk/data/models/programs/README
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/programs/README (original)
+++ trunk/data/models/programs/README Sat Aug 29 12:47:24 2009
@@ -1,3 +1,6 @@
+der Inhalt dieses Ordners sollte gel=C3=B6scht werden....da er auch in ogr=
eSampleMedia enthalten ist und leider standardm=C3=A4=C3=9Fig in die ressou=
rcen geaded wird!!!!!!!!!!!!!!!!!!!!!!!!
+
+
 shaders and materials from ogre examples
 =

 AmbientOneTexture.glsl



From no-reply at zwischenwelt.org  Sat Aug 29 12:57:24 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 29 Aug 2009 10:57:24 -0000
Subject: [Iris-commit] [IRIS] r3120 - in /trunk/data/models/programs:
 AmbientOneTexture.glsl Common.cg Example_Basic.cg Example_Basic.hlsl
 Examples.program OffsetMapping.cg OffsetMapping.hlsl OffsetMappingFp.glsl
 OffsetMappingVp.glsl OffsetMapping_specular.asm README knot.mesh
Message-ID: <20090829105726.839AD7A9810D@simon>

Author: sience
Date: Sat Aug 29 12:57:24 2009
New Revision: 3120

Log:
-doubled files deleted ->a copy is in ogreSampleMedia\materials\programs\ a=
nd models

Removed:
    trunk/data/models/programs/AmbientOneTexture.glsl
    trunk/data/models/programs/Common.cg
    trunk/data/models/programs/Example_Basic.cg
    trunk/data/models/programs/Example_Basic.hlsl
    trunk/data/models/programs/Examples.program
    trunk/data/models/programs/OffsetMapping.cg
    trunk/data/models/programs/OffsetMapping.hlsl
    trunk/data/models/programs/OffsetMappingFp.glsl
    trunk/data/models/programs/OffsetMappingVp.glsl
    trunk/data/models/programs/OffsetMapping_specular.asm
    trunk/data/models/programs/README
    trunk/data/models/programs/knot.mesh



From no-reply at zwischenwelt.org  Sat Aug 29 12:59:15 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 29 Aug 2009 10:59:15 -0000
Subject: [Iris-commit] [IRIS] r3121 -
	/trunk/data/ogreSampleMedia/models/knot.mesh
Message-ID: <20090829105915.530B67A9810D@simon>

Author: sience
Date: Sat Aug 29 12:59:13 2009
New Revision: 3121

Log:
-sample mesh added again

Added:
    trunk/data/ogreSampleMedia/models/knot.mesh   (with props)



From no-reply at zwischenwelt.org  Sat Aug 29 14:31:18 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 29 Aug 2009 12:31:18 -0000
Subject: [Iris-commit] [IRIS] r3122 - in /trunk/data/models/materials:
	OffsetMapping.material README
Message-ID: <20090829123118.BA1537A9810D@simon>

Author: sience
Date: Sat Aug 29 14:31:18 2009
New Revision: 3122

Log:
-this file is also double in iris2 (originally located in data\ogreSampleMe=
dia\materials\scripts\)
-so this one is removed

Removed:
    trunk/data/models/materials/OffsetMapping.material
    trunk/data/models/materials/README



From no-reply at zwischenwelt.org  Sat Aug 29 14:45:16 2009
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 29 Aug 2009 12:45:16 -0000
Subject: [Iris-commit] [IRIS] r3123 - in /trunk/lua: lib.configdialog.lua
	profiles/gfx_none.lua
Message-ID: <20090829124516.BAB437A9810D@simon>

Author: sience
Date: Sat Aug 29 14:45:16 2009
New Revision: 3123

Log:
-none profile option added (no gfx profile definitions)

Added:
    trunk/lua/profiles/gfx_none.lua
Modified:
    trunk/lua/lib.configdialog.lua

Modified: trunk/lua/lib.configdialog.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.configdialog.lua (original)
+++ trunk/lua/lib.configdialog.lua Sat Aug 29 14:45:16 2009
@@ -264,7 +264,7 @@
 	=

 	MyAddConfig_GlobalEnum("AntiAliasing","gGfxConfig_AntiAliasing",{"0","2",=
"4"})
 	=

-	local gfx_profile_list =3D {"ultralow", "low", "med", "high", "ultrahigh"=
} -- "none" ??
+	local gfx_profile_list =3D {"none", "ultralow", "low", "med", "high", "ul=
trahigh"}
 	MyAddConfig_GlobalEnum("Quality","gGraphicProfile",gfx_profile_list)
 	=

 	MyAddConfig_GlobalBool("(3D)bloom Shader","gEnableBloomShader")



