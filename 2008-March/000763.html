<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r1950 - in /trunk: include/grannyloader_i2.h lua/lib.unifont.lua src/data.cpp src/granny_L.cpp src/grannydump.cpp src/grannyloader_i2.cpp
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1950%20-%20in%20/trunk%3A%20include/grannyloader_i2.h%0A%20lua/lib.unifont.lua%20src/data.cpp%20src/granny_L.cpp%20src/grannydump.cpp%0A%20src/grannyloader_i2.cpp&In-Reply-To=%3C20080311014558.D5B8F1524010%40zwischenwelt.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000761.html">
   <LINK REL="Next"  HREF="000762.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r1950 - in /trunk: include/grannyloader_i2.h lua/lib.unifont.lua src/data.cpp src/granny_L.cpp src/grannydump.cpp src/grannyloader_i2.cpp</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1950%20-%20in%20/trunk%3A%20include/grannyloader_i2.h%0A%20lua/lib.unifont.lua%20src/data.cpp%20src/granny_L.cpp%20src/grannydump.cpp%0A%20src/grannyloader_i2.cpp&In-Reply-To=%3C20080311014558.D5B8F1524010%40zwischenwelt.org%3E"
       TITLE="[Iris-commit] [IRIS] r1950 - in /trunk: include/grannyloader_i2.h lua/lib.unifont.lua src/data.cpp src/granny_L.cpp src/grannydump.cpp src/grannyloader_i2.cpp">no-reply at zwischenwelt.org
       </A><BR>
    <I>Tue Mar 11 02:45:58 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000761.html">[Iris-commit] [IRIS] r1949 - in /trunk: data/config.lua.dist include/builder.h include/data.h lua/lib.loading.lua lua/lib.unifont.lua lua/main.lua src/builder.cpp src/data.cpp src/data_L.cpp
</A></li>
        <LI>Next message: <A HREF="000762.html">[Iris-commit] [IRIS] r1951 - in /trunk: lua/lib.unifont.lua	src/builder.cpp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#763">[ date ]</a>
              <a href="thread.html#763">[ thread ]</a>
              <a href="subject.html#763">[ subject ]</a>
              <a href="author.html#763">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ghoulsblade
Date: Tue Mar 11 02:45:57 2008
New Revision: 1950

Log:
fixed typo, experiment with unicode

Modified:
    trunk/include/grannyloader_i2.h
    trunk/lua/lib.unifont.lua
    trunk/src/data.cpp
    trunk/src/granny_L.cpp
    trunk/src/grannydump.cpp
    trunk/src/grannyloader_i2.cpp

Modified: trunk/include/grannyloader_i2.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/grannyloader_i2.h (original)
+++ trunk/include/grannyloader_i2.h Tue Mar 11 02:45:57 2008
@@ -140,7 +140,7 @@
 	std::vector&lt;const GrannyBoneTie*&gt;	mBoneTies; // 0xCA5E0c0a
 	std::vector&lt;cAnim&gt;				mAnims;
 	std::vector&lt;cSubMesh&gt;			mSubMeshes;
-	std::vector&lt;uint32&gt;				mTexureIDs;
+	std::vector&lt;uint32&gt;				mTextureIDs;
 	std::vector&lt;uint32&gt;				mBoneTies1; // 0xCA5E0f04
 	std::vector&lt;uint32&gt;				mBoneTies2; // 0XCA5E0C02
 	uint32							miLastKey;

Modified: trunk/lua/lib.unifont.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.unifont.lua (original)
+++ trunk/lua/lib.unifont.lua Tue Mar 11 02:45:57 2008
@@ -45,14 +45,15 @@
 end
 =

 -- texname,u0,v0,u1,v1,xoff,yoff,w,h
-function GetUniFontGlyph (fontloader,iCharcode)
+function GetUniFontGlyph (fontloader,iCharCode)
+	print(&quot;GetUniFontGlyph&quot;,fontloader,iCharCode)
 	if (not fontloader.glyphs) then fontloader.glyphs =3D {} end
-	local glyphdata =3D fontloader.glyphs[iCharcode]
+	local glyphdata =3D fontloader.glyphs[iCharCode]
 	if (glyphdata) then return unpack(glyphdata) end
 	if (glyphdata =3D=3D false) then return false end -- not loadable, don't =
retry
 	glyphdata =3D false
 	local img =3D CreateImage()
-	local success =3D fontloader:WriteGlyphToImage(img,iCharcode)
+	local success =3D fontloader:WriteGlyphToImage(img,iCharCode)
 	if (success) then
 		local xoff,yoff,w,h =3D gUniFontLoader:GetGlyphInfo(iCharCode)
 		local texname,u0,v0,u1,v1 =3D UniFont_AddImageToAtlas(img)
@@ -60,8 +61,8 @@
 	end
 	img:Destroy()
 	=

-	fontloader.glyphs[iCharcode] =3D glyphdata
-	return glyphdata
+	fontloader.glyphs[iCharCode] =3D glyphdata
+	return unpack(glyphdata)
 end
 =

 function UniFontTest ()
@@ -114,7 +115,8 @@
 		kCharCode_Cr	=3D string.byte(&quot;\r&quot;,1)
 		local spritelist =3D CreateSpriteList(gRenderMan2D_Dialogs,false,true) =

 		spritelist.asgroup =3D spritelist:CastToRenderGroup2D()
-		local texname =3D GetTexture(fontobj.sMatName)
+		local texname,u0,v0,u1,v1,xoff,yoff,fw,fh =3D GetUniFontGlyph(gUniFontLo=
ader,string.byte(&quot;A&quot;,1))
+		--~ local texname =3D GetTexture(fontobj.sMatName)
 		print(&quot;MyText&quot;,texname)
 		spritelist:SetTexture(texname)
 		local textlen =3D string.len(text)
@@ -126,15 +128,20 @@
 			local ctxt =3D string.sub(text,i,i)
 			print(&quot;MyText&quot;,i,c,ctxt)
 			local texname =3D nil
-			local iCharcode =3D c
-			--~ local texname,u0,v0,u1,v1,xoff,yoff,fw,fh =3D GetUniFontGlyph(gUniF=
ontLoader,iCharcode)
-			--~ local texname,u0,v0,u1,v1,xoff,yoff,fw,fh =3D GetUniFontGlyph(gUniF=
ontLoader,string.byte(&quot;a&quot;,1))
+			local iCharCode =3D c
+			--~ local texname,u0,v0,u1,v1,xoff,yoff,fw,fh =3D GetUniFontGlyph(gUniF=
ontLoader,iCharCode)
+			local texname,u0,v0,u1,v1,xoff,yoff,fw,fh =3D GetUniFontGlyph(gUniFontL=
oader,string.byte(&quot;A&quot;,1))
 			local glyph =3D fontobj.tGlyphTable[c]
 			local h =3D 44
 			local spacew =3D h * fontobj.tSpaceAspect
 			local tablen =3D 4
 			local tabmaxw =3D tablen * spacew
 			if (texname) then
+				print(&quot;unifont_lastret&quot;,texname,u0,v0,u1,v1,xoff,yoff,fw,fh)
+				local b =3D 2
+				fw,fh =3D b+fw+b,b+fh+b
+				fw,fh =3D fw*4,fh*4
+				--~ local fw,fh,u0,v0,u1,v1 =3D 128,128,0,0,1,1
 				local uvw, uvh =3D u1-u0,v1-v0
 				local iSpriteIndex, l,t,z =3D i-1,x,y,0
 				x =3D x + fw

Modified: trunk/src/data.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data.cpp (original)
+++ trunk/src/data.cpp Tue Mar 11 02:45:57 2008
@@ -42,7 +42,7 @@
 =

 	# radarcolor is stored in radarcol.mul, assigns a 16 bit color for every =
groundTileTypeID (&lt;0x00004000) to be displayed on worldmap or so
 =

-	# tileType data is stored in tiledata.mul : flags, id_override for texure
+	# tileType data is stored in tiledata.mul : flags, id_override for texture
 =

 	# Art means 2D graphics, most in iso perspektive, data comes from artidx.=
mul and art.mul
 	used for both iso-ground tiles and 2d gfx for statics, art-index =3D tile=
TypeIndex

Modified: trunk/src/granny_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/granny_L.cpp (original)
+++ trunk/src/granny_L.cpp Tue Mar 11 02:45:57 2008
@@ -188,17 +188,17 @@
 		}
 		=

 		/// int GetTextureIDCount () =

-		/// number of TexureIDs
+		/// number of TextureIDs
 		static int	GetTextureIDCount	(lua_State *L) { PROFILE =

-			lua_pushnumber(L,checkudata_alive(L)-&gt;mTexureIDs.size()); =

+			lua_pushnumber(L,checkudata_alive(L)-&gt;mTextureIDs.size()); =

 			return 1; =

 		}
 		=

 		/// int GetTextureID (int index) =

 		static int	GetTextureID	(lua_State *L) { PROFILE =

 			int index =3D (lua_gettop(L) &gt;=3D 2 &amp;&amp; !lua_isnil(L,2)) ? luaL_checkint=
(L,2) : 0;
-			if (index &lt; 0 || index &gt;=3D checkudata_alive(L)-&gt;mTexureIDs.size()) ret=
urn 0;
-			lua_pushnumber(L,checkudata_alive(L)-&gt;mTexureIDs[index]); =

+			if (index &lt; 0 || index &gt;=3D checkudata_alive(L)-&gt;mTextureIDs.size()) re=
turn 0;
+			lua_pushnumber(L,checkudata_alive(L)-&gt;mTextureIDs[index]); =

 			return 1; =

 		}
 		=


Modified: trunk/src/grannydump.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/grannydump.cpp (original)
+++ trunk/src/grannydump.cpp Tue Mar 11 02:45:57 2008
@@ -263,7 +263,7 @@
 	std::vector&lt;const GrannyBoneTie*&gt;	mBoneTies; // 0xCA5E0c0a
 	std::vector&lt;cAnim&gt;				mAnims;
 	std::vector&lt;cSubMesh&gt;			mSubMeshes;
-	std::vector&lt;uint32&gt;				mTexureIDs;
+	std::vector&lt;uint32&gt;				mTextureIDs;
 	std::vector&lt;uint32&gt;				mBoneTies1; // 0xCA5E0f04
 	std::vector&lt;uint32&gt;				mBoneTies2; // 0XCA5E0C02
 	struct GrannyBone {

Modified: trunk/src/grannyloader_i2.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/grannyloader_i2.cpp (original)
+++ trunk/src/grannyloader_i2.cpp Tue Mar 11 02:45:57 2008
@@ -220,7 +220,7 @@
 }
 /// 0xCA5E0f04
 void	cGrannyLoader_i2::VisitTexInfoID			(const uint32 iID) {
-	mTexureIDs.push_back(iID);
+	mTextureIDs.push_back(iID);
 }
 /// 0XCA5E0C08
 void	cGrannyLoader_i2::VisitBoneTie2ID			(const uint32 iID) {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000761.html">[Iris-commit] [IRIS] r1949 - in /trunk: data/config.lua.dist include/builder.h include/data.h lua/lib.loading.lua lua/lib.unifont.lua lua/main.lua src/builder.cpp src/data.cpp src/data_L.cpp
</A></li>
	<LI>Next message: <A HREF="000762.html">[Iris-commit] [IRIS] r1951 - in /trunk: lua/lib.unifont.lua	src/builder.cpp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#763">[ date ]</a>
              <a href="thread.html#763">[ thread ]</a>
              <a href="subject.html#763">[ subject ]</a>
              <a href="author.html#763">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
