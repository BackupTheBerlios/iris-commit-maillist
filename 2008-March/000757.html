<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r1945 - in /trunk: bin/ data/ data/gfm/ data/models/atlas/ data/models/materials/ data/models/models/ data/models/models/to_004000/ data/models/textures/ data/terrain/materials/ lua/ lua/filter/ lua/gui/
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1945%20-%20in%20/trunk%3A%20bin/%20data/%20data/gfm/%0A%20data/models/atlas/%20data/models/materials/%20data/models/models/%0A%20data/models/models/to_004000/%20data/models/textures/%20data/terrain/materials/%0A%20lua/%20lua/filter/%20lua/gui/&In-Reply-To=%3C20080305204236.0477D152400E%40zwischenwelt.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000756.html">
   <LINK REL="Next"  HREF="000758.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r1945 - in /trunk: bin/ data/ data/gfm/ data/models/atlas/ data/models/materials/ data/models/models/ data/models/models/to_004000/ data/models/textures/ data/terrain/materials/ lua/ lua/filter/ lua/gui/</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1945%20-%20in%20/trunk%3A%20bin/%20data/%20data/gfm/%0A%20data/models/atlas/%20data/models/materials/%20data/models/models/%0A%20data/models/models/to_004000/%20data/models/textures/%20data/terrain/materials/%0A%20lua/%20lua/filter/%20lua/gui/&In-Reply-To=%3C20080305204236.0477D152400E%40zwischenwelt.org%3E"
       TITLE="[Iris-commit] [IRIS] r1945 - in /trunk: bin/ data/ data/gfm/ data/models/atlas/ data/models/materials/ data/models/models/ data/models/models/to_004000/ data/models/textures/ data/terrain/materials/ lua/ lua/filter/ lua/gui/">no-reply at zwischenwelt.org
       </A><BR>
    <I>Wed Mar  5 21:42:34 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000756.html">[Iris-commit] [IRIS] r1944 - /trunk/lua/main.lua
</A></li>
        <LI>Next message: <A HREF="000758.html">[Iris-commit] [IRIS] r1946 - /trunk/lua/main.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#757">[ date ]</a>
              <a href="thread.html#757">[ thread ]</a>
              <a href="subject.html#757">[ subject ]</a>
              <a href="author.html#757">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: sience
Date: Wed Mar  5 21:42:33 2008
New Revision: 1945

Log:
-win32 binary
-paperdoll gump modified for weapon abilities
-amient lightning increased
-new cedartree mesh + textures (old meshes+textures deleted)
-new grass texture (the original one)
-some gumpparser functions local defined

Added:
    trunk/data/models/textures/firneedle_texture.dds   (with props)
    trunk/data/models/textures/tex_grass_alpha.png   (with props)
Removed:
    trunk/data/models/atlas/tex_atlas_alpha_med0.dds
    trunk/data/models/atlas/tex_atlas_alpha_med1.dds
    trunk/data/models/atlas/tex_atlas_med0.dds
    trunk/data/models/atlas/tex_atlas_med1.dds
    trunk/data/models/atlas/tex_atlas_med2.dds
    trunk/data/models/atlas/tex_atlas_med3.dds
    trunk/data/models/atlas/tex_atlas_med4.dds
    trunk/data/models/models/to_004000/mdl_003288.mesh
    trunk/data/models/models/to_004000/mdl_003289.mesh
    trunk/data/models/textures/tex_441.png
    trunk/data/models/textures/tex_560.png
Modified:
    trunk/bin/iris2.exe
    trunk/data/config.lua.dist
    trunk/data/gfm/player_paperdoll.gfm
    trunk/data/models/materials/textures.material
    trunk/data/models/models/textures_skipped_in_atlas.txt
    trunk/data/models/models/to_004000/mdl_003286.mesh
    trunk/data/models/models/to_004000/mdl_003287.mesh
    trunk/data/models/textures/tex_grass.png
    trunk/data/terrain/materials/terrain.material
    trunk/lua/filter/filter.art.lua
    trunk/lua/gui/gui.paperdoll.lua
    trunk/lua/lib.gumpparser.lua
    trunk/lua/lib.keybinds.lua
    trunk/lua/lib.spellbooks.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Wed Mar  5 21:42:33 2008
@@ -100,7 +100,7 @@
 gSunLightSpecular =3D {r=3D1.0,g=3D1.0,b=3D1.0}
 =

 -- Ambient Light
-gAmbientLight =3D {r=3D0.4,g=3D0.4,b=3D0.4}
+gAmbientLight =3D {r=3D0.6,g=3D0.6,b=3D0.6}
 =

 -- Soundeffects &amp; Music
 -- gUseSoundSystem =3D &quot;openal&quot;

Modified: trunk/data/gfm/player_paperdoll.gfm
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/gfm/player_paperdoll.gfm (original)
+++ trunk/data/gfm/player_paperdoll.gfm Wed Mar  5 21:42:33 2008
@@ -50,8 +50,16 @@
  &lt;event onclick=3D'' onclose=3D'' onmouseup=3D'' onmousedown=3D'' onkeypre=
ssed=3D''/&gt;
  &lt;gump normal=3D'0x7D2' over=3D'0x7D2' pressed=3D'0x7D2'/&gt;
 &lt;/control&gt;
-&lt;control class=3D'button' name=3D'btn_virtues' left=3D'80' top=3D'3' width=
=3D'32' height=3D'32' freezed=3D'0' visible=3D'1' alpha=3D'0' flags=3D'0'&gt;
+&lt;control class=3D'button' name=3D'btn_virtues' left=3D'80' top=3D'3' width=
=3D'32' height=3D'32' freezed=3D'1' visible=3D'1' alpha=3D'0' flags=3D'0'&gt;
  &lt;event onclick=3D'' onclose=3D'' onmouseup=3D'' onmousedown=3D'' onkeypre=
ssed=3D''/&gt;
  &lt;gump normal=3D'0x71' over=3D'0x71' pressed=3D'0x71'/&gt;
 &lt;/control&gt;
+&lt;control class=3D'button' name=3D'btn_specialAbilities' left=3D'156' top=
=3D'199' width=3D'15' height=3D'47' freezed=3D'1' visible=3D'1' alpha=3D'0'=
 flags=3D'0'&gt;
+ &lt;event onclick=3D'' onclose=3D'' onmouseup=3D'' onmousedown=3D'' onkeypre=
ssed=3D''/&gt;
+ &lt;gump normal=3D'0x2B34' over=3D'0x2B34' pressed=3D'0x2B34'/&gt;
+&lt;/control&gt;
+&lt;control class=3D'button' name=3D'btn_party' left=3D'41' top=3D'195' width=
=3D'19' height=3D'51' freezed=3D'1' visible=3D'1' alpha=3D'0' flags=3D'0'&gt;
+ &lt;event onclick=3D'' onclose=3D'' onmouseup=3D'' onmousedown=3D'' onkeypre=
ssed=3D''/&gt;
+ &lt;gump normal=3D'0x7D2' over=3D'0x7D2' pressed=3D'0x7D2'/&gt;
+&lt;/control&gt;
 &lt;/form&gt;

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Wed Mar  5 21:42:33 2008
@@ -5366,20 +5366,6 @@
 	} =

 }
 =

-material tex_441 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass =

-		{		=

-			texture_unit =

-			{ =

-				texture tex_441.png =

-			}	=

-		}
-	} =

-}
-
 material tex_442 : tex_base_alpha =

 { =

 	technique =

@@ -7209,20 +7195,6 @@
 			texture_unit =

 			{ =

 				texture tex_55.png =

-			}	=

-		}
-	} =

-}
-
-material tex_560 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass =

-		{		=

-			texture_unit =

-			{ =

-				texture tex_560.png =

 			}	=

 		}
 	} =

@@ -8342,3 +8314,36 @@
 		}
 	} =

 }
+
+material cedar_bark : tex_base
+{
+	technique
+	{
+		pass
+		{
+			texture_unit
+			{
+				texture tex_550.png =

+			}
+		}
+	}
+}
+
+material cedars : tex_base_alpha
+{
+	technique
+	{
+		pass
+		{
+			alpha_rejection greater_equal 55
+//			scene_blend alpha_blend
+//			depth_write off
+//			depth_check on
+
+			texture_unit
+			{
+				texture firneedle_texture.dds
+			}
+		}
+	}
+}

Modified: trunk/data/models/models/textures_skipped_in_atlas.txt
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/textures_skipped_in_atlas.txt (original)
+++ trunk/data/models/models/textures_skipped_in_atlas.txt Wed Mar  5 21:42=
:<i>33 2008
</I>@@ -1,2 +1,3 @@
 tex_grass
 tex_fernleaf
+firneedle_texture

Modified: trunk/data/models/models/to_004000/mdl_003286.mesh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/models/to_004000/mdl_003287.mesh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/textures/tex_grass.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Wed Mar  5 21:42:33 2008
@@ -21,6 +21,7 @@
 }
 =

 // simple material without transitions
+//material terrain_multitex_simple_mat
 material terrain_multitex_simple_mat
 {
 	receive_shadows on
@@ -41,6 +42,7 @@
 	}
 }
 =

+//material terrain_multitex_mat : Ogre/DepthShadowmap/BasicTemplateMaterial
 material terrain_multitex_mat
 {
 	receive_shadows on

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Wed Mar  5 21:42:33 2008
@@ -146,7 +146,8 @@
 gArtFilter[3320]=3D{maptoid=3D3274}
 =

 -- cedar tree
-gArtFilter[3288]=3D{maptoid=3D3286,xadd=3D0.8,yadd=3D-0.7,zadd=3D0}
+gArtFilter[3288]=3D{maptoid=3D3286,xadd=3D0.8,yadd=3D-0.7,zadd=3D0}	-- ced=
arbark
+gArtFilter[3289]=3D{maptoid=3D3287,xadd=3D0.8,yadd=3D-0.7,zadd=3D0}	-- ced=
ars
 =

 -- mushrooms
 gArtFilter[3352]=3D{maptoid=3D3351}

Modified: trunk/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.paperdoll.lua (original)
+++ trunk/lua/gui/gui.paperdoll.lua Wed Mar  5 21:42:33 2008
@@ -156,6 +156,16 @@
 																AddFadeLines(&quot;btn_scroll&quot;)
 															end
 														end
+			dialog.controls[&quot;btn_party&quot;].onMouseDown =3D function (widget,mousebutt=
on)
+															if (mousebutton =3D=3D 1) then
+																AddFadeLines(&quot;btn_party&quot;)
+															end
+														end
+			dialog.controls[&quot;btn_specialAbilities&quot;].onMouseDown =3D function (widge=
t,mousebutton)
+															if (mousebutton =3D=3D 1) then
+																AddFadeLines(&quot;btn_specialAbilities&quot;)
+															end
+														end
 			--  TODO : btn_quit
 		else
 			dialog.controls[&quot;btn_status&quot;].onMouseDown =3D function (widget,mousebut=
ton)
@@ -431,3 +441,4 @@
   };   =

 ]]--
 =

+

Modified: trunk/lua/lib.gumpparser.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gumpparser.lua (original)
+++ trunk/lua/lib.gumpparser.lua Wed Mar  5 21:42:33 2008
@@ -9,12 +9,109 @@
 entry enclosed with @'s can be used. With this you can specify texts that =
will be added to the CliLoc entry.
 ]]--
 =

-gHorizontal_Textcorrection=3D5
-
 gServerSideGump =3D {}
 gGumpPosition =3D {}
 =

-function ServerSideGump_GetParams (dialogId)
+-- simple html parser (only center,basefont,br and color tags yep realized)
+-- TODO : BODY, &lt;A HREF=3D&quot;<A HREF="HTTP://www.polserver.com">HTTP://www.polserver.com</A>&quot;&gt;This is a link&lt;/A&gt;
+local function HtmlParser(textstring)
+	local msg =3D {}
+	msg.text =3D &quot;&quot;
+	msg.center =3D false
+	msg.hue =3D &quot;&quot;
+	msg.charh =3D gFontGumpSize	--standard
+	msg.bold =3D false
+	msg.underline =3D false
+	msg.italic =3D false
+	msg.div =3D 0			--div=3D1, right=3D2, left=3D3, center=3D4
+	msg.body =3D false
+	msg.font =3D &quot;&quot;
+	msg.href =3D &quot;&quot;
+
+	if (not(textstring)) then return msg end
+
+	local bToken =3D {}
+
+	--extract tokens
+	for token in string.gfind(textstring, &quot;%w+&quot;) do table.insert(bToken,token=
) end
+
+	-- if &gt; 0 it skips the next tokens
+	local skipnexttoken =3D 0
+	=

+	--parse tokens
+	for z=3D1, table.getn(bToken) do
+		local command =3D string.lower(bToken[z])
+
+		if (skipnexttoken &lt;=3D 0) then
+
+		if (command =3D=3D &quot;basefont&quot; ) then
+			if (table.getn(bToken)&gt;=3D z+2) then
+				if (string.lower(bToken[z+1])=3D=3D&quot;color&quot;) then
+					--could be a hex value &quot;msg_hue: 0xFFFFFF&quot; or a colorname like &quot;msg_h=
ue: 0xYELLOW&quot;
+					msg.hue =3D &quot;0x&quot;..bToken[z+2]
+				end
+				skipnexttoken=3D2
+			end
+			if (table.getn(bToken)&gt;=3D z+2) then
+				if (string.lower(bToken[z+1])=3D=3D&quot;size&quot;) then
+					msg.charh =3D msg.charh+bToken[z+2]
+				end
+				skipnexttoken=3D2
+			end
+		elseif (command =3D=3D &quot;br&quot;) then
+			msg.text =3D msg.text..&quot;\n&quot;
+		elseif (command =3D=3D &quot;center&quot;) then
+			msg.center =3D true
+		elseif (command =3D=3D &quot;b&quot;) then
+			msg.bold =3D true
+		elseif (command =3D=3D &quot;big&quot;) then
+			msg.bold =3D true
+		elseif (command =3D=3D &quot;u&quot;) then
+			msg.underline =3D true
+		elseif (command =3D=3D &quot;i&quot;) then
+			msg.italic =3D true
+		elseif (command =3D=3D &quot;div&quot;) then
+			msg.div=3D 1
+			if (table.getn(bToken) &gt;=3D z+2) then
+				if (string.lower(bToken[z+1])=3D=3D&quot;align&quot;) then
+					if (string.lower(bToken[z+2])=3D=3D&quot;left&quot;) then
+						msg.div=3D2
+						skipnexttoken=3Dskipnexttoken+1
+					elseif (string.lower(bToken[z+2])=3D=3D&quot;right&quot;) then
+						msg.div=3D3
+						skipnexttoken=3Dskipnexttoken+1
+					elseif (string.lower(bToken[z+2])=3D=3D&quot;center&quot;) then
+						msg.div=3D4
+						skipnexttoken=3Dskipnexttoken+1
+					end
+					skipnexttoken=3Dskipnexttoken+1
+				end
+			end
+		elseif (command =3D=3D &quot;body&quot;) then
+			msg.body =3D true
+		elseif (command =3D=3D &quot;font&quot;) then
+			msg.font =3D &quot;&quot;
+		elseif (command =3D=3D &quot;a&quot;) then
+			if (table.getn(bToken)&gt;=3D z+2) then
+				if (string.lower(bToken[z+1])=3D=3D&quot;href&quot;) then
+					-- TODO: get URL
+					skipnexttoken=3D2
+				end
+			end
+		else
+			msg.text=3Dmsg.text..&quot; &quot;..bToken[z]
+		end
+		=

+		else
+			skipnexttoken =3D skipnexttoken - 1
+		end
+	end
+
+--	printdebug(&quot;gump&quot;,&quot;formated-html-string: &quot;..msg.text)
+	return msg
+end
+
+local function ServerSideGump_GetParams (dialogId)
 	local params =3D {}
 	params.switches =3D {}
 	params.texts =3D {}
@@ -49,6 +146,8 @@
 end
 =

 function GumpParser(Gumpdata)
+	local htext_correction=3D5
+
 	if (not gGumpLoader) then return end
 =

 	-- close already existing dialog with the same id
@@ -58,20 +157,21 @@
 =

 	-- create new Dialog
 	local dialog =3D guimaker.MakeSortedDialog()
-	--print(&quot;create gump&quot;)
 =

 	-- set Dialog ID / Serial
 	dialog.dialogId =3D Gumpdata.dialogId
-	--print(&quot;dialogID=3D&quot;..dialog.dialogId)
+	=

+	-- if dialogid is a clientside dialog (found in clientside dialoglist)...=
 turn of send packets and turn on function handler
+	--if dialog.dialogId =3D &quot;paperdoll&quot; then
+	--	gClientsideManualGump=3Dtrue
+	--end
 =

 	dialog.Close =3D function (dialog)
-	--print(&quot;Close:dialogID=3D&quot;..dialog.dialogId)
 		gGumpPosition[dialog.dialogId] =3D { x=3Ddialog.rootwidget.gfx:GetDerive=
dLeft() , y=3Ddialog.rootwidget.gfx:GetDerivedTop() }
         dialog:SetVisible(false)
 		gServerSideGump[dialog.dialogId] =3D nil
 		dialog:Destroy()
 		dialog =3D nil
-		--print(&quot;close / destory gump&quot;)
 	end
 =

 	dialog.controls =3D {} -- associative list of controlls, key=3Dname of co=
ntroll
@@ -178,7 +278,7 @@
 			elseif ((command =3D=3D &quot;xmfhtmlgump&quot;) and (table.getn(bToken)&gt;=3D 8)) =
then
 				local msg =3D HtmlParser( gClilocLoader and gClilocLoader:Get(bToken[6=
]) or &quot;no_cliloc&quot; )
 				printdebug(&quot;gump&quot;,&quot;Cliloc Msg (&quot;..bToken[6]..&quot;): &quot;..msg.text)
-				local widget =3D guimaker.MakeWrappedClippedText (curparent, bToken[2]=
, bToken[3]+gHorizontal_Textcorrection,
+				local widget =3D guimaker.MakeWrappedClippedText (curparent, bToken[2]=
, bToken[3]+htext_correction,
 																bToken[4], bToken[5], UnicodeFix(msg.text), msg.charh, {1.=
0,1.0,1.0,1.0},
 																msg.center, msg.div, gFontNameDefault)
 			--xmfhtmlgumpcolor &lt;x&gt; &lt;y&gt; &lt;width&gt; &lt;height&gt; &lt;cliloc-nr&gt; &lt;background&gt; &lt;s=
crollbar&gt; &lt;color&gt;
@@ -188,7 +288,7 @@
 			elseif ((command =3D=3D &quot;xmfhtmlgumpcolor&quot;) and (table.getn(bToken)&gt;=3D=
 9)) then
 				local msg =3D HtmlParser(  gClilocLoader and gClilocLoader:Get(bToken[=
6]) or &quot;no_cliloc&quot; )
 				printdebug(&quot;gump&quot;,&quot;Cliloc Msg (&quot;..bToken[6]..&quot;): &quot;..msg.text)
-				local widget =3D guimaker.MakeWrappedClippedText (curparent, bToken[2]=
, bToken[3]+gHorizontal_Textcorrection,
+				local widget =3D guimaker.MakeWrappedClippedText (curparent, bToken[2]=
, bToken[3]+htext_correction,
 																bToken[4], bToken[5], UnicodeFix(msg.text), msg.charh, {1.=
0,1.0,1.0,1.0},
 																msg.center, msg.div, gFontNameDefault)
 			--gumppic &lt;x&gt; &lt;y&gt; &lt;gumpid&gt; [hue=3D353]
@@ -216,7 +316,7 @@
 			-- TODO : HUE-color
 			elseif ((command =3D=3D &quot;text&quot;) and (table.getn(bToken)&gt;=3D 5)) then
 				local text =3D Gumpdata.textline[tonumber(bToken[5])] or &quot;No text&quot;
-				local widget =3D guimaker.MakeText (curparent, bToken[2], bToken[3]+gH=
orizontal_Textcorrection, UnicodeFix(text),
+				local widget =3D guimaker.MakeText (curparent, bToken[2], bToken[3]+ht=
ext_correction, UnicodeFix(text),
 													gFontGumpSize, {190/255,237/255,231/255,1.0}, gFontNameDefaul=
t)
 			--Button &lt;x&gt; &lt;y&gt; &lt;released-id&gt; &lt;pressed-id&gt; &lt;quit&gt; &lt;page-id&gt; &lt;return-va=
lue&gt;
 			--Description:  Adds a button to the gump with the specified coordinate=
s and button graphics.
@@ -295,7 +395,7 @@
 			-- TODO : HUE
 			elseif ((command =3D=3D &quot;croppedtext&quot;) and (table.getn(bToken)&gt;=3D 7)) =
then
 				local msg =3D HtmlParser( Gumpdata.textline[tonumber(bToken[7])] )
-				local widget =3D guimaker.MakeWrappedClippedText (curparent, bToken[2]=
, bToken[3]+gHorizontal_Textcorrection,
+				local widget =3D guimaker.MakeWrappedClippedText (curparent, bToken[2]=
, bToken[3]+htext_correction,
 																bToken[4], bToken[5], UnicodeFix(msg.text), msg.charh, {92=
/255,92/255,178/255,1.0},
 																msg.center, msg.div, gFontNameDefault)
 			--radio &lt;x&gt; &lt;y&gt; &lt;released gumpid&gt; &lt;pressed gumpid&gt; &lt;status&gt; &lt;return-val=
ue&gt;
@@ -374,7 +474,7 @@
 			--{ htmlgump 10 8 100 20 0 0 0 }
 			elseif ((command =3D=3D &quot;htmlgump&quot;) and (table.getn(bToken)&gt;=3D 7)) then
 				local msg =3D HtmlParser( Gumpdata.textline[tonumber(bToken[6])] )
-				local widget =3D guimaker.MakeWrappedClippedText (curparent, bToken[2]=
, bToken[3]+gHorizontal_Textcorrection,
+				local widget =3D guimaker.MakeWrappedClippedText (curparent, bToken[2]=
, bToken[3]+htext_correction,
 																bToken[4], bToken[5], msg.text, msg.charh, {1.0,1.0,1.0,1.=
0},
 																msg.center, msg.div, gFontNameDefault)
 			--tooltip &lt;cliloc-nr&gt;
@@ -408,102 +508,3 @@
 	-- TODO : set correct Alpha Value
 	--SetDialogAlpha(dialog, 1.0)
 end
-
--- simple html parser (only center,basefont,br and color tags yep realized)
--- TODO : BODY, &lt;A HREF=3D&quot;<A HREF="HTTP://www.polserver.com">HTTP://www.polserver.com</A>&quot;&gt;This is a link&lt;/A&gt;
-function HtmlParser(textstring)
-	local msg =3D {}
-	msg.text =3D &quot;&quot;
-	msg.center =3D false
-	msg.hue =3D &quot;&quot;
-	msg.charh =3D gFontGumpSize	--standard
-	msg.bold =3D false
-	msg.underline =3D false
-	msg.italic =3D false
-	msg.div =3D 0			--div=3D1, right=3D2, left=3D3, center=3D4
-	msg.body =3D false
-	msg.font =3D &quot;&quot;
-	msg.href =3D &quot;&quot;
-
-	if (not(textstring)) then return msg end
-
-	local bToken =3D {}
-
-	--extract tokens
-	for token in string.gfind(textstring, &quot;%w+&quot;) do table.insert(bToken,token=
) end
-
-	-- if &gt; 0 it skips the next tokens
-	local skipnexttoken =3D 0
-	=

-	--parse tokens
-	for z=3D1, table.getn(bToken) do
-		local command =3D string.lower(bToken[z])
-
-		if (skipnexttoken &lt;=3D 0) then
-
-		if (command =3D=3D &quot;basefont&quot; ) then
-			if (table.getn(bToken)&gt;=3D z+2) then
-				if (string.lower(bToken[z+1])=3D=3D&quot;color&quot;) then
-					--could be a hex value &quot;msg_hue: 0xFFFFFF&quot; or a colorname like &quot;msg_h=
ue: 0xYELLOW&quot;
-					msg.hue =3D &quot;0x&quot;..bToken[z+2]
-				end
-				skipnexttoken=3D2
-			end
-			if (table.getn(bToken)&gt;=3D z+2) then
-				if (string.lower(bToken[z+1])=3D=3D&quot;size&quot;) then
-					msg.charh =3D msg.charh+bToken[z+2]
-				end
-				skipnexttoken=3D2
-			end
-		elseif (command =3D=3D &quot;br&quot;) then
-			msg.text =3D msg.text..&quot;\n&quot;
-		elseif (command =3D=3D &quot;center&quot;) then
-			msg.center =3D true
-		elseif (command =3D=3D &quot;b&quot;) then
-			msg.bold =3D true
-		elseif (command =3D=3D &quot;big&quot;) then
-			msg.bold =3D true
-		elseif (command =3D=3D &quot;u&quot;) then
-			msg.underline =3D true
-		elseif (command =3D=3D &quot;i&quot;) then
-			msg.italic =3D true
-		elseif (command =3D=3D &quot;div&quot;) then
-			msg.div=3D 1
-			if (table.getn(bToken) &gt;=3D z+2) then
-				if (string.lower(bToken[z+1])=3D=3D&quot;align&quot;) then
-					if (string.lower(bToken[z+2])=3D=3D&quot;left&quot;) then
-						msg.div=3D2
-						skipnexttoken=3Dskipnexttoken+1
-					elseif (string.lower(bToken[z+2])=3D=3D&quot;right&quot;) then
-						msg.div=3D3
-						skipnexttoken=3Dskipnexttoken+1
-					elseif (string.lower(bToken[z+2])=3D=3D&quot;center&quot;) then
-						msg.div=3D4
-						skipnexttoken=3Dskipnexttoken+1
-					end
-					skipnexttoken=3Dskipnexttoken+1
-				end
-			end
-		elseif (command =3D=3D &quot;body&quot;) then
-			msg.body =3D true
-		elseif (command =3D=3D &quot;font&quot;) then
-			msg.font =3D &quot;&quot;
-		elseif (command =3D=3D &quot;a&quot;) then
-			if (table.getn(bToken)&gt;=3D z+2) then
-				if (string.lower(bToken[z+1])=3D=3D&quot;href&quot;) then
-					-- TODO: get URL
-					skipnexttoken=3D2
-				end
-			end
-		else
-			msg.text=3Dmsg.text..&quot; &quot;..bToken[z]
-		end
-		=

-		else
-			skipnexttoken =3D skipnexttoken - 1
-		end
-	end
-
---	printdebug(&quot;gump&quot;,&quot;formated-html-string: &quot;..msg.text)
-	return msg
-end

Modified: trunk/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.keybinds.lua (original)
+++ trunk/lua/lib.keybinds.lua Wed Mar  5 21:42:33 2008
@@ -1,4 +1,4 @@
-function BindGeneralKeys ()
+local function BindGeneralKeys ()
 	Bind(&quot;escape&quot;,	function (state) =

 			if (state &gt; 0) then =

 			if (not gActiveEditText) then =

@@ -9,8 +9,6 @@
 			end =

 		end)
 end
-
-BindGeneralKeys()
 =

 function BindInGameKeys()
 	UnbindAll()
@@ -72,7 +70,36 @@
 			--Send_AOSCommand(kPacket_AOS_Command_WeaponAbilityRequest,hex2num(&quot;0x1=
&quot;),2)
 		 end end end)
 	=

-		Bind(&quot;f2&quot;,		function (state) if (not gActiveEditText) then if (state &gt; 0=
) then =

+		Bind(&quot;f2&quot;,		function (state) if (not gActiveEditText) then if (state &gt; 0=
) then
+-- Created 05.03.2008 15:55:43, with GumpStudio &amp; Iris2 Lua Export Plugin
+-- Exported Iris2 GumpExporter ver 1.0.
+local manualGump =3D {}
+manualGump.dialogId =3D 1234
+manualGump.x =3D 10
+manualGump.x =3D 10
+manualGump.Data =3D
+	 &quot;{ page 0 }&quot; ..
+	 &quot;{ gumppic 4 4 2000  }&quot; ..
+	 &quot;{ gumppic 10 17 12  }&quot; ..
+	 &quot;{ button 187 50 2031 2032 1 0 0 }&quot; ..
+	 &quot;{ button 187 76 2006 2007 1 0 0 }&quot; ..
+	 &quot;{ text 36 271 0 0 }&quot; ..
+	 &quot;{ button 84 6 113 113 1 0 0 }&quot; ..
+	 &quot;{ button 187 102 2009 2010 1 0 0 }&quot; ..
+	 &quot;{ button 187 130 22453 22455 1 0 0 }&quot; ..
+	 &quot;{ button 187 156 2015 2016 1 0 0 }&quot; ..
+	 &quot;{ button 187 181 22450 22452 1 0 0 }&quot; ..
+	 &quot;{ button 187 205 2021 2022 1 0 0 }&quot; ..
+	 &quot;{ button 187 233 2027 2028 1 0 0 }&quot; ..
+	 &quot;&quot; =

+manualGump.textline =3D {
+	[0] =3D &quot;status_name&quot;,
+}
+
+GumpParser( manualGump )
+
+
+--[[
 			local mobile =3D GetPlayerMobile()
 			if mobile then
 				local effect =3D {}
@@ -90,8 +117,7 @@
 				effect.itemid =3D 119--hex2num(&quot;0x376A&quot;)
 				gCurrentRenderer:AddEffect(effect)
 			end
+]]--
 		end end end)
 	end
-
-
 end

Modified: trunk/lua/lib.spellbooks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.spellbooks.lua (original)
+++ trunk/lua/lib.spellbooks.lua Wed Mar  5 21:42:33 2008
@@ -472,16 +472,6 @@
 }
 =

 --[[
-	{name,manacost,minskill,description} -- todo : look description up in cli=
loc and store id instead of text
-	samurai_bushido =3D {	=

-		{&quot;Honorable Execution&quot;,	0,25,&quot;Attempts to deliver a killing attack to yo=
ur opponent...&quot;},
-		{&quot;Confidence&quot;,			10,25,&quot;Places you in a defensive stance of confidence, =
...&quot;},
-		{&quot;Evasion&quot;,				10,60,&quot;Puts you in an evasive stance ...&quot;},
-		{&quot;Counter Attack&quot;,		5,40,&quot;Places you in a defensive stance that allows y=
ou to automatically counter attack ...&quot;},
-		{&quot;Lightning Strike&quot;,	5,50,&quot;An attack with a large bonus to your chance t=
o hit.&quot;},
-		{&quot;Momentum Strike&quot;,		10,70,&quot;If you strike an opponent with this ability,=
 you will automatically strike another nearby opponent. ...&quot;},
-	}
-	=

 	ninjitsu =3D {
 		{&quot;Focus Attack&quot;,	10,30,&quot;Increases both your damage and the percentage ch=
ance for \&quot;hit\&quot; properties on your weapon for one attack&quot;},
 		{&quot;Death Strike&quot;,	30,85,&quot;After receiving a Death Strike, if the opponent =
moves more than five steps or five seconds elapses, they will suffer direct=
 damage determined by the attacker's ninjitsu.&quot;},


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000756.html">[Iris-commit] [IRIS] r1944 - /trunk/lua/main.lua
</A></li>
	<LI>Next message: <A HREF="000758.html">[Iris-commit] [IRIS] r1946 - /trunk/lua/main.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#757">[ date ]</a>
              <a href="thread.html#757">[ thread ]</a>
              <a href="subject.html#757">[ subject ]</a>
              <a href="author.html#757">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
