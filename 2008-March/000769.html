<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r1957 - in /trunk: data/ data/gfm/ lua/	lua/gui/ lua/net/ lua/obj/
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1957%20-%20in%20/trunk%3A%20data/%20data/gfm/%20lua/%0A%09lua/gui/%20lua/net/%20lua/obj/&In-Reply-To=%3C20080312205634.3903C1524013%40zwischenwelt.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000768.html">
   <LINK REL="Next"  HREF="000770.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r1957 - in /trunk: data/ data/gfm/ lua/	lua/gui/ lua/net/ lua/obj/</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1957%20-%20in%20/trunk%3A%20data/%20data/gfm/%20lua/%0A%09lua/gui/%20lua/net/%20lua/obj/&In-Reply-To=%3C20080312205634.3903C1524013%40zwischenwelt.org%3E"
       TITLE="[Iris-commit] [IRIS] r1957 - in /trunk: data/ data/gfm/ lua/	lua/gui/ lua/net/ lua/obj/">no-reply at zwischenwelt.org
       </A><BR>
    <I>Wed Mar 12 21:56:33 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000768.html">[Iris-commit] [IRIS] r1956 - /trunk/lua/lib.terrain.multitex.lua
</A></li>
        <LI>Next message: <A HREF="000770.html">[Iris-commit] [IRIS] r1958 - /trunk/lua/lib.unifont.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#769">[ date ]</a>
              <a href="thread.html#769">[ thread ]</a>
              <a href="subject.html#769">[ subject ]</a>
              <a href="author.html#769">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: sience
Date: Wed Mar 12 21:56:33 2008
New Revision: 1957

Log:
-several updates to remove gfm's
-gfm's removed
--gfms moved to archiv
-varans gumpmanager moved to archiv

Added:
    trunk/lua/gui/gui.gumpparser.lua
    trunk/lua/gui/gui.healthbar.lua
    trunk/lua/gui/gui.helper.lua
    trunk/lua/gui/gui.securetrade.lua
    trunk/lua/gui/gui.skill.lua
Removed:
    trunk/data/gfm/
    trunk/lua/gui/gui.gumpmanager.lua
    trunk/lua/lib.gui.iris.lua
    trunk/lua/lib.gumpparser.lua
    trunk/lua/lib.plaingui.iris.lua
    trunk/lua/lib.securetrade.lua
    trunk/lua/lib.skill.lua
Modified:
    trunk/data/config.lua.dist
    trunk/lua/gui/gui.main.lua
    trunk/lua/gui/gui.paperdoll.lua
    trunk/lua/gui/gui.quit.lua
    trunk/lua/lib.gfm.lua
    trunk/lua/lib.mainmenu.lua
    trunk/lua/lib.mousepick.lua
    trunk/lua/lib.speech.lua
    trunk/lua/lib.test.lua
    trunk/lua/main.lua
    trunk/lua/net/net.other.lua
    trunk/lua/obj/obj.container.lua
    trunk/lua/obj/obj.mobile.lua
    trunk/lua/obj/obj.player.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Wed Mar 12 21:56:33 2008
@@ -28,7 +28,6 @@
 gHideUOCursor =3D false
 gHideFPS =3D true							-- old but required for lugre
 gHideMemoryUsage =3D false				-- includes now also fps
-gHideOfflineModeTeleportMenu =3D true		-- currently broken
 =

 -- Font settings
 gFontNameDefault =3D &quot;BerlinSans32&quot;
@@ -176,11 +175,11 @@
 		gPolServer =3D false
 	}
 =

-gShardList[&quot;#offline&quot;] =3D { =

+gShardList[&quot;# - Offline Mode&quot;] =3D { =

 		gStartGameWithoutNetwork =3D true
 	}
 =

-gShardList[&quot;#debug&quot;] =3D { =

+gShardList[&quot;# - Debug Mode&quot;] =3D { =

 		gStartInDebugMode =3D true
 	}
 =


Modified: trunk/lua/gui/gui.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.main.lua (original)
+++ trunk/lua/gui/gui.main.lua Wed Mar 12 21:56:33 2008
@@ -1,11 +1,15 @@
 dofile(libpath .. &quot;gui/gui.widget.lua&quot;)
-dofile(libpath .. &quot;gui/gui.gumpmanager.lua&quot;)
+dofile(libpath .. &quot;gui/gui.helper.lua&quot;)
+dofile(libpath .. &quot;gui/gui.gumpparser.lua&quot;)
 dofile(libpath .. &quot;gui/gui.paperdoll.lua&quot;)
 dofile(libpath .. &quot;gui/gui.journal.lua&quot;)
 dofile(libpath .. &quot;gui/gui.quit.lua&quot;)
 dofile(libpath .. &quot;gui/gui.status.lua&quot;)
 dofile(libpath .. &quot;gui/gui.styles.lua&quot;)
 dofile(libpath .. &quot;gui/gui.hotbar.lua&quot;)
+dofile(libpath .. &quot;gui/gui.healthbar.lua&quot;)
+dofile(libpath .. &quot;gui/gui.securetrade.lua&quot;)
+dofile(libpath .. &quot;gui/gui.skill.lua&quot;)
 =

 -- TODO
 dofile(libpath .. &quot;gui/gui.container.lua&quot;)

Modified: trunk/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.paperdoll.lua (original)
+++ trunk/lua/gui/gui.paperdoll.lua Wed Mar 12 21:56:33 2008
@@ -179,12 +179,11 @@
 	--print(&quot;CreatePaperdollItemWidget&quot;,gumpid,item.layer,animid,base_id)
 	local xoff,yoff =3D 9,19
 	local widget =3D MakeBorderGumpPart(dialog.rootwidget, gumpid, xoff, yoff=
 , 0, 0, 0, item.hue)
-	local bitmask =3D GetGumpBitMask(gumpid)
-	widget:SetBitMask(bitmask)
+
+	widget.mbIgnoreMouseOver =3D false
 	widget.uoPaperdoll =3D paperdoll
 	widget.item =3D item
 	item.widget =3D widget
-	widget.mbIgnoreMouseOver =3D false
 =

 	widget.onMouseEnter =3D function () -- item tooltip (clientside,debuginfo=
s)
 							-- TODO : find a cleaner solution to override the mousepick tipp
@@ -359,7 +358,7 @@
 			dialog.controls[&quot;btnstatus&quot;].onMouseDown =3D function (widget,mousebutt=
on)
 															if (mousebutton =3D=3D 1) then
 																widget.gfx:SetMaterial(widget.mat_pressed)
-																OpenStatus(widget.dialog.uoPaperdoll.mobile)
+																OpenHealthbar(widget.dialog.uoPaperdoll.mobile)
 															end
 														end
 		end

Modified: trunk/lua/gui/gui.quit.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.quit.lua (original)
+++ trunk/lua/gui/gui.quit.lua Wed Mar 12 21:56:33 2008
@@ -1,20 +1,37 @@
+-- Created 12.03.2008 16:40:10, with GumpStudio &amp; Iris2 Lua Export Plugin
+-- Exported Iris2 GumpExporter ver 1.0.
+local quitGump =3D {}
+quitGump.dialogId =3D 34436564
+quitGump.x =3D 100
+quitGump.y =3D 100
+quitGump.Data =3D
+	 &quot;{ page 0 }&quot; ..
+	 &quot;{ gumppic 0 0 2070 }&quot; ..
+	 &quot;{ button 36 78 2071 2072 1 0 quitcanel }&quot; ..
+	 &quot;{ button 99 78 2074 2075 1 0 quitok }&quot; ..
+	 &quot;{ text 70 25 0 0 }&quot; ..
+	 &quot;{ text 44 42 0 1 }&quot;
+quitGump.textline =3D {
+	[0] =3D &quot;Quit&quot;,
+	[1] =3D &quot;Ultima Online?&quot;,
+}
+
 function OpenQuit()
-	local Gump =3D gGumpmanager.CreateGump( 100, 100 )
-	Gump.name =3D &quot;quit&quot;
-	=

-	Gump:addImage( 0, 0, hex2num(&quot;0x816&quot;), 0, 0 )
-	Gump:addButton( 36, 78, hex2num(&quot;0x817&quot;), hex2num(&quot;0x818&quot;), hex2num(&quot;0x81=
9&quot;), 0, 0 )
-	Gump:addButton( 99, 78, hex2num(&quot;0x81A&quot;), hex2num(&quot;0x81B&quot;), hex2num(&quot;0x81=
C&quot;), 1, 0 )
-	Gump:addText( 35, 27, 'Quit', 0, 0, 0 )
-	Gump:addText( 35, 42, 'Ultima Online?', 0, 0, 0 )
-	=

-	Gump.onLeftClick =3D function( Gump, GumpObject )
-		if GumpObject.type =3D=3D gGumpmanager.gumpObjectType_Button then
-			if GumpObject.buttonid =3D=3D 0 then
-				Gump:destroy()
-			elseif GumpObject.buttonid =3D=3D 1 then
-				Terminate()
-			end
-		end
+	local dialog =3D GumpParser( quitGump, true )
+
+	dialog.onMouseDown =3D function (widget,mousebutton)
+		if (mousebutton =3D=3D 2) then widget.dialog:Close() end
+		if (mousebutton =3D=3D 1) then widget.dialog:BringToFront() gui.StartMov=
eDialog(widget.dialog.rootwidget) end
 	end
+
+	dialog.controls[&quot;quitcanel&quot;].onMouseDown =3D function (widget,mousebutton)
+												if (mousebutton =3D=3D 1) then
+													widget.dialog:Close()
+												end
+											end
+	dialog.controls[&quot;quitok&quot;].onMouseDown =3D function (widget,mousebutton)
+												if (mousebutton =3D=3D 1) then
+													Terminate()
+												end
+											end
 end

Modified: trunk/lua/lib.gfm.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gfm.lua (original)
+++ trunk/lua/lib.gfm.lua Wed Mar 12 21:56:33 2008
@@ -5,7 +5,6 @@
 function GumpButtonSetOver		(widget) widget.gfx:SetMaterial(widget.mat_ove=
r) end
 function GumpButtonSetNormal	(widget) widget.gfx:SetMaterial(widget.mat_no=
rmal) end
 function GumpButtonSetPressed	(widget) widget.gfx:SetMaterial(widget.mat_p=
ressed) end
-
 =

 -- creates a button with mouseover and pressed effect
 -- w,h can be left out to determine automatically
@@ -151,6 +150,10 @@
 	local widget =3D guimaker.MakePlane(parent,mat,x,y,cx,cy)
 	local tw,th =3D texsize(w),texsize(h)
 	widget.gfx:SetUV(0,(skip_rows_from_top)/th,cx/tw,(cy+skip_rows_from_top)/=
th)
+	-- autogenerate bitmask
+	local bitmask =3D GetGumpBitMask(iGumpID)
+	widget:SetBitMask(bitmask)
+
 	widget.mbIgnoreMouseOver =3D true
 	return widget
 end
@@ -170,34 +173,16 @@
 	local widget =3D guimaker.MakePlane(parent,mat,x,y,cx,cy)
 	local tw,th =3D texsize(w),texsize(h)
 	widget.gfx:SetUV(0,(skip_rows_from_top)/th,cx/tw,(cy+skip_rows_from_top)/=
th)
+	-- autogenerate bitmask
+	local bitmask =3D GetArtBitMask (iArtID)
+	widget:SetBitMask(bitmask)
+
 	widget.mbIgnoreMouseOver =3D true
 	return widget
 end
 =

--- Obsolete, only for testing
+-- TODO: remove obsolete code, gfm's not used anymore
 --[[
-gGumpTestIndex =3D (hex2num(&quot;0xA28&quot;))
-function GumpTestAdd (i) =

-	gGumpTestIndex =3D gGumpTestIndex + i
-	=

-	if (gGumpTestDlg.widget) then
-		gGumpTestDlg.widget:Destroy()
-		gGumpTestDlg.widget =3D nil
-	end
-	=

-	local testmat =3D gGumpLoader:CreateMaterial(gGumpTestIndex)
-	if (testmat and testmat ~=3D &quot;&quot;) then
-		gGumpLoader:Load(gGumpTestIndex)
-		local w,h =3D gGumpLoader:GetSize()
-		local tw,th =3D texsize(w),texsize(h)
-		gGumpTestDlg.widget =3D guimaker.MakePlane(gGumpTestDlg,testmat,-w/2,-h/=
2,w,h)
-		local widget =3D gGumpTestDlg.widget
-		widget.gfx:SetUV(0,0,w/tw,h/th)
-		widget.gfx:SetAlignment(kGfx2DAlign_Center,kGfx2DAlign_Center)
-	end
-end
-]]--
-
 function CreateGumpDlgFromGfm (path) =

 	local dialog =3D guimaker.MakeSortedDialog()
 	if (gGumpLoader) then
@@ -245,12 +230,10 @@
 	elseif (attr.class =3D=3D &quot;picture&quot;) then
 			widget =3D MakeBorderGumpPart(dialog.rootwidget,hex2num(gump[1]),attr.l=
eft,attr.top,attr.width,attr.height)
 		-- TODO :  &quot;data/gfm/healthbar.gfm&quot; &quot;data/gfm/main_menu.gfm&quot; &quot;data/gfm/b=
ackground.gfm&quot; &quot;data/gfm/askquit.gfm&quot;
-		--[[
-		&lt;control class=3D'picture' name=3D'picture_816' left=3D'0' top=3D'0' wid=
th=3D'178' height=3D'108' freezed=3D'1' visible=3D'1' alpha=3D'0' flags=3D'=
0'&gt;
-		 &lt;event onclick=3D'' onclose=3D'' onmouseup=3D'' onmousedown=3D'' onkeyp=
ressed=3D''/&gt;
-		 &lt;gump&gt;0x816&lt;/gump&gt;
-		&lt;/control&gt;
-		]]--
+		--&lt;control class=3D'picture' name=3D'picture_816' left=3D'0' top=3D'0' w=
idth=3D'178' height=3D'108' freezed=3D'1' visible=3D'1' alpha=3D'0' flags=
=3D'0'&gt;
+		--&lt;event onclick=3D'' onclose=3D'' onmouseup=3D'' onmousedown=3D'' onkey=
pressed=3D''/&gt;
+		--&lt;gump&gt;0x816&lt;/gump&gt;
+		--&lt;/control&gt;
 	elseif (attr.class =3D=3D &quot;checkbox&quot;) then =

 		-- &quot;data/gfm/secure_trade.gfm&quot;
 			local bChecked =3D tonumber(hex2num(xmlchild(node,&quot;checked&quot;)[1])) =3D=
=3D 1  -- &lt;checked&gt;0&lt;/checked&gt;
@@ -269,44 +252,4 @@
 		dialog.controls[attr.name] =3D widget
 	end
 end
-
--- Obsolete, only for testing
---[[
-function GfmDump (path)
-	print(&quot;GfmDump&quot;,path)
-	local formnode =3D xmlchild(LuaXML_ParseFile(path),&quot;form&quot;)
-	print(&quot;width=3D&quot;,formnode.attr.width)
-	print(&quot;height=3D&quot;,formnode.attr.height)
-	local k,child
-	for k,child in ipairs(formnode) do if (child.name =3D=3D &quot;control&quot;) then
-		printf(&quot;control : class=3D%s, name=3D'%s', left=3D%s, top=3D%s, width=3D=
%s, height=3D%s\n&quot;,
-			child.attr.class,
-			child.attr.name,
-			child.attr.left,
-			child.attr.top,
-			child.attr.width,
-			child.attr.height
-			)
-		local node =3D xmlchild(child,&quot;gump&quot;)
-		if (node) then =

-			printf(&quot;  gump(%s):&quot;,node[1] or &quot;&quot;)
-			if (node.attr) then for an,av in pairs(node.attr) do if (av ~=3D &quot;&quot;) th=
en printf(&quot; %s=3D%s&quot;,an,av) end end end
-			printf(&quot;\n&quot;)
-		end
-		=

-		local node =3D xmlchild(child,&quot;event&quot;)
-		if (node) then =

-			printf(&quot;  event(%s):&quot;,node[1] or &quot;&quot;)
-			if (node.attr) then for an,av in pairs(node.attr) do if (av ~=3D &quot;&quot;) th=
en printf(&quot; %s=3D%s&quot;,an,av) end end end
-			printf(&quot;\n&quot;)
-		end
-		=

-		local node =3D xmlchild(child,&quot;text&quot;)
-		if (node) then =

-			printf(&quot;  text(%s):&quot;,node[1] or &quot;&quot;)
-			if (node.attr) then for an,av in pairs(node.attr) do if (av ~=3D &quot;&quot;) th=
en printf(&quot; %s=3D%s&quot;,an,av) end end end
-			printf(&quot;\n&quot;)
-		end
-	end end
-end
 ]]--

Modified: trunk/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.lua (original)
+++ trunk/lua/lib.mainmenu.lua Wed Mar 12 21:56:33 2008
@@ -2,13 +2,21 @@
 =

 gMainMenuCamAng =3D 0
 =

-function StopLoadingBackground ()
+local function GetShardButtonText (shard,shardname)
+	if (shard.gLoginname) then
+		return shardname..&quot;:&quot;..(shard.gLoginname or &quot;&quot;)
+	else
+		return shardname
+	end
+end
+
+local function StopLoadingBackground ()
 	if (gLoadingBackground) then
 		gLoadingBackground:Destroy()
 	end
 end
 =

-function MainMenuConnectToShard (shard,shardname,loginname,loginpass)
+local function MainMenuConnectToShard (shard,shardname,loginname,loginpass)
 	-- activate shard
 	for k,v in pairs(shard) do =

 		--print(&quot;shard&quot;,k,v) =

@@ -41,6 +49,139 @@
 	Send_Account_Login_Request(gLoginname,gPassword) -- 0x80 kPacket_Account_=
Login_Request
 	-- answered by 0xA8 kPacket_Server_List which calls MainMenuShowServerList
 end
+
+local function MainMenuShowCharCreationDialog (template,slot)
+	-- TODO : unfinished, need more gui-elements for colorpicking, skill valu=
es etc..
+	=

+	local MyCreateChar =3D function(widget) =

+		local edittextwidget =3D widget.dialog.controls[&quot;nameinput&quot;]
+		--print(&quot;MyCreateChar&quot;,widget.chartemplate,widget.charslot,edittextwidge=
t.plaintext)
+		CreateCharFromTemplate(widget.chartemplate,widget.charslot,edittextwidge=
t.plaintext ,&quot;&quot;) -- see lib.charcreate.lua
+		widget.dialog:Destroy()
+	end
+	local rows =3D {
+		{	{type=3D&quot;Label&quot;,		text=3D&quot;Character Creation&quot;} },
+		=

+		{	{type=3D&quot;Label&quot;,		text=3D&quot;Name:&quot;},
+			{type=3D&quot;EditText&quot;,	w=3D300,h=3D16,text=3D&quot;IrisTestChar&quot;,controlname=3D=
&quot;nameinput&quot;}  },
+			=

+		{	{type=3D&quot;Button&quot;,onLeftClick=3DMyCreateChar,chartemplate=3Dtemplate,ch=
arslot=3Dslot,text=3D&quot;Create Character&quot;},
+			{type=3D&quot;Label&quot;,	text=3D&quot;(iris does not support all the options for cha=
r creation yet,\n&quot;..
+								&quot;you can only pick a name, if you want to set all the options your=
self,\n&quot;..
+								&quot;you can create the char using another client, and then login with=
 iris)&quot;}
+			},
+		=

+	}
+	=

+	gCharCreateDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefa=
ultStyleSet,&quot;window&quot;)
+end
+
+local function LoadShardfilter(filterfilepath)
+	if (filterfilepath) then
+		if (file_exists(gMainWorkingDir..filterfilepath) ) then
+			print(&quot;Load custom shard-specific Filter: &quot;..gMainWorkingDir..filterfil=
epath)
+			dofile(gMainWorkingDir..filterfilepath)
+		else
+			print(&quot;Shard-specific Filter not found: &quot;..gMainWorkingDir..filterfilep=
ath)
+		end
+	end
+end
+
+local function StartOfflineMode ()
+	gStartGameWithoutNetwork =3D true
+	MultiTexTerrain_NotifyMapChange()
+	=

+	local x,y,z =3D -183,203,0
+	--if (gGroundBlockLoader) then x,y,z =3D -gGroundBlockLoader:GetMapW()*8/=
2,gGroundBlockLoader:GetMapH()*8/2,0 end
+	if (gOfflineModeCamStart) then x,y,z =3D unpack(gOfflineModeCamStart) end
+	gCurrentRenderer:InitLocalCam(x,y,z)
+
+	-- Binds key and Inits all InGame-Data
+	StartInGame() -- otherwise handled by the serverpacket (kPacket_Login_Com=
plete)
+
+	-- offline : tilefree walk teleport
+	BindDown(&quot;f6&quot;,function ()
+		gTileFreeWalk:SetPos_All(gTileFreeWalk:RoundPos(gTileFreeWalk:MousePickP=
os()))
+	end)
+	=

+	-- Unbind some keys only for offline mode (rest is the same as InGame)
+	UnBindArr({&quot;u&quot;,&quot;q&quot;,&quot;e&quot;,&quot;tab&quot;,&quot;r&quot;,&quot;t&quot;,&quot;k&quot;,&quot;j&quot;,&quot;b&quot;,&quot;p&quot;,&quot;g&quot;,&quot;h&quot;,&quot;y&quot;})
+end
+
+local function MainMenuShowLoginDialog (shard,shardname)
+	-- TODO : unfinished, pol server options...
+	=

+	local MyLogin =3D function (widget) =

+		local shard =3D widget.shard
+		shard.gLoginServerIP 	=3D 			widget.dialog.controls[&quot;loginserverinput&quot;].=
plaintext
+		shard.gLoginServerPort 	=3D tonumber(	widget.dialog.controls[&quot;loginporti=
nput&quot;].plaintext)
+		local nameinput =3D widget.dialog.controls[&quot;nameinput&quot;].plaintext
+		local passinput =3D widget.dialog.controls[&quot;passinput&quot;].plaintext
+		-- TOOD : password style field
+		--print(&quot;MainMenuConnectToShard&quot;,shard,widget.shardname,nameinput,passin=
put)
+		MainMenuConnectToShard(shard,widget.shardname,nameinput,passinput)
+		widget.dialog:Destroy()
+	end
+	local rows =3D {
+		{	{type=3D&quot;Label&quot;,		text=3D&quot;Login&quot;} },
+			=

+		{	{type=3D&quot;Label&quot;,		text=3D&quot;LoginServer:&quot;},
+			{type=3D&quot;EditText&quot;,	w=3D300,h=3D16,text=3D(shard.gLoginServerIP or &quot;&quot;),=
controlname=3D&quot;loginserverinput&quot;},
+			{type=3D&quot;EditText&quot;,	w=3D100,h=3D16,text=3D(shard.gLoginServerPort or &quot;&quot;=
),controlname=3D&quot;loginportinput&quot;}  },
+			=

+		{	{type=3D&quot;Label&quot;,		text=3D&quot;Name:&quot;},
+			{type=3D&quot;EditText&quot;,	w=3D300,h=3D16,text=3D(shard.gLoginname or &quot;&quot;),cont=
rolname=3D&quot;nameinput&quot;}  },
+			=

+		{	{type=3D&quot;Label&quot;,		text=3D&quot;Pass:&quot;},
+			{type=3D&quot;EditText&quot;,	w=3D300,h=3D16,text=3D(shard.gPassword or &quot;&quot;),contr=
olname=3D&quot;passinput&quot;,bPassWordStyle=3Dtrue}  },
+			=

+		{	{type=3D&quot;Label&quot;,		text=3D&quot;Tipp:&quot;},
+			{type=3D&quot;Label&quot;,		text=3D	&quot;On many shards you can you can just login wi=
th a username/password you wish\n&quot;..
+										&quot;to create a new account if you don't have one already&quot;}, },
+			=

+		{	{type=3D&quot;Button&quot;,onLeftClick=3DMyLogin,shard=3Dshard,shardname=3Dshard=
name,text=3D&quot;Login&quot;}, },
+		=

+	}
+
+	LoadShardfilter(shard.gCustomArtFilterFilePath)
+
+	if (shard.gStartGameWithoutNetwork =3D=3D true) then
+		StartOfflineMode()
+	elseif(shard.gStartInDebugMode =3D=3D true) then
+		StartDebugMenu()
+	else
+		gLoginDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefaultS=
tyleSet,&quot;window&quot;)
+	end
+end
+
+local function StopMainMenu ()
+	if (gMainMenuDialog) then
+		gMainMenuDialog:Destroy()
+		gMainMenuDialog=3Dnil
+	end
+end
+
+local function SetMainMenuCam (roth,rotv)
+	local w1,x1,y1,z1 =3D Quaternion.fromAngleAxis(gfDeg2Rad * 90.0,1,0,0)
+	local w2,x2,y2,z2 =3D Quaternion.fromAngleAxis(roth,0,1,0)	=

+	local w3,x3,y3,z3 =3D Quaternion.fromAngleAxis(rotv,1,0,0)
+	local w4,x4,y4,z4 =3D Quaternion.Mul(w1,x1,y1,z1, w2,x2,y2,z2)
+	=

+	local w,x,y,z =3D Quaternion.Mul(w4,x4,y4,z4, w3,x3,y3,z3)
+	GetMainCam():SetRot(w,x,y,z)	=

+end
+
+local function MainMenuSetBackground_Sky ()
+	local cam =3D GetMainCam()
+	cam:SetFOVy(gfDeg2Rad*45)
+	cam:SetNearClipDistance(0.5) -- old : 1
+	cam:SetFarClipDistance(2000) -- ogre defaul : 100000
+	cam:SetProjectionType(0) -- perspective
+	Client_SetSkybox(&quot;sunset&quot;) -- cleansky skybox sunset darksun
+	SetMainMenuCam(0,gfDeg2Rad)
+end
+
+-- ----------------------------------------------- End of local functions =
-----------------------------
 =

 --gameserverlist selection
 function MainMenuShowServerList (serverlist)
@@ -148,114 +289,15 @@
 	gCharListDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefaul=
tStyleSet,&quot;window&quot;)
 end
 =

-function MainMenuShowCharCreationDialog (template,slot)
-	-- TODO : unfinished, need more gui-elements for colorpicking, skill valu=
es etc..
-	=

-	local MyCreateChar =3D function(widget) =

-		local edittextwidget =3D widget.dialog.controls[&quot;nameinput&quot;]
-		--print(&quot;MyCreateChar&quot;,widget.chartemplate,widget.charslot,edittextwidge=
t.plaintext)
-		CreateCharFromTemplate(widget.chartemplate,widget.charslot,edittextwidge=
t.plaintext ,&quot;&quot;) -- see lib.charcreate.lua
-		widget.dialog:Destroy()
-	end
-	local rows =3D {
-		{	{type=3D&quot;Label&quot;,		text=3D&quot;Character Creation&quot;} },
-		=

-		{	{type=3D&quot;Label&quot;,		text=3D&quot;Name:&quot;},
-			{type=3D&quot;EditText&quot;,	w=3D300,h=3D16,text=3D&quot;IrisTestChar&quot;,controlname=3D=
&quot;nameinput&quot;}  },
-			=

-		{	{type=3D&quot;Button&quot;,onLeftClick=3DMyCreateChar,chartemplate=3Dtemplate,ch=
arslot=3Dslot,text=3D&quot;Create Character&quot;},
-			{type=3D&quot;Label&quot;,	text=3D&quot;(iris does not support all the options for cha=
r creation yet,\n&quot;..
-								&quot;you can only pick a name, if you want to set all the options your=
self,\n&quot;..
-								&quot;you can create the char using another client, and then login with=
 iris)&quot;}
-			},
-		=

-	}
-	=

-	gCharCreateDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefa=
ultStyleSet,&quot;window&quot;)
-end
-
-function LoadShardfilter(filterfilepath)
-	if (filterfilepath) then
-		if (file_exists(gMainWorkingDir..filterfilepath) ) then
-			print(&quot;Load custom shard-specific Filter: &quot;..gMainWorkingDir..filterfil=
epath)
-			dofile(gMainWorkingDir..filterfilepath)
-		else
-			print(&quot;Shard-specific Filter not found: &quot;..gMainWorkingDir..filterfilep=
ath)
-		end
-	end
-end
-
-function MainMenuShowLoginDialog (shard,shardname)
-	-- TODO : unfinished, pol server options...
-	=

-	local MyLogin =3D function (widget) =

-		local shard =3D widget.shard
-		shard.gLoginServerIP 	=3D 			widget.dialog.controls[&quot;loginserverinput&quot;].=
plaintext
-		shard.gLoginServerPort 	=3D tonumber(	widget.dialog.controls[&quot;loginporti=
nput&quot;].plaintext)
-		local nameinput =3D widget.dialog.controls[&quot;nameinput&quot;].plaintext
-		local passinput =3D widget.dialog.controls[&quot;passinput&quot;].plaintext
-		-- TOOD : password style field
-		--print(&quot;MainMenuConnectToShard&quot;,shard,widget.shardname,nameinput,passin=
put)
-		MainMenuConnectToShard(shard,widget.shardname,nameinput,passinput)
-		widget.dialog:Destroy()
-	end
-	local rows =3D {
-		{	{type=3D&quot;Label&quot;,		text=3D&quot;Login&quot;} },
-			=

-		{	{type=3D&quot;Label&quot;,		text=3D&quot;LoginServer:&quot;},
-			{type=3D&quot;EditText&quot;,	w=3D300,h=3D16,text=3D(shard.gLoginServerIP or &quot;&quot;),=
controlname=3D&quot;loginserverinput&quot;},
-			{type=3D&quot;EditText&quot;,	w=3D100,h=3D16,text=3D(shard.gLoginServerPort or &quot;&quot;=
),controlname=3D&quot;loginportinput&quot;}  },
-			=

-		{	{type=3D&quot;Label&quot;,		text=3D&quot;Name:&quot;},
-			{type=3D&quot;EditText&quot;,	w=3D300,h=3D16,text=3D(shard.gLoginname or &quot;&quot;),cont=
rolname=3D&quot;nameinput&quot;}  },
-			=

-		{	{type=3D&quot;Label&quot;,		text=3D&quot;Pass:&quot;},
-			{type=3D&quot;EditText&quot;,	w=3D300,h=3D16,text=3D(shard.gPassword or &quot;&quot;),contr=
olname=3D&quot;passinput&quot;,bPassWordStyle=3Dtrue}  },
-			=

-		{	{type=3D&quot;Label&quot;,		text=3D&quot;Tipp:&quot;},
-			{type=3D&quot;Label&quot;,		text=3D	&quot;On many shards you can you can just login wi=
th a username/password you wish\n&quot;..
-										&quot;to create a new account if you don't have one already&quot;}, },
-			=

-		{	{type=3D&quot;Button&quot;,onLeftClick=3DMyLogin,shard=3Dshard,shardname=3Dshard=
name,text=3D&quot;Login&quot;}, },
-		=

-	}
-
-	LoadShardfilter(shard.gCustomArtFilterFilePath)
-
-	if (shard.gStartGameWithoutNetwork =3D=3D true) then
-		StartOfflineMode()
-	elseif(shard.gStartInDebugMode =3D=3D true) then
-		StartDebugMenu()
-	else
-		gLoginDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefaultS=
tyleSet,&quot;window&quot;)
-	end
-end
-
-function GetShardButtonText (shard,shardname)
-	return shardname..&quot;:&quot;..(shard.gLoginname or &quot;???&quot;)
-end
-
-function StartOfflineMode ()
-	gStartGameWithoutNetwork =3D true
-	MultiTexTerrain_NotifyMapChange()
-	=

-	local x,y,z =3D -183,203,0
-	--if (gGroundBlockLoader) then x,y,z =3D -gGroundBlockLoader:GetMapW()*8/=
2,gGroundBlockLoader:GetMapH()*8/2,0 end
-	if (gOfflineModeCamStart) then x,y,z =3D unpack(gOfflineModeCamStart) end
-	gCurrentRenderer:InitLocalCam(x,y,z)
-	=

-	InitPlainGUI()
-
-	-- Binds key and Inits all InGame-Data
-	StartInGame() -- otherwise handled by the serverpacket (kPacket_Login_Com=
plete)
-
-	-- offline : tilefree walk teleport
-	BindDown(&quot;f6&quot;,function ()
-		gTileFreeWalk:SetPos_All(gTileFreeWalk:RoundPos(gTileFreeWalk:MousePickP=
os()))
-	end)
-	=

-	-- Unbind some keys only for offline mode (rest is the same as InGame)
-	UnBindArr({&quot;u&quot;,&quot;q&quot;,&quot;e&quot;,&quot;tab&quot;,&quot;r&quot;,&quot;t&quot;,&quot;k&quot;,&quot;j&quot;,&quot;b&quot;,&quot;p&quot;,&quot;g&quot;,&quot;h&quot;,&quot;y&quot;})
+function MainMenuFinishedPreLoading ()
+	SetUOCursor(0)
+	if (gLoadingBackground) then StopLoadingBackground () end
+end
+
+function StepMainMenu ()
+	if (gMainMenuDialog) then =

+		-- currently unused
+	end
 end
 =

 function StartMainMenu ()
@@ -282,20 +324,28 @@
 		{ {type=3D&quot;Label&quot;,	text=3D&quot;Login:&quot;} }
 	}
 =

-	local fun =3D function (widget) MainMenuShowLoginDialog(widget.shard,widg=
et.shardname) StopMainMenu() end
+	local fun =3D function (widget)
+		MainMenuShowLoginDialog(widget.shard,widget.shardname)
+		StopMainMenu()
+	end
+
 	for shardname,shard in pairs(gShardList) do
 		table.insert(rows,{ {type=3D&quot;Button&quot;,	onLeftClick=3Dfun,shard=3Dshard,sh=
ardname=3Dshardname,text=3DGetShardButtonText(shard,shardname)} })
 	end
 =

-	table.insert(rows,{ {type=3D&quot;Button&quot;,text=3D&quot;#gfx-config&quot;,onLeftClick=3Df=
unction ()
+	table.insert(rows,{ {type=3D&quot;Button&quot;,text=3D&quot;# - Graphic Options&quot;,onLeftC=
lick=3Dfunction ()
 		StopMainMenu()
 		if (Client_ShowOgreConfig()) then
 			DisplayNotice(&quot;please restart iris2 for the changes to take effekt&quot;)
+			StopMainMenu()
 			Exit() -- Terminate()  -- terminate softly is not enough, no frame can =
be drawn since ogre::root has to be killed for fullscreen switch
 			-- todo : reinit ogre here ? might loose already loaded textures =3D(
 		end	=

 		end } })
-	table.insert(rows,{ {type=3D&quot;Button&quot;,text=3D&quot;#exit&quot;,onLeftClick=3Dfunctio=
n () Terminate() end } })
+	table.insert(rows,{ {type=3D&quot;Button&quot;,text=3D&quot;# - Exit&quot;,onLeftClick=3Dfunc=
tion ()
+			StopMainMenu()
+			Terminate()
+		end } })
 =

 	MainMenuSetBackground_Sky()
 =

@@ -303,41 +353,3 @@
 		gMainMenuDialog =3D guimaker.MakeTableDlg(rows,10,10,false,true,gGuiDefa=
ultStyleSet,&quot;window&quot;) =

 	end
 end
-
-function MainMenuFinishedPreLoading ()
-	SetUOCursor(0)
-	if (gLoadingBackground) then StopLoadingBackground () end
-end
-
-function StopMainMenu ()
-	if (gMainMenuDialog) then
-		gMainMenuDialog:Destroy()
-		gMainMenuDialog=3Dnil
-	end
-end
-
-function StepMainMenu ()
-	if (gMainMenuDialog) then =

-		-- currently unused
-	end
-end
-
-function MainMenuSetBackground_Sky ()
-	local cam =3D GetMainCam()
-	cam:SetFOVy(gfDeg2Rad*45)
-	cam:SetNearClipDistance(0.5) -- old : 1
-	cam:SetFarClipDistance(2000) -- ogre defaul : 100000
-	cam:SetProjectionType(0) -- perspective
-	Client_SetSkybox(&quot;sunset&quot;) -- cleansky skybox sunset darksun
-	SetMainMenuCam(0,gfDeg2Rad)
-end
-
-function SetMainMenuCam (roth,rotv)
-	local w1,x1,y1,z1 =3D Quaternion.fromAngleAxis(gfDeg2Rad * 90.0,1,0,0)
-	local w2,x2,y2,z2 =3D Quaternion.fromAngleAxis(roth,0,1,0)	=

-	local w3,x3,y3,z3 =3D Quaternion.fromAngleAxis(rotv,1,0,0)
-	local w4,x4,y4,z4 =3D Quaternion.Mul(w1,x1,y1,z1, w2,x2,y2,z2)
-	=

-	local w,x,y,z =3D Quaternion.Mul(w4,x4,y4,z4, w3,x3,y3,z3)
-	GetMainCam():SetRot(w,x,y,z)	=

-end

Modified: trunk/lua/lib.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mousepick.lua (original)
+++ trunk/lua/lib.mousepick.lua Wed Mar 12 21:56:33 2008
@@ -24,7 +24,7 @@
 			local mobile =3D GetMobile(iSerial)
 			local iMouseX,iMouseY =3D GetMousePos()
 			-- -50,-30 to place the dialog beneath the mouse
-			OpenStatus(mobile,iMouseX - 50,iMouseY - 30)
+			OpenHealthbar(mobile,iMouseX - 50,iMouseY - 30)
 		end
 	else
 		-- normal doubleclick handling

Modified: trunk/lua/lib.speech.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.speech.lua (original)
+++ trunk/lua/lib.speech.lua Wed Mar 12 21:56:33 2008
@@ -1,6 +1,6 @@
 -- speech.mul loader
 -- Keywords detected from client-chat, converted back to index id and send=
 to server
--- see also <A HREF="http://doc.wpdev.org/formats/speech.html">http://doc.wpdev.org/formats/speech.html</A> (dead link)...
+-- see also <A HREF="http://doc.wpdev.org/formats/speech.html">http://doc.wpdev.org/formats/speech.html</A> (dead link)...
 =

 =

 function SpeechParseKeywords (ascistr) -- used by Send_UnicodeSpeech kPack=
et_Speech_Unicode 0xAD
@@ -13,7 +13,7 @@
 				local keyword =3D speechentry.text
 				local startpos =3D string.find(ascistr,keyword,0,true)
 				if (startpos) then =

-					print(&quot;SpeechParseKeywords:found keyword&quot;,keyword,startpos,speechid)
+					--print(&quot;SpeechParseKeywords:found keyword&quot;,keyword,startpos,speechid)
 					table.insert(speechlistbypos,{ startpos=3Dstartpos, speechid=3Dspeech=
id, keyword=3Dkeyword })
 					found_for_this_speechid =3D true
 				end

Modified: trunk/lua/lib.test.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.test.lua (original)
+++ trunk/lua/lib.test.lua Wed Mar 12 21:56:33 2008
@@ -4,19 +4,6 @@
 function TestGuiSystem2_Step ()
 	local widget =3D gui.GetWidgetUnderMouse()
 	Client_SetBottomLine(&quot;TestGuiSystem2 WidgetUnderMouse : &quot;..(widget and (w=
idget.mytext or &quot;unknown&quot;) or &quot;NONE&quot;))
-end
-
-function TestGuiSystem3_Init()
-	--[[local gump =3D gGumpmanager.CreateGump( 40, 40 )
-	gump:addImage( 0, 0, 1, 0, 0 ) =

-	gump:addTiledImage( 0, 0, 150, 150, hex2num(&quot;0x588&quot;), 0, 0 )
-	gump:addButton( 10, 10, hex2num(&quot;0x1589&quot;), hex2num(&quot;0x158B&quot;), hex2num(&quot;0x=
1589&quot;), 1, 0, 0 )
-	gump:addText( 10, 30, &quot;Bla blub&quot;, 1, 0, 0 )
-	gump:addBackground( 150, 100, 200, 25, hex2num(&quot;0xBB8&quot;), 0, 0 )
-	gump:addImage( 60, 175, hex2num(&quot;0xD5&quot;), 0, 0 )
-        gump:addTiledImage( 73, 175, 74, 14, hex2num(&quot;0xD6&quot;), 0, 0 )
-        gump:addImage( 147, 175, hex2num(&quot;0xD7&quot;), 0, 0 )
-        gump:addScrollbar( 60, 175, true, 100, hex2num(&quot;0xD8&quot;), hex2num(&quot;0=
xD8&quot;), 1, 0 )]]--
 end
 =

 function TestZLib()

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Wed Mar 12 21:56:33 2008
@@ -25,11 +25,8 @@
 dofile(lugreluapath .. &quot;lugre.lua&quot;)
 lugre_include_libs(lugreluapath)
 dofile(libpath .. &quot;lib.sound.iris.lua&quot;)
-dofile(libpath .. &quot;lib.gui.iris.lua&quot;)
 dofile(libpath .. &quot;lib.input.iris.lua&quot;)
 dofile(libpath .. &quot;lib.keybinds.lua&quot;)
-dofile(libpath .. &quot;lib.plaingui.iris.lua&quot;)
-
 dofile(libpath .. &quot;lib.xml.lua&quot;)
 dofile(libpath .. &quot;lib.net.lua&quot;)
  =

@@ -54,12 +51,10 @@
 dofile(libpath .. &quot;lib.gfm.lua&quot;)
 dofile(libpath .. &quot;lib.protocol.lua&quot;)
 dofile(libpath .. &quot;lib.mousepick.lua&quot;)
-dofile(libpath .. &quot;lib.gumpparser.lua&quot;)
 dofile(libpath .. &quot;lib.data.lua&quot;)
 dofile(libpath .. &quot;lib.cliloc.lua&quot;)
 dofile(libpath .. &quot;lib.macrolist.lua&quot;)
 dofile(libpath .. &quot;lib.walking2.lua&quot;)
-dofile(libpath .. &quot;lib.skill.lua&quot;)
 dofile(libpath .. &quot;lib.spellbooks.lua&quot;)
 dofile(libpath .. &quot;lib.speech.lua&quot;)
 dofile(libpath .. &quot;lib.granny.lua&quot;)
@@ -85,7 +80,6 @@
 dofile(libpath .. &quot;lib.oldwalk.lua&quot;)
 dofile(libpath .. &quot;lib.bugreport.lua&quot;)
 dofile(libpath .. &quot;lib.buff.lua&quot;)
-dofile(libpath .. &quot;lib.securetrade.lua&quot;)
 dofile(libpath .. &quot;lib.unifont.lua&quot;)
 =

 dofile(libpath .. &quot;gui/gui.main.lua&quot;)
@@ -297,7 +291,7 @@
 	InitNet()
 =

 	LoadingProfile(&quot;init basic gui&quot;)
-	gui.StartLoading()
+	CreateIrisLogo()
 =

 	LoadBasicData()
 =

@@ -322,7 +316,7 @@
 =

 	StartMainMenu()
 	=

-	if (true) then UniFontTest() end
+	if (false) then UniFontTest() end
 =

 	-- mainloop
 	while (Client_IsAlive()) do =

@@ -384,8 +378,8 @@
 =

 	print(&quot;Welcome to Iris&quot;)
 =

-	-- create player status dialog and stuff like this
-	PlayerGuiInit()
+	-- create player healthbar dialog
+	OpenPlayerHealthbar()
 =

 	-- stop menu music
 	SoundStopMusic()
@@ -412,7 +406,7 @@
 		gCurrentRenderer:CombatGuiStep()
 		if (gCurrentRenderer.MobileAnimStep) then gCurrentRenderer:MobileAnimSte=
p() end
 		gCurrentRenderer:CamStep()
-		gui.Step()
+		GuiStep()
 	else
 		StepMainMenu()
 	end

Modified: trunk/lua/net/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.other.lua (original)
+++ trunk/lua/net/net.other.lua Wed Mar 12 21:56:33 2008
@@ -166,8 +166,7 @@
 =

 	if (subcmd =3D=3D kPacket_Generic_SubCommand_CloseStatus) then	--0x0C
 		local mobilestatus_serial =3D input:PopNetUint8()
-		-- TODO:	=

-		--closemobilestatusgump(mobilestatus_serial)
+		CloseHealthbar(mobilestatus_serial)
 	end
 =

 	-- AOSTooltip

Modified: trunk/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.container.lua (original)
+++ trunk/lua/obj/obj.container.lua Wed Mar 12 21:56:33 2008
@@ -61,9 +61,6 @@
 		widget.onMouseDown	=3D function (widget,mousebutton) end
 	else
 		widget =3D MakeArtGumpPart (parent,item.artid,item.xloc,item.yloc,0,0,0,=
item.hue)
-		=

-		-- for exact mousepicking
-		widget:SetBitMask( GetArtBitMask(item.artid + hex2num(&quot;0x4000&quot;)) )
 =

 		widget.mbIgnoreMouseOver =3D false
 		widget.uoContainer =3D item.container

Modified: trunk/lua/obj/obj.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.mobile.lua (original)
+++ trunk/lua/obj/obj.mobile.lua Wed Mar 12 21:56:33 2008
@@ -116,14 +116,14 @@
 	if (self.stats.curHits and self.stats.maxHits) then
 		if (self.serial =3D=3D gPlayerBodySerial) then
 			-- for player
-			gui.SetHitpoints(self.stats.curHits/self.stats.maxHits)
-			if (self.stats.curMana)		then gui.SetMana(	self.stats.curMana		/self.st=
ats.maxMana		) end
-			if (self.stats.curStamina)	then gui.SetStamina(self.stats.curStamina	/s=
elf.stats.maxStamina	) end
+			SetHitpoints(self.stats.curHits/self.stats.maxHits)
+			if (self.stats.curMana)		then SetMana(	self.stats.curMana		/self.stats.=
maxMana		) end
+			if (self.stats.curStamina)	then SetStamina(self.stats.curStamina	/self.=
stats.maxStamina	) end
 			-- update big_stats window
 			UpdateStatusAos()
 		else
 			-- for other mobiles
-			SetNpcStatusHitpoints(self, self.stats.curHits / self.stats.maxHits)
+			SetNpcHealthbarHitpoints(self, self.stats.curHits / self.stats.maxHits)
 		end
 	end
 	=

@@ -220,7 +220,7 @@
 		self.stats.maxMana =3D maxvalue
 =

 		if (self.serial =3D=3D gPlayerBodySerial) then
-			gui.SetMana(curvalue/maxvalue)
+			SetMana(curvalue/maxvalue)
 			-- update big_stats window
 			UpdateStatusAos()
 		end
@@ -237,7 +237,7 @@
 		self.stats.maxStamina =3D maxvalue
 =

 		if (self.serial =3D=3D gPlayerBodySerial) then
-			gui.SetStamina(curvalue/maxvalue)
+			SetStamina(curvalue/maxvalue)
 			-- update big_stats window
 			UpdateStatusAos()
 		end
@@ -272,7 +272,7 @@
 	self:NotifyListener(&quot;Mobile_Destroy&quot;)
 	=

 	-- destroy Status Gump from NPC
-	CloseStatus(self)
+	CloseHealthbar(self)
 	=

 	self:DestroyContent() -- warning, triggers self:Update()
 	=


Modified: trunk/lua/obj/obj.player.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.player.lua (original)
+++ trunk/lua/obj/obj.player.lua Wed Mar 12 21:56:33 2008
@@ -83,7 +83,7 @@
 		JournalAddText(&quot;&quot;,&quot;You go into War!&quot;)
 		--printf(&quot;NET: kPacket_SetPlayerWarmode id: 0x%02x gWarmode: combat\n&quot;,i=
d)
 	end
-	gui.SetWarmode(gActWarmode)
+	SetWarmode(gActWarmode)
 end
 =

 =

@@ -97,7 +97,7 @@
 		PlayerBackpackItemUpdated()
 =

 		-- reinit player status dialog and stuff like this
-		PlayerGuiInit()
+		OpenPlayerHealthbar()
 	end
 end
 =



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000768.html">[Iris-commit] [IRIS] r1956 - /trunk/lua/lib.terrain.multitex.lua
</A></li>
	<LI>Next message: <A HREF="000770.html">[Iris-commit] [IRIS] r1958 - /trunk/lua/lib.unifont.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#769">[ date ]</a>
              <a href="thread.html#769">[ thread ]</a>
              <a href="subject.html#769">[ subject ]</a>
              <a href="author.html#769">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
