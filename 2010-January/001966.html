<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r3206 - in /trunk: lua/gui/gui.healthbar.lua lua/lib.configdialog.hotkeys.lua lua/lib.macrolist.lua lua/net/net.other.lua lua/obj/obj.mobile.lua lua/widgets/widget.uotext.lua plugins/loot.lua plugins/moblist.lua
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2010-January/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r3206%20-%20in%20/trunk%3A%20lua/gui/gui.healthbar.lua%0A%20lua/lib.configdialog.hotkeys.lua%20lua/lib.macrolist.lua%0A%20lua/net/net.other.lua%20lua/obj/obj.mobile.lua%20lua/widgets/widget.uotext.lua%0A%20plugins/loot.lua%20plugins/moblist.lua&In-Reply-To=%3C20100107224044.1B82A7A98179%40simon%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="001967.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r3206 - in /trunk: lua/gui/gui.healthbar.lua lua/lib.configdialog.hotkeys.lua lua/lib.macrolist.lua lua/net/net.other.lua lua/obj/obj.mobile.lua lua/widgets/widget.uotext.lua plugins/loot.lua plugins/moblist.lua</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r3206%20-%20in%20/trunk%3A%20lua/gui/gui.healthbar.lua%0A%20lua/lib.configdialog.hotkeys.lua%20lua/lib.macrolist.lua%0A%20lua/net/net.other.lua%20lua/obj/obj.mobile.lua%20lua/widgets/widget.uotext.lua%0A%20plugins/loot.lua%20plugins/moblist.lua&In-Reply-To=%3C20100107224044.1B82A7A98179%40simon%3E"
       TITLE="[Iris-commit] [IRIS] r3206 - in /trunk: lua/gui/gui.healthbar.lua lua/lib.configdialog.hotkeys.lua lua/lib.macrolist.lua lua/net/net.other.lua lua/obj/obj.mobile.lua lua/widgets/widget.uotext.lua plugins/loot.lua plugins/moblist.lua">no-reply at zwischenwelt.org
       </A><BR>
    <I>Thu Jan  7 23:40:43 CET 2010</I>
    <P><UL>
        
        <LI>Next message: <A HREF="001967.html">[Iris-commit] [IRIS] r3207 - /trunk/lua/lib.macrolist.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1966">[ date ]</a>
              <a href="thread.html#1966">[ thread ]</a>
              <a href="subject.html#1966">[ subject ]</a>
              <a href="author.html#1966">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ghoulsblade
Date: Thu Jan  7 23:40:36 2010
New Revision: 3206

Log: (empty)

Modified:
    trunk/lua/gui/gui.healthbar.lua
    trunk/lua/lib.configdialog.hotkeys.lua
    trunk/lua/lib.macrolist.lua
    trunk/lua/net/net.other.lua
    trunk/lua/obj/obj.mobile.lua
    trunk/lua/widgets/widget.uotext.lua
    trunk/plugins/loot.lua
    trunk/plugins/moblist.lua

Modified: trunk/lua/gui/gui.healthbar.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.healthbar.lua (original)
+++ trunk/lua/gui/gui.healthbar.lua Thu Jan  7 23:40:36 2010
@@ -65,8 +65,8 @@
 =

 -- color healthbar for poison/golden effect, called from mobile:UpdateFlag=
s()
 function StatBar_UpdateMobileFlags (mobile)
-	local bPoisoned	=3D TestBit(mobile.flag,kMobileFlag_Poisoned) =

-	local bGolden	=3D TestBit(mobile.flag,kMobileFlag_GoldenHealth) =

+	local bPoisoned	=3D IsMobilePoisoned(mobile) =

+	local bGolden	=3D IsMobileMortaled(mobile) =

 	local iGumpID =3D kHealthBarGump_Bar_Blue
 	if (bPoisoned)	then iGumpID =3D kHealthBarGump_Bar_Green end
 	if (bGolden)	then iGumpID =3D kHealthBarGump_Bar_Golden end

Modified: trunk/lua/lib.configdialog.hotkeys.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.configdialog.hotkeys.lua (original)
+++ trunk/lua/lib.configdialog.hotkeys.lua Thu Jan  7 23:40:36 2010
@@ -115,8 +115,8 @@
 gMobListFilters:Register(&quot;rep:neutral&quot;              ,{fun=3Dfunction (mobi=
le) return mobile.notoriety =3D=3D kNotoriety_Neutral   end})
 gMobListFilters:Register(&quot;rep:crime&quot;                ,{fun=3Dfunction (mobi=
le) return mobile.notoriety =3D=3D kNotoriety_Crime     end})
 gMobListFilters:Register(&quot;rep:orange(enemy)&quot;        ,{fun=3Dfunction (mobi=
le) return mobile.notoriety =3D=3D kNotoriety_Orange    end})
-gMobListFilters:Register(&quot;poisoned&quot;                 ,{fun=3Dfunction (mobi=
le) return TestBit(mobile.flag,kMobileFlag_Poisoned)    end})
-gMobListFilters:Register(&quot;healable&quot;                 ,{fun=3Dfunction (mobi=
le) return ((mobile:GetRelHP() or 1) &lt; 1) and (not TestBit(mobile.flag,kMob=
ileFlag_Poisoned)) and (not TestBit(mobile.flag,kMobileFlag_GoldenHealth)) =
end}) =

+gMobListFilters:Register(&quot;poisoned&quot;                 ,{fun=3Dfunction (mobi=
le) return IsMobilePoisoned(mobile)    end})
+gMobListFilters:Register(&quot;healable&quot;                 ,{fun=3Dfunction (mobi=
le) return ((mobile:GetRelHP() or 1) &lt; 1) and (not IsMobilePoisoned(mobile)=
) and (not IsMobileMortaled(mobile)) end}) =

 gMobListFilters:Register(&quot;inrange&quot;                  ,{fun=3Dfunction (mobi=
le) return not IsOutsideRange(mobile.xloc,mobile.yloc,gPlayerXLoc,gPlayerYL=
oc,gSpellCastRange) end})
 --~ gMobListFilters:Register(&quot;insight&quot;                  ,{fun=3Dfunction (=
mobile) return TODO(mobile.xloc,mobile.yloc,mobile.zloc) end})
 gMobListFilters:Register(&quot;fullhp&quot;                   ,{fun=3Dfunction (mobi=
le) return ((mobile:GetRelHP() or 1) &gt;=3D 1) end})

Modified: trunk/lua/lib.macrolist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.macrolist.lua (original)
+++ trunk/lua/lib.macrolist.lua Thu Jan  7 23:40:36 2010
@@ -43,8 +43,8 @@
 function GetPlayerTithingPoints() return GetMobileStat(GetPlayerMobile(),&quot;=
tithing&quot;) end
 function IsPlayerHidden() local mobile =3D GetPlayerMobile() return mobile=
 and mobile.flag_hidden end
 =

-function MacroCmd_MobilePoisoned (mobile) return mobile and TestBit(mobile=
.flag,kMobileFlag_Poisoned) end
-function MacroCmd_MobileMortaled (mobile) return mobile and TestBit(mobile=
.flag,kMobileFlag_GoldenHealth) end
+function MacroCmd_MobilePoisoned (mobile) return mobile and IsMobilePoison=
ed(mobile) end
+function MacroCmd_MobileMortaled (mobile) return mobile and IsMobileMortal=
ed(mobile) end
 =

 function MacroCmd_MiniHealCureSelf () =

     if (not GetPlayerMobile()) then return end

Modified: trunk/lua/net/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.other.lua (original)
+++ trunk/lua/net/net.other.lua Thu Jan  7 23:40:36 2010
@@ -42,6 +42,9 @@
 	out:PushNetUint8(range)
 	out:SendPacket()
 end
+
+function IsMobilePoisoned (mobile) return mobile.bHealtBarCol_Green  or Te=
stBit(mobile.flag,kMobileFlag_Poisoned) end
+function IsMobileMortaled (mobile) return mobile.bHealtBarCol_Yellow or Te=
stBit(mobile.flag,kMobileFlag_GoldenHealth) end
 =

 -- <A HREF="http://docs.polserver.com/packets/index.php?Packet=3D0x17">http://docs.polserver.com/packets/index.php?Packet=3D0x17</A>      Health b=
ar status update (KR)
 -- new in v7000 ? used on poison state
@@ -63,11 +66,13 @@
 		if (healthbarcol =3D=3D 2) then mask =3D kMobileFlag_GoldenHealth end
 		local mobile =3D GetMobile(serial)
 		if (mobile and mask) then
-			if (bEnable) then =

-				if (not TestBit(mobile.flag,mask)) then mobile.flag =3D mobile.flag + =
mask end
-			else
-				if (TestBit(mobile.flag,mask)) then mobile.flag =3D mobile.flag - mask=
 end
-			end
+			if (healthbarcol =3D=3D 1) then mobile.bHealtBarCol_Green =3D bEnable e=
nd
+			if (healthbarcol =3D=3D 2) then mobile.bHealtBarCol_Yellow =3D bEnable =
end
+			--~ if (bEnable) then =

+				--~ if (not TestBit(mobile.flag,mask)) then mobile.flag =3D mobile.fla=
g + mask end
+			--~ else
+				--~ if (    TestBit(mobile.flag,mask)) then mobile.flag =3D mobile.fla=
g - mask end
+			--~ end
 			mobile:UpdateFlags()
 			print(&quot;healthbarcol:mobile&quot;,serial,mobile.flag)
 		end

Modified: trunk/lua/obj/obj.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.mobile.lua (original)
+++ trunk/lua/obj/obj.mobile.lua Thu Jan  7 23:40:36 2010
@@ -232,13 +232,13 @@
 =

 -- sets self.flag_* from self.flag
 function gMobilePrototype:UpdateFlags	()
-	self.flag_female			=3D TestBit( self.flag, 0x02 )
-	self.flag_poisoned			=3D TestBit( self.flag, 0x04 )
-	self.flag_yellowhits		=3D TestBit( self.flag, 0x08 )
-	self.flag_factionship		=3D TestBit( self.flag, 0x10 )
-	self.flag_explicitmovable	=3D TestBit( self.flag, 0x20 )
-	self.flag_warmode	 		=3D TestBit( self.flag, 0x40 )
-	self.flag_hidden			=3D TestBit( self.flag, 0x80 )
+	self.flag_female			=3D TestBit( self.flag, kMobileFlag_Unknown2 )
+	self.flag_poisoned			=3D IsMobilePoisoned(self) -- kMobileFlag_Poisoned
+	self.flag_yellowhits		=3D IsMobileMortaled(self) -- kMobileFlag_GoldenHea=
lth
+	self.flag_factionship		=3D TestBit( self.flag, kMobileFlag_FactionShip )
+	self.flag_explicitmovable	=3D TestBit( self.flag, kMobileFlag_Movable )
+	self.flag_warmode	 		=3D TestBit( self.flag, kMobileFlag_WarMode )
+	self.flag_hidden			=3D TestBit( self.flag, kMobileFlag_Hidden )
 	=

 	if (self.old_flag ~=3D self.flag) then -- only if a change has occurred
 		self.old_flag  =3D self.flag

Modified: trunk/lua/widgets/widget.uotext.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/widgets/widget.uotext.lua (original)
+++ trunk/lua/widgets/widget.uotext.lua Thu Jan  7 23:40:36 2010
@@ -28,7 +28,7 @@
 	self:SetIgnoreBBoxHit(true) -- default is true for every derivate class o=
f group,
 	-- but text in gumps is not allowed to be mousepickable (e.g. label is di=
splayed above button but not child of button)
 	--~ create uotext  {gumpcommand=3D&quot;htmlgump&quot;,textline_id=3D5,width=3D10=
=3D0x0a,y=3D328=3D0x0148,x=3D210=3D0xd2,default_black=3Dtrue,height=3D16=3D=
0x10,background=3D0,scrollbar=3D0,html=3Dtrue,}
-
+	=

 	if (not text) then
 		if (params.textline_id) then text =3D textlines[params.textline_id] =

 		elseif (params.cliloc_id and gClilocLoader) then =

@@ -41,6 +41,11 @@
 	end
 	text =3D text or &quot;&quot;
 	=

+	if (gDumpLongUOTextToConsole) then =

+		local dumptxt =3D text
+		if (type(dumptxt) =3D=3D &quot;table&quot;) then dumptxt =3D UnicodeToPlainText_Ke=
epLength(dumptxt) end
+		if (dumptxt and type(dumptxt) =3D=3D &quot;string&quot; and #dumptxt &gt;=3D gDumpLon=
gUOTextToConsole) then print(&quot;gDumpLongUOTextToConsole&quot;,dumptxt) end
+	end
 	=

 	self:SetUOHtml(text,bParseHTML)
 	local xoff,yoff =3D -1,-2 -- ugly, but needed for serverside gump positio=
ns ? maybe find a better way, or offset via font or so...

Modified: trunk/plugins/loot.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/plugins/loot.lua (original)
+++ trunk/plugins/loot.lua Thu Jan  7 23:40:36 2010
@@ -3,7 +3,7 @@
 if (not gDisabledPlugins.loot) then =

 gLootPluginCutCorspes =3D false =

 --~ gLootPluginCutCorspes =3D true =

-gLootPluginMinGoldAmount =3D 1500000
+gLootPluginMinGoldAmount =3D gLootPluginMinGoldAmount or 1500000
 =

 kLootPlugin_RecentlyClickedInterval =3D 4*1000
 kLootPluginHideCorpseWithoutContentChangeTimeout =3D false -- if corpse do=
es not contain interesting item and hasn't changed contents, hide it
@@ -190,6 +190,7 @@
 function LootEvaluateItem (item)
 	local artid	=3D item.artid
 	local hue	=3D item.hue
+	print(&quot;LootEvaluateItem&quot;,item,artid,hue)
 	if (artid =3D=3D 0x170b) then return true end -- kobold schuhe
 	if (artid =3D=3D 0x2da2) then return true end -- mysticism scroll
 	if (artid =3D=3D 5110 and hue =3D=3D 2419) then return true end -- gargy =
knife
@@ -214,6 +215,7 @@
 	if (artid =3D=3D 0x1bd1) then return true end -- feathers
 	if (artid =3D=3D 0x26b7) then return true end -- fungus
 	if (artid =3D=3D 0x0e2e) then return true end -- petball
+	print(&quot;LootEvaluateItem2&quot;,item,artid,hue,artid =3D=3D kLootArtID_Gold,ite=
m.amount,gLootPluginMinGoldAmount)
 	--~ if (artid =3D=3D 0x1079) then return true end -- raw leather
 	if (artid =3D=3D kLootArtID_Gold and item.amount &gt;=3D gLootPluginMinGoldA=
mount) then return true end -- gold
 	local tooltip =3D AosToolTip_GetText(item.serial,true)

Modified: trunk/plugins/moblist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/plugins/moblist.lua (original)
+++ trunk/plugins/moblist.lua Thu Jan  7 23:40:36 2010
@@ -470,8 +470,8 @@
 	=

 	-- healthbar color
 	local r,g,b =3D 0,0.5,1 -- blue
-	if (TestBit(mobile.flag,kMobileFlag_Poisoned)		)	then r,g,b =3D 0,0.5,0 e=
nd
-	if (TestBit(mobile.flag,kMobileFlag_GoldenHealth)	)	then r,g,b =3D 1,1,0 =
end
+	if (IsMobilePoisoned(mobile))	then r,g,b =3D 0,0.5,0 end
+	if (IsMobileMortaled(mobile))	then r,g,b =3D 1,1,0 end
 	local gfxparam =3D self.fill.params.gfxparam_init
 	gfxparam.r =3D r =

 	gfxparam.g =3D g =



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="001967.html">[Iris-commit] [IRIS] r3207 - /trunk/lua/lib.macrolist.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1966">[ date ]</a>
              <a href="thread.html#1966">[ thread ]</a>
              <a href="subject.html#1966">[ subject ]</a>
              <a href="author.html#1966">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
