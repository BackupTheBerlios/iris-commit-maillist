<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r1908 - in /trunk: data/base/ lua/ lua/gui/	lua/net/ vs8/
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2008-February/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1908%20-%20in%20/trunk%3A%20data/base/%20lua/%20lua/gui/%0A%09lua/net/%20vs8/&In-Reply-To=%3C20080216010703.F34341C18223%40zwischenwelt.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000719.html">
   <LINK REL="Next"  HREF="000721.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r1908 - in /trunk: data/base/ lua/ lua/gui/	lua/net/ vs8/</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1908%20-%20in%20/trunk%3A%20data/base/%20lua/%20lua/gui/%0A%09lua/net/%20vs8/&In-Reply-To=%3C20080216010703.F34341C18223%40zwischenwelt.org%3E"
       TITLE="[Iris-commit] [IRIS] r1908 - in /trunk: data/base/ lua/ lua/gui/	lua/net/ vs8/">no-reply at zwischenwelt.org
       </A><BR>
    <I>Sat Feb 16 02:07:03 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000719.html">[Iris-commit] [IRIS] r1907 - in /trunk: data/models/materials/ data/models/models/to_011000/ data/models/textures/ lua/ lua/filter/
</A></li>
        <LI>Next message: <A HREF="000721.html">[Iris-commit] [IRIS] r1909 - in /rawdata/sd_pd: houseparts.blend tex_lantern.png tex_lantern.xcf tex_slidingdoor.xcf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#720">[ date ]</a>
              <a href="thread.html#720">[ thread ]</a>
              <a href="subject.html#720">[ subject ]</a>
              <a href="author.html#720">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: sience
Date: Sat Feb 16 02:07:03 2008
New Revision: 1908

Log:
-several updates to mesh rendering dynamics/statics
-hued_effects updated
-new project settings
-lib.pagedialog.lua moved to gui/gui.pagedialog.lua
-questmark.png renamed to trackarrow.png
-several materialnames changed
-obsolete materials removed

Added:
    trunk/data/base/trackarrow.png   (with props)
    trunk/lua/gui/gui.pagedialog.lua
Removed:
    trunk/data/base/questmark.png
    trunk/lua/lib.pagedialog.lua
Modified:
    trunk/data/base/main.material
    trunk/lua/gui/gui.main.lua
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.mobile.lua
    trunk/lua/lib.3d.renderer.lua
    trunk/lua/lib.debugmenu.lua
    trunk/lua/lib.keybinds.lua
    trunk/lua/lib.packet.lua
    trunk/lua/lib.static.lua
    trunk/lua/lib.test.lua
    trunk/lua/main.lua
    trunk/lua/net/net.effect.lua
    trunk/lua/net/net.other.lua
    trunk/vs8/iris.sln
    trunk/vs8/iris.vcproj

Modified: trunk/data/base/main.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/base/main.material (original)
+++ trunk/data/base/main.material Sat Feb 16 02:07:03 2008
@@ -93,7 +93,7 @@
 			//depth_write off
 			//depth_check off
 =

-			texture_unit skytex
+			texture_unit
 			{
 				texture stone512.dds
 				tex_address_mode border
@@ -112,42 +112,8 @@
 	set_texture_alias arttex art_fallback.png
 }
 =

-// mouse cursor material
-material mousecursor
-{
-	set_texture_alias guitex mousecursor.png
-}
-
-// radarcompass materials
-material tempmap_0_small : tempmapbase
-{
-	set_texture_alias skytex tempmap_0_small_s.tga
-}
-
-material tempmap_1_small : tempmapbase
-{
-	set_texture_alias skytex tempmap_1_small_s.tga
-}
-
-material tempmap_2_small : tempmapbase
-{
-	set_texture_alias skytex tempmap_2_small_s.tga
-}
-material tempmap_3_small : tempmapbase
-{
-	set_texture_alias skytex tempmap_3_small_s.tga
-}
-material tempmap_4_small : tempmapbase
-{
-	set_texture_alias skytex tempmap_4_small_s.tga
-}
-material tempmap_5_small : tempmapbase
-{
-	set_texture_alias skytex tempmap_5_small_s.tga
-}
-
 // material to show a simple 3D health bar
-material bar : guibase
+material mobile/3d_healthbar : guibase
 {
 	technique
 	{
@@ -164,7 +130,7 @@
 	}
 }
 =

-material aura_base : guibase
+material mobile/aura_base : guibase
 {
 	technique
 	{
@@ -183,7 +149,7 @@
 	}
 }
 =

-material quest_arrow : guibase
+material tracking_arrow : guibase
 {
 	technique
 	{
@@ -193,7 +159,7 @@
 			{
 				filtering anisotropic
 				max_anisotropy 8
-				texture questmark.png
+				texture trackarrow.png
 				tex_address_mode clamp
 			}
 		}

Modified: trunk/lua/gui/gui.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.main.lua (original)
+++ trunk/lua/gui/gui.main.lua Sat Feb 16 02:07:03 2008
@@ -1,9 +1,12 @@
 dofile(libpath .. &quot;gui/gui.widget.lua&quot;)
 dofile(libpath .. &quot;gui/gui.gumpmanager.lua&quot;)
-dofile(libpath .. &quot;gui/gui.container.lua&quot;)
 dofile(libpath .. &quot;gui/gui.paperdoll.lua&quot;)
 dofile(libpath .. &quot;gui/gui.journal.lua&quot;)
 dofile(libpath .. &quot;gui/gui.quit.lua&quot;)
 dofile(libpath .. &quot;gui/gui.status.lua&quot;)
 dofile(libpath .. &quot;gui/gui.styles.lua&quot;)
 dofile(libpath .. &quot;gui/gui.hotbar.lua&quot;)
+
+-- TODO
+dofile(libpath .. &quot;gui/gui.container.lua&quot;)
+dofile(libpath .. &quot;gui/gui.pagedialog.lua&quot;)

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sat Feb 16 02:07:03 2008
@@ -21,7 +21,6 @@
 end
 =

 function Renderer3D:CheckForFastBatchDynamicsUpdate ()
-	if (gTestHideDynamics) then return end =

 	if Renderer3D.gFastBatchDynamicsUpdateNeeded and =

 		(not Renderer3D.gFastBatchDynamicsUpdateNext or Renderer3D.gFastBatchDyn=
amicsUpdateNext &lt; gMyTicks) then
 =

@@ -39,11 +38,9 @@
 		local qw,qx,qy,qz
 		-- add dynamics
 		for k,dynamic in pairs(GetDynamicList()) do
-			-- print(&quot;DEBUG&quot;,&quot;ADD DYNAMIC&quot;,dynamic.meshname)
 			if (dynamic.meshname and DynamicIsInWorld(dynamic)) then
 				x,y,z =3D Renderer3D:UOPosToLocal(dynamic.xloc + dynamic.xadd,dynamic.=
yloc + dynamic.yadd,dynamic.zloc * 0.1 + dynamic.zadd) =

 				qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
-				-- print(&quot;FASTBATCH POS&quot;,x,y,z,&quot;ROT&quot;,qw,qx,qy,qz)
 =

 				local r,g,b,a =3D 1,1,1,1
 				if (gHueLoader and dynamic.hue &gt; 0) then
@@ -106,7 +103,6 @@
 -- TODO: Multis &amp; Serversidemultis don't recognize kTileDataFlag_LightSour=
ce yet
 function Renderer3D:CreateDynamicGfx( item )
 	assert(not item.gfx)
-	if (gTestHideDynamics) then return end
 =

 	-- FILTER: get correction
 	item.xadd =3D FilterPositionX(item.artid) or 0
@@ -191,66 +187,62 @@
 		end
 	else
 		-- normal 1 part object
-		local meshname =3D (not gForceFallBackBillboards_Dynamics) and GetMeshNa=
me(item.artid) -- ,item.hue)
+		local meshname =3D (not gForceFallBackBillboards_Dynamics) and GetMeshNa=
me(item.artid, 0)
 		item.meshname =3D meshname
-		-- print(&quot;DEBUG&quot;,&quot;meshname&quot;,item.meshname)
 		=

-		if gFastBatchDynamics and meshname and meshname ~=3D false then
+		if (gFastBatchDynamics and meshname and meshname ~=3D false) then
 			-- trigger: burn all dynamics into the dynamic fastbatch
 			item.meshbuffer =3D GetMeshBuffer(meshname) -- for mousepicking
 			TexAtlas_AdjustMeshBufferIfNeeded(meshname,item.meshbuffer)
 			Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
-		else
+		elseif (meshname and meshname ~=3D false) then
 			-- just add the dynamic as a scene node
 			item.gfx =3D CreateRootGfx3D()
-			if (meshname and meshname ~=3D false) then
-				item.gfx:SetMesh(meshname)
-				item.gfx:SetScale(-1,1,1)		-- (-1) thats because xmirror bug and wrong=
 mirrored mashes
-				item.gfx:SetNormaliseNormals(true)
-				item.gfx:SetCastShadows(gDynamicsCastShadows)
-				-- primary color hueing
-				if gHueLoader and item.hue &gt; 0 then
-					local r,g,b =3D gHueLoader:GetColor(item.hue - 1,31) -- get first col=
or
-					HueMeshEntity(item.gfx,r,g,b,r,g,b)
-				end
-			elseif (gEnableFallBackBillboards_Dynamics) then
-				local iTranslatedTileTypeID =3D SeasonalStaticTranslation(item.artid, =
gSeasonSetting)
-				-- we have to add 16384 for fallbacks, because static Art starts on 16=
384 in Art.mul file
-				iTranslatedTileTypeID =3D iTranslatedTileTypeID + 16384
-
-				-- fallback to billboard with original art
-				if (not IsArtBillboardFallBackSkipped(item.artid)) then
-					-- generate uoart billboard fallback
-					item.gfx.billboard =3D item.gfx:CreateChild()
-					item.xadd =3D item.xadd + 0.5
-					item.yadd =3D item.yadd + 0.5
-					item.zadd =3D item.zadd + 0.5
-					self:CreateArtBillBoard(item.gfx.billboard,iTranslatedTileTypeID,item=
.hue)
-					printdebug(&quot;missing&quot;,sprintf(&quot;Renderer3D:CreateDynamicGfx: failed loa=
ding mesh for dynamic: artid=3D%i z_typename=3D%s\n&quot;,item.artid or -1,GetSt=
aticTileTypeName(item.artid) or &quot;&quot;))
-				end
-			end
-
+			item.gfx:SetMesh(meshname)
+			item.gfx:SetOrientation(GetStaticMeshOrientation(item.artid))
+			item.gfx:SetScale(-1,1,1)		-- (-1) thats because xmirror bug and wrong =
mirrored meshes
+			item.gfx:SetNormaliseNormals(true)
+			item.gfx:SetCastShadows(gDynamicsCastShadows)
+			-- primary color hueing
+			if gHueLoader and item.hue &gt; 0 then
+				local r,g,b =3D gHueLoader:GetColor(item.hue - 1,31) -- get first color
+				HueMeshEntity(item.gfx,r,g,b,r,g,b)
+			end
 			item.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)
-
-			-- FILTER: correction
-			item.gfx:SetOrientation(GetStaticMeshOrientation(item.artid))
-
+			-- set's position and add's xadd,yadd,zadd corrections
 			self:UpdateDynamicItemPos(item)
-
-		end
-
-		-- creates a light if lights are enabled and static is a lightsource
-		-- note! lights don't cast shadows
-		if (gLightsources) then
-			local arrtiletype =3D GetStaticTileType(item.artid)
-			if( arrtiletype and TestBit(arrtiletype.miFlags or 0,kTileDataFlag_Ligh=
tSource) ) then
-				local x,y,z =3D Renderer3D:UOPosToLocal(item.xloc,item.yloc,(item.zloc=
+arrtiletype.miHeight) * 0.1)
-				item.lightname=3DClient_AddPointLight(x,y,z, 0.3,0.3,0.0, 0.3,0.3,0.0,=
 5.0,0.1,0.1,0.0)
-			end
-		end
-
-	end
-	self:UpdateDynamicVisibility(item)
+			-- updates the layer-visibility
+			self:UpdateDynamicVisibility(item)
+		elseif (gEnableFallBackBillboards_Dynamics) then
+			-- fallback to billboard with original art
+			if (not IsArtBillboardFallBackSkipped(item.artid)) then
+				item.gfx =3D CreateRootGfx3D()
+				item.gfx.billboard =3D item.gfx:CreateChild()
+				item.xadd =3D item.xadd + 0.5
+				item.yadd =3D item.yadd + 0.5
+				item.zadd =3D item.zadd + 0.5
+				self:CreateArtBillBoard(item.gfx.billboard,item.artid + 16384,item.hue)
+				printdebug(&quot;missing&quot;,sprintf(&quot;Renderer3D:CreateDynamicGfx: failed load=
ing mesh for dynamic: artid=3D%i z_typename=3D%s\n&quot;,item.artid or -1,GetSta=
ticTileTypeName(item.artid) or &quot;&quot;))
+				item.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)
+				-- set's position and add's xadd,yadd,zadd corrections
+				self:UpdateDynamicItemPos(item)
+				-- updates the layer-visibility
+				self:UpdateDynamicVisibility(item)
+			end
+		else
+			print(&quot;no mesh found &amp; no billboard used for this artID=3D&quot;..item.artid)
+		end
+	end
+
+	-- creates a light if lights are enabled and static is a lightsource
+	-- note! lights don't cast shadows
+--	if (gLightsources) then
+--		local arrtiletype =3D GetStaticTileType(item.artid)
+--		if( arrtiletype and TestBit(arrtiletype.miFlags or 0,kTileDataFlag_Lig=
htSource) ) then
+--			local x,y,z =3D Renderer3D:UOPosToLocal(item.xloc,item.yloc,(item.zlo=
c+arrtiletype.miHeight) * 0.1)
+--			item.lightname=3DClient_AddPointLight(x,y,z, 0.3,0.3,0.0, 0.3,0.3,0.0=
, 5.0,0.1,0.1,0.0)
+--		end
+--	end
 end
 =

 function Renderer3D:CreateArtBillBoard( gfx, iArtID, iHue )

Modified: trunk/lua/lib.3d.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mobile.lua (original)
+++ trunk/lua/lib.3d.mobile.lua Sat Feb 16 02:07:03 2008
@@ -45,7 +45,7 @@
 	if (not mobile.bar) then
 		mobile.bar =3D CreateRootGfx3D()
 		mobile.bar:SetSimpleRenderable()
-		mobile.bar:SetMaterial(&quot;bar&quot;)
+		mobile.bar:SetMaterial(&quot;mobile/3d_healthbar&quot;)
 		mobile.bar:SetForceRotCam(GetMainCam())
 		mobile.bar.lastn =3D nil
 	end
@@ -104,7 +104,7 @@
 	if (not mobile.aura) then
 		mobile.aura =3D CreateRootGfx3D()
 		mobile.aura:SetSimpleRenderable()
-		mobile.aura:SetMaterial(&quot;aura_base&quot;)
+		mobile.aura:SetMaterial(&quot;mobile/aura_base&quot;)
 		mobile.aura.lastn =3D nil
 	end
 	=

@@ -139,7 +139,7 @@
 		local e =3D 1.0
 		mobile.selection =3D CreateRootGfx3D()
 		mobile.selection:SetSimpleRenderable()
-		mobile.selection:SetMaterial(&quot;aura_base&quot;)
+		mobile.selection:SetMaterial(&quot;mobile/aura_base&quot;)
 		mobile.selection:RenderableBegin(4,6,false,false,OT_TRIANGLE_LIST)
 		mobile.selection:RenderableVertex(-e,-e,0, nx,ny,nz, 0,0, r,g,b,a)
 		mobile.selection:RenderableVertex( e,-e,0, nx,ny,nz, 1,0, r,g,b,a)

Modified: trunk/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.renderer.lua (original)
+++ trunk/lua/lib.3d.renderer.lua Sat Feb 16 02:07:03 2008
@@ -160,6 +160,7 @@
 		OgreShadowTechnique(gShadowTechnique)
 		OgreSetShadowTextureSize(2048)
 		OgreSetShadowCasterRenderBackFaces(false)
+		OgreSetShadowTextureCount(3)
 =

 --mLiSPSMSetup =3D new LiSPSMShadowCameraSetup()
 --m_pSceneMgr-&gt;setShadowCameraSetup(ShadowCameraSetupPtr(mLiSPSMSetup))
@@ -174,6 +175,7 @@
  		OgreShadowTechnique(gShadowTechnique)
 		OgreSetShadowTextureSize(2048)
 		OgreSetShadowCasterRenderBackFaces(false)
+		OgreSetShadowTextureCount(3)
 =

 		OgreSetShadowTexturePixelFormat(PF_FLOAT32_R)
 		OgreSetShadowTextureCasterMaterial(&quot;Ogre/DepthShadowmap/Caster/Float&quot;)
@@ -297,10 +299,11 @@
 		workingeffect =3D Renderer3D:AddParticleEffect( effect, gParticleEffects=
[effect.itemid].name,
 								gParticleEffects[effect.itemid].relx, gParticleEffects[effect.item=
id].rely, gParticleEffects[effect.itemid].relz,
 								gParticleEffects[effect.itemid].scalex, gParticleEffects[effect.it=
emid].scaley, gParticleEffects[effect.itemid].scalez)
-	elseif (effect.iseffect~=3Dtrue) then
+	elseif ( effect.huedeffect ) then
 		workingeffect =3D Renderer3D:AddHuedEffect( effect, 1, 0, 0 )
 	end
 =

+	-- if it's no huedeffect or no particle effect is defined, use a standard=
 particle effect
 	if (workingeffect =3D=3D nil) then
 		Renderer3D:AddParticleEffect( effect, gParticleEffects[StandardEffect].n=
ame,
 								gParticleEffects[StandardEffect].relx, gParticleEffects[StandardEf=
fect].rely, gParticleEffects[StandardEffect].relz,
@@ -310,12 +313,29 @@
 =

 -- Hued Effect : to display Meshes as instant Effects
 function Renderer3D:AddHuedEffect( effect, relx, rely, relz )
-	local meshname =3D GetMeshName(effect.itemid,effect.hue)
+	local meshname =3D GetMeshName(effect.itemid, 0)
 	if (meshname and meshname ~=3D false) then
 		effect.gfx =3D CreateRootGfx3D()
 		effect.gfx:SetMesh(meshname)
+		effect.gfx:SetOrientation(GetStaticMeshOrientation(effect.itemid))
+		effect.gfx:SetScale(-1,1,1)				-- (-1) thats because xmirror bug and wro=
ng mirrored meshes
+		effect.gfx:SetNormaliseNormals(true)
+		effect.gfx:SetCastShadows(gDynamicsCastShadows)
+		-- primary color hueing
+		if gHueLoader and effect.hue &gt; 0 then
+			local r,g,b =3D gHueLoader:GetColor(effect.hue - 1,31) -- get first col=
or
+			HueMeshEntity(effect.gfx,r,g,b,r,g,b)
+		end
 		effect.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)
-		effect.gfx:SetPosition(self:UOPosToLocal(effect.current_locx + relx,effe=
ct.current_locy + rely,effect.current_locz * 0.1 + relz))
+
+		-- position adjustment for statics and dynamics
+		effect.xadd =3D FilterPositionX(effect.itemid) or 0
+		effect.yadd =3D FilterPositionY(effect.itemid) or 0
+		effect.zadd =3D FilterPositionZ(effect.itemid) or 0
+
+		effect.gfx:SetPosition(self:UOPosToLocal(effect.current_locx + relx,
+												 effect.current_locy + rely,
+												 effect.current_locz * 0.1 + relz))
 =

 		printdebug(&quot;effect&quot;,sprintf(&quot;Create HuedEffect with Mesh=3D%s MeshID=3D0=
x%04x.\n&quot;,meshname,effect.itemid) )
 =

@@ -329,12 +349,6 @@
 		end)
 =

 		printdebug(&quot;effect&quot;,vardump(effect))
-		--~ print(&quot;##################################&quot;)
-		--~ print(&quot;DEBUG&quot;,effect.speed,effect.duration)
-		--~ print(&quot;DEBUG current&quot;,effect.current_locx,effect.current_locy,effect=
.current_locz)
-		--~ print(&quot;DEBUG source&quot;,effect.source_locx,effect.source_locy,effect.so=
urce_locz)
-		--~ print(&quot;DEBUG target&quot;,effect.target_locx,effect.target_locy,effect.ta=
rget_locz)
-		--~ print(&quot;##################################&quot;)
 =

 		if =

 			effect.current_locx ~=3D effect.target_locx or
@@ -429,12 +443,6 @@
 	end)
 	=

 	printdebug(&quot;effect&quot;,vardump(effect))
-	--~ print(&quot;##################################&quot;)
-	--~ print(&quot;DEBUG&quot;,effect.speed,effect.duration)
-	--~ print(&quot;DEBUG current&quot;,effect.current_locx,effect.current_locy,effect.=
current_locz)
-	--~ print(&quot;DEBUG source&quot;,effect.source_locx,effect.source_locy,effect.sou=
rce_locz)
-	--~ print(&quot;DEBUG target&quot;,effect.target_locx,effect.target_locy,effect.tar=
get_locz)
-	--~ print(&quot;##################################&quot;)
 =

 	if =

 		effect.current_locx ~=3D effect.target_locx or
@@ -507,16 +515,16 @@
 =

 =

 --###############################
---###       QUEST ARROW       ###
+--###       Tracking ARROW    ###
 --###############################
-Renderer3D.gQuestArrow =3D nil
-
-function Renderer3D:ShowQuestArrow( active, x, y )
+Renderer3D.gTrackingArrow =3D nil
+
+function Renderer3D:UpdateTrackingArrow( active, x, y )
 	if (active=3D=3D1) then
-		if (not self.gQuestArrow) then
-			self.gQuestArrow =3D CreateRootGfx3D()
-			self.gQuestArrow:SetSimpleRenderable()
-			self.gQuestArrow:SetMaterial(&quot;quest_arrow&quot;)
+		if (not self.gTrackingArrow) then
+			self.gTrackingArrow =3D CreateRootGfx3D()
+			self.gTrackingArrow:SetSimpleRenderable()
+			self.gTrackingArrow:SetMaterial(&quot;tracking_arrow&quot;)
 		end
 =

 		local nx,ny,nz =3D 0,0,1
@@ -527,20 +535,20 @@
 		local a =3D 0.6
 		local e =3D 0.3
 =

-		self.gQuestArrow:RenderableBegin(4,6,false,false,OT_TRIANGLE_LIST)
-		self.gQuestArrow:RenderableVertex(-e,-e,0, nx,ny,nz, 0,0, r,g,b,a)
-		self.gQuestArrow:RenderableVertex( e,-e,0, nx,ny,nz, 1,0, r,g,b,a)
-		self.gQuestArrow:RenderableVertex(-e, e,0, nx,ny,nz, 0,1, r,g,b,a)
-		self.gQuestArrow:RenderableVertex( e, e,0, nx,ny,nz, 1,1, r,g,b,a)
-		self.gQuestArrow:RenderableIndex3(0,1,2)
-		self.gQuestArrow:RenderableIndex3(1,3,2)
-		self.gQuestArrow:RenderableEnd()
-		self.gQuestArrow:SetForceRotCam(GetMainCam())
-		self.gQuestArrow:SetPosition( self:UOPosToLocal(0.5 + x,0.5 + y,0.1 + ( =
iZLoc+30) * 0.1) )
+		self.gTrackingArrow:RenderableBegin(4,6,false,false,OT_TRIANGLE_LIST)
+		self.gTrackingArrow:RenderableVertex(-e,-e,0, nx,ny,nz, 0,0, r,g,b,a)
+		self.gTrackingArrow:RenderableVertex( e,-e,0, nx,ny,nz, 1,0, r,g,b,a)
+		self.gTrackingArrow:RenderableVertex(-e, e,0, nx,ny,nz, 0,1, r,g,b,a)
+		self.gTrackingArrow:RenderableVertex( e, e,0, nx,ny,nz, 1,1, r,g,b,a)
+		self.gTrackingArrow:RenderableIndex3(0,1,2)
+		self.gTrackingArrow:RenderableIndex3(1,3,2)
+		self.gTrackingArrow:RenderableEnd()
+		self.gTrackingArrow:SetForceRotCam(GetMainCam())
+		self.gTrackingArrow:SetPosition( self:UOPosToLocal(0.5 + x,0.5 + y,0.1 +=
 ( iZLoc+30) * 0.1) )
 	else
-		if (self.gQuestArrow) then
-			self.gQuestArrow:Destroy()
-			self.gQuestArrow=3Dnil
+		if (self.gTrackingArrow) then
+			self.gTrackingArrow:Destroy()
+			self.gTrackingArrow=3Dnil
 		end
 	end
 end

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Sat Feb 16 02:07:03 2008
@@ -546,8 +546,6 @@
 	gDebugRootGfx =3D CreateRootGfx3D()
 	gDebugRootGfx2 =3D CreateRootGfx3D()
 	=

-	local xadd,yadd,zadd =3D 0,0,0
-	=

 	-- granny =

 	if (gCurDebugMode =3D=3D kDebugMode_Granny) then
 		local mobile =3D gDebugMenuModelTable[index]
@@ -569,13 +567,13 @@
 		if (gDebugMenuAnimIndex &gt;=3D 0) then gDebugBodyGfx:StartAnimLoop(gDebugM=
enuAnimIndex) end
 	end
 	=

-	=

+	local xadd,yadd,zadd =3D 0,0,0
 	-- static =

 	if (gCurDebugMode =3D=3D kDebugMode_Static) then
 		local iTileType =3D gDebugMenuModelIndex
 		local iHue =3D gDebugMenuAnimIndex
 		local info =3D GetStaticTileType(iTileType)
-		local meshname =3D GetMeshName(iTileType,iHue)
+		local meshname =3D GetMeshName(iTileType, 0)	-- iHue
 		if gDebugLastMeshName then ReloadMesh(gDebugLastMeshName) end
 		gDebugLastMeshName =3D meshname
 		local tricount =3D meshname and CountMeshTriangles(meshname) or 0
@@ -583,8 +581,14 @@
 		if (meshname and meshname ~=3D false) then
 			gDebugRootGfx:SetMesh(meshname)
 			gDebugRootGfx:SetOrientation(GetStaticMeshOrientation(iTileType))
-			gDebugRootGfx:SetScale(-1,1,1)			-- (-1) thats because xmirror bug and =
wrong mirrored mashes
+			gDebugRootGfx:SetScale(-1,1,1)			-- (-1) thats because xmirror bug and =
wrong mirrored meshes
 			gDebugRootGfx:SetNormaliseNormals(true)
+			gDebugRootGfx:SetCastShadows(gDynamicsCastShadows)
+			-- primary color hueing
+			if gHueLoader and iHue &gt; 0 then
+				local r,g,b =3D gHueLoader:GetColor(iHue - 1,31) -- get first color
+				HueMeshEntity(gDebugRootGfx,r,g,b,r,g,b)
+			end
 			-- position adjustment for statics and dynamics
 			xadd =3D FilterPositionX(iTileType) or 0
 			yadd =3D FilterPositionY(iTileType) or 0
@@ -612,10 +616,10 @@
 			local tries =3D 400
 			local add =3D (delta &gt; 0) and 1 or -1
 			newval =3D newval + add
-			local meshname =3D GetMeshName(newval,0)
+			local meshname =3D GetMeshName(newval, 0)
 			while (tries &gt; 0 and ((not meshname) or (CountMeshTriangles(meshname) &gt;=
 6))) do
 				newval =3D newval + add
-				meshname =3D GetMeshName(newval,0)
+				meshname =3D GetMeshName(newval, 0)
 				tries =3D tries - 1
 			end =

 		end

Modified: trunk/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.keybinds.lua (original)
+++ trunk/lua/lib.keybinds.lua Sat Feb 16 02:07:03 2008
@@ -33,7 +33,7 @@
 	Bind(&quot;up&quot;,      function (state) if (not gActiveEditText) then if (state =
&gt;<i> 0) then CancelAutoWalk() end else ChatLine_HistoryUpDown(1) end end)
</I> 	=

 	-------------------------------------------------------------------------=
----------
---[[
+
 	if (true) then
 		Bind(&quot;f7&quot;,		function (state) if (not gActiveEditText) then if (state &gt; 0=
) then
 			if (gAmbientLight.r &lt; 1.0) then
@@ -60,18 +60,22 @@
 			Client_SetAmbientLight(gAmbientLight.r, gAmbientLight.g, gAmbientLight.=
b, 1)
 	 	end end end)
 		Bind(&quot;f9&quot;,		function (state) if (not gActiveEditText) then if (state &gt; 0=
) then
-			--local vr =3D OgreAddCompositor(GetMainViewport(), &quot;B&amp;W&quot;)
-			Send_AOSCommand(kPacket_AOS_Command_WeaponAbilityRequest,hex2num(&quot;0x1&quot;)=
,2)
+			if (gCompositor) then
+				print(&quot;remove compositor&quot;)
+				OgreRemoveCompositor(GetMainViewport(),&quot;B&amp;W&quot;)
+				gCompositor =3D false
+			else
+				print(&quot;add compositor&quot;)
+				OgreAddCompositor(GetMainViewport(), &quot;B&amp;W&quot;)
+				gCompositor =3D true
+			end
+			--Send_AOSCommand(kPacket_AOS_Command_WeaponAbilityRequest,hex2num(&quot;0x1=
&quot;),2)
 		 end end end)
 	=

 		Bind(&quot;f2&quot;,		function (state) if (not gActiveEditText) then if (state &gt; 0=
) then =

 			local mobile =3D GetPlayerMobile()
 			if mobile then
 				local effect =3D {}
-				effect.source_locx =3D mobile.xloc
-				effect.source_locy =3D mobile.yloc
-				effect.source_locz =3D mobile.zloc
-		=

 				effect.current_locx =3D mobile.xloc
 				effect.current_locy =3D mobile.yloc
 				effect.current_locz =3D mobile.zloc
@@ -88,6 +92,6 @@
 			end
 		end end end)
 	end
-]]--
+
 =

 end

Modified: trunk/lua/lib.packet.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.packet.lua (original)
+++ trunk/lua/lib.packet.lua Sat Feb 16 02:07:03 2008
@@ -194,7 +194,7 @@
 gPacketType.kPacket_Help_Text										=3D { id=3Dhex2num(&quot;0xB7&quot;) }
 gPacketType.kPacket_Character_Profile								=3D { id=3Dhex2num(&quot;0xB8&quot;) }
 gPacketType.kPacket_Features										=3D { id=3Dhex2num(&quot;0xB9&quot;) }
-gPacketType.kPacket_QuestArrow										=3D { id=3Dhex2num(&quot;0xBA&quot;) }
+gPacketType.kPacket_TrackingArrow									=3D { id=3Dhex2num(&quot;0xBA&quot;) }
 gPacketType.kPacket_Account_ID										=3D { id=3Dhex2num(&quot;0xBB&quot;) }
 gPacketType.kPacket_Game_Season										=3D { id=3Dhex2num(&quot;0xBC&quot;) }
 gPacketType.kPacket_Client_Version									=3D { id=3Dhex2num(&quot;0xBD&quot;) }

Modified: trunk/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.static.lua (original)
+++ trunk/lua/lib.static.lua Sat Feb 16 02:07:03 2008
@@ -35,7 +35,7 @@
 -- generates or retrieves meshname for static model
 -- TODO : not flexible enough, what if model should be skipped, or multipl=
e models set ? or model depending on surrounding ?
 gLegacyModelCache =3D {}
-function GetMeshName (iTileTypeID,iHue)
+function GetMeshName (iTileTypeID, iHue)
 	-- hue default value is 0
 	iHue =3D tonumber(iHue) or 0
 	--1st: Seasonal Translation
@@ -71,7 +71,8 @@
 		else
 			printdebug(&quot;static&quot;,&quot;mesh already found in cache &quot;,meshname, iHue)
 		end
-
+--[[
+		-- not needed for fastbatch ( it's managed in CreateMapChunkEntity )
 		-- TODO: CLONEMESH &amp; HUEMESH both have a very huge load and should use E=
ntities for Material Hueing !!!!!!!!!!!!!
 		-- Hue this Model | TODO: Partitial Hue is currently skipped
 		if (gHueLoader and meshname) then
@@ -87,6 +88,7 @@
 				return clonemeshname
 			end
 		end
+]]--
 	else
 		printdebug(&quot;static&quot;,&quot;mesh already found in cache &quot;,meshname, iHue)
 	end
@@ -109,6 +111,6 @@
 -- TODO: Wrong !!! hueing must be taken from statics instead of tiledata
 function PreloadAllStaticMesh()
 	for i =3D 0,16085 do
-		GetMeshName(i)
+		GetMeshName(i, 0)
 	end
 end

Modified: trunk/lua/lib.test.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.test.lua (original)
+++ trunk/lua/lib.test.lua Sat Feb 16 02:07:03 2008
@@ -117,12 +117,9 @@
 =

 	local polycount =3D 0
 	for k,obj in pairs(staticAnalysis) do
-		-- obsolete, because Legacy Loader has been removed
-		--polycount =3D gLegacyModelAndTextureLoader:GetMeshPolyCount(obj.typeid)
-
---		print(&quot;obj.typeid: &quot;..obj.typeid)
---		local meshname =3D GetMeshName(obj.typeid,0)
---		if (meshname and meshname ~=3D false) then polycount =3D CountMeshTria=
ngles(meshname) end
+		print(&quot;obj.typeid: &quot;..obj.typeid)
+		local meshname =3D GetMeshName(obj.typeid,0)
+		if (meshname and meshname ~=3D false) then polycount =3D CountMeshTriang=
les(meshname) end
 		if (polycount &lt; 1) then =

 			print(obj.amount,sprintf(&quot;0x%04x&quot;,obj.typeid),obj.typeid,obj.typeobj.ms=
Name,polycount)
 		end

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Feb 16 02:07:03 2008
@@ -79,7 +79,6 @@
 dofile(libpath .. &quot;lib.cursor.lua&quot;)
 dofile(libpath .. &quot;lib.mainmenu.lua&quot;)
 dofile(libpath .. &quot;lib.debugmenu.lua&quot;)
-dofile(libpath .. &quot;lib.pagedialog.lua&quot;)
 dofile(libpath .. &quot;lib.diff.lua&quot;)
 dofile(libpath .. &quot;lib.deffileparser.lua&quot;)
 dofile(libpath .. &quot;lib.fallback.lua&quot;)

Modified: trunk/lua/net/net.effect.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.effect.lua (original)
+++ trunk/lua/net/net.effect.lua Sat Feb 16 02:07:03 2008
@@ -9,29 +9,25 @@
 	effect.targetserial =3D input:PopNetUint32()
 	effect.itemid =3D input:PopNetUint16()
 	=

-	effect.source_locx =3D input:PopNetUint16()
-	effect.source_locy =3D input:PopNetUint16()
-	effect.source_locz =3D input:PopNetUint8()
+	effect.current_locx =3D input:PopNetUint16()
+	effect.current_locy =3D input:PopNetUint16()
+	effect.current_locz =3D input:PopNetUint8()
 	=

 	effect.target_locx =3D input:PopNetUint16()
 	effect.target_locy =3D input:PopNetUint16()
 	effect.target_locz =3D input:PopNetUint8()
 =

-	effect.current_locx =3D effect.source_locx
-	effect.current_locy =3D effect.source_locy
-	effect.current_locz =3D effect.source_locz
-
 	effect.speed =3D input:PopNetUint8()
 	effect.duration =3D input:PopNetUint8()
 	effect.unkown =3D input:PopNetUint16()
-	effect.fixeddirection =3D input:PopNetUint8()
+	effect.fixeddirection =3D input:PopNetUint8()		-- fixed duration ??
 	effect.explodes =3D input:PopNetUint8()
 	effect.hue =3D input:PopNetUint32()
 	effect.rendermode =3D input:PopNetUint32()
-	effect.iseffect =3D true
+	effect.huedeffect =3D true
 	=

 	printdebug(&quot;net&quot;, sprintf(&quot;Hued_FX: artid=3D0x%04x locx=3D%i locy=3D%i lo=
cz=3D%i targetx=3D%i targety=3D%i targetz=3D%i effect_type=3D%s\n&quot;,
-			effect.itemid, effect.source_locx, effect.source_locy, effect.source_lo=
cz,
+			effect.itemid, effect.current_locx, effect.current_locy, effect.current=
_locz,
 			effect.target_locx, effect.target_locy, effect.target_locz, gEffectType=
s[effect.effect_type]) )
 	=

 	if (gParticleEffectSystem) then gCurrentRenderer:AddEffect( effect ) end

Modified: trunk/lua/net/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.other.lua (original)
+++ trunk/lua/net/net.other.lua Sat Feb 16 02:07:03 2008
@@ -9,12 +9,13 @@
 kPacket_Generic_SubCommand_PartySystem			=3D hex2num(&quot;0x06&quot;)
 kPacket_Generic_SubCommand_QuestArrow			=3D hex2num(&quot;0x07&quot;)
 kPacket_Generic_SubCommand_MapChange			=3D hex2num(&quot;0x08&quot;)
-
+kPacket_Generic_SubCommand_DisarmRequest		=3D hex2num(&quot;0x09&quot;)
 kPacket_Generic_SubCommand_AOSTooltip			=3D hex2num(&quot;0x10&quot;)
 --(0x0A) Sent by using the client Wrestle Stun Macro key in Options.
 --This is no longer used since AoS was introduced. The Macro selection tha=
t used it was removed.
 kPacket_Generic_SubCommand_Wrestling_Stun		=3D hex2num(&quot;0x0A&quot;)
 kPacket_Generic_SubCommand_ClientLanguage		=3D hex2num(&quot;0x0B&quot;)	-- Client s=
ends Client-language to Server
+kPacket_Generic_SubCommand_CloseStatus			=3D hex2num(&quot;0x0C&quot;)
 kPacket_Generic_SubCommand_3DClientAction		=3D hex2num(&quot;0x0E&quot;)	-- Client S=
ent. Server responds with Play Animation packets.
 kPacket_Generic_SubCommand_PopupRequest			=3D hex2num(&quot;0x13&quot;)	-- Client -&gt;=
 Server packet
 kPacket_Generic_SubCommand_DisplayPopup			=3D hex2num(&quot;0x14&quot;)
@@ -150,6 +151,7 @@
 =

 	-- Quest Arrow (mobile)
 	if (subcmd =3D=3D kPacket_Generic_SubCommand_QuestArrow) then --0x07
+		-- TODO: check ... specification is: byte - Right Click (1=3Dyes, 0=3Dno)
 		for i =3D 0, size-6 do
 			local temp =3D input:PopNetUint8()
 			print(&quot;NET (todo): 0xbf Quest_Arrow subcmd 0x07: &quot;..temp)
@@ -160,7 +162,12 @@
 	if (subcmd =3D=3D kPacket_Generic_SubCommand_MapChange) then -- 0x08
 		local mapid =3D input:PopNetUint8()
 		MapChangeRequest(mapid)
-		-- PROBABLY WRONG NOW we index internally with 1, OSi with 0
+	end
+
+	if (subcmd =3D=3D kPacket_Generic_SubCommand_CloseStatus) then	--0x0C
+		local mobilestatus_serial =3D input:PopNetUint8()
+		-- TODO:	=

+		--closemobilestatusgump(mobilestatus_serial)
 	end
 =

 	-- AOSTooltip
@@ -327,17 +334,21 @@
 	end
 end
 =

--- Quest Arrow
--- TODO : show/hide quest arrow	- also look at 0xbf subpacket 0x07
-function gPacketHandler.kPacket_QuestArrow ()	-- 0xba
+-- Tracking Arrow
+function gPacketHandler.kPacket_TrackingArrow ()	-- 0xba
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
-	local Questarrow_Active =3D input:PopNetUint8()
-	local Questarrow_xloc =3D input:PopNetUint16()
-	local Questarrow_yloc =3D input:PopNetUint16()
-	--printf(&quot;NET: Questarrow is ON xLoc=3D0x%04x yLoc=3D0x%04x\n&quot;,Questarrow=
_xloc,Questarrow_yloc)
+	local arrow_active =3D input:PopNetUint8()
+	local arrow_xloc =3D input:PopNetUint16()
+	local arrow_yloc =3D input:PopNetUint16()
+
+	printdebug(&quot;net&quot;,sprintf(&quot;NET: Trackingarrow is ON xLoc=3D0x%04x yLoc=3D0=
x%04x\n&quot;,arrow_xloc,arrow_yloc))
+
 	-- Update Tracking Symbol
-	gCurrentRenderer:ShowQuestArrow( Questarrow_Active, Questarrow_xloc, Ques=
tarrow_yloc )
+	-- because of renaming, it doesn't work with 2d renderer (renamed from Sh=
owQuestArrow)
+	if (gCurrentRenderer=3D=3DRenderer3D) then
+		gCurrentRenderer:UpdateTrackingArrow( arrow_active, arrow_xloc, arrow_yl=
oc )
+	end
 end
 =

 --[[
@@ -633,7 +644,6 @@
 =

 	for k,v in pairs(newgump) do printdebug(&quot;gump&quot;,sprintf(&quot;newgump.%s =3D &quot;,=
k),v) end
 	=

---	local totaltext =3D &quot;&quot;
 	local textlen =3D 0
 	newgump.textline =3D {}
 	--Index 0 because Serverside Gump Commands use this Index as textline ref=
erences
@@ -643,7 +653,6 @@
 		newgump.textline[i] =3D input:PopUnicodeString(textlen) -- warning, data=
 is sent as unicode, we only interpret the asci part at the moment
 		-- TODO : maybe textlen / 2 ?
 		printdebug(&quot;gump&quot;,sprintf(&quot;newgump.textline[%d](len=3D%d)=3D\n&quot;,i,textle=
n),newgump.textline[i])
---		totaltext =3D totaltext .. &quot;\n&quot; .. newgump.textline[i]
 	end
 =

 	GumpParser(newgump)
@@ -700,7 +709,6 @@
 		-- print gumpdata
 		for k,v in pairs(newgump) do printdebug(&quot;gump&quot;,sprintf(&quot;newgump.%s =3D &quot;=
,k),v) end
 		=

---		local totaltext =3D &quot;&quot;
 		local textlen =3D 0
 		newgump.textline =3D {}
 		--Index 0 because Serverside Gump Commands use this Index as textline re=
ferences
@@ -710,7 +718,6 @@
 			newgump.textline[i] =3D decompressed:PopUnicodeString(textlen) -- warni=
ng, data is sent as unicode, we only interpret the asci part at the moment
 			-- TODO : maybe textlen / 2 ?
 			printdebug(&quot;gump&quot;,sprintf(&quot;newgump.textline[%d](len=3D%d)=3D\n&quot;,i,textl=
en),newgump.textline[i])
---			totaltext =3D totaltext .. &quot;\n&quot; .. newgump.textline[i]
 		end
 	end
 =

@@ -746,7 +753,7 @@
 function Send_Spell(spellid,expansionflag)
 	if (not(expansionflag)) then expansionflag=3D0 end
 	if (not(spellid)) then
-		--print(&quot;no spellid defined&quot;)
+		print(&quot;no spellid defined&quot;)
 		return
 	end
 --	printf(&quot;NET: Send_SpellSelected : spellid=3D%d\n&quot;,spellid)

Modified: trunk/vs8/iris.sln
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.sln (original)
+++ trunk/vs8/iris.sln Sat Feb 16 02:07:03 2008
@@ -3,6 +3,7 @@
 # Visual C++ Express 2005
 Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) =3D &quot;iris&quot;, &quot;iris.vcproj=
&quot;, &quot;{E2D2CF97-591B-450F-B5EA-21CB9B6A5DA5}&quot;
 	ProjectSection(ProjectDependencies) =3D postProject
+		{5A02700F-C389-4E19-AF35-C4C893E72A64} =3D {5A02700F-C389-4E19-AF35-C4C8=
93E72A64}
 		{FF3B6490-D65F-7B41-982B-8D8339958224} =3D {FF3B6490-D65F-7B41-982B-8D83=
39958224}
 	EndProjectSection
 EndProject

Modified: trunk/vs8/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.vcproj (original)
+++ trunk/vs8/iris.vcproj Sat Feb 16 02:07:03 2008
@@ -39,7 +39,7 @@
 				Name=3D&quot;VCCLCompilerTool&quot;
 				Optimization=3D&quot;0&quot;
 				AdditionalIncludeDirectories=3D&quot;&quot;$(INCLUDE)&quot;;&quot;C:\Progra=
mme\Microsoft Platform SDK\Include\&quot;;&quot;$(OGRE_HOME)\include\&quot;=
;&quot;$(OGRE_HOME)\include\OIS&quot;;..\include;..\include\lua;..\include\=
zlib;..\include\fmodx;..\lugre\include;&quot;..\lugre\lib\lua-5.0.3\include=
&quot;;..\lugre\lib\md5\include;..\lugre\lib\cadune_tree\include;..\lugre\l=
ib\caelum\include;E:\_Iris\_Iris_Ogre\lugre\lib\paged_geometry\include\;..\=
lugre\lib\paged_geometry\include&quot;
-				PreprocessorDefinitions=3D&quot;WIN32;_DEBUG;USE_FMOD;MAIN_WORKING_DIR=3D\&amp;=
quot;../\&quot;;USE_LUGRE_LIB_MD5;USE_LUGRE_LIB_CAELUM&quot;
+				PreprocessorDefinitions=3D&quot;WIN32;_DEBUG;USE_FMOD;MAIN_WORKING_DIR=3D\&amp;=
quot;../\&quot;;USE_LUGRE_LIB_MD5;USE_LUGRE_LIB_CAELUM;OGRE_DEBUG_MEMORY_MA=
NAGER&quot;
 				RuntimeLibrary=3D&quot;1&quot;
 				RuntimeTypeInfo=3D&quot;false&quot;
 				AssemblerOutput=3D&quot;2&quot;
@@ -98,6 +98,7 @@
 			IntermediateDirectory=3D&quot;$(ConfigurationName)&quot;
 			ConfigurationType=3D&quot;1&quot;
 			UseOfMFC=3D&quot;0&quot;
+			CharacterSet=3D&quot;2&quot;
 			WholeProgramOptimization=3D&quot;1&quot;
 			&gt;
 			&lt;Tool
@@ -119,21 +120,24 @@
 				Name=3D&quot;VCCLCompilerTool&quot;
 				UseUnicodeResponseFiles=3D&quot;false&quot;
 				Optimization=3D&quot;4&quot;
-				InlineFunctionExpansion=3D&quot;2&quot;
+				InlineFunctionExpansion=3D&quot;1&quot;
 				EnableIntrinsicFunctions=3D&quot;true&quot;
 				FavorSizeOrSpeed=3D&quot;1&quot;
 				OmitFramePointers=3D&quot;true&quot;
 				EnableFiberSafeOptimizations=3D&quot;false&quot;
 				WholeProgramOptimization=3D&quot;true&quot;
-				AdditionalIncludeDirectories=3D&quot;&quot;$(INCLUDE)&quot;;&quot;c:\Progra=
mme\Microsoft Platform SDK\Include\&quot;;&quot;$(OGRE_HOME)\include\&quot;=
;&quot;$(OGRE_HOME)\include\OIS\&quot;;..\include\;..\include\zlib;..\lugre=
\include;..\include\fmodx;&quot;..\lugre\lib\lua-5.0.3\include\&quot;;..\lu=
gre\lib\md5\include;..\lugre\lib\cadune_tree\include;..\lugre\lib\paged_geo=
metry\include;..\lugre\lib\caelum\include&quot;
-				PreprocessorDefinitions=3D&quot;WIN32;USE_FMOD;MAIN_WORKING_DIR=3D\&quot;..=
/\&quot;;USE_LUGRE_LIB_MD5;USE_LUGRE_LIB_CADUNE_TREE;USE_LUGRE_LIB_PAGED_GE=
OMETRY;USE_LUGRE_LIB_CAELUM&quot;
+				AdditionalIncludeDirectories=3D&quot;&quot;$(INCLUDE)&quot;;&quot;c:\Progra=
mme\Microsoft Platform SDK\Include\&quot;;&quot;$(OGRE_HOME)\include\&quot;=
;&quot;$(OGRE_HOME)\include\OIS\&quot;;..\include\;..\include\zlib;..\lugre=
\include;..\include\fmodx;&quot;..\lugre\lib\lua-5.0.3\include\&quot;;..\lu=
gre\lib\md5\include;..\lugre\lib\cadune_tree\include;..\lugre\lib\paged_geo=
metry\include;..\lugre\lib\caelum\include;c:\Programme\boost\boost_1_34_1\&quot;
+				PreprocessorDefinitions=3D&quot;WIN32;NDEBUG;_WINDOWS;MAIN_WORKING_DIR=3D\&amp;=
quot;../\&quot;;USE_FMOD;USE_LUGRE_LIB_MD5;USE_LUGRE_LIB_CADUNE_TREE;USE_LU=
GRE_LIB_CAELUM;USE_LUGRE_LIB_PAGED_GEOMETRY&quot;
 				GeneratePreprocessedFile=3D&quot;0&quot;
+				StringPooling=3D&quot;true&quot;
 				RuntimeLibrary=3D&quot;0&quot;
+				EnableFunctionLevelLinking=3D&quot;true&quot;
 				EnableEnhancedInstructionSet=3D&quot;1&quot;
 				FloatingPointModel=3D&quot;0&quot;
-				RuntimeTypeInfo=3D&quot;false&quot;
+				RuntimeTypeInfo=3D&quot;true&quot;
+				WarningLevel=3D&quot;1&quot;
 				Detect64BitPortabilityProblems=3D&quot;true&quot;
-				DebugInformationFormat=3D&quot;0&quot;
+				DebugInformationFormat=3D&quot;3&quot;
 			/&gt;
 			&lt;Tool
 				Name=3D&quot;VCManagedResourceCompilerTool&quot;
@@ -147,23 +151,30 @@
 			/&gt;
 			&lt;Tool
 				Name=3D&quot;VCLinkerTool&quot;
-				AdditionalDependencies=3D&quot;LIBCMT.lib LIBCPMT.LIB AdvAPI32.Lib User32.L=
ib zlib.lib ws2_32.lib lua50.lib OgreMain.lib OIS.lib fmodex_vc.lib pagedge=
ometry_lib.lib&quot;
+				AdditionalDependencies=3D&quot;AdvAPI32.Lib User32.Lib ws2_32.lib zlib.lib =
OgreMain.lib OIS.lib lua50.lib fmodex_vc.lib pagedgeometry_lib.lib&quot;
 				OutputFile=3D&quot;$(OutDir)\..\..\bin\iris2.exe&quot;
-				AdditionalLibraryDirectories=3D&quot;&quot;$(LIB)&quot;;&quot;$(OGRE_HOME)\=
lib\&quot;;..\libs\fmodx;..\libs\zlib;&quot;..\lugre\lib\lua-5.0.3\lib\stat=
ic&quot;;&quot;c:\Programme\Microsoft Platform SDK\Lib&quot;;..\lugre\lib\c=
aelum\lib\static;..\lugre\lib\paged_geometry\lib\static&quot;
+				AdditionalLibraryDirectories=3D&quot;&quot;$(LIB)&quot;;&quot;$(OGRE_HOME)\=
lib\&quot;;..\libs\fmodx;..\libs\zlib;&quot;..\lugre\lib\lua-5.0.3\lib\stat=
ic&quot;;&quot;c:\Programme\Microsoft Platform SDK\Lib&quot;;..\lugre\lib\c=
aelum\lib\static;..\lugre\lib\paged_geometry\lib\static;c:\Programme\boost\=
boost_1_34_1\lib&quot;
 				GenerateManifest=3D&quot;true&quot;
-				IgnoreAllDefaultLibraries=3D&quot;true&quot;
-				IgnoreDefaultLibraryNames=3D&quot;&quot;
+				IgnoreAllDefaultLibraries=3D&quot;false&quot;
+				IgnoreDefaultLibraryNames=3D&quot;LIBCMT.lib&quot;
 				ModuleDefinitionFile=3D&quot;&quot;
 				DelayLoadDLLs=3D&quot;&quot;
+				SubSystem=3D&quot;1&quot;
 				LargeAddressAware=3D&quot;0&quot;
 				TerminalServerAware=3D&quot;0&quot;
+				OptimizeReferences=3D&quot;2&quot;
+				EnableCOMDATFolding=3D&quot;2&quot;
+				OptimizeForWindows98=3D&quot;1&quot;
 				SetChecksum=3D&quot;true&quot;
+				TargetMachine=3D&quot;1&quot;
+				FixedBaseAddress=3D&quot;1&quot;
 			/&gt;
 			&lt;Tool
 				Name=3D&quot;VCALinkTool&quot;
 			/&gt;
 			&lt;Tool
 				Name=3D&quot;VCManifestTool&quot;
+				UseFAT32Workaround=3D&quot;true&quot;
 			/&gt;
 			&lt;Tool
 				Name=3D&quot;VCXDCMakeTool&quot;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000719.html">[Iris-commit] [IRIS] r1907 - in /trunk: data/models/materials/ data/models/models/to_011000/ data/models/textures/ lua/ lua/filter/
</A></li>
	<LI>Next message: <A HREF="000721.html">[Iris-commit] [IRIS] r1909 - in /rawdata/sd_pd: houseparts.blend tex_lantern.png tex_lantern.xcf tex_slidingdoor.xcf
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#720">[ date ]</a>
              <a href="thread.html#720">[ thread ]</a>
              <a href="subject.html#720">[ subject ]</a>
              <a href="author.html#720">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
