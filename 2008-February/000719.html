<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r1907 - in /trunk: data/models/materials/ data/models/models/to_011000/ data/models/textures/ lua/ lua/filter/
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2008-February/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1907%20-%20in%20/trunk%3A%20data/models/materials/%0A%20data/models/models/to_011000/%20data/models/textures/%20lua/%20lua/filter/&In-Reply-To=%3C20080215234700.86C501C181BD%40zwischenwelt.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000718.html">
   <LINK REL="Next"  HREF="000720.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r1907 - in /trunk: data/models/materials/ data/models/models/to_011000/ data/models/textures/ lua/ lua/filter/</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1907%20-%20in%20/trunk%3A%20data/models/materials/%0A%20data/models/models/to_011000/%20data/models/textures/%20lua/%20lua/filter/&In-Reply-To=%3C20080215234700.86C501C181BD%40zwischenwelt.org%3E"
       TITLE="[Iris-commit] [IRIS] r1907 - in /trunk: data/models/materials/ data/models/models/to_011000/ data/models/textures/ lua/ lua/filter/">no-reply at zwischenwelt.org
       </A><BR>
    <I>Sat Feb 16 00:46:59 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000718.html">[Iris-commit] [IRIS] r1906 - /trunk/lua/obj/obj.container.lua
</A></li>
        <LI>Next message: <A HREF="000720.html">[Iris-commit] [IRIS] r1908 - in /trunk: data/base/ lua/ lua/gui/	lua/net/ vs8/
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#719">[ date ]</a>
              <a href="thread.html#719">[ thread ]</a>
              <a href="subject.html#719">[ subject ]</a>
              <a href="author.html#719">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: hagish
Date: Sat Feb 16 00:46:56 2008
New Revision: 1907

Log:
improved debug tool: adjust position, added new japan slide door

Added:
    trunk/data/models/models/to_011000/mdl_010762.mesh   (with props)
    trunk/data/models/models/to_011000/mdl_010763.mesh   (with props)
    trunk/data/models/models/to_011000/mdl_010764.mesh   (with props)
    trunk/data/models/textures/tex_slidingdoor.png   (with props)
Modified:
    trunk/data/models/materials/textures.material
    trunk/lua/filter/filter.art.lua
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.devtool.lua

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Sat Feb 16 00:46:56 2008
@@ -8258,3 +8258,18 @@
 		}
 	} =

 }
+
+material tex_slidingdoor : tex_base
+{ =

+	technique =

+	{ =

+		pass =

+		{		=

+			texture_unit =

+			{ =

+				texture tex_slidingdoor.png =

+			}	=

+		}
+	} =

+}
+

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Sat Feb 16 00:46:56 2008
@@ -143,6 +143,13 @@
 gArtFilter[3353]=3D{maptoid=3D3351}
 gArtFilter[3349]=3D{maptoid=3D3350}
 =

+-- houseparts
+gArtFilter[10761]=3D{maptoid=3D10763}
+gArtFilter[10759]=3D{maptoid=3D10763,rotation=3D&quot;x:0,y:0,z:90&quot;,xadd=3D0,ya=
dd=3D1.85,zadd=3D0}
+gArtFilter[10757]=3D{maptoid=3D10763,rotation=3D&quot;x:0,y:0,z:90&quot;,xadd=3D0,ya=
dd=3D1.85,zadd=3D0}
+gArtFilter[10760]=3D{maptoid=3D10762,rotation=3D&quot;x:0,y:0,z:90&quot;,xadd=3D0,ya=
dd=3D1.85,zadd=3D0}
+gArtFilter[10758]=3D{maptoid=3D10764,rotation=3D&quot;x:0,y:0,z:90&quot;,xadd=3D0,ya=
dd=3D1.85,zadd=3D0}
+
 ----------------------------------------------------------------------
 =

 -- Seasonal Dynamic &amp; Static Art Translation (run tiles)	-- eventuell (iTi=
leTypeID + 16384)
@@ -221,4 +228,4 @@
 [&quot;d02&quot;]=3D-1,
 --Foliage multiple tiles
 [&quot;d45&quot;]=3D-1
-})
+})

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sat Feb 16 00:46:56 2008
@@ -41,8 +41,9 @@
 		for k,dynamic in pairs(GetDynamicList()) do
 			-- print(&quot;DEBUG&quot;,&quot;ADD DYNAMIC&quot;,dynamic.meshname)
 			if (dynamic.meshname and DynamicIsInWorld(dynamic)) then
-				x,y,z =3D Renderer3D:UOPosToLocal(dynamic.xloc,dynamic.yloc,dynamic.zl=
oc * 0.1) =

+				x,y,z =3D Renderer3D:UOPosToLocal(dynamic.xloc + dynamic.xadd,dynamic.=
yloc + dynamic.yadd,dynamic.zloc * 0.1 + dynamic.zadd) =

 				qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
+				-- print(&quot;FASTBATCH POS&quot;,x,y,z,&quot;ROT&quot;,qw,qx,qy,qz)
 =

 				local r,g,b,a =3D 1,1,1,1
 				if (gHueLoader and dynamic.hue &gt; 0) then
@@ -66,6 +67,7 @@
 	if (dynamic.gfx) then
 		dynamic.gfx:SetPosition(self:UOPosToLocal(dynamic.xloc + dynamic.xadd,dy=
namic.yloc + dynamic.yadd,dynamic.zloc * 0.1 + dynamic.zadd))
 	end
+	-- TODO update dynamic fastbatch?
 end
 =

 function Renderer3D:UpdateDynamicVisibility	(dynamic) =

@@ -73,6 +75,31 @@
 		-- normal item
 		dynamic.gfx:SetVisible(self:IsZLayerVisible(dynamic.zloc))
 		if (dynamic.gfx.billboard) then dynamic.gfx.billboard:SetVisible(self:Is=
ZLayerVisible(dynamic.zloc)) end
+	end
+end
+
+-- rebuilds the graphic of the dynamics
+function Renderer3D:RebuildDynamic ( dynamic )
+	-- update position adjustments
+	dynamic.xadd =3D FilterPositionX(dynamic.artid) or 0
+	dynamic.yadd =3D FilterPositionY(dynamic.artid) or 0
+	dynamic.zadd =3D FilterPositionZ(dynamic.artid) or 0
+
+	if gFastBatchDynamics then
+		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
+	elseif dynamic.gfx then
+		-- update rotation
+		if dynamic.gfx then dynamic.gfx:SetOrientation(GetStaticMeshOrientation(=
dynamic.artid)) end
+		-- update position
+		Renderer3D:UpdateDynamicItemPos(dynamic)
+	end
+end
+
+function Renderer3D:RebuildAllDynamicsWithArtid(artid)
+	for k,v in pairs(gDynamics) do
+		if v and v.artid and v.artid =3D=3D artid then
+			Renderer3D:RebuildDynamic(v)
+		end
 	end
 end
 =

@@ -165,7 +192,6 @@
 	else
 		-- normal 1 part object
 		local meshname =3D (not gForceFallBackBillboards_Dynamics) and GetMeshNa=
me(item.artid) -- ,item.hue)
-		item.meshname =3D meshname
 		item.meshname =3D meshname
 		-- print(&quot;DEBUG&quot;,&quot;meshname&quot;,item.meshname)
 		=


Modified: trunk/lua/lib.devtool.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.devtool.lua (original)
+++ trunk/lua/lib.devtool.lua Sat Feb 16 00:46:56 2008
@@ -187,6 +187,9 @@
 	print(&quot;filter.art.lua&quot;,&quot;gArtFilter[&quot;..dialog.tileid..&quot;]=3D{maptoid=3D&quot;..o=
therid..&quot;,rotation=3D\&quot;x:&quot;..dialog.xrot..&quot;,y:&quot;..dialog.yrot..&quot;,z:&quot;..dialog.=
zrot..&quot;\&quot;,xadd=3D&quot;..dialog.xadd..&quot;,yadd=3D&quot;..dialog.yadd..&quot;,zadd=3D&quot;..dialo=
g.zadd..&quot;}&quot;)
 	-- update geometry
 	Renderer3D:RebuildMap()
+	-- update dynamics
+	Renderer3D:RebuildAllDynamicsWithArtid(otherid)
+	Renderer3D:RebuildAllDynamicsWithArtid(dialog.tileid)
 end
 =

 function AdjustArtPositionControlDialog(tileid)
@@ -254,7 +257,7 @@
 	}
 	=

 	-- statics
-	local statics =3D ListStaticsNearPos(x,y,z,0)
+	local statics =3D ListStaticsNearPos(x,y,z,1)
 	for k,entity in pairs(statics) do =

 		local i =3D entity.iTileTypeID
 		local meshpath =3D GetModelPath(i)
@@ -267,11 +270,16 @@
 	end
 	=

 	-- dynamics
-	local dynamics =3D ListDynamicsNearPos(x,y,z,0)
+	local dynamics =3D ListDynamicsNearPos(x,y,z,1)
 	for k,item in pairs(dynamics) do =

+		print(&quot;DEBUG&quot;,k,item)
 		local i =3D item.artid
 		local meshpath =3D GetModelPath(i)
-		local texlist =3D meshpath and OgreMeshTextures(meshpath)
+		local name =3D GetStaticTileTypeName(i) or &quot;unknown&quot;
+		table.insert(rows,{ =

+			{type=3D&quot;Button&quot;,text=3D&quot;#&quot;..i..&quot;: &quot;..name,onMouseDown=3Dfunction(widge=
t) widget.dialog:Destroy() AdjustArtPositionControlDialog(i) end},
+		})
+
 		print(&quot;DEBUG&quot;,&quot;dynamic&quot;,i,meshpath)
 	end
 =



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000718.html">[Iris-commit] [IRIS] r1906 - /trunk/lua/obj/obj.container.lua
</A></li>
	<LI>Next message: <A HREF="000720.html">[Iris-commit] [IRIS] r1908 - in /trunk: data/base/ lua/ lua/gui/	lua/net/ vs8/
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#719">[ date ]</a>
              <a href="thread.html#719">[ thread ]</a>
              <a href="subject.html#719">[ subject ]</a>
              <a href="author.html#719">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
