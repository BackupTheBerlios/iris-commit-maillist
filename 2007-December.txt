From no-reply at zwischenwelt.org  Sat Dec  1 19:19:49 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 01 Dec 2007 18:19:49 -0000
Subject: [Iris-commit] [IRIS] r1570 - /trunk/data/lua/lib.buff.lua
Message-ID: <20071201181950.439181C182B8@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Dec  1 19:19:47 2007
New Revision: 1570

Log:
buff lib started

Added:
    trunk/data/lua/lib.buff.lua



From no-reply at zwischenwelt.org  Sat Dec  1 21:36:25 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 01 Dec 2007 20:36:25 -0000
Subject: [Iris-commit] [IRIS] r1571 - /trunk/data/lua/lib.compass.lua
Message-ID: <20071201203627.92ACD1C182C6@zwischenwelt.org>

Author: hagish
Date: Sat Dec  1 21:36:24 2007
New Revision: 1571

Log:
bugfix: segfault in compass

Modified:
    trunk/data/lua/lib.compass.lua

Modified: trunk/data/lua/lib.compass.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.compass.lua (original)
+++ trunk/data/lua/lib.compass.lua Sat Dec  1 21:36:24 2007
@@ -106,6 +106,9 @@
 		gIrisCompassDialog.radar:Destroy()
 		gIrisCompassDialog.radar =3D CreateRadar( gGroundBlockLoader, gStaticBlo=
ckLoader, gRadarColorLoader )
 	end
+	=

+	-- to set geometry correctly
+	UpdateCompass()
 end
 =

 -- factor > 1 increases sight radius



From no-reply at zwischenwelt.org  Sat Dec  1 21:40:36 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 01 Dec 2007 20:40:36 -0000
Subject: [Iris-commit] [IRIS] r1572 - in /trunk/data/lua: lib.buff.lua
 lib.static.lua net.other.lua net/net.buff.lua net/net.main.lua
Message-ID: <20071201204039.2A0BF1C182C6@zwischenwelt.org>

Author: sience
Date: Sat Dec  1 21:40:36 2007
New Revision: 1572

Log:
-small updates
-buff net.buff.lua added
-buff packet imlemented

Added:
    trunk/data/lua/net/net.buff.lua
Modified:
    trunk/data/lua/lib.buff.lua
    trunk/data/lua/lib.static.lua
    trunk/data/lua/net.other.lua
    trunk/data/lua/net/net.main.lua

Modified: trunk/data/lua/lib.buff.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.buff.lua (original)
+++ trunk/data/lua/lib.buff.lua Sat Dec  1 21:40:36 2007
@@ -1,2 +1,56 @@
--- http://update.uo.com/design_523.html
+--[[
+Buff/DeBuff System
+--------------------
+http://update.uo.com/design_523.html
 =

+Notes: =

+This is a submitted packet, information here is yet to be verified. Use at=
 own risk. =

+
+List of current Icon Names:
+//1001: Dismount =

+//1002: Disarm =

+//1005: Nightsight =

+//1006: Death Strike =

+//1007: Evil Omen =

+//1008: ? GumpID 0x7556 =

+//1009: ? GumpID 0x753A =

+//1010: Divine Fury =

+//1011: Enemy Of One =

+//1012: Stealth =

+//1013: Active Meditation =

+//1014: Blood Oath caster =

+//1015: Blood Oath curse =

+//1016: Corpse Skin =

+//1017: Mindrot =

+//1018: Pain Spike =

+//1019: Strangle =

+//1020: Gift of Renewal =

+//1021: Attune Weapon =

+//1022: Thunderstorm =

+//1023: Essence of Wind =

+//1024: Ethereal Voyage =

+//1025: Gift Of Life =

+//1026: Arcane Empowerment =

+//1027: Mortal Strike =

+//1028: Reactive Armor =

+//1029: Protection =

+//1030: Arch Protection =

+//1031: Magic Reflection =

+//1032: Incognito =

+//1033: Disguised =

+//1034: Animal Form =

+//1035: Polymorph =

+//1036: Invisibility =

+//1037: Paralyze =

+//1038: Poison =

+//1039: Bleed =

+//1040: Clumsy =

+//1041: Feeble Mind =

+//1042: Weaken =

+//1043: Curse =

+//1044: Mass Curse =

+//1045: Agility =

+//1046: Cunning =

+//1047: Strength =

+//1048: Bless
+]]--

Modified: trunk/data/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.static.lua (original)
+++ trunk/data/lua/lib.static.lua Sat Dec  1 21:40:36 2007
@@ -11,7 +11,7 @@
 gCustomModelCache =3D {}
 function GetModelPath(id) =

 	local cached =3D gCustomModelCache[id]
-	if (cached) then return cached end
+	if (cached ~=3D nil) then return cached end
 =

 	local base =3D id - math.mod(id,1000) + 1000
 	local relpath  =3D sprintf("models/to_%06d/mdl_%06d.mesh",base,id)
@@ -94,7 +94,7 @@
 			meshname =3D false	-- set mesh as not available
 		else =

 			printdebug("static","Static Meshloader:",iTranslatedTileTypeID,iHue,mes=
hname)
-			=

+
 			if (gManualArtMaterialLoader) then
 				-- create unavailable uo_art_ID materials
 				local path =3D GetModelPath(iTranslatedTileTypeID)
@@ -131,7 +131,8 @@
 	return w,x,y,z
 end
 =

---- preloads all available meshes for the statics
+-- preloads all available meshes for the statics
+-- Wrong !!! hueing must be taken from statics instead of tiledata
 function PreloadAllStaticMesh()
 	-- preload all models
 	if gTileTypeLoader then

Modified: trunk/data/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.other.lua (original)
+++ trunk/data/lua/net.other.lua Sat Dec  1 21:40:36 2007
@@ -55,7 +55,6 @@
 kPacket_Generic_SubCommand_KR_HouseGumpResponse_primary	=3D hex2num("0x74"=
)	--BF.2F.74 - KR Ban House Menu Gump Response
 --a.s.o. to BF.2F.80
 kPacket_Generic_SubCommand_TargetbyResource		=3D hex2num("0x30")	---BF.30 =
- KR Target By Resource Macro
-
 kPacket_Generic_SubCommand_QuestGumpRequest		=3D hex2num("0x32")	-- Client=
 -> Server : Done!
 --[[
 -race_gender-packet
@@ -68,78 +67,6 @@
 WORD 	HairHue =

 WORD 	BeardId =

 WORD 	BeardHue
-
-Buff/DeBuff System
---------------------
-http://update.uo.com/design_523.html
-
-BYTE[1] Cmd
-BYTE[2] Length
-BYTE[4] Serial of player
-BYTE[2] Icon Number to show
-BYTE[2] 0x1 =3D Show, 0x0 =3D Remove. On remove byte, packet ends here.
-BYTE[4] 0x00000000
-BYTE[2] Icon Number to show.
-BYTE[2] 0x1 =3D Show
-BYTE[4] 0x00000000
-BYTE[2] Time in seconds (simple countdown without automatic remove)
-BYTE[2] 0x0000
-BYTE[1] 0x00
-BYTE[4] Cliloc ID of title of icon.
-BYTE[4] Cliloc ID for the Description of the icon. If no arguments for cli=
loc, then add 10 more bytes 0x00000000000000000000 and end packet
-BYTE[4] 0x00000000
-BYTE[2] 0x01
-BYTE[2] 0x0000
-BYTE[len(str)*2] Flipped Unicode String (" "+str) (To seperate the entrys =
add " ")
-BYTE[2] 0x01
-BYTE[2] 0x0000
-
-//1001: Dismount =

-//1002: Disarm =

-//1005: Nightsight =

-//1006: Death Strike =

-//1007: Evil Omen =

-//1008: ? GumpID 0x7556 =

-//1009: ? GumpID 0x753A =

-//1010: Divine Fury =

-//1011: Enemy Of One =

-//1012: Stealth =

-//1013: Active Meditation =

-//1014: Blood Oath caster =

-//1015: Blood Oath curse =

-//1016: Corpse Skin =

-//1017: Mindrot =

-//1018: Pain Spike =

-//1019: Strangle =

-//1020: Gift of Renewal =

-//1021: Attune Weapon =

-//1022: Thunderstorm =

-//1023: Essence of Wind =

-//1024: Ethereal Voyage =

-//1025: Gift Of Life =

-//1026: Arcane Empowerment =

-//1027: Mortal Strike =

-//1028: Reactive Armor =

-//1029: Protection =

-//1030: Arch Protection =

-//1031: Magic Reflection =

-//1032: Incognito =

-//1033: Disguised =

-//1034: Animal Form =

-//1035: Polymorph =

-//1036: Invisibility =

-//1037: Paralyze =

-//1038: Poison =

-//1039: Bleed =

-//1040: Clumsy =

-//1041: Feeble Mind =

-//1042: Weaken =

-//1043: Curse =

-//1044: Mass Curse =

-//1045: Agility =

-//1046: Cunning =

-//1047: Strength =

-//1048: Bless
 ]]--
 =

 gActWarmode =3D 0

Modified: trunk/data/lua/net/net.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.main.lua (original)
+++ trunk/data/lua/net/net.main.lua Sat Dec  1 21:40:36 2007
@@ -9,6 +9,7 @@
 dofile(libpath .. "net/net.sound.lua")
 dofile(libpath .. "net/net.login.lua")
 dofile(libpath .. "net/net.skill.lua")
+dofile(libpath .. "net/net.buff.lua")
 =

 -- only things that have at least 2 packets get its own file, everything e=
lse is handled here:
 dofile(libpath .. "net/net.packethandlers.lua")



From no-reply at zwischenwelt.org  Sat Dec  1 22:47:11 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 01 Dec 2007 21:47:11 -0000
Subject: [Iris-commit] [IRIS] r1573 - in /trunk: data/lua/lib.gui.iris.lua
 data/lua/net.other.lua premake.lua
Message-ID: <20071201214712.3E74C1C182C6@zwischenwelt.org>

Author: hagish
Date: Sat Dec  1 22:47:11 2007
New Revision: 1573

Log:
some minor fixes

Modified:
    trunk/data/lua/lib.gui.iris.lua
    trunk/data/lua/net.other.lua
    trunk/premake.lua

Modified: trunk/data/lua/lib.gui.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.gui.iris.lua (original)
+++ trunk/data/lua/lib.gui.iris.lua Sat Dec  1 22:47:11 2007
@@ -35,7 +35,8 @@
 	if (gHideMemoryUsage) then return end
 	if (gMyTicks > gMemStats_NextUpdate) then
 		gMemStats_NextUpdate =3D gMyTicks + 1000
-		local text =3D sprintf("%0.2fmb",memoryusage / 1024 / 1024)
+		local mem_dyn, mem_tresh =3D gcinfo()
+		local text =3D sprintf("%0.2fmb OGRE %0.2fmb / %0.2fmb LUA",memoryusage =
/ 1024 / 1024, mem_dyn / 1024, mem_tresh / 1024)
 		if (not gMemoryUsageField) then
 			local vw,vh =3D GetViewportSize()
 			local w,h =3D 0,12

Modified: trunk/data/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.other.lua (original)
+++ trunk/data/lua/net.other.lua Sat Dec  1 22:47:11 2007
@@ -415,41 +415,48 @@
 	local text_base =3D gClilocLoader and gClilocLoader:Get(text_messagenum) =
or ("unknown_cliloc_"..text_messagenum)	--cliloc build
 	local plaintext =3D text_base
 	if (string.find(text_base,"~")) then
+		print("DEBUG",aToken,bToken,text_base)
 -- TODO is it possile, that ~2 comes first and ~1 follows?
 		-- split at the ~1_*~
 		local aToken=3Dstrsplit("~[1-9]_[^~]+~",text_base)
 		-- and at \t
 		local bToken=3Dstrsplit("\t",text_params)
-		-- glue the two arrays together (like a zip)
-		local s =3D ""
-		-- for k,v in pairs(aToken) do print("A["..k.."]: "..v) end
-		-- for k,v in pairs(bToken) do print("B["..k.."]: "..v) end
-		local last =3D 0
-		for k,v in pairs(bToken) do =

-			s =3D s .. aToken[k] .. bToken[k] =

-			last =3D k
-		end
-		s =3D s .. aToken[last+1]
 		=

-		-- if there are #NUMBER parts in the string, it seems that you have to l=
ook the up in the cliloc stuff
-		-- string.find (s, pattern [, init [, plain]])
-		-- string.gsub (s, pat, repl [, n])
-		-- string.sub (s, i [, j])
-		local finished
-		repeat
-			finished =3D 1
-			local first, last =3D string.find(s, "#[0-9]+")
-			if first then
-				-- found some, so im not finished here
-				finished =3D 0
-				-- read out the number without #
-				local number =3D string.sub(s,first + 1,last)
-				local repl =3D gClilocLoader:Get(number) or ("unknown_cliloc_"..number)
-				-- and replace all patterns #number with the cliloc text
-				s =3D string.gsub (s, "#"..number, repl)
+		if aToken and bToken then
+			-- glue the two arrays together (like a zip)
+			local s =3D ""
+			-- for k,v in pairs(aToken) do print("A["..k.."]: "..v) end
+			-- for k,v in pairs(bToken) do print("B["..k.."]: "..v) end
+			local last =3D 0
+			for k,v in pairs(bToken) do =

+				s =3D s .. aToken[k] .. bToken[k] =

+				last =3D k
 			end
-		until finished =3D=3D 1
-		plaintext =3D s
+			s =3D s .. aToken[last+1]
+			=

+			-- if there are #NUMBER parts in the string, it seems that you have to =
look the up in the cliloc stuff
+			-- string.find (s, pattern [, init [, plain]])
+			-- string.gsub (s, pat, repl [, n])
+			-- string.sub (s, i [, j])
+			local finished
+			repeat
+				finished =3D 1
+				local first, last =3D string.find(s, "#[0-9]+")
+				if first then
+					-- found some, so im not finished here
+					finished =3D 0
+					-- read out the number without #
+					local number =3D string.sub(s,first + 1,last)
+					local repl =3D gClilocLoader:Get(number) or ("unknown_cliloc_"..numbe=
r)
+					-- and replace all patterns #number with the cliloc text
+					s =3D string.gsub (s, "#"..number, repl)
+				end
+			until finished =3D=3D 1
+			plaintext =3D s
+		else
+			local text_message =3D sprintf("%s [%s]",text_base,text_params)
+			plaintext =3D string.gsub(text_message,"<br>","\n")
+		end
 	else
 		local text_message =3D sprintf("%s [%s]",text_base,text_params)
 		plaintext =3D string.gsub(text_message,"<br>","\n")

Modified: trunk/premake.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/premake.lua (original)
+++ trunk/premake.lua Sat Dec  1 22:47:11 2007
@@ -1,13 +1,17 @@
+-- this is a premake sample script to compile lugre/linux programs. =

+-- you need to put this file next to the lugre directory.
+
 project.name =3D "Iris2"
 -- project.path =3D "build"
 -- project.bindir =3D "."
 =

 gLugreLuaSrcDir =3D "./lugre/lib/lua-5.0.3/"
 =

--- compile lua
---local makeresult =3D os.execute("make --directory=3D"..gLugreLuaSrcDir)
---if (makeresult ~=3D 0) then print("compiling lua failed with exit code",=
makeresult) os.exit(makeresult) end
---print("successfully compiled lua")
+-- list of easy libs inclusion (located in lugre/lib/NAME). this will add =
lugre/lib/NAME/src and lugre/lib/NAME/include.
+gLugreLibList =3D {
+	"cadune_tree",
+	"md5"
+}
 =

 function addpkgconfiglib (package, libname)
     if options.target =3D=3D "gnu" and os.execute("pkg-config --exists "..=
libname) =3D=3D 0 then
@@ -75,12 +79,14 @@
 package.buildflags =3D { "extra-warnings", "optimize" }
 package.buildoptions =3D {}
 =

-package.includepaths =3D { "lugre/include", gLugreLuaSrcDir.."/include/", =
"include", "lugre/lib/cadune_tree/include/" }
+package.includepaths =3D { "lugre/include", gLugreLuaSrcDir.."/include/", =
"include" }
+-- add lib includes
+for k,v in pairs(gLugreLibList) do =

+	table.insert(package.includepaths, "lugre/lib/"..v.."/include/") =

+end
 =

---package.libpaths =3D { gLugreLuaSrcDir.."/lib/" }
 package.linkoptions =3D {}
 package.links =3D { "lugrelua","lugrelualib" }
---package.links =3D { "lua","lualib" }
 =

 package.defines =3D { =

 	"USE_OPENAL",
@@ -91,10 +97,13 @@
 	"ENABLE_THREADS",
 }
 =

+-- add lib defines like USE_LUGRE_LIB_NAME
+for k,v in pairs(gLugreLibList) do =

+	table.insert(package.defines, "USE_LUGRE_LIB_"..string.upper(v))
+end
+
 addpkgconfiglib(package, "OGRE")
 addpkgconfiglib(package, "OIS")
---~ addpkgconfiglib(package, "lua50")
---~ addpkgconfiglib(package, "lualib50")
 addpkgconfiglib(package, "openal")
 addpkgconfiglib(package, "vorbisfile")
 =

@@ -105,9 +114,17 @@
 =

 package.files =3D {
   matchrecursive("lugre/include/*.h", "lugre/src/*.cpp"),
-  matchrecursive("lugre/lib/cadune_tree/include/*.h", "lugre/lib/cadune_tr=
ee/src/*.cpp"),
   matchrecursive("include/*.h", "src/*.cpp"),
 }
+
+-- add lib src
+for k,v in pairs(gLugreLibList) do =

+	table.insert(package.files, matchrecursive("lugre/lib/"..v.."/include/*.h=
")) =

+	table.insert(package.files, matchrecursive("lugre/lib/"..v.."/src/*.cpp")=
) =

+	table.insert(package.files, matchrecursive("lugre/lib/"..v.."/src/*.c")) =

+end
+
+
 package.excludes =3D {
 --  "dont_build_this.c"
 }



From no-reply at zwischenwelt.org  Sat Dec  1 23:32:51 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 01 Dec 2007 22:32:51 -0000
Subject: [Iris-commit] [IRIS] r1574 - /trunk/data/lua/net/net.buff.lua
Message-ID: <20071201223252.1EE961C182C6@zwischenwelt.org>

Author: sience
Date: Sat Dec  1 23:32:51 2007
New Revision: 1574

Log:
-fix for buffpacket

Modified:
    trunk/data/lua/net/net.buff.lua

Modified: trunk/data/lua/net/net.buff.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.buff.lua (original)
+++ trunk/data/lua/net/net.buff.lua Sat Dec  1 23:32:51 2007
@@ -52,6 +52,17 @@
 =

 0000
 <- Mindrot
+
+Packet [df], Length: 15, Type: Server
+df 000f
+
+00026dbe
+
+03f4
+
+0000
+
+00000000 =

 ]]--
 =

 function gPacketHandler.kPacket_BuffDebuff_System()
@@ -65,36 +76,39 @@
 	buffinfos.icon_show1		=3D input:PopNetUint16()
 	buffinfos.temp1			=3D input:PopNetUint32()
 =

-	buffinfos.icon_artid2		=3D input:PopNetUint16()			-- ??
-	buffinfos.icon_show2		=3D input:PopNetUint16()
-	buffinfos.temp2			=3D input:PopNetUint32()
-
-	buffinfos.buff_duration	=3D input:PopNetUint16()
-
-	buffinfos.temp3			=3D input:PopNetUint16()
-	buffinfos.temp4			=3D input:PopNetUint8()
-
-	buffinfos.clilocid1		=3D input:PopNetUint32()
-	buffinfos.clilocid2		=3D input:PopNetUint32()
-
-	buffinfos.temp5			=3D input:PopNetUint32()
-
-	buffinfos.argumentsmode_start	=3D input:PopNetUint16()
-
-	buffinfos.argumentsmode_startif	=3D input:PopNetUint16()
-
-	if (buffinfos.argumentsmode_start =3D=3D 1) then
-
-		local argument_string =3D ""
-		repeat
-			local argument_char	=3D input:PopNetUint8()
-			argument_string =3D argument_string..argument_char
-			print(argument_char)
-		until (argument_char =3D=3D 1)
-		=

-		print(argument_string)
+	if (packetsize > 15) then
+		buffinfos.icon_artid2		=3D input:PopNetUint16()			-- ??
+		buffinfos.icon_show2		=3D input:PopNetUint16()
+		buffinfos.temp2			=3D input:PopNetUint32()
+	=

+		buffinfos.buff_duration	=3D input:PopNetUint16()
+	=

+		buffinfos.temp3			=3D input:PopNetUint16()
+		buffinfos.temp4			=3D input:PopNetUint8()
+	=

+		buffinfos.clilocid1		=3D input:PopNetUint32()
+		buffinfos.clilocid2		=3D input:PopNetUint32()
+	=

+		buffinfos.temp5			=3D input:PopNetUint32()
+	=

+		buffinfos.argumentsmode_start	=3D input:PopNetUint16()
+	=

+		buffinfos.argumentsmode_startif	=3D input:PopNetUint16()
+	=

+		if (buffinfos.argumentsmode_start =3D=3D 1) then
+	=

+			local argument_string =3D ""
+			repeat
+				local argument_char	=3D input:PopNetUint8()
+				argument_string =3D argument_string..argument_char
+				print(argument_char)
+			until (argument_char =3D=3D 1)
+			=

+			print(argument_string)
+		end
+	=

+		buffinfos.argumentsmode_end		=3D input:PopNetUint16()
 	end
-	buffinfos.argumentsmode_end		=3D input:PopNetUint16()
 	=

 	print("spell buff packet received !!!!!!!!!!")
 end



From no-reply at zwischenwelt.org  Sun Dec  2 00:46:28 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 01 Dec 2007 23:46:28 -0000
Subject: [Iris-commit] [IRIS] r1575 - /trunk/data/lua/lib.3d.mobile.lua
Message-ID: <20071201234628.BCCB31C182C6@zwischenwelt.org>

Author: hagish
Date: Sun Dec  2 00:46:27 2007
New Revision: 1575

Log:
bugfix: chat text over the head

Modified:
    trunk/data/lua/lib.3d.mobile.lua

Modified: trunk/data/lua/lib.3d.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.mobile.lua (original)
+++ trunk/data/lua/lib.3d.mobile.lua Sun Dec  2 00:46:27 2007
@@ -279,6 +279,11 @@
 			mobile.chattext_parent.gfx:SetTrackPosSceneNode(mobile.headpos)
 			mobile.chattext_parent.gfx.mbTrackHideIfClamped =3D true
 			mobile.chattext_parent.gfx.mbTrackHideIfBehindCam =3D true
+			=

+			local vw,vh =3D GetViewportSize()
+			mobile.chattext_parent.gfx.mvTrackClampMin =3D {0,0}
+			mobile.chattext_parent.gfx.mvTrackClampMax =3D {vw,vh}
+			=

 			-- and text child for relative position
 			mobile.chattext =3D guimaker.MakeText(mobile.chattext_parent,0,-20,"",g=
HudNamesFontSize,col_text)
 			mobile.chattext.gfx:SetTextAlignment(kGfx2DAlign_Center)



From no-reply at zwischenwelt.org  Sun Dec  2 01:39:01 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 00:39:01 -0000
Subject: [Iris-commit] [IRIS] r1576 - /trunk/premake.lua
Message-ID: <20071202010007.EE02C1C186DD@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec  2 01:39:00 2007
New Revision: 1576

Log:
premake : disabled extra-warnings by default and added option --wall to pre=
make script so they can be enabled if wanted

Modified:
    trunk/premake.lua

Modified: trunk/premake.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/premake.lua (original)
+++ trunk/premake.lua Sun Dec  2 01:39:00 2007
@@ -4,6 +4,11 @@
 project.name =3D "Iris2"
 -- project.path =3D "build"
 -- project.bindir =3D "."
+
+gbExtraWarnings =3D false
+
+addoption("wall","very verbose report, most warnings enabled")
+if (options["wall"]) then gbExtraWarnings =3D true print("extra warnings e=
nabled") end
 =

 gLugreLuaSrcDir =3D "./lugre/lib/lua-5.0.3/"
 =

@@ -47,7 +52,7 @@
 package.name =3D "lugrelua"
 package.kind =3D "lib"
 package.language =3D "c++"
-package.buildflags =3D { "extra-warnings", "optimize" }
+package.buildflags =3D { gbExtraWarnings and "extra-warnings" or nil, "opt=
imize" }
 package.buildoptions =3D {}
 package.includepaths =3D { gLugreLuaSrcDir.."/include" }
 package.files =3D {
@@ -61,7 +66,7 @@
 package.name =3D "lugrelualib"
 package.kind =3D "lib"
 package.language =3D "c++"
-package.buildflags =3D { "extra-warnings", "optimize" }
+package.buildflags =3D { gbExtraWarnings and "extra-warnings" or nil, "opt=
imize" }
 package.buildoptions =3D {}
 package.includepaths =3D { gLugreLuaSrcDir.."/include" }
 package.files =3D {
@@ -76,7 +81,7 @@
 package.kind =3D "exe"
 package.language =3D "c++"
 package.bindir =3D "bin"
-package.buildflags =3D { "extra-warnings", "optimize" }
+package.buildflags =3D { gbExtraWarnings and "extra-warnings" or nil, "opt=
imize" }
 package.buildoptions =3D {}
 =

 package.includepaths =3D { "lugre/include", gLugreLuaSrcDir.."/include/", =
"include" }



From no-reply at zwischenwelt.org  Sun Dec  2 01:41:05 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 00:41:05 -0000
Subject: [Iris-commit] [IRIS] r1578 - /trunk/data/lua/net/net.buff.lua
Message-ID: <20071202010007.F18CB1C186E2@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec  2 01:41:05 2007
New Revision: 1578

Log:
added vardump to buff code

Modified:
    trunk/data/lua/net/net.buff.lua

Modified: trunk/data/lua/net/net.buff.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.buff.lua (original)
+++ trunk/data/lua/net/net.buff.lua Sun Dec  2 01:41:05 2007
@@ -65,6 +65,7 @@
 00000000 =

 ]]--
 =

+
 function gPacketHandler.kPacket_BuffDebuff_System()
 	local buffinfos =3D {}
 	local input =3D GetRecvFIFO()
@@ -110,5 +111,6 @@
 		buffinfos.argumentsmode_end		=3D input:PopNetUint16()
 	end
 	=

-	print("spell buff packet received !!!!!!!!!!")
+	print("spell buff packet received !!!!!!!!!!",packetsize)
+	print(vardump2(buffinfos))
 end



From no-reply at zwischenwelt.org  Sun Dec  2 01:52:20 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 00:52:20 -0000
Subject: [Iris-commit] [IRIS] r1579 - in /trunk/data/lua: net.other.lua
 net/net.buff.lua net/net.main.lua net/net.packethandlers.lua
Message-ID: <20071202010007.F2EEE1C186E4@zwischenwelt.org>

Author: sience
Date: Sun Dec  2 01:52:19 2007
New Revision: 1579

Log:
-updated to packethandlers

Removed:
    trunk/data/lua/net/net.buff.lua
Modified:
    trunk/data/lua/net.other.lua
    trunk/data/lua/net/net.main.lua
    trunk/data/lua/net/net.packethandlers.lua

Modified: trunk/data/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.other.lua (original)
+++ trunk/data/lua/net.other.lua Sun Dec  2 01:52:19 2007
@@ -9,8 +9,10 @@
 kPacket_Generic_SubCommand_PartySystem			=3D hex2num("0x06")
 kPacket_Generic_SubCommand_QuestArrow			=3D hex2num("0x07")
 kPacket_Generic_SubCommand_MapChange			=3D hex2num("0x08")
+
+kPacket_Generic_SubCommand_AOSTooltip			=3D hex2num("0x10")
 --(0x0A) Sent by using the client Wrestle Stun Macro key in Options.
---This is no longer used since AoS was introduced. The Macro selection tha=
t used it was removed. =

+--This is no longer used since AoS was introduced. The Macro selection tha=
t used it was removed.
 kPacket_Generic_SubCommand_Wrestling_Stun		=3D hex2num("0x0A")
 kPacket_Generic_SubCommand_ClientLanguage		=3D hex2num("0x0B")	-- Client s=
ends Client-language to Server
 kPacket_Generic_SubCommand_3DClientAction		=3D hex2num("0x0E")	-- Client S=
ent. Server responds with Play Animation packets.
@@ -107,7 +109,6 @@
 	return text
 end
 =

-
 -- TODO : implement all subpackets
 function gPacketHandler.kPacket_Generic_Command()
 	local input =3D GetRecvFIFO()
@@ -161,7 +162,16 @@
 		MapChangeRequest(mapid)
 		-- PROBABLY WRONG NOW we index internally with 1, OSi with 0
 	end
-	=

+
+	-- AOSTooltip
+	if (subcmd =3D=3D kPacket_Generic_SubCommand_AOSTooltip) then -- 0x10
+		local objserial =3D input:PopNetUint32()
+		local listID =3D input:PopNetUint32()
+		printdebug("net", sprintf("0xbf sub: kPacket_Generic_SubCommand_AOSToolt=
ip objserial=3D0x%08x listID=3D0x%08x\n",
+									objserial,listID) )
+		Send_AosToolTipRequest(objserial)
+	end
+
 	-- display popup
 	-- TODO : check if PopUp is already opened - use a popuplist with serials=
 !?
 	if (subcmd =3D=3D kPacket_Generic_SubCommand_DisplayPopup) then -- 0x14
@@ -613,42 +623,7 @@
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_Attack)
 	out:PushNetUint32(mobile_serial)
-	printf("NET: Attack -> serial=3D0x%08x\n",mobile_serial)
-end
-
--- Newer packet as of late 2004.
--- Is now used on OSI to handle the Revision of Tooltips instead of the or=
iginal 0xBF methods it appears.
-function gPacketHandler.kPacket_AOSObjProp()	--0xDC (9 bytes)
-	local input =3D GetRecvFIFO()
-	local id =3D input:PopNetUint8()
-	local mobile_serial =3D input:PopNetUint32()			--Item/Mob-Serial
-	local mobile_revision_hash =3D input:PopNetUint32()
-	--printf("NET: AOSObjProp mobile_serial=3D0x%08x mobile_revision_hash=3D0=
x%08x\n",mobile_serial,mobile_revision_hash)
-end
-
--- Mega Cliloc - server sends new Clilocs - just add them to the Cliloc
--- TODO : this cliloc additions might be local to a specific mobile, e.g. =
vendor or container...
-function gPacketHandler.kPacket_Mega_Cliloc()	--0xD6
-	local input =3D GetRecvFIFO()
-	local id =3D input:PopNetUint8()
-	local size =3D input:PopNetUint16()
-	local temp1 =3D input:PopNetUint16()			--0x0001 or 0x4000 !?
-	local item_serial =3D input:PopNetUint32()	--Serial of item/creature
-	local temp2 =3D input:PopNetUint16()			--0x0000 !?
-	local mobile_serial =3D input:PopNetUint32()	--Serial of item/creature in=
 all tests.
-												--This could be the serial of the item the entry to appear ove=
r!?
-	while true do =

-		local cliloc_id =3D input:PopNetUint32()
-		if (cliloc_id =3D=3D hex2num("0x00000000")) then break end
-		=

-		local cliloc_size =3D input:PopNetUint16()
-		local textline =3D ""
-		if (cliloc_size > 0) then
-			textline =3D input:PopUnicodeString(cliloc_size/2)
-			gClilocLoader:Set(cliloc_id,textline) -- register in cliloc
-		end
-		printf("NET: Mega_Cliloc : id=3D%d 0x%08x len=3D%d text=3D%s\n",cliloc_i=
d,cliloc_id,cliloc_size,textline)
-	end
+	printdebug("net", sprintf("NET: Attack -> serial=3D0x%08x\n",mobile_seria=
l) )
 end
 =

 -- Generic Gump

Modified: trunk/data/lua/net/net.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.main.lua (original)
+++ trunk/data/lua/net/net.main.lua Sun Dec  2 01:52:19 2007
@@ -9,7 +9,6 @@
 dofile(libpath .. "net/net.sound.lua")
 dofile(libpath .. "net/net.login.lua")
 dofile(libpath .. "net/net.skill.lua")
-dofile(libpath .. "net/net.buff.lua")
 =

 -- only things that have at least 2 packets get its own file, everything e=
lse is handled here:
 dofile(libpath .. "net/net.packethandlers.lua")

Modified: trunk/data/lua/net/net.packethandlers.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.packethandlers.lua (original)
+++ trunk/data/lua/net/net.packethandlers.lua Sun Dec  2 01:52:19 2007
@@ -31,3 +31,337 @@
 	local unknown2 =3D input:PopNetUint16()
 	NotifyWarmode(flag)
 end
+
+--[[
+Buff/DeBuff System
+--------------------
+http://update.uo.com/design_523.html
+
+Packet Build:
+BYTE[1] Cmd					-- 0xDF
+BYTE[2] Length =

+BYTE[4] Serial of player =

+
+BYTE[2] Icon Number to show =

+BYTE[2] 0x1 =3D Show, 0x0 =3D Remove. On remove byte, packet ends here. =

+BYTE[4] 0x00000000
+
+BYTE[2] Icon Number to show. =

+BYTE[2] 0x1 =3D Show =

+BYTE[4] 0x00000000
+
+BYTE[2] Buff Duration in seconds - Time in seconds (simple countdown witho=
ut automatic remove) =

+BYTE[2] 0x0000 =

+BYTE[1] 0x00 =

+BYTE[4] Buff Title Cliloc - Cliloc ID of title of icon. =

+BYTE[4] Buff Secondary Cliloc - Cliloc ID for the Description of the icon.=
 If no arguments for cliloc, then add 10 more bytes 0x00000000000000000000 =
and end packet =

+BYTE[4] 0x00000000 =

+BYTE[2] 0x00 01			-Arguments Mode
+
+BYTE[2] 0x00 00			-If (Arguments Mode =3D 0x01)
+BYTE[len(str)*2] Flipped Unicode String (" "+str) (To seperate the entrys =
add " ") =

+BYTE[2] 0x00 01			-EndIf Arguments Mode
+
+BYTE[2] 0x00 00			-EndIf Type
+]]--
+
+-- buff / debuff  (0xDF)
+function gPacketHandler.kPacket_BuffDebuff_System()
+	local buffinfos =3D {}
+	local input =3D GetRecvFIFO()
+	local id =3D input:PopNetUint8()
+	local packetsize =3D input:PopNetUint16()
+
+	buffinfos.player_serial	=3D input:PopNetUint32()
+	buffinfos.icon_artid1		=3D input:PopNetUint16()
+	buffinfos.icon_show1		=3D input:PopNetUint16()
+	buffinfos.temp1			=3D input:PopNetUint32()
+
+	if (packetsize > 15) then
+		buffinfos.icon_artid2		=3D input:PopNetUint16()			-- ??
+		buffinfos.icon_show2		=3D input:PopNetUint16()
+		buffinfos.temp2			=3D input:PopNetUint32()
+	=

+		buffinfos.buff_duration	=3D input:PopNetUint16()
+	=

+		buffinfos.temp3			=3D input:PopNetUint16()
+		buffinfos.temp4			=3D input:PopNetUint8()
+	=

+		buffinfos.clilocid1		=3D input:PopNetUint32()
+		buffinfos.clilocid2		=3D input:PopNetUint32()
+	=

+		buffinfos.temp5			=3D input:PopNetUint32()
+	=

+		buffinfos.argumentsmode_start	=3D input:PopNetUint16()
+	=

+		buffinfos.argumentsmode_startif	=3D input:PopNetUint16()
+	=

+		if (buffinfos.argumentsmode_start =3D=3D 1) then
+	=

+			local argument_string =3D ""
+			repeat
+				local argument_char	=3D input:PopNetUint8()
+				argument_string =3D argument_string..argument_char
+				print(argument_char)
+			until (argument_char =3D=3D 1)
+			=

+			print(argument_string)
+		end
+	=

+		buffinfos.argumentsmode_end		=3D input:PopNetUint16()
+	end
+	=

+	print("spell buff packet received !!!!!!!!!!")
+end
+
+-- if clilochash is wrong, request new megacliloc tooltip from server
+-- used in function gPacketHandler.kPacket_AOSObjProp()  &  gPacketHandler=
.kPacket_Generic_Command()
+function Send_AosToolTipRequest(objserial)
+	local out =3D GetSendFIFO()
+	out:PushNetUint8(kPacket_Generic_Command)
+	out:PushNetUint16(hex2num("0x0009"))
+	out:PushNetUint16(hex2num("0x0010"))
+	out:PushNetUint32(objserial)
+	out:SendPacket()
+end
+
+-- Newer packet as of late 2004.
+-- Is now used on OSI to handle the Revision of Tooltips instead of the or=
iginal 0xBF methods it appears.
+function gPacketHandler.kPacket_AOSObjProp()	--0xDC (9 bytes)
+	local input =3D GetRecvFIFO()
+	local id =3D input:PopNetUint8()
+	local objserial =3D input:PopNetUint32()			--Item/Mob-Serial
+	local objrevision_hash =3D input:PopNetUint32()
+	printdebug("net", sprintf("NET: AOSObjProp objserial=3D0x%08x objrevision=
_hash=3D0x%08x\n",
+								objserial,objrevision_hash) )
+	Send_AosToolTipRequest(objserial)
+end
+
+-- Mega Cliloc - server sends new Clilocs - just add them to the Cliloc
+-- TODO : this cliloc additions might be local to a specific mobile, e.g. =
vendor or container...
+function gPacketHandler.kPacket_Mega_Cliloc()	--0xD6
+	local input =3D GetRecvFIFO()
+	local id =3D input:PopNetUint8()
+	local size =3D input:PopNetUint16()
+	local temp1 =3D input:PopNetUint16()			--0x0001 or 0x4000 !?
+	local item_serial =3D input:PopNetUint32()	--Serial of item/creature
+	local temp2 =3D input:PopNetUint16()			--0x0000 !?
+	local serial =3D input:PopNetUint32()	--Serial of item/creature in all te=
sts.
+												--This could be the serial of the item the entry to appear ove=
r!?
+	while true do =

+		local cliloc_id =3D input:PopNetUint32()
+		if (cliloc_id =3D=3D hex2num("0x00000000")) then break end
+		=

+		local cliloc_size =3D input:PopNetUint16()
+		local textline =3D ""
+		if (cliloc_size > 0) then
+			textline =3D input:PopUnicodeString(cliloc_size/2)			 =

+			gClilocLoader:Set(cliloc_id,textline) -- register in cliloc
+		end
+		printf("NET: Mega_Cliloc : id=3D%d 0x%08x len=3D%d text=3D%s\n",cliloc_i=
d,cliloc_id,cliloc_size,textline)
+	end
+end
+
+--[[
+void cClient::Act_AOSTooltip (cPacket * packet)
+{
+
+  if (!Config::GetAOSToolTips())
+    return;
+  if ( !Config::GetClilocs() )
+    return;
+  packet->SetPosition (5);
+  Uint32 id =3D packet->GetDword ();
+  Uint16 unkn =3D packet->GetWord ();
+  Uint32 listID =3D packet->GetDword ();
+  cCharacter *character =3D NULL;
+  cDynamicObject *obj =3D NULL;
+
+  character =3D pCharacterList.Get (id);
+  obj =3D pDynamicObjectList.Get (id);
+
+  if (character)
+      {
+        character->ClearAOSTooltip ();
+        character->SetAOSTooltipID (listID);
+      }
+  if (obj)
+      {
+        obj->ClearAOSTooltip ();
+        obj->SetAOSTooltipID (listID);
+      }
+
+  Uint32 clilocID;
+  do
+      {
+        clilocID =3D packet->GetDword ();
+        if (!clilocID)
+          break;
+
+        Uint16 textlen =3D packet->GetWord ();
+
+        char *arguments;
+        arguments =3D new char[textlen];
+        packet->GetData (arguments, textlen);
+
+        char *str2 =3D new char[(textlen / 2) + 1];
+        int idx2 =3D 0;
+        for (int i =3D 0; i < textlen; i++)
+            {
+              if (arguments[i] !=3D 0)
+                str2[i / 2] =3D arguments[i];
+            }
+        str2[textlen / 2] =3D 0;
+
+
+        vector < std::string > arglist;
+        std::string arg_string =3D std::string (str2);
+        char tab[2];
+        tab[0] =3D 9;
+        tab[1] =3D 0;
+        std::string delim =3D std::string (tab);
+
+
+        stringSplit (arglist, arg_string, delim);
+
+
+        std::string message =3D
+          pClilocLoader.GetMessageWithArguments ((int) clilocID,
+                                                  (int) arglist.size (),
+                                                  arglist);
+
+        if (character)
+          character->AddAOSTooltip (message);
+
+        if (obj)
+          obj->AddAOSTooltip (message);
+
+          delete[] str2;
+          delete[] arguments;
+      }
+  while (clilocID !=3D 0);
+
+}
+]]--
+
+--[[
+std::string cClilocLoader::GetMessageWithArguments (int id, int args_num, =
vector < std::string > &args)
+{
+
+	vector < std::string > splitted_str;
+	std::string word;
+
+	std::string ret_msg =3D "";
+	std::string message =3D GetMessage (id);
+	char *tags =3D new char[message.size () + 1];
+	memset(tags,0,message.size ()+1);
+	strcpy (tags, message.c_str ());
+
+
+	char *tag =3D strtok (tags, "~~");
+
+	while (tag !=3D NULL)
+	{
+		char *copy_str =3D new char[strlen (tag) + 1];
+		copy_str[strlen (tag)] =3D 0;
+		strcpy (copy_str, tag);
+		splitted_str.push_back (string (copy_str));
+		tag =3D strtok (NULL, "~~");
+		delete[] copy_str;
+	}
+
+	int args_index =3D 0;
+	for (unsigned int i =3D 0; i < splitted_str.size (); i++)
+	{
+
+		word =3D splitted_str.at (i);
+
+		if (word.empty ())
+			continue;
+
+		char *newstr =3D (char *) word.c_str ();
+
+		if (((newstr[0] >=3D 0x30) && (newstr[0] <=3D 0x39)) && newstr[1] =3D=3D=
 95)
+		{
+			word =3D args.at (args_index);
+			args_index++;
+			if (word[0] =3D=3D 35)
+			{
+				std::string sub =3D word.substr (1);
+				int msgid =3D atoi (sub.c_str ());
+				word =3D GetMessage (msgid);
+			}
+		}
+		ret_msg +=3D word;
+		// HARKON: why delete?
+		// delete[] newstr;
+	}
+
+
+	delete[] tags;
+	delete[] tag;
+
+	return ret_msg;
+}
+]]--
+
+
+--[[
+var tooltip =3D 0;
+
+net_onaostooltip(const id, const count, const x, const y)
+{
+//log("TOOLTIP");
+	control_close(tooltip);
+	=

+	if(id =3D=3D 0) {
+		control_close(tooltip);
+		//tooltip =3D 0;
+		return;
+	}
+
+	tooltip =3D gui_addcontainer(x+10,y+10,100,100);
+	=

+	if(tooltip > 6000000){
+		control_close(tooltip);
+		return;
+	}
+	=

+	gui_setcontainer(tooltip);
+	=

+	var gump =3D gui_addgump(0,0,0x588,0);
+
+	control_setsize(gump, 80, 15 * count);
+	control_setalpha(gump, 220);
+	gui_setcontainershape(gump);
+	=

+	var message, lab, highlight, labheight;
+	var maxsize =3D 0;
+	var yalign =3D 0;
+
+	for(var i =3D 0; i < count; i++) {
+		message =3D net_getaostooltip(id, i);
+//log("MSG: " + message);
+		highlight =3D char_gethighlighthue(id);
+		lab =3D gui_addlabel(1, yalign, message, 1);
+		var labsize =3D label_getwidth(lab);
+		labheight =3D label_getheight(lab);
+		if(labsize>maxsize)
+			maxsize =3D labsize;
+		=

+		if(i =3D=3D 0) {
+			if(highlight !=3D -1)
+				label_sethue(lab, highlight);
+			else
+				label_sethue(lab, 55);
+		}
+		=

+		yalign +=3D labheight + 2;
+	}
+
+	control_setsize(gump, maxsize + 1, (labheight + 2) * count);
+	control_setalpha(gump, 170);
+	gui_setcontainershape(gump);
+	gui_setcontainer();
+}
+]]--



From no-reply at zwischenwelt.org  Sun Dec  2 01:40:36 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 00:40:36 -0000
Subject: [Iris-commit] [IRIS] r1577 - /trunk/src/data_L.cpp
Message-ID: <20071202010007.F021F1C186DF@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec  2 01:40:35 2007
New Revision: 1577

Log:
removed MyCrash forward declaration from data_L as it is now globally avail=
able

Modified:
    trunk/src/data_L.cpp

Modified: trunk/src/data_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data_L.cpp (original)
+++ trunk/src/data_L.cpp Sun Dec  2 01:40:35 2007
@@ -18,9 +18,6 @@
 =

 =

 using namespace Lugre;
-namespace Lugre {
-	void MyCrash				(const char* szMessage);
-};
 =

 class cGroundBlockLoader_L : public cLuaBind<cGroundBlockLoader> { public:
 	// implementation of cLuaBind



From no-reply at zwischenwelt.org  Sun Dec  2 02:05:10 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 01:05:10 -0000
Subject: [Iris-commit] [IRIS] r1580 - in /trunk/data: config.lua.dist
 lua/lib.keybinds.lua lua/main.lua lua/net.other.lua mymacros.lua.dist
Message-ID: <20071202010513.AFA0C1C182B8@zwischenwelt.org>

Author: hagish
Date: Sun Dec  2 02:05:10 2007
New Revision: 1580

Log:
addlines with colors, f12 displays old addlines

Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/lib.keybinds.lua
    trunk/data/lua/main.lua
    trunk/data/lua/net.other.lua
    trunk/data/mymacros.lua.dist

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Dec  2 02:05:10 2007
@@ -223,6 +223,9 @@
 gHeadTextFadeout =3D 2 * 1000
 -- maximum length of combined chat messages
 gHeadTextCombine =3D 64
+
+-- fadeline timeout
+gFadeLineTime =3D 10 * 1000 -- msec, 1000=3D1sec
 =

 gbUseExactGrannyMousepicking =3D true
 gEnableGrannyMaterials =3D true

Modified: trunk/data/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.keybinds.lua (original)
+++ trunk/data/lua/lib.keybinds.lua Sun Dec  2 02:05:10 2007
@@ -28,7 +28,6 @@
 	Bind("left",    function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end end end) =

 	Bind("down",    function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else ChatLine_HistoryUpDown(-1) end end) =

 	Bind("up",      function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else ChatLine_HistoryUpDown(1) end end)
-	=

 	=

 	=

 	--~ Bind("m",		function (state) if (not gActiveEditText) then if (state >=
 0) then

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Sun Dec  2 02:05:10 2007
@@ -242,6 +242,12 @@
 =

 	gCurrentRenderer:Init()
 =

+	-- set fadelines font
+	gFadeLinesFont =3D gUniFontLoaderType and gUniFontName[gChatText_UniFontN=
umber] or gFontNameDefault
+	gFadeLineTextH =3D gUniFontHeight[gChatText_UniFontNumber] or gFontChatSi=
ze
+	gFadeLineH =3D 20
+	gFadeLineOffY =3D 50
+
 	StartMainMenu()
 =

 	if (gStartInDebugMode) then StopMainMenu() StartDebugMenu() end

Modified: trunk/data/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.other.lua (original)
+++ trunk/data/lua/net.other.lua Sun Dec  2 02:05:10 2007
@@ -492,11 +492,27 @@
 	local unitext_name =3D input:PopFilledString(30)
 	local unitext_message =3D input:PopUnicodeString((unitext_size-48)/2)
 =

+
+	local r,g,b =3D 1,1,1
+	if unitext_type =3D=3D hex2num("0x00") then r,g,b =3D 1,1,1 end	-- 0x00 -=
 Normal =

+	if unitext_type =3D=3D hex2num("0x01") then r,g,b =3D 0,0,1 end	-- 0x01 -=
 Broadcast/System =

+	if unitext_type =3D=3D hex2num("0x02") then r,g,b =3D 0,1,0 end	-- 0x02 -=
 Emote =

+	if unitext_type =3D=3D hex2num("0x06") then r,g,b =3D 1,1,1 end	-- 0x06 -=
 System/Lower Corner =

+	if unitext_type =3D=3D hex2num("0x07") then r,g,b =3D 1,0,0 end	-- 0x07 -=
 Message/Corner With Name =

+	if unitext_type =3D=3D hex2num("0x07") then r,g,b =3D 1,1,1 end	-- 0x08 -=
 Whisper =

+	if unitext_type =3D=3D hex2num("0x07") then r,g,b =3D 1,1,1 end	-- 0x09 -=
 Yell =

+	if unitext_type =3D=3D hex2num("0x07") then r,g,b =3D 0,1,1 end	-- 0x0A -=
 Spell =

+	if unitext_type =3D=3D hex2num("0x07") then r,g,b =3D 0,1,0 end	-- 0x0D -=
 Guild Chat =

+	if unitext_type =3D=3D hex2num("0x07") then r,g,b =3D 0,1,0 end	-- 0x0E -=
 Alliance Chat =

+	if unitext_type =3D=3D hex2num("0x07") then r,g,b =3D 1,0,1 end	-- 0x0F -=
 Command Prompts	=

+	=

+	if unitext_hue then r,g,b =3D Uo16Color2Rgb(unitext_hue) end
+	=

 	Mobile_NameHint(mobile_serial,unitext_item_model,unitext_name,unitext_mes=
sage)
 	printdebug("net",sprintf("NET: UnicodeText speakerid: %i name: %s txtsize=
: %i msg: %s\n",mobile_serial,unitext_name,(unitext_size-48)/2,unitext_mess=
age) )
 	=

 	unitext_message =3D UnicodeFix(unitext_message)
-	AddFadeLines(unitext_name..": "..string.gsub(unitext_message,"<br>","\n")=
) -- TODO : unicode
+	AddFadeLines(unitext_name..": "..string.gsub(unitext_message,"<br>","\n")=
,{r,g,b,1}) -- TODO : unicode
 	JournalAddText(unitext_name,unitext_message)
 	NotifyListener("Hook_Text",unitext_name,unitext_message)
 =


Modified: trunk/data/mymacros.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/mymacros.lua.dist (original)
+++ trunk/data/mymacros.lua.dist Sun Dec  2 02:05:10 2007
@@ -40,7 +40,8 @@
 SetMacro("point",		function() MacroCmd_ZoomCompass(1/1.5) end)
 SetMacro("f10",			function() MacroCmd_ShowDevTool() end)
 SetMacro("f11",			function() MacroCmd_ShowFallBackTool() end)
-SetMacro("f12",			function() MacroCmd_GridScreenshot() end)
+SetMacro("shift+f12",			function() MacroCmd_GridScreenshot() end)
+SetMacro("f12",			function() FadeLineToggleShowAll() end)
 SetMacro("v",			function() MacroCmd_Screenshot() end)
 SetMacro("x",			function() MacroCmd_CamChangeZoom( 1) end)
 SetMacro("y",			function() MacroCmd_CamChangeZoom(-1) end)



From no-reply at zwischenwelt.org  Sun Dec  2 02:41:03 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 01:41:03 -0000
Subject: [Iris-commit] [IRIS] r1582 - in /trunk/data: config.lua.dist
 lua/lib.3d.mobile.lua lua/main.lua
Message-ID: <20071202014104.018931C182B8@zwischenwelt.org>

Author: hagish
Date: Sun Dec  2 02:41:02 2007
New Revision: 1582

Log:
use default font in chatline, you can activate uo fonts in the config

Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/lib.3d.mobile.lua
    trunk/data/lua/main.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Dec  2 02:41:02 2007
@@ -32,6 +32,15 @@
 gFontChatSize		=3D 12
 gFontGumpSize		=3D 12
 gHudNamesFontSize	=3D 12
+
+-- uo fonts
+if false then
+	gFontNameDefault	=3D "font_unifont0"
+	gFontSizeDefault	=3D 26
+	gFontChatSize		=3D 26
+	gFontGumpSize		=3D 26
+	gHudNamesFontSize	=3D 26
+end
 =

 -- GUI Styles : sience,iris,ray available (see data\lua\gui\gui.styles.lua)
 gGuiDefaultStyleSet =3D "sience"

Modified: trunk/data/lua/lib.3d.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.mobile.lua (original)
+++ trunk/data/lua/lib.3d.mobile.lua Sun Dec  2 02:41:02 2007
@@ -306,8 +306,12 @@
 			-- display the text
 			mobile.chattext.mLastText =3D mobile.mlastChatText
 			mobile.chattext.gfx:SetColour(r,g,b,a)
-			mobile.chattext.gfx:SetFont(gUniFontLoaderType and gUniFontName[gChatTe=
xt_UniFontNumber] or gFontNameDefault)
-			mobile.chattext.gfx:SetCharHeight(gUniFontHeight[gChatText_UniFontNumbe=
r] or gFontChatSize)
+			--mobile.chattext.gfx:SetFont(gUniFontLoaderType and gUniFontName[gChat=
Text_UniFontNumber] or gFontNameDefault)
+			--mobile.chattext.gfx:SetCharHeight(gUniFontHeight[gChatText_UniFontNum=
ber] or gFontChatSize)
+			=

+			mobile.chattext.gfx:SetFont(gFontNameDefault)
+			mobile.chattext.gfx:SetCharHeight(gFontSizeDefault)
+			=

 			mobile.chattext.gfx:SetText(mobile.mlastChatText)
 			local w,h =3D mobile.chattext.gfx:GetTextBounds()
 			mobile.chattext.gfx:SetPos(0, 0 - h)

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Sun Dec  2 02:41:02 2007
@@ -243,10 +243,10 @@
 	gCurrentRenderer:Init()
 =

 	-- set fadelines font
-	gFadeLinesFont =3D gUniFontLoaderType and gUniFontName[gChatText_UniFontN=
umber] or gFontNameDefault
-	gFadeLineTextH =3D gUniFontHeight[gChatText_UniFontNumber] or gFontChatSi=
ze
-	gFadeLineH =3D 20
-	gFadeLineOffY =3D 50
+	gFadeLinesFont =3D gFontNameDefault
+	gFadeLineTextH =3D gFontChatSize
+	gFadeLineH =3D gFadeLineTextH
+	gFadeLineOffY =3D 30 + gFadeLineTextH
 =

 	StartMainMenu()
 =




From no-reply at zwischenwelt.org  Sun Dec  2 03:08:11 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 02:08:11 -0000
Subject: [Iris-commit] [IRIS] r1583 - /trunk/doc/generate_lua_api.php
Message-ID: <20071202020812.154251C182B8@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec  2 03:08:11 2007
New Revision: 1583

Log:
improved lua documentation generation : instead of one pseudo-GLOBAL class =
there are now pseudoclasses for each lua/cpp file

Modified:
    trunk/doc/generate_lua_api.php

Modified: trunk/doc/generate_lua_api.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/doc/generate_lua_api.php (original)
+++ trunk/doc/generate_lua_api.php Sun Dec  2 03:08:11 2007
@@ -2,6 +2,8 @@
 <?php
 	include("roblib.php");
 	=

+	// returns filename without extension
+	function FileNameRemoveExt ($filename) { return ereg_replace("\\.[^\\.]+$=
","",$filename); }
 	=

 	$files_lua =3D array();
 	$files_cpp =3D array();
@@ -23,13 +25,22 @@
 	$methods_byclass =3D array();
 	$class_descriptions =3D array();
 	=

-	foreach ($files_lua as $o) {
-		$lines =3D file($o);
+	foreach ($files_lua as $filename) {
+		$lines =3D file($filename);
 		$numlines =3D count($lines);
 		=

+		if (1) {
+			$classname =3D FileNameRemoveExt($filename);
+			$description =3D "/// file : $filename  (this is just a pseudo class us=
ed for grouping global functions)\n";
+			if (isset($class_descriptions[$classname])) =

+				$description .=3D "/// warning, there also exists a real class with th=
is name\n".$class_descriptions[$classname];
+			$class_descriptions[$classname] =3D $description;
+		}
+		=

+		=

 		$description =3D array();
 		=

-		echo "// ##### ".$o."\n";
+		echo "// ##### ".$filename."\n";
 		for ($i=3D0;$i<$numlines;++$i) {
 			$line =3D ereg_replace("[ \t]+"," ",trim($lines[$i])); // trim and summ=
arize whitespace
 			if ($line =3D=3D "") continue;
@@ -48,18 +59,21 @@
 				$infotext =3D "";
 				foreach ($description as $dline) $infotext .=3D $p."/// ".$dline."\n";
 				=

-				if ($classprefix =3D=3D "") { // global
-					$infotext .=3D $p."mixed	".$funname."	(".implode(",",$params).") {}\n=
";
-					$methods_global[] =3D $infotext;
-				} else {
-					$classname =3D substr($classprefix,0,-1);
-					=

+				$bIsStatic =3D false;
+				$classname =3D false;
+				if ($classprefix !=3D "") { $classname =3D substr($classprefix,0,-1); =
$bIsStatic =3D substr($classprefix,-1) =3D=3D "."; }
+				if ($classprefix =3D=3D "") { $classname =3D FileNameRemoveExt($filena=
me); $bIsStatic =3D true; }
+				=

+				if ($classname) {
 					$infotext .=3D $p;
-					if (substr($classprefix,-1) =3D=3D ".") $infotext .=3D "static "; // =
static method
+					if ($bIsStatic) $infotext .=3D "static "; // static method
 					$infotext .=3D "mixed	".$funname."	(".implode(",",$params).") {}\n";
 					=

 					if (!isset($methods_byclass[$classname])) $methods_byclass[$classname=
] =3D array();
 					$methods_byclass[$classname][] =3D $infotext;
+				} else { // global
+					$infotext .=3D $p."mixed	".$funname."	(".implode(",",$params).") {}\n=
";
+					$methods_global[] =3D $infotext;
 				}
 			}
 			=

@@ -69,16 +83,26 @@
 	}
 	=

 	=

-	foreach ($files_cpp as $o) {
-		$lines =3D file($o);
+	foreach ($files_cpp as $filename) {
+		$lines =3D file($filename);
 		$numlines =3D count($lines);
 		=

+		if (1) {
+			$classname =3D FileNameRemoveExt($filename);
+			$description =3D "/// file : $filename  (this is just a pseudo class us=
ed for grouping global functions)\n";
+			if (isset($class_descriptions[$classname])) =

+				$description .=3D "/// warning, there also exists a real class with th=
is name\n". $class_descriptions[$classname];
+			$class_descriptions[$classname] =3D $description;
+		}
+		=

+		=

 		$description =3D array();
-		$classname =3D "";
+		$parsing_classname =3D "";
 		$methodbinds =3D array();
 		$luasyntax =3D "";
 		=

-		echo "// ##### ".$o."\n";
+		=

+		echo "// ##### ".$filename."\n";
 		for ($i=3D0;$i<$numlines;++$i) {
 			$line =3D ereg_replace("[ \t]+"," ",trim($lines[$i])); // trim and summ=
arize whitespace
 			if ($line =3D=3D "") continue;
@@ -96,12 +120,12 @@
 			=

 			// class cGroundBlockLoader_L : public cLuaBind<cGroundBlockLoader>
 			if (eregi('^class ([^ :]+).*cLuaBind.*',$line,$r)) {
-				$classname =3D $r[1];
+				$parsing_classname =3D $r[1];
 				$methodbinds =3D array();
 				=

 				$class_description =3D "";
 				foreach ($description as $dline) $class_description .=3D "/// ".$dline=
."\n";
-				$class_descriptions[$classname] =3D $class_description;
+				$class_descriptions[$parsing_classname] =3D $class_description;
 			}
 			=

 			// REGISTER_METHOD(Destroy);
@@ -115,9 +139,11 @@
 			=

 			// static int				CreateGroundBlockLoader		(lua_State *L) { PROFILE
 			if (eregi('int ([^ \(]+)[ ]*\(.*lua_State',$line,$r)) {
+				$classname =3D $parsing_classname;
 				$methodname =3D trim($r[1]);
 				$bIsGlobal =3D false;
 				$bIsStatic =3D !isset($methodbinds[$methodname]);
+				if ($classname =3D=3D "") { $classname =3D FileNameRemoveExt($filename=
); $bIsStatic =3D true; }
 				$p =3D ($classname =3D=3D "" || $bIsGlobal) ? "" : "	"; // indention
 				=

 				$infotext =3D "";
@@ -128,6 +154,7 @@
 				//~ } else {
 				$infotext .=3D $p.($bIsStatic?"static ":"")."mixed $methodname (...) {=
}\n";
 				//~ }
+				=

 				=

 				if ($classname =3D=3D "" || $bIsGlobal) { // global
 					$methods_global[] =3D $infotext;
@@ -145,7 +172,7 @@
 	// output =

 	//~ foreach ($methods_global as $infotext) echo "\n".$infotext;
 	$classname_global =3D "GLOBAL";
-	$methods_byclass[$classname_global] =3D $methods_global;
+	if (count($methods_global) > 0) $methods_byclass[$classname_global] =3D $=
methods_global;
 	$class_descriptions[$classname_global] =3D "/// this is not really a clas=
s, just a wrapper for making documentation for global functions more access=
ible\n";
 	foreach ($methods_byclass as $classname =3D> $infotext_arr) {
 		echo "\n";



From no-reply at zwischenwelt.org  Sun Dec  2 02:38:50 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 01:38:50 -0000
Subject: [Iris-commit] [IRIS] r1581 - /trunk/bin/iris2.exe
Message-ID: <20071202013850.95E491C18221@zwischenwelt.org>

Author: sience
Date: Sun Dec  2 02:38:49 2007
New Revision: 1581

Log:
-new executable

Modified:
    trunk/bin/iris2.exe

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Sun Dec  2 03:16:52 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 02:16:52 -0000
Subject: [Iris-commit] [IRIS] r1584 - /trunk/doc/generate_lua_api.php
Message-ID: <20071202021652.1CA151C182C6@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec  2 03:16:49 2007
New Revision: 1584

Log:
luadoc fix

Modified:
    trunk/doc/generate_lua_api.php

Modified: trunk/doc/generate_lua_api.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/doc/generate_lua_api.php (original)
+++ trunk/doc/generate_lua_api.php Sun Dec  2 03:16:49 2007
@@ -4,6 +4,7 @@
 	=

 	// returns filename without extension
 	function FileNameRemoveExt ($filename) { return ereg_replace("\\.[^\\.]+$=
","",$filename); }
+	function PseudoClassNameFromFileName ($filename) { return strtr(FileNameR=
emoveExt($filename),array("."=3D>"_")); }
 	=

 	$files_lua =3D array();
 	$files_cpp =3D array();
@@ -30,7 +31,7 @@
 		$numlines =3D count($lines);
 		=

 		if (1) {
-			$classname =3D FileNameRemoveExt($filename);
+			$classname =3D PseudoClassNameFromFileName($filename);
 			$description =3D "/// file : $filename  (this is just a pseudo class us=
ed for grouping global functions)\n";
 			if (isset($class_descriptions[$classname])) =

 				$description .=3D "/// warning, there also exists a real class with th=
is name\n".$class_descriptions[$classname];
@@ -62,7 +63,7 @@
 				$bIsStatic =3D false;
 				$classname =3D false;
 				if ($classprefix !=3D "") { $classname =3D substr($classprefix,0,-1); =
$bIsStatic =3D substr($classprefix,-1) =3D=3D "."; }
-				if ($classprefix =3D=3D "") { $classname =3D FileNameRemoveExt($filena=
me); $bIsStatic =3D true; }
+				if ($classprefix =3D=3D "") { $classname =3D PseudoClassNameFromFileNa=
me($filename); $bIsStatic =3D true; }
 				=

 				if ($classname) {
 					$infotext .=3D $p;
@@ -88,7 +89,7 @@
 		$numlines =3D count($lines);
 		=

 		if (1) {
-			$classname =3D FileNameRemoveExt($filename);
+			$classname =3D PseudoClassNameFromFileName($filename);
 			$description =3D "/// file : $filename  (this is just a pseudo class us=
ed for grouping global functions)\n";
 			if (isset($class_descriptions[$classname])) =

 				$description .=3D "/// warning, there also exists a real class with th=
is name\n". $class_descriptions[$classname];
@@ -143,7 +144,7 @@
 				$methodname =3D trim($r[1]);
 				$bIsGlobal =3D false;
 				$bIsStatic =3D !isset($methodbinds[$methodname]);
-				if ($classname =3D=3D "") { $classname =3D FileNameRemoveExt($filename=
); $bIsStatic =3D true; }
+				if ($classname =3D=3D "") { $classname =3D PseudoClassNameFromFileName=
($filename); $bIsStatic =3D true; }
 				$p =3D ($classname =3D=3D "" || $bIsGlobal) ? "" : "	"; // indention
 				=

 				$infotext =3D "";



From no-reply at zwischenwelt.org  Sun Dec  2 04:35:21 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 03:35:21 -0000
Subject: [Iris-commit] [IRIS] r1585 - in /trunk/data/lua: lib.cliloc.lua
	net/net.packethandlers.lua
Message-ID: <20071202033521.989771C182C6@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec  2 04:35:20 2007
New Revision: 1585

Log:
added some notes about the tooltipp/megacliloc packet format parsing

Modified:
    trunk/data/lua/lib.cliloc.lua
    trunk/data/lua/net/net.packethandlers.lua

Modified: trunk/data/lua/lib.cliloc.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.cliloc.lua (original)
+++ trunk/data/lua/lib.cliloc.lua Sun Dec  2 04:35:20 2007
@@ -86,7 +86,7 @@
 end
 =

 --[[
--- TODO : port old iris code : =

+-- TODO : port old iris code :  --- see also function gPacketHandler.kPack=
et_Localized_Text () in net.other.lua
 std::string cClilocLoader::GetMessageWithArguments (int id, int args_num, =
vector < std::string > &args)
 {
 =


Modified: trunk/data/lua/net/net.packethandlers.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.packethandlers.lua (original)
+++ trunk/data/lua/net/net.packethandlers.lua Sun Dec  2 04:35:20 2007
@@ -162,8 +162,11 @@
 	end
 end
 =

+
+-- http://necrotoolz.sourceforge.net/kairpacketguide/packetd6.htm
+-- 0x0009 as seperator for args
 --[[
-void cClient::Act_AOSTooltip (cPacket * packet)
+void cClient::Act_AOSTooltip (cPacket * packet) // kPacket_Mega_Cliloc han=
dler
 {
 =

   if (!Config::GetAOSToolTips())
@@ -171,9 +174,9 @@
   if ( !Config::GetClilocs() )
     return;
   packet->SetPosition (5);
-  Uint32 id =3D packet->GetDword ();
+  Uint32 id =3D packet->GetDword (); // corresponds to item_serial  in the=
 above code
   Uint16 unkn =3D packet->GetWord ();
-  Uint32 listID =3D packet->GetDword ();
+  Uint32 listID =3D packet->GetDword (); // corresponds to serial  above
   cCharacter *character =3D NULL;
   cDynamicObject *obj =3D NULL;
 =

@@ -183,7 +186,7 @@
   if (character)
       {
         character->ClearAOSTooltip ();
-        character->SetAOSTooltipID (listID);
+        character->SetAOSTooltipID (listID); --- unknown what this is for,=
 seems to always be =3D id
       }
   if (obj)
       {
@@ -228,7 +231,8 @@
         std::string message =3D
           pClilocLoader.GetMessageWithArguments ((int) clilocID,
                                                   (int) arglist.size (),
-                                                  arglist);
+                                                  arglist);  -- see lib.cl=
iloc.lua for comment with the old code for this, =

+																 --- see also function gPacketHandler.kPacket_Localized_Te=
xt () in net.other.lua
 =

         if (character)
           character->AddAOSTooltip (message);



From no-reply at zwischenwelt.org  Sun Dec  2 07:03:26 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 06:03:26 -0000
Subject: [Iris-commit] [IRIS] r1586 - /trunk/doc/generate_lua_api.php
Message-ID: <20071202060327.2999B1C182B3@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec  2 07:03:26 2007
New Revision: 1586

Log:
removed lib. at the start from pseudo-filename-classnames

Modified:
    trunk/doc/generate_lua_api.php

Modified: trunk/doc/generate_lua_api.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/doc/generate_lua_api.php (original)
+++ trunk/doc/generate_lua_api.php Sun Dec  2 07:03:26 2007
@@ -4,7 +4,7 @@
 	=

 	// returns filename without extension
 	function FileNameRemoveExt ($filename) { return ereg_replace("\\.[^\\.]+$=
","",$filename); }
-	function PseudoClassNameFromFileName ($filename) { return strtr(FileNameR=
emoveExt($filename),array("."=3D>"_")); }
+	function PseudoClassNameFromFileName ($filename) { return strtr(FileNameR=
emoveExt($filename),array("lib."=3D>"","."=3D>"_")); }
 	=

 	$files_lua =3D array();
 	$files_cpp =3D array();



From no-reply at zwischenwelt.org  Sun Dec  2 11:33:18 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 10:33:18 -0000
Subject: [Iris-commit] [IRIS] r1587 - in /trunk: bin/ data/ data/base/font/
 data/lua/ data/models/materials/ src/
Message-ID: <20071202103318.8059C1C182B3@zwischenwelt.org>

Author: sience
Date: Sun Dec  2 11:33:17 2007
New Revision: 1587

Log:
-berlin outline font added
-sdl headers removed from data.cpp
-hudnames activated again
-some font fixes

Added:
    trunk/data/base/font/
    trunk/data/base/font/Berlin_sans32.png   (with props)
    trunk/data/base/font/berlin_sans32.fontdef
Modified:
    trunk/bin/resources.cfg
    trunk/data/config.lua.dist
    trunk/data/lua/lib.3d.mobile.lua
    trunk/data/lua/lib.gfm.lua
    trunk/data/lua/lib.journal.lua
    trunk/data/models/materials/textures.material
    trunk/src/data.cpp

Modified: trunk/bin/resources.cfg
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/bin/resources.cfg (original)
+++ trunk/bin/resources.cfg Sun Dec  2 11:33:17 2007
@@ -8,6 +8,7 @@
 FileSystem=3D./
 FileSystem=3D../data/base
 FileSystem=3D../data/base/ui
+FileSystem=3D../data/base/font
 FileSystem=3D../data/skybox
 FileSystem=3D../data/particles/materials
 FileSystem=3D../data/particles/particles

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Dec  2 11:33:17 2007
@@ -27,11 +27,11 @@
 gHideOfflineModeTeleportMenu =3D true		-- currently broken
 =

 -- Font settings
-gFontNameDefault	=3D "TrebuchetMSBold"
-gFontSizeDefault	=3D 16
-gFontChatSize		=3D 12
-gFontGumpSize		=3D 12
-gHudNamesFontSize	=3D 12
+gFontNameDefault =3D "BerlinSans32"		--"TrebuchetMSBold"
+gFontSizeDefault =3D 15
+gFontChatSize =3D 18
+gFontGumpSize =3D 15
+gHudNamesFontSize	=3D 16
 =

 -- uo fonts
 if false then

Modified: trunk/data/lua/lib.3d.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.mobile.lua (original)
+++ trunk/data/lua/lib.3d.mobile.lua Sun Dec  2 11:33:17 2007
@@ -153,15 +153,11 @@
 	=

 	if (mobile.name) then
 		if (not gHideHUDNames) then =

-			if (not mobile.hudname) then =

-				-- hudtext
-				local text =3D mobile.name
+			if (not mobile.hudname) then
 				local w,h =3D 0,12
 				local x,y =3D 0,0
 				local r,g,b =3D GetNotorietyColor(mobile.notoriety)
 				local col_text =3D {r,g,b,1}
-				--local tw,th =3D gFPSField.text.gfx:GetTextBounds()	=

-				=

 				=

 				if (not gHudNamesDialogLayer) then
 					local col_back =3D {0,0,0,0}
@@ -170,11 +166,16 @@
 					gHudNamesDialogLayer:SendToBack()
 				end
 				=

-				mobile.hudname =3D guimaker.MakeText(gHudNamesDialogLayer.panel,0,0,te=
xt,gHudNamesFontSize,col_text)
+				mobile.hudname =3D guimaker.MakeText(gHudNamesDialogLayer.panel,0,0, m=
obile.name, gHudNamesFontSize, col_text, gFontNameDefault)
 				mobile.hudname.gfx:SetTrackPosSceneNode(mobile.headpos)
-				--mobile.hudname.gfx:SetTrackPosSceneNode(mobile.gfx)
+
 				mobile.hudname.gfx.mbTrackHideIfClamped =3D true
 				mobile.hudname.gfx.mbTrackHideIfBehindCam =3D true
+
+				local vw,vh =3D GetViewportSize()
+				mobile.hudname.gfx.mvTrackClampMin =3D {0,0}
+				mobile.hudname.gfx.mvTrackClampMax =3D {vw,vh}
+
 				mobile.hudname.gfx:SetTextAlignment(kGfx2DAlign_Center)
 				mobile.hudname.lastn =3D mobile.notoriety
 				mobile.hudname.lastname =3D mobile.name

Modified: trunk/data/lua/lib.gfm.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.gfm.lua (original)
+++ trunk/data/lua/lib.gfm.lua Sun Dec  2 11:33:17 2007
@@ -233,7 +233,7 @@
 				hex2num(gump.attr.normal), hex2num(gump.attr.over), hex2num(gump.attr.=
pressed),
 				attr.left, attr.top, attr.width, attr.height )
 	elseif (attr.class =3D=3D "label") then
-			widget =3D guimaker.MakeText(dialog.rootwidget,attr.left,attr.top,text[=
1],gFontGumpSize,{0,0,0,1.0},gFontNameDefault)
+			widget =3D guimaker.MakeText(dialog.rootwidget,attr.left,attr.top,text[=
1],gFontGumpSize,{1.0,1.0,1.0,1.0},gFontNameDefault)
 			if (text.attr.align =3D=3D "center") then
 				local w,h =3D widget.gfx:GetTextBounds()
 				widget.gfx:SetPos(attr.left+attr.width/2 - w/2,attr.top)

Modified: trunk/data/lua/lib.journal.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.journal.lua (original)
+++ trunk/data/lua/lib.journal.lua Sun Dec  2 11:33:17 2007
@@ -100,7 +100,7 @@
 		=

 		-- create text
 		local parent =3D gJournalDialog.rootwidget
-		local col =3D {0,0,0,1}
+		local col =3D {1,1,1,1}
 		local bx1,by1,bx2,by2 =3D JournalGetTextBorder()
 		gJournalDialog.maintext =3D guimaker.MakeText(parent,bx1,by1,"",gFontGum=
pSize,col,gFontNameDefault)
 		table.insert(gJournalDialog.clippedWidgets,gJournalDialog.maintext)

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Sun Dec  2 11:33:17 2007
@@ -6789,7 +6789,7 @@
 	} =

 }
 =

-material tex_533 : tex_base =

+material tex_533 : tex_base_alpha =

 { =

 	technique =

 	{ =

@@ -6803,7 +6803,7 @@
 	} =

 }
 =

-material tex_534 : tex_base =

+material tex_534 : tex_base_alpha
 { =

 	technique =

 	{ =

@@ -6817,7 +6817,7 @@
 	} =

 }
 =

-material tex_535 : tex_base =

+material tex_535 : tex_base_alpha =

 { =

 	technique =

 	{ =

@@ -6831,7 +6831,7 @@
 	} =

 }
 =

-material tex_536 : tex_base =

+material tex_536 : tex_base_alpha
 { =

 	technique =

 	{ =

@@ -6845,7 +6845,7 @@
 	} =

 }
 =

-material tex_537 : tex_base =

+material tex_537 : tex_base_alpha
 { =

 	technique =

 	{ =

@@ -6859,7 +6859,7 @@
 	} =

 }
 =

-material tex_538 : tex_base =

+material tex_538 : tex_base_alpha
 { =

 	technique =

 	{ =


Modified: trunk/src/data.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data.cpp (original)
+++ trunk/src/data.cpp Sun Dec  2 11:33:17 2007
@@ -2,7 +2,6 @@
 #include "data.h"
 #include <stdio.h>
 #include "tinyxml.h"
-#include <SDL/SDL_endian.h>
 #include <iostream>
 #include <fstream>
 #include <Ogre.h>



From no-reply at zwischenwelt.org  Sun Dec  2 11:36:28 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 10:36:28 -0000
Subject: [Iris-commit] [IRIS] r1588 - in /trunk/data:
 base/font/Berlin_sans32.png base/font/berlin_sans32.png config.lua.dist
 lua/net.other.lua lua/obj/obj.container.lua
Message-ID: <20071202103629.356A51C186E6@zwischenwelt.org>

Author: hagish
Date: Sun Dec  2 11:36:27 2007
New Revision: 1588

Log:
hmm dont know what i changes .... %)

Added:
    trunk/data/base/font/berlin_sans32.png
      - copied unchanged from r1587, trunk/data/base/font/Berlin_sans32.png
Removed:
    trunk/data/base/font/Berlin_sans32.png
Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/net.other.lua
    trunk/data/lua/obj/obj.container.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Dec  2 11:36:27 2007
@@ -32,6 +32,8 @@
 gFontChatSize =3D 18
 gFontGumpSize =3D 15
 gHudNamesFontSize	=3D 16
+-- value between 0 and 1, the higher the brighter
+gFontChatBrighten	=3D 0.8
 =

 -- uo fonts
 if false then

Modified: trunk/data/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.other.lua (original)
+++ trunk/data/lua/net.other.lua Sun Dec  2 11:36:27 2007
@@ -508,6 +508,11 @@
 	=

 	if unitext_hue then r,g,b =3D Uo16Color2Rgb(unitext_hue) end
 	=

+	-- brighten up the color
+	local h,s,v =3D ColorRGB2HSV(r,g,b)
+	v =3D math.min(1,v + gFontChatBrighten)
+	r,g,b =3D ColorHSV2RGB(h,s,v)
+	=

 	Mobile_NameHint(mobile_serial,unitext_item_model,unitext_name,unitext_mes=
sage)
 	printdebug("net",sprintf("NET: UnicodeText speakerid: %i name: %s txtsize=
: %i msg: %s\n",mobile_serial,unitext_name,(unitext_size-48)/2,unitext_mess=
age) )
 	=


Modified: trunk/data/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.container.lua (original)
+++ trunk/data/lua/obj/obj.container.lua Sun Dec  2 11:36:27 2007
@@ -122,6 +122,7 @@
 =

 =

 function CloseContainer (serial) =

+	print(_TRACEBACK())
 	local container =3D GetContainer(serial)
 	if (container and container.dialog) then
 		DestroyContainerItemWidgets(container)



From no-reply at zwischenwelt.org  Sun Dec  2 11:38:11 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 10:38:11 -0000
Subject: [Iris-commit] [IRIS] r1589 - /trunk/data/lua/obj/obj.container.lua
Message-ID: <20071202103814.330A01C182B3@zwischenwelt.org>

Author: hagish
Date: Sun Dec  2 11:38:11 2007
New Revision: 1589

Log:
hmm dont know what i changes .... %)

Modified:
    trunk/data/lua/obj/obj.container.lua

Modified: trunk/data/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.container.lua (original)
+++ trunk/data/lua/obj/obj.container.lua Sun Dec  2 11:38:11 2007
@@ -122,7 +122,6 @@
 =

 =

 function CloseContainer (serial) =

-	print(_TRACEBACK())
 	local container =3D GetContainer(serial)
 	if (container and container.dialog) then
 		DestroyContainerItemWidgets(container)



From no-reply at zwischenwelt.org  Sun Dec  2 11:54:15 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 10:54:15 -0000
Subject: [Iris-commit] [IRIS] r1590 - in /trunk/data: config.lua.dist
	lua/net.other.lua
Message-ID: <20071202105416.799331C186E6@zwischenwelt.org>

Author: hagish
Date: Sun Dec  2 11:54:15 2007
New Revision: 1590

Log:
small brighten changes

Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/net.other.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Dec  2 11:54:15 2007
@@ -33,7 +33,7 @@
 gFontGumpSize =3D 15
 gHudNamesFontSize	=3D 16
 -- value between 0 and 1, the higher the brighter
-gFontChatBrighten	=3D 0.8
+gFontChatBrighten	=3D 0.6
 =

 -- uo fonts
 if false then

Modified: trunk/data/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.other.lua (original)
+++ trunk/data/lua/net.other.lua Sun Dec  2 11:54:15 2007
@@ -511,6 +511,7 @@
 	-- brighten up the color
 	local h,s,v =3D ColorRGB2HSV(r,g,b)
 	v =3D math.min(1,v + gFontChatBrighten)
+	s =3D math.max(0,s - gFontChatBrighten/2)
 	r,g,b =3D ColorHSV2RGB(h,s,v)
 	=

 	Mobile_NameHint(mobile_serial,unitext_item_model,unitext_name,unitext_mes=
sage)



From no-reply at zwischenwelt.org  Sun Dec  2 12:47:29 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 11:47:29 -0000
Subject: [Iris-commit] [IRIS] r1593 - in /trunk/data: config.lua.dist
 lua/gui/gui.paperdoll.lua lua/lib.cliloc.lua lua/main.lua
 lua/net/net.packethandlers.lua lua/obj/obj.container.lua
Message-ID: <20071202120015.528841C186F7@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec  2 12:47:28 2007
New Revision: 1593

Log:
tooltipps added

Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/gui/gui.paperdoll.lua
    trunk/data/lua/lib.cliloc.lua
    trunk/data/lua/main.lua
    trunk/data/lua/net/net.packethandlers.lua
    trunk/data/lua/obj/obj.container.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Dec  2 12:47:28 2007
@@ -2,6 +2,7 @@
 -- create a new file config.lua to make individual configurations outside =
version management
 -- you can override individual settings there.
 =

+kGuiToolTipWait =3D 100
 =

 -- Client Identification String
 gClientVersion =3D "6.0.1.6"  -- try other version for example "4.0.11c5"

Modified: trunk/data/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/gui/gui.paperdoll.lua (original)
+++ trunk/data/lua/gui/gui.paperdoll.lua Sun Dec  2 12:47:28 2007
@@ -271,6 +271,10 @@
 		Client_SetBottomLine("")
 	end
 	widget.onMouseDown =3D function (widget,mousebutton) end
+	=

+	widget.tooltip_offx =3D kUOToolTippOffX
+	widget.tooltip_offy =3D kUOToolTippOffY
+	widget.on_simple_tooltip =3D function (widget) return AosToolTip_GetText(=
widget.item.serial) or "?" end
 end
 =

 =


Modified: trunk/data/lua/lib.cliloc.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.cliloc.lua (original)
+++ trunk/data/lua/lib.cliloc.lua Sun Dec  2 12:47:28 2007
@@ -85,11 +85,17 @@
 	return loader
 end
 =

+-- replaces #1231231 by cliloc entry
+function ParseClilocParam (param)
+	if (string.sub(param,1,1) ~=3D "#") then return param end -- first char
+	local cliloc_id =3D tonumber(string.sub(param,2))
+	return gClilocLoader and gClilocLoader:Get(cliloc_id) or ("unknown_cliloc=
_"..cliloc_id)
+end
 =

-
+-- replaces ~1_BLA~ by param_arr[1]
 function ParameterizedClilocText (cliloc_id,param_arr) =

 	local text_base =3D gClilocLoader and gClilocLoader:Get(cliloc_id) or ("u=
nknown_cliloc_"..cliloc_id)
-	local res =3D string.gsub(text_base,"~([1-9]+)_[^~]+~",function (num) ret=
urn param_arr[tonumber(num)] end) -- replaces ~1_BLA~ by param_arr[1]
+	local res =3D string.gsub(text_base,"~([1-9]+)_[^~]+~",function (num) ret=
urn ParseClilocParam(param_arr[tonumber(num)]) end)
 	return res
 end
 =


Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Sun Dec  2 12:47:28 2007
@@ -304,10 +304,15 @@
 	else
 		StepMainMenu()
 	end
+	=

+	local gObjectUnderMouse =3D nil -- todo : mousepick every frame ?
+	SetToolTipSubject(GetWidgetUnderMouse() or gObjectUnderMouse)
+	=

 =

 	StepDebugMenu()
 	InputStep() -- generate mouse_left_drag_* and mouse_left_click_single eve=
nts =

 	GUIStep() -- generate mouse_enter, mouse_leave events (might adjust curso=
r -> before CursorStep)
+	ToolTipStep() -- needs mouse_enter, should be after GUIStep
 	CursorStep()
 =

 	NotifyListener("EveryFrame")

Modified: trunk/data/lua/net/net.packethandlers.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.packethandlers.lua (original)
+++ trunk/data/lua/net/net.packethandlers.lua Sun Dec  2 12:47:28 2007
@@ -128,8 +128,8 @@
 gAosToolTipHash =3D {}
 gAosToolTipText =3D {}
 function AosToolTip_GetHash (serial) return gAosToolTipHash[serial] end
+function AosToolTip_GetText (serial) return gAosToolTipText[serial] end
 function AosToolTip_SetHash (serial,hash) gAosToolTipHash[serial] =3D hash=
 end
-function AosToolTip_GetText (serial) return gAosToolTipText[serial] end
 function AosToolTip_SetText (serial,text) gAosToolTipText[serial] =3D text=
 end
 =

 -- Newer packet as of late 2004.

Modified: trunk/data/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.container.lua (original)
+++ trunk/data/lua/obj/obj.container.lua Sun Dec  2 12:47:28 2007
@@ -3,6 +3,9 @@
 -- TODO : later : paperdoll stuff, corpse... kPacket_Corpse_Equipment
 =

 gContainerPrototype =3D {}
+
+kUOToolTippOffX =3D -16
+kUOToolTippOffY =3D 32
 =

 function GetContainer(container_or_serial) =

 	if (not container_or_serial) then return nil end
@@ -208,9 +211,14 @@
 			end
 		end
 	end
-end
-
-
-
-
-
+
+	=

+	widget.tooltip_offx =3D kUOToolTippOffX
+	widget.tooltip_offy =3D kUOToolTippOffY
+	widget.on_simple_tooltip =3D function (widget) return AosToolTip_GetText(=
widget.item.serial) or "?" end
+end
+
+
+
+
+



From no-reply at zwischenwelt.org  Sun Dec  2 12:11:04 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 11:11:04 -0000
Subject: [Iris-commit] [IRIS] r1592 -
	/trunk/data/lua/net/net.packethandlers.lua
Message-ID: <20071202120015.46F651C18221@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec  2 12:11:04 2007
New Revision: 1592

Log:
aos tooltipp fix

Modified:
    trunk/data/lua/net/net.packethandlers.lua

Modified: trunk/data/lua/net/net.packethandlers.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.packethandlers.lua (original)
+++ trunk/data/lua/net/net.packethandlers.lua Sun Dec  2 12:11:04 2007
@@ -142,7 +142,7 @@
 	local objrevision_hash =3D input:PopNetUint32()
 	printdebug("net",sprintf("NET: AOSObjProp objserial=3D0x%08x objrevision_=
hash=3D0x%08x\n",objserial,objrevision_hash))
 	if (AosToolTip_GetHash(objserial) ~=3D objrevision_hash) then
-		print("Send_AosToolTipRequest",objserial,objrevision_hash)
+		--~ print("Send_AosToolTipRequest",objserial,objrevision_hash)
 		AosToolTip_SetHash(objserial,objrevision_hash)
 		Send_AosToolTipRequest(objserial)
 	end
@@ -194,7 +194,7 @@
 		totaltext =3D totaltext..text
 		--~ printf("NET: Mega_Cliloc LINE : text=3D'%s' clilocbase=3D'%s' totalp=
aramtext=3D'%s' debug=3D%s\n",text,cliloctext,totalparamtext,debugtxt)
 	end
-	printf("NET: Mega_Cliloc : serial=3D%d,%d text=3D'%s'\n",serial_1,serial_=
2,totaltext)
-	AosToolTip_SetText(serial_1,totaltext)
-end
-
+	printf("NET: Mega_Cliloc : serial=3D%d u3=3D%d text=3D'%s'\n",serial,unkn=
own3,totaltext)
+	AosToolTip_SetText(serial,totaltext)
+end
+



From no-reply at zwischenwelt.org  Sun Dec  2 12:07:57 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 11:07:57 -0000
Subject: [Iris-commit] [IRIS] r1591 - in /trunk/data/lua: lib.cliloc.lua
 net.other.lua net/net.packethandlers.lua
Message-ID: <20071202120015.364411C186EE@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec  2 12:07:55 2007
New Revision: 1591

Log:
aos tooltipp parser, generalized ParameterizedClilocText

Modified:
    trunk/data/lua/lib.cliloc.lua
    trunk/data/lua/net.other.lua
    trunk/data/lua/net/net.packethandlers.lua

Modified: trunk/data/lua/lib.cliloc.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.cliloc.lua (original)
+++ trunk/data/lua/lib.cliloc.lua Sun Dec  2 12:07:55 2007
@@ -85,6 +85,15 @@
 	return loader
 end
 =

+
+
+function ParameterizedClilocText (cliloc_id,param_arr) =

+	local text_base =3D gClilocLoader and gClilocLoader:Get(cliloc_id) or ("u=
nknown_cliloc_"..cliloc_id)
+	local res =3D string.gsub(text_base,"~([1-9]+)_[^~]+~",function (num) ret=
urn param_arr[tonumber(num)] end) -- replaces ~1_BLA~ by param_arr[1]
+	return res
+end
+
+
 --[[
 -- TODO : port old iris code :  --- see also function gPacketHandler.kPack=
et_Localized_Text () in net.other.lua
 std::string cClilocLoader::GetMessageWithArguments (int id, int args_num, =
vector < std::string > &args)

Modified: trunk/data/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.other.lua (original)
+++ trunk/data/lua/net.other.lua Sun Dec  2 12:07:55 2007
@@ -420,57 +420,10 @@
 	local text_messagenum =3D input:PopNetUint32()
 	local text_charname =3D input:PopFilledString(30)
 	local text_params =3D input:PopUnicodeLEString((size - 48 - 2)/2)	--littl=
e-endian_ unicode string, tabs ('\t') seperate the arguments. Null Terminat=
ed 0x0000
-	local text_terminator =3D input:PopNetUint16()
-	=

-	local text_base =3D gClilocLoader and gClilocLoader:Get(text_messagenum) =
or ("unknown_cliloc_"..text_messagenum)	--cliloc build
-	local plaintext =3D text_base
-	if (string.find(text_base,"~")) then
-		print("DEBUG",aToken,bToken,text_base)
--- TODO is it possile, that ~2 comes first and ~1 follows?
-		-- split at the ~1_*~
-		local aToken=3Dstrsplit("~[1-9]_[^~]+~",text_base)
-		-- and at \t
-		local bToken=3Dstrsplit("\t",text_params)
-		=

-		if aToken and bToken then
-			-- glue the two arrays together (like a zip)
-			local s =3D ""
-			-- for k,v in pairs(aToken) do print("A["..k.."]: "..v) end
-			-- for k,v in pairs(bToken) do print("B["..k.."]: "..v) end
-			local last =3D 0
-			for k,v in pairs(bToken) do =

-				s =3D s .. aToken[k] .. bToken[k] =

-				last =3D k
-			end
-			s =3D s .. aToken[last+1]
-			=

-			-- if there are #NUMBER parts in the string, it seems that you have to =
look the up in the cliloc stuff
-			-- string.find (s, pattern [, init [, plain]])
-			-- string.gsub (s, pat, repl [, n])
-			-- string.sub (s, i [, j])
-			local finished
-			repeat
-				finished =3D 1
-				local first, last =3D string.find(s, "#[0-9]+")
-				if first then
-					-- found some, so im not finished here
-					finished =3D 0
-					-- read out the number without #
-					local number =3D string.sub(s,first + 1,last)
-					local repl =3D gClilocLoader:Get(number) or ("unknown_cliloc_"..numbe=
r)
-					-- and replace all patterns #number with the cliloc text
-					s =3D string.gsub (s, "#"..number, repl)
-				end
-			until finished =3D=3D 1
-			plaintext =3D s
-		else
-			local text_message =3D sprintf("%s [%s]",text_base,text_params)
-			plaintext =3D string.gsub(text_message,"<br>","\n")
-		end
-	else
-		local text_message =3D sprintf("%s [%s]",text_base,text_params)
-		plaintext =3D string.gsub(text_message,"<br>","\n")
-	end
+	local text_terminator =3D input:PopNetUint16() -- probably the seperator =
unicode char for text_params, "\t" is hardcoded below, string.char(math.flo=
or(terminator)/256)
+	=

+	local plaintext =3D string.gsub(ParameterizedClilocText(text_messagenum,s=
trsplit("\t",text_params)),"<br>","\n")
+	=

 	-- TODO : Display as TOOLTIP !
 	plaintext =3D UnicodeFix(plaintext)
 	AddFadeLines(sprintf("%s: %s",text_charname,plaintext)) -- TODO : color,f=
ont,...

Modified: trunk/data/lua/net/net.packethandlers.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.packethandlers.lua (original)
+++ trunk/data/lua/net/net.packethandlers.lua Sun Dec  2 12:07:55 2007
@@ -125,247 +125,76 @@
 	out:SendPacket()
 end
 =

+gAosToolTipHash =3D {}
+gAosToolTipText =3D {}
+function AosToolTip_GetHash (serial) return gAosToolTipHash[serial] end
+function AosToolTip_SetHash (serial,hash) gAosToolTipHash[serial] =3D hash=
 end
+function AosToolTip_GetText (serial) return gAosToolTipText[serial] end
+function AosToolTip_SetText (serial,text) gAosToolTipText[serial] =3D text=
 end
+
 -- Newer packet as of late 2004.
 -- Is now used on OSI to handle the Revision of Tooltips instead of the or=
iginal 0xBF methods it appears.
+-- server sends these automatically when a new object appears, doesn't hav=
e to be requested
 function gPacketHandler.kPacket_AOSObjProp()	--0xDC (9 bytes)
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
 	local objserial =3D input:PopNetUint32()			--Item/Mob-Serial
 	local objrevision_hash =3D input:PopNetUint32()
-	printdebug("net", sprintf("NET: AOSObjProp objserial=3D0x%08x objrevision=
_hash=3D0x%08x\n",
-								objserial,objrevision_hash) )
-	Send_AosToolTipRequest(objserial)
+	printdebug("net",sprintf("NET: AOSObjProp objserial=3D0x%08x objrevision_=
hash=3D0x%08x\n",objserial,objrevision_hash))
+	if (AosToolTip_GetHash(objserial) ~=3D objrevision_hash) then
+		print("Send_AosToolTipRequest",objserial,objrevision_hash)
+		AosToolTip_SetHash(objserial,objrevision_hash)
+		Send_AosToolTipRequest(objserial)
+	end
 end
 =

 -- Mega Cliloc - server sends new Clilocs - just add them to the Cliloc
 -- TODO : this cliloc additions might be local to a specific mobile, e.g. =
vendor or container...
 function gPacketHandler.kPacket_Mega_Cliloc()	--0xD6
-	local input =3D GetRecvFIFO()
-	local id =3D input:PopNetUint8()
-	local size =3D input:PopNetUint16()
-	local temp1 =3D input:PopNetUint16()			--0x0001 or 0x4000 !?
-	local item_serial =3D input:PopNetUint32()	--Serial of item/creature
-	local temp2 =3D input:PopNetUint16()			--0x0000 !?
-	local serial =3D input:PopNetUint32()	--Serial of item/creature in all te=
sts.
-												--This could be the serial of the item the entry to appear ove=
r!?
+	local input			=3D GetRecvFIFO()
+	local id			=3D input:PopNetUint8()
+	local size			=3D input:PopNetUint16()
+	local unknown1		=3D input:PopNetUint16()	--0x0001 or 0x4000 !?
+	local serial		=3D input:PopNetUint32()	--Serial of item/creature
+	local unknown2		=3D input:PopNetUint16()	--0x0000 !?
+	local unknown3		=3D input:PopNetUint32()	--another serial? hash? weird fl=
ags ? position ? 0x030c0ca3
+		-- unknown3 in old iris code : obj/character->SetAOSTooltipID(listID);
+	=

+	local totaltext =3D ""
+	local bFirst =3D true
+	=

 	while true do =

 		local cliloc_id =3D input:PopNetUint32()
 		if (cliloc_id =3D=3D hex2num("0x00000000")) then break end
+		local cliloctext =3D gClilocLoader and gClilocLoader:Get(cliloc_id) or ""
 		=

-		local cliloc_size =3D input:PopNetUint16()
-		local textline =3D ""
-		if (cliloc_size > 0) then
-			textline =3D input:PopUnicodeString(cliloc_size/2)			 =

-			gClilocLoader:Set(cliloc_id,textline) -- register in cliloc
+		local number_of_unicode_chars =3D input:PopNetUint16() / 2
+		local text =3D ""
+		local totalparamtext =3D ""
+		local debugtxt =3D ""
+		local params =3D {}
+		for i =3D 1,number_of_unicode_chars do  -- read unicode text and split b=
y 0x09 =3D tab
+			local head =3D input:PopUint8()
+			local data =3D input:PopUint8()
+			local c =3D ((head~=3D0) and string.char(head) or "?")
+			if (head =3D=3D 9 and data =3D=3D 0) then -- delimiter =3D tab=3D0x09
+				table.insert(params,text)
+				text =3D ""
+			else
+				text =3D text..c
+			end
+			totalparamtext =3D totalparamtext..c
+			debugtxt =3D debugtxt.."("..head..","..data..":"..c..")"
 		end
-		printf("NET: Mega_Cliloc : id=3D%d 0x%08x len=3D%d text=3D%s\n",cliloc_i=
d,cliloc_id,cliloc_size,textline)
+		table.insert(params,text)
+		=

+		local text =3D string.gsub(ParameterizedClilocText(cliloc_id,params),"<b=
r>","\n")
+		=

+		if (bFirst) then bFirst =3D false else totaltext =3D totaltext.."\n" end
+		totaltext =3D totaltext..text
+		--~ printf("NET: Mega_Cliloc LINE : text=3D'%s' clilocbase=3D'%s' totalp=
aramtext=3D'%s' debug=3D%s\n",text,cliloctext,totalparamtext,debugtxt)
 	end
-end
-
-
--- http://necrotoolz.sourceforge.net/kairpacketguide/packetd6.htm
--- 0x0009 as seperator for args
---[[
-void cClient::Act_AOSTooltip (cPacket * packet) // kPacket_Mega_Cliloc han=
dler
-{
-
-  if (!Config::GetAOSToolTips())
-    return;
-  if ( !Config::GetClilocs() )
-    return;
-  packet->SetPosition (5);
-  Uint32 id =3D packet->GetDword (); // corresponds to item_serial  in the=
 above code
-  Uint16 unkn =3D packet->GetWord ();
-  Uint32 listID =3D packet->GetDword (); // corresponds to serial  above
-  cCharacter *character =3D NULL;
-  cDynamicObject *obj =3D NULL;
-
-  character =3D pCharacterList.Get (id);
-  obj =3D pDynamicObjectList.Get (id);
-
-  if (character)
-      {
-        character->ClearAOSTooltip ();
-        character->SetAOSTooltipID (listID); --- unknown what this is for,=
 seems to always be =3D id
-      }
-  if (obj)
-      {
-        obj->ClearAOSTooltip ();
-        obj->SetAOSTooltipID (listID);
-      }
-
-  Uint32 clilocID;
-  do
-      {
-        clilocID =3D packet->GetDword ();
-        if (!clilocID)
-          break;
-
-        Uint16 textlen =3D packet->GetWord ();
-
-        char *arguments;
-        arguments =3D new char[textlen];
-        packet->GetData (arguments, textlen);
-
-        char *str2 =3D new char[(textlen / 2) + 1];
-        int idx2 =3D 0;
-        for (int i =3D 0; i < textlen; i++)
-            {
-              if (arguments[i] !=3D 0)
-                str2[i / 2] =3D arguments[i];
-            }
-        str2[textlen / 2] =3D 0;
-
-
-        vector < std::string > arglist;
-        std::string arg_string =3D std::string (str2);
-        char tab[2];
-        tab[0] =3D 9;
-        tab[1] =3D 0;
-        std::string delim =3D std::string (tab);
-
-
-        stringSplit (arglist, arg_string, delim);
-
-
-        std::string message =3D
-          pClilocLoader.GetMessageWithArguments ((int) clilocID,
-                                                  (int) arglist.size (),
-                                                  arglist);  -- see lib.cl=
iloc.lua for comment with the old code for this, =

-																 --- see also function gPacketHandler.kPacket_Localized_Te=
xt () in net.other.lua
-
-        if (character)
-          character->AddAOSTooltip (message);
-
-        if (obj)
-          obj->AddAOSTooltip (message);
-
-          delete[] str2;
-          delete[] arguments;
-      }
-  while (clilocID !=3D 0);
-
-}
-]]--
-
---[[
-std::string cClilocLoader::GetMessageWithArguments (int id, int args_num, =
vector < std::string > &args)
-{
-
-	vector < std::string > splitted_str;
-	std::string word;
-
-	std::string ret_msg =3D "";
-	std::string message =3D GetMessage (id);
-	char *tags =3D new char[message.size () + 1];
-	memset(tags,0,message.size ()+1);
-	strcpy (tags, message.c_str ());
-
-
-	char *tag =3D strtok (tags, "~~");
-
-	while (tag !=3D NULL)
-	{
-		char *copy_str =3D new char[strlen (tag) + 1];
-		copy_str[strlen (tag)] =3D 0;
-		strcpy (copy_str, tag);
-		splitted_str.push_back (string (copy_str));
-		tag =3D strtok (NULL, "~~");
-		delete[] copy_str;
-	}
-
-	int args_index =3D 0;
-	for (unsigned int i =3D 0; i < splitted_str.size (); i++)
-	{
-
-		word =3D splitted_str.at (i);
-
-		if (word.empty ())
-			continue;
-
-		char *newstr =3D (char *) word.c_str ();
-
-		if (((newstr[0] >=3D 0x30) && (newstr[0] <=3D 0x39)) && newstr[1] =3D=3D=
 95)
-		{
-			word =3D args.at (args_index);
-			args_index++;
-			if (word[0] =3D=3D 35)
-			{
-				std::string sub =3D word.substr (1);
-				int msgid =3D atoi (sub.c_str ());
-				word =3D GetMessage (msgid);
-			}
-		}
-		ret_msg +=3D word;
-		// HARKON: why delete?
-		// delete[] newstr;
-	}
-
-
-	delete[] tags;
-	delete[] tag;
-
-	return ret_msg;
-}
-]]--
-
-
---[[
-var tooltip =3D 0;
-
-net_onaostooltip(const id, const count, const x, const y)
-{
-//log("TOOLTIP");
-	control_close(tooltip);
-	=

-	if(id =3D=3D 0) {
-		control_close(tooltip);
-		//tooltip =3D 0;
-		return;
-	}
-
-	tooltip =3D gui_addcontainer(x+10,y+10,100,100);
-	=

-	if(tooltip > 6000000){
-		control_close(tooltip);
-		return;
-	}
-	=

-	gui_setcontainer(tooltip);
-	=

-	var gump =3D gui_addgump(0,0,0x588,0);
-
-	control_setsize(gump, 80, 15 * count);
-	control_setalpha(gump, 220);
-	gui_setcontainershape(gump);
-	=

-	var message, lab, highlight, labheight;
-	var maxsize =3D 0;
-	var yalign =3D 0;
-
-	for(var i =3D 0; i < count; i++) {
-		message =3D net_getaostooltip(id, i);
-//log("MSG: " + message);
-		highlight =3D char_gethighlighthue(id);
-		lab =3D gui_addlabel(1, yalign, message, 1);
-		var labsize =3D label_getwidth(lab);
-		labheight =3D label_getheight(lab);
-		if(labsize>maxsize)
-			maxsize =3D labsize;
-		=

-		if(i =3D=3D 0) {
-			if(highlight !=3D -1)
-				label_sethue(lab, highlight);
-			else
-				label_sethue(lab, 55);
-		}
-		=

-		yalign +=3D labheight + 2;
-	}
-
-	control_setsize(gump, maxsize + 1, (labheight + 2) * count);
-	control_setalpha(gump, 170);
-	gui_setcontainershape(gump);
-	gui_setcontainer();
-}
-]]--
+	printf("NET: Mega_Cliloc : serial=3D%d,%d text=3D'%s'\n",serial_1,serial_=
2,totaltext)
+	AosToolTip_SetText(serial_1,totaltext)
+end
+



From no-reply at zwischenwelt.org  Sun Dec  2 20:25:07 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 19:25:07 -0000
Subject: [Iris-commit] [IRIS] r1594 - in /trunk/data/lua: net.trade.lua
	net/net.packethandlers.lua
Message-ID: <20071202192507.AFE9D1C186E6@zwischenwelt.org>

Author: sience
Date: Sun Dec  2 20:25:06 2007
New Revision: 1594

Log:
-buff packet temp. disabled -> Ticket #173 (defect) created by Cougar
-font color changes

Modified:
    trunk/data/lua/net.trade.lua
    trunk/data/lua/net/net.packethandlers.lua

Modified: trunk/data/lua/net.trade.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.trade.lua (original)
+++ trunk/data/lua/net.trade.lua Sun Dec  2 20:25:06 2007
@@ -283,8 +283,8 @@
 	local browse_up2	=3D MakeGumpButton(		dialog_bill.rootwidget,hex2num("0x8=
24"), hex2num("0x824"), hex2num("0x824"),231, 49) =

 	local browse_down2	=3D MakeGumpButton(		dialog_bill.rootwidget,hex2num("0=
x825"), hex2num("0x825"), hex2num("0x825"),231,158)
 	local accept		=3D MakeGumpButton(		dialog_bill.rootwidget,hex2num("0x5c")=
 , hex2num("0x5c") , hex2num("0x5c") , 22,188)
-	dialog_bill.total	=3D guimaker.MakeText(	dialog_bill.rootwidget, 70, 173,=
"0",gFontGumpSize,{0,0,0,1.0}, nil, gFontNameDefault)
-	dialog_bill.gold 	=3D guimaker.MakeText(	dialog_bill.rootwidget,190, 173,=
GetPlayerGold(),gFontGumpSize,{0,0,0,1.0}, nil, gFontNameDefault)
+	dialog_bill.total	=3D guimaker.MakeText(	dialog_bill.rootwidget, 70, 173,=
"0",gFontGumpSize,{1.0,1.0,1.0,1.0}, nil, gFontNameDefault)
+	dialog_bill.gold 	=3D guimaker.MakeText(	dialog_bill.rootwidget,190, 173,=
GetPlayerGold(),gFontGumpSize,{1.0,1.0,1.0,1.0}, nil, gFontNameDefault)
 	browse_up2.onLeftClick		=3D function (widget) widget.dialog:PrevPage() end
 	browse_down2.onLeftClick	=3D function (widget) widget.dialog:NextPage() e=
nd
 	accept.onLeftClick			=3D function (widget) widget.dialog.uoShop:Accept() =
end
@@ -331,9 +331,9 @@
 		if (i >=3D pageoff and i < pageoff + perpage) then
 			local y =3D 60 * (i - pageoff)
 			local itemmodel	=3D MakeArtGumpPart(  dialog.rootwidget,					good.itema=
rtid,25, 75 + y, 0, 0, 0, good.itemhue)
-			local it_name 	=3D guimaker.MakeText(dialog.rootwidget, 80, 75 + y,		go=
od.name				, gFontGumpSize, {0,0,0,1.0}, gFontNameDefault)
-			local it_price 	=3D guimaker.MakeText(dialog.rootwidget, 80, 75 + y + 1=
2,	good.price .. " Gold"	, gFontGumpSize, {0,0,0,1.0}, gFontNameDefault)
-			local avail 	=3D guimaker.MakeText(dialog.rootwidget,210, 75 + y,		good=
.itemamount - good.tradeamount , gFontGumpSize, {0,0,0,1.0}, gFontNameDefau=
lt)
+			local it_name 	=3D guimaker.MakeText(dialog.rootwidget, 80, 75 + y,		go=
od.name				, gFontGumpSize, {1.0,1.0,1.0,1.0}, gFontNameDefault)
+			local it_price 	=3D guimaker.MakeText(dialog.rootwidget, 80, 75 + y + 1=
2,	good.price .. " Gold"	, gFontGumpSize, {1.0,1.0,1.0,1.0}, gFontNameDefau=
lt)
+			local avail 	=3D guimaker.MakeText(dialog.rootwidget,210, 75 + y,		good=
.itemamount - good.tradeamount , gFontGumpSize, {1.0,1.0,1.0,1.0}, gFontNam=
eDefault)
 			itemmodel.good =3D good
 			itemmodel.mbIgnoreMouseOver =3D false
 			itemmodel.onMouseDown =3D function (widget,mousebutton) if (mousebutton=
 =3D=3D 1) then widget.dialog.uoShop:AddToBill(widget.good,1) end end
@@ -373,8 +373,8 @@
 					=

 			local incr		=3D MakeGumpButton(	dialog.rootwidget, hex2num("0x37"), hex=
2num("0x37"), hex2num("0x37"), 170, 65 + y) =

 			local decr		=3D MakeGumpButton(	dialog.rootwidget, hex2num("0x38"), hex=
2num("0x38"), hex2num("0x38"), 195, 65 + y) =

-			local name		=3D guimaker.MakeText(dialog.rootwidget,70, 65 + y,good.nam=
e			,gFontGumpSize, {0,0,0,1.0}, gFontNameDefault) =

-			local amount	=3D guimaker.MakeText(dialog.rootwidget,30, 65 + y,good.tr=
adeamount	,gFontGumpSize, {0,0,0,1.0}, gFontNameDefault) =

+			local name		=3D guimaker.MakeText(dialog.rootwidget,70, 65 + y,good.nam=
e			,gFontGumpSize, {1.0,1.0,1.0,1.0}, gFontNameDefault) =

+			local amount	=3D guimaker.MakeText(dialog.rootwidget,30, 65 + y,good.tr=
adeamount	,gFontGumpSize, {1.0,1.0,1.0,1.0}, gFontNameDefault) =

 	=

 			incr.good =3D good
 			decr.good =3D good

Modified: trunk/data/lua/net/net.packethandlers.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.packethandlers.lua (original)
+++ trunk/data/lua/net/net.packethandlers.lua Sun Dec  2 20:25:06 2007
@@ -66,6 +66,7 @@
 ]]--
 =

 -- buff / debuff  (0xDF)
+--[[
 function gPacketHandler.kPacket_BuffDebuff_System()
 	local buffinfos =3D {}
 	local input =3D GetRecvFIFO()
@@ -113,10 +114,11 @@
 	=

 	print("spell buff packet received !!!!!!!!!!")
 end
+]]--
 =

 -- if clilochash is wrong, request new megacliloc tooltip from server
 -- used in function gPacketHandler.kPacket_AOSObjProp()  &  gPacketHandler=
.kPacket_Generic_Command()
-function Send_AosToolTipRequest(objserial)
+function Send_ToolTipRequest(objserial)
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_Generic_Command)
 	out:PushNetUint16(hex2num("0x0009"))
@@ -125,6 +127,21 @@
 	out:SendPacket()
 end
 =

+--Client -> Server: 0xD6 (AOSToolTip), frequ: 1, len: 0x07
+--word	- Packet Size
+--loop	- Item Info; count =3D (Packet Size-3)/4
+--dword	- Serial
+--endloop	- Item Info
+--[[
+function Send_AosToolTipRequest(objserial)
+	local out =3D GetSendFIFO()
+	out:PushNetUint8(kPacket_Mega_Cliloc)
+	out:PushNetUint16(hex2num("0x0007"))
+	out:PushNetUint32(objserial)
+	out:SendPacket()
+end
+]]--
+
 gAosToolTipHash =3D {}
 gAosToolTipText =3D {}
 function AosToolTip_GetHash (serial) return gAosToolTipHash[serial] end
@@ -142,9 +159,9 @@
 	local objrevision_hash =3D input:PopNetUint32()
 	printdebug("net",sprintf("NET: AOSObjProp objserial=3D0x%08x objrevision_=
hash=3D0x%08x\n",objserial,objrevision_hash))
 	if (AosToolTip_GetHash(objserial) ~=3D objrevision_hash) then
-		--~ print("Send_AosToolTipRequest",objserial,objrevision_hash)
+		--~ print("Send_ToolTipRequest",objserial,objrevision_hash)
 		AosToolTip_SetHash(objserial,objrevision_hash)
-		Send_AosToolTipRequest(objserial)
+		Send_ToolTipRequest(objserial)
 	end
 end
 =

@@ -194,7 +211,7 @@
 		totaltext =3D totaltext..text
 		--~ printf("NET: Mega_Cliloc LINE : text=3D'%s' clilocbase=3D'%s' totalp=
aramtext=3D'%s' debug=3D%s\n",text,cliloctext,totalparamtext,debugtxt)
 	end
-	printf("NET: Mega_Cliloc : serial=3D%d u3=3D%d text=3D'%s'\n",serial,unkn=
own3,totaltext)
+	printdebug("net", sprintf("NET: Mega_Cliloc : serial=3D%d u3=3D%d text=3D=
'%s'\n",serial,unknown3,totaltext) )
 	AosToolTip_SetText(serial,totaltext)
 end
 =




From no-reply at zwischenwelt.org  Sun Dec  2 20:48:26 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 02 Dec 2007 19:48:26 -0000
Subject: [Iris-commit] [IRIS] r1595 -
	/trunk/data/models/materials/armoire.material
Message-ID: <20071202194826.E8A931C182B3@zwischenwelt.org>

Author: sience
Date: Sun Dec  2 20:48:26 2007
New Revision: 1595

Log:
-small mat change

Modified:
    trunk/data/models/materials/armoire.material

Modified: trunk/data/models/materials/armoire.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/armoire.material (original)
+++ trunk/data/models/materials/armoire.material Sun Dec  2 20:48:26 2007
@@ -5,13 +5,15 @@
 	{
 		pass
 		{
-			//lighting on
+			lighting on
 			ambient 1.0 1.0 1.0
 			diffuse 1.0 1.0 1.0
 			=

+			cull_hardware clockwise
+			cull_software back
 			// needed for xmirror fix
-			//cull_hardware anticlockwise
-			//cull_software front
+			//cull_hardware none
+			//cull_software none
 			=

 			texture_unit
 			{
@@ -29,13 +31,15 @@
 	{
 		pass
 		{
-			//lighting on
+			lighting on
 			ambient 1.0 1.0 1.0
 			diffuse 1.0 1.0 1.0
 			=

+			cull_hardware clockwise
+			cull_software back
 			// needed for xmirror fix
-			//cull_hardware anticlockwise
-			//cull_software front
+			//cull_hardware none
+			//cull_software none
 			=

 			texture_unit
 			{



From no-reply at zwischenwelt.org  Mon Dec  3 17:22:11 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 03 Dec 2007 16:22:11 -0000
Subject: [Iris-commit] [IRIS] r1596 - in /trunk/data/lua:
 gui/gui.paperdoll.lua net.popup.lua obj/obj.container.lua
Message-ID: <20071203162212.00BA91C186E6@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Dec  3 17:22:11 2007
New Revision: 1596

Log:
added workaround for tooltipps size calc bug, added rightclick walk on cont=
ext menu request timeout

Modified:
    trunk/data/lua/gui/gui.paperdoll.lua
    trunk/data/lua/net.popup.lua
    trunk/data/lua/obj/obj.container.lua

Modified: trunk/data/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/gui/gui.paperdoll.lua (original)
+++ trunk/data/lua/gui/gui.paperdoll.lua Mon Dec  3 17:22:11 2007
@@ -274,7 +274,7 @@
 	=

 	widget.tooltip_offx =3D kUOToolTippOffX
 	widget.tooltip_offy =3D kUOToolTippOffY
-	widget.on_simple_tooltip =3D function (widget) return AosToolTip_GetText(=
widget.item.serial) or "?" end
+	widget.on_simple_tooltip =3D function (widget) return (AosToolTip_GetText=
(widget.item.serial).." \n ") or "?" end -- add newline, workaround for too=
ltip sizecalc bug
 end
 =

 =


Modified: trunk/data/lua/net.popup.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.popup.lua (original)
+++ trunk/data/lua/net.popup.lua Mon Dec  3 17:22:11 2007
@@ -10,17 +10,23 @@
 gDefaultPopupMenuTextColorHi =3D {0,1,0,1.0} -- green
 gPopupMenuSavedPosX,gPopupMenuSavedPosY =3D 0,0
 =

---- true if the client is waiting for a context menu to display
-gPopupRequestRunning =3D false
 --- global popup menu info, only one at a time should be displayed
 gPopupMenu =3D nil
+gRunningPopupRequestTimeOut =3D nil
+kRunningPopupRequestTimeOutInterval =3D 500
+
+RegisterListener("EveryFrame",function () =

+		if (gRunningPopupRequestTimeOut and gMyTicks > gRunningPopupRequestTimeO=
ut) then
+			gLastRightClickSerial =3D nil -- enable walking during right-press =

+			-- in the case that right-clicking on dynamic floor tile on vetus mundu=
s does not open a context menu
+		end
+	end)
 =

 -- triggers -- which came from kPacket_Generic_SubCommand_DisplayPopup
 function Send_PopupRequest (serial)
-	--- is there a request running? if yes ignore this request
-	if gPopupRequestRunning =3D=3D true then return end
 	--- if there is already one open, close it
 	if gPopupMenu ~=3D nil then gPopupMenu:Close() end
+	gRunningPopupRequestTimeOut =3D gMyTicks + kRunningPopupRequestTimeOutInt=
erval
 =

 	gPopupMenuSavedPosX,gPopupMenuSavedPosY =3D GetMousePos() -- TODO : maybe=
 save mousepos at the time of contextrequest ?
 	local out =3D GetSendFIFO()
@@ -73,9 +79,8 @@
 -- TODO : check if popupmenu is already opened for this mobile ! (otherwis=
e it would be opened twice)
 function DisplayPopupMenu (popupmenu)
 	if (not gGumpLoader) then return end
-
-	--- no request running anymore
-	gPopupRequestRunning =3D false
+	gRunningPopupRequestTimeOut =3D nil
+
 	-- update global entry
 	gPopupMenu =3D popupmenu
 	=


Modified: trunk/data/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.container.lua (original)
+++ trunk/data/lua/obj/obj.container.lua Mon Dec  3 17:22:11 2007
@@ -215,10 +215,10 @@
 	=

 	widget.tooltip_offx =3D kUOToolTippOffX
 	widget.tooltip_offy =3D kUOToolTippOffY
-	widget.on_simple_tooltip =3D function (widget) return AosToolTip_GetText(=
widget.item.serial) or "?" end
-end
-
-
-
-
-
+	widget.on_simple_tooltip =3D function (widget) return (AosToolTip_GetText=
(widget.item.serial).." \n ") or "?" end -- add newline, workaround for too=
ltip sizecalc bug
+end
+
+
+
+
+



From no-reply at zwischenwelt.org  Mon Dec  3 19:08:09 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 03 Dec 2007 18:08:09 -0000
Subject: [Iris-commit] [IRIS] r1597 - in /trunk: data/lua/net.buff.lua
 data/lua/net/net.packethandlers.lua premake.lua
Message-ID: <20071203180810.0DE591C182F9@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Dec  3 19:08:08 2007
New Revision: 1597

Log:
fixed emotes menu exception crash (setmaterial trycatch block) , premake no=
w uses a mylugre dir override if present, moved buff code to data/lua/net.b=
uff.lua

Added:
    trunk/data/lua/net.buff.lua
Modified:
    trunk/data/lua/net/net.packethandlers.lua
    trunk/premake.lua

Modified: trunk/data/lua/net/net.packethandlers.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.packethandlers.lua (original)
+++ trunk/data/lua/net/net.packethandlers.lua Mon Dec  3 19:08:08 2007
@@ -31,90 +31,6 @@
 	local unknown2 =3D input:PopNetUint16()
 	NotifyWarmode(flag)
 end
-
---[[
-Buff/DeBuff System
---------------------
-http://update.uo.com/design_523.html
-
-Packet Build:
-BYTE[1] Cmd					-- 0xDF
-BYTE[2] Length =

-BYTE[4] Serial of player =

-
-BYTE[2] Icon Number to show =

-BYTE[2] 0x1 =3D Show, 0x0 =3D Remove. On remove byte, packet ends here. =

-BYTE[4] 0x00000000
-
-BYTE[2] Icon Number to show. =

-BYTE[2] 0x1 =3D Show =

-BYTE[4] 0x00000000
-
-BYTE[2] Buff Duration in seconds - Time in seconds (simple countdown witho=
ut automatic remove) =

-BYTE[2] 0x0000 =

-BYTE[1] 0x00 =

-BYTE[4] Buff Title Cliloc - Cliloc ID of title of icon. =

-BYTE[4] Buff Secondary Cliloc - Cliloc ID for the Description of the icon.=
 If no arguments for cliloc, then add 10 more bytes 0x00000000000000000000 =
and end packet =

-BYTE[4] 0x00000000 =

-BYTE[2] 0x00 01			-Arguments Mode
-
-BYTE[2] 0x00 00			-If (Arguments Mode =3D 0x01)
-BYTE[len(str)*2] Flipped Unicode String (" "+str) (To seperate the entrys =
add " ") =

-BYTE[2] 0x00 01			-EndIf Arguments Mode
-
-BYTE[2] 0x00 00			-EndIf Type
-]]--
-
--- buff / debuff  (0xDF)
---[[
-function gPacketHandler.kPacket_BuffDebuff_System()
-	local buffinfos =3D {}
-	local input =3D GetRecvFIFO()
-	local id =3D input:PopNetUint8()
-	local packetsize =3D input:PopNetUint16()
-
-	buffinfos.player_serial	=3D input:PopNetUint32()
-	buffinfos.icon_artid1		=3D input:PopNetUint16()
-	buffinfos.icon_show1		=3D input:PopNetUint16()
-	buffinfos.temp1			=3D input:PopNetUint32()
-
-	if (packetsize > 15) then
-		buffinfos.icon_artid2		=3D input:PopNetUint16()			-- ??
-		buffinfos.icon_show2		=3D input:PopNetUint16()
-		buffinfos.temp2			=3D input:PopNetUint32()
-	=

-		buffinfos.buff_duration	=3D input:PopNetUint16()
-	=

-		buffinfos.temp3			=3D input:PopNetUint16()
-		buffinfos.temp4			=3D input:PopNetUint8()
-	=

-		buffinfos.clilocid1		=3D input:PopNetUint32()
-		buffinfos.clilocid2		=3D input:PopNetUint32()
-	=

-		buffinfos.temp5			=3D input:PopNetUint32()
-	=

-		buffinfos.argumentsmode_start	=3D input:PopNetUint16()
-	=

-		buffinfos.argumentsmode_startif	=3D input:PopNetUint16()
-	=

-		if (buffinfos.argumentsmode_start =3D=3D 1) then
-	=

-			local argument_string =3D ""
-			repeat
-				local argument_char	=3D input:PopNetUint8()
-				argument_string =3D argument_string..argument_char
-				print(argument_char)
-			until (argument_char =3D=3D 1)
-			=

-			print(argument_string)
-		end
-	=

-		buffinfos.argumentsmode_end		=3D input:PopNetUint16()
-	end
-	=

-	print("spell buff packet received !!!!!!!!!!")
-end
-]]--
 =

 -- if clilochash is wrong, request new megacliloc tooltip from server
 -- used in function gPacketHandler.kPacket_AOSObjProp()  &  gPacketHandler=
.kPacket_Generic_Command()

Modified: trunk/premake.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/premake.lua (original)
+++ trunk/premake.lua Mon Dec  3 19:08:08 2007
@@ -10,7 +10,10 @@
 addoption("wall","very verbose report, most warnings enabled")
 if (options["wall"]) then gbExtraWarnings =3D true print("extra warnings e=
nabled") end
 =

-gLugreLuaSrcDir =3D "./lugre/lib/lua-5.0.3/"
+gLugreDir =3D "lugre"
+if (io.open("mylugre/lua/lugre.lua")) then print("using mylugre dir overri=
de") gLugreDir =3D "mylugre" end
+
+gLugreLuaSrcDir =3D "./"..gLugreDir.."/lib/lua-5.0.3/"
 =

 -- list of easy libs inclusion (located in lugre/lib/NAME). this will add =
lugre/lib/NAME/src and lugre/lib/NAME/include.
 gLugreLibList =3D {
@@ -84,10 +87,10 @@
 package.buildflags =3D { gbExtraWarnings and "extra-warnings" or nil, "opt=
imize" }
 package.buildoptions =3D {}
 =

-package.includepaths =3D { "lugre/include", gLugreLuaSrcDir.."/include/", =
"include" }
+package.includepaths =3D { gLugreDir.."/include", gLugreLuaSrcDir.."/inclu=
de/", "include" }
 -- add lib includes
 for k,v in pairs(gLugreLibList) do =

-	table.insert(package.includepaths, "lugre/lib/"..v.."/include/") =

+	table.insert(package.includepaths, gLugreDir.."/lib/"..v.."/include/") =

 end
 =

 package.linkoptions =3D {}
@@ -97,7 +100,7 @@
 	"USE_OPENAL",
 	"MAIN_WORKING_DIR=3D\\\"..\\\"",
 	"LUA_DIR=3D\\\"lua\\\"",
-	"LUGRE_DIR=3D\\\"lugre\\\"",
+	"LUGRE_DIR=3D\\\""..gLugreDir.."\\\"",
 	"DATA_DIR=3D\\\"data\\\"",
 	"ENABLE_THREADS",
 }
@@ -118,15 +121,15 @@
 addcustomlib(package,"boost_thread-mt")
 =

 package.files =3D {
-  matchrecursive("lugre/include/*.h", "lugre/src/*.cpp"),
+  matchrecursive(gLugreDir.."/include/*.h", gLugreDir.."/src/*.cpp"),
   matchrecursive("include/*.h", "src/*.cpp"),
 }
 =

 -- add lib src
 for k,v in pairs(gLugreLibList) do =

-	table.insert(package.files, matchrecursive("lugre/lib/"..v.."/include/*.h=
")) =

-	table.insert(package.files, matchrecursive("lugre/lib/"..v.."/src/*.cpp")=
) =

-	table.insert(package.files, matchrecursive("lugre/lib/"..v.."/src/*.c")) =

+	table.insert(package.files, matchrecursive(gLugreDir.."/lib/"..v.."/inclu=
de/*.h")) =

+	table.insert(package.files, matchrecursive(gLugreDir.."/lib/"..v.."/src/*=
.cpp")) =

+	table.insert(package.files, matchrecursive(gLugreDir.."/lib/"..v.."/src/*=
.c")) =

 end
 =

 =




From no-reply at zwischenwelt.org  Mon Dec  3 19:26:32 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 03 Dec 2007 18:26:32 -0000
Subject: [Iris-commit] [IRIS] r1598 - in /trunk/data/lua: net.buff.lua
 net/net.buff.lua net/net.main.lua
Message-ID: <20071203182634.1F87B1C186E6@zwischenwelt.org>

Author: sience
Date: Mon Dec  3 19:26:32 2007
New Revision: 1598

Log:
-net.buff.lua moved to net directory

Added:
    trunk/data/lua/net/net.buff.lua
Removed:
    trunk/data/lua/net.buff.lua
Modified:
    trunk/data/lua/net/net.main.lua

Modified: trunk/data/lua/net/net.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.main.lua (original)
+++ trunk/data/lua/net/net.main.lua Mon Dec  3 19:26:32 2007
@@ -9,6 +9,7 @@
 dofile(libpath .. "net/net.sound.lua")
 dofile(libpath .. "net/net.login.lua")
 dofile(libpath .. "net/net.skill.lua")
+--dofile(libpath .. "net.buff.lua")
 =

 -- only things that have at least 2 packets get its own file, everything e=
lse is handled here:
 dofile(libpath .. "net/net.packethandlers.lua")



From no-reply at zwischenwelt.org  Mon Dec  3 20:58:51 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 03 Dec 2007 19:58:51 -0000
Subject: [Iris-commit] [IRIS] r1599 - in /trunk/data/lua: lib.3d.dynamic.lua
 lib.3d.map.lua lib.fallback.lua lib.keybinds.lua lib.mainmenu.lua
 lib.static.lua
Message-ID: <20071203195852.CAA401C182F9@zwischenwelt.org>

Author: sience
Date: Mon Dec  3 20:58:50 2007
New Revision: 1599

Log:
-small fixes for mesh loading
-some obsolete keybindings removed
-some billboard functions disabled

Modified:
    trunk/data/lua/lib.3d.dynamic.lua
    trunk/data/lua/lib.3d.map.lua
    trunk/data/lua/lib.fallback.lua
    trunk/data/lua/lib.keybinds.lua
    trunk/data/lua/lib.mainmenu.lua
    trunk/data/lua/lib.static.lua

Modified: trunk/data/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.dynamic.lua (original)
+++ trunk/data/lua/lib.3d.dynamic.lua Mon Dec  3 20:58:50 2007
@@ -126,6 +126,8 @@
 						item.zadd =3D self.gDynamicZAdd
 					end
 				end
+			else
+				item.gfx:SetCastShadows(gDynamicsCastShadows)	-- groundtiles and item =
billboards shouldn't cast shadows
 			end
 			-- --------------------------------------------------------------------=
-----
 =


Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Mon Dec  3 20:58:50 2007
@@ -122,7 +122,7 @@
 	=

 	-- load ground
 	if (gGroundBlockLoader) then -- probably needs gTexMapLoader
-		--local meshname =3D BuildTerrainEntity_Simple(gGroundBlockLoader,iBlock=
UO_X,iBlockUO_Y,self.ROBMAP_CHUNK_SIZE,self.ROBMAP_CHUNK_SIZE,false)
+--		local meshname =3D BuildTerrainEntity_Simple(gGroundBlockLoader,iBlock=
UO_X,iBlockUO_Y,self.ROBMAP_CHUNK_SIZE,self.ROBMAP_CHUNK_SIZE,false)
 		local meshname =3D BuildTerrainEntity_Shaded(gGroundBlockLoader,iBlockUO=
_X,iBlockUO_Y,self.ROBMAP_CHUNK_SIZE,self.ROBMAP_CHUNK_SIZE)
 		if (meshname) then
 			chunk.sTerrainMeshName =3D meshname
@@ -157,9 +157,9 @@
 				gStaticBlockLoader:Load(iBlockUO_X+x,iBlockUO_Y+y)
 				local iStaticCount =3D gStaticBlockLoader:Count() -- operates on the b=
lock that was last loaded using :Load()
 =

-				printdebug("static","iStaticCount=3D"..iStaticCount)
-				printdebug("static","iBlockUO_X=3D"..iBlockUO_X.." iBlockUO_Y=3D"..iBl=
ockUO_Y)
-				printdebug("static","BlockX=3D"..x.." BlockY=3D"..y)
+				--printdebug("static","iStaticCount=3D"..iStaticCount)
+				--printdebug("static","iBlockUO_X=3D"..iBlockUO_X.." iBlockUO_Y=3D"..i=
BlockUO_Y)
+				--printdebug("static","BlockX=3D"..x.." BlockY=3D"..y)
 =

 				for i =3D 0,iStaticCount-1 do
 					iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i) -- oper=
ates on the block that was last loaded using :Load()
@@ -181,10 +181,10 @@
 					entity.iTileTypeID =3D iTileTypeID
 					entity.iHue =3D iHue
 					=

-					meshname =3D (not gForceFallBackBillboards_Statics) and GetStaticMesh=
Name(iTileTypeID,iHue)
+					meshname =3D (not gForceFallBackBillboards_Statics) and GetStaticMesh=
Name(iTileTypeID,entity.iHue)
 					=

 					-- create Mesh
-					if (meshname and meshname ~=3D "" and (not MeshIsPseudoBillBoard(iTil=
eTypeID))) then
+					if (meshname and meshname ~=3D false) then 	--and (not MeshIsPseudoBi=
llBoard(iTileTypeID))) then	--currently disabled
 						entity.staticentity =3D CreateMeshEntity(meshname)
 						local qw,qx,qy,qz =3D GetStaticMeshOrientation(iTileTypeID)
 						local sx,sy,sz =3D -1,1,1 -- scale
@@ -206,21 +206,36 @@
 						-- apply x mirror
 						myLayerStaticGeom:AddEntity(entity.staticentity,entity.x,entity.y,en=
tity.z,qw,qx,qy,qz,sx,sy,sz)
 						table.insert(chunk.lStaticEntities,entity)
-
-					-- or Fallback to billboard with original art
-					elseif (gEnableFallBackBillboards_Statics) then					=

+--[[
+--------------------------------------------------------------------------=
---------------------------------------------------
+					elseif (gEnableCanduneTreegeneration_Statics) then
+						if (iTileTypeID =3D=3D 3296) then
+							print("generate tree")
+							local p =3D CreateCaduneTreeParameters()
+							local s =3D CreateCaduneTreeStem(p)
+							s:Grow()
+							entity.gfx =3D s:CreateGeometry()
+
+							entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,enti=
ty.yloc+0.5,entity.zloc*0.1)
+							entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
+							entity.gfx:SetPosition(entity.x,entity.y,entity.z)
+							entity.gfx:SetScale(0.4,0.4,0.5)
+							entity.gfx:SetNormaliseNormals(true)
+						end
+--------------------------------------------------------------------------=
---------------------------------------------------
+]]--
+					-- if no *.mesh is available, a fallback billboard with original uo_a=
rt is generated
+					elseif (gEnableFallBackBillboards_Statics) then
 						local iTranslatedTileTypeID =3D SeasonalStaticTranslation(iTileTypeI=
D, gSeasonSetting)
-						-- we have to add 16384 for fallbacks
-						iTranslatedTileTypeID =3D iTranslatedTileTypeID + 16384
-
 						if (not IsArtBillboardFallBackSkipped(iTileTypeID)) then
 							entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+0.5,en=
tity.yloc+0.5,entity.zloc*0.1 + 0.5)
 							entity.gfx =3D CreateRootGfx3D()
 							entity.gfx:SetPosition(entity.x,entity.y,entity.z)
 							entity.gfx.billboard =3D entity.gfx:CreateChild()
-							self:CreateArtBillBoard(entity.gfx.billboard,iTranslatedTileTypeID,=
iHue)
+							-- we have to add 16384 for fallbacks
+							self:CreateArtBillBoard(entity.gfx.billboard,iTranslatedTileTypeID =
+ 16384,iHue)
 							table.insert(chunk.lStaticEntities,entity)
-							-- TODO : printdebug("missing",sprintf("Renderer3D:missing static :=
 artid=3D%i z_typename=3D%s\n",item.artid or -1,item.z_typename or ""))
+							printdebug("missing",sprintf("Fallback: generated : iTranslatedTile=
TypeID=3D%i\n", iTranslatedTileTypeID))
 						end
 					end
 =


Modified: trunk/data/lua/lib.fallback.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.fallback.lua (original)
+++ trunk/data/lua/lib.fallback.lua Mon Dec  3 20:58:50 2007
@@ -36,16 +36,6 @@
 	-- hide existing statics (requires map rebuild)
 	gCurrentRenderer:ClearMapCache()
 end
-
-function MeshIsPseudoBillBoard (iTranslatedTileTypeID) =

-	if (true) then return false end -- disabled for now
-	local i =3D iTranslatedTileTypeID
-	local meshname =3D GetStaticMeshName(i)
-	return CountMeshTriangles(meshname) < 4 and HasModelOnlyOneUoArt_Cached(i=
) -- hagish
-	--return CountMeshTriangles(meshname) <=3D 2 and HasModelOnlyOneUoArt_Cac=
hed(i) -- ghouly
-end
-
-
 =

 function ShowFallBackTool (x,y,z,radius)
 	if (gCurrentRenderer ~=3D Renderer3D) then return end

Modified: trunk/data/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.keybinds.lua (original)
+++ trunk/data/lua/lib.keybinds.lua Mon Dec  3 20:58:50 2007
@@ -1,5 +1,3 @@
-
-
 function BindGeneralKeys ()
 	Bind("escape",	function (state) =

 			if (state > 0) then =

@@ -11,6 +9,7 @@
 			end =

 		end)
 end
+
 BindGeneralKeys()
 =

 function BindInGameKeys()
@@ -18,9 +17,9 @@
 	gLastCursor =3D 0
 	BindGeneralKeys()
 	=

-     -- most keybinds have been moved to the macrosystem, see data/mymacro=
s.lua
+    -- most keybinds have been moved to the macrosystem, see data/mymacros=
.lua
 =

-     -- chatline
+    -- chatline
 	Bind("return",	function (state) if (state > 0) then ChatLine_ToggleActive=
() end end)
 	=

 	-- additional movement key handling in lib.tilefreewalk (for pressed keys)
@@ -29,13 +28,6 @@
 	Bind("down",    function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else ChatLine_HistoryUpDown(-1) end end) =

 	Bind("up",      function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else ChatLine_HistoryUpDown(1) end end)
 	=

-	=

-	--~ Bind("m",		function (state) if (not gActiveEditText) then if (state >=
 0) then
-		--~ local player=3DGetMobile(gPlayerBodySerial)
-		--~ if player then player:DisplayTextOverHead("bla bla bla",10,10,10) end
-	--~ end end end)
-	=

-	-- debug and testing...
 	-------------------------------------------------------------------------=
----------
 	Bind("f7",		function (state) if (not gActiveEditText) then if (state > 0)=
 then
 		if (gAmbientLight.r < 1.0) then
@@ -62,18 +54,11 @@
 		Client_SetAmbientLight(gAmbientLight.r, gAmbientLight.g, gAmbientLight.b=
, 1)
  	end end end)
 	Bind("f9",		function (state) if (not gActiveEditText) then if (state > 0)=
 then
-		local vp =3D OgreAddCompositor(GetMainViewport(), "EdgeDetection")
+		local vr =3D OgreAddCompositor(GetMainViewport(), "B&W")
 	 end end end)
 =

 	if (false) then
 		local commandchar =3D "["
-		-- runuo macros useful for testing
-		Bind("f1",		function (state) if (not gActiveEditText) then if (state > 0=
) then =

-			--Send_Speech("[set Hits 12000 self") =

-			Send_Speech(commandchar.."self set Hits 12000") =

-			--local playermobile =3D GetPlayerMobile()
-			--if (playermobile) then  gAutoTargetMobile =3D playermobile  end =

-		end end end)
 		Bind("f2",		function (state) if (not gActiveEditText) then if (state > 0=
) then =

 			local mobile =3D GetPlayerMobile()
 			if mobile then
@@ -97,14 +82,5 @@
 				gCurrentRenderer:AddEffect(effect)
 			end
 		end end end)
-		Bind("f3",		function (state) if (not gActiveEditText) then if (state > 0=
) then Send_Speech(commandchar.."add wallofstoneeast") end end end)
-		Bind("f4",		function (state) if (not gActiveEditText) then if (state > 0=
) then Send_Speech(commandchar.."remove") end end end)
-		Bind("f5",		function (state) if (not gActiveEditText) then if (state > 0=
) then Send_Speech(commandchar.."tele") end end end)
-		Bind("f6",		function (state) if (not gActiveEditText) then if (state > 0=
) then Send_Speech(commandchar.."set Hits 12000") end end end)
-		Bind("f7",		function (state) if (not gActiveEditText) then if (state > 0=
) then Send_Speech(commandchar.."resurrect") end end end)
-		Bind("f8",		function (state) if (not gActiveEditText) then if (state > 0=
) then Send_Speech(commandchar.."kill") end end end)
-		Bind("f9",		function (state) if (not gActiveEditText) then if (state > 0=
) then Send_Speech(commandchar.."admin") end end end)
-		--Bind("f10",		function (state) if (not gActiveEditText) then if (state =
> 0) then Send_Speech(commandchar.."props") end end end)
-		--Bind("f11",		function (state) if (not gActiveEditText) then if (state =
> 0) then Send_Speech(commandchar.."add") end end end)
 	end
 end

Modified: trunk/data/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.mainmenu.lua (original)
+++ trunk/data/lua/lib.mainmenu.lua Mon Dec  3 20:58:50 2007
@@ -137,11 +137,15 @@
 		})
 	end end
 	-- char creation (TODO)
-	for k,v in pairs(templates) do if (v.Name =3D=3D "Warrior" or v.Name =3D=
=3D "Mage" or v.Name =3D=3D "Blacksmith") then
-		table.insert(rows,{
-			{type=3D"Button",onLeftClick=3DMyCreateCharTemplatePicker,chartemplate=
=3Dv,text=3D"Create "..v.Name}
-		})
-	end	end
+	for k,v in pairs(templates) do
+		if (v.Name =3D=3D "Samurai" or v.Name =3D=3D "Ninja" or v.Name =3D=3D "P=
aladin" or
+			v.Name =3D=3D "Necromancer" or v.Name =3D=3D "Warrior" or v.Name =3D=3D=
 "Mage" or
+			v.Name =3D=3D "Blacksmith") then
+			table.insert(rows,{
+				{type=3D"Button",onLeftClick=3DMyCreateCharTemplatePicker,chartemplate=
=3Dv,text=3D"Create "..v.Name}
+			})
+		end
+	end
 	-- TODO : custom char creation
 	=

 	local MyGoBack =3D function(widget)

Modified: trunk/data/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.static.lua (original)
+++ trunk/data/lua/lib.static.lua Mon Dec  3 20:58:50 2007
@@ -1,5 +1,25 @@
 -- used by lib.map.lua
 -- handles static models (walls, trees...)
+
+--[[
+-- currently not used by function MeshIsPseudoBillBoard
+gHasModelOnlyOneUoArtCache =3D {}
+function HasModelOnlyOneUoArt_Cached (iTileTypeID)
+	local res =3D gHasModelOnlyOneUoArtCache[iTileTypeID]
+	if (res ~=3D nil) then return res end
+	res =3D HasModelOnlyOneUoArt(iTileTypeID)
+	gHasModelOnlyOneUoArtCache[iTileTypeID] =3D res
+	return res
+end
+
+-- currently not used : calculates, if a *.mesh is a simple billboard
+function MeshIsPseudoBillBoard (iTranslatedTileTypeID) =

+	local i =3D iTranslatedTileTypeID
+	local meshname =3D GetStaticMeshName(i)
+	return CountMeshTriangles(meshname) < 4 and HasModelOnlyOneUoArt_Cached(i=
) -- hagish
+	--return CountMeshTriangles(meshname) <=3D 2 and HasModelOnlyOneUoArt_Cac=
hed(i) -- ghouly
+end
+]]--
 =

 -- returns the model name with the given id
 -- TODO handle custom stuff?
@@ -15,21 +35,21 @@
 =

 	local base =3D id - math.mod(id,1000) + 1000
 	local relpath  =3D sprintf("models/to_%06d/mdl_%06d.mesh",base,id)
+
 	local custompath =3D datapath.."custom/"..relpath
-	if file_exists(custompath) then gCustomModelCache[id] =3D custompath  ret=
urn custompath end
+	if file_exists(custompath) then
+		gCustomModelCache[id] =3D custompath
+		return custompath
+	end
 =

 	local meshpath =3D datapath.."models/"..relpath
-	gCustomModelCache[id] =3D meshpath  =

+	if file_exists(meshpath) then
+		gCustomModelCache[id] =3D meshpath
+	else
+		gCustomModelCache[id] =3D false
+		meshpath =3D nil
+	end
 	return meshpath
-end
-
-gHasModelOnlyOneUoArtCache =3D {}
-function HasModelOnlyOneUoArt_Cached (iTileTypeID)
-	local res =3D gHasModelOnlyOneUoArtCache[iTileTypeID]
-	if (res ~=3D nil) then return res end
-	res =3D HasModelOnlyOneUoArt(iTileTypeID)
-	gHasModelOnlyOneUoArtCache[iTileTypeID] =3D res
-	return res
 end
 =

 -- returns true if the model has only one different material that is a uoa=
rt
@@ -69,57 +89,52 @@
 function GetStaticMeshName (iTileTypeID,iHue)
 	-- hue default value is 0
 	iHue =3D tonumber(iHue) or 0
-
 	--1st: Seasonal Translation
 	local iTranslatedTileTypeID =3D SeasonalStaticTranslation(iTileTypeID, gS=
easonSetting)
-
 	-- FILTER: map Mesh to other Mesh
 	iTranslatedTileTypeID =3D FilterMesh(iTranslatedTileTypeID)
-
 	-- FILTER: static water
 	iTranslatedTileTypeID,iHue =3D FilterStaticWater(iTranslatedTileTypeID, i=
Hue)
 =

 	local meshname =3D gLegacyModelCache[iTranslatedTileTypeID.."_"..iHue]
-
 	if (meshname =3D=3D nil) then
 		if (not meshname) then
 			meshname =3D GetModelName(iTranslatedTileTypeID) -- "mdl_"..iTranslated=
TileTypeID..".mesh"
 		end
 =

-		-- mesh available?
-		printdebug("static","query model",meshname)
-
+		-- if no *.mesh is available -> set mesh as not available in cache
 		if not OgreMeshAvailable(meshname) then =

-			printdebug("static","mesh not available",meshname)
-			meshname =3D false	-- set mesh as not available
+			printdebug("static","mesh not available ",meshname)
+			printdebug("static","mesh set to false")
+			meshname =3D false
 		else =

-			printdebug("static","Static Meshloader:",iTranslatedTileTypeID,iHue,mes=
hname)
-
-			if (gManualArtMaterialLoader) then
-				-- create unavailable uo_art_ID materials
+			printdebug("static","Meshloader:",iTranslatedTileTypeID,iHue,meshname)
+			-- create unavailable uo_art material
+			if (gArtMapLoader and gManualArtMaterialLoader) then
 				local path =3D GetModelPath(iTranslatedTileTypeID)
-				printdebug("static","meshname",meshname,"path",path)
 				local t =3D OgreMeshTextures(path) -- datapath.."models/models/mesh/".=
.meshname)
 				for k,v in pairs(t) do =

-					printdebug("static","texture found",v)
+					printdebug("static","Meshloader : texture found",v)
 					gManualArtMaterialLoader:CreateMatchingIfUnavailable(v)
 				end
+			else
+				-- set false, if no ui_art material can be created
+				meshname =3D false
 			end
 =

-			-- Hue this Model | TODO : Partitial Hue
-			if (gHueLoader) then
+			-- Hue this Model | TODO : Partitial Hue is currently skipped
+			if (gHueLoader and meshname ~=3D false) then
 				if( TestBit(GetStaticTileTypeFlags(iTileTypeID) or 0,kTileDataFlag_Par=
tial_Hue) ) then
-					printdebug("static","parthuedmodel=3D",iTileTypeID)		-- don't use iTr=
anslatedTileTypeID here, because of waterhack
+					-- don't use iTranslatedTileTypeID here, because of waterhack
+					printdebug("static","parthuedmodel=3D",iTileTypeID)
 				elseif ( (iHue > 0) and (iHue < gMaxHueValue) ) then
 					if (CloneMesh) then meshname=3DCloneMesh(meshname) end
 					HueMesh(meshname,gHueLoader,iHue)
 				end
 			end
 		end
-
 		gLegacyModelCache[iTranslatedTileTypeID.."_"..iHue] =3D meshname
 	end
-
 	return meshname
 end
 =

@@ -132,7 +147,7 @@
 end
 =

 -- preloads all available meshes for the statics
--- Wrong !!! hueing must be taken from statics instead of tiledata
+-- TODO: Wrong !!! hueing must be taken from statics instead of tiledata
 function PreloadAllStaticMesh()
 	-- preload all models
 	if gTileTypeLoader then
@@ -143,7 +158,7 @@
 			arrtiletype =3D GetStaticTileType(i)
 			if (arrtiletype) then
 				printdebug("static","i",i,"name",arrtiletype.msName)
-				GetStaticMeshName(i,arrtiletype.miHue)
+				GetStaticMeshName(i)
 				i =3D i + 1
 			else
 				printdebug("static","i",i,"not found in Tiledata")



From no-reply at zwischenwelt.org  Mon Dec  3 21:32:49 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 03 Dec 2007 20:32:49 -0000
Subject: [Iris-commit] [IRIS] r1600 - in /trunk/data/lua/net: net.buff.lua
	net.main.lua
Message-ID: <20071203210005.9947D1C182A7@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Dec  3 21:32:49 2007
New Revision: 1600

Log:
dofile for net.buff.lua, but buff packet still commented out until crash is=
 fixed

Modified:
    trunk/data/lua/net/net.buff.lua
    trunk/data/lua/net/net.main.lua

Modified: trunk/data/lua/net/net.buff.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.buff.lua (original)
+++ trunk/data/lua/net/net.buff.lua Mon Dec  3 21:32:49 2007
@@ -64,7 +64,7 @@
 00000000 =

 ]]--
 =

-
+--[[
 function gPacketHandler.kPacket_BuffDebuff_System()
 	local buffinfos =3D {}
 	local input =3D GetRecvFIFO()
@@ -113,6 +113,7 @@
 	print("spell buff packet received !!!!!!!!!!",packetsize)
 	print(vardump2(buffinfos))
 end
+]]--
 =

 --[[
 =


Modified: trunk/data/lua/net/net.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.main.lua (original)
+++ trunk/data/lua/net/net.main.lua Mon Dec  3 21:32:49 2007
@@ -9,7 +9,7 @@
 dofile(libpath .. "net/net.sound.lua")
 dofile(libpath .. "net/net.login.lua")
 dofile(libpath .. "net/net.skill.lua")
---dofile(libpath .. "net.buff.lua")
+dofile(libpath .. "net/net.buff.lua")
 =

 -- only things that have at least 2 packets get its own file, everything e=
lse is handled here:
 dofile(libpath .. "net/net.packethandlers.lua")



From no-reply at zwischenwelt.org  Mon Dec  3 21:38:20 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 03 Dec 2007 20:38:20 -0000
Subject: [Iris-commit] [IRIS] r1601 - /trunk/data/lua/lib.static.lua
Message-ID: <20071203210005.A6BF11C186EA@zwischenwelt.org>

Author: sience
Date: Mon Dec  3 21:38:20 2007
New Revision: 1601

Log:
-hueing from preload removed

Modified:
    trunk/data/lua/lib.static.lua

Modified: trunk/data/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.static.lua (original)
+++ trunk/data/lua/lib.static.lua Mon Dec  3 21:38:20 2007
@@ -149,21 +149,7 @@
 -- preloads all available meshes for the statics
 -- TODO: Wrong !!! hueing must be taken from statics instead of tiledata
 function PreloadAllStaticMesh()
-	-- preload all models
-	if gTileTypeLoader then
-		local i =3D 0
-		=

-		repeat
-			local arrtiletype =3D {}
-			arrtiletype =3D GetStaticTileType(i)
-			if (arrtiletype) then
-				printdebug("static","i",i,"name",arrtiletype.msName)
-				GetStaticMeshName(i)
-				i =3D i + 1
-			else
-				printdebug("static","i",i,"not found in Tiledata")
-				i =3D nil
-			end
-		until (i =3D=3D nil)
+	for i =3D 0,16085 do
+		GetStaticMeshName(i)
 	end
 end



From no-reply at zwischenwelt.org  Mon Dec  3 23:32:45 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 03 Dec 2007 22:32:45 -0000
Subject: [Iris-commit] [IRIS] r1602 - /trunk/data/lua/net/net.buff.lua
Message-ID: <20071203223246.68E781C186E6@zwischenwelt.org>

Author: sience
Date: Mon Dec  3 23:32:44 2007
New Revision: 1602

Log:
-some comments added

Modified:
    trunk/data/lua/net/net.buff.lua

Modified: trunk/data/lua/net/net.buff.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.buff.lua (original)
+++ trunk/data/lua/net/net.buff.lua Mon Dec  3 23:32:44 2007
@@ -29,69 +29,37 @@
 BYTE[2] 0x00 01			-EndIf Arguments Mode
 =

 BYTE[2] 0x00 00			-EndIf Type
-
-
-Packet [df], Length: 46, Type: Server
-df 002e
-00026dbe
-03f9 0001 00000000
-03f9 0001 00000000
-
-0019
-
-000000
-
-001069d1
-001069d2
-
-00000000	<- temp5
-
-0000
-0000
-
-0000
-<- Mindrot
-
-Packet [df], Length: 15, Type: Server
-df 000f
-
-00026dbe
-
-03f4
-
-0000
-
-00000000 =

 ]]--
 =

---[[
 function gPacketHandler.kPacket_BuffDebuff_System()
 	local buffinfos =3D {}
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
 	local packetsize =3D input:PopNetUint16()
 =

+	print("spell buff packet received !!!!!!!!!!",packetsize)
 	buffinfos.player_serial	=3D input:PopNetUint32()
+
 	buffinfos.icon_artid1		=3D input:PopNetUint16()
 	buffinfos.icon_show1		=3D input:PopNetUint16()
 	buffinfos.temp1			=3D input:PopNetUint32()
 =

 	if (packetsize > 15) then
-		buffinfos.icon_artid2		=3D input:PopNetUint16()			-- ??
+		buffinfos.icon_artid2		=3D input:PopNetUint16()
 		buffinfos.icon_show2		=3D input:PopNetUint16()
 		buffinfos.temp2			=3D input:PopNetUint32()
 	=

-		buffinfos.buff_duration	=3D input:PopNetUint16()
+		buffinfos.buff_duration	=3D input:PopNetUint16()	--Time in seconds
 	=

 		buffinfos.temp3			=3D input:PopNetUint16()
 		buffinfos.temp4			=3D input:PopNetUint8()
 	=

-		buffinfos.clilocid1		=3D input:PopNetUint32()
-		buffinfos.clilocid2		=3D input:PopNetUint32()
+		buffinfos.clilocid1		=3D input:PopNetUint32()	--titleCliloc
+		buffinfos.clilocid2		=3D input:PopNetUint32()	--secondaryCliloc
 	=

 		buffinfos.temp5			=3D input:PopNetUint32()
 	=

-		buffinfos.argumentsmode_start	=3D input:PopNetUint16()
+		buffinfos.argumentsmode_start	=3D input:PopNetUint16()	-- if 1 -> i have=
 more data
 	=

 		buffinfos.argumentsmode_startif	=3D input:PopNetUint16()
 	=

@@ -110,10 +78,8 @@
 		buffinfos.argumentsmode_end		=3D input:PopNetUint16()
 	end
 	=

-	print("spell buff packet received !!!!!!!!!!",packetsize)
 	print(vardump2(buffinfos))
 end
-]]--
 =

 --[[
 =




From no-reply at zwischenwelt.org  Mon Dec  3 23:34:24 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 03 Dec 2007 22:34:24 -0000
Subject: [Iris-commit] [IRIS] r1603 - /trunk/data/lua/net/net.buff.lua
Message-ID: <20071203223429.AC5F31524004@zwischenwelt.org>

Author: sience
Date: Mon Dec  3 23:34:23 2007
New Revision: 1603

Log:
-buff runuo2 code added

Modified:
    trunk/data/lua/net/net.buff.lua

Modified: trunk/data/lua/net/net.buff.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.buff.lua (original)
+++ trunk/data/lua/net/net.buff.lua Mon Dec  3 23:34:23 2007
@@ -29,6 +29,81 @@
 BYTE[2] 0x00 01			-EndIf Arguments Mode
 =

 BYTE[2] 0x00 00			-EndIf Type
+
+
+--RUNUO2 code
+		public AddBuffPacket( Mobile m, BuffInfo info )
+			: this( m, info.ID, info.TitleCliloc, info.SecondaryCliloc, info.Args, =
(info.TimeStart !=3D DateTime.MinValue) ? ((info.TimeStart + info.TimeLengt=
h) - DateTime.Now) : TimeSpan.Zero )
+		{
+		}
+		public AddBuffPacket( Mobile mob, BuffIcon iconID, int titleCliloc, int =
secondaryCliloc, TextDefinition args, TimeSpan length )
+			: base( 0xDF )
+		{
+			bool hasArgs =3D (args !=3D null);
+
+			this.EnsureCapacity( (hasArgs ? (48 + args.ToString().Length * 2): 44) =
);
+			m_Stream.Write( (int)mob.Serial );
+
+
+			m_Stream.Write( (short)iconID );	//ID
+			m_Stream.Write( (short)0x1 );	//Type 0 for removal. 1 for add 2 for Data
+
+			m_Stream.Fill( 4 );
+
+			m_Stream.Write( (short)iconID );	//ID
+			m_Stream.Write( (short)0x01 );	//Type 0 for removal. 1 for add 2 for Da=
ta
+
+			m_Stream.Fill( 4 );
+
+			if( length < TimeSpan.Zero )
+				length =3D TimeSpan.Zero;
+
+			m_Stream.Write( (short)length.TotalSeconds );	//Time in seconds
+
+			m_Stream.Fill( 3 );
+			m_Stream.Write( (int)titleCliloc );
+			m_Stream.Write( (int)secondaryCliloc );
+
+			if( !hasArgs )
+			{
+				//m_Stream.Fill( 2 );
+				m_Stream.Fill( 10 );
+			}
+			else
+			{
+				m_Stream.Fill( 4 );
+				m_Stream.Write( (short)0x1 );	//Unknown -> Possibly something saying '=
hey, I have more data!'?
+				m_Stream.Fill( 2 );
+
+				//m_Stream.WriteLittleUniNull( "\t#1018280" );
+				m_Stream.WriteLittleUniNull( String.Format( "\t{0}", args.ToString() )=
 );
+
+				m_Stream.Write( (short)0x1 );	//Even more Unknown -> Possibly somethin=
g saying 'hey, I have more data!'?
+				m_Stream.Fill( 2 );
+			}
+		}
+	}
+
+	public class RemoveBuffPacket : Packet
+	{
+		public RemoveBuffPacket( Mobile mob, BuffInfo info )
+			: this( mob, info.ID )
+		{
+		}
+
+		public RemoveBuffPacket( Mobile mob, BuffIcon iconID )
+			: base( 0xDF )
+		{
+			this.EnsureCapacity( 13 );
+			m_Stream.Write( (int)mob.Serial );
+
+
+			m_Stream.Write( (short)iconID );	//ID
+			m_Stream.Write( (short)0x0 );	//Type 0 for removal. 1 for add 2 for Data
+
+			m_Stream.Fill( 4 );
+		}
+	}
 ]]--
 =

 function gPacketHandler.kPacket_BuffDebuff_System()



From no-reply at zwischenwelt.org  Tue Dec  4 22:31:58 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 04 Dec 2007 21:31:58 -0000
Subject: [Iris-commit] [IRIS] r1604 - in /trunk: bin/ data/ data/base/
 data/grannys/ data/grannys/materials/ data/grannys/programs/
 data/grannys/textures/ data/lua/ data/models/materials/
 data/terrain/materials/
Message-ID: <20071204213159.1D0D61C182A2@zwischenwelt.org>

Author: sience
Date: Tue Dec  4 22:31:58 2007
New Revision: 1604

Log:
-several updates to lib.static.lua (loading improved)
-hardware skinning added (temp. disabled, look into matGranny.material)

Added:
    trunk/data/grannys/
    trunk/data/grannys/materials/
    trunk/data/grannys/materials/matGranny.material
    trunk/data/grannys/programs/
    trunk/data/grannys/programs/hardwareSkinning.cg
    trunk/data/grannys/programs/hardwareSkinning.program
    trunk/data/grannys/programs/skinningTwoWeightsShadowCasterVp.glsl
    trunk/data/grannys/programs/skinningTwoWeightsVp.glsl
    trunk/data/grannys/textures/
Removed:
    trunk/data/base/checker2.png
Modified:
    trunk/bin/iris2.exe
    trunk/bin/resources.cfg
    trunk/data/base/main.material
    trunk/data/config.lua.dist
    trunk/data/lua/lib.static.lua
    trunk/data/lua/lib.tilefreewalk.lua
    trunk/data/lua/main.lua
    trunk/data/models/materials/textures.material
    trunk/data/terrain/materials/terrain.material

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/resources.cfg
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/bin/resources.cfg (original)
+++ trunk/bin/resources.cfg Tue Dec  4 22:31:58 2007
@@ -71,3 +71,8 @@
 FileSystem=3D../data/terrain/materials
 FileSystem=3D../data/terrain/programs
 FileSystem=3D../data/terrain/textures
+
+# new Grannys
+FileSystem=3D../data/grannys/materials
+FileSystem=3D../data/grannys/programs
+FileSystem=3D../data/grannys/textures

Modified: trunk/data/base/main.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/base/main.material (original)
+++ trunk/data/base/main.material Tue Dec  4 22:31:58 2007
@@ -45,29 +45,6 @@
 				texture bar.png
 				tex_address_mode clamp
 				//filtering none
-			}
-		}
-	}
-}
-
-// this will be cloned and adjusted to create the materials used by granny=
 models
-material matGrannyBase
-{
-	technique
-	{
-		pass
-		{
-			//lighting off
-			ambient 1.0 1.0 1.0
-			diffuse 1.0 1.0 1.0
-			cull_hardware none
-			cull_software none
-			scene_blend alpha_blend
-			alpha_rejection greater_equal 255
-			=

-			texture_unit
-			{
-				texture checker2.png
 			}
 		}
 	}

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Tue Dec  4 22:31:58 2007
@@ -248,6 +248,7 @@
 gShadowTechnique =3D "none"
 gTerrainCastShadows =3D false
 gStaticsCastShadows =3D false
+gDynamicsCastShadows =3D false
 gMobileCastShadows =3D false
 =

 -- sample shadow setting
@@ -256,6 +257,7 @@
 	gShadowTechnique =3D "stencil_modulative"
 	gTerrainCastShadows =3D false
 	gStaticsCastShadows =3D true
+	gDynamicsCastShadows =3D true
 	gMobileCastShadows =3D true
 end
 =


Modified: trunk/data/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.static.lua (original)
+++ trunk/data/lua/lib.static.lua Tue Dec  4 22:31:58 2007
@@ -18,38 +18,6 @@
 	local meshname =3D GetStaticMeshName(i)
 	return CountMeshTriangles(meshname) < 4 and HasModelOnlyOneUoArt_Cached(i=
) -- hagish
 	--return CountMeshTriangles(meshname) <=3D 2 and HasModelOnlyOneUoArt_Cac=
hed(i) -- ghouly
-end
-]]--
-
--- returns the model name with the given id
--- TODO handle custom stuff?
-function GetModelName(id)
-	return sprintf("mdl_%06d.mesh",id)
-end
-
--- returns path to the model file, for importing
-gCustomModelCache =3D {}
-function GetModelPath(id) =

-	local cached =3D gCustomModelCache[id]
-	if (cached ~=3D nil) then return cached end
-
-	local base =3D id - math.mod(id,1000) + 1000
-	local relpath  =3D sprintf("models/to_%06d/mdl_%06d.mesh",base,id)
-
-	local custompath =3D datapath.."custom/"..relpath
-	if file_exists(custompath) then
-		gCustomModelCache[id] =3D custompath
-		return custompath
-	end
-
-	local meshpath =3D datapath.."models/"..relpath
-	if file_exists(meshpath) then
-		gCustomModelCache[id] =3D meshpath
-	else
-		gCustomModelCache[id] =3D false
-		meshpath =3D nil
-	end
-	return meshpath
 end
 =

 -- returns true if the model has only one different material that is a uoa=
rt
@@ -82,6 +50,38 @@
 		return false =

 	end
 end
+]]--
+
+-- returns the model name with the given id
+-- TODO handle custom stuff?
+function GetModelName(id)
+	return sprintf("mdl_%06d.mesh",id)
+end
+
+-- returns path to the model file, for importing
+gCustomModelCache =3D {}
+function GetModelPath(id) =

+	local cached =3D gCustomModelCache[id]
+	if (cached ~=3D nil) then print("Model schonmal im gCustomModelCache") re=
turn cached end
+
+	local base =3D id - math.mod(id,1000) + 1000
+	local relpath  =3D sprintf("models/to_%06d/",base)
+
+	local custompath =3D datapath.."custom/"..relpath..GetModelName(id)
+	if file_exists(custompath) then
+		gCustomModelCache[id] =3D custompath
+		return custompath
+	end
+
+	local meshpath =3D datapath.."models/"..relpath..GetModelName(id)
+	if file_exists(meshpath) then
+		gCustomModelCache[id] =3D meshpath
+	else
+		gCustomModelCache[id] =3D false
+		meshpath =3D nil
+	end
+	return meshpath
+end
 =

 -- generates or retrieves meshname for static model
 -- TODO : not flexible enough, what if model should be skipped, or multipl=
e models set ? or model depending on surrounding ?
@@ -96,44 +96,61 @@
 	-- FILTER: static water
 	iTranslatedTileTypeID,iHue =3D FilterStaticWater(iTranslatedTileTypeID, i=
Hue)
 =

-	local meshname =3D gLegacyModelCache[iTranslatedTileTypeID.."_"..iHue]
+	local meshname =3D nil
+
+	if (iHue>0) then meshname =3D gLegacyModelCache[iTranslatedTileTypeID.."_=
"..iHue] end
+
 	if (meshname =3D=3D nil) then
-		if (not meshname) then
-			meshname =3D GetModelName(iTranslatedTileTypeID) -- "mdl_"..iTranslated=
TileTypeID..".mesh"
-		end
+		-- check if unhued mesh is already available
+		meshname =3D gLegacyModelCache[iTranslatedTileTypeID.."_".."0"]
 =

-		-- if no *.mesh is available -> set mesh as not available in cache
-		if not OgreMeshAvailable(meshname) then =

-			printdebug("static","mesh not available ",meshname)
-			printdebug("static","mesh set to false")
-			meshname =3D false
-		else =

-			printdebug("static","Meshloader:",iTranslatedTileTypeID,iHue,meshname)
-			-- create unavailable uo_art material
-			if (gArtMapLoader and gManualArtMaterialLoader) then
-				local path =3D GetModelPath(iTranslatedTileTypeID)
-				local t =3D OgreMeshTextures(path) -- datapath.."models/models/mesh/".=
.meshname)
-				for k,v in pairs(t) do =

-					printdebug("static","Meshloader : texture found",v)
-					gManualArtMaterialLoader:CreateMatchingIfUnavailable(v)
+		if (meshname =3D=3D nil) then
+			local modellocation =3D GetModelPath(iTranslatedTileTypeID)
+			if ( modellocation ~=3D nil ) then
+				meshname =3D GetModelName(iTranslatedTileTypeID)
+				-- load Mesh here
+				if ( OgreMeshAvailable(meshname) ) then
+					printdebug("static","Meshloader:",iTranslatedTileTypeID,iHue,meshname)
+
+					-- create unavailable uo_art material
+					if (gArtMapLoader and gManualArtMaterialLoader) then
+						local t =3D OgreLoadedMeshTextures(meshname)
+						for k,v in pairs(t) do
+							printdebug("static","Meshloader : texture found",v)
+							gManualArtMaterialLoader:CreateMatchingIfUnavailable(v)
+						end
+					else
+						-- set false, if no ui_art material can be created
+						printdebug("static","mesh cannot be loaded -> temp. disabled (false)=
 ",meshname, iTranslatedTileTypeID)
+						meshname =3D false
+					end
+
+				else
+					printdebug("static","mesh cannot be loaded -> temp. disabled (false) =
",meshname, iTranslatedTileTypeID)
+					meshname =3D false
 				end
 			else
-				-- set false, if no ui_art material can be created
+				printdebug("static","mesh not available -> temp. disabled (false) ",me=
shname, iTranslatedTileTypeID)
 				meshname =3D false
 			end
 =

-			-- Hue this Model | TODO : Partitial Hue is currently skipped
+			-- TODO: CLONEMESH & HUEMESH both have a very huge load and should use =
Entities for Material Hueing !!!!!!!!!!!!!
+			-- Hue this Model | TODO: Partitial Hue is currently skipped
 			if (gHueLoader and meshname ~=3D false) then
-				if( TestBit(GetStaticTileTypeFlags(iTileTypeID) or 0,kTileDataFlag_Par=
tial_Hue) ) then
-					-- don't use iTranslatedTileTypeID here, because of waterhack
+				-- don't use iTranslatedTileTypeID here, because of waterhack
+				if (TestBit(GetStaticTileTypeFlags(iTileTypeID) or 0,kTileDataFlag_Par=
tial_Hue) ) then
 					printdebug("static","parthuedmodel=3D",iTileTypeID)
-				elseif ( (iHue > 0) and (iHue < gMaxHueValue) ) then
-					if (CloneMesh) then meshname=3DCloneMesh(meshname) end
-					HueMesh(meshname,gHueLoader,iHue)
+				elseif ( (iHue>0) and (iHue<gMaxHueValue) ) then
+					local clonemeshname=3DCloneMesh(meshname)
+					HueMesh(clonemeshname,gHueLoader,iHue)
+					-- cache also hued mesh
+					gLegacyModelCache[iTranslatedTileTypeID.."_"..iHue] =3D clonemeshname
 				end
 			end
 		end
-		gLegacyModelCache[iTranslatedTileTypeID.."_"..iHue] =3D meshname
+
+		-- cache unhued mesh
+		gLegacyModelCache[iTranslatedTileTypeID.."_".."0"] =3D meshname
 	end
 	return meshname
 end

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Tue Dec  4 22:31:58 2007
@@ -8,11 +8,15 @@
 kFreeWalkMouseSlowArea =3D 70
 =

 kTileFreeTestMobile =3D {artid=3D400,hue=3D33780, content=3D{
-		{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount},
-		[4]=3D{artid=3D5422,hue=3D1728,animid=3D430},[26]=3D{artid=3D3701,hue=3D=
0,animid=3D422},
-		[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},[27]=3D{artid=3D3701,hue=
=3D0,animid=3D422},
-		[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,hue=
=3D1147,animid=3D701},
-		[21]=3D{artid=3D3701,hue=3D0,animid=3D422},}} =

+--		{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount},
+		[4]=3D{artid=3D5422,hue=3D1728,animid=3D430},
+		[26]=3D{artid=3D3701,hue=3D0,animid=3D422},
+		[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},
+		[27]=3D{artid=3D3701,hue=3D0,animid=3D422},
+		[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},
+		[11]=3D{artid=3D8252,hue=3D1147,animid=3D701},
+		[21]=3D{artid=3D3701,hue=3D0,animid=3D422}
+		}} =

 		=

 gTileFreePlayerRad =3D 0.2 -- radius of player/human
 gTileFreeDebugWallH =3D 0.7

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Tue Dec  4 22:31:58 2007
@@ -212,12 +212,12 @@
 =

 	-- set global shadow settings
 	if (gEnableShadows) then
+		OgreShadowTechnique(gShadowTechnique)
+		--OgreSetShadowTextureSize(512)
 		--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --??
-		--OgreSetShadowTextureSize(512)
 		--OgreSetShadowTextureCasterMaterial
 		--OgreSetShadowTextureReceiverMaterial
 		--OgreSetShadowTextureSelfShadow(false)
-		OgreShadowTechnique(gShadowTechnique)
 		--OgreSetShadowFarDistance(100.0)
 	end
 =


Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Tue Dec  4 22:31:58 2007
@@ -18,7 +18,7 @@
 			{
 				filtering anisotropic =

 				max_anisotropy 8
-				texture checker2.png
+				texture checker.png
 			}
 		}
 	}
@@ -47,7 +47,7 @@
 			{
 				filtering anisotropic =

 				max_anisotropy 8
-				texture checker2.png
+				texture checker.png
 			}
 		}
 	}

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Tue Dec  4 22:31:58 2007
@@ -109,7 +109,6 @@
 			}
 		}
 	}
-
 	// Fallback 1
 	technique
 	{



From no-reply at zwischenwelt.org  Wed Dec  5 17:17:07 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 05 Dec 2007 16:17:07 -0000
Subject: [Iris-commit] [IRIS] r1605 - in /trunk/data/models/models:
 generate.sh generate_tex_atlas.php tomesh.sh toxml.sh
Message-ID: <20071205161707.74B061C182F9@zwischenwelt.org>

Author: hagish
Date: Wed Dec  5 17:17:06 2007
New Revision: 1605

Log:
first version of the texture atlas generator. first tests were ok, but its =
still not perfect

Added:
    trunk/data/models/models/generate.sh   (with props)
    trunk/data/models/models/generate_tex_atlas.php
    trunk/data/models/models/tomesh.sh   (with props)
    trunk/data/models/models/toxml.sh   (with props)



From no-reply at zwischenwelt.org  Thu Dec  6 21:53:48 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 06 Dec 2007 20:53:48 -0000
Subject: [Iris-commit] [IRIS] r1607 - in /trunk/data/models/materials:
 armoire.material textures.material
Message-ID: <20071206205349.2EDFB1C18228@zwischenwelt.org>

Author: sience
Date: Thu Dec  6 21:53:48 2007
New Revision: 1607

Log:
-materials merged

Removed:
    trunk/data/models/materials/armoire.material
Modified:
    trunk/data/models/materials/textures.material

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Thu Dec  6 21:53:48 2007
@@ -8107,3 +8107,37 @@
 		}
 	} =

 }
+
+material armoire-2637 : tex_base =

+{
+	technique
+	{
+		pass
+		{
+			cull_hardware clockwise
+			cull_software back
+		=

+			texture_unit
+			{
+				texture armoire-2637.tga
+			}
+		}
+	}
+}
+
+material armoire-2639 : tex_base =

+{
+	technique
+	{
+		pass
+		{
+			cull_hardware clockwise
+			cull_software back
+
+			texture_unit
+			{
+				texture armoire-2639.tga
+			}
+		}
+	}
+}



From no-reply at zwischenwelt.org  Fri Dec  7 01:15:46 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 07 Dec 2007 00:15:46 -0000
Subject: [Iris-commit] [IRIS] r1608 - in /trunk/data/lua: lib.debugmenu.lua
	lib.static.lua
Message-ID: <20071207001546.837DF1C18248@zwischenwelt.org>

Author: sience
Date: Fri Dec  7 01:15:46 2007
New Revision: 1608

Log:
-small fix for hueing/caching static models

Modified:
    trunk/data/lua/lib.debugmenu.lua
    trunk/data/lua/lib.static.lua

Modified: trunk/data/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.debugmenu.lua (original)
+++ trunk/data/lua/lib.debugmenu.lua Fri Dec  7 01:15:46 2007
@@ -175,7 +175,7 @@
 		if (not mobile) then return end
 		RepairEquipIndex(mobile.content)
 		AddFadeLines(sprintf("DebugMenuShowModel model=3D%04x(=3D%d) anim=3D%d[%=
s]",mobile.artid,mobile.artid,gDebugMenuAnimIndex,GetAnimName(mobile.artid,=
gDebugMenuAnimIndex) or ""))
-		=

+
 		gDebugBodyGfx =3D CreateBodyGfx(gDebugRootGfx)
 		gDebugBodyGfx:MarkForUpdate(mobile.artid,mobile.hue,mobile.content)
 		gDebugBodyGfx:Update()

Modified: trunk/data/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.static.lua (original)
+++ trunk/data/lua/lib.static.lua Fri Dec  7 01:15:46 2007
@@ -98,7 +98,7 @@
 =

 	local meshname =3D nil
 =

-	if (iHue>0) then meshname =3D gLegacyModelCache[iTranslatedTileTypeID.."_=
"..iHue] end
+	meshname =3D gLegacyModelCache[iTranslatedTileTypeID.."_"..iHue]
 =

 	if (meshname =3D=3D nil) then
 		-- check if unhued mesh is already available
@@ -124,7 +124,6 @@
 						printdebug("static","mesh cannot be loaded -> temp. disabled (false)=
 ",meshname, iTranslatedTileTypeID)
 						meshname =3D false
 					end
-
 				else
 					printdebug("static","mesh cannot be loaded -> temp. disabled (false) =
",meshname, iTranslatedTileTypeID)
 					meshname =3D false
@@ -133,24 +132,30 @@
 				printdebug("static","mesh not available -> temp. disabled (false) ",me=
shname, iTranslatedTileTypeID)
 				meshname =3D false
 			end
+			=

+			gLegacyModelCache[iTranslatedTileTypeID.."_".."0"] =3D meshname
+		else
+			printdebug("static","mesh already found in cache ",meshname, iHue)
+		end
 =

-			-- TODO: CLONEMESH & HUEMESH both have a very huge load and should use =
Entities for Material Hueing !!!!!!!!!!!!!
-			-- Hue this Model | TODO: Partitial Hue is currently skipped
-			if (gHueLoader and meshname ~=3D false) then
-				-- don't use iTranslatedTileTypeID here, because of waterhack
-				if (TestBit(GetStaticTileTypeFlags(iTileTypeID) or 0,kTileDataFlag_Par=
tial_Hue) ) then
-					printdebug("static","parthuedmodel=3D",iTileTypeID)
-				elseif ( (iHue>0) and (iHue<gMaxHueValue) ) then
-					local clonemeshname=3DCloneMesh(meshname)
-					HueMesh(clonemeshname,gHueLoader,iHue)
-					-- cache also hued mesh
-					gLegacyModelCache[iTranslatedTileTypeID.."_"..iHue] =3D clonemeshname
-				end
+		-- TODO: CLONEMESH & HUEMESH both have a very huge load and should use E=
ntities for Material Hueing !!!!!!!!!!!!!
+		-- Hue this Model | TODO: Partitial Hue is currently skipped
+		if (gHueLoader and meshname) then
+			-- don't use iTranslatedTileTypeID here, because of waterhack
+			if (TestBit(GetStaticTileTypeFlags(iTileTypeID) or 0,kTileDataFlag_Part=
ial_Hue) ) then
+				printdebug("static","parthuedmodel=3D",iTileTypeID)
+			elseif ( (iHue>0) and (iHue<gMaxHueValue) ) then
+				local clonemeshname=3DCloneMesh(meshname)
+				HueMesh(clonemeshname,gHueLoader,iHue)
+				printdebug("static",sprintf("mesh=3D%s hued=3D%d",meshname,iHue) )
+
+				-- cache also hued meshname
+				gLegacyModelCache[iTranslatedTileTypeID.."_"..iHue] =3D clonemeshname
+				return clonemeshname
 			end
 		end
-
-		-- cache unhued mesh
-		gLegacyModelCache[iTranslatedTileTypeID.."_".."0"] =3D meshname
+	else
+		printdebug("static","mesh already found in cache ",meshname, iHue)
 	end
 	return meshname
 end



From no-reply at zwischenwelt.org  Thu Dec  6 21:42:26 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 06 Dec 2007 20:42:26 -0000
Subject: [Iris-commit] [IRIS] r1606 - in /trunk: bin/ data/ data/base/
 data/grannys/materials/ data/grannys/programs/ data/lua/
 data/models/materials/ data/models/textures/ data/particles/materials/
 data/skybox/ data/skybox/materials/ data/skybox/textures/
Message-ID: <20071206204228.8183E1C18248@zwischenwelt.org>

Author: sience
Date: Thu Dec  6 21:42:24 2007
New Revision: 1606

Log:
-several material updates

Added:
    trunk/data/grannys/materials/grannybase.material
    trunk/data/skybox/materials/
    trunk/data/skybox/materials/skybox.material
    trunk/data/skybox/textures/
    trunk/data/skybox/textures/cleansky_bk.dds   (with props)
    trunk/data/skybox/textures/cleansky_fr.dds   (with props)
    trunk/data/skybox/textures/cleansky_lf.dds   (with props)
    trunk/data/skybox/textures/cleansky_rt.dds   (with props)
    trunk/data/skybox/textures/cleansky_up.dds   (with props)
    trunk/data/skybox/textures/darksun_east.dds   (with props)
    trunk/data/skybox/textures/darksun_north.dds   (with props)
    trunk/data/skybox/textures/darksun_south.dds   (with props)
    trunk/data/skybox/textures/darksun_top.dds   (with props)
    trunk/data/skybox/textures/darksun_west.dds   (with props)
    trunk/data/skybox/textures/skybox_east.dds   (with props)
    trunk/data/skybox/textures/skybox_north.dds   (with props)
    trunk/data/skybox/textures/skybox_south.dds   (with props)
    trunk/data/skybox/textures/skybox_top.dds   (with props)
    trunk/data/skybox/textures/skybox_west.dds   (with props)
    trunk/data/skybox/textures/sunset_east.dds   (with props)
    trunk/data/skybox/textures/sunset_north.dds   (with props)
    trunk/data/skybox/textures/sunset_south.dds   (with props)
    trunk/data/skybox/textures/sunset_top.dds   (with props)
    trunk/data/skybox/textures/sunset_west.dds   (with props)
Removed:
    trunk/data/grannys/materials/matGranny.material
    trunk/data/models/materials/textures_base.material.dist
    trunk/data/skybox/cleansky_bk.dds
    trunk/data/skybox/cleansky_fr.dds
    trunk/data/skybox/cleansky_lf.dds
    trunk/data/skybox/cleansky_rt.dds
    trunk/data/skybox/cleansky_up.dds
    trunk/data/skybox/darksun_east.dds
    trunk/data/skybox/darksun_north.dds
    trunk/data/skybox/darksun_south.dds
    trunk/data/skybox/darksun_top.dds
    trunk/data/skybox/darksun_west.dds
    trunk/data/skybox/skybox_east.dds
    trunk/data/skybox/skybox_north.dds
    trunk/data/skybox/skybox_south.dds
    trunk/data/skybox/skybox_top.dds
    trunk/data/skybox/skybox_west.dds
    trunk/data/skybox/sunset_east.dds
    trunk/data/skybox/sunset_north.dds
    trunk/data/skybox/sunset_south.dds
    trunk/data/skybox/sunset_top.dds
    trunk/data/skybox/sunset_west.dds
Modified:
    trunk/bin/iris2.exe
    trunk/bin/resources.cfg
    trunk/data/base/main.material
    trunk/data/config.lua.dist
    trunk/data/grannys/programs/hardwareSkinning.cg
    trunk/data/grannys/programs/hardwareSkinning.program
    trunk/data/grannys/programs/skinningTwoWeightsVp.glsl
    trunk/data/lua/lib.3d.dynamic.lua
    trunk/data/lua/lib.debugmenu.lua
    trunk/data/lua/lib.granny.lua
    trunk/data/lua/main.lua
    trunk/data/models/materials/armoire.material
    trunk/data/models/materials/textures.material
    trunk/data/models/textures/tex_533.png
    trunk/data/particles/materials/particles.material

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/resources.cfg
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/bin/resources.cfg (original)
+++ trunk/bin/resources.cfg Thu Dec  6 21:42:24 2007
@@ -9,7 +9,8 @@
 FileSystem=3D../data/base
 FileSystem=3D../data/base/ui
 FileSystem=3D../data/base/font
-FileSystem=3D../data/skybox
+FileSystem=3D../data/skybox/materials
+FileSystem=3D../data/skybox/textures
 FileSystem=3D../data/particles/materials
 FileSystem=3D../data/particles/particles
 FileSystem=3D../data/particles/textures

Modified: trunk/data/base/main.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/base/main.material (original)
+++ trunk/data/base/main.material Thu Dec  6 21:42:24 2007
@@ -1,5 +1,37 @@
-// fallback if there is no uo art image available
-material art_fallback
+//###########################################
+// TEMPLATES
+//###########################################
+
+// GUI BASE TEMPLATE
+material guibase
+{
+	technique
+	{
+		pass
+		{
+			ambient 1.0 1.0 1.0 1.0
+			specular 0 0 0 1.0
+			=

+			cull_hardware none
+			cull_software none
+
+			scene_blend alpha_blend
+			=

+			lighting off
+			depth_write off
+
+			texture_unit guitex
+			{
+				texture guibase.png
+				tex_address_mode clamp
+				filtering none
+			}
+		}
+	}
+}
+
+// ART-FALLBACK BASE TEMPLATE
+material artfallbackbase
 {
 	technique
 	{
@@ -14,174 +46,17 @@
 			scene_blend alpha_blend
 			alpha_rejection greater_equal 255
 			=

-			texture_unit
-			{
-				texture art_fallback.png
-				tex_address_mode clamp
-			}
-		}
-	}
-}
-
-// material to show a simple health bar
-material bar
-{
-	technique
-	{
-		pass
-		{
-			ambient  1 1 1 1
-			specular 0 0 0 1
-			=

-			cull_hardware none
-			cull_software none
-			=

-			lighting off
-			scene_blend alpha_blend
-			depth_write off
-
-			texture_unit
-			{
-				texture bar.png
-				tex_address_mode clamp
-				//filtering none
-			}
-		}
-	}
-}
-
-material aura_base
-{
-	technique
-	{
-		pass
-		{
-			ambient  1 1 1 1
-			specular 0 0 0 1
-			=

-			cull_hardware none
-			cull_software none
-			=

-			lighting off
-			scene_blend alpha_blend
-			depth_write off
-
-			depth_bias 16
-
-			texture_unit
-			{
-				texture aura2.png alpha
-				tex_address_mode clamp
-				filtering none
-			}
-		}
-	}
-}
-
-material quest_arrow
-{
-	technique
-	{
-		pass
-		{
-			ambient  1 1 1 1
-			specular 0 0 0 1
-			=

-			cull_hardware none
-			cull_software none
-			=

-			lighting off
-			scene_blend alpha_blend
-			depth_write off
-
-			texture_unit
-			{
-				texture questmark.png
-				tex_address_mode clamp
-				filtering none
-			}
-		}
-	}
-}
-
-material skybox
-{
-	technique
-	{
-		pass
-		{
-			fog_override true
-			lighting off
-			depth_write off
-
-			texture_unit
-			{
-				cubic_texture skybox_north.dds skybox_south.dds skybox_west.dds skybox=
_east.dds skybox_top.dds stone512.dds separateUV
-				tex_address_mode clamp
-			}
-		}
-	}
-}
-
-material darksun
-{
-	technique
-	{
-		pass
-		{
-			fog_override true
-			lighting off
-			depth_write off
-
-			texture_unit
-			{
-				cubic_texture darksun_north.dds darksun_south.dds darksun_west.dds dar=
ksun_east.dds darksun_top.dds stone512.dds separateUV
-				tex_address_mode clamp
-			}
-		}
-	}
-}
-
-material sunset
-{
-	technique
-	{
-		pass
-		{
-			fog_override true
-			lighting off
-			depth_write off
-
-			texture_unit
-			{
-				cubic_texture sunset_north.dds sunset_south.dds sunset_west.dds sunset=
_east.dds sunset_top.dds stone512.dds separateUV
-				tex_address_mode clamp
-			}
-		}
-	}
-}
-
-material cleansky
-{
-	technique
-	{
-		pass
-		{
-			fog_override true
-			lighting off
-			depth_write off
-
-			texture_unit
-			{
-				cubic_texture cleansky_fr.dds cleansky_bk.dds cleansky_lf.dds cleansky=
_rt.dds cleansky_up.dds stone512.dds separateUV
-				tex_address_mode clamp
-			}
-		}
-	}
-}
-
-
-material debug_grid_3D
+			texture_unit arttex
+			{
+				texture stone512.dds
+				tex_address_mode clamp
+			}
+		}
+	}
+}
+
+// TEMPMAP BASE TEMPLATE
+material tempmapbase
 {
 	technique
 	{
@@ -194,131 +69,12 @@
 			cull_software none
 			=

 			lighting off
-		}
-	}
-}
-			=

-material guibase
-{
-	technique
-	{
-		pass
-		{
-			ambient 1 1 1 1
-			specular 0 0 0 1
-			=

-			cull_hardware none
-			cull_software none
-			=

-			lighting off
-			scene_blend alpha_blend
-			depth_write off
-
-			texture_unit
-			{
-				texture guibase.png
-				tex_address_mode clamp
-				filtering none
-			}
-		}
-	}
-}
-
-// don't use in 2d elements (deactivates depthwrite)
-material boundingboxmat
-{
-	technique
-	{
-		pass
-		{
-			//lighting off
-			=

-			ambient 1.0 1.0 1.0
-			diffuse 1.0 1.0 1.0
-		}
-	}
-}
-
-// this automatically gets depth_write turned off when used in gui, so don=
't use as 3d texture, also not as boundingbox
-material hudUnknown
-{
-	technique
-	{
-		pass
-		{
-			//lighting off
-			=

-			ambient 1.0 1.0 1.0
-			diffuse 1.0 1.0 1.0
-		}
-	}
-}
-
-material ghoulgreen
-{
-	technique
-	{
-		pass
-		{
-			//lighting off
-			=

-			ambient 0.0 0.1 0.0
-			diffuse 0.0 1.0 0.0
-		}
-	}
-}
-
-material matDebugBoundingBox
-{
-	technique
-	{
-		pass
-		{
-			lighting off
-			ambient 0.0 0.0 0.0
-			diffuse 1.0 1.0 1.0
-			cull_hardware none
-			cull_software none
-		}
-	}
-}
-
-
-material ghoulgreentrans
-{
-	technique
-	{
-		pass
-		{
-			ambient 0.0 1.0 0.0
-			diffuse 0.0 1.0 0.0
-			=

-			scene_blend add
-			depth_write off
-		}
-	}
-}
-
-
-material tempmap_1_small
-{
-	technique
-	{
-		pass
-		{
-			ambient 1 1 1 1
-			specular 0 0 0 1
-			=

-			cull_hardware none
-			cull_software none
-			=

-			lighting off
 			//depth_write off
 			//depth_check off
 =

-			texture_unit
-			{
-				texture tempmap_1_small_s.tga
+			texture_unit skytex
+			{
+				texture stone512.dds
 				tex_address_mode border
 				tex_border_colour 0.0 0.22 0.32
 				filtering none
@@ -326,73 +82,228 @@
 		}
 	}
 }
-material tempmap_0_small : tempmap_1_small
-{
-	technique
-	{
-		pass
-		{
-			texture_unit
-			{
-				texture tempmap_0_small_s.tga
-			}
-		}
-	}
-}
-material tempmap_2_small : tempmap_1_small
-{
-	technique
-	{
-		pass
-		{
-			texture_unit
-			{
-				texture tempmap_2_small_s.tga
-			}
-		}
-	}
-}
-material tempmap_3_small : tempmap_1_small
-{
-	technique
-	{
-		pass
-		{
-			texture_unit
-			{
-				texture tempmap_3_small_s.tga
-			}
-		}
-	}
-}
-material tempmap_4_small : tempmap_1_small
-{
-	technique
-	{
-		pass
-		{
-			texture_unit
-			{
-				texture tempmap_4_small_s.tga
-			}
-		}
-	}
-}
-material tempmap_5_small : tempmap_1_small
-{
-	technique
-	{
-		pass
-		{
-			texture_unit
-			{
-				texture tempmap_5_small_s.tga
-			}
-		}
-	}
-}
-
-material mapdot
+
+// --------------- THIS IS THE END OF BASE MATERIALS ----------------------
+
+// fallback if there is no uo art image available
+material art_fallback : artfallbackbase
+{
+	set_texture_alias arttex art_fallback.png
+}
+
+// mouse cursor material
+material mousecursor
+{
+	set_texture_alias guitex mousecursor.png
+}
+
+// radarcompass materials
+material tempmap_0_small : tempmapbase
+{
+	set_texture_alias skytex tempmap_0_small_s.tga
+}
+
+material tempmap_1_small : tempmapbase
+{
+	set_texture_alias skytex tempmap_1_small_s.tga
+}
+
+material tempmap_2_small : tempmapbase
+{
+	set_texture_alias skytex tempmap_2_small_s.tga
+}
+material tempmap_3_small : tempmapbase
+{
+	set_texture_alias skytex tempmap_3_small_s.tga
+}
+material tempmap_4_small : tempmapbase
+{
+	set_texture_alias skytex tempmap_4_small_s.tga
+}
+material tempmap_5_small : tempmapbase
+{
+	set_texture_alias skytex tempmap_5_small_s.tga
+}
+
+// material to show a simple 3D health bar
+material bar : guibase
+{
+	technique
+	{
+		pass
+		{
+			texture_unit
+			{
+				filtering anisotropic
+				max_anisotropy 8
+				texture bar.png
+				tex_address_mode clamp
+			}
+		}
+	}
+}
+
+material aura_base : guibase
+{
+	technique
+	{
+		pass
+		{
+			depth_bias 16
+
+			texture_unit
+			{
+				filtering anisotropic
+				max_anisotropy 8
+				texture aura2.png alpha
+				tex_address_mode clamp
+			}
+		}
+	}
+}
+
+material quest_arrow : guibase
+{
+	technique
+	{
+		pass
+		{
+			texture_unit
+			{
+				filtering anisotropic
+				max_anisotropy 8
+				texture questmark.png
+				tex_address_mode clamp
+			}
+		}
+	}
+}
+
+material mapdot : guibase
+{
+	technique
+	{
+		pass
+		{
+			depth_check off
+
+			texture_unit
+			{
+				texture mapdot.png
+			}
+		}
+	}
+}
+
+material compassframe_static : guibase
+{
+	technique
+	{
+		pass
+		{
+			depth_check off
+
+			texture_unit
+			{
+				texture compassframe_static.png
+			}
+		}
+	}
+}
+material compassframe_zoomin : guibase
+{
+	technique
+	{
+		pass
+		{
+			depth_check off
+
+			texture_unit
+			{
+				texture compassframe_zoomin.png
+			}
+		}
+	}
+}
+material compassframe_zoomout : guibase
+{
+	technique
+	{
+		pass
+		{
+			depth_check off
+
+			texture_unit
+			{
+				texture compassframe_zoomout.png
+			}
+		}
+	}
+}
+
+material compassframe_rot : guibase
+{
+	technique
+	{
+		pass
+		{
+			depth_check off
+
+			texture_unit
+			{
+				texture compassframe_rot.png
+			}
+		}
+	}
+}
+
+material compassframe_mask : guibase
+{
+	technique
+	{
+		pass
+		{
+			depth_check off
+
+			texture_unit
+			{
+				texture compassframe_mask.png
+			}
+		}
+	}
+}
+
+material checker : guibase
+{
+	set_texture_alias guitex checker.png
+}
+
+
+material irislogo : guibase
+{
+	set_texture_alias guitex irislogo256x256bw.png
+}
+
+material rtt_base : guibase
+{
+	technique
+	{
+		pass
+		{
+			texture_unit
+			{
+				filtering anisotropic =

+				max_anisotropy 8
+				texture guibase.png
+				tex_address_mode clamp
+			}
+		}
+	}
+}
+
+// ------------------- non standard materials -------------------
+
+material debug_grid_3D
 {
 	technique
 	{
@@ -400,26 +311,91 @@
 		{
 			ambient 1 1 1 1
 			specular 0 0 0 1
-			=

-			cull_hardware none
-			cull_software none
-			scene_blend alpha_blend
-			=

-			lighting off
+
+			cull_hardware none
+			cull_software none
+
+			lighting off
+		}
+	}
+}
+			=

+// don't use in 2d elements (deactivates depthwrite)
+material boundingboxmat
+{
+	technique
+	{
+		pass
+		{
+			//lighting off
+			=

+			ambient 1.0 1.0 1.0
+			diffuse 1.0 1.0 1.0
+		}
+	}
+}
+
+// this automatically gets depth_write turned off when used in gui, so don=
't use as 3d texture, also not as boundingbox
+material hudUnknown
+{
+	technique
+	{
+		pass
+		{
+			//lighting off
+			=

+			ambient 1.0 1.0 1.0
+			diffuse 1.0 1.0 1.0
+		}
+	}
+}
+
+material ghoulgreen
+{
+	technique
+	{
+		pass
+		{
+			//lighting off
+			=

+			ambient 0.0 0.1 0.0
+			diffuse 0.0 1.0 0.0
+		}
+	}
+}
+
+material matDebugBoundingBox
+{
+	technique
+	{
+		pass
+		{
+			lighting off
+			ambient 0.0 0.0 0.0
+			diffuse 1.0 1.0 1.0
+			cull_hardware none
+			cull_software none
+		}
+	}
+}
+
+
+material ghoulgreentrans
+{
+	technique
+	{
+		pass
+		{
+			ambient 0.0 1.0 0.0
+			diffuse 0.0 1.0 0.0
+			=

+			scene_blend add
 			depth_write off
-			depth_check off
-
-			texture_unit
-			{
-				texture mapdot.png
-				tex_address_mode clamp
-				filtering none
-			}
-		}
-	}
-}
-
-material compassframe_static
+		}
+	}
+}
+
+material stone
 {
 	technique
 	{
@@ -428,166 +404,6 @@
 			ambient 1 1 1 1
 			specular 0 0 0 1
 			=

-			cull_software none
-			cull_hardware none
-			scene_blend alpha_blend
-			=

-			lighting off
-			depth_write off
-			depth_check off
-
-			texture_unit
-			{
-				texture compassframe_static.png
-				tex_address_mode clamp
-				filtering none
-			}
-		}
-	}
-}
-material compassframe_zoomin : compassframe_static
-{
-	technique
-	{
-		pass
-		{
-			texture_unit
-			{
-				texture compassframe_zoomin.png
-			}
-		}
-	}
-}
-material compassframe_zoomout : compassframe_static
-{
-	technique
-	{
-		pass
-		{
-			texture_unit
-			{
-				texture compassframe_zoomout.png
-			}
-		}
-	}
-}
-
-material compassframe_rot
-{
-	technique
-	{
-		pass
-		{
-			ambient 1 1 1 1
-			specular 0 0 0 1
-			=

-			cull_software none
-			cull_hardware none
-			scene_blend alpha_blend
-			=

-			lighting off
-			depth_write off
-			depth_check off
-
-			texture_unit
-			{
-				texture compassframe_rot.png
-				tex_address_mode clamp
-				filtering none
-			}
-		}
-	}
-}
-
-material compassframe_mask
-{
-	technique
-	{
-		pass
-		{
-			ambient 1 1 1 1
-			specular 0 0 0 1
-			=

-			cull_software none
-			cull_hardware none
-			scene_blend alpha_blend
-			=

-			lighting off
-			depth_write off
-			depth_check off
-
-			texture_unit
-			{
-				texture compassframe_mask.png
-				tex_address_mode clamp
-				filtering none
-			}
-		}
-	}
-}
-
-material checker
-{
-	technique
-	{
-		pass
-		{
-			ambient 1 1 1 1
-			specular 0 0 0 1
-			=

-			cull_hardware none
-			cull_software none
-			scene_blend alpha_blend
-			=

-			lighting off
-			depth_write off
-
-			texture_unit
-			{
-				texture checker.png
-				tex_address_mode clamp
-				filtering none
-			}
-		}
-	}
-}
-
-
-material irislogo
-{
-	technique
-	{
-		pass
-		{
-			ambient 1 1 1 1
-			specular 0 0 0 1
-			=

-			cull_hardware none
-			cull_software none
-			=

-			lighting off
-			scene_blend alpha_blend
-			depth_write off
-
-			texture_unit
-			{
-				texture irislogo256x256bw.png
-				tex_address_mode clamp
-				filtering none
-			}
-		}
-	}
-}
-
-material stone
-{
-	technique
-	{
-		pass
-		{
-			ambient 1 1 1 1
-			specular 0 0 0 1
-			=

 			texture_unit
 			{
 				texture stone512.dds
@@ -597,32 +413,6 @@
 		}
 	}
 }
-
-material mousecursor
-{
-	technique
-	{
-		pass
-		{
-			ambient 1 1 1 1
-			specular 0 0 0 1
-			=

-			cull_hardware none
-			cull_software none
-			=

-			lighting off
-			scene_blend alpha_blend
-			depth_write off
-
-			texture_unit
-			{
-				texture mousecursor.png
-				tex_address_mode clamp
-				filtering none
-			}
-		}
-	}
-} =

 =

 material plaincolor_base
 {
@@ -653,31 +443,4 @@
 			diffuse 1.0 1.0 1.0
 		}
 	}
-}
-
-material rtt_base
-{
-	technique
-	{
-		pass
-		{
-			ambient  1 1 1 1
-			specular 0 0 0 1
-			=

-			cull_hardware none
-			cull_software none
-			=

-			lighting off
-			scene_blend alpha_blend
-			depth_write off
-
-			texture_unit
-			{
-				texture guibase.png
-				tex_address_mode clamp
-				filtering anisotropic =

-				max_anisotropy 8
-			}
-		}
-	}
-}
+}

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Thu Dec  6 21:42:24 2007
@@ -360,7 +360,7 @@
 	name =3D "Ilshenar",
 	mapwidth =3D 288,
 	mapheight =3D 200,
-	skybox =3D "skybox",
+	skybox =3D "bluesky",
 	fog_r =3D 168,
 	fog_g =3D 168,
 	fog_b =3D 180,

Modified: trunk/data/grannys/programs/hardwareSkinning.cg
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/grannys/programs/hardwareSkinning.cg (original)
+++ trunk/data/grannys/programs/hardwareSkinning.cg Thu Dec  6 21:42:24 2007
@@ -1,89 +1,3 @@
-/*
-  Basic ambient lighting vertex program
-*/
-void ambientOneTexture_vp(float4 position : POSITION,
-						  float2 uv		  : TEXCOORD0,
-						  =

-						  out float4 oPosition : POSITION,
-						  out float2 oUv	   : TEXCOORD0,
-						  out float4 colour    : COLOR,
-
-						  uniform float4x4 worldViewProj,
-						  uniform float4 ambient)
-{
-	oPosition =3D mul(worldViewProj, position);
-	oUv =3D uv;
-	colour =3D ambient;
-}
-
-/*
-  Single-weight-per-vertex hardware skinning, 2 lights
-  The trouble with vertex programs is they're not general purpose, but
-  fixed function hardware skinning is very poorly supported
-*/
-void hardwareSkinningOneWeight_vp(
-	float4 position : POSITION,
-	float3 normal   : NORMAL,
-	float2 uv       : TEXCOORD0,
-	float  blendIdx : BLENDINDICES,
-	=

-
-	out float4 oPosition : POSITION,
-	out float2 oUv       : TEXCOORD0,
-	out float4 colour           : COLOR,
-	// Support up to 24 bones of float3x4
-	// vs_1_1 only supports 96 params so more than this is not feasible
-	uniform float3x4   worldMatrix3x4Array[24],
-	uniform float4x4 viewProjectionMatrix,
-	uniform float4   lightPos[2],
-	uniform float4   lightDiffuseColour[2],
-	uniform float4   ambient)
-{
-	// transform by indexed matrix
-	float4 blendPos =3D float4(mul(worldMatrix3x4Array[blendIdx], position).x=
yz, 1.0);
-	// view / projection
-	oPosition =3D mul(viewProjectionMatrix, blendPos);
-	// transform normal
-	float3 norm =3D mul((float3x3)worldMatrix3x4Array[blendIdx], normal);
-	// Lighting - support point and directional
-	float3 lightDir0 =3D 	normalize(
-		lightPos[0].xyz -  (blendPos.xyz * lightPos[0].w));
-	float3 lightDir1 =3D 	normalize(
-		lightPos[1].xyz -  (blendPos.xyz * lightPos[1].w));
-
-	oUv =3D uv;
-	colour =3D ambient + =

-		(saturate(dot(lightDir0, norm)) * lightDiffuseColour[0]) + =

-		(saturate(dot(lightDir1, norm)) * lightDiffuseColour[1]);
-	=

-}	=

-
-/*
-  Single-weight-per-vertex hardware skinning, shadow-caster pass
-*/
-void hardwareSkinningOneWeightCaster_vp(
-	float4 position : POSITION,
-	float3 normal   : NORMAL,
-	float  blendIdx : BLENDINDICES,
-	=

-
-	out float4 oPosition : POSITION,
-	out float4 colour    : COLOR,
-	// Support up to 24 bones of float3x4
-	// vs_1_1 only supports 96 params so more than this is not feasible
-	uniform float3x4   worldMatrix3x4Array[24],
-	uniform float4x4 viewProjectionMatrix,
-	uniform float4   ambient)
-{
-	// transform by indexed matrix
-	float4 blendPos =3D float4(mul(worldMatrix3x4Array[blendIdx], position).x=
yz, 1.0);
-	// view / projection
-	oPosition =3D mul(viewProjectionMatrix, blendPos);
-	=

-	colour =3D ambient;
-	=

-}	=

-
 /*
   Two-weight-per-vertex hardware skinning, 2 lights
   The trouble with vertex programs is they're not general purpose, but
@@ -111,15 +25,16 @@
 	// transform by indexed matrix
 	float4 blendPos =3D float4(0,0,0,0);
 	int i;
-	for (i =3D 0; i < 2; ++i)
+	for (i =3D 0; i < 2; ++i)		//increase 2 -> 4 for Four-weight-per-vertex h=
ardware skinning
 	{
 		blendPos +=3D float4(mul(worldMatrix3x4Array[blendIdx[i]], position).xyz=
, 1.0) * blendWgt[i];
 	}
 	// view / projection
 	oPosition =3D mul(viewProjectionMatrix, blendPos);
+
 	// transform normal
 	float3 norm =3D float3(0,0,0);
-	for (i =3D 0; i < 2; ++i)
+	for (i =3D 0; i < 2; ++i)		//increase 2 -> 4 for Four-weight-per-vertex h=
ardware skinning
 	{
 		norm +=3D mul((float3x3)worldMatrix3x4Array[blendIdx[i]], normal) * =

 		blendWgt[i];
@@ -131,12 +46,10 @@
 	float3 lightDir1 =3D 	normalize(
 		lightPos[1].xyz -  (blendPos.xyz * lightPos[1].w));
 =

-	=

 	oUv =3D uv;
-	colour =3D float4(0.5, 0.5, 0.5, 1) + =

+	colour =3D ambient + =

 		(saturate(dot(lightDir0, norm)) * lightDiffuseColour[0]) + =

 		(saturate(dot(lightDir1, norm)) * lightDiffuseColour[1]);
-	=

 }
 =

 /*
@@ -167,106 +80,6 @@
 	}
 	// view / projection
 	oPosition =3D mul(viewProjectionMatrix, blendPos);
-	=

 =

 	colour =3D ambient;
-		=

-	=

 }
-
-
-/*
-  Four-weight-per-vertex hardware skinning, 2 lights
-  The trouble with vertex programs is they're not general purpose, but
-  fixed function hardware skinning is very poorly supported
-*/
-void hardwareSkinningFourWeights_vp(
-	float4 position : POSITION,
-	float3 normal   : NORMAL,
-	float2 uv       : TEXCOORD0,
-	float4 blendIdx : BLENDINDICES,
-	float4 blendWgt : BLENDWEIGHT,
-	=

-
-	out float4 oPosition : POSITION,
-	out float2 oUv       : TEXCOORD0,
-	out float4 colour           : COLOR,
-	// Support up to 24 bones of float3x4
-	// vs_1_1 only supports 96 params so more than this is not feasible
-	uniform float3x4   worldMatrix3x4Array[24],
-	uniform float4x4 viewProjectionMatrix,
-	uniform float4   lightPos[2],
-	uniform float4   lightDiffuseColour[2],
-	uniform float4   ambient)
-{
-	// transform by indexed matrix
-	float4 blendPos =3D float4(0,0,0,0);
-	int i;
-	for (i =3D 0; i < 4; ++i)
-	{
-		blendPos +=3D float4(mul(worldMatrix3x4Array[blendIdx[i]], position).xyz=
, 1.0) * blendWgt[i];
-	}
-	// view / projection
-	oPosition =3D mul(viewProjectionMatrix, blendPos);
-	// transform normal
-	float3 norm =3D float3(0,0,0);
-	for (i =3D 0; i < 4; ++i)
-	{
-		norm +=3D mul((float3x3)worldMatrix3x4Array[blendIdx[i]], normal) * =

-		blendWgt[i];
-	}
-	norm =3D normalize(norm);
-	// Lighting - support point and directional
-	float3 lightDir0 =3D 	normalize(
-		lightPos[0].xyz -  (blendPos.xyz * lightPos[0].w));
-	float3 lightDir1 =3D 	normalize(
-		lightPos[1].xyz -  (blendPos.xyz * lightPos[1].w));
-
-	=

-	oUv =3D uv;
-	colour =3D ambient + =

-		(saturate(dot(lightDir0, norm)) * lightDiffuseColour[0]) + =

-		(saturate(dot(lightDir1, norm)) * lightDiffuseColour[1]);
-	=

-}
-
-void hardwareMorphAnimation(float3 pos1 : POSITION,
-			  float4 normal		: NORMAL,
-			  float2 uv		  : TEXCOORD0,
-			  float3 pos2	  : TEXCOORD1,
-						  =

-			  out float4 oPosition : POSITION,
-			  out float2 oUv	   : TEXCOORD0,
-			  out float4 colour    : COLOR,
-
-			  uniform float4x4 worldViewProj, =

-			  uniform float4 anim_t)
-{
-	// interpolate
-	float4 interp =3D float4(pos1 + anim_t.x*(pos2 - pos1), 1.0f);
-	=

-	oPosition =3D mul(worldViewProj, interp);
-	oUv =3D uv;
-	colour =3D float4(1,0,0,1);
-}
-
-void hardwarePoseAnimation(float3 pos : POSITION,
-			  float4 normal		: NORMAL,
-			  float2 uv		  : TEXCOORD0,
-			  float3 pose1	  : TEXCOORD1,
-			  float3 pose2	  : TEXCOORD2,
-						  =

-			  out float4 oPosition : POSITION,
-			  out float2 oUv	   : TEXCOORD0,
-			  out float4 colour    : COLOR,
-
-			  uniform float4x4 worldViewProj, =

-			  uniform float4 anim_t)
-{
-	// interpolate
-	float4 interp =3D float4(pos + anim_t.x*pose1 + anim_t.y*pose2, 1.0f);
-	=

-	oPosition =3D mul(worldViewProj, interp);
-	oUv =3D uv;
-	colour =3D float4(1,0,0,1);
-}

Modified: trunk/data/grannys/programs/hardwareSkinning.program
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/grannys/programs/hardwareSkinning.program (original)
+++ trunk/data/grannys/programs/hardwareSkinning.program Thu Dec  6 21:42:2=
4 2007
@@ -17,7 +17,16 @@
 {
 	delegate Ogre/HardwareSkinningTwoWeightsShadowCasterGLSL
 	delegate Ogre/HardwareSkinningTwoWeightsShadowCasterCg
+
+	default_params
+	{
+		param_named_auto worldMatrix3x4Array world_matrix_array_3x4
+		param_named_auto viewProjectionMatrix viewproj_matrix
+		param_named_auto ambient ambient_light_colour
+	}
 }
+
+// -----------------------------------------------------------------
 =

 // Basic hardware skinning using two indexed weights per vertex
 vertex_program Ogre/HardwareSkinningTwoWeightsCg cg
@@ -38,14 +47,15 @@
 {
 	delegate Ogre/HardwareSkinningTwoWeightsGLSL
 	delegate Ogre/HardwareSkinningTwoWeightsCg
-	=

-   default_params
-   {
-   		param_named_auto worldMatrix3x4Array world_matrix_array_3x4
+
+	default_params
+	{
+		param_named_auto worldMatrix3x4Array world_matrix_array_3x4
 		param_named_auto viewProjectionMatrix viewproj_matrix
 		param_named_auto lightPos[0] light_position 0
 		param_named_auto lightPos[1] light_position 1
 		param_named_auto lightDiffuseColour[0] light_diffuse_colour 0
 		param_named_auto lightDiffuseColour[1] light_diffuse_colour 1
-   }
+		param_named_auto ambient ambient_light_colour
+	}
 }

Modified: trunk/data/grannys/programs/skinningTwoWeightsVp.glsl
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/grannys/programs/skinningTwoWeightsVp.glsl (original)
+++ trunk/data/grannys/programs/skinningTwoWeightsVp.glsl Thu Dec  6 21:42:=
24 2007
@@ -42,16 +42,13 @@
 	gl_Position =3D viewProjectionMatrix * vec4(blendPos, 1);
 =

 	// simple vertex lighting model
-	vec3 lightDir0 =3D normalize(
-		lightPos[0].xyz -  (blendPos.xyz * lightPos[0].w));
-	vec3 lightDir1 =3D normalize(
-		lightPos[1].xyz -  (blendPos.xyz * lightPos[1].w));
+	vec3 lightDir0 =3D normalize(lightPos[0].xyz -  (blendPos.xyz * lightPos[=
0].w));
+	vec3 lightDir1 =3D normalize(lightPos[1].xyz -  (blendPos.xyz * lightPos[=
1].w));
 		=

 	gl_FrontSecondaryColor =3D vec4(0);
 	gl_FrontColor =3D vec4(0.5, 0.5, 0.5, 1.0) =

 		+ clamp(dot(lightDir0, blendNorm), 0.0, 1.0) * lightDiffuseColour[0]
 		+ clamp(dot(lightDir1, blendNorm), 0.0, 1.0) * lightDiffuseColour[1];
 =

-	gl_TexCoord[0] =3D gl_MultiTexCoord0;
-	=

+	gl_TexCoord[0] =3D gl_MultiTexCoord0;	=

 }

Modified: trunk/data/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.dynamic.lua (original)
+++ trunk/data/lua/lib.3d.dynamic.lua Thu Dec  6 21:42:24 2007
@@ -119,6 +119,7 @@
 =

 			-- --------------------------------------------------------------------=
-----
 			-- todo: HACK here (zadd because dynamic street-tiles dont look good (f=
lying)
+			-- groundtiles and item billboards shouldn't cast shadows
 			if (CountMeshTriangles(meshname) <=3D 4) then =

 				item.gfx:SetCastShadows(false)	-- groundtiles and item billboards shou=
ldn't cast shadows
 				if (gTileTypeLoader) then
@@ -127,7 +128,7 @@
 					end
 				end
 			else
-				item.gfx:SetCastShadows(gDynamicsCastShadows)	-- groundtiles and item =
billboards shouldn't cast shadows
+				item.gfx:SetCastShadows(gDynamicsCastShadows)
 			end
 			-- --------------------------------------------------------------------=
-----
 =


Modified: trunk/data/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.debugmenu.lua (original)
+++ trunk/data/lua/lib.debugmenu.lua Thu Dec  6 21:42:24 2007
@@ -251,7 +251,7 @@
 	gCurrentRenderer:Init()
 	ActivateRenderer(Renderer3D)
 =

-	Client_SetSkybox("skybox") -- cube skybox sunset darksun =

+	Client_SetSkybox("bluesky") -- cube skybox sunset darksun =

 	Renderer3D:ChangeCamMode(Renderer3D.kCamMode_Third)
 	Renderer3D.gfCamAngV =3D 0.0
 =


Modified: trunk/data/lua/lib.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.granny.lua (original)
+++ trunk/data/lua/lib.granny.lua Thu Dec  6 21:42:24 2007
@@ -199,7 +199,7 @@
 =

 =

 function GetGrannyMat (modelid,hue,mygranny) =

-	if (not gEnableGrannyMaterials) then return "matGrannyBase" end
+	if (not gEnableGrannyMaterials) then return "grannybase" end
 	if (hue >=3D hex2num("0x8000")) then hue =3D hue - hex2num("0x8000") end
 	local texname =3D GetGrannyTextureName(mygranny)
 	local matname =3D gGrannyMaterialCache[texname.."_"..hue]
@@ -210,7 +210,7 @@
 		local texturepath =3D CorrectGrannyPath("Maps/"..texname)
 		local texturemaskpath =3D CorrectGrannyPath("Maps/"..texmaskname)
 		-- texturepath will usually be an absolute path such as "/cavern/uostuff=
/uo/Models/Maps/UT256_Armor_Ring_V2.tga"
-		matname =3D CloneMaterial("matGrannyBase")
+		matname =3D CloneMaterial("grannybase")
 		if (gGrannyUseCompleteHuePalette) then
 			SetTexture(matname,CreateGrannyHuedTexture(GrannyTextureHook(texturepat=
h),GrannyTextureHook(texturemaskpath),gHueLoader,hue))
 		else

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Thu Dec  6 21:42:24 2007
@@ -170,13 +170,25 @@
 =

 function HandleCommandLine	() =

 	if (gCommandLineArguments[1] =3D=3D "-g") then
-		local mygranny =3D LoadGranny(gCommandLineArguments[2])
-		if (mygranny) then mygranny:Print() end
+		if (gCommandLineArguments[2]) then
+			local mygranny =3D LoadGranny(gCommandLineArguments[2])
+			if (mygranny) then mygranny:Print() end
+		else
+			print("")
+			print("Usage: iris2.exe -g grannyname.grn")
+			print("")
+		end
 		Crash()
 	end
 	if (gCommandLineArguments[1] =3D=3D "-gb") then
-		local mygranny =3D LoadGranny(gCommandLineArguments[2])
-		if (mygranny) then mygranny:PrintBones() end
+		if (gCommandLineArguments[2]) then
+			local mygranny =3D LoadGranny(gCommandLineArguments[2])
+			if (mygranny) then mygranny:PrintBones() end
+		else
+			print("")
+			print("Usage: iris2.exe -gb grannyname.grn")
+			print("")
+		end
 		Crash()
 	end
 end
@@ -191,9 +203,8 @@
 	CheckUODir()
 	=

 	-- if (gHuffmanCompression) then LuaHuffmanTest() end
-	-- if (false) then MyGrannyTest_PreOgre() end	-- TODO : just a test, see =
lib.granny.lua
 	-- if (false) then LuaBitwiseTest() end
-	-- if (false) then AnalyseStatics(0) end
+	---if (false) then AnalyseStatics(0) end
 	-- if (false) then ExpressionTest() end
 	-- if (false) then TestSound() end
 	-- if (false) then TestMultiLoader() end
@@ -213,7 +224,7 @@
 	-- set global shadow settings
 	if (gEnableShadows) then
 		OgreShadowTechnique(gShadowTechnique)
-		--OgreSetShadowTextureSize(512)
+		OgreSetShadowTextureSize(512)
 		--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --??
 		--OgreSetShadowTextureCasterMaterial
 		--OgreSetShadowTextureReceiverMaterial

Modified: trunk/data/models/materials/armoire.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/armoire.material (original)
+++ trunk/data/models/materials/armoire.material Thu Dec  6 21:42:24 2007
@@ -1,50 +1,32 @@
 =

-material armoire-2637
+material armoire-2637 : tex_base =

 {
 	technique
 	{
 		pass
 		{
-			lighting on
-			ambient 1.0 1.0 1.0
-			diffuse 1.0 1.0 1.0
-			=

 			cull_hardware clockwise
 			cull_software back
-			// needed for xmirror fix
-			//cull_hardware none
-			//cull_software none
-			=

+		=

 			texture_unit
 			{
-				filtering anisotropic =

-				max_anisotropy 8
 				texture armoire-2637.tga
 			}
 		}
 	}
 }
 =

-material armoire-2639
+material armoire-2639 : tex_base =

 {
 	technique
 	{
 		pass
 		{
-			lighting on
-			ambient 1.0 1.0 1.0
-			diffuse 1.0 1.0 1.0
-			=

 			cull_hardware clockwise
 			cull_software back
-			// needed for xmirror fix
-			//cull_hardware none
-			//cull_software none
-			=

+
 			texture_unit
 			{
-				filtering anisotropic =

-				max_anisotropy 8
 				texture armoire-2639.tga
 			}
 		}

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Thu Dec  6 21:42:24 2007
@@ -1,3 +1,8 @@
+//###########################################
+// TEMPLATES
+//###########################################
+
+// MESH BASE MATERIAL TEMPLATE
 material tex_base
 {
 	technique
@@ -24,8060 +29,8058 @@
 	}
 }
 =

-material tex_base_alpha
+// MESH BASE ALPHA MATERIAL TEMPLATE
+material tex_base_alpha : tex_base
 {
 	technique
 	{
 		pass
 		{
-			lighting on
-			ambient 1.0 1.0 1.0
-			diffuse 1.0 1.0 1.0
-			=

-			// needed for xmirror fix
-			//cull_hardware anticlockwise
-			//cull_software front
-			cull_hardware none
-			cull_software none
-			=

 			scene_blend alpha_blend
 			alpha_rejection greater_equal 200
-			=

+		}
+	}
+}
+
+// --------------- THIS IS THE END OF BASE MATERIALS ----------------------
+
+material tex_0 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_0.png =

+			}	=

+		}
+	} =

+}
+
+material tex_100 : tex_base
+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_100.png =

+			}	=

+		}
+	} =

+}
+
+material tex_101 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_101.png =

+			}	=

+		}
+	} =

+}
+
+material tex_102 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_102.png =

+			}	=

+		}
+	} =

+}
+
+material tex_103 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_103.png =

+			}	=

+		}
+	} =

+}
+
+material tex_104 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_104.png =

+			}	=

+		}
+	} =

+}
+
+material tex_105 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_105.png =

+			}	=

+		}
+	} =

+}
+
+material tex_106 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_106.png =

+			}	=

+		}
+	} =

+}
+
+material tex_107 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_107.png =

+			}	=

+		}
+	} =

+}
+
+material tex_108 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_108.png =

+			}	=

+		}
+	} =

+}
+
+material tex_109 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_109.png =

+			}	=

+		}
+	} =

+}
+
+material tex_10 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_10.png =

+			}	=

+		}
+	} =

+}
+
+material tex_110 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_110.png =

+			}	=

+		}
+	} =

+}
+
+material tex_111 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_111.png =

+			}	=

+		}
+	} =

+}
+
+material tex_112 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_112.png =

+			}	=

+		}
+	} =

+}
+
+material tex_113 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_113.png =

+			}	=

+		}
+	} =

+}
+
+material tex_114 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_114.png =

+			}	=

+		}
+	} =

+}
+
+material tex_115 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_115.png =

+			}	=

+		}
+	} =

+}
+
+material tex_116 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_116.png =

+			}	=

+		}
+	} =

+}
+
+material tex_117 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_117.png =

+			}	=

+		}
+	} =

+}
+
+material tex_118 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_118.png =

+			}	=

+		}
+	} =

+}
+
+material tex_119 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_119.png =

+			}	=

+		}
+	} =

+}
+
+material tex_11 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_11.png =

+			}	=

+		}
+	} =

+}
+
+material tex_120 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_120.png =

+			}	=

+		}
+	} =

+}
+
+material tex_121 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_121.png =

+			}	=

+		}
+	} =

+}
+
+material tex_122 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_122.png =

+			}	=

+		}
+	} =

+}
+
+material tex_123 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_123.png =

+			}	=

+		}
+	} =

+}
+
+material tex_124 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_124.png =

+			}	=

+		}
+	} =

+}
+
+material tex_125 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_125.png =

+			}	=

+		}
+	} =

+}
+
+material tex_126 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_126.png =

+			}	=

+		}
+	} =

+}
+
+material tex_127 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_127.png =

+			}	=

+		}
+	} =

+}
+
+material tex_128 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_128.png =

+			}	=

+		}
+	} =

+}
+
+material tex_129 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_129.png =

+			}	=

+		}
+	} =

+}
+
+material tex_12 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_12.png =

+			}	=

+		}
+	} =

+}
+
+material tex_130 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_130.png =

+			}	=

+		}
+	} =

+}
+
+material tex_131 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_131.png =

+			}	=

+		}
+	} =

+}
+
+material tex_132 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_132.png =

+			}	=

+		}
+	} =

+}
+
+material tex_133 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_133.png =

+			}	=

+		}
+	} =

+}
+
+material tex_134 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_134.png =

+			}	=

+		}
+	} =

+}
+
+material tex_135 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_135.png =

+			}	=

+		}
+	} =

+}
+
+material tex_136 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_136.png =

+			}	=

+		}
+	} =

+}
+
+material tex_137 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_137.png =

+			}	=

+		}
+	} =

+}
+
+material tex_138 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_138.png =

+			}	=

+		}
+	} =

+}
+
+material tex_139 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_139.png =

+			}	=

+		}
+	} =

+}
+
+material tex_13 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_13.png =

+			}	=

+		}
+	} =

+}
+
+material tex_140 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_140.png =

+			}	=

+		}
+	} =

+}
+
+material tex_141 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_141.png =

+			}	=

+		}
+	} =

+}
+
+material tex_142 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_142.png =

+			}	=

+		}
+	} =

+}
+
+material tex_143 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_143.png =

+			}	=

+		}
+	} =

+}
+
+material tex_144 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_144.png =

+			}	=

+		}
+	} =

+}
+
+material tex_145 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_145.png =

+			}	=

+		}
+	} =

+}
+
+material tex_146 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_146.png =

+			}	=

+		}
+	} =

+}
+
+material tex_147 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_147.png =

+			}	=

+		}
+	} =

+}
+
+material tex_148 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_148.png =

+			}	=

+		}
+	} =

+}
+
+material tex_149 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_149.png =

+			}	=

+		}
+	} =

+}
+
+material tex_14 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_14.png =

+			}	=

+		}
+	} =

+}
+
+material tex_150 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_150.png =

+			}	=

+		}
+	} =

+}
+
+material tex_151 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_151.png =

+			}	=

+		}
+	} =

+}
+
+material tex_152 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_152.png =

+			}	=

+		}
+	} =

+}
+
+material tex_153 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_153.png =

+			}	=

+		}
+	} =

+}
+
+material tex_154 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_154.png =

+			}	=

+		}
+	} =

+}
+
+material tex_155 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_155.png =

+			}	=

+		}
+	} =

+}
+
+material tex_156 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_156.png =

+			}	=

+		}
+	} =

+}
+
+material tex_157 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_157.png =

+			}	=

+		}
+	} =

+}
+
+material tex_158 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_158.png =

+			}	=

+		}
+	} =

+}
+
+material tex_159 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_159.png =

+			}	=

+		}
+	} =

+}
+
+material tex_15 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_15.png =

+			}	=

+		}
+	} =

+}
+
+material tex_160 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_160.png =

+			}	=

+		}
+	} =

+}
+
+material tex_161 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_161.png =

+			}	=

+		}
+	} =

+}
+
+material tex_162 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_162.png =

+			}	=

+		}
+	} =

+}
+
+material tex_163 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_163.png =

+			}	=

+		}
+	} =

+}
+
+material tex_164 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_164.png =

+			}	=

+		}
+	} =

+}
+
+material tex_165 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_165.png =

+			}	=

+		}
+	} =

+}
+
+material tex_166 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_166.png =

+			}	=

+		}
+	} =

+}
+
+material tex_167 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_167.png =

+			}	=

+		}
+	} =

+}
+
+material tex_168 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_168.png =

+			}	=

+		}
+	} =

+}
+
+material tex_169 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_169.png =

+			}	=

+		}
+	} =

+}
+
+material tex_16 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_16.png =

+			}	=

+		}
+	} =

+}
+
+material tex_170 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_170.png =

+			}	=

+		}
+	} =

+}
+
+material tex_171 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_171.png =

+			}	=

+		}
+	} =

+}
+
+material tex_172 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_172.png =

+			}	=

+		}
+	} =

+}
+
+material tex_173 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_173.png =

+			}	=

+		}
+	} =

+}
+
+material tex_174 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_174.png =

+			}	=

+		}
+	} =

+}
+
+material tex_175 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_175.png =

+			}	=

+		}
+	} =

+}
+
+material tex_176 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_176.png =

+			}	=

+		}
+	} =

+}
+
+material tex_177 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_177.png =

+			}	=

+		}
+	} =

+}
+
+material tex_178 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_178.png =

+			}	=

+		}
+	} =

+}
+
+material tex_179 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_179.png =

+			}	=

+		}
+	} =

+}
+
+material tex_17 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_17.png =

+			}	=

+		}
+	} =

+}
+
+material tex_180 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_180.png =

+			}	=

+		}
+	} =

+}
+
+material tex_181 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_181.png =

+			}	=

+		}
+	} =

+}
+
+material tex_182 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_182.png =

+			}	=

+		}
+	} =

+}
+
+material tex_183 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_183.png =

+			}	=

+		}
+	} =

+}
+
+material tex_184 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_184.png =

+			}	=

+		}
+	} =

+}
+
+material tex_185 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_185.png =

+			}	=

+		}
+	} =

+}
+
+material tex_186 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_186.png =

+			}	=

+		}
+	} =

+}
+
+material tex_187 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_187.png =

+			}	=

+		}
+	} =

+}
+
+material tex_188 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_188.png =

+			}	=

+		}
+	} =

+}
+
+material tex_189 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_189.png =

+			}	=

+		}
+	} =

+}
+
+material tex_18 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_18.png =

+			}	=

+		}
+	} =

+}
+
+material tex_190 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_190.png =

+			}	=

+		}
+	} =

+}
+
+material tex_191 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_191.png =

+			}	=

+		}
+	} =

+}
+
+material tex_192 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_192.png =

+			}	=

+		}
+	} =

+}
+
+material tex_193 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_193.png =

+			}	=

+		}
+	} =

+}
+
+material tex_194 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_194.png =

+			}	=

+		}
+	} =

+}
+
+material tex_195 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_195.png =

+			}	=

+		}
+	} =

+}
+
+material tex_196 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_196.png =

+			}	=

+		}
+	} =

+}
+
+material tex_197 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_197.png =

+			}	=

+		}
+	} =

+}
+
+material tex_198 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_198.png =

+			}	=

+		}
+	} =

+}
+
+material tex_199 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_199.png =

+			}	=

+		}
+	} =

+}
+
+material tex_19 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_19.png =

+			}	=

+		}
+	} =

+}
+
+material tex_1 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_1.png =

+			}	=

+		}
+	} =

+}
+
+material tex_200 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_200.png =

+			}	=

+		}
+	} =

+}
+
+material tex_201 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_201.png =

+			}	=

+		}
+	} =

+}
+
+material tex_202 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_202.png =

+			}	=

+		}
+	} =

+}
+
+material tex_203 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_203.png =

+			}	=

+		}
+	} =

+}
+
+material tex_204 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_204.png =

+			}	=

+		}
+	} =

+}
+
+material tex_205 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_205.png =

+			}	=

+		}
+	} =

+}
+
+material tex_206 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_206.png =

+			}	=

+		}
+	} =

+}
+
+material tex_207 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_207.png =

+			}	=

+		}
+	} =

+}
+
+material tex_208 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_208.png =

+			}	=

+		}
+	} =

+}
+
+material tex_209 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_209.png =

+			}	=

+		}
+	} =

+}
+
+material tex_20 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_20.png =

+			}	=

+		}
+	} =

+}
+
+material tex_210 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_210.png =

+			}	=

+		}
+	} =

+}
+
+material tex_211 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_211.png =

+			}	=

+		}
+	} =

+}
+
+material tex_212 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_212.png =

+			}	=

+		}
+	} =

+}
+
+material tex_213 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_213.png =

+			}	=

+		}
+	} =

+}
+
+material tex_214 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_214.png =

+			}	=

+		}
+	} =

+}
+
+material tex_215 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_215.png =

+			}	=

+		}
+	} =

+}
+
+material tex_216 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_216.png =

+			}	=

+		}
+	} =

+}
+
+material tex_217 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_217.png =

+			}	=

+		}
+	} =

+}
+
+material tex_218 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_218.png =

+			}	=

+		}
+	} =

+}
+
+material tex_219 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_219.png =

+			}	=

+		}
+	} =

+}
+
+material tex_21 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_21.png =

+			}	=

+		}
+	} =

+}
+
+material tex_220 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_220.png =

+			}	=

+		}
+	} =

+}
+
+material tex_221 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_221.png =

+			}	=

+		}
+	} =

+}
+
+material tex_222 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_222.png =

+			}	=

+		}
+	} =

+}
+
+material tex_223 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_223.png =

+			}	=

+		}
+	} =

+}
+
+material tex_224 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_224.png =

+			}	=

+		}
+	} =

+}
+
+material tex_225 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_225.png =

+			}	=

+		}
+	} =

+}
+
+material tex_226 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_226.png =

+			}	=

+		}
+	} =

+}
+
+material tex_227 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_227.png =

+			}	=

+		}
+	} =

+}
+
+material tex_228 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_228.png =

+			}	=

+		}
+	} =

+}
+
+material tex_229 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_229.png =

+			}	=

+		}
+	} =

+}
+
+material tex_22 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_22.png =

+			}	=

+		}
+	} =

+}
+
+material tex_230 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_230.png =

+			}	=

+		}
+	} =

+}
+
+material tex_231 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_231.png =

+			}	=

+		}
+	} =

+}
+
+material tex_232 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_232.png =

+			}	=

+		}
+	} =

+}
+
+material tex_233 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_233.png =

+			}	=

+		}
+	} =

+}
+
+material tex_234 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_234.png =

+			}	=

+		}
+	} =

+}
+
+material tex_235 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_235.png =

+			}	=

+		}
+	} =

+}
+
+material tex_236 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_236.png =

+			}	=

+		}
+	} =

+}
+
+material tex_237 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_237.png =

+			}	=

+		}
+	} =

+}
+
+material tex_238 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_238.png =

+			}	=

+		}
+	} =

+}
+
+material tex_239 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_239.png =

+			}	=

+		}
+	} =

+}
+
+material tex_23 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_23.png =

+			}	=

+		}
+	} =

+}
+
+material tex_240 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_240.png =

+			}	=

+		}
+	} =

+}
+
+material tex_241 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_241.png =

+			}	=

+		}
+	} =

+}
+
+material tex_242 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_242.png =

+			}	=

+		}
+	} =

+}
+
+material tex_243 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_243.png =

+			}	=

+		}
+	} =

+}
+
+material tex_244 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_244.png =

+			}	=

+		}
+	} =

+}
+
+material tex_245 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_245.png =

+			}	=

+		}
+	} =

+}
+
+material tex_246 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_246.png =

+			}	=

+		}
+	} =

+}
+
+material tex_247 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_247.png =

+			}	=

+		}
+	} =

+}
+
+material tex_248 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_248.png =

+			}	=

+		}
+	} =

+}
+
+material tex_249 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_249.png =

+			}	=

+		}
+	} =

+}
+
+material tex_24 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_24.png =

+			}	=

+		}
+	} =

+}
+
+material tex_250 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_250.png =

+			}	=

+		}
+	} =

+}
+
+material tex_251 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_251.png =

+			}	=

+		}
+	} =

+}
+
+material tex_252 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_252.png =

+			}	=

+		}
+	} =

+}
+
+material tex_253 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_253.png =

+			}	=

+		}
+	} =

+}
+
+material tex_254 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_254.png =

+			}	=

+		}
+	} =

+}
+
+material tex_255 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_255.png =

+			}	=

+		}
+	} =

+}
+
+material tex_256 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_256.png =

+			}	=

+		}
+	} =

+}
+
+material tex_257 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_257.png =

+			}	=

+		}
+	} =

+}
+
+material tex_258 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_258.png =

+			}	=

+		}
+	} =

+}
+
+material tex_259 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_259.png =

+			}	=

+		}
+	} =

+}
+
+material tex_25 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_25.png =

+			}	=

+		}
+	} =

+}
+
+material tex_260 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_260.png =

+			}	=

+		}
+	} =

+}
+
+material tex_261 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_261.png =

+			}	=

+		}
+	} =

+}
+
+material tex_262 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_262.png =

+			}	=

+		}
+	} =

+}
+
+material tex_263 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_263.png =

+			}	=

+		}
+	} =

+}
+
+material tex_264 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_264.png =

+			}	=

+		}
+	} =

+}
+
+material tex_265 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_265.png =

+			}	=

+		}
+	} =

+}
+
+material tex_266 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_266.png =

+			}	=

+		}
+	} =

+}
+
+material tex_267 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_267.png =

+			}	=

+		}
+	} =

+}
+
+material tex_268 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_268.png =

+			}	=

+		}
+	} =

+}
+
+material tex_269 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_269.png =

+			}	=

+		}
+	} =

+}
+
+material tex_26 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_26.png =

+			}	=

+		}
+	} =

+}
+
+material tex_270 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_270.png =

+			}	=

+		}
+	} =

+}
+
+material tex_271 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_271.png =

+			}	=

+		}
+	} =

+}
+
+material tex_272 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_272.png =

+			}	=

+		}
+	} =

+}
+
+material tex_273 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_273.png =

+			}	=

+		}
+	} =

+}
+
+material tex_274 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_274.png =

+			}	=

+		}
+	} =

+}
+
+material tex_275 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_275.png =

+			}	=

+		}
+	} =

+}
+
+material tex_276 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_276.png =

+			}	=

+		}
+	} =

+}
+
+material tex_277 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_277.png =

+			}	=

+		}
+	} =

+}
+
+material tex_278 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_278.png =

+			}	=

+		}
+	} =

+}
+
+material tex_279 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_279.png =

+			}	=

+		}
+	} =

+}
+
+material tex_27 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_27.png =

+			}	=

+		}
+	} =

+}
+
+material tex_280 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_280.png =

+			}	=

+		}
+	} =

+}
+
+material tex_281 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_281.png =

+			}	=

+		}
+	} =

+}
+
+material tex_282 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_282.png =

+			}	=

+		}
+	} =

+}
+
+material tex_283 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_283.png =

+			}	=

+		}
+	} =

+}
+
+material tex_284 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_284.png =

+			}	=

+		}
+	} =

+}
+
+material tex_285 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_285.png =

+			}	=

+		}
+	} =

+}
+
+material tex_286 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_286.png =

+			}	=

+		}
+	} =

+}
+
+material tex_287 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_287.png =

+			}	=

+		}
+	} =

+}
+
+material tex_288 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_288.png =

+			}	=

+		}
+	} =

+}
+
+material tex_289 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_289.png =

+			}	=

+		}
+	} =

+}
+
+material tex_28 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_28.png =

+			}	=

+		}
+	} =

+}
+
+material tex_290 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_290.png =

+			}	=

+		}
+	} =

+}
+
+material tex_291 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_291.png =

+			}	=

+		}
+	} =

+}
+
+material tex_292 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_292.png =

+			}	=

+		}
+	} =

+}
+
+material tex_293 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_293.png =

+			}	=

+		}
+	} =

+}
+
+material tex_294 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_294.png =

+			}	=

+		}
+	} =

+}
+
+material tex_295 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_295.png =

+			}	=

+		}
+	} =

+}
+
+material tex_296 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_296.png =

+			}	=

+		}
+	} =

+}
+
+material tex_297 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_297.png =

+			}	=

+		}
+	} =

+}
+
+material tex_298 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_298.png =

+			}	=

+		}
+	} =

+}
+
+material tex_299 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_299.png =

+			}	=

+		}
+	} =

+}
+
+material tex_29 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_29.png =

+			}	=

+		}
+	} =

+}
+
+material tex_2 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_2.png =

+			}	=

+		}
+	} =

+}
+
+material tex_300 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_300.png =

+			}	=

+		}
+	} =

+}
+
+material tex_301 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_301.png =

+			}	=

+		}
+	} =

+}
+
+material tex_302 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_302.png =

+			}	=

+		}
+	} =

+}
+
+material tex_303 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_303.png =

+			}	=

+		}
+	} =

+}
+
+material tex_304 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_304.png =

+			}	=

+		}
+	} =

+}
+
+material tex_305 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_305.png =

+			}	=

+		}
+	} =

+}
+
+material tex_306 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_306.png =

+			}	=

+		}
+	} =

+}
+
+material tex_307 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_307.png =

+			}	=

+		}
+	} =

+}
+
+material tex_308 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_308.png =

+			}	=

+		}
+	} =

+}
+
+material tex_309 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_309.png =

+			}	=

+		}
+	} =

+}
+
+material tex_30 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_30.png =

+			}	=

+		}
+	} =

+}
+
+material tex_310 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_310.png =

+			}	=

+		}
+	} =

+}
+
+material tex_311 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_311.png =

+			}	=

+		}
+	} =

+}
+
+material tex_312 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_312.png =

+			}	=

+		}
+	} =

+}
+
+material tex_313 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_313.png =

+			}	=

+		}
+	} =

+}
+
+material tex_314 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_314.png =

+			}	=

+		}
+	} =

+}
+
+material tex_315 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_315.png =

+			}	=

+		}
+	} =

+}
+
+material tex_316 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_316.png =

+			}	=

+		}
+	} =

+}
+
+material tex_317 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_317.png =

+			}	=

+		}
+	} =

+}
+
+material tex_318 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_318.png =

+			}	=

+		}
+	} =

+}
+
+material tex_319 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_319.png =

+			}	=

+		}
+	} =

+}
+
+material tex_31 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_31.png =

+			}	=

+		}
+	} =

+}
+
+material tex_320 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_320.png =

+			}	=

+		}
+	} =

+}
+
+material tex_321 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_321.png =

+			}	=

+		}
+	} =

+}
+
+material tex_322 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_322.png =

+			}	=

+		}
+	} =

+}
+
+material tex_323 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_323.png =

+			}	=

+		}
+	} =

+}
+
+material tex_324 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_324.png =

+			}	=

+		}
+	} =

+}
+
+material tex_325 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_325.png =

+			}	=

+		}
+	} =

+}
+
+material tex_326 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_326.png =

+			}	=

+		}
+	} =

+}
+
+material tex_327 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_327.png =

+			}	=

+		}
+	} =

+}
+
+material tex_328 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_328.png =

+			}	=

+		}
+	} =

+}
+
+material tex_329 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_329.png =

+			}	=

+		}
+	} =

+}
+
+material tex_32 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_32.png =

+			}	=

+		}
+	} =

+}
+
+material tex_330 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_330.png =

+			}	=

+		}
+	} =

+}
+
+material tex_331 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_331.png =

+			}	=

+		}
+	} =

+}
+
+material tex_332 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_332.png =

+			}	=

+		}
+	} =

+}
+
+material tex_333 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_333.png =

+			}	=

+		}
+	} =

+}
+
+material tex_334 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_334.png =

+			}	=

+		}
+	} =

+}
+
+material tex_335 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_335.png =

+			}	=

+		}
+	} =

+}
+
+material tex_336 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_336.png =

+			}	=

+		}
+	} =

+}
+
+material tex_337 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_337.png =

+			}	=

+		}
+	} =

+}
+
+material tex_338 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_338.png =

+			}	=

+		}
+	} =

+}
+
+material tex_339 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_339.png =

+			}	=

+		}
+	} =

+}
+
+material tex_33 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_33.png =

+			}	=

+		}
+	} =

+}
+
+material tex_340 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_340.png =

+			}	=

+		}
+	} =

+}
+
+material tex_341 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_341.png =

+			}	=

+		}
+	} =

+}
+
+material tex_342 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_342.png =

+			}	=

+		}
+	} =

+}
+
+material tex_343 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_343.png =

+			}	=

+		}
+	} =

+}
+
+material tex_344 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_344.png =

+			}	=

+		}
+	} =

+}
+
+material tex_345 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_345.png =

+			}	=

+		}
+	} =

+}
+
+material tex_346 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_346.png =

+			}	=

+		}
+	} =

+}
+
+material tex_347 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_347.png =

+			}	=

+		}
+	} =

+}
+
+material tex_348 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_348.png =

+			}	=

+		}
+	} =

+}
+
+material tex_349 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_349.png =

+			}	=

+		}
+	} =

+}
+
+material tex_34 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_34.png =

+			}	=

+		}
+	} =

+}
+
+material tex_350 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_350.png =

+			}	=

+		}
+	} =

+}
+
+material tex_351 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_351.png =

+			}	=

+		}
+	} =

+}
+
+material tex_352 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_352.png =

+			}	=

+		}
+	} =

+}
+
+material tex_353 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_353.png =

+			}	=

+		}
+	} =

+}
+
+material tex_354 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_354.png =

+			}	=

+		}
+	} =

+}
+
+material tex_355 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_355.png =

+			}	=

+		}
+	} =

+}
+
+material tex_356 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_356.png =

+			}	=

+		}
+	} =

+}
+
+material tex_357 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_357.png =

+			}	=

+		}
+	} =

+}
+
+material tex_358 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_358.png =

+			}	=

+		}
+	} =

+}
+
+material tex_359 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_359.png =

+			}	=

+		}
+	} =

+}
+
+material tex_35 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_35.png =

+			}	=

+		}
+	} =

+}
+
+material tex_360 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_360.png =

+			}	=

+		}
+	} =

+}
+
+material tex_361 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_361.png =

+			}	=

+		}
+	} =

+}
+
+material tex_362 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_362.png =

+			}	=

+		}
+	} =

+}
+
+material tex_363 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_363.png =

+			}	=

+		}
+	} =

+}
+
+material tex_364 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_364.png =

+			}	=

+		}
+	} =

+}
+
+material tex_365 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_365.png =

+			}	=

+		}
+	} =

+}
+
+material tex_366 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_366.png =

+			}	=

+		}
+	} =

+}
+
+material tex_367 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_367.png =

+			}	=

+		}
+	} =

+}
+
+material tex_368 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_368.png =

+			}	=

+		}
+	} =

+}
+
+material tex_369 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_369.png =

+			}	=

+		}
+	} =

+}
+
+material tex_36 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_36.png =

+			}	=

+		}
+	} =

+}
+
+material tex_370 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_370.png =

+			}	=

+		}
+	} =

+}
+
+material tex_371 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_371.png =

+			}	=

+		}
+	} =

+}
+
+material tex_372 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_372.png =

+			}	=

+		}
+	} =

+}
+
+material tex_373 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_373.png =

+			}	=

+		}
+	} =

+}
+
+material tex_374 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_374.png =

+			}	=

+		}
+	} =

+}
+
+material tex_375 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_375.png =

+			}	=

+		}
+	} =

+}
+
+material tex_376 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_376.png =

+			}	=

+		}
+	} =

+}
+
+material tex_377 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_377.png =

+			}	=

+		}
+	} =

+}
+
+material tex_378 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_378.png =

+			}	=

+		}
+	} =

+}
+
+material tex_379 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_379.png =

+			}	=

+		}
+	} =

+}
+
+material tex_37 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_37.png =

+			}	=

+		}
+	} =

+}
+
+material tex_380 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_380.png =

+			}	=

+		}
+	} =

+}
+
+material tex_381 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_381.png =

+			}	=

+		}
+	} =

+}
+
+material tex_382 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_382.png =

+			}	=

+		}
+	} =

+}
+
+material tex_383 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_383.png =

+			}	=

+		}
+	} =

+}
+
+material tex_384 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_384.png =

+			}	=

+		}
+	} =

+}
+
+material tex_385 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_385.png =

+			}	=

+		}
+	} =

+}
+
+material tex_386 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_386.png =

+			}	=

+		}
+	} =

+}
+
+material tex_387 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_387.png =

+			}	=

+		}
+	} =

+}
+
+material tex_388 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_388.png =

+			}	=

+		}
+	} =

+}
+
+material tex_389 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_389.png =

+			}	=

+		}
+	} =

+}
+
+material tex_38 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_38.png =

+			}	=

+		}
+	} =

+}
+
+material tex_390 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_390.png =

+			}	=

+		}
+	} =

+}
+
+material tex_391 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_391.png =

+			}	=

+		}
+	} =

+}
+
+material tex_392 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_392.png =

+			}	=

+		}
+	} =

+}
+
+material tex_393 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_393.png =

+			}	=

+		}
+	} =

+}
+
+material tex_394 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_394.png =

+			}	=

+		}
+	} =

+}
+
+material tex_395 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_395.png =

+			}	=

+		}
+	} =

+}
+
+material tex_396 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_396.png =

+			}	=

+		}
+	} =

+}
+
+material tex_397 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_397.png =

+			}	=

+		}
+	} =

+}
+
+material tex_398 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_398.png =

+			}	=

+		}
+	} =

+}
+
+material tex_399 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_399.png =

+			}	=

+		}
+	} =

+}
+
+material tex_39 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_39.png =

+			}	=

+		}
+	} =

+}
+
+material tex_3 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_3.png =

+			}	=

+		}
+	} =

+}
+
+material tex_400 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_400.png =

+			}	=

+		}
+	} =

+}
+
+material tex_401 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_401.png =

+			}	=

+		}
+	} =

+}
+
+material tex_402 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_402.png =

+			}	=

+		}
+	} =

+}
+
+material tex_403 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_403.png =

+			}	=

+		}
+	} =

+}
+
+material tex_404 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_404.png =

+			}	=

+		}
+	} =

+}
+
+material tex_405 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_405.png =

+			}	=

+		}
+	} =

+}
+
+material tex_406 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_406.png =

+			}	=

+		}
+	} =

+}
+
+material tex_407 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_407.png =

+			}	=

+		}
+	} =

+}
+
+material tex_408 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_408.png =

+			}	=

+		}
+	} =

+}
+
+material tex_409 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_409.png =

+			}	=

+		}
+	} =

+}
+
+material tex_40 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_40.png =

+			}	=

+		}
+	} =

+}
+
+material tex_410 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_410.png =

+			}	=

+		}
+	} =

+}
+
+material tex_411 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_411.png =

+			}	=

+		}
+	} =

+}
+
+material tex_412 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_412.png =

+			}	=

+		}
+	} =

+}
+
+material tex_413 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_413.png =

+			}	=

+		}
+	} =

+}
+
+material tex_414 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_414.png =

+			}	=

+		}
+	} =

+}
+
+material tex_415 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_415.png =

+			}	=

+		}
+	} =

+}
+
+material tex_416 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_416.png =

+			}	=

+		}
+	} =

+}
+
+material tex_417 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_417.png =

+			}	=

+		}
+	} =

+}
+
+material tex_418 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_418.png =

+			}	=

+		}
+	} =

+}
+
+material tex_419 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_419.png =

+			}	=

+		}
+	} =

+}
+
+material tex_41 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_41.png =

+			}	=

+		}
+	} =

+}
+
+material tex_420 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_420.png =

+			}	=

+		}
+	} =

+}
+
+material tex_421 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_421.png =

+			}	=

+		}
+	} =

+}
+
+material tex_422 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_422.png =

+			}	=

+		}
+	} =

+}
+
+material tex_423 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_423.png =

+			}	=

+		}
+	} =

+}
+
+material tex_424 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_424.png =

+			}	=

+		}
+	} =

+}
+
+material tex_425 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_425.png =

+			}	=

+		}
+	} =

+}
+
+material tex_426 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_426.png =

+			}	=

+		}
+	} =

+}
+
+material tex_427 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_427.png =

+			}	=

+		}
+	} =

+}
+
+material tex_428 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_428.png =

+			}	=

+		}
+	} =

+}
+
+material tex_429 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_429.png =

+			}	=

+		}
+	} =

+}
+
+material tex_42 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_42.png =

+			}	=

+		}
+	} =

+}
+
+material tex_430 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_430.png =

+			}	=

+		}
+	} =

+}
+
+material tex_431 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_431.png =

+			}	=

+		}
+	} =

+}
+
+material tex_432 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_432.png =

+			}	=

+		}
+	} =

+}
+
+material tex_433 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_433.png =

+			}	=

+		}
+	} =

+}
+
+material tex_434 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_434.png =

+			}	=

+		}
+	} =

+}
+
+material tex_435 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_435.png =

+			}	=

+		}
+	} =

+}
+
+material tex_436 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_436.png =

+			}	=

+		}
+	} =

+}
+
+material tex_437 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_437.png =

+			}	=

+		}
+	} =

+}
+
+material tex_438 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_438.png =

+			}	=

+		}
+	} =

+}
+
+material tex_439 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_439.png =

+			}	=

+		}
+	} =

+}
+
+material tex_43 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_43.png =

+			}	=

+		}
+	} =

+}
+
+material tex_440 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_440.png =

+			}	=

+		}
+	} =

+}
+
+material tex_441 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_441.png =

+			}	=

+		}
+	} =

+}
+
+material tex_442 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_442.png =

+			}	=

+		}
+	} =

+}
+
+material tex_443 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_443.png =

+			}	=

+		}
+	} =

+}
+
+material tex_444 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_444.png =

+			}	=

+		}
+	} =

+}
+
+material tex_445 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_445.png =

+			}	=

+		}
+	} =

+}
+
+material tex_446 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_446.png =

+			}	=

+		}
+	} =

+}
+
+material tex_447 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_447.png =

+			}	=

+		}
+	} =

+}
+
+material tex_448 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_448.png =

+			}	=

+		}
+	} =

+}
+
+material tex_449 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_449.png =

+			}	=

+		}
+	} =

+}
+
+material tex_44 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_44.png =

+			}	=

+		}
+	} =

+}
+
+material tex_450 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_450.png =

+			}	=

+		}
+	} =

+}
+
+material tex_451 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_451.png =

+			}	=

+		}
+	} =

+}
+
+material tex_452 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_452.png =

+			}	=

+		}
+	} =

+}
+
+material tex_453 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_453.png =

+			}	=

+		}
+	} =

+}
+
+material tex_454 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_454.png =

+			}	=

+		}
+	} =

+}
+
+material tex_455 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_455.png =

+			}	=

+		}
+	} =

+}
+
+material tex_456 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_456.png =

+			}	=

+		}
+	} =

+}
+
+material tex_457 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_457.png =

+			}	=

+		}
+	} =

+}
+
+material tex_458 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_458.png =

+			}	=

+		}
+	} =

+}
+
+material tex_459 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_459.png =

+			}	=

+		}
+	} =

+}
+
+material tex_45 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_45.png =

+			}	=

+		}
+	} =

+}
+
+material tex_460 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_460.png =

+			}	=

+		}
+	} =

+}
+
+material tex_461 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_461.png =

+			}	=

+		}
+	} =

+}
+
+material tex_462 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_462.png =

+			}	=

+		}
+	} =

+}
+
+material tex_463 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_463.png =

+			}	=

+		}
+	} =

+}
+
+material tex_464 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_464.png =

+			}	=

+		}
+	} =

+}
+
+material tex_465 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_465.png =

+			}	=

+		}
+	} =

+}
+
+material tex_466 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_466.png =

+			}	=

+		}
+	} =

+}
+
+material tex_467 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_467.png =

+			}	=

+		}
+	} =

+}
+
+material tex_468 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_468.png =

+			}	=

+		}
+	} =

+}
+
+material tex_469 : tex_base_alpha
+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_469.png =

+			}	=

+		}
+	} =

+}
+
+material tex_46 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_46.png =

+			}	=

+		}
+	} =

+}
+
+material tex_470 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_470.png =

+			}	=

+		}
+	} =

+}
+
+material tex_471 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_471.png =

+			}	=

+		}
+	} =

+}
+
+material tex_472 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_472.png =

+			}	=

+		}
+	} =

+}
+
+material tex_473 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_473.png =

+			}	=

+		}
+	} =

+}
+
+material tex_474 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_474.png =

+			}	=

+		}
+	} =

+}
+
+material tex_475 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_475.png =

+			}	=

+		}
+	} =

+}
+
+material tex_476 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_476.png =

+			}	=

+		}
+	} =

+}
+
+material tex_477 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_477.png =

+			}	=

+		}
+	} =

+}
+
+material tex_478 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_478.png =

+			}	=

+		}
+	} =

+}
+
+material tex_479 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_479.png =

+			}	=

+		}
+	} =

+}
+
+material tex_47 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_47.png =

+			}	=

+		}
+	} =

+}
+
+material tex_480 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_480.png =

+			}	=

+		}
+	} =

+}
+
+material tex_481 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_481.png =

+			}	=

+		}
+	} =

+}
+
+material tex_482 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_482.png =

+			}	=

+		}
+	} =

+}
+
+material tex_483 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_483.png =

+			}	=

+		}
+	} =

+}
+
+material tex_484 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_484.png =

+			}	=

+		}
+	} =

+}
+
+material tex_485 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_485.png =

+			}	=

+		}
+	} =

+}
+
+material tex_486 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_486.png =

+			}	=

+		}
+	} =

+}
+
+material tex_487 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_487.png =

+			}	=

+		}
+	} =

+}
+
+material tex_488 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_488.png =

+			}	=

+		}
+	} =

+}
+
+material tex_489 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_489.png =

+			}	=

+		}
+	} =

+}
+
+material tex_48 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_48.png =

+			}	=

+		}
+	} =

+}
+
+material tex_490 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_490.png =

+			}	=

+		}
+	} =

+}
+
+material tex_491 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_491.png =

+			}	=

+		}
+	} =

+}
+
+material tex_492 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_492.png =

+			}	=

+		}
+	} =

+}
+
+material tex_493 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_493.png =

+			}	=

+		}
+	} =

+}
+
+material tex_494 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_494.png =

+			}	=

+		}
+	} =

+}
+
+material tex_495 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_495.png =

+			}	=

+		}
+	} =

+}
+
+material tex_496 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_496.png =

+			}	=

+		}
+	} =

+}
+
+material tex_497 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_497.png =

+			}	=

+		}
+	} =

+}
+
+material tex_498 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_498.png =

+			}	=

+		}
+	} =

+}
+
+material tex_499 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_499.png =

+			}	=

+		}
+	} =

+}
+
+material tex_49 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_49.png =

+			}	=

+		}
+	} =

+}
+
+material tex_4 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_4.png =

+			}	=

+		}
+	} =

+}
+
+material tex_500 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_500.png =

+			}	=

+		}
+	} =

+}
+
+material tex_501 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_501.png =

+			}	=

+		}
+	} =

+}
+
+material tex_502 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_502.png =

+			}	=

+		}
+	} =

+}
+
+material tex_503 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_503.png =

+			}	=

+		}
+	} =

+}
+
+material tex_504 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_504.png =

+			}	=

+		}
+	} =

+}
+
+material tex_505 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_505.png =

+			}	=

+		}
+	} =

+}
+
+material tex_506 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_506.png =

+			}	=

+		}
+	} =

+}
+
+material tex_507 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_507.png =

+			}	=

+		}
+	} =

+}
+
+material tex_508 : tex_base_alpha
+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_508.png =

+			}	=

+		}
+	} =

+}
+
+material tex_509 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_509.png =

+			}	=

+		}
+	} =

+}
+
+material tex_50 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_50.png =

+			}	=

+		}
+	} =

+}
+
+material tex_510 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_510.png =

+			}	=

+		}
+	} =

+}
+
+material tex_511 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_511.png =

+			}	=

+		}
+	} =

+}
+
+material tex_512 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_512.png =

+			}	=

+		}
+	} =

+}
+
+material tex_513 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_513.png =

+			}	=

+		}
+	} =

+}
+
+material tex_514 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_514.png =

+			}	=

+		}
+	} =

+}
+
+material tex_515 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_515.png =

+			}	=

+		}
+	} =

+}
+
+material tex_516 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_516.png =

+			}	=

+		}
+	} =

+}
+
+material tex_517 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_517.png =

+			}	=

+		}
+	} =

+}
+
+material tex_518 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_518.png =

+			}	=

+		}
+	} =

+}
+
+material tex_519 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_519.png =

+			}	=

+		}
+	} =

+}
+
+material tex_51 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_51.png =

+			}	=

+		}
+	} =

+}
+
+material tex_520 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_520.png =

+			}	=

+		}
+	} =

+}
+
+material tex_521 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_521.png =

+			}	=

+		}
+	} =

+}
+
+material tex_522 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_522.png =

+			}	=

+		}
+	} =

+}
+
+material tex_523 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_523.png =

+			}	=

+		}
+	} =

+}
+
+material tex_524 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_524.png =

+			}	=

+		}
+	} =

+}
+
+material tex_525 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_525.png =

+			}	=

+		}
+	} =

+}
+
+material tex_526 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_526.png =

+			}	=

+		}
+	} =

+}
+
+material tex_527 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_527.png =

+			}	=

+		}
+	} =

+}
+
+material tex_528 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_528.png =

+			}	=

+		}
+	} =

+}
+
+material tex_529 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_529.png =

+			}	=

+		}
+	} =

+}
+
+material tex_52 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_52.png =

+			}	=

+		}
+	} =

+}
+
+material tex_530 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_530.png =

+			}	=

+		}
+	} =

+}
+
+material tex_531 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_531.png =

+			}	=

+		}
+	} =

+}
+
+material tex_532 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_532.png =

+			}	=

+		}
+	} =

+}
+
+material tex_533 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_533.png =

+			}	=

+		}
+	} =

+}
+
+material tex_534 : tex_base_alpha
+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_534.png =

+			}	=

+		}
+	} =

+}
+
+material tex_535 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_535.png =

+			}	=

+		}
+	} =

+}
+
+material tex_536 : tex_base_alpha
+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_536.png =

+			}	=

+		}
+	} =

+}
+
+material tex_537 : tex_base_alpha
+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_537.png =

+			}	=

+		}
+	} =

+}
+
+material tex_538 : tex_base_alpha
+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_538.png =

+			}	=

+		}
+	} =

+}
+
+material tex_539 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_539.png =

+			}	=

+		}
+	} =

+}
+
+material tex_53 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_53.png =

+			}	=

+		}
+	} =

+}
+
+material tex_540 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_540.png =

+			}	=

+		}
+	} =

+}
+
+material tex_541 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_541.png =

+			}	=

+		}
+	} =

+}
+
+material tex_542 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_542.png =

+			}	=

+		}
+	} =

+}
+
+material tex_543 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_543.png =

+			}	=

+		}
+	} =

+}
+
+material tex_544 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_544.png =

+			}	=

+		}
+	} =

+}
+
+material tex_545 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_545.png =

+			}	=

+		}
+	} =

+}
+
+material tex_546 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_546.png =

+			}	=

+		}
+	} =

+}
+
+material tex_547 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_547.png =

+			}	=

+		}
+	} =

+}
+
+material tex_548 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_548.png =

+			}	=

+		}
+	} =

+}
+
+material tex_549 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_549.png =

+			}	=

+		}
+	} =

+}
+
+material tex_54 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_54.png =

+			}	=

+		}
+	} =

+}
+
+material tex_550 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_550.png =

+			}	=

+		}
+	} =

+}
+
+material tex_551 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_551.png =

+			}	=

+		}
+	} =

+}
+
+material tex_552 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_552.png =

+			}	=

+		}
+	} =

+}
+
+material tex_553 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_553.png =

+			}	=

+		}
+	} =

+}
+
+material tex_554 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_554.png =

+			}	=

+		}
+	} =

+}
+
+material tex_555 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_555.png =

+			}	=

+		}
+	} =

+}
+
+material tex_556 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_556.png =

+			}	=

+		}
+	} =

+}
+
+material tex_557 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_557.png =

+			}	=

+		}
+	} =

+}
+
+material tex_558 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_558.png =

+			}	=

+		}
+	} =

+}
+
+material tex_559 : tex_base_alpha
+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_559.png =

+			}	=

+		}
+	} =

+}
+
+material tex_55 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_55.png =

+			}	=

+		}
+	} =

+}
+
+material tex_560 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_560.png =

+			}	=

+		}
+	} =

+}
+
+material tex_561 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_561.png =

+			}	=

+		}
+	} =

+}
+
+material tex_562 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_562.png =

+			}	=

+		}
+	} =

+}
+
+material tex_563 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_563.png =

+			}	=

+		}
+	} =

+}
+
+material tex_564 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_564.png =

+			}	=

+		}
+	} =

+}
+
+material tex_565 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_565.png =

+			}	=

+		}
+	} =

+}
+
+material tex_566 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_566.png =

+			}	=

+		}
+	} =

+}
+
+material tex_567 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_567.png =

+			}	=

+		}
+	} =

+}
+
+material tex_568 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_568.png =

+			}	=

+		}
+	} =

+}
+
+material tex_569 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_569.png =

+			}	=

+		}
+	} =

+}
+
+material tex_56 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_56.png =

+			}	=

+		}
+	} =

+}
+
+material tex_570 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_570.png =

+			}	=

+		}
+	} =

+}
+
+material tex_571 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_571.png =

+			}	=

+		}
+	} =

+}
+
+material tex_572 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_572.png =

+			}	=

+		}
+	} =

+}
+
+material tex_57 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_57.png =

+			}	=

+		}
+	} =

+}
+
+material tex_58 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_58.png =

+			}	=

+		}
+	} =

+}
+
+material tex_59 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_59.png =

+			}	=

+		}
+	} =

+}
+
+material tex_5 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_5.png =

+			}	=

+		}
+	} =

+}
+
+material tex_60 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_60.png =

+			}	=

+		}
+	} =

+}
+
+material tex_61 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_61.png =

+			}	=

+		}
+	} =

+}
+
+material tex_62 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_62.png =

+			}	=

+		}
+	} =

+}
+
+material tex_63 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_63.png =

+			}	=

+		}
+	} =

+}
+
+material tex_64 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_64.png =

+			}	=

+		}
+	} =

+}
+
+material tex_65 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_65.png =

+			}	=

+		}
+	} =

+}
+
+material tex_66 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_66.png =

+			}	=

+		}
+	} =

+}
+
+material tex_67 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_67.png =

+			}	=

+		}
+	} =

+}
+
+material tex_68 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_68.png =

+			}	=

+		}
+	} =

+}
+
+material tex_69 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_69.png =

+			}	=

+		}
+	} =

+}
+
+material tex_6 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_6.png =

+			}	=

+		}
+	} =

+}
+
+material tex_70 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_70.png =

+			}	=

+		}
+	} =

+}
+
+material tex_71 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_71.png =

+			}	=

+		}
+	} =

+}
+
+material tex_72 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_72.png =

+			}	=

+		}
+	} =

+}
+
+material tex_73 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_73.png =

+			}	=

+		}
+	} =

+}
+
+material tex_74 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_74.png =

+			}	=

+		}
+	} =

+}
+
+material tex_75 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_75.png =

+			}	=

+		}
+	} =

+}
+
+material tex_76 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_76.png =

+			}	=

+		}
+	} =

+}
+
+material tex_77 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_77.png =

+			}	=

+		}
+	} =

+}
+
+material tex_78 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_78.png =

+			}	=

+		}
+	} =

+}
+
+material tex_79 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_79.png =

+			}	=

+		}
+	} =

+}
+
+material tex_7 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_7.png =

+			}	=

+		}
+	} =

+}
+
+material tex_80 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_80.png =

+			}	=

+		}
+	} =

+}
+
+material tex_81 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_81.png =

+			}	=

+		}
+	} =

+}
+
+material tex_82 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_82.png =

+			}	=

+		}
+	} =

+}
+
+material tex_83 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_83.png =

+			}	=

+		}
+	} =

+}
+
+material tex_84 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_84.png =

+			}	=

+		}
+	} =

+}
+
+material tex_85 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_85.png =

+			}	=

+		}
+	} =

+}
+
+material tex_86 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_86.png =

+			}	=

+		}
+	} =

+}
+
+material tex_87 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_87.png =

+			}	=

+		}
+	} =

+}
+
+material tex_88 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_88.png =

+			}	=

+		}
+	} =

+}
+
+material tex_89 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_89.png =

+			}	=

+		}
+	} =

+}
+
+material tex_8 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_8.png =

+			}	=

+		}
+	} =

+}
+
+material tex_90 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_90.png =

+			}	=

+		}
+	} =

+}
+
+material tex_91 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_91.png =

+			}	=

+		}
+	} =

+}
+
+material tex_92 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_92.png =

+			}	=

+		}
+	} =

+}
+
+material tex_93 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_93.png =

+			}	=

+		}
+	} =

+}
+
+material tex_94 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_94.png =

+			}	=

+		}
+	} =

+}
+
+material tex_95 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_95.png =

+			}	=

+		}
+	} =

+}
+
+material tex_96 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_96.png =

+			}	=

+		}
+	} =

+}
+
+material tex_97 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_97.png =

+			}	=

+		}
+	} =

+}
+
+material tex_98 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_98.png =

+			}	=

+		}
+	} =

+}
+
+material tex_99 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_99.png =

+			}	=

+		}
+	} =

+}
+
+material tex_9 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_9.png =

+			}	=

+		}
+	} =

+}
+
+material tex_996 : tex_base_alpha
+{ =

+	technique
+	{ =

+		pass
+		{		=

 			texture_unit
-			{
-				filtering anisotropic =

-				max_anisotropy 8
-				texture checker.png
-			}
-		}
-	}
-}
-
-// #################################################################
-
-material tex_0 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_0.png =

-			}	=

-		}
-	} =

-}
-
-material tex_100 : tex_base
-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_100.png =

-			}	=

-		}
-	} =

-}
-
-material tex_101 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_101.png =

-			}	=

-		}
-	} =

-}
-
-material tex_102 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_102.png =

-			}	=

-		}
-	} =

-}
-
-material tex_103 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_103.png =

-			}	=

-		}
-	} =

-}
-
-material tex_104 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_104.png =

-			}	=

-		}
-	} =

-}
-
-material tex_105 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_105.png =

-			}	=

-		}
-	} =

-}
-
-material tex_106 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_106.png =

-			}	=

-		}
-	} =

-}
-
-material tex_107 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_107.png =

-			}	=

-		}
-	} =

-}
-
-material tex_108 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_108.png =

-			}	=

-		}
-	} =

-}
-
-material tex_109 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_109.png =

-			}	=

-		}
-	} =

-}
-
-material tex_10 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_10.png =

-			}	=

-		}
-	} =

-}
-
-material tex_110 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_110.png =

-			}	=

-		}
-	} =

-}
-
-material tex_111 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_111.png =

-			}	=

-		}
-	} =

-}
-
-material tex_112 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_112.png =

-			}	=

-		}
-	} =

-}
-
-material tex_113 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_113.png =

-			}	=

-		}
-	} =

-}
-
-material tex_114 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_114.png =

-			}	=

-		}
-	} =

-}
-
-material tex_115 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_115.png =

-			}	=

-		}
-	} =

-}
-
-material tex_116 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_116.png =

-			}	=

-		}
-	} =

-}
-
-material tex_117 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_117.png =

-			}	=

-		}
-	} =

-}
-
-material tex_118 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_118.png =

-			}	=

-		}
-	} =

-}
-
-material tex_119 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_119.png =

-			}	=

-		}
-	} =

-}
-
-material tex_11 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_11.png =

-			}	=

-		}
-	} =

-}
-
-material tex_120 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_120.png =

-			}	=

-		}
-	} =

-}
-
-material tex_121 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_121.png =

-			}	=

-		}
-	} =

-}
-
-material tex_122 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_122.png =

-			}	=

-		}
-	} =

-}
-
-material tex_123 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_123.png =

-			}	=

-		}
-	} =

-}
-
-material tex_124 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_124.png =

-			}	=

-		}
-	} =

-}
-
-material tex_125 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_125.png =

-			}	=

-		}
-	} =

-}
-
-material tex_126 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_126.png =

-			}	=

-		}
-	} =

-}
-
-material tex_127 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_127.png =

-			}	=

-		}
-	} =

-}
-
-material tex_128 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_128.png =

-			}	=

-		}
-	} =

-}
-
-material tex_129 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_129.png =

-			}	=

-		}
-	} =

-}
-
-material tex_12 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_12.png =

-			}	=

-		}
-	} =

-}
-
-material tex_130 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_130.png =

-			}	=

-		}
-	} =

-}
-
-material tex_131 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_131.png =

-			}	=

-		}
-	} =

-}
-
-material tex_132 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_132.png =

-			}	=

-		}
-	} =

-}
-
-material tex_133 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_133.png =

-			}	=

-		}
-	} =

-}
-
-material tex_134 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_134.png =

-			}	=

-		}
-	} =

-}
-
-material tex_135 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_135.png =

-			}	=

-		}
-	} =

-}
-
-material tex_136 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_136.png =

-			}	=

-		}
-	} =

-}
-
-material tex_137 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_137.png =

-			}	=

-		}
-	} =

-}
-
-material tex_138 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_138.png =

-			}	=

-		}
-	} =

-}
-
-material tex_139 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_139.png =

-			}	=

-		}
-	} =

-}
-
-material tex_13 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_13.png =

-			}	=

-		}
-	} =

-}
-
-material tex_140 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_140.png =

-			}	=

-		}
-	} =

-}
-
-material tex_141 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_141.png =

-			}	=

-		}
-	} =

-}
-
-material tex_142 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_142.png =

-			}	=

-		}
-	} =

-}
-
-material tex_143 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_143.png =

-			}	=

-		}
-	} =

-}
-
-material tex_144 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_144.png =

-			}	=

-		}
-	} =

-}
-
-material tex_145 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_145.png =

-			}	=

-		}
-	} =

-}
-
-material tex_146 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_146.png =

-			}	=

-		}
-	} =

-}
-
-material tex_147 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_147.png =

-			}	=

-		}
-	} =

-}
-
-material tex_148 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_148.png =

-			}	=

-		}
-	} =

-}
-
-material tex_149 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_149.png =

-			}	=

-		}
-	} =

-}
-
-material tex_14 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_14.png =

-			}	=

-		}
-	} =

-}
-
-material tex_150 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_150.png =

-			}	=

-		}
-	} =

-}
-
-material tex_151 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_151.png =

-			}	=

-		}
-	} =

-}
-
-material tex_152 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_152.png =

-			}	=

-		}
-	} =

-}
-
-material tex_153 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_153.png =

-			}	=

-		}
-	} =

-}
-
-material tex_154 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_154.png =

-			}	=

-		}
-	} =

-}
-
-material tex_155 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_155.png =

-			}	=

-		}
-	} =

-}
-
-material tex_156 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_156.png =

-			}	=

-		}
-	} =

-}
-
-material tex_157 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_157.png =

-			}	=

-		}
-	} =

-}
-
-material tex_158 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_158.png =

-			}	=

-		}
-	} =

-}
-
-material tex_159 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_159.png =

-			}	=

-		}
-	} =

-}
-
-material tex_15 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_15.png =

-			}	=

-		}
-	} =

-}
-
-material tex_160 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_160.png =

-			}	=

-		}
-	} =

-}
-
-material tex_161 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_161.png =

-			}	=

-		}
-	} =

-}
-
-material tex_162 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_162.png =

-			}	=

-		}
-	} =

-}
-
-material tex_163 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_163.png =

-			}	=

-		}
-	} =

-}
-
-material tex_164 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_164.png =

-			}	=

-		}
-	} =

-}
-
-material tex_165 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_165.png =

-			}	=

-		}
-	} =

-}
-
-material tex_166 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_166.png =

-			}	=

-		}
-	} =

-}
-
-material tex_167 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_167.png =

-			}	=

-		}
-	} =

-}
-
-material tex_168 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_168.png =

-			}	=

-		}
-	} =

-}
-
-material tex_169 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_169.png =

-			}	=

-		}
-	} =

-}
-
-material tex_16 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_16.png =

-			}	=

-		}
-	} =

-}
-
-material tex_170 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_170.png =

-			}	=

-		}
-	} =

-}
-
-material tex_171 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_171.png =

-			}	=

-		}
-	} =

-}
-
-material tex_172 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_172.png =

-			}	=

-		}
-	} =

-}
-
-material tex_173 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_173.png =

-			}	=

-		}
-	} =

-}
-
-material tex_174 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_174.png =

-			}	=

-		}
-	} =

-}
-
-material tex_175 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_175.png =

-			}	=

-		}
-	} =

-}
-
-material tex_176 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_176.png =

-			}	=

-		}
-	} =

-}
-
-material tex_177 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_177.png =

-			}	=

-		}
-	} =

-}
-
-material tex_178 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_178.png =

-			}	=

-		}
-	} =

-}
-
-material tex_179 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_179.png =

-			}	=

-		}
-	} =

-}
-
-material tex_17 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_17.png =

-			}	=

-		}
-	} =

-}
-
-material tex_180 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_180.png =

-			}	=

-		}
-	} =

-}
-
-material tex_181 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_181.png =

-			}	=

-		}
-	} =

-}
-
-material tex_182 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_182.png =

-			}	=

-		}
-	} =

-}
-
-material tex_183 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_183.png =

-			}	=

-		}
-	} =

-}
-
-material tex_184 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_184.png =

-			}	=

-		}
-	} =

-}
-
-material tex_185 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_185.png =

-			}	=

-		}
-	} =

-}
-
-material tex_186 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_186.png =

-			}	=

-		}
-	} =

-}
-
-material tex_187 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_187.png =

-			}	=

-		}
-	} =

-}
-
-material tex_188 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_188.png =

-			}	=

-		}
-	} =

-}
-
-material tex_189 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_189.png =

-			}	=

-		}
-	} =

-}
-
-material tex_18 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_18.png =

-			}	=

-		}
-	} =

-}
-
-material tex_190 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_190.png =

-			}	=

-		}
-	} =

-}
-
-material tex_191 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_191.png =

-			}	=

-		}
-	} =

-}
-
-material tex_192 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_192.png =

-			}	=

-		}
-	} =

-}
-
-material tex_193 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_193.png =

-			}	=

-		}
-	} =

-}
-
-material tex_194 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_194.png =

-			}	=

-		}
-	} =

-}
-
-material tex_195 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_195.png =

-			}	=

-		}
-	} =

-}
-
-material tex_196 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_196.png =

-			}	=

-		}
-	} =

-}
-
-material tex_197 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_197.png =

-			}	=

-		}
-	} =

-}
-
-material tex_198 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_198.png =

-			}	=

-		}
-	} =

-}
-
-material tex_199 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_199.png =

-			}	=

-		}
-	} =

-}
-
-material tex_19 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_19.png =

-			}	=

-		}
-	} =

-}
-
-material tex_1 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_1.png =

-			}	=

-		}
-	} =

-}
-
-material tex_200 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_200.png =

-			}	=

-		}
-	} =

-}
-
-material tex_201 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_201.png =

-			}	=

-		}
-	} =

-}
-
-material tex_202 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_202.png =

-			}	=

-		}
-	} =

-}
-
-material tex_203 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_203.png =

-			}	=

-		}
-	} =

-}
-
-material tex_204 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_204.png =

-			}	=

-		}
-	} =

-}
-
-material tex_205 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_205.png =

-			}	=

-		}
-	} =

-}
-
-material tex_206 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_206.png =

-			}	=

-		}
-	} =

-}
-
-material tex_207 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_207.png =

-			}	=

-		}
-	} =

-}
-
-material tex_208 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_208.png =

-			}	=

-		}
-	} =

-}
-
-material tex_209 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_209.png =

-			}	=

-		}
-	} =

-}
-
-material tex_20 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_20.png =

-			}	=

-		}
-	} =

-}
-
-material tex_210 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_210.png =

-			}	=

-		}
-	} =

-}
-
-material tex_211 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_211.png =

-			}	=

-		}
-	} =

-}
-
-material tex_212 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_212.png =

-			}	=

-		}
-	} =

-}
-
-material tex_213 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_213.png =

-			}	=

-		}
-	} =

-}
-
-material tex_214 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_214.png =

-			}	=

-		}
-	} =

-}
-
-material tex_215 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_215.png =

-			}	=

-		}
-	} =

-}
-
-material tex_216 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_216.png =

-			}	=

-		}
-	} =

-}
-
-material tex_217 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_217.png =

-			}	=

-		}
-	} =

-}
-
-material tex_218 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_218.png =

-			}	=

-		}
-	} =

-}
-
-material tex_219 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_219.png =

-			}	=

-		}
-	} =

-}
-
-material tex_21 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_21.png =

-			}	=

-		}
-	} =

-}
-
-material tex_220 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_220.png =

-			}	=

-		}
-	} =

-}
-
-material tex_221 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_221.png =

-			}	=

-		}
-	} =

-}
-
-material tex_222 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_222.png =

-			}	=

-		}
-	} =

-}
-
-material tex_223 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_223.png =

-			}	=

-		}
-	} =

-}
-
-material tex_224 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_224.png =

-			}	=

-		}
-	} =

-}
-
-material tex_225 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_225.png =

-			}	=

-		}
-	} =

-}
-
-material tex_226 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_226.png =

-			}	=

-		}
-	} =

-}
-
-material tex_227 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_227.png =

-			}	=

-		}
-	} =

-}
-
-material tex_228 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_228.png =

-			}	=

-		}
-	} =

-}
-
-material tex_229 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_229.png =

-			}	=

-		}
-	} =

-}
-
-material tex_22 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_22.png =

-			}	=

-		}
-	} =

-}
-
-material tex_230 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_230.png =

-			}	=

-		}
-	} =

-}
-
-material tex_231 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_231.png =

-			}	=

-		}
-	} =

-}
-
-material tex_232 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_232.png =

-			}	=

-		}
-	} =

-}
-
-material tex_233 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_233.png =

-			}	=

-		}
-	} =

-}
-
-material tex_234 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_234.png =

-			}	=

-		}
-	} =

-}
-
-material tex_235 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_235.png =

-			}	=

-		}
-	} =

-}
-
-material tex_236 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_236.png =

-			}	=

-		}
-	} =

-}
-
-material tex_237 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_237.png =

-			}	=

-		}
-	} =

-}
-
-material tex_238 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_238.png =

-			}	=

-		}
-	} =

-}
-
-material tex_239 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_239.png =

-			}	=

-		}
-	} =

-}
-
-material tex_23 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_23.png =

-			}	=

-		}
-	} =

-}
-
-material tex_240 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_240.png =

-			}	=

-		}
-	} =

-}
-
-material tex_241 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_241.png =

-			}	=

-		}
-	} =

-}
-
-material tex_242 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_242.png =

-			}	=

-		}
-	} =

-}
-
-material tex_243 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_243.png =

-			}	=

-		}
-	} =

-}
-
-material tex_244 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_244.png =

-			}	=

-		}
-	} =

-}
-
-material tex_245 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_245.png =

-			}	=

-		}
-	} =

-}
-
-material tex_246 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_246.png =

-			}	=

-		}
-	} =

-}
-
-material tex_247 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_247.png =

-			}	=

-		}
-	} =

-}
-
-material tex_248 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_248.png =

-			}	=

-		}
-	} =

-}
-
-material tex_249 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_249.png =

-			}	=

-		}
-	} =

-}
-
-material tex_24 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_24.png =

-			}	=

-		}
-	} =

-}
-
-material tex_250 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_250.png =

-			}	=

-		}
-	} =

-}
-
-material tex_251 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_251.png =

-			}	=

-		}
-	} =

-}
-
-material tex_252 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_252.png =

-			}	=

-		}
-	} =

-}
-
-material tex_253 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_253.png =

-			}	=

-		}
-	} =

-}
-
-material tex_254 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_254.png =

-			}	=

-		}
-	} =

-}
-
-material tex_255 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_255.png =

-			}	=

-		}
-	} =

-}
-
-material tex_256 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_256.png =

-			}	=

-		}
-	} =

-}
-
-material tex_257 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_257.png =

-			}	=

-		}
-	} =

-}
-
-material tex_258 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_258.png =

-			}	=

-		}
-	} =

-}
-
-material tex_259 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_259.png =

-			}	=

-		}
-	} =

-}
-
-material tex_25 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_25.png =

-			}	=

-		}
-	} =

-}
-
-material tex_260 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_260.png =

-			}	=

-		}
-	} =

-}
-
-material tex_261 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_261.png =

-			}	=

-		}
-	} =

-}
-
-material tex_262 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_262.png =

-			}	=

-		}
-	} =

-}
-
-material tex_263 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_263.png =

-			}	=

-		}
-	} =

-}
-
-material tex_264 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_264.png =

-			}	=

-		}
-	} =

-}
-
-material tex_265 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_265.png =

-			}	=

-		}
-	} =

-}
-
-material tex_266 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_266.png =

-			}	=

-		}
-	} =

-}
-
-material tex_267 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_267.png =

-			}	=

-		}
-	} =

-}
-
-material tex_268 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_268.png =

-			}	=

-		}
-	} =

-}
-
-material tex_269 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_269.png =

-			}	=

-		}
-	} =

-}
-
-material tex_26 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_26.png =

-			}	=

-		}
-	} =

-}
-
-material tex_270 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_270.png =

-			}	=

-		}
-	} =

-}
-
-material tex_271 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_271.png =

-			}	=

-		}
-	} =

-}
-
-material tex_272 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_272.png =

-			}	=

-		}
-	} =

-}
-
-material tex_273 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_273.png =

-			}	=

-		}
-	} =

-}
-
-material tex_274 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_274.png =

-			}	=

-		}
-	} =

-}
-
-material tex_275 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_275.png =

-			}	=

-		}
-	} =

-}
-
-material tex_276 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_276.png =

-			}	=

-		}
-	} =

-}
-
-material tex_277 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_277.png =

-			}	=

-		}
-	} =

-}
-
-material tex_278 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_278.png =

-			}	=

-		}
-	} =

-}
-
-material tex_279 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_279.png =

-			}	=

-		}
-	} =

-}
-
-material tex_27 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_27.png =

-			}	=

-		}
-	} =

-}
-
-material tex_280 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_280.png =

-			}	=

-		}
-	} =

-}
-
-material tex_281 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_281.png =

-			}	=

-		}
-	} =

-}
-
-material tex_282 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_282.png =

-			}	=

-		}
-	} =

-}
-
-material tex_283 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_283.png =

-			}	=

-		}
-	} =

-}
-
-material tex_284 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_284.png =

-			}	=

-		}
-	} =

-}
-
-material tex_285 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_285.png =

-			}	=

-		}
-	} =

-}
-
-material tex_286 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_286.png =

-			}	=

-		}
-	} =

-}
-
-material tex_287 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_287.png =

-			}	=

-		}
-	} =

-}
-
-material tex_288 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_288.png =

-			}	=

-		}
-	} =

-}
-
-material tex_289 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_289.png =

-			}	=

-		}
-	} =

-}
-
-material tex_28 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_28.png =

-			}	=

-		}
-	} =

-}
-
-material tex_290 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_290.png =

-			}	=

-		}
-	} =

-}
-
-material tex_291 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_291.png =

-			}	=

-		}
-	} =

-}
-
-material tex_292 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_292.png =

-			}	=

-		}
-	} =

-}
-
-material tex_293 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_293.png =

-			}	=

-		}
-	} =

-}
-
-material tex_294 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_294.png =

-			}	=

-		}
-	} =

-}
-
-material tex_295 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_295.png =

-			}	=

-		}
-	} =

-}
-
-material tex_296 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_296.png =

-			}	=

-		}
-	} =

-}
-
-material tex_297 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_297.png =

-			}	=

-		}
-	} =

-}
-
-material tex_298 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_298.png =

-			}	=

-		}
-	} =

-}
-
-material tex_299 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_299.png =

-			}	=

-		}
-	} =

-}
-
-material tex_29 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_29.png =

-			}	=

-		}
-	} =

-}
-
-material tex_2 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_2.png =

-			}	=

-		}
-	} =

-}
-
-material tex_300 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_300.png =

-			}	=

-		}
-	} =

-}
-
-material tex_301 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_301.png =

-			}	=

-		}
-	} =

-}
-
-material tex_302 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_302.png =

-			}	=

-		}
-	} =

-}
-
-material tex_303 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_303.png =

-			}	=

-		}
-	} =

-}
-
-material tex_304 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_304.png =

-			}	=

-		}
-	} =

-}
-
-material tex_305 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_305.png =

-			}	=

-		}
-	} =

-}
-
-material tex_306 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_306.png =

-			}	=

-		}
-	} =

-}
-
-material tex_307 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_307.png =

-			}	=

-		}
-	} =

-}
-
-material tex_308 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_308.png =

-			}	=

-		}
-	} =

-}
-
-material tex_309 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_309.png =

-			}	=

-		}
-	} =

-}
-
-material tex_30 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_30.png =

-			}	=

-		}
-	} =

-}
-
-material tex_310 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_310.png =

-			}	=

-		}
-	} =

-}
-
-material tex_311 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_311.png =

-			}	=

-		}
-	} =

-}
-
-material tex_312 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_312.png =

-			}	=

-		}
-	} =

-}
-
-material tex_313 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_313.png =

-			}	=

-		}
-	} =

-}
-
-material tex_314 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_314.png =

-			}	=

-		}
-	} =

-}
-
-material tex_315 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_315.png =

-			}	=

-		}
-	} =

-}
-
-material tex_316 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_316.png =

-			}	=

-		}
-	} =

-}
-
-material tex_317 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_317.png =

-			}	=

-		}
-	} =

-}
-
-material tex_318 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_318.png =

-			}	=

-		}
-	} =

-}
-
-material tex_319 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_319.png =

-			}	=

-		}
-	} =

-}
-
-material tex_31 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_31.png =

-			}	=

-		}
-	} =

-}
-
-material tex_320 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_320.png =

-			}	=

-		}
-	} =

-}
-
-material tex_321 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_321.png =

-			}	=

-		}
-	} =

-}
-
-material tex_322 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_322.png =

-			}	=

-		}
-	} =

-}
-
-material tex_323 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_323.png =

-			}	=

-		}
-	} =

-}
-
-material tex_324 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_324.png =

-			}	=

-		}
-	} =

-}
-
-material tex_325 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_325.png =

-			}	=

-		}
-	} =

-}
-
-material tex_326 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_326.png =

-			}	=

-		}
-	} =

-}
-
-material tex_327 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_327.png =

-			}	=

-		}
-	} =

-}
-
-material tex_328 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_328.png =

-			}	=

-		}
-	} =

-}
-
-material tex_329 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_329.png =

-			}	=

-		}
-	} =

-}
-
-material tex_32 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_32.png =

-			}	=

-		}
-	} =

-}
-
-material tex_330 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_330.png =

-			}	=

-		}
-	} =

-}
-
-material tex_331 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_331.png =

-			}	=

-		}
-	} =

-}
-
-material tex_332 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_332.png =

-			}	=

-		}
-	} =

-}
-
-material tex_333 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_333.png =

-			}	=

-		}
-	} =

-}
-
-material tex_334 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_334.png =

-			}	=

-		}
-	} =

-}
-
-material tex_335 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_335.png =

-			}	=

-		}
-	} =

-}
-
-material tex_336 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_336.png =

-			}	=

-		}
-	} =

-}
-
-material tex_337 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_337.png =

-			}	=

-		}
-	} =

-}
-
-material tex_338 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_338.png =

-			}	=

-		}
-	} =

-}
-
-material tex_339 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_339.png =

-			}	=

-		}
-	} =

-}
-
-material tex_33 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_33.png =

-			}	=

-		}
-	} =

-}
-
-material tex_340 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_340.png =

-			}	=

-		}
-	} =

-}
-
-material tex_341 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_341.png =

-			}	=

-		}
-	} =

-}
-
-material tex_342 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_342.png =

-			}	=

-		}
-	} =

-}
-
-material tex_343 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_343.png =

-			}	=

-		}
-	} =

-}
-
-material tex_344 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_344.png =

-			}	=

-		}
-	} =

-}
-
-material tex_345 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_345.png =

-			}	=

-		}
-	} =

-}
-
-material tex_346 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_346.png =

-			}	=

-		}
-	} =

-}
-
-material tex_347 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_347.png =

-			}	=

-		}
-	} =

-}
-
-material tex_348 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_348.png =

-			}	=

-		}
-	} =

-}
-
-material tex_349 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_349.png =

-			}	=

-		}
-	} =

-}
-
-material tex_34 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_34.png =

-			}	=

-		}
-	} =

-}
-
-material tex_350 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_350.png =

-			}	=

-		}
-	} =

-}
-
-material tex_351 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_351.png =

-			}	=

-		}
-	} =

-}
-
-material tex_352 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_352.png =

-			}	=

-		}
-	} =

-}
-
-material tex_353 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_353.png =

-			}	=

-		}
-	} =

-}
-
-material tex_354 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_354.png =

-			}	=

-		}
-	} =

-}
-
-material tex_355 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_355.png =

-			}	=

-		}
-	} =

-}
-
-material tex_356 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_356.png =

-			}	=

-		}
-	} =

-}
-
-material tex_357 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_357.png =

-			}	=

-		}
-	} =

-}
-
-material tex_358 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_358.png =

-			}	=

-		}
-	} =

-}
-
-material tex_359 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_359.png =

-			}	=

-		}
-	} =

-}
-
-material tex_35 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_35.png =

-			}	=

-		}
-	} =

-}
-
-material tex_360 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_360.png =

-			}	=

-		}
-	} =

-}
-
-material tex_361 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_361.png =

-			}	=

-		}
-	} =

-}
-
-material tex_362 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_362.png =

-			}	=

-		}
-	} =

-}
-
-material tex_363 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_363.png =

-			}	=

-		}
-	} =

-}
-
-material tex_364 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_364.png =

-			}	=

-		}
-	} =

-}
-
-material tex_365 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_365.png =

-			}	=

-		}
-	} =

-}
-
-material tex_366 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_366.png =

-			}	=

-		}
-	} =

-}
-
-material tex_367 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_367.png =

-			}	=

-		}
-	} =

-}
-
-material tex_368 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_368.png =

-			}	=

-		}
-	} =

-}
-
-material tex_369 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_369.png =

-			}	=

-		}
-	} =

-}
-
-material tex_36 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_36.png =

-			}	=

-		}
-	} =

-}
-
-material tex_370 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_370.png =

-			}	=

-		}
-	} =

-}
-
-material tex_371 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_371.png =

-			}	=

-		}
-	} =

-}
-
-material tex_372 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_372.png =

-			}	=

-		}
-	} =

-}
-
-material tex_373 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_373.png =

-			}	=

-		}
-	} =

-}
-
-material tex_374 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_374.png =

-			}	=

-		}
-	} =

-}
-
-material tex_375 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_375.png =

-			}	=

-		}
-	} =

-}
-
-material tex_376 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_376.png =

-			}	=

-		}
-	} =

-}
-
-material tex_377 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_377.png =

-			}	=

-		}
-	} =

-}
-
-material tex_378 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_378.png =

-			}	=

-		}
-	} =

-}
-
-material tex_379 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_379.png =

-			}	=

-		}
-	} =

-}
-
-material tex_37 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_37.png =

-			}	=

-		}
-	} =

-}
-
-material tex_380 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_380.png =

-			}	=

-		}
-	} =

-}
-
-material tex_381 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_381.png =

-			}	=

-		}
-	} =

-}
-
-material tex_382 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_382.png =

-			}	=

-		}
-	} =

-}
-
-material tex_383 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_383.png =

-			}	=

-		}
-	} =

-}
-
-material tex_384 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_384.png =

-			}	=

-		}
-	} =

-}
-
-material tex_385 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_385.png =

-			}	=

-		}
-	} =

-}
-
-material tex_386 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_386.png =

-			}	=

-		}
-	} =

-}
-
-material tex_387 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_387.png =

-			}	=

-		}
-	} =

-}
-
-material tex_388 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_388.png =

-			}	=

-		}
-	} =

-}
-
-material tex_389 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_389.png =

-			}	=

-		}
-	} =

-}
-
-material tex_38 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_38.png =

-			}	=

-		}
-	} =

-}
-
-material tex_390 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_390.png =

-			}	=

-		}
-	} =

-}
-
-material tex_391 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_391.png =

-			}	=

-		}
-	} =

-}
-
-material tex_392 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_392.png =

-			}	=

-		}
-	} =

-}
-
-material tex_393 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_393.png =

-			}	=

-		}
-	} =

-}
-
-material tex_394 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_394.png =

-			}	=

-		}
-	} =

-}
-
-material tex_395 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_395.png =

-			}	=

-		}
-	} =

-}
-
-material tex_396 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_396.png =

-			}	=

-		}
-	} =

-}
-
-material tex_397 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_397.png =

-			}	=

-		}
-	} =

-}
-
-material tex_398 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_398.png =

-			}	=

-		}
-	} =

-}
-
-material tex_399 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_399.png =

-			}	=

-		}
-	} =

-}
-
-material tex_39 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_39.png =

-			}	=

-		}
-	} =

-}
-
-material tex_3 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_3.png =

-			}	=

-		}
-	} =

-}
-
-material tex_400 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_400.png =

-			}	=

-		}
-	} =

-}
-
-material tex_401 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_401.png =

-			}	=

-		}
-	} =

-}
-
-material tex_402 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_402.png =

-			}	=

-		}
-	} =

-}
-
-material tex_403 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_403.png =

-			}	=

-		}
-	} =

-}
-
-material tex_404 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_404.png =

-			}	=

-		}
-	} =

-}
-
-material tex_405 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_405.png =

-			}	=

-		}
-	} =

-}
-
-material tex_406 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_406.png =

-			}	=

-		}
-	} =

-}
-
-material tex_407 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_407.png =

-			}	=

-		}
-	} =

-}
-
-material tex_408 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_408.png =

-			}	=

-		}
-	} =

-}
-
-material tex_409 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_409.png =

-			}	=

-		}
-	} =

-}
-
-material tex_40 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_40.png =

-			}	=

-		}
-	} =

-}
-
-material tex_410 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_410.png =

-			}	=

-		}
-	} =

-}
-
-material tex_411 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_411.png =

-			}	=

-		}
-	} =

-}
-
-material tex_412 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_412.png =

-			}	=

-		}
-	} =

-}
-
-material tex_413 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_413.png =

-			}	=

-		}
-	} =

-}
-
-material tex_414 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_414.png =

-			}	=

-		}
-	} =

-}
-
-material tex_415 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_415.png =

-			}	=

-		}
-	} =

-}
-
-material tex_416 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_416.png =

-			}	=

-		}
-	} =

-}
-
-material tex_417 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_417.png =

-			}	=

-		}
-	} =

-}
-
-material tex_418 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_418.png =

-			}	=

-		}
-	} =

-}
-
-material tex_419 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_419.png =

-			}	=

-		}
-	} =

-}
-
-material tex_41 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_41.png =

-			}	=

-		}
-	} =

-}
-
-material tex_420 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_420.png =

-			}	=

-		}
-	} =

-}
-
-material tex_421 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_421.png =

-			}	=

-		}
-	} =

-}
-
-material tex_422 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_422.png =

-			}	=

-		}
-	} =

-}
-
-material tex_423 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_423.png =

-			}	=

-		}
-	} =

-}
-
-material tex_424 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_424.png =

-			}	=

-		}
-	} =

-}
-
-material tex_425 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_425.png =

-			}	=

-		}
-	} =

-}
-
-material tex_426 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_426.png =

-			}	=

-		}
-	} =

-}
-
-material tex_427 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_427.png =

-			}	=

-		}
-	} =

-}
-
-material tex_428 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_428.png =

-			}	=

-		}
-	} =

-}
-
-material tex_429 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_429.png =

-			}	=

-		}
-	} =

-}
-
-material tex_42 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_42.png =

-			}	=

-		}
-	} =

-}
-
-material tex_430 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_430.png =

-			}	=

-		}
-	} =

-}
-
-material tex_431 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_431.png =

-			}	=

-		}
-	} =

-}
-
-material tex_432 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_432.png =

-			}	=

-		}
-	} =

-}
-
-material tex_433 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_433.png =

-			}	=

-		}
-	} =

-}
-
-material tex_434 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_434.png =

-			}	=

-		}
-	} =

-}
-
-material tex_435 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_435.png =

-			}	=

-		}
-	} =

-}
-
-material tex_436 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_436.png =

-			}	=

-		}
-	} =

-}
-
-material tex_437 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_437.png =

-			}	=

-		}
-	} =

-}
-
-material tex_438 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_438.png =

-			}	=

-		}
-	} =

-}
-
-material tex_439 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_439.png =

-			}	=

-		}
-	} =

-}
-
-material tex_43 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_43.png =

-			}	=

-		}
-	} =

-}
-
-material tex_440 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_440.png =

-			}	=

-		}
-	} =

-}
-
-material tex_441 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_441.png =

-			}	=

-		}
-	} =

-}
-
-material tex_442 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_442.png =

-			}	=

-		}
-	} =

-}
-
-material tex_443 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_443.png =

-			}	=

-		}
-	} =

-}
-
-material tex_444 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_444.png =

-			}	=

-		}
-	} =

-}
-
-material tex_445 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_445.png =

-			}	=

-		}
-	} =

-}
-
-material tex_446 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_446.png =

-			}	=

-		}
-	} =

-}
-
-material tex_447 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_447.png =

-			}	=

-		}
-	} =

-}
-
-material tex_448 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_448.png =

-			}	=

-		}
-	} =

-}
-
-material tex_449 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_449.png =

-			}	=

-		}
-	} =

-}
-
-material tex_44 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_44.png =

-			}	=

-		}
-	} =

-}
-
-material tex_450 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_450.png =

-			}	=

-		}
-	} =

-}
-
-material tex_451 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_451.png =

-			}	=

-		}
-	} =

-}
-
-material tex_452 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_452.png =

-			}	=

-		}
-	} =

-}
-
-material tex_453 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_453.png =

-			}	=

-		}
-	} =

-}
-
-material tex_454 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_454.png =

-			}	=

-		}
-	} =

-}
-
-material tex_455 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_455.png =

-			}	=

-		}
-	} =

-}
-
-material tex_456 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_456.png =

-			}	=

-		}
-	} =

-}
-
-material tex_457 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_457.png =

-			}	=

-		}
-	} =

-}
-
-material tex_458 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_458.png =

-			}	=

-		}
-	} =

-}
-
-material tex_459 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_459.png =

-			}	=

-		}
-	} =

-}
-
-material tex_45 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_45.png =

-			}	=

-		}
-	} =

-}
-
-material tex_460 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_460.png =

-			}	=

-		}
-	} =

-}
-
-material tex_461 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_461.png =

-			}	=

-		}
-	} =

-}
-
-material tex_462 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_462.png =

-			}	=

-		}
-	} =

-}
-
-material tex_463 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_463.png =

-			}	=

-		}
-	} =

-}
-
-material tex_464 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_464.png =

-			}	=

-		}
-	} =

-}
-
-material tex_465 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_465.png =

-			}	=

-		}
-	} =

-}
-
-material tex_466 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_466.png =

-			}	=

-		}
-	} =

-}
-
-material tex_467 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_467.png =

-			}	=

-		}
-	} =

-}
-
-material tex_468 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_468.png =

-			}	=

-		}
-	} =

-}
-
-material tex_469 : tex_base_alpha
-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_469.png =

-			}	=

-		}
-	} =

-}
-
-material tex_46 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_46.png =

-			}	=

-		}
-	} =

-}
-
-material tex_470 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_470.png =

-			}	=

-		}
-	} =

-}
-
-material tex_471 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_471.png =

-			}	=

-		}
-	} =

-}
-
-material tex_472 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_472.png =

-			}	=

-		}
-	} =

-}
-
-material tex_473 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_473.png =

-			}	=

-		}
-	} =

-}
-
-material tex_474 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_474.png =

-			}	=

-		}
-	} =

-}
-
-material tex_475 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_475.png =

-			}	=

-		}
-	} =

-}
-
-material tex_476 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_476.png =

-			}	=

-		}
-	} =

-}
-
-material tex_477 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_477.png =

-			}	=

-		}
-	} =

-}
-
-material tex_478 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_478.png =

-			}	=

-		}
-	} =

-}
-
-material tex_479 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_479.png =

-			}	=

-		}
-	} =

-}
-
-material tex_47 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_47.png =

-			}	=

-		}
-	} =

-}
-
-material tex_480 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_480.png =

-			}	=

-		}
-	} =

-}
-
-material tex_481 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_481.png =

-			}	=

-		}
-	} =

-}
-
-material tex_482 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_482.png =

-			}	=

-		}
-	} =

-}
-
-material tex_483 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_483.png =

-			}	=

-		}
-	} =

-}
-
-material tex_484 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_484.png =

-			}	=

-		}
-	} =

-}
-
-material tex_485 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_485.png =

-			}	=

-		}
-	} =

-}
-
-material tex_486 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_486.png =

-			}	=

-		}
-	} =

-}
-
-material tex_487 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_487.png =

-			}	=

-		}
-	} =

-}
-
-material tex_488 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_488.png =

-			}	=

-		}
-	} =

-}
-
-material tex_489 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_489.png =

-			}	=

-		}
-	} =

-}
-
-material tex_48 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_48.png =

-			}	=

-		}
-	} =

-}
-
-material tex_490 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_490.png =

-			}	=

-		}
-	} =

-}
-
-material tex_491 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_491.png =

-			}	=

-		}
-	} =

-}
-
-material tex_492 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_492.png =

-			}	=

-		}
-	} =

-}
-
-material tex_493 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_493.png =

-			}	=

-		}
-	} =

-}
-
-material tex_494 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_494.png =

-			}	=

-		}
-	} =

-}
-
-material tex_495 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_495.png =

-			}	=

-		}
-	} =

-}
-
-material tex_496 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_496.png =

-			}	=

-		}
-	} =

-}
-
-material tex_497 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_497.png =

-			}	=

-		}
-	} =

-}
-
-material tex_498 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_498.png =

-			}	=

-		}
-	} =

-}
-
-material tex_499 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_499.png =

-			}	=

-		}
-	} =

-}
-
-material tex_49 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_49.png =

-			}	=

-		}
-	} =

-}
-
-material tex_4 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_4.png =

-			}	=

-		}
-	} =

-}
-
-material tex_500 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_500.png =

-			}	=

-		}
-	} =

-}
-
-material tex_501 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_501.png =

-			}	=

-		}
-	} =

-}
-
-material tex_502 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_502.png =

-			}	=

-		}
-	} =

-}
-
-material tex_503 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_503.png =

-			}	=

-		}
-	} =

-}
-
-material tex_504 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_504.png =

-			}	=

-		}
-	} =

-}
-
-material tex_505 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_505.png =

-			}	=

-		}
-	} =

-}
-
-material tex_506 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_506.png =

-			}	=

-		}
-	} =

-}
-
-material tex_507 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_507.png =

-			}	=

-		}
-	} =

-}
-
-material tex_508 : tex_base_alpha
-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_508.png =

-			}	=

-		}
-	} =

-}
-
-material tex_509 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_509.png =

-			}	=

-		}
-	} =

-}
-
-material tex_50 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_50.png =

-			}	=

-		}
-	} =

-}
-
-material tex_510 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_510.png =

-			}	=

-		}
-	} =

-}
-
-material tex_511 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_511.png =

-			}	=

-		}
-	} =

-}
-
-material tex_512 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_512.png =

-			}	=

-		}
-	} =

-}
-
-material tex_513 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_513.png =

-			}	=

-		}
-	} =

-}
-
-material tex_514 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_514.png =

-			}	=

-		}
-	} =

-}
-
-material tex_515 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_515.png =

-			}	=

-		}
-	} =

-}
-
-material tex_516 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_516.png =

-			}	=

-		}
-	} =

-}
-
-material tex_517 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_517.png =

-			}	=

-		}
-	} =

-}
-
-material tex_518 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_518.png =

-			}	=

-		}
-	} =

-}
-
-material tex_519 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_519.png =

-			}	=

-		}
-	} =

-}
-
-material tex_51 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_51.png =

-			}	=

-		}
-	} =

-}
-
-material tex_520 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_520.png =

-			}	=

-		}
-	} =

-}
-
-material tex_521 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_521.png =

-			}	=

-		}
-	} =

-}
-
-material tex_522 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_522.png =

-			}	=

-		}
-	} =

-}
-
-material tex_523 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_523.png =

-			}	=

-		}
-	} =

-}
-
-material tex_524 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_524.png =

-			}	=

-		}
-	} =

-}
-
-material tex_525 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_525.png =

-			}	=

-		}
-	} =

-}
-
-material tex_526 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_526.png =

-			}	=

-		}
-	} =

-}
-
-material tex_527 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_527.png =

-			}	=

-		}
-	} =

-}
-
-material tex_528 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_528.png =

-			}	=

-		}
-	} =

-}
-
-material tex_529 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_529.png =

-			}	=

-		}
-	} =

-}
-
-material tex_52 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_52.png =

-			}	=

-		}
-	} =

-}
-
-material tex_530 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_530.png =

-			}	=

-		}
-	} =

-}
-
-material tex_531 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_531.png =

-			}	=

-		}
-	} =

-}
-
-material tex_532 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_532.png =

-			}	=

-		}
-	} =

-}
-
-material tex_533 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_533.png =

-			}	=

-		}
-	} =

-}
-
-material tex_534 : tex_base_alpha
-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_534.png =

-			}	=

-		}
-	} =

-}
-
-material tex_535 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_535.png =

-			}	=

-		}
-	} =

-}
-
-material tex_536 : tex_base_alpha
-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_536.png =

-			}	=

-		}
-	} =

-}
-
-material tex_537 : tex_base_alpha
-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_537.png =

-			}	=

-		}
-	} =

-}
-
-material tex_538 : tex_base_alpha
-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_538.png =

-			}	=

-		}
-	} =

-}
-
-material tex_539 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_539.png =

-			}	=

-		}
-	} =

-}
-
-material tex_53 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_53.png =

-			}	=

-		}
-	} =

-}
-
-material tex_540 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_540.png =

-			}	=

-		}
-	} =

-}
-
-material tex_541 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_541.png =

-			}	=

-		}
-	} =

-}
-
-material tex_542 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_542.png =

-			}	=

-		}
-	} =

-}
-
-material tex_543 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_543.png =

-			}	=

-		}
-	} =

-}
-
-material tex_544 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_544.png =

-			}	=

-		}
-	} =

-}
-
-material tex_545 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_545.png =

-			}	=

-		}
-	} =

-}
-
-material tex_546 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_546.png =

-			}	=

-		}
-	} =

-}
-
-material tex_547 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_547.png =

-			}	=

-		}
-	} =

-}
-
-material tex_548 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_548.png =

-			}	=

-		}
-	} =

-}
-
-material tex_549 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_549.png =

-			}	=

-		}
-	} =

-}
-
-material tex_54 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_54.png =

-			}	=

-		}
-	} =

-}
-
-material tex_550 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_550.png =

-			}	=

-		}
-	} =

-}
-
-material tex_551 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_551.png =

-			}	=

-		}
-	} =

-}
-
-material tex_552 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_552.png =

-			}	=

-		}
-	} =

-}
-
-material tex_553 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_553.png =

-			}	=

-		}
-	} =

-}
-
-material tex_554 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_554.png =

-			}	=

-		}
-	} =

-}
-
-material tex_555 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_555.png =

-			}	=

-		}
-	} =

-}
-
-material tex_556 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_556.png =

-			}	=

-		}
-	} =

-}
-
-material tex_557 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_557.png =

-			}	=

-		}
-	} =

-}
-
-material tex_558 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_558.png =

-			}	=

-		}
-	} =

-}
-
-material tex_559 : tex_base_alpha
-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_559.png =

-			}	=

-		}
-	} =

-}
-
-material tex_55 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_55.png =

-			}	=

-		}
-	} =

-}
-
-material tex_560 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_560.png =

-			}	=

-		}
-	} =

-}
-
-material tex_561 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_561.png =

-			}	=

-		}
-	} =

-}
-
-material tex_562 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_562.png =

-			}	=

-		}
-	} =

-}
-
-material tex_563 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_563.png =

-			}	=

-		}
-	} =

-}
-
-material tex_564 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_564.png =

-			}	=

-		}
-	} =

-}
-
-material tex_565 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_565.png =

-			}	=

-		}
-	} =

-}
-
-material tex_566 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_566.png =

-			}	=

-		}
-	} =

-}
-
-material tex_567 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_567.png =

-			}	=

-		}
-	} =

-}
-
-material tex_568 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_568.png =

-			}	=

-		}
-	} =

-}
-
-material tex_569 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_569.png =

-			}	=

-		}
-	} =

-}
-
-material tex_56 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_56.png =

-			}	=

-		}
-	} =

-}
-
-material tex_570 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_570.png =

-			}	=

-		}
-	} =

-}
-
-material tex_571 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_571.png =

-			}	=

-		}
-	} =

-}
-
-material tex_572 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_572.png =

-			}	=

-		}
-	} =

-}
-
-material tex_57 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_57.png =

-			}	=

-		}
-	} =

-}
-
-material tex_58 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_58.png =

-			}	=

-		}
-	} =

-}
-
-material tex_59 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_59.png =

-			}	=

-		}
-	} =

-}
-
-material tex_5 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_5.png =

-			}	=

-		}
-	} =

-}
-
-material tex_60 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_60.png =

-			}	=

-		}
-	} =

-}
-
-material tex_61 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_61.png =

-			}	=

-		}
-	} =

-}
-
-material tex_62 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_62.png =

-			}	=

-		}
-	} =

-}
-
-material tex_63 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_63.png =

-			}	=

-		}
-	} =

-}
-
-material tex_64 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_64.png =

-			}	=

-		}
-	} =

-}
-
-material tex_65 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_65.png =

-			}	=

-		}
-	} =

-}
-
-material tex_66 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_66.png =

-			}	=

-		}
-	} =

-}
-
-material tex_67 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_67.png =

-			}	=

-		}
-	} =

-}
-
-material tex_68 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_68.png =

-			}	=

-		}
-	} =

-}
-
-material tex_69 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_69.png =

-			}	=

-		}
-	} =

-}
-
-material tex_6 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_6.png =

-			}	=

-		}
-	} =

-}
-
-material tex_70 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_70.png =

-			}	=

-		}
-	} =

-}
-
-material tex_71 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_71.png =

-			}	=

-		}
-	} =

-}
-
-material tex_72 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_72.png =

-			}	=

-		}
-	} =

-}
-
-material tex_73 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_73.png =

-			}	=

-		}
-	} =

-}
-
-material tex_74 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_74.png =

-			}	=

-		}
-	} =

-}
-
-material tex_75 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_75.png =

-			}	=

-		}
-	} =

-}
-
-material tex_76 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_76.png =

-			}	=

-		}
-	} =

-}
-
-material tex_77 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_77.png =

-			}	=

-		}
-	} =

-}
-
-material tex_78 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_78.png =

-			}	=

-		}
-	} =

-}
-
-material tex_79 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_79.png =

-			}	=

-		}
-	} =

-}
-
-material tex_7 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_7.png =

-			}	=

-		}
-	} =

-}
-
-material tex_80 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_80.png =

-			}	=

-		}
-	} =

-}
-
-material tex_81 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_81.png =

-			}	=

-		}
-	} =

-}
-
-material tex_82 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_82.png =

-			}	=

-		}
-	} =

-}
-
-material tex_83 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_83.png =

-			}	=

-		}
-	} =

-}
-
-material tex_84 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_84.png =

-			}	=

-		}
-	} =

-}
-
-material tex_85 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_85.png =

-			}	=

-		}
-	} =

-}
-
-material tex_86 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_86.png =

-			}	=

-		}
-	} =

-}
-
-material tex_87 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_87.png =

-			}	=

-		}
-	} =

-}
-
-material tex_88 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_88.png =

-			}	=

-		}
-	} =

-}
-
-material tex_89 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_89.png =

-			}	=

-		}
-	} =

-}
-
-material tex_8 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_8.png =

-			}	=

-		}
-	} =

-}
-
-material tex_90 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_90.png =

-			}	=

-		}
-	} =

-}
-
-material tex_91 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_91.png =

-			}	=

-		}
-	} =

-}
-
-material tex_92 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_92.png =

-			}	=

-		}
-	} =

-}
-
-material tex_93 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_93.png =

-			}	=

-		}
-	} =

-}
-
-material tex_94 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_94.png =

-			}	=

-		}
-	} =

-}
-
-material tex_95 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_95.png =

-			}	=

-		}
-	} =

-}
-
-material tex_96 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_96.png =

-			}	=

-		}
-	} =

-}
-
-material tex_97 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_97.png =

-			}	=

-		}
-	} =

-}
-
-material tex_98 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_98.png =

-			}	=

-		}
-	} =

-}
-
-material tex_99 : tex_base =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_99.png =

-			}	=

-		}
-	} =

-}
-
-material tex_9 : tex_base_alpha =

-{ =

-	technique =

-	{ =

-		pass
-		{		=

-			texture_unit =

-			{ =

-				texture tex_9.png =

-			}	=

-		}
-	} =

-}
-
-material tex_996 : tex_base_alpha
+			{ =

+				texture blood.png
+			}	=

+		}
+	} =

+}
+
+material tex_997 : tex_base_alpha
 { =

 	technique
 	{ =

@@ -8085,13 +8088,13 @@
 		{		=

 			texture_unit
 			{ =

-				texture blood.png
-			}	=

-		}
-	} =

-}
-
-material tex_997 : tex_base_alpha
+				texture blood_spot.png
+			}	=

+		}
+	} =

+}
+
+material tex_998 : tex_base
 { =

 	technique
 	{ =

@@ -8099,20 +8102,6 @@
 		{		=

 			texture_unit
 			{ =

-				texture blood_spot.png
-			}	=

-		}
-	} =

-}
-
-material tex_998 : tex_base
-{ =

-	technique
-	{ =

-		pass
-		{		=

-			texture_unit
-			{ =

 				texture tex_998.png
 			}	=

 		}

Modified: trunk/data/models/textures/tex_533.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/particles/materials/particles.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/particles/materials/particles.material (original)
+++ trunk/data/particles/materials/particles.material Thu Dec  6 21:42:24 2=
007
@@ -1,4 +1,9 @@
-material Particles/explosion
+//###########################################
+// TEMPLATES
+//###########################################
+
+// PARTICLE BASE MATERIAL
+material particlebase
 {
 	technique
 	{
@@ -9,25 +14,47 @@
 			depth_write off
 			scene_blend add
 =

-			texture_unit
+			texture_unit particletex
 			{
-				texture explosion.png
+				texture stone512.dds
 			}
 		}
 	}
 }
 =

-material Generic/Fire
+// --------------- THIS IS THE END OF BASE MATERIALS ----------------------
+
+material Particles/explosion : particlebase
+{
+	set_texture_alias particletex explosion.png
+}
+
+material Particles/bigFlame : particlebase
+{
+	set_texture_alias particletex bigflame.png
+}
+
+material Particles/Flare : particlebase
+{
+	set_texture_alias particletex flaretrail.png
+}
+
+material Particles/Fireball : particlebase
+{
+	set_texture_alias particletex fireball.tga
+}
+
+material Particles/Fibres : particlebase
+{
+	set_texture_alias particletex fibres.png
+}
+
+material Generic/Fire : particlebase
 {
 	technique
 	{
 		pass
 		{
-			fog_override true
-			lighting off
-			scene_blend add
-			depth_write off
-
 			texture_unit
 			{
 				texture firesmoke.png
@@ -37,17 +64,12 @@
 	}
 }
 =

-material Particles/SpinBeam
+material Particles/SpinBeam : particlebase
 {
 	technique
 	{
 		pass
 		{
-			fog_override true
-			lighting off
-			depth_write off
-			scene_blend add
-
 			texture_unit
 			{
 				texture spinbeam.png
@@ -57,55 +79,12 @@
 	}
 }
 =

-material Particles/Fireball
+material Particles/FlarePointSprite : particlebase
 {
 	technique
 	{
 		pass
 		{
-			fog_override true
-			lighting off
-			depth_write off
-			scene_blend add
-
-			texture_unit
-			{
-				texture fireball.tga
-			}
-		}
-	}
-}
-
-material Particles/Fibres
-{
-	technique
-	{
-		pass
-		{
-			fog_override true
-			lighting off
-			depth_write off
-			scene_blend add
-
-			texture_unit
-			{
-				texture fibres.png
-			}
-		}
-	}
-}
-
-material Particles/FlarePointSprite
-{
-	technique
-	{
-		pass
-		{
-			fog_override true
-			lighting off
-			scene_blend add
-			depth_write off
-
 			point_sprites on
 			point_size 10
 			//point_size 20
@@ -119,16 +98,14 @@
 	}
 }
 =

-material Particles/Skull
+material Particles/Skull : particlebase
 {
 	technique
 	{
 		pass
 		{
-			fog_override true
-			lighting off
 			scene_blend alpha_blend
-			depth_write off
+
 			cull_hardware clockwise
 			cull_software back
 =

@@ -141,16 +118,14 @@
 	}
 }
 =

-material Particles/Swords
+material Particles/Swords : particlebase
 {
 	technique
 	{
 		pass
 		{
-			fog_override true
-			lighting off
 			scene_blend alpha_blend
-			depth_write off
+
 			cull_hardware clockwise
 			cull_software back
 =

@@ -163,60 +138,17 @@
 	}
 }
 =

-material Particles/Twirl
+material Particles/Twirl : particlebase
 {
 	technique
 	{
 		pass
 		{
-			fog_override true
-			lighting off
-			depth_write off
-			scene_blend add
-
 			texture_unit
 			{
+				texture twirl.png
 				tex_address_mode clamp
-				texture twirl.png
 			}
 		}
 	}
 }
-
-material Particles/bigFlame
-{
-	technique
-	{
-		pass
-		{
-			fog_override true
-			lighting off
-			depth_write off
-			scene_blend add
-
-			texture_unit
-			{
-				texture bigflame.png
-			}
-		}
-	}
-}
-
-material Particles/Flare
-{
-	technique
-	{
-		pass
-		{
-			fog_override true
-			lighting off
-			scene_blend add
-			depth_write off
-
-			texture_unit
-			{
-				texture flaretrail.png
-			}
-		}
-	}
-}



From no-reply at zwischenwelt.org  Fri Dec  7 23:35:55 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 07 Dec 2007 22:35:55 -0000
Subject: [Iris-commit] [IRIS] r1609 - in /trunk/data/models/models:
 generate.sh generate_alpha.sh generate_alpha_tex_atlas.php
Message-ID: <20071207223556.195831C182BC@zwischenwelt.org>

Author: hagish
Date: Fri Dec  7 23:35:55 2007
New Revision: 1609

Log:
first alpha texture atlas tests

Added:
    trunk/data/models/models/generate_alpha.sh   (with props)
    trunk/data/models/models/generate_alpha_tex_atlas.php
Modified:
    trunk/data/models/models/generate.sh

Modified: trunk/data/models/models/generate.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate.sh (original)
+++ trunk/data/models/models/generate.sh Fri Dec  7 23:35:55 2007
@@ -4,6 +4,6 @@
 find -name \*.mesh -exec ./toxml.sh {} \;
 find -name \*.mesh.xml | sort > xml.txt
 php generate_tex_atlas.php
-#find -name \*.mesh -exec ./tomesh.sh {} \;
-#find -name \*.xml -exec rm {} \;
+find -name \*.mesh -exec ./tomesh.sh {} \;
+find -name \*.xml -exec rm {} \;
 =




From no-reply at zwischenwelt.org  Sat Dec  8 01:27:29 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 08 Dec 2007 00:27:29 -0000
Subject: [Iris-commit] [IRIS] r1610 - /trunk/data/lua/net/net.buff.lua
Message-ID: <20071208002729.82E241C182BD@zwischenwelt.org>

Author: hagish
Date: Sat Dec  8 01:27:26 2007
New Revision: 1610

Log:
bugfix: buff crash

Modified:
    trunk/data/lua/net/net.buff.lua

Modified: trunk/data/lua/net/net.buff.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.buff.lua (original)
+++ trunk/data/lua/net/net.buff.lua Sat Dec  8 01:27:26 2007
@@ -141,9 +141,10 @@
 		if (buffinfos.argumentsmode_start =3D=3D 1) then
 	=

 			local argument_string =3D ""
+			local argument_char
 			repeat
-				local argument_char	=3D input:PopNetUint8()
-				argument_string =3D argument_string..argument_char
+				argument_char	=3D input:PopNetUint8()
+				argument_string =3D argument_string .. argument_char
 				print(argument_char)
 			until (argument_char =3D=3D 1)
 			=




From no-reply at zwischenwelt.org  Sat Dec  8 01:40:41 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 08 Dec 2007 00:40:41 -0000
Subject: [Iris-commit] [IRIS] r1611 - /trunk/data/lua/obj/obj.container.lua
Message-ID: <20071208004041.101D01C182BD@zwischenwelt.org>

Author: hagish
Date: Sat Dec  8 01:40:40 2007
New Revision: 1611

Log:
bugfix: nil concat in tooltip, if tooltip packet to slow

Modified:
    trunk/data/lua/obj/obj.container.lua

Modified: trunk/data/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.container.lua (original)
+++ trunk/data/lua/obj/obj.container.lua Sat Dec  8 01:40:40 2007
@@ -215,10 +215,13 @@
 	=

 	widget.tooltip_offx =3D kUOToolTippOffX
 	widget.tooltip_offy =3D kUOToolTippOffY
-	widget.on_simple_tooltip =3D function (widget) return (AosToolTip_GetText=
(widget.item.serial).." \n ") or "?" end -- add newline, workaround for too=
ltip sizecalc bug
-end
-
-
-
-
-
+	widget.on_simple_tooltip =3D function (widget) =

+			local tooltiptext =3D AosToolTip_GetText(widget.item.serial) or ""
+			return (tooltiptext .. " \n ") or "?" =

+		end -- add newline, workaround for tooltip sizecalc bug
+end
+
+
+
+
+



From no-reply at zwischenwelt.org  Sat Dec  8 02:47:42 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 08 Dec 2007 01:47:42 -0000
Subject: [Iris-commit] [IRIS] r1612 - in /trunk/data: config.lua.dist
 lua/gui/gui.paperdoll.lua lua/lib.spellbooks.lua lua/lib.uodragdrop.lua
 lua/net/net.login.lua lua/net/net.packethandlers.lua
 lua/obj/obj.container.lua lua/obj/obj.player.lua
Message-ID: <20071208014742.B7EA41C182BD@zwischenwelt.org>

Author: sience
Date: Sat Dec  8 02:47:40 2007
New Revision: 1612

Log:
-second tooltip bugfix for paperdoll
-tooltip support detection (net.login.lua)
-global tooltip option for config.lua.dist
-drag&drop global<>local bugfix
-AosToolTip request function actived again
-Bushido Spellbook added
-comments added

Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/gui/gui.paperdoll.lua
    trunk/data/lua/lib.spellbooks.lua
    trunk/data/lua/lib.uodragdrop.lua
    trunk/data/lua/net/net.login.lua
    trunk/data/lua/net/net.packethandlers.lua
    trunk/data/lua/obj/obj.container.lua
    trunk/data/lua/obj/obj.player.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Dec  8 02:47:40 2007
@@ -3,6 +3,7 @@
 -- you can override individual settings there.
 =

 kGuiToolTipWait =3D 100
+gTooltipSupport =3D true
 =

 -- Client Identification String
 gClientVersion =3D "6.0.1.6"  -- try other version for example "4.0.11c5"

Modified: trunk/data/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/gui/gui.paperdoll.lua (original)
+++ trunk/data/lua/gui/gui.paperdoll.lua Sat Dec  8 02:47:40 2007
@@ -272,9 +272,14 @@
 	end
 	widget.onMouseDown =3D function (widget,mousebutton) end
 	=

-	widget.tooltip_offx =3D kUOToolTippOffX
-	widget.tooltip_offy =3D kUOToolTippOffY
-	widget.on_simple_tooltip =3D function (widget) return (AosToolTip_GetText=
(widget.item.serial).." \n ") or "?" end -- add newline, workaround for too=
ltip sizecalc bug
+	if (gTooltipSupport) then
+		widget.tooltip_offx =3D kUOToolTippOffX
+		widget.tooltip_offy =3D kUOToolTippOffY
+		widget.on_simple_tooltip =3D function (widget)
+				local  tooltiptext =3D AosToolTip_GetText(widget.item.serial) or ""
+				return (tooltiptext .. " \n ") or "?"
+			end -- add newline, workaround for tooltip sizecalc bug
+	end
 end
 =

 =


Modified: trunk/data/lua/lib.spellbooks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.spellbooks.lua (original)
+++ trunk/data/lua/lib.spellbooks.lua Sat Dec  8 02:47:40 2007
@@ -323,11 +323,11 @@
 ]]--
 =

 MageSpellbook			=3D hex2num("0x0EFA")
-SpellweavingSpellbook	=3D hex2num("0x2D50")	--dialog.gumpid =3D hex2num("0=
x2B2F")
+NecroSpellbook			=3D hex2num("0x2253")
 ChivalrySpellbook		=3D hex2num("0x2252") --dialog.gumpid =3D hex2num("0x2B=
01")
-NecroSpellbook			=3D hex2num("0x2253")
 BushidoSpellbook		=3D hex2num("0x238C") --dialog.gumpid =3D hex2num("0x2B0=
7")
 NinjitsuSpellbook		=3D hex2num("0x23A0") --dialog.gumpid =3D hex2num("0x2B=
06")
+SpellweavingSpellbook	=3D hex2num("0x2D50")	--dialog.gumpid =3D hex2num("0=
x2B2F")
 =

 gSpellBooks =3D {}
 gSpellBooks[MageSpellbook]	=3D {
@@ -414,6 +414,31 @@
 	}
 }
 =

+gSpellBooks[BushidoSpellbook] =3D {
+	name		=3D"Bushido",
+	gumpid	=3Dhex2num("0x2B07"),
+	minigumpid	=3Dhex2num("0x2B09"),
+	iconoffset	=3Dhex2num("0x5420"),
+	startindex	=3Dhex2num("0x190"),
+	circles	=3D{[1]=3D"Bushido",[2]=3D"Bushido"},
+
+	pages	=3D{ [1]=3D1, [2]=3D1 },
+
+	spells     =3D{
+			 [1] =3D { [1] =3D "Honorable Execution", [2] =3D "Confidence", [3] =3D=
 "Evasion", [4] =3D "Counter Attack",
+			 		 [5] =3D "Lightning Strike", [6] =3D "Momentum Strike"  },
+			 [2] =3D {}		=

+		},
+
+	reagenz =3D { [1]=3D"Mana Cost: 0", [2]=3D"Mana Cost: 5", [3]=3D"Mana Cos=
t: 10",
+			[4]=3D"Min. Skill: 25", [5]=3D"Min. Skill: 40", [6]=3D"Min. Skill: 50",=
 [7]=3D"Min. Skill: 60", [8]=3D"Min. Skill: 70" },
+				=

+	spell_reags =3D {
+		[1]	=3D { [1]=3D{[1]=3D1,[2]=3D4}, [2]=3D{[1]=3D3,[2]=3D4}, [3]=3D{[1]=
=3D3,[2]=3D7}, [4]=3D{[1]=3D2,[2]=3D5}, [5]=3D{[1]=3D2,[2]=3D6}, [6]=3D{[1]=
=3D3,[2]=3D8}  },
+		[2] =3D {},
+	}
+}
+
 gSpellBooks[SpellweavingSpellbook] =3D {
 	name		=3D"Spellweaving",
 	gumpid		=3Dhex2num("0x2B2F"),

Modified: trunk/data/lua/lib.uodragdrop.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.uodragdrop.lua (original)
+++ trunk/data/lua/lib.uodragdrop.lua Sat Dec  8 02:47:40 2007
@@ -173,14 +173,7 @@
 	local iArtID =3D item.artid + hex2num("0x4000")
 	local mat =3D GetArtMat(iArtID,item.hue)
 	local w,h =3D GetArtSize(iArtID,item.hue)
-	offx =3D offx or (-w / 2)
-	offy =3D offy or (-h / 2)
-	=

-	--local iMouseX,iMouseY =3D GetMousePos()
-	--local offx =3D widget.gfx:GetDerivedLeft() - iMouseX =

-	--local offy =3D widget.gfx:GetDerivedTop() - iMouseY
-	--local mat =3D GetGumpMat(gumpid)
-	--local w,h =3D GetGumpSize(gumpid)
+	local offx,offy =3D -w/2,-h/2 =

 	=

 	-- used fields of gDragDrop.item : 	.artid .serial .amount =

 	PrepareUODragDrop(item,widget,mat,w,h,offx,offy)

Modified: trunk/data/lua/net/net.login.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.login.lua (original)
+++ trunk/data/lua/net/net.login.lua Sat Dec  8 02:47:40 2007
@@ -1,8 +1,8 @@
 -- packet handlers for game startup
 -- see also lib.packet.lua and lib.protocol.lua
 =

+-- index on which server we play (maybe it's important later)
 gServerNumber =3D 0
-gCharacterSlots =3D 5
 =

 -- TODO : write Set_ClientFeatures function !!
 function gPacketHandler.kPacket_Server_List () --0xa8 - Recieve Serverlist=
 from LoginServer
@@ -123,20 +123,18 @@
 =

 -- Receive Character List from GameServer
 function gPacketHandler.kPacket_Character_List()
+	local characterslots =3D 5
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
 	local charlist =3D {}
 	charlist.size =3D input:PopNetUint16()
 	charlist.charnumber =3D input:PopNetUint8()
 =

-	--check, because POL and Lonewolf sends current charnumber, not the numbe=
r of slots
-	if (charlist.charnumber > gCharacterSlots) then
-		gCharacterSlots =3D charlist.charnumber
-	end
-
-	printdebug("login",sprintf("NET: character list: size=3D%d charnumber=3D%=
d gCharacterSlots=3D%d\n",charlist.size,charlist.charnumber,gCharacterSlots=
))
-	=

-	for i =3D 0, gCharacterSlots-1 do
+	--TODO: ?? check, because POL and Lonewolf sends current charnumber, not =
the number of slots
+
+	printdebug("login",sprintf("NET: character list: size=3D%d charlist.charn=
umber=3D%d\n",charlist.size,charlist.charnumber))
+
+	for i =3D 0, charlist.charnumber-1 do
 		gCharacterList[i] =3D {}
 		gCharacterList[i].name=3Dinput:PopFilledString(30)
 		gCharacterList[i].pw=3Dinput:PopFilledString(30)
@@ -161,6 +159,9 @@
 	-- TODO : Serverspecific handling for Revelation Emu
 	charlist.flags =3D input:PopNetUint32()
 	printdebug("login",sprintf("ServerFlag: 0x%08x\n",charlist.flags))
+
+	-- diable tooltip support for preAos servers (<0x8)
+	if (charlist.flags <=3D hex2num("0x08")) then gTooltipSupport=3Dfalse end
 =

 	--[[
 	Flags (each flag is for each feature, if you need to combine features, yo=
u need to summ flags):

Modified: trunk/data/lua/net/net.packethandlers.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.packethandlers.lua (original)
+++ trunk/data/lua/net/net.packethandlers.lua Sat Dec  8 02:47:40 2007
@@ -48,7 +48,6 @@
 --loop	- Item Info; count =3D (Packet Size-3)/4
 --dword	- Serial
 --endloop	- Item Info
---[[
 function Send_AosToolTipRequest(objserial)
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_Mega_Cliloc)
@@ -56,7 +55,6 @@
 	out:PushNetUint32(objserial)
 	out:SendPacket()
 end
-]]--
 =

 gAosToolTipHash =3D {}
 gAosToolTipText =3D {}

Modified: trunk/data/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.container.lua (original)
+++ trunk/data/lua/obj/obj.container.lua Sat Dec  8 02:47:40 2007
@@ -212,16 +212,17 @@
 		end
 	end
 =

-	=

-	widget.tooltip_offx =3D kUOToolTippOffX
-	widget.tooltip_offy =3D kUOToolTippOffY
-	widget.on_simple_tooltip =3D function (widget) =

-			local tooltiptext =3D AosToolTip_GetText(widget.item.serial) or ""
-			return (tooltiptext .. " \n ") or "?" =

-		end -- add newline, workaround for tooltip sizecalc bug
-end
-
-
-
-
-
+	if (gTooltipSupport) then
+		widget.tooltip_offx =3D kUOToolTippOffX
+		widget.tooltip_offy =3D kUOToolTippOffY
+		widget.on_simple_tooltip =3D function (widget) =

+				local tooltiptext =3D AosToolTip_GetText(widget.item.serial) or ""
+				return (tooltiptext .. " \n ") or "?" =

+			end -- add newline, workaround for tooltip sizecalc bug
+	end
+end
+
+
+
+
+

Modified: trunk/data/lua/obj/obj.player.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.player.lua (original)
+++ trunk/data/lua/obj/obj.player.lua Sat Dec  8 02:47:40 2007
@@ -11,7 +11,8 @@
 	return mobile and (mobile.serial =3D=3D gPlayerBodySerial)
 end
 =

--- adjust backpack art and maybe paperdoll ?
+-- adjust backpack art and maybe paperdoll !!
+-- items in backpack are updated -> update graphic here also
 -- called from kPacket_Equipped_MOB and UpdatePlayerBodySerial
 function PlayerBackpackItemUpdated ()
 	-- warning ! don't trigger network send here



From no-reply at zwischenwelt.org  Sat Dec  8 14:58:03 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 08 Dec 2007 13:58:03 -0000
Subject: [Iris-commit] [IRIS] r1613 - in /trunk/data/lua: lib.debugmenu.lua
	lib.static.lua
Message-ID: <20071208135803.BCD071C1827D@zwischenwelt.org>

Author: sience
Date: Sat Dec  8 14:57:57 2007
New Revision: 1613

Log:
-granny debugmodus tested with shaders (some models are wrong, some models =
crash iris2, some are working)

Modified:
    trunk/data/lua/lib.debugmenu.lua
    trunk/data/lua/lib.static.lua

Modified: trunk/data/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.debugmenu.lua (original)
+++ trunk/data/lua/lib.debugmenu.lua Sat Dec  8 14:57:57 2007
@@ -25,50 +25,36 @@
 end
 =

 gDebugTestMobiles =3D {
-	{artid=3D	hex2num("0x76") , content=3D{}}, --horse ok
-	{artid=3D	hex2num("0x78") , content=3D{}}, --horse ok
-	=

-	=

-	{artid=3D400,hue=3D33780, content=3D{
-		{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount},
-		[4]=3D{artid=3D5422,hue=3D1728,animid=3D430},[26]=3D{artid=3D3701,hue=3D=
0,animid=3D422},
-		[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},[27]=3D{artid=3D3701,hue=
=3D0,animid=3D422},
-		[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,hue=
=3D1147,animid=3D701},
-		[21]=3D{artid=3D3701,hue=3D0,animid=3D422},}},   =

-		=

-		=

-	{artid=3D401, content=3D({{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount=
},{artid=3D5899,animid=3D477},{artid=3D5422,animid=3D430},{artid=3D5399,ani=
mid=3D434},{artid=3D5435,animid=3D466},{artid=3D8251,animid=3D700},{artid=
=3D3701,animid=3D422},})},
-	{artid=3D400, content=3D({{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount=
},{artid=3D5899,animid=3D477},{artid=3D5422,animid=3D430},{artid=3D5399,ani=
mid=3D434},{artid=3D5435,animid=3D466},{artid=3D8251,animid=3D700},{artid=
=3D3701,animid=3D422},})},
+	-- male
 	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
+	--female
 	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
-	{artid=3D 292 , content=3D{}}, --broken llamas_llama_pack (crash) -> mapp=
ed to id: 220
-
-	{artid=3D hex2num("0xA9") , content=3D{}}, --169 broken horse
-	{artid=3D hex2num("0x317"), content=3D{}}, --791 broken horse
-	{artid=3D	hex2num("0x76") , content=3D{}}, --horse ok
-	{artid=3D	hex2num("0x78") , content=3D{}}, --horse ok
-
-	{artid=3D hex2num("0x123") , content=3D{}}, =

+	-- llamas_llama_pack - broken (crash) -> mapped to id: 220 (grannyfilter)
+	{artid=3D 292 , content=3D{}},
+
+	-- k=C3=A4fer - broken animation
+	{artid=3D hex2num("0xA9") , content=3D{}},
+	--791 broken horse
+	{artid=3D hex2num("0x317"), content=3D{}},
+
+	{artid=3D	hex2num("0xB1") , content=3D{}}, -- 177 broken
+	{artid=3D	hex2num("0x72") , content=3D{}}, -- 114 broken =

+	{artid=3D	hex2num("0x73") , content=3D{}},  -- 115 broken
+	{artid=3D	hex2num("0x75") , content=3D{}}, -- 117 broken
+
 	{artid=3D hex2num("0xD5") , content=3D{}}, =

 	{artid=3D	hex2num("0xF1") , content=3D{}}, =

 	{artid=3D	hex2num("0xF3") , content=3D{}}, =

-	{artid=3D	hex2num("0xCC") , content=3D{}}, -- 204, broken
+	{artid=3D	hex2num("0xCC") , content=3D{}}, -- 204, broken horse
 	{artid=3D	hex2num("0xC8") , content=3D{}}, -- 200 : standard horse
 	{artid=3D	hex2num("0xE2") , content=3D{}}, -- 226 broken
 	{artid=3D	hex2num("0xE4") , content=3D{}}, -- 228 broken
+	{artid=3D hex2num("0xFC"), content=3D{}},
 	{artid=3D	hex2num("0xDC") , content=3D{}}, =

 	{artid=3D	hex2num("0xD2") , content=3D{}}, =

 	{artid=3D	hex2num("0xDA") , content=3D{}}, =

 	{artid=3D	hex2num("0xDB") , content=3D{}}, =

-	{artid=3D	hex2num("0x3C") , content=3D{}}, =

 	{artid=3D	hex2num("0xD5") , content=3D{}}, =

-	{artid=3D	hex2num("0xB1") , content=3D{}}, -- 177 broken
-	{artid=3D	hex2num("0x75") , content=3D{}}, -- 117 broken =

-	{artid=3D	hex2num("0x72") , content=3D{}}, -- 114 broken =

-	{artid=3D	hex2num("0x73") , content=3D{}},  -- 115 broken
-	{artid=3D	hex2num("0xC8") , content=3D{}}, =

-	{artid=3D	hex2num("0x79") , content=3D{}}, =

-	{artid=3D	hex2num("0x77") , content=3D{}}, =

 	{artid=3D	hex2num("0x90") , content=3D{}}, =

 	{artid=3D	hex2num("0x74") , content=3D{}},  -- 116 broken
 	{artid=3D	hex2num("0xB2") , content=3D{}},  -- 178 broken
@@ -76,7 +62,6 @@
 	{artid=3D	hex2num("0xB3") , content=3D{}},  -- 179 broken
 	{artid=3D	hex2num("0xBB") , content=3D{}}, =

 	{artid=3D	hex2num("0xBC") , content=3D{}}, =

-	{artid=3D	hex2num("0x319") , content=3D{}},
 	{artid=3D	hex2num("0x317") , content=3D{}}, -- brokenanim
 	{artid=3D	hex2num("0x31A") , content=3D{}}, -- brokenanim
 	{artid=3D	hex2num("0x31F") , content=3D{}}, -- brokenanim
@@ -89,22 +74,16 @@
 	{artid=3D400,hue=3D33780, content=3D{[27]=3D{artid=3D3701,hue=3D0,animid=
=3D422},[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,=
hue=3D1147,animid=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D=
{artid=3D3701,hue=3D0,animid=3D422},}},
 	{artid=3D400,hue=3D33780, content=3D{[11]=3D{artid=3D8252,hue=3D1147,anim=
id=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D{artid=3D3701,h=
ue=3D0,animid=3D422},}},
 =

-
-	--{artid=3D2011, content=3D{{animid=3D2002}}}, -- 02:feet 11:ulegs
 	{artid=3D400, content=3D{}},
 	{artid=3D400, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
 	{artid=3D401, content=3D{}},
 	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
-	{artid=3D040, content=3D{}},
 	{artid=3D014, content=3D{}},
-	{artid=3D199, content=3D{}},
-	{artid=3D256, content=3D{}},
 	{artid=3D778, content=3D{}},
-	{artid=3D225, content=3D{}}, -- timberwolf
 	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
 	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[4]=3D{artid=
=3D5137,animid=3D529},[6]=3D{artid=3D9797,animid=3D682},[7]=3D{artid=3D5140=
,animid=3D530},[19]=3D{artid=3D5136,animid=3D528},[16]=3D{artid=3D8256,anim=
id=3D800},[21]=3D{artid=3D3701,animid=3D422},[13]=3D{artid=3D5141,animid=3D=
527},[29]=3D{artid=3D3708,animid=3D0},[11]=3D{artid=3D8266,animid=3D903},}},
 	{artid=3D401, content=3D({{artid=3D3932,animid=3D631},{artid=3D7107,animi=
d=3D993},{artid=3D5137,animid=3D529},{artid=3D9797,animid=3D682},{artid=3D5=
140,animid=3D530},{artid=3D5136,animid=3D528},{artid=3D8256,animid=3D800},{=
artid=3D3701,animid=3D422},{artid=3D5141,animid=3D527},{artid=3D3708,animid=
=3D0},{artid=3D8266,animid=3D903},})},
-	=

+
 	{artid=3D400, content=3D({{artid=3D3519,animid=3D972},})},
 	{artid=3D400, content=3D({{artid=3D3519,animid=3D972},{artid=3D5901,animi=
d=3D479},{artid=3D5422,animid=3D430},{artid=3D5399,animid=3D434},{artid=3D5=
907,animid=3D404},{artid=3D3701,animid=3D422},{artid=3D8252,animid=3D701},}=
)},
 	{artid=3D987, content=3D({{artid=3D5182,animid=3D624},{artid=3D5903,animi=
d=3D480},{artid=3D5399,animid=3D434},{artid=3D5130,animid=3D565},{artid=3D5=
397,animid=3D468},{artid=3D3701,animid=3D422},{artid=3D7939,animid=3D469},}=
)},
@@ -113,17 +92,45 @@
 	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
 	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
 	{artid=3D400, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D8266,animid=3D903},{artid=3D3=
701,animid=3D422},})},
+--[[
+	-- meshes only crash when using vertex-shader
+	{artid=3D040, content=3D{}},
+	{artid=3D	hex2num("0x76") , content=3D{}},
+	{artid=3D	hex2num("0x77") , content=3D{}}, =

+	{artid=3D	hex2num("0x78") , content=3D{}},
+	{artid=3D	hex2num("0x79") , content=3D{}}, =

+	{artid=3D	hex2num("0x3C") , content=3D{}}, =

+	{artid=3D	hex2num("0xC8") , content=3D{}}, =

+	{artid=3D hex2num("0x123") , content=3D{}},
+	{artid=3D199, content=3D{}},
+	{artid=3D225, content=3D{}}, -- timberwolf
 	{artid=3D256, content=3D{}},
-	{artid=3D252, content=3D{}},
-	{artid=3D204, content=3D{}}, -- should be horse
-	--{artid=3D3006, content=3D{}}, -- female lower legs, sience was having p=
roblem with them, 2 submeshes !
-	--[[
+	{artid=3D	hex2num("0x319") , content=3D{}},
+	{artid=3D400,hue=3D33780, content=3D{
+		{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount},
+		[4]=3D{artid=3D5422,hue=3D1728,animid=3D430},[26]=3D{artid=3D3701,hue=3D=
0,animid=3D422},
+		[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},[27]=3D{artid=3D3701,hue=
=3D0,animid=3D422},
+		[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,hue=
=3D1147,animid=3D701},
+		[21]=3D{artid=3D3701,hue=3D0,animid=3D422},}},   =

+	{artid=3D401, content=3D({{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount=
},{artid=3D5899,animid=3D477},{artid=3D5422,animid=3D430},{artid=3D5399,ani=
mid=3D434},{artid=3D5435,animid=3D466},{artid=3D8251,animid=3D700},{artid=
=3D3701,animid=3D422},})},
+	{artid=3D400, content=3D({{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount=
},{artid=3D5899,animid=3D477},{artid=3D5422,animid=3D430},{artid=3D5399,ani=
mid=3D434},{artid=3D5435,animid=3D466},{artid=3D8251,animid=3D700},{artid=
=3D3701,animid=3D422},})},
+]]--
+--[[
+	{artid=3D2011, content=3D{{animid=3D2002}}}, -- 02:feet 11:ulegs
+	{artid=3D1466, content=3D{}}, -- flimmer, need culling? (fixed)
+	{artid=3D1700, content=3D{}}, -- hair, texcoords or normals broken ? (fix=
ed)
+	{artid=3D500, content=3D{}}, -- lantern, texcoords broken ?! (fixed)
+	{artid=3D468, content=3D{}}, -- cape, texcoords broken ? culling? (fixed)
+	{artid=3D1468, content=3D{}}, -- cape, texcoords broken ? culling? (fixed)
+	{artid=3D490, content=3D{}}, -- sash, texcoords broken ? culling? (fixed)
+	{artid=3D1490, content=3D{}},  -- sash, texcoords broken ? culling? (fixe=
d)
+
 	{artid=3D1924, content=3D{{animid=3D3012}}},
 	{artid=3D3604, content=3D{{animid=3D3012}}},
 	{artid=3D1925, content=3D{{animid=3D3012}}},
 	{artid=3D3605, content=3D{{animid=3D3012}}},
-	]]--
-	--[[
+
+	{artid=3D3006, content=3D{}}, -- female lower legs, sience was having pro=
blem with them, 2 submeshes !
 	{artid=3D2013, content=3D{}},
 	{artid=3D2009, content=3D{}},
 	{artid=3D2012, content=3D{}},
@@ -136,16 +143,7 @@
 	{artid=3D3012, content=3D{}},
 	{artid=3D3009, content=3D{}},
 	{artid=3D3012, content=3D{}},
-	]]--
-	--[[
-	{artid=3D1466, content=3D{}}, -- flimmer, need culling? (fixed)
-	{artid=3D1700, content=3D{}}, -- hair, texcoords or normals broken ? (fix=
ed)
-	{artid=3D500, content=3D{}}, -- lantern, texcoords broken ?! (fixed)
-	{artid=3D468, content=3D{}}, -- cape, texcoords broken ? culling? (fixed)
-	{artid=3D1468, content=3D{}}, -- cape, texcoords broken ? culling? (fixed)
-	{artid=3D490, content=3D{}}, -- sash, texcoords broken ? culling? (fixed)
-	{artid=3D1490, content=3D{}},  -- sash, texcoords broken ? culling? (fixe=
d)
-	]]--
+]]--
 }
 =

 -- 0:none 1:normal 2:invert 3:sample 4:sample-invert		-- bonestart

Modified: trunk/data/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.static.lua (original)
+++ trunk/data/lua/lib.static.lua Sat Dec  8 14:57:57 2007
@@ -120,17 +120,17 @@
 							gManualArtMaterialLoader:CreateMatchingIfUnavailable(v)
 						end
 					else
+						meshname =3D false
 						-- set false, if no ui_art material can be created
-						printdebug("static","mesh cannot be loaded -> temp. disabled (false)=
 ",meshname, iTranslatedTileTypeID)
-						meshname =3D false
+						printdebug("static",sprintf("mesh cannot be loaded -> temp. disabled=
 (false) meshname=3D%s iTranslatedTileTypeID=3D%d",meshname, iTranslatedTil=
eTypeID))
 					end
 				else
+					meshname =3D false
 					printdebug("static","mesh cannot be loaded -> temp. disabled (false) =
",meshname, iTranslatedTileTypeID)
-					meshname =3D false
 				end
 			else
+				meshname =3D false
 				printdebug("static","mesh not available -> temp. disabled (false) ",me=
shname, iTranslatedTileTypeID)
-				meshname =3D false
 			end
 			=

 			gLegacyModelCache[iTranslatedTileTypeID.."_".."0"] =3D meshname



From no-reply at zwischenwelt.org  Sat Dec  8 17:35:04 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 08 Dec 2007 16:35:04 -0000
Subject: [Iris-commit] [IRIS] r1614 - /trunk/data/lua/lib.spellbooks.lua
Message-ID: <20071208163504.E54ED1C182B5@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Dec  8 17:35:04 2007
New Revision: 1614

Log:
added commented out data for bushido and ninjitsu

Modified:
    trunk/data/lua/lib.spellbooks.lua

Modified: trunk/data/lua/lib.spellbooks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.spellbooks.lua (original)
+++ trunk/data/lua/lib.spellbooks.lua Sat Dec  8 17:35:04 2007
@@ -464,6 +464,30 @@
 	}
 }
 =

+--[[
+	{name,manacost,minskill,description} -- todo : look description up in cli=
loc and store id instead of text
+	samurai_bushido =3D {	=

+		{"Honorable Execution",	0,25,"Attempts to deliver a killing attack to yo=
ur opponent..."},
+		{"Confidence",			10,25,"Places you in a defensive stance of confidence, =
..."},
+		{"Evasion",				10,60,"Puts you in an evasive stance ..."},
+		{"Counter Attack",		5,40,"Places you in a defensive stance that allows y=
ou to automatically counter attack ..."},
+		{"Lightning Strike",	5,50,"An attack with a large bonus to your chance t=
o hit."},
+		{"Momentum Strike",		10,70,"If you strike an opponent with this ability,=
 you will automatically strike another nearby opponent. ..."},
+	}
+	=

+	ninjitsu =3D {
+		{"Focus Attack",	10,30,"Increases both your damage and the percentage ch=
ance for \"hit\" properties on your weapon for one attack"},
+		{"Death Strike",	30,85,"After receiving a Death Strike, if the opponent =
moves more than five steps or five seconds elapses, they will suffer direct=
 damage determined by the attacker's ninjitsu."},
+		{"Animal Form",		10,0,"Allows you to transform into an animal, gaining s=
pecial bonuses..."},
+		{"Ki Attack",		25,80,"An attack that does greater damage based on how fa=
r you travel to your opponent ..."},
+		{"Suprise Attack",	20,60,"An attack from stealth that inflicts a defence=
 penalty..."},
+		{"Backstab",		30,40,"An attack from stealth with a damage bonus ..."},
+		{"Shadowjump",		15,50,"Allows you to teleport while maintaining stealth.=
.."},
+		{"Mirror Image",	10,20,"Creates a mirror image..."},
+	}
+	=

+]]--
+
 gSpellbookExpansion =3D {}
 gSpellbookExpansion["AOS"]=3D hex2num("0x00")		--Mage, Necromancer and Pal=
adin spells
 gSpellbookExpansion["SE"]=3D hex2num("0x01")		--Samurai and Ninja Spells



From no-reply at zwischenwelt.org  Sat Dec  8 20:21:46 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 08 Dec 2007 19:21:46 -0000
Subject: [Iris-commit] [IRIS] r1615 - /trunk/data/lua/net/net.buff.lua
Message-ID: <20071208200003.A9A2F1C182B9@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Dec  8 20:21:45 2007
New Revision: 1615

Log:
added a few comments to buff packet

Modified:
    trunk/data/lua/net/net.buff.lua

Modified: trunk/data/lua/net/net.buff.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.buff.lua (original)
+++ trunk/data/lua/net/net.buff.lua Sat Dec  8 20:21:45 2007
@@ -116,12 +116,12 @@
 	buffinfos.player_serial	=3D input:PopNetUint32()
 =

 	buffinfos.icon_artid1		=3D input:PopNetUint16()
-	buffinfos.icon_show1		=3D input:PopNetUint16()
+	buffinfos.icon_show1		=3D input:PopNetUint16() -- runuo : 0x1 //Type 0 fo=
r removal. 1 for add 2 for Data
 	buffinfos.temp1			=3D input:PopNetUint32()
 =

 	if (packetsize > 15) then
-		buffinfos.icon_artid2		=3D input:PopNetUint16()
-		buffinfos.icon_show2		=3D input:PopNetUint16()
+		buffinfos.icon_artid2		=3D input:PopNetUint16() -- same as above
+		buffinfos.icon_show2		=3D input:PopNetUint16() -- runuo : 0x1 //Type 0 f=
or removal. 1 for add 2 for Data, same as above
 		buffinfos.temp2			=3D input:PopNetUint32()
 	=

 		buffinfos.buff_duration	=3D input:PopNetUint16()	--Time in seconds
@@ -132,6 +132,7 @@
 		buffinfos.clilocid1		=3D input:PopNetUint32()	--titleCliloc
 		buffinfos.clilocid2		=3D input:PopNetUint32()	--secondaryCliloc
 	=

+		-- runuo : if (!hasargs) { fill(10) } else { fill(4),short(0x1),fill(2),=
unicodestring(),short(0x1),fill(2) }
 		buffinfos.temp5			=3D input:PopNetUint32()
 	=

 		buffinfos.argumentsmode_start	=3D input:PopNetUint16()	-- if 1 -> i have=
 more data



From no-reply at zwischenwelt.org  Sun Dec  9 13:46:26 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 09 Dec 2007 12:46:26 -0000
Subject: [Iris-commit] [IRIS] r1616 - in /trunk/data/lua:
 gui/gui.paperdoll.lua lib.keybinds.lua lib.spellbooks.lua net.other.lua
 net/net.aoscommand.lua net/net.main.lua net/net.mobile.lua
Message-ID: <20071209124626.7FB821C1844D@zwischenwelt.org>

Author: sience
Date: Sun Dec  9 13:46:25 2007
New Revision: 1616

Log:
-AOSCommand updated to support Weaponabilities (test keybind to"F9")
-net.aoscommand.lua added
-some global changes

Added:
    trunk/data/lua/net/net.aoscommand.lua
Modified:
    trunk/data/lua/gui/gui.paperdoll.lua
    trunk/data/lua/lib.keybinds.lua
    trunk/data/lua/lib.spellbooks.lua
    trunk/data/lua/net.other.lua
    trunk/data/lua/net/net.main.lua
    trunk/data/lua/net/net.mobile.lua

Modified: trunk/data/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/gui/gui.paperdoll.lua (original)
+++ trunk/data/lua/gui/gui.paperdoll.lua Sun Dec  9 13:46:25 2007
@@ -103,7 +103,7 @@
 			dialog.controls["btn_quests"].onMouseDown =3D function (widget,mousebut=
ton)
 															if (mousebutton =3D=3D 1) then
 																widget.gfx:SetMaterial(widget.mat_pressed)
-																Send_AOSCommand(kPacket_Generic_SubCommand_QuestGumpReques=
t,gPlayerBodySerial)
+																Send_AOSCommand(kPacket_AOS_Command_QuestGumpRequest,gPlay=
erBodySerial)
 															end
 														end
 =

@@ -111,7 +111,7 @@
 			dialog.controls["btn_guild"].onMouseDown =3D function (widget,mousebutt=
on)
 															if (mousebutton =3D=3D 1) then
 																widget.gfx:SetMaterial(widget.mat_pressed)
-																Send_AOSCommand(kPacket_Generic_SubCommand_GuildGumpReques=
t,gPlayerBodySerial)
+																Send_AOSCommand(kPacket_AOS_Command_GuildGumpRequest,gPlay=
erBodySerial)
 															end
 														end
 =

@@ -310,27 +310,6 @@
 	end
 end
 =

---Send Quest, Guild Button req. to Server -> Server returns a Serverside G=
ump
-function Send_AOSCommand(subcmd,player_serial)
-	--print("NET: Send_AOSCommand: "..subcmd.." Player_Serial=3D"..player_ser=
ial)
-	local out =3D GetSendFIFO()
-	out:PushNetUint8(kPacket_AOS_Command)
-	if (subcmd =3D=3D kPacket_Generic_SubCommand_QuestGumpRequest) then
-		out:PushNetUint16(hex2num("0x0A"))
-	elseif (subcmd =3D=3D kPacket_Generic_SubCommand_GuildGumpRequest) then
-		out:PushNetUint16(hex2num("0x0A"))
-	end
-	out:PushNetUint32(player_serial)
-	if (subcmd =3D=3D kPacket_Generic_SubCommand_QuestGumpRequest) then
-		out:PushNetUint16(subcmd)
-		out:PushNetUint8(hex2num("0x0A"))
-	elseif (subcmd =3D=3D kPacket_Generic_SubCommand_GuildGumpRequest) then
-		out:PushNetUint16(subcmd)
-		out:PushNetUint8(hex2num("0x0A"))
-	end
-	out:SendPacket()
-end
-
 -- TODO : Clean
 function TogglePlayerPaperdoll ()
 	if (gPlayerBodySerial and gPaperdolls[gPlayerBodySerial]) then

Modified: trunk/data/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.keybinds.lua (original)
+++ trunk/data/lua/lib.keybinds.lua Sun Dec  9 13:46:25 2007
@@ -54,7 +54,8 @@
 		Client_SetAmbientLight(gAmbientLight.r, gAmbientLight.g, gAmbientLight.b=
, 1)
  	end end end)
 	Bind("f9",		function (state) if (not gActiveEditText) then if (state > 0)=
 then
-		local vr =3D OgreAddCompositor(GetMainViewport(), "B&W")
+		--local vr =3D OgreAddCompositor(GetMainViewport(), "B&W")
+		Send_AOSCommand(kPacket_AOS_Command_WeaponAbilityRequest,hex2num("0x1"),=
2)
 	 end end end)
 =

 	if (false) then

Modified: trunk/data/lua/lib.spellbooks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.spellbooks.lua (original)
+++ trunk/data/lua/lib.spellbooks.lua Sun Dec  9 13:46:25 2007
@@ -329,6 +329,8 @@
 NinjitsuSpellbook		=3D hex2num("0x23A0") --dialog.gumpid =3D hex2num("0x2B=
06")
 SpellweavingSpellbook	=3D hex2num("0x2D50")	--dialog.gumpid =3D hex2num("0=
x2B2F")
 =

+--WeaponAbilityBook		=3D hex2num("0x2B02")
+
 gSpellBooks =3D {}
 gSpellBooks[MageSpellbook]	=3D {
 	name		=3D"Spellbook",

Modified: trunk/data/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.other.lua (original)
+++ trunk/data/lua/net.other.lua Sun Dec  9 13:46:25 2007
@@ -33,10 +33,22 @@
 kPacket_Generic_SubCommand_UnknownSE			=3D hex2num("0x24")	-- Client -> Se=
rver packet
 kPacket_Generic_SubCommand_EnableSESpellIcons	=3D hex2num("0x25")
 kPacket_Generic_SubCommand_SpeedMode			=3D hex2num("0x26")
-kPacket_Generic_SubCommand_GuildGumpRequest		=3D hex2num("0x28")	-- Client=
 -> Server : Done!
 kPacket_Generic_SubCommand_NewRaceGender		=3D hex2num("0x2A")
+--[[
+-race_gender-packet
+Client -> Server =

+BYTE 	0xBF =

+WORD 	Length ( 15 ) =

+WORD 	Subcommand - 0x2A =

+WORD 	BodyHue =

+WORD 	HairId =

+WORD 	HairHue =

+WORD 	BeardId =

+WORD 	BeardHue
+]]--
 kPacket_Generic_SubCommand_BandageTarget		=3D hex2num("0x2C")	-- Client ->=
 Server packet,For use with the new Bandage Self client macro. Introduced i=
n 5.0.4x
 =

+--[[
 --new sincec KR
 kPacket_Generic_SubCommand_KR_HouseGumpResponse =3D hex2num("0x2F")	-- BF.=
2F - KR House Menu Gump Response
 kPacket_Generic_SubCommand_KR_HouseGumpResponse_default =3D hex2num("0x63"=
)	--BF.2F.63 - KR Default House Menu Gump Response
@@ -57,18 +69,6 @@
 kPacket_Generic_SubCommand_KR_HouseGumpResponse_primary	=3D hex2num("0x74"=
)	--BF.2F.74 - KR Ban House Menu Gump Response
 --a.s.o. to BF.2F.80
 kPacket_Generic_SubCommand_TargetbyResource		=3D hex2num("0x30")	---BF.30 =
- KR Target By Resource Macro
-kPacket_Generic_SubCommand_QuestGumpRequest		=3D hex2num("0x32")	-- Client=
 -> Server : Done!
---[[
--race_gender-packet
-Client -> Server =

-BYTE 	0xBF =

-WORD 	Length ( 15 ) =

-WORD 	Subcommand - 0x2A =

-WORD 	BodyHue =

-WORD 	HairId =

-WORD 	HairHue =

-WORD 	BeardId =

-WORD 	BeardHue
 ]]--
 =

 gActWarmode =3D 0
@@ -933,4 +933,4 @@
 0x0D - Guild Chat
 0x0E - Alliance Chat
 0x0F - Command Prompts
-]]--
+]]--

Modified: trunk/data/lua/net/net.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.main.lua (original)
+++ trunk/data/lua/net/net.main.lua Sun Dec  9 13:46:25 2007
@@ -10,6 +10,7 @@
 dofile(libpath .. "net/net.login.lua")
 dofile(libpath .. "net/net.skill.lua")
 dofile(libpath .. "net/net.buff.lua")
+dofile(libpath .. "net/net.aoscommand.lua")
 =

 -- only things that have at least 2 packets get its own file, everything e=
lse is handled here:
 dofile(libpath .. "net/net.packethandlers.lua")

Modified: trunk/data/lua/net/net.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.mobile.lua (original)
+++ trunk/data/lua/net/net.mobile.lua Sun Dec  9 13:46:25 2007
@@ -264,11 +264,12 @@
 =

 function gPacketHandler.kPacket_Damage()
 	local input =3D GetRecvFIFO()
-	local packetid	=3D input:PopNetUint8()
-	local serial 	=3D input:PopNetUint32()
-	local damage 	=3D input:PopNetUint16()
-	=

-	gCurrentRenderer:NotifyHPChange( serial, damage, 0 )
+	local packetid		=3D input:PopNetUint8()
+	local mobile_serial =3D input:PopNetUint32()
+	local damage		=3D input:PopNetUint16()
+	printdebug("mobile",sprintf("NET: kPacket_Damage: mobile_serial=3D0x%08x =
 damage=3D%i\n",mobile_serial,damage))
+	=

+	gCurrentRenderer:NotifyHPChange( mobile_serial, damage, 0 )
 end
 =

 =

@@ -281,7 +282,7 @@
 	local unknown1 =3D input:PopNetUint8()
 	local attacker_serial =3D input:PopNetUint32()
 	local defender_serial =3D input:PopNetUint32()
-	printf("NET: Swing Attack Animation, attacker=3D0x%08x defender=3D0x%08x\=
n",attacker_serial,defender_serial)
+	printdebug("mobile",sprintf("NET: kPacket_Swing Animation: attacker=3D0x%=
08x defender=3D0x%08x\n",attacker_serial,defender_serial))
 end
 =

 -- TODO : what is the result of this packet?
@@ -291,5 +292,5 @@
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
 	local action =3D input:PopNetUint8()
-	print("NET: Server sends, that player is now (2=3Dghost, 1=3Dresurrect, 0=
=3Dfrom server)=3D"..action)
-end
+	printdebug("mobile",sprintf("NET: kPacket_Death: player is now (2=3Dghost=
, 1=3Dresurrect, 0=3Dfrom server)=3D%i\n",action))
+end



From no-reply at zwischenwelt.org  Sun Dec  9 14:10:48 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 09 Dec 2007 13:10:48 -0000
Subject: [Iris-commit] [IRIS] r1617 - in /trunk/data/lua: lib.devtool.lua
	lib.season.lua
Message-ID: <20071209131051.65AE81C1844D@zwischenwelt.org>

Author: sience
Date: Sun Dec  9 14:10:44 2007
New Revision: 1617

Log:
-gobal <> local bugfixes

Modified:
    trunk/data/lua/lib.devtool.lua
    trunk/data/lua/lib.season.lua

Modified: trunk/data/lua/lib.devtool.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.devtool.lua (original)
+++ trunk/data/lua/lib.devtool.lua Sun Dec  9 14:10:44 2007
@@ -127,7 +127,7 @@
 	local rows =3D { =

 		{ {type=3D"Label",		text=3D"ShowMemoryUsage"}, }
 	}
-	arr =3D {"texture","material","mesh","skeleton","compositor","font","gpup=
rogram","highlevelgpuprogram"}
+	local arr =3D {"texture","material","mesh","skeleton","compositor","font"=
,"gpuprogram","highlevelgpuprogram"}
 	for k,v in pairs(arr) do =

 		table.insert(rows,{ =

 			{type=3D"Label",		text=3Dv},

Modified: trunk/data/lua/lib.season.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.season.lua (original)
+++ trunk/data/lua/lib.season.lua Sun Dec  9 14:10:44 2007
@@ -2,7 +2,7 @@
 gSeasonIDs =3D {[0]=3D"Spring",[1]=3D"Summer",[2]=3D"Fall",[3]=3D"Winter",=
[4]=3D"Desolation"}
 =

 function ParseHex2HexArray (arr)
-	newarr =3D {}
+	local newarr =3D {}
 	for k,v in pairs(arr) do newarr[tonumber(k,16)] =3D tonumber(v,16) end  -=
- hex2num("0x123") is preferred to tonumber(123,16), it is better readable
 	return newarr
 end



From no-reply at zwischenwelt.org  Sun Dec  9 18:33:13 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 09 Dec 2007 17:33:13 -0000
Subject: [Iris-commit] [IRIS] r1618 - /trunk/data/lua/lib.stitchin.lua
Message-ID: <20071209173313.7A8C81C18276@zwischenwelt.org>

Author: sience
Date: Sun Dec  9 18:33:12 2007
New Revision: 1618

Log:
-fix

Modified:
    trunk/data/lua/lib.stitchin.lua

Modified: trunk/data/lua/lib.stitchin.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.stitchin.lua (original)
+++ trunk/data/lua/lib.stitchin.lua Sun Dec  9 18:33:12 2007
@@ -7,7 +7,8 @@
 =

 gStitchinPartNames =3D {"LOWER_ARMS_TOP","HEAD","FACE","UPPER_LEGS_TOP","H=
ANDS","TORSO","LOWER_LEGS_TOP","UPPER_ARMS_BOTTOM","FEET","EARS","LOWER_ARM=
S_BOTTOM","UPPER_LEGS_BOTTOM","LOWER_LEGS_BOTTOM","PELVIS","UPPER_ARMS_TOP"=
,"NECK"}
 =

-function CreateStitchinLoader (loadertype,filepath) =

+function CreateStitchinLoader (loadertype,filepath)
+	if (loadertype=3D=3Dfalse) then return {} end
 	assert(loadertype =3D=3D "FullFile","CreateStitchinLoader : only FullFile=
 loader supported")
 	local stitchininfo =3D {}
 	local def



From no-reply at zwischenwelt.org  Sun Dec  9 22:10:20 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 09 Dec 2007 21:10:20 -0000
Subject: [Iris-commit] [IRIS] r1619 - in /trunk/data/lua:
 gui/gui.paperdoll.lua obj/obj.container.lua
Message-ID: <20071209211021.BADBA1C1844D@zwischenwelt.org>

Author: sience
Date: Sun Dec  9 22:10:19 2007
New Revision: 1619

Log:
-tooltip styles added

Modified:
    trunk/data/lua/gui/gui.paperdoll.lua
    trunk/data/lua/obj/obj.container.lua

Modified: trunk/data/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/gui/gui.paperdoll.lua (original)
+++ trunk/data/lua/gui/gui.paperdoll.lua Sun Dec  9 22:10:19 2007
@@ -275,6 +275,7 @@
 	if (gTooltipSupport) then
 		widget.tooltip_offx =3D kUOToolTippOffX
 		widget.tooltip_offy =3D kUOToolTippOffY
+		widget.stylesetname =3D gGuiDefaultStyleSet
 		widget.on_simple_tooltip =3D function (widget)
 				local  tooltiptext =3D AosToolTip_GetText(widget.item.serial) or ""
 				return (tooltiptext .. " \n ") or "?"

Modified: trunk/data/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.container.lua (original)
+++ trunk/data/lua/obj/obj.container.lua Sun Dec  9 22:10:19 2007
@@ -215,6 +215,7 @@
 	if (gTooltipSupport) then
 		widget.tooltip_offx =3D kUOToolTippOffX
 		widget.tooltip_offy =3D kUOToolTippOffY
+		widget.stylesetname =3D gGuiDefaultStyleSet
 		widget.on_simple_tooltip =3D function (widget) =

 				local tooltiptext =3D AosToolTip_GetText(widget.item.serial) or ""
 				return (tooltiptext .. " \n ") or "?" =




From no-reply at zwischenwelt.org  Mon Dec 10 21:27:57 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 10 Dec 2007 20:27:57 -0000
Subject: [Iris-commit] [IRIS] r1620 - in /trunk/data: ./ grannys/materials/
 lua/ models/materials/ skybox/materials/ terrain/materials/
Message-ID: <20071210202757.D0AF71C184AA@zwischenwelt.org>

Author: sience
Date: Mon Dec 10 21:27:57 2007
New Revision: 1620

Log:
-hued fx added (also moving) -> to test, press key F2
-several comments added to materials
-several check added

Modified:
    trunk/data/config.lua.dist
    trunk/data/grannys/materials/grannybase.material
    trunk/data/lua/lib.3d.dynamic.lua
    trunk/data/lua/lib.3d.map.lua
    trunk/data/lua/lib.3d.renderer.lua
    trunk/data/lua/lib.debugmenu.lua
    trunk/data/lua/lib.keybinds.lua
    trunk/data/lua/lib.test.lua
    trunk/data/models/materials/textures.material
    trunk/data/skybox/materials/skybox.material
    trunk/data/terrain/materials/terrain.material
    trunk/data/terrain/materials/water.material

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Mon Dec 10 21:27:57 2007
@@ -46,7 +46,7 @@
 	gHudNamesFontSize	=3D 26
 end
 =

--- GUI Styles : sience,iris,ray available (see data\lua\gui\gui.styles.lua)
+-- GUI Styles : sience,iris,ray  (see data\lua\gui\gui.styles.lua)
 gGuiDefaultStyleSet =3D "sience"
 =

 -- loader types, FullFile is faster, but uses more ram, OnDemand is slower=
, but uses almost no ram

Modified: trunk/data/grannys/materials/grannybase.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/grannys/materials/grannybase.material (original)
+++ trunk/data/grannys/materials/grannybase.material Mon Dec 10 21:27:57 20=
07
@@ -6,6 +6,7 @@
 // this will be cloned and adjusted to create the materials used by granny=
 models
 material grannybase
 {
+	// Shader: CG & GLSL
 	// Hardware skinning technique
 //	technique Shader
 //	{
@@ -36,6 +37,7 @@
 //		}
 //	}
 =

+	// FIXED FUNCTION - Fallback technique
 	// Software blending technique
 	technique Plain
 	{

Modified: trunk/data/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.dynamic.lua (original)
+++ trunk/data/lua/lib.3d.dynamic.lua Mon Dec 10 21:27:57 2007
@@ -40,9 +40,9 @@
 				-- create model part
 				local child =3D rootgfx:CreateChild()
 				local meshname =3D GetStaticMeshName(v.artid)
-				if meshname then =

+				if (meshname and meshname ~=3D false) then
 					child:SetMesh(meshname)
-					child:SetRenderingDistance(gCurrentRenderer.gDynamicMaxRenderDist)
+					child:SetRenderingDistance(self.gDynamicMaxRenderDist)
 					child:SetPosition(-v.x,v.y,v.z*0.1)
 					child:SetScale(-1,1,1)		-- (-1) thats because xmirror bug and wrong m=
irrored mashes
 					child:SetNormaliseNormals(true)
@@ -71,8 +71,7 @@
 			local parts =3D gMultiLoader:CountMultiParts(id)
 			printdebug("multi","Renderer3D:CreateDynamicGfx: multi id",id,"parts",p=
arts)
 			for p =3D 0, parts-1 do
-				local blocknum,xloc,yloc,zloc,flags
-				blocknum,xloc,yloc,zloc,flags =3D gMultiLoader:GetMultiParts(id,p)
+				local blocknum,xloc,yloc,zloc,flags =3D gMultiLoader:GetMultiParts(id,=
p)
 				=

 				printdebug("multi","part",p,":",blocknum,xloc,yloc,zloc,flags)
 				=

@@ -81,7 +80,7 @@
 					-- create model part
 					local child =3D rootgfx:CreateChild()
 					local meshname =3D GetStaticMeshName(blocknum,item.hue)
-					if meshname then =

+					if (meshname and meshname ~=3D false) then
 						child:SetMesh(meshname)
 						child:SetRenderingDistance(self.gDynamicMaxRenderDist)
 						local x,y,z =3D Renderer3D:UOPosToLocal(xloc,yloc,zloc * 0.1)
@@ -112,7 +111,7 @@
 		-- normal 1 part object
 		item.gfx =3D CreateRootGfx3D()
 		local meshname =3D (not gForceFallBackBillboards_Dynamics) and GetStatic=
MeshName(item.artid,item.hue)
-		if meshname then
+		if (meshname and meshname ~=3D false) then
 			item.gfx:SetMesh(meshname)
 			item.gfx:SetScale(-1,1,1)		-- (-1) thats because xmirror bug and wrong =
mirrored mashes
 			item.gfx:SetNormaliseNormals(true)

Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Mon Dec 10 21:27:57 2007
@@ -4,7 +4,7 @@
 Renderer3D.giMapOriginY =3D 0
 Renderer3D.ROBMAP_CHUNK_SIZE =3D 2  -- size of one chunk, should be 2^n
 Renderer3D.ROBMAP_RECENTER_DIST =3D 200   -- if cur position is off by mor=
e than ROBMAP_RECENTER_DIST blocks, clear cache and recenter
-Renderer3D.giBlendOutPlayerHeight =3D 18
+Renderer3D.giBlendOutPlayerHeight =3D 18	--eriminator: es galt grob, alles=
 was 18z =C3=BCberm char war wurd ausgebledent
 Renderer3D.giBlendOutCurZ =3D nil
 Renderer3D.gbBlendOutTerrainVisible =3D true
 Renderer3D.gMapUpdateInterval =3D 100 -- update the map not every frame, d=
ecrease for fly-videos

Modified: trunk/data/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.renderer.lua (original)
+++ trunk/data/lua/lib.3d.renderer.lua Mon Dec 10 21:27:57 2007
@@ -141,7 +141,6 @@
 --###############################
 --###         EFFECTS         ###
 --###############################
-
 StandardEffect =3D 0
 Fireball			=3D hex2num("0x36d4")
 MagicArrow			=3D hex2num("0x36e4")
@@ -157,11 +156,10 @@
 StranglePart1		=3D hex2num("0x36CB")
 StranglePart2		=3D hex2num("0x374A")
 Wither				=3D hex2num("0x37CC")
-
 ParalyzeField		=3D hex2num("0x0001")	-- ??
 FireField			=3D hex2num("0x0002") -- ???
-ConsecrateWeapon2=3D 9501	--???
---Fizzels		=3D hex2num("0x3735")
+ConsecrateWeapon2	=3D 9501	--???
+--Fizzels			=3D hex2num("0x3735")
 =

 -- effects can have a ttl (time-to-live, effect.ttl in milliseconds, defau=
lt is gParticleEffectDefaultTTL in ms)
 gParticleEffectDefaultTTL =3D 10 * 1000
@@ -186,58 +184,129 @@
 gParticleEffects[StranglePart2]	=3D { etype=3D3, name=3D"StranglePart2", r=
elx=3D0.5, rely=3D0.5, relz=3D3, scalex=3D1, scaley=3D1, scalez=3D1}
 gParticleEffects[Wither]		=3D { etype=3D3, name=3D"Wither", relx=3D0.5, re=
ly=3D0.5, relz=3D3, scalex=3D1, scaley=3D1, scalez=3D1}
 =

--- TODO: manage particle effects, esp. huedfx, decide between effecttypes
+-- Manages particle effects, esp. huedfx, decide between effecttypes
 function Renderer3D:AddEffect( effect )
 	local id =3D StandardEffect
-	=

+
 	if (gParticleEffects[effect.itemid]) then id =3D effect.itemid end
-	=

-	Renderer3D:AddParticleEffect( effect, gParticleEffects[id].name,
-							gParticleEffects[id].relx, gParticleEffects[id].rely, gParticleEffe=
cts[id].relz,
-							gParticleEffects[id].scalex, gParticleEffects[id].scaley, gParticle=
Effects[id].scalez)
-end
-
---gHued_FX =3D {}
---[[
-	if (effect.iseffect=3D=3Dtrue) then
-		-- TODO : serial can't be source or target serial (maybe i create my own=
?!)
-		if (gHued_FX[effect.itemid]) then
-			local old =3D gHued_FX[effect.itemid]
-			Renderer3D:RemoveHuedEffect( old )
-			gHued_FX[effect.itemid]=3Dnil
-		end
-		effect.iseffect=3DRenderer3D:AddHuedEffect( effect, 0.2, -0.2, -0.42 )
-		gHued_FX[effect.itemid] =3D effect
-	end
-]]--
+
+	if (effect.iseffect~=3Dtrue) then
+		Renderer3D:AddHuedEffect( effect, 1, 0, 0 )
+	else
+		Renderer3D:AddParticleEffect( effect, gParticleEffects[id].name,
+								gParticleEffects[id].relx, gParticleEffects[id].rely, gParticleEff=
ects[id].relz,
+								gParticleEffects[id].scalex, gParticleEffects[id].scaley, gParticl=
eEffects[id].scalez)
+	end
+end
+
+-- Hued Effect : to display Meshes as instant Effects
 function Renderer3D:AddHuedEffect( effect, relx, rely, relz )
 	local meshname =3D GetStaticMeshName(effect.itemid,effect.hue)
-	if (meshname) then
+	if (meshname and meshname ~=3D false) then
 		effect.gfx =3D CreateRootGfx3D()
 		effect.gfx:SetMesh(meshname)
 		effect.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)
 		effect.gfx:SetPosition(self:UOPosToLocal(effect.current_locx + relx,effe=
ct.current_locy + rely,effect.current_locz * 0.1 + relz))
+
+		printdebug("effect",sprintf("Create HuedEffect with Mesh=3D%s MeshID=3D0=
x%04x.\n",meshname,effect.itemid) )
+
+		InvokeLater(effect.ttl or gParticleEffectDefaultTTL, function ()
+			-- destroy effect after timeout
+			printdebug("effect",sprintf("destroy effect MeshID=3D0x%04x",effect.ite=
mid))
+			if effect and effect.gfx:IsAlive() then
+				effect.gfx:Destroy()
+				effect =3D nil
+			end
+		end)
+
+		printdebug("effect",vardump(effect))
+		--~ print("##################################")
+		--~ print("DEBUG",effect.speed,effect.duration)
+		--~ print("DEBUG current",effect.current_locx,effect.current_locy,effect=
.current_locz)
+		--~ print("DEBUG source",effect.source_locx,effect.source_locy,effect.so=
urce_locz)
+		--~ print("DEBUG target",effect.target_locx,effect.target_locy,effect.ta=
rget_locz)
+		--~ print("##################################")
+
+		if =

+			effect.current_locx ~=3D effect.target_locx or
+			effect.current_locy ~=3D effect.target_locy or
+			effect.current_locz ~=3D effect.target_locz
+		then
+			-- add stepper to handle effect movement
+			RegisterStepper(function()
+				if not effect or not effect.gfx:IsAlive() then
+					-- i am dead so stop this
+					return true
+				end
+				=

+				if =

+					-- distance from current position to target lower then 0.1
+					math.abs(effect.current_locx - effect.target_locx) < 0.1 and
+					math.abs(effect.current_locy - effect.target_locy) < 0.1 and
+					math.abs(effect.current_locz - effect.target_locz) < 0.1
+				then
+					-- stop moving
+					printdebug("effect","DEBUG STOP")
+					effect.gfx:Destroy()
+					effect =3D nil
+					return true
+				else
+					-- move
+					=

+					-- current -> target
+					local dx =3D effect.target_locx - effect.current_locx
+					local dy =3D effect.target_locy - effect.current_locy
+					local dz =3D effect.target_locz - effect.current_locz
+					-- to target
+					local len =3D math.sqrt(dx*dx + dy*dy + dz*dz)
+					=

+					local speed =3D effect.speed or gParticleEffectDefaultSpeed
+					=

+					local fps_factor =3D 1 / OgreAvgFPS()
+					local uo_speed_factor =3D 5
+					=

+					-- adjust movement vector
+					dx =3D dx / len * speed * fps_factor * uo_speed_factor
+					dy =3D dy / len * speed * fps_factor * uo_speed_factor
+					dz =3D dz / len * speed * fps_factor * uo_speed_factor
+					-- new motified len
+					local len2 =3D math.sqrt(dx*dx + dy*dy + dz*dz)
+				=

+					if ( len2 > len ) then
+						-- reached the end or "missed"
+						effect.current_locx =3D effect.target_locx
+						effect.current_locy =3D effect.target_locy
+						effect.current_locz =3D effect.target_locz
+					else 			=

+						-- move
+						effect.current_locx =3D effect.current_locx + dx =

+						effect.current_locy =3D effect.current_locy + dy
+						effect.current_locz =3D effect.current_locz + dz
+					end
+					=

+					--~ print("=3D=3D=3D=3D=3D DEBUG =3D=3D=3D=3D=3D")
+					--~ print("DEBUG dx,dy,dz",dx,dy,dz)
+					--~ print("DEBUG len,speed,fps",len,speed,fps_factor)
+					--~ print("DEBUG current",effect.current_locx,effect.current_locy,eff=
ect.current_locz)
+					=

+					effect.gfx:SetPosition(self:UOPosToLocal(effect.current_locx + relx,e=
ffect.current_locy + rely,effect.current_locz * 0.1 + relz))
+				end
+			end)
+		end
 	else
-		printf("Hued Paricle effect failed Mesh=3D0x%04x not found.\n",effect.it=
emid)
-	end
-end
-
-function Renderer3D:RemoveHuedEffect( effect )
-	if (effect.gfx) then
-		effect.gfx:Destroy()
-		effect.gfx =3D nil
-	end
-end
-
-
--- TODO : check particle before
+		printdebug("effect",sprintf("Hued Paricle effect failed MeshID=3D0x%04x =
not found.\n",effect.itemid) )
+	end
+end
+
+-- Particle Effect : to display Particles as instant Effects
 function Renderer3D:AddParticleEffect( effect, particlename, relx, rely, r=
elz, scalex, scaley, scalez)
-	printdebug("effect","AddParticleEffect")
+	printdebug("effect",sprintf("Create ParticleEffect with Mesh=3D%s Particl=
eID=3D0x%04x.\n",particlename,effect.itemid) )
 	effect.gfx=3DCreateRootGfx3D()
 	effect.gfx:SetParticleSystem(particlename)
+	effect.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)
 	effect.gfx:SetPosition(self:UOPosToLocal(effect.current_locx + relx,effec=
t.current_locy + rely,effect.current_locz * 0.1 + relz))
 	effect.gfx:SetScale( scalex or 1, scaley or 1, scalez or 1)
---	effect.gfx:SetNormaliseNormals(true)
+	effect.gfx:SetNormaliseNormals(true)
 =

 	InvokeLater(effect.ttl or gParticleEffectDefaultTTL, function ()
 		-- destroy effect after timeout
@@ -248,13 +317,9 @@
 		end
 	end)
 	=

-	-- effect.speed =3D input:PopNetUint8()
-	-- effect.duration =3D input:PopNetUint8()
-	=

-	--~ print("DEBUG",effect.speed,effect.duration)
-	--~ print("##################################")
 	printdebug("effect",vardump(effect))
 	--~ print("##################################")
+	--~ print("DEBUG",effect.speed,effect.duration)
 	--~ print("DEBUG current",effect.current_locx,effect.current_locy,effect.=
current_locz)
 	--~ print("DEBUG source",effect.source_locx,effect.source_locy,effect.sou=
rce_locz)
 	--~ print("DEBUG target",effect.target_locx,effect.target_locy,effect.tar=
get_locz)
@@ -332,7 +397,6 @@
 --###############################
 --###       QUEST ARROW       ###
 --###############################
-
 gQuestArrow =3D nil
 =

 function Renderer3D:ShowQuestArrow( active, x, y )

Modified: trunk/data/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.debugmenu.lua (original)
+++ trunk/data/lua/lib.debugmenu.lua Mon Dec 10 21:27:57 2007
@@ -197,7 +197,7 @@
 		local meshname =3D GetStaticMeshName(iTileType,iHue)
 		local tricount =3D meshname and CountMeshTriangles(meshname) or 0
 		AddFadeLines(sprintf("static %04x(=3D%d) hue=3D%d tricount=3D%d %s",iTil=
eType,iTileType,iHue,tricount,GetStaticTileTypeName(iTileType) or ""))
-		if (meshname) then
+		if (meshname and meshname ~=3D false) then
 			gDebugRootGfx:SetMesh(meshname)
 			gDebugRootGfx:SetOrientation(GetStaticMeshOrientation(iTileType))
 			gDebugRootGfx:SetScale(-1,1,1)			-- (-1) thats because xmirror bug and =
wrong mirrored mashes

Modified: trunk/data/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.keybinds.lua (original)
+++ trunk/data/lua/lib.keybinds.lua Mon Dec 10 21:27:57 2007
@@ -58,8 +58,7 @@
 		Send_AOSCommand(kPacket_AOS_Command_WeaponAbilityRequest,hex2num("0x1"),=
2)
 	 end end end)
 =

-	if (false) then
-		local commandchar =3D "["
+	if (true) then
 		Bind("f2",		function (state) if (not gActiveEditText) then if (state > 0=
) then =

 			local mobile =3D GetPlayerMobile()
 			if mobile then
@@ -77,9 +76,9 @@
 				effect.target_locz =3D mobile.zloc + 2
 				=

 				effect.speed =3D 5
-				effect.duration =3D 0
+				effect.duration =3D 5
 				=

-				effect.itemid =3D hex2num("0x376A")
+				effect.itemid =3D 119--hex2num("0x376A")
 				gCurrentRenderer:AddEffect(effect)
 			end
 		end end end)

Modified: trunk/data/lua/lib.test.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.test.lua (original)
+++ trunk/data/lua/lib.test.lua Mon Dec 10 21:27:57 2007
@@ -122,7 +122,7 @@
 =

 --		print("obj.typeid: "..obj.typeid)
 --		local meshname =3D GetStaticMeshName(obj.typeid,0)
---		if (meshname and meshname ~=3D "") then polycount =3D CountMeshTriangl=
es(meshname) end
+--		if (meshname and meshname ~=3D false) then polycount =3D CountMeshTria=
ngles(meshname) end
 		if (polycount < 1) then =

 			print(obj.amount,sprintf("0x%04x",obj.typeid),obj.typeid,obj.typeobj.ms=
Name,polycount)
 		end

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Mon Dec 10 21:27:57 2007
@@ -5,6 +5,7 @@
 // MESH BASE MATERIAL TEMPLATE
 material tex_base
 {
+	// FIXED FUNCTION
 	technique
 	{
 		pass

Modified: trunk/data/skybox/materials/skybox.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/skybox/materials/skybox.material (original)
+++ trunk/data/skybox/materials/skybox.material Mon Dec 10 21:27:57 2007
@@ -5,6 +5,7 @@
 // SKYBOX BASE TEMPLATE
 material skyboxbase
 {
+	// FIXED FUNCTION
 	technique
 	{
 		pass

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Mon Dec 10 21:27:57 2007
@@ -3,7 +3,7 @@
 //###########################################
 material terrain_base
 {
-	// hlsl & glsl
+	// Shader: hlsl & glsl
 	technique
 	{
 		pass
@@ -30,7 +30,7 @@
 			}
 		}
 	}
-	// Fallback technique
+	// FIXED FUNCTION - Fallback technique
 	technique
 	{
 		pass
@@ -51,7 +51,7 @@
 =

 material terrain_transition
 {
-	// hlsl & glsl
+	// Shader: hlsl & glsl
 	technique
 	{
 		pass base
@@ -109,7 +109,7 @@
 			}
 		}
 	}
-	// Fallback 1
+	// FIXED FUNCTION - Fallback technique
 	technique
 	{
 		pass
@@ -126,7 +126,7 @@
 			}
 		}
 	}
-	// Fallback 2
+	// FIXED FUNCTION - Fallback technique 2
 	// currently does not work
 	technique
 	{

Modified: trunk/data/terrain/materials/water.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/water.material (original)
+++ trunk/data/terrain/materials/water.material Mon Dec 10 21:27:57 2007
@@ -4,7 +4,7 @@
 //water tiles
 material waterbase
 {
-	// hlsl & glsl
+	// Shader: hlsl & glsl
     technique
     {
         pass
@@ -50,7 +50,7 @@
             }
         }
     }
-	// Fallback
+   	// FIXED FUNCTION - Fallback technique
 	technique
 	{
 		pass



From no-reply at zwischenwelt.org  Mon Dec 10 22:30:59 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 10 Dec 2007 21:30:59 -0000
Subject: [Iris-commit] [IRIS] r1621 - in /trunk/data: lua/lib.macrolist.lua
	mymacros.lua.dist
Message-ID: <20071210213100.054B41C186E5@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Dec 10 22:30:59 2007
New Revision: 1621

Log:
targetself added

Modified:
    trunk/data/lua/lib.macrolist.lua
    trunk/data/mymacros.lua.dist

Modified: trunk/data/lua/lib.macrolist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.macrolist.lua (original)
+++ trunk/data/lua/lib.macrolist.lua Mon Dec 10 22:30:59 2007
@@ -49,18 +49,34 @@
 end
 =

 gMacroLastTargetMemory =3D nil
-gMacroTargetLastRunning =3D false
+gMacroWaitForTargetActive =3D false
 function MacroRememberTarget (hitobject)
 	gMacroLastTargetMemory =3D {}
 	for k,v in pairs(hitobject) do gMacroLastTargetMemory[k] =3D v end
 end
 =

 function MacroCmd_TargetLast	(completefun) 		-- repeat the last target	=

-	if (gMacroTargetLastRunning) then return end
-	gMacroTargetLastRunning =3D true
+	if (gMacroWaitForTargetActive) then return end
+	gMacroWaitForTargetActive =3D true
 	RegisterListener("Hook_StartTargetMode",function () =

 			if (gMacroLastTargetMemory) then CompleteTargetMode(gMacroLastTargetMem=
ory) end
-			gMacroTargetLastRunning =3D false
+			gMacroWaitForTargetActive =3D false
+			if (completefun) then completefun() end
+			return true
+		end)
+end
+
+function MacroCmd_TargetSelf	(completefun) 		-- target self
+	if (gMacroWaitForTargetActive) then return end
+	gMacroWaitForTargetActive =3D true
+	RegisterListener("Hook_StartTargetMode",function () =

+			local playermobile =3D GetPlayerMobile()
+			print("MacroCmd_TargetSelf hook triggered")
+			if (playermobile) then =

+				print("#",playermobile.serial)
+				CompleteTargetMode({hittype=3DkMousePickHitType_Mobile,mobile=3Dplayer=
mobile}) =

+			end
+			gMacroWaitForTargetActive =3D false
 			if (completefun) then completefun() end
 			return true
 		end)

Modified: trunk/data/mymacros.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/mymacros.lua.dist (original)
+++ trunk/data/mymacros.lua.dist Mon Dec 10 22:30:59 2007
@@ -69,3 +69,5 @@
 =

 SetMacro("f5",			function() MacroCmd_ItemSlot_Use(1) MacroCmd_TargetLast()=
 end)
 =

+
+SetMacro("f6",	function() MacroCmd_Item_UseByName("bandage") MacroCmd_Targ=
etSelf() end)



From no-reply at zwischenwelt.org  Tue Dec 11 00:29:10 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 10 Dec 2007 23:29:10 -0000
Subject: [Iris-commit] [IRIS] r1622 - /trunk/data/lua/lib.3d.renderer.lua
Message-ID: <20071210232910.5D7F31C184AA@zwischenwelt.org>

Author: sience
Date: Tue Dec 11 00:29:09 2007
New Revision: 1622

Log:
-lustig

Modified:
    trunk/data/lua/lib.3d.renderer.lua

Modified: trunk/data/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.renderer.lua (original)
+++ trunk/data/lua/lib.3d.renderer.lua Tue Dec 11 00:29:09 2007
@@ -212,7 +212,7 @@
 =

 		InvokeLater(effect.ttl or gParticleEffectDefaultTTL, function ()
 			-- destroy effect after timeout
-			printdebug("effect",sprintf("destroy effect MeshID=3D0x%04x",effect.ite=
mid))
+			printdebug("effect","destroy effect")
 			if effect and effect.gfx:IsAlive() then
 				effect.gfx:Destroy()
 				effect =3D nil



From no-reply at zwischenwelt.org  Tue Dec 11 01:00:32 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 11 Dec 2007 00:00:32 -0000
Subject: [Iris-commit] [IRIS] r1623 - /trunk/data/lua/lib.macrolist.lua
Message-ID: <20071211000032.B6F861C186E5@zwischenwelt.org>

Author: sience
Date: Tue Dec 11 01:00:32 2007
New Revision: 1623

Log:
-guistyle added to error message box

Modified:
    trunk/data/lua/lib.macrolist.lua

Modified: trunk/data/lua/lib.macrolist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.macrolist.lua (original)
+++ trunk/data/lua/lib.macrolist.lua Tue Dec 11 01:00:32 2007
@@ -175,7 +175,7 @@
 =

 function MacroError (infotext) =

 	print(infotext)
-	PlainMessageBox(infotext)
+	PlainMessageBox(infotext,gGuiDefaultStyleSet,gGuiDefaultStyleSet)
 end
 =

 =

@@ -204,7 +204,7 @@
 	local success,errormsg_or_result =3D lugrepcall(macrofun)
 	if (not success) then
 		local myErrorText =3D "ERROR executing MACRO for keycombo "..name.." :\n=
"..tostring(errormsg_or_result)
-		PlainMessageBox(myErrorText)
+		PlainMessageBox(myErrorText,gGuiDefaultStyleSet,gGuiDefaultStyleSet)
 	end
 end
 =




From no-reply at zwischenwelt.org  Tue Dec 11 20:02:04 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 11 Dec 2007 19:02:04 -0000
Subject: [Iris-commit] [IRIS] r1624 - in /trunk: data/lua/main.lua
 include/builder.h include/data.h mapdata.php mapinfo.php src/builder.cpp
 src/data_L.cpp
Message-ID: <20071211190204.3C05C1C18279@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Dec 11 20:02:03 2007
New Revision: 1624

Log:
added a few statistical utils for texmaps and groundloader, and a return 0 =
for  idx_length=3D0, and a ExportToFile for texmaps

Added:
    trunk/mapdata.php
    trunk/mapinfo.php
Modified:
    trunk/data/lua/main.lua
    trunk/include/builder.h
    trunk/include/data.h
    trunk/src/builder.cpp
    trunk/src/data_L.cpp

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Tue Dec 11 20:02:03 2007
@@ -239,7 +239,7 @@
 	gui.StartLoading()
 =

 	LoadBasicData()
-
+	=

 	-- show loading screen
 	SetLoadingBackground()
 	Client_RenderOneFrame() -- first frame rendered with ogre, needed for ini=
t of viewport size
@@ -247,6 +247,31 @@
 	NotifyListener("Hook_PreLoad")
 	PreLoad()
 =

+	=

+	if (gCommandLineArguments[1] =3D=3D "-et") then -- export texmaps
+		local count =3D gTexMapLoader:GetCount()
+		print("exporting texmaps : ",count)
+		for iTexMapID =3D 0,count-1 do =

+			local sFilePath =3D sprintf("../mytexmaps/texmap%08d.png",iTexMapID)
+			-- iTexMapID =3D iTranslatedTileTypeID
+			local bSuccess =3D	gTexMapLoader:ExportToFile(sFilePath,iTexMapID)
+			--~ local bSuccess =3D	gTexMapLoader:ExportToFile(sFilePath,iTexMapID,p=
HueLoader=3Dnil,iHue=3D0)
+			print("export",iTexMapID,sFilePath,bSuccess)
+			--~ if (bSuccess) then break end
+		end
+		print("done")
+		os.exit(0)
+	end
+	=

+	if (gCommandLineArguments[1] =3D=3D "-egt") then -- export ground tiletyp=
ecounter
+		local iMapIndex =3D 4
+		LoadMap(iMapIndex)
+		local counter =3D gGroundBlockLoader:CountTileTypes()
+		for k,v in pairs(counter) do print("gTileTypeCount["..iMapIndex.."]["..k=
.."] =3D "..v..";") end
+		print("done")
+		os.exit(0)
+	end
+	=

 	gCurrentRenderer:PreInit()
 =

 	MainMenuFinishedPreLoading()

Modified: trunk/include/builder.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/builder.h (original)
+++ trunk/include/builder.h Tue Dec 11 20:02:03 2007
@@ -72,6 +72,7 @@
 bool	GenerateAnimMaterial				(cAnimLoader& oAnimLoader		,const char* szMat=
Name,const int iID,const int iAnimID,const int iFrame, int& iWidth, int& iH=
eight, int& iCenterX, int& iCenterY, int& iFrames, cHueLoader* pHueLoader, =
short iHue);
 bool	GenerateUnicodeText					(const Ogre::UTFString& sText, const Ogre::UT=
FString& sFont, Ogre::RenderOperation& RenderOp, const uint8 bRed, const ui=
nt8 bGreen, const uint8 bBlue, const uint8 bAlpha, const int iMaxWidth);
 =

+bool	WriteTexMapToFile					(cTexMapLoader& oTexMapLoader,const char* szFil=
ePath,const int iID,cHueLoader* pHueLoader,const short iHue);
 =

 bool	GenerateArtImage(Ogre::Image &image, cArtMapLoader& oArtMapLoader,con=
st int iID,const bool bPixelExact,const bool bInvertY,const bool bInvertX,c=
HueLoader* pHueLoader,const short iHue);
 =


Modified: trunk/include/data.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/data.h (original)
+++ trunk/include/data.h Tue Dec 11 20:02:03 2007
@@ -494,6 +494,7 @@
 		inline _T*		GetChunk				(const int iID) { PROFILE ///< result of Get is =
only valid until next Get call
 			RawIndex* pRawIndex =3D mIndexFile.GetRawIndex(iID);
 			if (!IsIndexValid(pRawIndex)) { printf("GetChunk failed to load index\n=
"); return 0; }
+			if (pRawIndex->miLength <=3D 0) return 0;
 			if (pRawIndex->miOffset + pRawIndex->miLength > miFullFileSize) { =

 				//PROFILE_PRINT_STACKTRACE =

 				//printf("index points to invalid memory : offset=3D%d len=3D%d filele=
n=3D%d\n",pRawIndex->miOffset,pRawIndex->miLength,miFullFileSize); =

@@ -526,6 +527,7 @@
 		inline _T* GetChunk (const int iID) { PROFILE ///< result of Get is only=
 valid until next Get call =

 			RawIndex* pRawIndex =3D mIndexFile.GetRawIndex(iID); =

 			if (!IsIndexValid(pRawIndex) || pRawIndex->miOffset < 0 || pRawIndex->m=
iOffset + pRawIndex->miLength > miFileSize) return 0; // index must be vali=
d, and must point to a valid rawblock =

+			if (pRawIndex->miLength <=3D 0) return 0;
 			=

 			// resize buffer if too small
 			if (miBufferSize < pRawIndex->miLength) {
@@ -591,18 +593,21 @@
 	/// abstract base class
 	class cTexMapLoader : public Lugre::cSmartPointable { public :
 		virtual	cTexMap*	GetTexMap	(const int iID) =3D 0; ///< result of Get is =
only valid until next Get call
+		virtual unsigned int	GetCount	() =3D 0;	///< number of texmaps
 	};
 	=

 	/// loads complete file into one big buffer
 	class cTexMapLoader_IndexedFullFile : public cTexMapLoader, public cIndex=
edRawDataLoader_IndexedFullFile<cTexMap> { public :
 		cTexMapLoader_IndexedFullFile	(const char* szIndexFile,const char* szDat=
aFile);
-		virtual	cTexMap*	GetTexMap	(const int iID); ///< result of Get is only v=
alid until next Get call
+		virtual	cTexMap*		GetTexMap	(const int iID); ///< result of Get is only =
valid until next Get call
+		virtual unsigned int	GetCount	() { return mIndexFile.miFullFileSize / 12=
; }
 	};
 	=

 	/// loads data only on demand
 	class cTexMapLoader_IndexedOnDemand : public cTexMapLoader, public cIndex=
edRawDataLoader_IndexedOnDemand<cTexMap> { public :
 		cTexMapLoader_IndexedOnDemand	(const char* szIndexFile,const char* szDat=
aFile);
-		virtual	cTexMap*	GetTexMap	(const int iID); ///< result of Get is only v=
alid until next Get call
+		virtual	cTexMap*		GetTexMap	(const int iID); ///< result of Get is only =
valid until next Get call
+		virtual unsigned int	GetCount	() { return mIndexFile.miFullFileSize / 12=
; }
 	};
 	=

 	=


Modified: trunk/src/builder.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/builder.cpp (original)
+++ trunk/src/builder.cpp Tue Dec 11 20:02:03 2007
@@ -324,6 +324,44 @@
 	bool bClamp =3D false;
 	GenerateMaterial_16Bit(szMatName,pImgRaw,iTexW,iTexH,bPixelExact,bHasAlph=
a,bEnableLighting,bEnableDepthWrite,bClamp);
 	=

+	delete [] pImgRaw;
+	=

+	return true;
+}
+
+bool	WriteTexMapToFile	(cTexMapLoader& oTexMapLoader,const char* szFilePat=
h,const int iID,cHueLoader* pHueLoader,const short iHue) { PROFILE
+	//~ printf("WriteTexMapToFile path=3D%s id=3D%d hueloader=3D0x%x hue=3D%d=
\n",szFilePath,iID,(int)pHueLoader,iHue);
+	cTexMap *texmap =3D oTexMapLoader.GetTexMap(iID);
+	if (texmap =3D=3D 0) return false;
+	int iImgW =3D texmap->GetWidth();
+	int iImgH =3D texmap->GetHeight();
+	//~ printf("WriteTexMapToFile w=3D%d h=3D%d texmap=3D0x%x\n",iImgW,iImgH,=
texmap);
+	//~ printf("WriteTexMapToFile mpRawData=3D0x%x mpRawIndex=3D0x%x\n ",(int=
)texmap->mpRawData,(int)texmap->mpRawIndex);
+	//~ if (texmap->mpRawIndex) {
+		//~ RawIndex* p =3D texmap->mpRawIndex;	=

+		//~ printf("WriteTexMapToFile miOffset=3D0x%x miLength=3D0x%x miExtra=3D=
0x%x\n ",(int)p->miOffset,(int)p->miLength,(int)p->miExtra);
+	//~ }
+	=

+	short *pImgRaw =3D new short[iImgW*iImgH] ;
+	memset(pImgRaw,0,2*iImgW*iImgH); // not really needed here, as the format=
 does not allow empty pixels, but safe is safe
+	if( iHue && pHueLoader ) {
+		cHueFilter Filter;
+		short* ColorTable =3D pHueLoader->GetHue( iHue-1 )->GetColors();
+		texmap->Decode(pImgRaw,Filter,ColorTable);
+	} else {
+		cSetHighBitFilter Filter;
+		texmap->Decode(pImgRaw,Filter,0);
+	}
+
+	uint32	*pBuf32 =3D new uint32[iImgW*iImgH];
+	ColorBuffer16To32(iImgW,iImgH,(uint16*)pImgRaw,(uint32*)pBuf32);
+	Ogre::DataStreamPtr imgstream(new Ogre::MemoryDataStream(pBuf32,iImgW*iIm=
gH*sizeof(uint32)));
+	=

+	Ogre::Image image;
+	image.loadRawData(imgstream, iImgW, iImgH, Ogre::PF_A8R8G8B8 ); // long :=
 PF_A8R8G8B8 short : PF_A1R5G5B5
+	image.save(szFilePath);
+	=

+	delete [] pBuf32;
 	delete [] pImgRaw;
 	=

 	return true;

Modified: trunk/src/data_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data_L.cpp (original)
+++ trunk/src/data_L.cpp Tue Dec 11 20:02:03 2007
@@ -35,6 +35,7 @@
 			REGISTER_METHOD(GetTile);
 			REGISTER_METHOD(GetNormals);
 			REGISTER_METHOD(GetHeightMap);
+			REGISTER_METHOD(CountTileTypes);
 			#undef REGISTER_METHOD
 		}
 =

@@ -106,6 +107,34 @@
 			return 1;
 		}
 =

+		/// for lua : map<tiletypeid,count> CountTileTypes ()
+		static int	CountTileTypes (lua_State *L) { PROFILE
+			cGroundBlockLoader* pGroundBlockLoader =3D checkudata_alive(L);
+			std::map<int,int> myTileTypeCounter;
+			=

+			// iterate over the whole map, counting tiletypes
+			for (int x=3D0;x<pGroundBlockLoader->miMapW;++x)
+			for (int y=3D0;y<pGroundBlockLoader->miMapH;++y) {
+				cGroundBlock* pGroundBlock =3D pGroundBlockLoader->GetGroundBlock(x,y);
+				if (!pGroundBlock) continue;
+				RawGroundBlock* pChunk =3D pGroundBlock->mpRawGroundBlock;
+				if (!pChunk) continue;
+					=

+				for (int tx=3D0;tx<7;++tx)
+				for (int ty=3D0;ty<7;++ty) {
+					++myTileTypeCounter[pChunk->mTiles[ty][tx].miTileType];
+				}
+			}
+			=

+			lua_newtable(L);
+			for (std::map<int,int>::iterator itor=3DmyTileTypeCounter.begin();itor!=
=3DmyTileTypeCounter.end();++itor) {
+				lua_pushnumber( L, (*itor).second );
+				lua_rawseti( L, -2, (*itor).first );
+			}
+			return 1;
+		}
+			=

+			=

 		static int	GetHeightMap (lua_State *L) { PROFILE
 			cGroundBlockLoader* pGroundBlockLoader =3D checkudata_alive(L);
 			=

@@ -395,7 +424,9 @@
 			=

 			#define REGISTER_METHOD(methodname) mlMethod.push_back(make_luaL_reg(#m=
ethodname,&cTexMapLoader_L::methodname));
 			REGISTER_METHOD(Destroy);
+			REGISTER_METHOD(GetCount);
 			REGISTER_METHOD(CreateMaterial);
+			REGISTER_METHOD(ExportToFile);
 			#undef REGISTER_METHOD
 		}
 =

@@ -413,6 +444,14 @@
 	// object methods exported to lua
 =

 		static int	Destroy			(lua_State *L) { PROFILE delete checkudata_alive(L)=
; return 0; }
+		=

+		/// for lua : int GetCount()
+		static int	GetCount			(lua_State *L) { PROFILE =

+			lua_pushnumber(L,checkudata_alive(L)->GetCount()); =

+			return 1; =

+		}
+		=

+		/// for lua : sMatName	CreateMaterial	(iTexMapID,bHasAlpha,bEnableLighti=
ng,bEnableDepthWrite,bPixelExact,pHueLoader=3Dnil,iHue=3D0)
 		static int	CreateMaterial	(lua_State *L) { PROFILE =

 			int i=3D2;
 			bool bHasAlpha=3D			(lua_gettop(L) >=3D ++i && !lua_isnil(L,i)) ? lua_t=
oboolean(L,i) : true;
@@ -427,6 +466,19 @@
 				bHasAlpha,bEnableLighting,bEnableDepthWrite,bPixelExact,pHueLoader,bHu=
e))
 				myname =3D "";
 			lua_pushstring(L,myname.c_str()); =

+			return 1; =

+		}
+		=

+		/// for lua : bSuccess	ExportToFile (sFilePath,iTexMapID,pHueLoader=3Dni=
l,iHue=3D0)
+		/// exports the texmap to the filepath, e.g. myfile.png, returns true on=
 successs
+		static int	ExportToFile	(lua_State *L) { PROFILE =

+			std::string	sFilePath =3D luaL_checkstring(L,2);
+			int			iTexMapID =3D luaL_checkint(L,3);
+			cHueLoader* pHueLoader=3D (lua_gettop(L) >=3D 4 && !lua_isnil(L,4)) ? c=
LuaBind<cHueLoader>::checkudata(L,4) : 0;
+			short 		iHue=3D		(lua_gettop(L) >=3D 5 && !lua_isnil(L,5)) ? luaL_check=
int(L,5) : 0;
+			=

+			if (!WriteTexMapToFile(*checkudata_alive(L),sFilePath.c_str(),iTexMapID=
,pHueLoader,iHue)) return 0;
+			lua_pushboolean(L,true); =

 			return 1; =

 		}
 		=




From no-reply at zwischenwelt.org  Tue Dec 11 20:48:01 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 11 Dec 2007 19:48:01 -0000
Subject: [Iris-commit] [IRIS] r1625 - /trunk/data/lua/lib.3d.renderer.lua
Message-ID: <20071211194801.B36931C18223@zwischenwelt.org>

Author: sience
Date: Tue Dec 11 20:48:00 2007
New Revision: 1625

Log:
-addeffect improved

Modified:
    trunk/data/lua/lib.3d.renderer.lua

Modified: trunk/data/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.renderer.lua (original)
+++ trunk/data/lua/lib.3d.renderer.lua Tue Dec 11 20:48:00 2007
@@ -156,9 +156,9 @@
 StranglePart1		=3D hex2num("0x36CB")
 StranglePart2		=3D hex2num("0x374A")
 Wither				=3D hex2num("0x37CC")
-ParalyzeField		=3D hex2num("0x0001")	-- ??
+ParalyzeField		=3D hex2num("0x0001")	-- ???
 FireField			=3D hex2num("0x0002") -- ???
-ConsecrateWeapon2	=3D 9501	--???
+ConsecrateWeapon2	=3D hex2num("0x251D")	-- ???
 --Fizzels			=3D hex2num("0x3735")
 =

 -- effects can have a ttl (time-to-live, effect.ttl in milliseconds, defau=
lt is gParticleEffectDefaultTTL in ms)
@@ -186,16 +186,20 @@
 =

 -- Manages particle effects, esp. huedfx, decide between effecttypes
 function Renderer3D:AddEffect( effect )
-	local id =3D StandardEffect
-
-	if (gParticleEffects[effect.itemid]) then id =3D effect.itemid end
-
-	if (effect.iseffect~=3Dtrue) then
-		Renderer3D:AddHuedEffect( effect, 1, 0, 0 )
-	else
-		Renderer3D:AddParticleEffect( effect, gParticleEffects[id].name,
-								gParticleEffects[id].relx, gParticleEffects[id].rely, gParticleEff=
ects[id].relz,
-								gParticleEffects[id].scalex, gParticleEffects[id].scaley, gParticl=
eEffects[id].scalez)
+	local workingeffect =3D nil
+
+	if (gParticleEffects[effect.itemid]) then
+		workingeffect =3D Renderer3D:AddParticleEffect( effect, gParticleEffects=
[effect.itemid].name,
+								gParticleEffects[effect.itemid].relx, gParticleEffects[effect.item=
id].rely, gParticleEffects[effect.itemid].relz,
+								gParticleEffects[effect.itemid].scalex, gParticleEffects[effect.it=
emid].scaley, gParticleEffects[effect.itemid].scalez)
+	elseif (effect.iseffect~=3Dtrue) then
+		workingeffect =3D Renderer3D:AddHuedEffect( effect, 1, 0, 0 )
+	end
+
+	if (workingeffect =3D=3D nil) then
+		Renderer3D:AddParticleEffect( effect, gParticleEffects[StandardEffect].n=
ame,
+								gParticleEffects[StandardEffect].relx, gParticleEffects[StandardEf=
fect].rely, gParticleEffects[StandardEffect].relz,
+								gParticleEffects[StandardEffect].scalex, gParticleEffects[Standard=
Effect].scaley, gParticleEffects[StandardEffect].scalez)
 	end
 end
 =

@@ -293,9 +297,11 @@
 				end
 			end)
 		end
+		return true
 	else
 		printdebug("effect",sprintf("Hued Paricle effect failed MeshID=3D0x%04x =
not found.\n",effect.itemid) )
 	end
+	return nil
 end
 =

 -- Particle Effect : to display Particles as instant Effects
@@ -391,6 +397,7 @@
 			end
 		end)
 	end
+	return true
 end
 =

 =




From no-reply at zwischenwelt.org  Thu Dec 13 21:40:38 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 13 Dec 2007 20:40:38 -0000
Subject: [Iris-commit] [IRIS] r1626 - /trunk/bin/iris2.exe
Message-ID: <20071213204039.2A1441C184AA@zwischenwelt.org>

Author: sience
Date: Thu Dec 13 21:40:36 2007
New Revision: 1626

Log:
-new binary

Modified:
    trunk/bin/iris2.exe

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Thu Dec 13 22:05:49 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 13 Dec 2007 21:05:49 -0000
Subject: [Iris-commit] [IRIS] r1627 - in /trunk: bin/resources.cfg
 data/custom/charactermodels/ data/custom/charoverride.lua
 data/lua/lib.bodygfx.lua data/lua/lib.granny.lua data/lua/main.lua
 include/builder.h mapinfo.php src/builder.cpp src/data_L.cpp
Message-ID: <20071213210550.2B58E1C184AA@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Dec 13 22:05:49 2007
New Revision: 1627

Log:
granny override added, artmaploader:ExportToFile added, mapinfo.php added (=
needs data exported by -ea , -et and -egt into mytexmaps/ and myartmaps/ )

Added:
    trunk/data/custom/charactermodels/
    trunk/data/custom/charoverride.lua
Modified:
    trunk/bin/resources.cfg
    trunk/data/lua/lib.bodygfx.lua
    trunk/data/lua/lib.granny.lua
    trunk/data/lua/main.lua
    trunk/include/builder.h
    trunk/mapinfo.php
    trunk/src/builder.cpp
    trunk/src/data_L.cpp

Modified: trunk/bin/resources.cfg
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/bin/resources.cfg (original)
+++ trunk/bin/resources.cfg Thu Dec 13 22:05:49 2007
@@ -67,6 +67,7 @@
 FileSystem=3D../data/custom/models/to_020000
 FileSystem=3D../data/custom/programs
 FileSystem=3D../data/custom/textures
+FileSystem=3D../data/custom/charactermodels
 =

 # new Terrain Shaderengine
 FileSystem=3D../data/terrain/materials

Modified: trunk/data/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.bodygfx.lua (original)
+++ trunk/data/lua/lib.bodygfx.lua Thu Dec 13 22:05:49 2007
@@ -4,7 +4,11 @@
 -- see also lib.3d.mobile.lua
 -- see also lib.3d.walksmooth.lua
 -- interesting mobile artid : 400 401 (admin robe ? or base human ?)
-		=

+
+
+gCharacterModelOverride =3D {}
+kCharacterModelOverrideFilePath =3D "data/custom/charoverride.lua"
+if (file_exists(kCharacterModelOverrideFilePath)) then dofile(kCharacterMo=
delOverrideFilePath) end
 =

 gBodyGfxPrototype =3D {}
 =

@@ -287,8 +291,15 @@
 -- creates childnodes of parentgfx and adds inserts them into the partsarr=
 table
 function CreateBodyGfxPartsFromModelIDArray (bodyid,parentgfx,partsarr,mod=
elidarr,iPrimaryHandItem,iSecondaryHandItem)
 	if (not gGrannyLoaderType) then return end
-	local skeleton =3D GetOrCreateSkeleton(bodyid) -- skeleton is determined =
by the bodyid, not possible from the wearables
-	printdebug("granny","CreateBodyGfxPartsFromModelIDArray...",bodyid,bodyid=
,skeleton.name)
+	local override_meshname =3D gCharacterModelOverride[bodyid]
+	local skeleton_name
+	if (override_meshname) then =

+		skeleton_name =3D "character_override_skeleton" -- should not be used, o=
verride models don't support equipment yet
+	else
+		local skeleton =3D (not override_meshname) and GetOrCreateSkeleton(bodyi=
d) -- skeleton is determined by the bodyid, not possible from the wearables
+		skeleton_name =3D skeleton.name
+	end
+	printdebug("granny","CreateBodyGfxPartsFromModelIDArray...",bodyid,bodyid=
,skeleton_name)
 	local leftHandEntity1
 	local leftHandEntity2
 	local leftHandBoneName1
@@ -310,7 +321,7 @@
 		local modelid =3D element.modelid
 		if (modelid ~=3D (iPrimaryHandItem and iPrimaryHandItem.modelid) and mod=
elid ~=3D (iSecondaryHandItem and iSecondaryHandItem.modelid)) then
 			-- HasBone
-			local meshname =3D GetGrannyMeshName(modelid,skeleton.name,element.hue =
or 0)
+			local meshname =3D override_meshname or GetGrannyMeshName(modelid,skele=
ton_name,element.hue or 0)
 			if (meshname) then =

 				local partgfx =3D MakeBodyPartGfx(modelid,meshname,parentgfx:CreateChi=
ld(),fsx,fsy,fsz)
 				handname =3D "cp_grasp_rhand"	if (partgfx:HasBone(handname)) then righ=
tHandEntity1 =3D partgfx rightHandBoneName1 =3D handname end
@@ -329,7 +340,7 @@
 	-- create right hand
 	if (iPrimaryHandItem and rightHandBoneName1) then
 		local modelid =3D iPrimaryHandItem.modelid
-		local meshname =3D GetGrannyMeshName(modelid,skeleton.name,iPrimaryHandI=
tem.hue or 0)
+		local meshname =3D GetGrannyMeshName(modelid,skeleton_name,iPrimaryHandI=
tem.hue or 0)
 		if (meshname) then =

 			table.insert(partsarr,MakeBodyPartGfx(modelid,meshname,rightHandEntity1=
:CreateTagPoint(rightHandBoneName1),fsx,fsy,fsz))
 		end
@@ -338,7 +349,7 @@
 	-- create left hand
 	if (iSecondaryHandItem and leftHandBoneName1) then
 		local modelid =3D iSecondaryHandItem.modelid
-		local meshname =3D GetGrannyMeshName(modelid,skeleton.name,iSecondaryHan=
dItem.hue or 0)
+		local meshname =3D GetGrannyMeshName(modelid,skeleton_name,iSecondaryHan=
dItem.hue or 0)
 		if (meshname) then =

 			table.insert(partsarr,MakeBodyPartGfx(modelid,meshname,leftHandEntity1:=
CreateTagPoint(leftHandBoneName1),fsx,fsy,fsz))
 		end

Modified: trunk/data/lua/lib.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.granny.lua (original)
+++ trunk/data/lua/lib.granny.lua Thu Dec 13 22:05:49 2007
@@ -310,7 +310,7 @@
 	-- not in cache, so create mesh
 	local mygranny =3D GetGrannyModelLoader(modelid)
 	if (not mygranny) then gGrannyMeshCache[modelid] =3D false return end
-	CheckGrannyModel(mygranny)
+	--~ CheckGrannyModel(mygranny)
 	local matname =3D GetGrannyMat(modelid,hue,mygranny)
 	local modelinfo =3D GetGrannyModelInfo(modelid)
 	local meshname =3D mygranny:CreateOgreMesh(matname,skeletonname)

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Thu Dec 13 22:05:49 2007
@@ -248,6 +248,20 @@
 	PreLoad()
 =

 	=

+	if (gCommandLineArguments[1] =3D=3D "-ea") then -- export artmaps
+		local count =3D hex2num("0x00004000")
+		print("exporting artmaps : ",count)
+		for iArtMapID =3D 0,count-1 do =

+			local sFilePath =3D sprintf("../myartmaps/artmap%08d.png",iArtMapID)
+			local bSuccess =3D		gArtMapLoader:ExportToFile(sFilePath,iArtMapID)
+			--~ local bSuccess =3D	gArtMapLoader:ExportToFile(sFilePath,iArtMapID,p=
HueLoader=3Dnil,iHue=3D0)
+			print("export",iArtMapID,sFilePath,bSuccess)
+			--~ if (bSuccess) then break end
+		end
+		print("done")
+		os.exit(0)
+	end
+	=

 	if (gCommandLineArguments[1] =3D=3D "-et") then -- export texmaps
 		local count =3D gTexMapLoader:GetCount()
 		print("exporting texmaps : ",count)
@@ -267,7 +281,23 @@
 		local iMapIndex =3D 4
 		LoadMap(iMapIndex)
 		local counter =3D gGroundBlockLoader:CountTileTypes()
-		for k,v in pairs(counter) do print("gTileTypeCount["..iMapIndex.."]["..k=
.."] =3D "..v..";") end
+		for k,v in pairs(counter) do print("$gTileTypeCount["..iMapIndex.."]["..=
k.."] =3D "..v..";") end
+		print("done")
+		os.exit(0)
+	end
+	=

+	if (gCommandLineArguments[1] =3D=3D "-ett") then -- export tiletype-infos
+		local iTileTypeEndID =3D gTileTypeLoader:GetEndID()
+
+		-- dump tiletype infos
+		local iGroundTileTypeIDEnd =3D hex2num("0x00004000")
+		for iGroundTileTypeID =3D 0,iGroundTileTypeIDEnd-1 do
+			local miFlags,miTexID,msName =3D gTileTypeLoader:GetGroundTileType(iGro=
undTileTypeID)
+			if (miFlags) then
+				printf("$gTileType[0x%04x] =3D array(0x%04x,0x%04x,'%s');\n",iGroundTi=
leTypeID,miFlags,miTexID,msName)
+			end
+		end
+		=

 		print("done")
 		os.exit(0)
 	end

Modified: trunk/include/builder.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/builder.h (original)
+++ trunk/include/builder.h Thu Dec 13 22:05:49 2007
@@ -73,6 +73,7 @@
 bool	GenerateUnicodeText					(const Ogre::UTFString& sText, const Ogre::UT=
FString& sFont, Ogre::RenderOperation& RenderOp, const uint8 bRed, const ui=
nt8 bGreen, const uint8 bBlue, const uint8 bAlpha, const int iMaxWidth);
 =

 bool	WriteTexMapToFile					(cTexMapLoader& oTexMapLoader,const char* szFil=
ePath,const int iID,cHueLoader* pHueLoader,const short iHue);
+bool	WriteArtMapToFile					(cArtMapLoader& oArtMapLoader,const char* szFil=
ePath,const int iID,cHueLoader* pHueLoader,const short iHue);
 =

 bool	GenerateArtImage(Ogre::Image &image, cArtMapLoader& oArtMapLoader,con=
st int iID,const bool bPixelExact,const bool bInvertY,const bool bInvertX,c=
HueLoader* pHueLoader,const short iHue);
 =


Modified: trunk/mapinfo.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/mapinfo.php (original)
+++ trunk/mapinfo.php Thu Dec 13 22:05:49 2007
@@ -4,20 +4,66 @@
 $gTileTypeCount[1] =3D array();
 $gTileTypeCount[2] =3D array();
 $gTileTypeCount[3] =3D array();
-$gTileTypeCount[4] =3D array();
+$gTileTypeCount[4] =3D array(); // $gTileTypeCount[$iMapIndex][$iTileTypeI=
D] =3D $count;
+$gTileType =3D array(); // $gTileType[$iTileTypeID] =3D array($iFlags,$iTe=
xMapID,$sName)
 include("mapdata.php");
+include("mytiletypes.php");
+
+$gTileTypeNames =3D array("NoName","sand","forest","jungle","grass","rock"=
,"cave",
+	"snow","water","stone","dirt","wooden floor","sand stone","marble","flags=
tone",
+	"void","lava","cobblestones","embank","brick","planks","tree","furrows","=
leaves","tile","acid","cave exit");
+
+$gMapNames =3D array("Trammel","Felucca","Ilshenar","Malas","Tokuno");
+
+foreach ($gTileTypeNames as $name) { echo "<a href=3D'?typename=3D$name'>$=
name</a> "; } echo "<br>";
+
+function GetTexMapPath ($texmapid) { return sprintf("mytexmaps/texmap%08d.=
png",$texmapid); }
+function GetArtMapPath ($artmapid) { return sprintf("myartmaps/artmap%08d.=
png",$artmapid); }
+
+if (isset($_REQUEST["typename"])) {
+	foreach ($gTileType as $tiletypeid =3D> $arr) {
+		list($flag,$texmapid,$name) =3D $arr;
+		if ($name !=3D $_REQUEST["typename"]) continue;
+		$texmap_path =3D GetTexMapPath($texmapid);
+		$artmap_path =3D GetArtMapPath($tiletypeid);
+		?>
+		<nowrap>
+		<?php if (file_exists($texmap_path)) {?><img border=3D0 src=3D"<?=3D$tex=
map_path?>" alt=3D"<?=3D$texmapid?>" title=3D"<?=3D$texmapid?>" width=3D64 =
height=3D64><?php }?>
+		<?php if (file_exists($artmap_path)) {?><img border=3D0 src=3D"<?=3D$art=
map_path?>" alt=3D"<?=3D$tiletypeid?>" title=3D"<?=3D$tiletypeid?>"><?php }=
?>
+		</nowrap>
+		<?php
+	}
+	exit(0);
+}
 =

 for ($i=3D0;$i<=3D4;++$i) arsort($gTileTypeCount[$i]);
-echo "Hello world !<br>";
 echo "<table><tr>";
 for ($iMapIndex=3D0;$iMapIndex<=3D4;++$iMapIndex) {
-	echo "<td>";
-	echo "mapindex =3D $iMapIndex<br>";
+	echo "<td valign=3Dtop>";
+	echo $gMapNames[$iMapIndex]."[$iMapIndex]<br>";
 	$i =3D 0;
 	echo "<table cellspacing=3D0 border=3D1>\n";
 	foreach ($gTileTypeCount[$iMapIndex] as $iTileTypeID =3D> $c) {
-		echo sprintf("<tr><td>0x%04x</td><td align=3Dright>%d</td></tr>\n",$iTil=
eTypeID,$c);
-		if (++$i >=3D 100) break;
+		list($flag,$texmapid,$name) =3D $gTileType[$iTileTypeID];
+		$texmap_path =3D GetTexMapPath($texmapid);
+		$artmap_path =3D GetArtMapPath($iTileTypeID);
+		?>
+		<tr>
+			<td>
+				<img border=3D0 src=3D"<?=3D$texmap_path?>" alt=3D"" title=3D"" width=
=3D64 height=3D64>
+			</td>
+			<td>
+				<img border=3D0 src=3D"<?=3D$artmap_path?>" alt=3D"" title=3D"">
+			</td>
+			<td align=3Dright>
+				<?=3Dsprintf("%s",$name);?><br>
+				<?=3D$c?><br>
+				<?=3Dsprintf("tile:0x%04x",$iTileTypeID);?><br>
+				<?=3Dsprintf("texmap:0x%04x",$texmapid);?><br>
+			</td>
+		</tr>
+		<?php
+		if (++$i >=3D 200) break;
 	}
 	echo "</table>\n";
 	echo "</td>";

Modified: trunk/src/builder.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/builder.cpp (original)
+++ trunk/src/builder.cpp Thu Dec 13 22:05:49 2007
@@ -188,6 +188,7 @@
 =

 /// generates a raw buffer containing the artmap image data, you need to d=
elete this buffer (delete []) by yourself
 /// this function will store the image size in iTexW and iTexH
+/// if bPixelExact is true, the result width and height will be increased =
to be a power of two, to avoid texture-scaling artifacts
 short *GenerateArtRaw(cArtMapLoader& oArtMapLoader, const int iID, const b=
ool bPixelExact, const bool bInvertY, const bool bInvertX, cHueLoader* pHue=
Loader,const short iHue, int &iTexW, int &iTexH) { PROFILE
 	cArtMap *art =3D oArtMapLoader.GetArtMap(iID);
 	if (art =3D=3D 0) return 0;
@@ -327,6 +328,33 @@
 	delete [] pImgRaw;
 	=

 	return true;
+}
+
+bool	WriteArtMapToFile	(cArtMapLoader& oArtMapLoader,const char* szFilePat=
h,const int iID,cHueLoader* pHueLoader,const short iHue) {
+	int iTexW, iTexH;
+	bool bPixelExact =3D false; // setting this to true would lead to image s=
ize being increased until a multiple of 2 is reached
+	bool bInvertX =3D false;
+	bool bInvertY =3D false;
+	=

+	short *pImgRaw =3D GenerateArtRaw(oArtMapLoader, iID,bPixelExact, bInvert=
Y, bInvertX, pHueLoader, iHue, iTexW, iTexH);
+
+	if(pImgRaw =3D=3D 0){
+		printf("ERROR in WriteArtMapToFile, could not create art raw id=3D%i\n",=
iID);
+		return false;
+	}
+	=

+	=

+	uint32	*pBuf32 =3D new uint32[iTexW*iTexH];
+	ColorBuffer16To32(iTexW,iTexH,(uint16*)pImgRaw,(uint32*)pBuf32);
+	Ogre::DataStreamPtr imgstream(new Ogre::MemoryDataStream(pBuf32,iTexW*iTe=
xH*sizeof(uint32)));
+	=

+	Ogre::Image image;
+	image.loadRawData(imgstream, iTexW, iTexH, Ogre::PF_A8R8G8B8 ); // long :=
 PF_A8R8G8B8 short : PF_A1R5G5B5
+	image.save(szFilePath);
+	=

+	delete [] pBuf32;
+	=

+	delete [] pImgRaw;
 }
 =

 bool	WriteTexMapToFile	(cTexMapLoader& oTexMapLoader,const char* szFilePat=
h,const int iID,cHueLoader* pHueLoader,const short iHue) { PROFILE

Modified: trunk/src/data_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data_L.cpp (original)
+++ trunk/src/data_L.cpp Thu Dec 13 22:05:49 2007
@@ -571,6 +571,7 @@
 			REGISTER_METHOD(GetSize);
 			REGISTER_METHOD(SearchCursorHotspot);
 			REGISTER_METHOD(GetCount);
+			REGISTER_METHOD(ExportToFile);
 			#undef REGISTER_METHOD
 		}
 =

@@ -612,6 +613,19 @@
 					bPixelExact,bInvertY,bInvertX,bHasAlpha,bEnableLighting,bEnableDepthW=
rite,pHueLoader,bHue))
 				myname =3D "";
 			lua_pushstring(L,myname.c_str()); =

+			return 1; =

+		}
+		=

+		/// for lua : bSuccess	ExportToFile (sFilePath,iArtMapID,pHueLoader=3Dni=
l,iHue=3D0)
+		/// exports the texmap to the filepath, e.g. myfile.png, returns true on=
 successs
+		static int	ExportToFile	(lua_State *L) { PROFILE =

+			std::string	sFilePath =3D luaL_checkstring(L,2);
+			int			iArtMapID =3D luaL_checkint(L,3);
+			cHueLoader* pHueLoader=3D (lua_gettop(L) >=3D 4 && !lua_isnil(L,4)) ? c=
LuaBind<cHueLoader>::checkudata(L,4) : 0;
+			short 		iHue=3D		(lua_gettop(L) >=3D 5 && !lua_isnil(L,5)) ? luaL_check=
int(L,5) : 0;
+			=

+			if (!WriteArtMapToFile(*checkudata_alive(L),sFilePath.c_str(),iArtMapID=
,pHueLoader,iHue)) return 0;
+			lua_pushboolean(L,true); =

 			return 1; =

 		}
 		=




From no-reply at zwischenwelt.org  Thu Dec 13 23:02:53 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 13 Dec 2007 22:02:53 -0000
Subject: [Iris-commit] [IRIS] r1628 - in /trunk/data: config.lua.dist
	lua/lib.tilefreewalk.lua
Message-ID: <20071213220254.68F151C184AA@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Dec 13 23:02:53 2007
New Revision: 1628

Log:
debug grid added

Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/lib.tilefreewalk.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Thu Dec 13 23:02:53 2007
@@ -17,6 +17,8 @@
 -- gUOPath =3D "/some/where/uo/"  -- example for linux
 -- gUOPath =3D "C:\\Programme\\EA Games\\Ultima Online\\" -- example for w=
in
 -- gUOPath =3D "c:/programme/uo/"  -- example for win
+
+gDebugTerrainGrid =3D false
 =

 -- Speech support
 gSpeechSupport =3D true

Modified: trunk/data/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.tilefreewalk.lua (original)
+++ trunk/data/lua/lib.tilefreewalk.lua Thu Dec 13 23:02:53 2007
@@ -21,6 +21,41 @@
 gTileFreePlayerRad =3D 0.2 -- radius of player/human
 gTileFreeDebugWallH =3D 0.7
 kStuckCheckDuration =3D 4000
+
+-- ##### ##### ##### ##### ##### init
+
+function UpdateDebugTerrainGrid (rx,ry,rz)
+	if (not gDebugTerrainGrid) then return end
+	if (gDebugTerrainGridGfx) then  gDebugTerrainGridGfx:Destroy() end
+	local gfx =3D CreateRootGfx3D()
+	gDebugTerrainGridGfx =3D gfx
+	gfx:SetSimpleRenderable()
+	=

+	rx =3D rx + 0.5
+	ry =3D ry + 0.5
+	local h =3D 0.5
+	local minx,maxx =3D -4,4
+	local miny,maxy =3D -4,4
+	local wallpieces =3D (maxx-minx+1) + (maxy-miny+1)
+	local r,g,b,a =3D 0,1,0,0.5
+	=

+	gfx:RenderableBegin(4*2*wallpieces,6*2*wallpieces,false,false,OT_TRIANGLE=
_LIST)
+	local vc =3D 0
+	for x =3D minx,maxx do
+		local x1,y1,z1 =3D rx+x,ry+miny,rz
+		local x2,y2,z2 =3D rx+x,ry+maxy,rz
+		vc =3D DrawQuad(gfx,vc, x1,y1,z1, x2,y2,z2, x1,y1,z1+h, x2,y2,z2+h, 0,0,=
 1,0, 0,1, 1,1)
+		vc =3D DrawQuad(gfx,vc, x1,y1,z1+h, x2,y2,z2+h, x1,y1,z1, x2,y2,z2, 0,0,=
 1,0, 0,1, 1,1)
+	end
+	for y =3D miny,maxy do
+		local x1,y1,z1 =3D rx+minx,ry+y,rz
+		local x2,y2,z2 =3D rx+maxx,ry+y,rz
+		vc =3D DrawQuad(gfx,vc, x1,y1,z1, x2,y2,z2, x1,y1,z1+h, x2,y2,z2+h, 0,0,=
 1,0, 0,1, 1,1)
+		vc =3D DrawQuad(gfx,vc, x1,y1,z1+h, x2,y2,z2+h, x1,y1,z1, x2,y2,z2, 0,0,=
 1,0, 0,1, 1,1)
+	end
+	gfx:RenderableEnd()
+	gfx:SetMaterial(GetPlainColourMat(r,g,b,a))
+end
 =

 -- ##### ##### ##### ##### ##### init
 =

@@ -247,6 +282,7 @@
 		self.lastscanx =3D rx
 		self.lastscany =3D ry
 		self.bSkipWalkStep =3D false
+		UpdateDebugTerrainGrid(rx,ry,rz)
 		=

 		self:DebugMarkerGroup_Clear("nearground")
 		function GetGround (x,y) local z =3D self.groundcache[x..","..y] return =
z end --  print("GetGround",x,y,z,rx,ry)



From no-reply at zwischenwelt.org  Thu Dec 13 23:25:21 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 13 Dec 2007 22:25:21 -0000
Subject: [Iris-commit] [IRIS] r1629 - in /trunk: bin/resources.cfg
 data/custom/charactermodels/ data/custom/charoverride.lua
 data/grannys/charoverride.lua data/grannys/models/ data/lua/lib.bodygfx.lua
 data/lua/net/net.login.lua data/skippedfallbacks.lua
Message-ID: <20071213222521.D3A801C184AA@zwischenwelt.org>

Author: sience
Date: Thu Dec 13 23:25:20 2007
New Revision: 1629

Log:
-charactermodels directory moved to data/grannys/models
-charoverride.lua moved to data/grannys/
-Testbit check added
-skippedfallbacks added
-ressource.cfg modified

Added:
    trunk/data/grannys/charoverride.lua
    trunk/data/grannys/models/
Removed:
    trunk/data/custom/charactermodels/
    trunk/data/custom/charoverride.lua
Modified:
    trunk/bin/resources.cfg
    trunk/data/lua/lib.bodygfx.lua
    trunk/data/lua/net/net.login.lua
    trunk/data/skippedfallbacks.lua

Modified: trunk/bin/resources.cfg
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/bin/resources.cfg (original)
+++ trunk/bin/resources.cfg Thu Dec 13 23:25:20 2007
@@ -67,7 +67,6 @@
 FileSystem=3D../data/custom/models/to_020000
 FileSystem=3D../data/custom/programs
 FileSystem=3D../data/custom/textures
-FileSystem=3D../data/custom/charactermodels
 =

 # new Terrain Shaderengine
 FileSystem=3D../data/terrain/materials
@@ -78,3 +77,4 @@
 FileSystem=3D../data/grannys/materials
 FileSystem=3D../data/grannys/programs
 FileSystem=3D../data/grannys/textures
+FileSystem=3D../data/grannys/models

Modified: trunk/data/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.bodygfx.lua (original)
+++ trunk/data/lua/lib.bodygfx.lua Thu Dec 13 23:25:20 2007
@@ -7,7 +7,7 @@
 =

 =

 gCharacterModelOverride =3D {}
-kCharacterModelOverrideFilePath =3D "data/custom/charoverride.lua"
+kCharacterModelOverrideFilePath =3D "data/grannys/charoverride.lua"
 if (file_exists(kCharacterModelOverrideFilePath)) then dofile(kCharacterMo=
delOverrideFilePath) end
 =

 gBodyGfxPrototype =3D {}

Modified: trunk/data/lua/net/net.login.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net/net.login.lua (original)
+++ trunk/data/lua/net/net.login.lua Thu Dec 13 23:25:20 2007
@@ -161,7 +161,7 @@
 	printdebug("login",sprintf("ServerFlag: 0x%08x\n",charlist.flags))
 =

 	-- diable tooltip support for preAos servers (<0x8)
-	if (charlist.flags <=3D hex2num("0x08")) then gTooltipSupport=3Dfalse end
+	if ( TestBit(charlist.flags,hex2num("0x08")) ) then gTooltipSupport=3Dfal=
se end
 =

 	--[[
 	Flags (each flag is for each feature, if you need to combine features, yo=
u need to summ flags):

Modified: trunk/data/skippedfallbacks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/skippedfallbacks.lua (original)
+++ trunk/data/skippedfallbacks.lua Thu Dec 13 23:25:20 2007
@@ -417,3 +417,5 @@
 RegisterSkippedArtBillboardFallBack(2395) -- 0x095b name=3Dfireplace
 RegisterSkippedArtBillboardFallBack(7509) -- 0x1d55 name=3Dskeleton
 RegisterSkippedArtBillboardFallBack(7510) -- 0x1d56 name=3Dskeleton
+RegisterSkippedArtBillboardFallBack(5952) -- 0x1740 name=3Dfountain
+RegisterSkippedArtBillboardFallBack(5954) -- 0x1742 name=3Dfountain



From no-reply at zwischenwelt.org  Thu Dec 13 23:49:08 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 13 Dec 2007 22:49:08 -0000
Subject: [Iris-commit] [IRIS] r1630 - /trunk/data/lua/lib.bodygfx.lua
Message-ID: <20071213224908.C48D01C182CF@zwischenwelt.org>

Author: sience
Date: Thu Dec 13 23:49:08 2007
New Revision: 1630

Log:
-small fix

Modified:
    trunk/data/lua/lib.bodygfx.lua

Modified: trunk/data/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.bodygfx.lua (original)
+++ trunk/data/lua/lib.bodygfx.lua Thu Dec 13 23:49:08 2007
@@ -7,7 +7,7 @@
 =

 =

 gCharacterModelOverride =3D {}
-kCharacterModelOverrideFilePath =3D "data/grannys/charoverride.lua"
+kCharacterModelOverrideFilePath =3D datapath.."grannys/charoverride.lua"
 if (file_exists(kCharacterModelOverrideFilePath)) then dofile(kCharacterMo=
delOverrideFilePath) end
 =

 gBodyGfxPrototype =3D {}



From no-reply at zwischenwelt.org  Fri Dec 14 00:22:42 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 13 Dec 2007 23:22:42 -0000
Subject: [Iris-commit] [IRIS] r1631 - in /trunk: bin/ data/customchars/
 data/customchars/materials/ data/customchars/models/
 data/customchars/textures/ data/grannys/ data/grannys/models/
 data/grannys/textures/ data/lua/
Message-ID: <20071213232242.B5F121C184AA@zwischenwelt.org>

Author: sience
Date: Fri Dec 14 00:22:41 2007
New Revision: 1631

Log:
-again, customchars moved to data/customchars
-charoverride.lua moved to data/customchars

Added:
    trunk/data/customchars/
    trunk/data/customchars/charoverride.lua
    trunk/data/customchars/materials/
    trunk/data/customchars/models/
    trunk/data/customchars/textures/
Removed:
    trunk/data/grannys/charoverride.lua
    trunk/data/grannys/models/
    trunk/data/grannys/textures/
Modified:
    trunk/bin/resources.cfg
    trunk/data/lua/lib.bodygfx.lua

Modified: trunk/bin/resources.cfg
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/bin/resources.cfg (original)
+++ trunk/bin/resources.cfg Fri Dec 14 00:22:41 2007
@@ -76,5 +76,8 @@
 # new Grannys
 FileSystem=3D../data/grannys/materials
 FileSystem=3D../data/grannys/programs
-FileSystem=3D../data/grannys/textures
-FileSystem=3D../data/grannys/models
+
+# custom Grannys (Ogre.mesh + Ogre.skeleton)
+FileSystem=3D../data/customchars/materials
+FileSystem=3D../data/customchars/models
+FileSystem=3D../data/customchars/textures

Modified: trunk/data/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.bodygfx.lua (original)
+++ trunk/data/lua/lib.bodygfx.lua Fri Dec 14 00:22:41 2007
@@ -7,7 +7,7 @@
 =

 =

 gCharacterModelOverride =3D {}
-kCharacterModelOverrideFilePath =3D datapath.."grannys/charoverride.lua"
+kCharacterModelOverrideFilePath =3D datapath.."customchars/charoverride.lu=
a"
 if (file_exists(kCharacterModelOverrideFilePath)) then dofile(kCharacterMo=
delOverrideFilePath) end
 =

 gBodyGfxPrototype =3D {}



From no-reply at zwischenwelt.org  Fri Dec 14 23:04:58 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 14 Dec 2007 22:04:58 -0000
Subject: [Iris-commit] [IRIS] r1632 - in /trunk/data/models:
 materials/textures.material textures/tex_282.png
Message-ID: <20071214220501.4A8231C182BA@zwischenwelt.org>

Author: sience
Date: Fri Dec 14 23:04:57 2007
New Revision: 1632

Log:
-texture set to alpha

Modified:
    trunk/data/models/materials/textures.material
    trunk/data/models/textures/tex_282.png

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Fri Dec 14 23:04:57 2007
@@ -2873,7 +2873,7 @@
 	} =

 }
 =

-material tex_282 : tex_base =

+material tex_282 : tex_base_alpha =

 { =

 	technique =

 	{ =


Modified: trunk/data/models/textures/tex_282.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Sat Dec 15 09:56:29 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Dec 2007 08:56:29 -0000
Subject: [Iris-commit] [IRIS] r1633 - in /trunk/data/models:
 materials/textures.material textures/tex_543.png textures/tex_544.png
Message-ID: <20071215085633.225101C182A0@zwischenwelt.org>

Author: sience
Date: Sat Dec 15 09:56:28 2007
New Revision: 1633

Log:
-small tex alpha fix

Modified:
    trunk/data/models/materials/textures.material
    trunk/data/models/textures/tex_543.png
    trunk/data/models/textures/tex_544.png

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Sat Dec 15 09:56:28 2007
@@ -6933,7 +6933,7 @@
 	} =

 }
 =

-material tex_543 : tex_base =

+material tex_543 : tex_base_alpha =

 { =

 	technique =

 	{ =


Modified: trunk/data/models/textures/tex_543.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/textures/tex_544.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Sat Dec 15 18:46:17 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Dec 2007 17:46:17 -0000
Subject: [Iris-commit] [IRIS] r1634 - in /trunk/data:
 customchars/charoverride.lua lua/lib.debugmenu.lua lua/lib.keybinds.lua
Message-ID: <20071215174617.531521C182A0@zwischenwelt.org>

Author: sience
Date: Sat Dec 15 18:46:16 2007
New Revision: 1634

Log:
-dynamic build function added to Iris2 (key "F6")
:-support only for RunUO/SunUO servers (command: "[set static ARTID")

Modified:
    trunk/data/customchars/charoverride.lua
    trunk/data/lua/lib.debugmenu.lua
    trunk/data/lua/lib.keybinds.lua

Modified: trunk/data/customchars/charoverride.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/customchars/charoverride.lua (original)
+++ trunk/data/customchars/charoverride.lua Sat Dec 15 18:46:16 2007
@@ -1,4 +1,3 @@
 -- override file to use ogre.meshes instead of original granny models
 -- bodyid can be specified either in hexadecimal or in decimal notation
 -- gCharacterModelOverride[hex2num("0xab34")]	=3D "mybla.mesh"
-gCharacterModelOverride[220]				=3D "Lich.mesh"

Modified: trunk/data/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.debugmenu.lua (original)
+++ trunk/data/lua/lib.debugmenu.lua Sat Dec 15 18:46:16 2007
@@ -5,7 +5,7 @@
 =

 kDebugMode_Granny =3D 0
 kDebugMode_Static =3D 1
-kDebugMode_UNUSED =3D 2
+kDebugMode_Online =3D 2
 =

 gCurDebugMode =3D kDebugMode_Granny
 gDebugMenuRunning =3D false
@@ -316,7 +316,7 @@
 		=

 	Bind("f1", function (state) if (not gActiveEditText) then if (state > 0) =
then =

 		gCurDebugMode =3D gCurDebugMode + 1
-		if (gCurDebugMode >=3D kDebugMode_UNUSED) then gCurDebugMode =3D kDebugM=
ode_Granny end
+		if (gCurDebugMode >=3D kDebugMode_Online) then gCurDebugMode =3D kDebugM=
ode_Granny end
 		gDebugMenuAnimIndex =3D 0 gDebugMenuModelIndex =3D 0 DebugMenuShowModel()
 		end end end)
 		=

@@ -335,7 +335,7 @@
 		DebugMenuChangeParam1( 4096)
 		end end end)
 	Bind("f6", function (state) if (not gActiveEditText) then if (state > 0) =
then =

-		ShowDebugMenuArtList(0)
+		if (gCurDebugMode =3D=3D kDebugMode_Static) then ShowDebugMenuArtList(0,=
kDebugMode_Static) end
 		end end end)
 --[[	=

 	Bind("t", function (state) if (not gActiveEditText) then if (state > 0) t=
hen =

@@ -395,7 +395,7 @@
 	return {type=3D"Img2",	w=3Dw,h=3Dh,matname=3Dmatname, u1=3Du1,v1=3Dv1,u2=
=3Du2,v2=3Dv2}
 end
 =

-function ShowDebugMenuArtList (iStart)
+function ShowDebugMenuArtList (iStart, debugmode)
 	local rows =3D { =

 		{ {type=3D"Label",		text=3D"ArtList"}, },
 	}
@@ -410,10 +410,10 @@
 	local iNext2 =3D math.max(0,math.min(iMax,iStart + w*h*10))
 	local iPrev2 =3D math.max(0,math.min(iMax,iStart - w*h*10))
 	local myblank =3D {type=3D"Label",		text=3D""}
-	table.insert(pagerow,{type=3D"Button",text=3D" <<< ",iNewStart=3DiPrev2,o=
nMouseDown=3Dfunction(widget) widget.dialog:Destroy() ShowDebugMenuArtList(=
widget.iNewStart) end})
-	table.insert(pagerow,{type=3D"Button",text=3D"  << ",iNewStart=3DiPrev1,o=
nMouseDown=3Dfunction(widget) widget.dialog:Destroy() ShowDebugMenuArtList(=
widget.iNewStart) end})
-	table.insert(pagerow,{type=3D"Button",text=3D"  >> ",iNewStart=3DiNext1,o=
nMouseDown=3Dfunction(widget) widget.dialog:Destroy() ShowDebugMenuArtList(=
widget.iNewStart) end})
-	table.insert(pagerow,{type=3D"Button",text=3D" >>> ",iNewStart=3DiNext2,o=
nMouseDown=3Dfunction(widget) widget.dialog:Destroy() ShowDebugMenuArtList(=
widget.iNewStart) end})
+	table.insert(pagerow,{type=3D"Button",text=3D" <<< ",iNewStart=3DiPrev2,o=
nMouseDown=3Dfunction(widget) widget.dialog:Destroy() ShowDebugMenuArtList(=
widget.iNewStart, debugmode) end})
+	table.insert(pagerow,{type=3D"Button",text=3D"  << ",iNewStart=3DiPrev1,o=
nMouseDown=3Dfunction(widget) widget.dialog:Destroy() ShowDebugMenuArtList(=
widget.iNewStart, debugmode) end})
+	table.insert(pagerow,{type=3D"Button",text=3D"  >> ",iNewStart=3DiNext1,o=
nMouseDown=3Dfunction(widget) widget.dialog:Destroy() ShowDebugMenuArtList(=
widget.iNewStart, debugmode) end})
+	table.insert(pagerow,{type=3D"Button",text=3D" >>> ",iNewStart=3DiNext2,o=
nMouseDown=3Dfunction(widget) widget.dialog:Destroy() ShowDebugMenuArtList(=
widget.iNewStart, debugmode) end})
 	for x =3D 5,w-1 do table.insert(pagerow,myblank) end
 	table.insert(pagerow,{type=3D"Button",text=3D"close",onMouseDown=3Dfuncti=
on(widget) widget.dialog:Destroy() end})
 	table.insert(rows,pagerow)
@@ -433,8 +433,14 @@
 	=

 					local name =3D GetStaticTileTypeName(i) or "unknown"
 					local label =3D sprintf("%s\n0x%04x",string.sub(name,1,6),i)
-					table.insert(row2	,{type=3D"Button",iArtID=3Di,text=3Dlabel,onMouseDo=
wn=3Dfunction(widget) =

-						DebugMenuJumpToArtID(widget.iArtID) end})
+
+					if (debugmode =3D=3D kDebugMode_Static) then
+						table.insert(row2	,{type=3D"Button",iArtID=3Di,text=3Dlabel,onMouseD=
own=3Dfunction(widget) =

+							DebugMenuJumpToArtID(widget.iArtID) end})
+					elseif(debugmode =3D=3D kDebugMode_Online) then
+						table.insert(row2	,{type=3D"Button",iArtID=3Di,text=3Dlabel,onMouseD=
own=3Dfunction(widget) =

+							SendChat("[add static "..widget.iArtID) end})
+					end
 				end
 			end
 		end

Modified: trunk/data/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.keybinds.lua (original)
+++ trunk/data/lua/lib.keybinds.lua Sat Dec 15 18:46:16 2007
@@ -21,6 +21,10 @@
 =

     -- chatline
 	Bind("return",	function (state) if (state > 0) then ChatLine_ToggleActive=
() end end)
+
+	Bind("f6",		function (state) if (not gActiveEditText) then if (state > 0)=
 then
+		ShowDebugMenuArtList(0,kDebugMode_Online)
+	end end end)
 	=

 	-- additional movement key handling in lib.tilefreewalk (for pressed keys)
 	Bind("right",   function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end end end) =




From no-reply at zwischenwelt.org  Sat Dec 15 19:11:54 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Dec 2007 18:11:54 -0000
Subject: [Iris-commit] [IRIS] r1635 - in /trunk/data: config.lua.dist
	lua/lib.debugmenu.lua
Message-ID: <20071215190017.994961C1802A@zwischenwelt.org>

Author: sience
Date: Sat Dec 15 19:11:53 2007
New Revision: 1635

Log:
-commandchar moved to config.lua.dist
-runuo check added

Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/lib.debugmenu.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Dec 15 19:11:53 2007
@@ -19,6 +19,7 @@
 -- gUOPath =3D "c:/programme/uo/"  -- example for win
 =

 gDebugTerrainGrid =3D false
+gRunUOCmdchar =3D "["
 =

 -- Speech support
 gSpeechSupport =3D true

Modified: trunk/data/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.debugmenu.lua (original)
+++ trunk/data/lua/lib.debugmenu.lua Sat Dec 15 19:11:53 2007
@@ -438,8 +438,10 @@
 						table.insert(row2	,{type=3D"Button",iArtID=3Di,text=3Dlabel,onMouseD=
own=3Dfunction(widget) =

 							DebugMenuJumpToArtID(widget.iArtID) end})
 					elseif(debugmode =3D=3D kDebugMode_Online) then
+						if ((gServerType[gServerEmulator] =3D=3D "RunUO") and gRunUOCmdchar)=
 then
 						table.insert(row2	,{type=3D"Button",iArtID=3Di,text=3Dlabel,onMouseD=
own=3Dfunction(widget) =

-							SendChat("[add static "..widget.iArtID) end})
+									 SendChat(gRunUOCmdchar.."add static "..widget.iArtID) end})
+						end
 					end
 				end
 			end



From no-reply at zwischenwelt.org  Sun Dec 16 00:53:03 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 15 Dec 2007 23:53:03 -0000
Subject: [Iris-commit] [IRIS] r1636 - in /trunk/data: config.lua.dist
 lua/gui/gui.journal.lua lua/lib.3d.map.lua lua/lib.journal.lua
 lua/lib.macrolist.lua lua/lib.mainmenu.lua lua/main.lua
Message-ID: <20071215235304.3F10A1C1829C@zwischenwelt.org>

Author: sience
Date: Sun Dec 16 00:53:03 2007
New Revision: 1636

Log:
-journal updated (little bit buggy, but cleaned), now in gui/gui.journal.lua
-blendout of dynamic layer works now

Removed:
    trunk/data/lua/lib.journal.lua
Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/gui/gui.journal.lua
    trunk/data/lua/lib.3d.map.lua
    trunk/data/lua/lib.macrolist.lua
    trunk/data/lua/lib.mainmenu.lua
    trunk/data/lua/main.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Dec 16 00:53:03 2007
@@ -32,7 +32,8 @@
 gHideOfflineModeTeleportMenu =3D true		-- currently broken
 =

 -- Font settings
-gFontNameDefault =3D "BerlinSans32"		--"TrebuchetMSBold"
+gFontNameDefault =3D "BerlinSans32"
+gJournalFontName =3D "TrebuchetMSBold"
 gFontSizeDefault =3D 15
 gFontChatSize =3D 18
 gFontGumpSize =3D 15

Modified: trunk/data/lua/gui/gui.journal.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/gui/gui.journal.lua (original)
+++ trunk/data/lua/gui/gui.journal.lua Sun Dec 16 00:53:03 2007
@@ -1,3 +1,338 @@
-function ToggleJournal() =

-	ToggleJournal_Old() =

-end
+
+--[[
+function RegisterJournalEntryType (name) _G["kEntryType_"..name] =3D name =
end
+
+-- TODO : maybe  gEntryTypeHandler.Chat =3D function (type,arr) return {r,=
g,b},sprintf("",arr[1],arr[2]) end
+RegisterJournalEntryType("Chat")
+RegisterJournalEntryType("TextMessage")
+RegisterJournalEntryType("ServerMessage")
+RegisterJournalEntryType("PickUpItem")
+RegisterJournalEntryType("DropItem")
+RegisterJournalEntryType("EquipItem")
+RegisterJournalEntryType("UnequipItem")
+RegisterJournalEntryType("Trade")
+RegisterJournalEntryType("DoubleClick")
+RegisterJournalEntryType("Use")
+RegisterJournalEntryType("Death")
+RegisterJournalEntryType("WarMode")
+
+function JournalAddEntry (entrytype,...)
+	-- TODO : vararg params
+end
+]]--
+
+gJournalEntries =3D {}
+gJournalDialog =3D nil
+gJournalDialog_Pref =3D {}
+gJournalResizeStartX,gJournalResizeStartY =3D nil,nil
+gJournalScrollStartX,gJournalScrollStartY =3D nil,nil
+gJournalMaxIdx =3D nil
+gJournalMaxVisIdx =3D nil
+gJournalMinimized =3D false
+
+function JournalAddText (name,message)
+	local sys =3D "System:"
+	local nicklen =3D string.len(name)
+	nicklen =3D math.floor(nicklen*0.9)
+	local initprefix =3D ""	=

+	local mytext =3D message	=

+	-- strip "System:"	=

+	local a,b =3D string.find(name, "System", 1, false)
+	if not string.find(name, "System", 1, true) then =

+		mytext =3D name.."> "..mytext
+	end   	=

+	table.insert(gJournalEntries,mytext)
+	JournalUpdateText()
+end
+
+--[[
+function JournalUpdateFontSize (size)
+	if size < 8 then size =3D 8 end
+	gFontGumpSize =3D size
+end
+
+function splitlines(str)
+	local t =3D {}
+	for line in string.gfind(str, "[^\n]+") do
+    	table.insert(t, line)
+  	end
+	return t
+end
+]]--
+
+function JournalUpdateText ()
+	if (not gJournalDialog or not gJournalEntries) then return end
+	local widget =3D gJournalDialog.maintext
+
+	-- TODO: remove this hack here (its needed because of exception)
+	if (widget) then
+		local left,top,w,h =3D gJournalDialog:GetLTWH()
+		local bx1,by1,bx2,by2 =3D JournalGetTextBorder()
+		local iw,ih =3D w-bx1-bx2	, h-by1-by2
+		-- max visible lines/chars
+		local wraplen =3D math.floor(iw/7)
+		local maxlines =3D math.max(1,math.floor(ih/gFontGumpSize))
+		-- final text
+		local text =3D ""
+		=

+		local prefix =3D "\t>> "
+		local iNumLines =3D table.getn(gJournalEntries)
+		=

+	    -- not used by now
+		if iNumLines < 1 then =

+			return 	=

+		elseif iNumLines < maxlines then =

+			gJournalMaxIdx =3D iNumLines =

+			gJournalMaxVisIdx =3D iNumLines
+		end
+
+		-- iterate over reverse of gJournalEntries
+		-- thx to #lua on freenode :>
+		local iter =3D function(t)
+						local stack =3D {};
+						for k,v in ipairs(t) do table.insert(stack, v); end
+						return coroutine.wrap(function() local n =3D table.remove(stack); wh=
ile n do coroutine.yield(n); n =3D table.remove(stack); end end)
+					 end
+
+		local lineidx =3D 1
+		for jline in iter(gJournalEntries) do =

+			local line =3D ""
+			local linebuf =3D {}
+			local t =3D true
+			-- do the wordwrap
+			for w in string.gfind(jline, "%S+") do
+				local linelen =3D (string.len(line) + string.len(w) + 1)
+				if (linelen <=3D wraplen) then
+			   		line =3D line.." "..w
+		       	else
+		       		table.insert(linebuf,line)
+		       		-- clear line/add ident prefix + last word
+		       		line =3D prefix..w			=

+		     	end     	=

+	    	end
+			table.insert(linebuf,line)		=

+
+			local linesperjentry =3D table.getn(linebuf)
+			if (lineidx + linesperjentry) > maxlines then break end
+
+			lineidx =3D lineidx + linesperjentry
+		    text =3D table.concat(linebuf,"\n").."\n"..text.."\n"
+		end	=

+		widget.gfx:SetText(text)
+		widget:UpdateClip()
+	end
+end
+
+function JournalGetTextBorder () return 40,80,40,50 end
+
+function ToggleJournal ()
+	local pref =3D gJournalDialog_Pref
+	if (gJournalDialog and (gJournalMinimized=3D=3Dfalse)) then
+		-- store current position
+		pref.x,pref.y =3D gJournalDialog.rootwidget.gfx:GetPos()
+		ToggleJournal_Small()
+        =

+	elseif ((gJournalDialog =3D=3D nil) or (gJournalMinimized =3D=3D true)) t=
hen
+        if (gJournalDialog) then =

+            gJournalDialog:Close() =

+        end
+        gJournalMinimized =3D false
+        =

+        gJournalDialog =3D CreateGumpDlgFromGfm(datapath.."gfm/journal.gfm=
")
+        -- create text
+        local parent =3D gJournalDialog.rootwidget
+        local col =3D {1,1,1,1}
+        local bx1,by1,bx2,by2 =3D JournalGetTextBorder()
+        gJournalDialog.maintext =3D guimaker.MakeText(parent,bx1,by1,"",gF=
ontGumpSize,col,gJournalFontName)
+        table.insert(gJournalDialog.clippedWidgets,gJournalDialog.maintext)
+        gJournalDialog.maintext.UpdateClip =3D function (widget) =

+            local left,top,w,h =3D gJournalDialog:GetLTWH()
+            local bx1,by1,bx2,by2 =3D JournalGetTextBorder()
+            local iw,ih =3D w-bx1-bx2	, h-by1-by2
+            widget.gfx:SetClip(widget.gfx:GetDerivedLeft(),widget.gfx:GetD=
erivedTop(),iw,ih) =

+        end
+        -- see also MakeClippedText,SetAutoWrap
+    =

+    =

+        printdebug("gump",(pref.dx or "dx=3Dnil ").." -dxy- "..(pref.dy or=
 "dy=3Dnil"))
+        printdebug("gump",(pref.x or "x=3Dnil ").." -xy- "..(pref.y or "y=
=3Dnil"))
+        =

+        -- TODO : init journal dialog
+        local dialog =3D gJournalDialog
+        dialog.Close =3D function (dialog) =

+            pref.x,pref.y =3D gJournalDialog.rootwidget.gfx:GetPos()
+		    local left,top,w,h =3D gJournalDialog:GetLTWH()
+		    pref.dx,pref.dy =3D w,h
+
+        	gJournalDialog:SetVisible(false)
+            gJournalDialog:Destroy() =

+            gJournalDialog =3D nil             =

+        end
+        =

+        dialog.onMouseDown =3D function (widget,mousebutton)
+            if (mousebutton =3D=3D 2) then widget.dialog:Close() end
+            if (mousebutton =3D=3D 1) then widget.dialog:BringToFront() gu=
i.StartMoveDialog(widget.dialog.rootwidget) end
+        end
+            =

+        -- resize limits
+        dialog.resize_min_total_x,dialog.resize_min_total_y =3D -20,-66	--=
 -100,-66
+        dialog.resize_max_total_x,dialog.resize_max_total_y =3D 60,175	-- =
334,212
+        =

+        =

+    =

+        -- xml attributes to resize params
+        for k,widget in pairs(dialog.childs) do
+            widget.mbIgnoreMouseOver =3D false
+            widget.bResizeNoScaleX =3D (widget.node and widget.node.attr.b=
ResizeNoScaleX =3D=3D "true")
+            widget.bResizeNoScaleY =3D (widget.node and widget.node.attr.b=
ResizeNoScaleY =3D=3D "true")
+        end
+			=

+        -- minimize btn
+		local widget =3D dialog.controls["journal_minimize"]
+		widget.onMouseDown 		=3D function (widget,mousebutton)
+			pref.x,pref.y =3D gJournalDialog.rootwidget.gfx:GetPos()
+			local left,top,w,h =3D gJournalDialog:GetLTWH()
+			pref.dx,pref.dy =3D w,h
+			if (mousebutton =3D=3D 2) then widget.dialog:Close() end
+			if (mousebutton =3D=3D 1) then ToggleJournal_Small() end
+		end
+        =

+        -- resize btn
+		local widget =3D dialog.controls["journal_resize"]
+		widget.onMouseDown              =3D function (widget,mousebutton) =

+            if (mousebutton =3D=3D 1) then
+                widget.gfx:SetMaterial(widget.mat_pressed)
+                gJournalResizeStartX,gJournalResizeStartY =3D GetMousePos()
+                if (true) then
+                    gui.bMouseBlocked =3D true
+                    RegisterStepper(function ()
+                        local x,y =3D GetMousePos()
+                        --AddFadeLines(sprintf("resize %d,%d",2.0*(x-gJour=
nalResizeStartX),(y-gJournalResizeStartY)))
+                        --AddFadeLines(sprintf("resize %d,%d",gJournalDial=
og.resize_x_total or 0,gJournalDialog.resize_y_total or 0))
+                        local dx =3D 2.0*(x-gJournalResizeStartX)
+                        --local dx =3D 0
+                        gJournalDialog:ResizeDelta(dx,(y-gJournalResizeSta=
rtY))
+                        gJournalResizeStartX,gJournalResizeStartY =3D x,y
+                        JournalUpdateText()
+                        =

+                        if (gKeyPressed[key_mouse1]) then
+                            return false -- continue stepping
+                        else
+                            gui.bMouseBlocked =3D false
+                            local left,top,w,h =3D gJournalDialog:GetLTWH()
+                            local bx1,by1,bx2,by2 =3D JournalGetTextBorder=
()
+                            local iw,ih =3D w-bx1-bx2	, h-by1-by2
+                            pref.dx,pref.dy =3D w,h
+                            pref.x,pref.y =3D gJournalDialog.rootwidget.gf=
x:GetPos()
+                            --printdebug("gump",(pref.dx or "dx=3Dnil ")..=
" -idxy- "..(pref.dy or "dy=3Dnil"))
+                            --printdebug("gump",(pref.x or "x=3Dnil ").." =
-xy- "..(pref.y or "y=3Dnil"))
+                            =

+                            return true -- terminate
+                        end
+                    end)
+                end =

+            end -- if
+        end -- function
+
+--[[
+		-- TODO: WRONG !!!! gives exceptions
+        -- scrollbutton
+		local widget =3D dialog.controls["journal_scroll"]
+		widget.onMouseDown 	=3D function (widget,mousebutton) =

+            if (mousebutton =3D=3D 1) then =

+                widget.gfx:SetMaterial(widget.mat_pressed)
+                gui.bMouseBlocked =3D true
+                RegisterStepper(function ()
+                    local left,top,w,h =3D gJournalDialog:GetLTWH()
+                    local bx1,by1,bx2,by2 =3D JournalGetTextBorder()
+                    local iw,ih =3D w-bx1-bx2	, h-by1-by2
+                    =

+                    local a,b =3D widget.gfx:GetPos()
+                    local x,y =3D GetMousePos()
+                    local dy =3D (y-gJournalScrollStartY)
+                    b =3D b+dy
+                    =

+                    -- exit if mouseup or borders reached
+                    if ((b < 74) or (b > ih+15) or (not gKeyPressed[key_mo=
use1])) then =

+                        gui.bMouseBlocked =3D false
+                        return true -- terminate
+                    end
+                    widget.gfx:SetPos(a,b)
+                    gJournalScrollStartX,gJournalScrollStartY =3D x,y
+                    =

+                    return false -- continue stepping
+                end)
+                JournalUpdateText()
+            end -- if
+		end -- function
+]]--	=

+            =

+        JournalUpdateText()
+    else
+        gJournalDialog:Close()
+    end -- if
+    =

+    -- restore last posion and dimension if available
+    RestoreLastState()	=

+    =

+    -- widget.onMouseUp 		=3D function (widget,mousebutton) if (mousebutto=
n =3D=3D 1) then widget.gfx:SetMaterial(widget.mat_normal) end end
+	=

+end	-- function
+
+
+function RestoreLastState()
+    -- restore last position if available
+    local pref =3D gJournalDialog_Pref
+    local dialog =3D gJournalDialog
+    if (dialog and gJournalMinimized =3D=3D false) then =

+        dialog.rootwidget.gfx:SetPos((pref.x or 0),(pref.y or 0)) =

+        =

+        --dialog:SetDimensions((pref.dx or dialog.resize_max_total_x),(pre=
f.dy or dialog.resize_max_total_y))
+        pref.dx =3D (pref.dx or dialog.resize_max_total_x) - dialog.rootwi=
dget.gfx:GetWidth()
+        pref.dy =3D (pref.dy or dialog.resize_max_total_y) - dialog.rootwi=
dget.gfx:GetHeight()
+        dialog:ResizeDelta(pref.dx,pref.dy)  -- =

+        --dialog:ResizeMaximize()
+        =

+        JournalUpdateText()
+    end
+end
+
+function ToggleJournal_Small () -- produces a small journal scroll icon
+	local pref =3D gJournalDialog_Pref
+	if (gJournalDialog) then  =

+        pref.x, pref.y =3D gJournalDialog.rootwidget.gfx:GetPos()
+		gJournalDialog:Close()
+		=

+		-- create minimized journal button
+		gJournalMinimized =3D true
+		CreateJournal_Small()
+	end
+end
+
+function CreateJournal_Small ()
+	gJournalDialog =3D guimaker.MakeSortedDialog()
+	local pref =3D gJournalDialog_Pref
+
+	local dialog =3D gJournalDialog
+	dialog.Close 		=3D function(dialog)
+        	gJournalDialog:SetVisible(false)
+        	gJournalDialog:Destroy()
+        	gJournalDialog =3D nil
+	end
+
+	dialog.onMouseDown =3D function (widget,mousebutton)
+			if (mousebutton =3D=3D 2) then gJournalDialog:Close() end
+			if (mousebutton =3D=3D 1) then
+				widget.dialog:BringToFront()
+				gui.StartMoveDialog(widget.dialog.rootwidget)
+            end
+	end
+
+	local root =3D dialog.rootwidget
+	MakeBorderGumpPart( root, 2096, (pref.x or 0), (pref.y or 0))
+
+	for k,widget in pairs(dialog.childs) do
+            widget.mbIgnoreMouseOver =3D false
+    end
+    =

+end

Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Sun Dec 16 00:53:03 2007
@@ -329,13 +329,19 @@
 				--end
 			end
 		end
-		=

+
 		-- check dynamics for multis to detect house roofs and stuff like this
-		for k,dynamic in pairs(GetDynamicList()) do
-			if (DynamicIsInWorld(dynamic) and dynamic.lMultiChildGfx) then
-				for k,child in pairs(dynamic.lMultiChildGfx) do
-					if (x =3D=3D dynamic.xloc+child.xloc and y =3D=3D dynamic.yloc+child.=
yloc and dynamic.zloc+child.zloc > playerheadpos) then
+		if (not playerIsInside) then
+			for k,dynamic in pairs(GetDynamicList()) do
+				if (DynamicIsInWorld(dynamic)) then
+					if (x =3D=3D dynamic.xloc and y =3D=3D dynamic.yloc and dynamic.zloc =
> playerheadpos) then
 						playerIsInside =3D true
+					elseif (dynamic.lMultiChildGfx) then
+						for k,child in pairs(dynamic.lMultiChildGfx) do
+							if (x =3D=3D dynamic.xloc+child.xloc and y =3D=3D dynamic.yloc+chil=
d.yloc and dynamic.zloc+child.zloc > playerheadpos) then
+								playerIsInside =3D true
+							end
+						end
 					end
 				end
 			end

Modified: trunk/data/lua/lib.macrolist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.macrolist.lua (original)
+++ trunk/data/lua/lib.macrolist.lua Sun Dec 16 00:53:03 2007
@@ -49,18 +49,18 @@
 end
 =

 gMacroLastTargetMemory =3D nil
-gMacroWaitForTargetActive =3D false
+gMacroTargetLastRunning =3D false
 function MacroRememberTarget (hitobject)
 	gMacroLastTargetMemory =3D {}
 	for k,v in pairs(hitobject) do gMacroLastTargetMemory[k] =3D v end
 end
 =

 function MacroCmd_TargetLast	(completefun) 		-- repeat the last target	=

-	if (gMacroWaitForTargetActive) then return end
-	gMacroWaitForTargetActive =3D true
+	if (gMacroTargetLastRunning) then return end
+	gMacroTargetLastRunning =3D true
 	RegisterListener("Hook_StartTargetMode",function () =

 			if (gMacroLastTargetMemory) then CompleteTargetMode(gMacroLastTargetMem=
ory) end
-			gMacroWaitForTargetActive =3D false
+			gMacroTargetLastRunning =3D false
 			if (completefun) then completefun() end
 			return true
 		end)

Modified: trunk/data/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.mainmenu.lua (original)
+++ trunk/data/lua/lib.mainmenu.lua Sun Dec 16 00:53:03 2007
@@ -262,7 +262,7 @@
 end
 =

 function StartMainMenu ()
-	if (gCommandLineSwitches["-jt"]) then ToggleJournal_Old() return end -- j=
ournaltest
+	if (gCommandLineSwitches["-jt"]) then ToggleJournal() return end -- journ=
altest
 	if (gCommandLineSwitches["-mt"]) then ToggleMacroList() return end -- mac=
rolist-test
 	if (gCommandLineSwitches["-so"]) then StartOfflineMode() return end -- st=
art in offline mode
 =


Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Sun Dec 16 00:53:03 2007
@@ -65,7 +65,6 @@
 dofile(libpath .. "lib.gumpparser.lua")
 dofile(libpath .. "lib.data.lua")
 dofile(libpath .. "lib.cliloc.lua")
-dofile(libpath .. "lib.journal.lua")
 dofile(libpath .. "lib.macrolist.lua")
 dofile(libpath .. "lib.walking2.lua")
 dofile(libpath .. "lib.skill.lua")



From no-reply at zwischenwelt.org  Mon Dec 17 01:09:59 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 17 Dec 2007 00:09:59 -0000
Subject: [Iris-commit] [IRIS] r1637 - in /trunk/include: data.h
	tiledterrain.h
Message-ID: <20071217000959.228001C186FB@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Dec 17 01:09:58 2007
New Revision: 1637

Log:
draft for new terrain code

Added:
    trunk/include/tiledterrain.h
Modified:
    trunk/include/data.h

Modified: trunk/include/data.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/data.h (original)
+++ trunk/include/data.h Mon Dec 17 01:09:58 2007
@@ -112,7 +112,7 @@
 =

 	/// see also cGroundBlock
 	struct RawGroundBlock {
-		struct RawGroundTile mTiles[8][8];
+		struct RawGroundTile mTiles[8][8]; /// [y][x]
 	} STRUCT_PACKED; // 8*8*3 =3D 192
 	=

 	/// struct for tiledata.mul first half (id < cStaticTileType::GetFirstID(=
) )



From no-reply at zwischenwelt.org  Mon Dec 17 01:55:17 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 17 Dec 2007 00:55:17 -0000
Subject: [Iris-commit] [IRIS] r1638 - /trunk/include/tiledterrain.h
Message-ID: <20071217005520.EADCD1C186FF@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Dec 17 01:55:15 2007
New Revision: 1638

Log:
terrain

Modified:
    trunk/include/tiledterrain.h

Modified: trunk/include/tiledterrain.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/tiledterrain.h (original)
+++ trunk/include/tiledterrain.h Mon Dec 17 01:55:15 2007
@@ -3,22 +3,7 @@
 =

 #if 0
 // 16.12.2007 : work in progress, not yet finished
-
-
-
-		=

-			/*
-			uotypes : nodraw ?
-			0
-			2
-			431
-			432
-			433
-			434
-			435
-			436
-			437
-			*/
+// uotypes : nodraw ? 0,2,431,432,433,434,435,436,437 =

 =

 =

 template<class _T1,class _T2> class cTiledMultiTexTerrain {
@@ -30,7 +15,9 @@
 		=

 		enum { kMaxZDiff =3D 64 }; ///< mNormalLookup
 		=

-		=

+		static std::vector<float> mTexCoords_Ground;
+		static std::vector<float> mTexCoords_MainMask;
+		static std::vector<float> mTexCoords_Mask;
 		static int		mGroundMaterialTypeLookUp[0x4000]; ///< key=3Duo-groundtype,=
 value=3D in [0,16] or so (depends on tex-atlas)
 		static float	mNormalLookup[kMaxZDiff*2+1][kMaxZDiff*2+1][3]; ///< y,x : =
192kb with 64 maxdiff
 		static float*	mNormals[9*9];
@@ -47,6 +34,7 @@
 		=

 		/// x,y must be in [-1,9]
 		/// returns original uo z integer (16bit)
+		/// only use this after initializing the cache !
 		inline int		GetZ	(const int x,const int y) { return mZ[(y+1)*11+(x+1)]; }
 		=

 		/// calc/limit diff... see also cached GetNormal below
@@ -58,6 +46,7 @@
 		}
 		=

 		/// x,y must be in [0,8]
+		/// only use this after initializing the cache (mNormals) !
 		static inline float*	GetNormal	(const int x,const int y) { return mNorma=
ls[y*9+x]; }
 		=

 		/// call this once at startup
@@ -103,12 +92,12 @@
 			const float dx,const float dy) {
 			=

 			// write position
-			*++w =3D x;
-			*++w =3D y;
-			*++w =3D GetZ(x,y);
+			*++w =3D x + dx;
+			*++w =3D y + dy;
+			*++w =3D GetZ(x+idx,y+idy);
 				=

 			// write normal
-			static float* temp;
+			float* temp;
 			temp =3D GetNormal(x+idx,y+idy);
 			*++w =3D temp[0];
 			*++w =3D temp[1];
@@ -134,6 +123,11 @@
 			*++w =3D temp[0] + dx*temp[2];
 			*++w =3D temp[1] + dy*temp[3];
 		}
+		=

+		inline float*	GetTexCoordInfo_GroundMaterialType	(const int iID) { retur=
n &mTexCoords_Ground[	iID*4]; }
+		inline float*	GetTexCoordInfo_MainMask			(const int iID) { return &mTexC=
oords_MainMask[	iID*4]; }
+		inline float*	GetTexCoordInfo_Mask				(const int iID) { return &mTexCoor=
ds_Mask[		iID*4]; }
+		=

 		=

 		/// pWriter should point to a locked vertex buffer (vram)
 		void	WriteToVertexBuffer (float* pWriter) {
@@ -180,10 +174,9 @@
 		/// returns the most frequent type different from maintype in the surrou=
nding tiles
 		inline int	GetMostFrequentNeighboorType (const int x,const int y,const i=
nt iMainType) {
 			int i,dx,dy,iCurType;
-			static int	myTypes[9];
-			static int	myCounts[9];
-			static int	myNumTypes;
-			miSurroundScan_NumTypes =3D 0;
+			int	myTypes[9];
+			int	myCounts[9];
+			int	myNumTypes =3D 0;
 			=

 			// count types in surrounding tiles
 			for (dy=3D-1;dy<=3D1;++dy)



From no-reply at zwischenwelt.org  Tue Dec 18 01:00:16 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 00:00:16 -0000
Subject: [Iris-commit] [IRIS] r1639 - in /trunk/data: config.lua.dist
 lua/lib.debugmenu.lua lua/lib.keybinds.lua lua/lib.terrain.lua
 mymacros.lua.dist
Message-ID: <20071218010006.486F61C18709@zwischenwelt.org>

Author: sience
Date: Tue Dec 18 01:00:16 2007
New Revision: 1639

Log:
-build macros added (runuo only)
-check added to getmat

Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/lib.debugmenu.lua
    trunk/data/lua/lib.keybinds.lua
    trunk/data/lua/lib.terrain.lua
    trunk/data/mymacros.lua.dist

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Tue Dec 18 01:00:16 2007
@@ -19,7 +19,6 @@
 -- gUOPath =3D "c:/programme/uo/"  -- example for win
 =

 gDebugTerrainGrid =3D false
-gRunUOCmdchar =3D "["
 =

 -- Speech support
 gSpeechSupport =3D true
@@ -196,6 +195,9 @@
 gLoginServerPort =3D 2593		-- runuos standard loginserver port
 gServerSeed =3D hex2num("0xFFFFFFFF")	-- should be the IP of the User
 gPolServer =3D false			-- is it a Pol (Penultima Online) server?
+
+-- Server build command for: dynamics
+gServerAddCmd =3D "[add static"			-- RunUO: [add static (ARTID)
 =

 -- Standard GameServer Settings (this settings are received from Login Ser=
ver)
 gGameServerIP =3D "localhost" -- received IP from loginserver

Modified: trunk/data/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.debugmenu.lua (original)
+++ trunk/data/lua/lib.debugmenu.lua Tue Dec 18 01:00:16 2007
@@ -435,13 +435,11 @@
 					local label =3D sprintf("%s\n0x%04x",string.sub(name,1,6),i)
 =

 					if (debugmode =3D=3D kDebugMode_Static) then
-						table.insert(row2	,{type=3D"Button",iArtID=3Di,text=3Dlabel,onMouseD=
own=3Dfunction(widget) =

+						table.insert(row2	,{type=3D"Button",iArtID=3Di,text=3Dlabel,onMouseU=
p=3Dfunction(widget) =

 							DebugMenuJumpToArtID(widget.iArtID) end})
 					elseif(debugmode =3D=3D kDebugMode_Online) then
-						if ((gServerType[gServerEmulator] =3D=3D "RunUO") and gRunUOCmdchar)=
 then
-						table.insert(row2	,{type=3D"Button",iArtID=3Di,text=3Dlabel,onMouseD=
own=3Dfunction(widget) =

-									 SendChat(gRunUOCmdchar.."add static "..widget.iArtID) end})
-						end
+						table.insert(row2	,{type=3D"Button",iArtID=3Di,text=3Dlabel,onMouseU=
p=3Dfunction(widget) =

+									 SendChat(gServerAddCmd.." "..widget.iArtID) end})
 					end
 				end
 			end

Modified: trunk/data/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.keybinds.lua (original)
+++ trunk/data/lua/lib.keybinds.lua Tue Dec 18 01:00:16 2007
@@ -22,7 +22,7 @@
     -- chatline
 	Bind("return",	function (state) if (state > 0) then ChatLine_ToggleActive=
() end end)
 =

-	Bind("f6",		function (state) if (not gActiveEditText) then if (state > 0)=
 then
+	Bind("ins",		function (state) if (not gActiveEditText) then if (state > 0=
) then
 		ShowDebugMenuArtList(0,kDebugMode_Online)
 	end end end)
 	=

@@ -33,36 +33,37 @@
 	Bind("up",      function (state) if (not gActiveEditText) then if (state =
> 0) then CancelAutoWalk() end else ChatLine_HistoryUpDown(1) end end)
 	=

 	-------------------------------------------------------------------------=
----------
-	Bind("f7",		function (state) if (not gActiveEditText) then if (state > 0)=
 then
-		if (gAmbientLight.r < 1.0) then
-			gAmbientLight.r=3DgAmbientLight.r+0.1
-			gAmbientLight.g=3DgAmbientLight.g+0.1
-			gAmbientLight.b=3DgAmbientLight.b+0.1
-		else
-			gAmbientLight.r=3D1.0
-			gAmbientLight.g=3D1.0
-			gAmbientLight.b=3D1.0
-		end
-		Client_SetAmbientLight(gAmbientLight.r, gAmbientLight.g, gAmbientLight.b=
, 1)
- 	end end end)
-	Bind("f8",	function (state) if (not gActiveEditText) then if (state > 0) =
then
-		if (gAmbientLight.r > 0.1) then
-			gAmbientLight.r=3DgAmbientLight.r-0.1
-			gAmbientLight.g=3DgAmbientLight.g-0.1
-			gAmbientLight.b=3DgAmbientLight.b-0.1
-		else
-			gAmbientLight.r=3D0.0
-			gAmbientLight.g=3D0.0
-			gAmbientLight.b=3D0.0
-		end
-		Client_SetAmbientLight(gAmbientLight.r, gAmbientLight.g, gAmbientLight.b=
, 1)
- 	end end end)
-	Bind("f9",		function (state) if (not gActiveEditText) then if (state > 0)=
 then
-		--local vr =3D OgreAddCompositor(GetMainViewport(), "B&W")
-		Send_AOSCommand(kPacket_AOS_Command_WeaponAbilityRequest,hex2num("0x1"),=
2)
-	 end end end)
-
+--[[
 	if (true) then
+		Bind("f7",		function (state) if (not gActiveEditText) then if (state > 0=
) then
+			if (gAmbientLight.r < 1.0) then
+				gAmbientLight.r=3DgAmbientLight.r+0.1
+				gAmbientLight.g=3DgAmbientLight.g+0.1
+				gAmbientLight.b=3DgAmbientLight.b+0.1
+			else
+				gAmbientLight.r=3D1.0
+				gAmbientLight.g=3D1.0
+				gAmbientLight.b=3D1.0
+			end
+			Client_SetAmbientLight(gAmbientLight.r, gAmbientLight.g, gAmbientLight.=
b, 1)
+	 	end end end)
+		Bind("f8",	function (state) if (not gActiveEditText) then if (state > 0)=
 then
+			if (gAmbientLight.r > 0.1) then
+				gAmbientLight.r=3DgAmbientLight.r-0.1
+				gAmbientLight.g=3DgAmbientLight.g-0.1
+				gAmbientLight.b=3DgAmbientLight.b-0.1
+			else
+				gAmbientLight.r=3D0.0
+				gAmbientLight.g=3D0.0
+				gAmbientLight.b=3D0.0
+			end
+			Client_SetAmbientLight(gAmbientLight.r, gAmbientLight.g, gAmbientLight.=
b, 1)
+	 	end end end)
+		Bind("f9",		function (state) if (not gActiveEditText) then if (state > 0=
) then
+			--local vr =3D OgreAddCompositor(GetMainViewport(), "B&W")
+			Send_AOSCommand(kPacket_AOS_Command_WeaponAbilityRequest,hex2num("0x1")=
,2)
+		 end end end)
+	=

 		Bind("f2",		function (state) if (not gActiveEditText) then if (state > 0=
) then =

 			local mobile =3D GetPlayerMobile()
 			if mobile then
@@ -70,21 +71,23 @@
 				effect.source_locx =3D mobile.xloc
 				effect.source_locy =3D mobile.yloc
 				effect.source_locz =3D mobile.zloc
-	=

+		=

 				effect.current_locx =3D mobile.xloc
 				effect.current_locy =3D mobile.yloc
 				effect.current_locz =3D mobile.zloc
-	=

+		=

 				effect.target_locx =3D mobile.xloc + 10
 				effect.target_locy =3D mobile.yloc + 1
 				effect.target_locz =3D mobile.zloc + 2
-				=

+					=

 				effect.speed =3D 5
 				effect.duration =3D 5
-				=

+					=

 				effect.itemid =3D 119--hex2num("0x376A")
 				gCurrentRenderer:AddEffect(effect)
 			end
 		end end end)
 	end
+]]--
+
 end

Modified: trunk/data/lua/lib.terrain.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.terrain.lua (original)
+++ trunk/data/lua/lib.terrain.lua Tue Dec 18 01:00:16 2007
@@ -26,7 +26,7 @@
 	if ((not matname) and gTexMapLoader) then
 		local miFlags,miTexID,msName =3D gTileTypeLoader:GetGroundTileType(iTran=
slatedTileTypeID)
 		-- only if miTexID is !=3D 0 take tiledata value for iTranslatedTileType=
ID
-		if (miTexID ~=3D 0) then
+		if ((miTexID ~=3D nil) and (miTexID ~=3D 0)) then
 			iTranslatedTileTypeID =3D miTexID
 		end
 =


Modified: trunk/data/mymacros.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/mymacros.lua.dist (original)
+++ trunk/data/mymacros.lua.dist Tue Dec 18 01:00:16 2007
@@ -66,8 +66,13 @@
 SetMacro("f2",			function() MacroCmd_ItemSlot_Use(2) end)
 SetMacro("f3",			function() MacroCmd_ItemSlot_Use(3) end)
 SetMacro("f4",			function() MacroCmd_ItemSlot_Use(4) end)
+SetMacro("f5",			function() MacroCmd_ItemSlot_Use(1) MacroCmd_TargetLast()=
 end)
+SetMacro("f6",			function() MacroCmd_Item_UseByName("bandage") MacroCmd_Ta=
rgetSelf() end)
 =

-SetMacro("f5",			function() MacroCmd_ItemSlot_Use(1) MacroCmd_TargetLast()=
 end)
-
-
-SetMacro("f6",	function() MacroCmd_Item_UseByName("bandage") MacroCmd_Targ=
etSelf() end)
+-- build commands for RunUO/SunUO and Iris Testshard
+SetMacro("pgup",		function() MacroCmd_Say("[xmove 0,0,1") end)
+SetMacro("pgdn",		function() MacroCmd_Say("[xmove 0,0,-1") end)
+-- INS is defined in lib.keybinds.lua to call the build menu
+SetMacro("del",			function() MacroCmd_Say("[remove") end)
+SetMacro("home",		function() MacroCmd_Say("[tele") end)
+SetMacro("end",			function() MacroCmd_Say("[get z") end)



From no-reply at zwischenwelt.org  Tue Dec 18 01:16:59 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 00:16:59 -0000
Subject: [Iris-commit] [IRIS] r1640 - /trunk/data/lua/lib.3d.renderer.lua
Message-ID: <20071218010012.C790B1C1804D@zwischenwelt.org>

Author: sience
Date: Tue Dec 18 01:16:59 2007
New Revision: 1640

Log:
-small comment changed

Modified:
    trunk/data/lua/lib.3d.renderer.lua

Modified: trunk/data/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.renderer.lua (original)
+++ trunk/data/lua/lib.3d.renderer.lua Tue Dec 18 01:16:59 2007
@@ -306,7 +306,7 @@
 =

 -- Particle Effect : to display Particles as instant Effects
 function Renderer3D:AddParticleEffect( effect, particlename, relx, rely, r=
elz, scalex, scaley, scalez)
-	printdebug("effect",sprintf("Create ParticleEffect with Mesh=3D%s Particl=
eID=3D0x%04x.\n",particlename,effect.itemid) )
+	printdebug("effect",sprintf("Create ParticleEffect with Particlename=3D%s=
 ParticleID=3D0x%04x.\n",particlename,effect.itemid) )
 	effect.gfx=3DCreateRootGfx3D()
 	effect.gfx:SetParticleSystem(particlename)
 	effect.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)



From no-reply at zwischenwelt.org  Tue Dec 18 05:52:43 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 04:52:43 -0000
Subject: [Iris-commit] [IRIS] r1641 - in /trunk/data/lua: lib.3d.dynamic.lua
 lib.3d.map.lua lib.gui.iris.lua main.lua
Message-ID: <20071218045244.321561C186FB@zwischenwelt.org>

Author: hagish
Date: Tue Dec 18 05:52:43 2007
New Revision: 1641

Log:
improved multis

Modified:
    trunk/data/lua/lib.3d.dynamic.lua
    trunk/data/lua/lib.3d.map.lua
    trunk/data/lua/lib.gui.iris.lua
    trunk/data/lua/main.lua

Modified: trunk/data/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.dynamic.lua (original)
+++ trunk/data/lua/lib.3d.dynamic.lua Tue Dec 18 05:52:43 2007
@@ -34,76 +34,72 @@
 =

 		if (item.lTile) then
 			printdebug("multi","Serverside Multi detected")
-			local rootgfx =3D CreateRootGfx3D()
-			item.lMultiChildGfx =3D {}
+
+			local multi =3D {}
+			multi.lparts =3D {}
+			=

 			for k,v in pairs(item.lTile) do
-				-- create model part
-				local child =3D rootgfx:CreateChild()
-				local meshname =3D GetStaticMeshName(v.artid)
-				if (meshname and meshname ~=3D false) then
-					child:SetMesh(meshname)
-					child:SetRenderingDistance(self.gDynamicMaxRenderDist)
-					child:SetPosition(-v.x,v.y,v.z*0.1)
-					child:SetScale(-1,1,1)		-- (-1) thats because xmirror bug and wrong m=
irrored mashes
-					child:SetNormaliseNormals(true)
-					child.xloc =3D -v.x
-					child.yloc =3D v.y
-					child.zloc =3D v.z
-					child.artid =3D v.artid
-					table.insert(item.lMultiChildGfx, child)
-				end
-			end
-			item.gfx =3D rootgfx
-
-			-- FILTER: correction : TODO needed??
-			for k,v in pairs(item.lMultiChildGfx) do item.gfx:SetOrientation(GetSta=
ticMeshOrientation(v.artid)) end
-
-			self:UpdateDynamicItemPos(item)
+				-- create part
+				local iTileTypeID =3D v.artid
+				=

+				local iX =3D -v.x
+				local iY =3D v.y
+				local iZ =3D v.z
+
+				-- generate absolute coords
+				iX =3D item.xloc + iX + item.xadd
+				iY =3D item.yloc + iY + item.yadd
+				iZ =3D item.zloc + iZ + item.zadd
+				=

+				local iHue =3D 0
+
+				-- add part
+				table.insert(multi.lparts, {iTileTypeID,iX,iY,iZ,iHue})
+			end
+
+			item.multi =3D multi
+			item.gfx =3D nil
+			Renderer3D.gMultis[multi] =3D true
+			Renderer3D:RebuildChunkAtUOPos(item.xloc, item.yloc)
+			=

 		-- otherwise ist a Clientside Multi
 		elseif gMultiLoader then
 			printdebug("multi","Clientside Multi detected")
-			local rootgfx =3D CreateRootGfx3D()
-			local id =3D item.artid - gMulti_ID
-			=

-			item.lMultiChildGfx =3D {}
-			=

-			-- read out parts and connect them into one scene node
-			local parts =3D gMultiLoader:CountMultiParts(id)
-			printdebug("multi","Renderer3D:CreateDynamicGfx: multi id",id,"parts",p=
arts)
+			=

+			local multi =3D {}
+			=

+			multi.id =3D item.artid - gMulti_ID
+			local parts =3D gMultiLoader:CountMultiParts(multi.id)
+			multi.lparts =3D {}
+			=

+			-- read out parts
+			printdebug("multi","Renderer3D:CreateDynamicGfx: multi id",multi.id,"pa=
rts",parts)
 			for p =3D 0, parts-1 do
-				local blocknum,xloc,yloc,zloc,flags =3D gMultiLoader:GetMultiParts(id,=
p)
-				=

-				printdebug("multi","part",p,":",blocknum,xloc,yloc,zloc,flags)
+				local iTileTypeID,iX,iY,iZ,iFlags =3D gMultiLoader:GetMultiParts(multi=
.id,p)
+				local iHue =3D item.hue
+				=

+				-- generate absolute coords
+				iX =3D item.xloc + iX + item.xadd
+				iY =3D item.yloc + iY + item.yadd
+				iZ =3D item.zloc + iZ + item.zadd
+				=

+				printdebug("multi","part",p,":",iTileTypeID,iX,iY,iZ,iFlags)
 				=

 				-- skip invisible parts
-				if flags =3D=3D 1 then
-					-- create model part
-					local child =3D rootgfx:CreateChild()
-					local meshname =3D GetStaticMeshName(blocknum,item.hue)
-					if (meshname and meshname ~=3D false) then
-						child:SetMesh(meshname)
-						child:SetRenderingDistance(self.gDynamicMaxRenderDist)
-						local x,y,z =3D Renderer3D:UOPosToLocal(xloc,yloc,zloc * 0.1)
-						child:SetPosition(x,y,z)
-						child:SetScale(-1,1,1)			-- (-1) thats because xmirror bug and wrong=
 mirrored mashes
-						child:SetNormaliseNormals(true)
-						child.xloc =3D xloc
-						child.yloc =3D yloc
-						child.zloc =3D zloc
-						child.artid =3D blocknum
-						table.insert(item.lMultiChildGfx, child)
-					else
-						printdebug("multi",sprintf("Renderer3D:CreateDynamicGfx: failed load=
ing sub mesh for dynamic (multi): artid=3D%i\n",blocknum or -1))
-					end
+				if iFlags =3D=3D 1 then
+					-- add part
+					table.insert(multi.lparts, {iTileTypeID,iX,iY,iZ,iHue})
+					=

+					--print("DEBUG",iTileTypeID,iX,iY,iZ,iHue)
 				end
 			end
-			--item.mbIsMulti =3D true
-			item.gfx =3D rootgfx
-
-			-- FILTER: correction : TODO needed??
-			for k,v in pairs(item.lMultiChildGfx) do item.gfx:SetOrientation(GetSta=
ticMeshOrientation(v.artid)) end
-
-			self:UpdateDynamicItemPos(item)
+			=

+			--print("DEBUG","minmax",multi.minx,multi.maxx,multi.miny,multi.maxy)
+			=

+			item.multi =3D multi
+			item.gfx =3D nil
+			Renderer3D.gMultis[multi] =3D true
+			Renderer3D:RebuildChunkAtUOPos(item.xloc, item.yloc)
 		else =

 			printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed loadi=
ng mesh for dynamic (multi): artid=3D%i z_typename=3D%s\n",item.artid or -1=
,item.z_typename or ""))
 		end
@@ -203,4 +199,10 @@
 	end
 	-- if gfx has an assigned lightsource, delete it
 	if (dynamic.lightname) then Client_RemoveLight(dynamic.lightname) dynamic=
.lightname =3D nil end
-end
+	-- remove multi entry
+	if (dynamic.multi) then =

+		local multi =3D dynamic.multi
+		Renderer3D:RebuildChunkAtUOPos(dynamic.xloc,dynamic.yloc)
+		Renderer3D.gMultis[dynamic.multi] =3D nil =

+	end
+end

Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Tue Dec 18 05:52:43 2007
@@ -9,6 +9,7 @@
 Renderer3D.gbBlendOutTerrainVisible =3D true
 Renderer3D.gMapUpdateInterval =3D 100 -- update the map not every frame, d=
ecrease for fly-videos
 Renderer3D.gMaxMapBlocksLoadedPerUpdate =3D 1 -- increase for fly-videos
+Renderer3D.gMultis =3D {} -- list of all multis currently available
 =

 -- the whole map cache consists of (ROBMAP_RECENTER_DIST*2)*(ROBMAP_RECENT=
ER_DIST*2)  chunks
 -- every chunk consists of ROBMAP_CHUNK_SIZE*ROBMAP_CHUNK_SIZE blocks
@@ -84,6 +85,24 @@
 		end end end
 end
 =

+-- rebuild chunk at uo pos
+function Renderer3D:RebuildChunkAtUOPos (x,y)
+	local chunkx =3D math.floor(x / self.ROBMAP_CHUNK_SIZE / 8)
+	local chunky =3D math.floor(y / self.ROBMAP_CHUNK_SIZE / 8)
+	=

+	--print("DEBUG","rebuild",x,y,chunkx,chunky,self.ROBMAP_CHUNK_SIZE)
+	=

+	for y,row in pairs(self.gMapChunks) do
+		for x,chunk in pairs(row) do
+			if (chunk.miX =3D=3D chunkx and chunk.miY =3D=3D chunky)  then
+				--print("DEBUG","chunk",x,y,chunk.miX,chunk.miY)
+				self:DestroyMapChunk(x,y,chunk)
+				self:LoadMapChunk(x,y)
+			end
+		end
+	end
+end
+
 -- coords in chunks
 function Renderer3D:LoadMapChunk (x,y)
 	local bDidLoad =3D false
@@ -106,6 +125,100 @@
 	self.gMapChunks =3D {}
 end
 =

+
+-- handles the entity creation for CreateMapChunk
+function Renderer3D:CreateMapChunkEntity (chunk,iTileTypeID,iXLoc,iYLoc,iZ=
Loc,iHue)
+	local entity =3D {}
+
+	-- FILTER: correction
+	entity.xadd =3D FilterPositionX(iTileTypeID) or 0
+	entity.yadd =3D FilterPositionY(iTileTypeID) or 0
+	entity.zadd =3D FilterPositionZ(iTileTypeID) or 0
+
+	entity.xloc =3D iXLoc + entity.xadd
+	entity.yloc =3D iYLoc + entity.yadd
+	entity.zloc =3D iZLoc + entity.zadd -- in tilecoords from uo
+
+	entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc,entity.yloc,=
entity.zloc*0.1)
+	=

+	entity.iBlockX =3D math.floor(entity.xloc / 8)
+	entity.iBlockY =3D math.floor(entity.yloc / 8)
+	-- TODO not needed?
+	-- entity.id =3D i
+	entity.iTileTypeID =3D iTileTypeID
+	entity.iHue =3D iHue
+	=

+	meshname =3D (not gForceFallBackBillboards_Statics) and GetStaticMeshName=
(iTileTypeID,entity.iHue)
+	=

+	-- create Mesh
+	if (meshname and meshname ~=3D false) then 	--and (not MeshIsPseudoBillBo=
ard(iTileTypeID))) then	--currently disabled
+		entity.staticentity =3D CreateMeshEntity(meshname)
+		local qw,qx,qy,qz =3D GetStaticMeshOrientation(iTileTypeID)
+		local sx,sy,sz =3D -1,1,1 -- scale
+		entity.qw =3D qw
+		entity.qx =3D qx
+		entity.qy =3D qy
+		entity.qz =3D qz
+		entity.sx =3D sx
+		entity.sy =3D sy
+		entity.sz =3D sz
+
+		local myLayer =3D entity.zloc
+		local myLayerStaticGeom =3D chunk.pStaticGeometryLayers[myLayer]
+		if (not myLayerStaticGeom) then
+			myLayerStaticGeom =3D CreateStaticGeometry()
+			chunk.pStaticGeometryLayers[myLayer] =3D myLayerStaticGeom
+		end
+
+		-- apply x mirror
+		myLayerStaticGeom:AddEntity(entity.staticentity,entity.x,entity.y,entity=
.z,qw,qx,qy,qz,sx,sy,sz)
+		table.insert(chunk.lStaticEntities,entity)
+--[[
+--------------------------------------------------------------------------=
---------------------------------------------------
+	elseif (gEnableCanduneTreegeneration_Statics) then
+		if (iTileTypeID =3D=3D 3296) then
+			print("generate tree")
+			local p =3D CreateCaduneTreeParameters()
+			local s =3D CreateCaduneTreeStem(p)
+			s:Grow()
+			entity.gfx =3D s:CreateGeometry()
+
+			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
+			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
+			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
+			entity.gfx:SetScale(0.4,0.4,0.5)
+			entity.gfx:SetNormaliseNormals(true)
+		end
+--------------------------------------------------------------------------=
---------------------------------------------------
+]]--
+	-- if no *.mesh is available, a fallback billboard with original uo_art i=
s generated
+	elseif (gEnableFallBackBillboards_Statics) then
+		local iTranslatedTileTypeID =3D SeasonalStaticTranslation(iTileTypeID, g=
SeasonSetting)
+		if (not IsArtBillboardFallBackSkipped(iTileTypeID)) then
+			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+0.5,entity=
.yloc+0.5,entity.zloc*0.1 + 0.5)
+			entity.gfx =3D CreateRootGfx3D()
+			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
+			entity.gfx.billboard =3D entity.gfx:CreateChild()
+			-- we have to add 16384 for fallbacks
+			self:CreateArtBillBoard(entity.gfx.billboard,iTranslatedTileTypeID + 16=
384,iHue)
+			table.insert(chunk.lStaticEntities,entity)
+			printdebug("missing",sprintf("Fallback: generated : iTranslatedTileType=
ID=3D%i\n", iTranslatedTileTypeID))
+		end
+	end
+
+	-- creates a light if lights are enabled and static is a lightsource
+	-- note! lights don't cast shadows
+	if (gLightsources) then
+		local arrtiletype =3D {}
+		arrtiletype =3D GetStaticTileType(iTileTypeID)
+		if( TestBit(arrtiletype.miFlags or 0,kTileDataFlag_LightSource) ) then
+			local x,y,z =3D Renderer3D:UOPosToLocal(entity.x,entity.y,entity.z * 0.=
1)
+			entity.lightname=3DClient_AddPointLight(entity.x-0.5,entity.y-0.5,entit=
y.z+arrtiletype.miHeight, 0.3,0.3,0.0, 0.3,0.3,0.0, 5.0,0.1,0.1,0.0)
+		end
+	end
+
+	self:UpdateStaticVisibility(entity)
+end
 =

 -- coords in chunks
 function Renderer3D:CreateMapChunk (x,y)
@@ -163,98 +276,60 @@
 =

 				for i =3D 0,iStaticCount-1 do
 					iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i) -- oper=
ates on the block that was last loaded using :Load()
-					local entity =3D {}
-
-					-- FILTER: correction
-					entity.xadd =3D FilterPositionX(iTileTypeID) or 0
-					entity.yadd =3D FilterPositionY(iTileTypeID) or 0
-					entity.zadd =3D FilterPositionZ(iTileTypeID) or 0
-
-					entity.xloc =3D (iBlockUO_X+x)*8 + iX + entity.xadd
-					entity.yloc =3D (iBlockUO_Y+y)*8 + iY + entity.yadd
-					entity.zloc =3D iZ + entity.zadd -- in tilecoords from uo
-
-					entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc,entity.y=
loc,entity.zloc*0.1)
-					entity.iBlockX =3D iBlockUO_X+x
-					entity.iBlockY =3D iBlockUO_Y+y
-					entity.id =3D i
-					entity.iTileTypeID =3D iTileTypeID
-					entity.iHue =3D iHue
 					=

-					meshname =3D (not gForceFallBackBillboards_Statics) and GetStaticMesh=
Name(iTileTypeID,entity.iHue)
+					xloc =3D (iBlockUO_X+x)*8 + iX
+					yloc =3D (iBlockUO_Y+y)*8 + iY
 					=

-					-- create Mesh
-					if (meshname and meshname ~=3D false) then 	--and (not MeshIsPseudoBi=
llBoard(iTileTypeID))) then	--currently disabled
-						entity.staticentity =3D CreateMeshEntity(meshname)
-						local qw,qx,qy,qz =3D GetStaticMeshOrientation(iTileTypeID)
-						local sx,sy,sz =3D -1,1,1 -- scale
-						entity.qw =3D qw
-						entity.qx =3D qx
-						entity.qy =3D qy
-						entity.qz =3D qz
-						entity.sx =3D sx
-						entity.sy =3D sy
-						entity.sz =3D sz
-
-						local myLayer =3D iZ
-						local myLayerStaticGeom =3D chunk.pStaticGeometryLayers[myLayer]
-						if (not myLayerStaticGeom) then
-							myLayerStaticGeom =3D CreateStaticGeometry()
-							chunk.pStaticGeometryLayers[myLayer] =3D myLayerStaticGeom
-						end
-
-						-- apply x mirror
-						myLayerStaticGeom:AddEntity(entity.staticentity,entity.x,entity.y,en=
tity.z,qw,qx,qy,qz,sx,sy,sz)
-						table.insert(chunk.lStaticEntities,entity)
---[[
---------------------------------------------------------------------------=
---------------------------------------------------
-					elseif (gEnableCanduneTreegeneration_Statics) then
-						if (iTileTypeID =3D=3D 3296) then
-							print("generate tree")
-							local p =3D CreateCaduneTreeParameters()
-							local s =3D CreateCaduneTreeStem(p)
-							s:Grow()
-							entity.gfx =3D s:CreateGeometry()
-
-							entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,enti=
ty.yloc+0.5,entity.zloc*0.1)
-							entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
-							entity.gfx:SetPosition(entity.x,entity.y,entity.z)
-							entity.gfx:SetScale(0.4,0.4,0.5)
-							entity.gfx:SetNormaliseNormals(true)
-						end
---------------------------------------------------------------------------=
---------------------------------------------------
-]]--
-					-- if no *.mesh is available, a fallback billboard with original uo_a=
rt is generated
-					elseif (gEnableFallBackBillboards_Statics) then
-						local iTranslatedTileTypeID =3D SeasonalStaticTranslation(iTileTypeI=
D, gSeasonSetting)
-						if (not IsArtBillboardFallBackSkipped(iTileTypeID)) then
-							entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+0.5,en=
tity.yloc+0.5,entity.zloc*0.1 + 0.5)
-							entity.gfx =3D CreateRootGfx3D()
-							entity.gfx:SetPosition(entity.x,entity.y,entity.z)
-							entity.gfx.billboard =3D entity.gfx:CreateChild()
-							-- we have to add 16384 for fallbacks
-							self:CreateArtBillBoard(entity.gfx.billboard,iTranslatedTileTypeID =
+ 16384,iHue)
-							table.insert(chunk.lStaticEntities,entity)
-							printdebug("missing",sprintf("Fallback: generated : iTranslatedTile=
TypeID=3D%i\n", iTranslatedTileTypeID))
-						end
-					end
-
-					-- creates a light if lights are enabled and static is a lightsource
-					-- note! lights don't cast shadows
-					if (gLightsources) then
-						local arrtiletype =3D {}
-						arrtiletype =3D GetStaticTileType(iTileTypeID)
-						if( TestBit(arrtiletype.miFlags or 0,kTileDataFlag_LightSource) ) th=
en
-							local x,y,z =3D Renderer3D:UOPosToLocal(entity.x,entity.y,entity.z =
* 0.1)
-							entity.lightname=3DClient_AddPointLight(entity.x-0.5,entity.y-0.5,e=
ntity.z+arrtiletype.miHeight, 0.3,0.3,0.0, 0.3,0.3,0.0, 5.0,0.1,0.1,0.0)
-						end
-					end
-
-					self:UpdateStaticVisibility(entity)
+					--print("DEBUG","STATIC",iTileTypeID,xloc,yloc,iZ,iHue)
+					self:CreateMapChunkEntity(chunk,iTileTypeID,xloc,yloc,iZ,iHue)
 				end =

 		end end
 	end
 	=

+	-- add multis as statics
+	if (Renderer3D.gMultis) then -- probably needs gArtMapLoader
+		local iTileTypeID,iX,iY,iZ,iHue
+		local entity,meshname
+		=

+		for k,v in pairs(Renderer3D.gMultis) do
+			local multi =3D k
+			=

+			if multi.lparts then
+				for k,v in pairs(multi.lparts) do
+					local UO_X =3D x * self.ROBMAP_CHUNK_SIZE * 8
+					local UO_Y =3D y * self.ROBMAP_CHUNK_SIZE * 8
+
+					iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
+					--print("DEBUG","TILE",iTileTypeID,iX,iY,iZ,iHue,":",UO_X,UO_Y,self.R=
OBMAP_CHUNK_SIZE*8)
+					if	iX >=3D UO_X and iX < UO_X+self.ROBMAP_CHUNK_SIZE*8 and =

+						iY >=3D UO_Y and iY < UO_Y+self.ROBMAP_CHUNK_SIZE*8 then
+						=

+						self:CreateMapChunkEntity(chunk,iTileTypeID,iX,iY,iZ,iHue)
+					end
+				end
+			end
+		end
+		=

+		for x =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
+			for y =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
+				gStaticBlockLoader:Load(iBlockUO_X+x,iBlockUO_Y+y)
+				local iStaticCount =3D gStaticBlockLoader:Count() -- operates on the b=
lock that was last loaded using :Load()
+
+				--printdebug("static","iStaticCount=3D"..iStaticCount)
+				--printdebug("static","iBlockUO_X=3D"..iBlockUO_X.." iBlockUO_Y=3D"..i=
BlockUO_Y)
+				--printdebug("static","BlockX=3D"..x.." BlockY=3D"..y)
+
+				for i =3D 0,iStaticCount-1 do
+					iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i) -- oper=
ates on the block that was last loaded using :Load()
+
+					xloc =3D (iBlockUO_X+x)*8 + iX
+					yloc =3D (iBlockUO_Y+y)*8 + iY
+					=

+					self:CreateMapChunkEntity(chunk,iTileTypeID,xloc,yloc,iZ,iHue)
+				end =

+		end end
+	end
+
 	-- TODO : fish in water ? other gimiks ?
 	=

 	for layerZ,layerStaticGeom in pairs(chunk.pStaticGeometryLayers) do =


Modified: trunk/data/lua/lib.gui.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.gui.iris.lua (original)
+++ trunk/data/lua/lib.gui.iris.lua Tue Dec 18 05:52:43 2007
@@ -36,7 +36,7 @@
 	if (gMyTicks > gMemStats_NextUpdate) then
 		gMemStats_NextUpdate =3D gMyTicks + 1000
 		local mem_dyn, mem_tresh =3D gcinfo()
-		local text =3D sprintf("%0.2fmb OGRE %0.2fmb / %0.2fmb LUA",memoryusage =
/ 1024 / 1024, mem_dyn / 1024, mem_tresh / 1024)
+		local text =3D sprintf("%0.1fmb %dt %db OGRE %0.fmb / %0.1fmb LUA",memor=
yusage / 1024 / 1024, OgreTriangleCount(), OgreBatchCount(), mem_dyn / 1024=
, mem_tresh / 1024)
 		if (not gMemoryUsageField) then
 			local vw,vh =3D GetViewportSize()
 			local w,h =3D 0,12

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Tue Dec 18 05:52:43 2007
@@ -318,7 +318,47 @@
 	if (gStartInDebugMode) then StopMainMenu() StartDebugMenu() end
 =

 	-- mainloop
-	while (Client_IsAlive()) do MainStep() end
+	while (Client_IsAlive()) do =

+		--[[	=

+		if gGrass and gStaticLoader then =

+			gGrass:Update() =

+		elseif GetMainCam() and gStaticBlockLoader then
+			gGrass =3D CreatePagedGeometry(GetMainCam(), 50)
+			gGrass:AddDetailLevel("batch",100,50)
+			--gGrass:AddDetailLevel("impostor",500,50)
+
+			local x,y,z =3D gCurrentRenderer:LocalToUOPos(GetMainCam():GetPos())
+			gStaticLoader =3D CreatePagedGeometryStaticLoader(gGrass, gStaticBlockL=
oader, -1,1,10, x,y,z)
+			gStaticLoader:AssignToPagedGeometry(gGrass)
+			=

+			--[[
+			gGrassLoader =3D CreateGrassLoader(gGrass)
+			gGrassLoader:AssignToPagedGeometry(gGrass)
+
+			gGrassLoader:SetHeightFunction(function(x,z)
+				return x+z
+			end)
+
+			local l =3D gGrassLoader:AddLayer("grass")
+
+			l:SetMinimumSize(2.0, 2.0)
+			l:SetMaximumSize(2.5, 2.5)
+			l:SetAnimationEnabled(true)
+			l:SetSwayDistribution(10.0)
+			l:SetSwayLength(0.5)
+			l:SetSwaySpeed(0.5)
+			l:SetDensity(1.5)
+			l:SetFadeTechnique(false,true)
+			=

+			l:SetColorMapFileColor("terrain_texture.jpg")
+			l:SetDensityMapFileAlpha("grass_density.png")
+			l:SetMapBounds(-1500, -1500, 1500, 1500)
+			]]--
+		end
+		]]--
+		=

+		MainStep() =

+	end
 end
 =

 =




From no-reply at zwischenwelt.org  Tue Dec 18 05:58:49 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 04:58:49 -0000
Subject: [Iris-commit] [IRIS] r1642 - in /trunk: include/data.h
 include/terrain.h include/tiledterrain.h src/scripting.iris.cpp
 src/terrain_multitex.cpp
Message-ID: <20071218045850.068ED1C186F7@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Dec 18 05:58:49 2007
New Revision: 1642

Log:
worked on mutlitex-terrain code

Added:
    trunk/src/terrain_multitex.cpp
Removed:
    trunk/include/tiledterrain.h
Modified:
    trunk/include/data.h
    trunk/include/terrain.h
    trunk/src/scripting.iris.cpp

Modified: trunk/include/data.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/data.h (original)
+++ trunk/include/data.h Tue Dec 18 05:58:49 2007
@@ -297,7 +297,20 @@
 		int				miMapW;
 		int				miMapH;
 		cGroundBlockLoader						(const int iMapH);
-		virtual	cGroundBlock*	GetGroundBlock	(const int iX,const int iY) =3D 0; =
///< result of Get is only valid until next Get call
+		=

+		/// result of Get is only guaranteed to be valid until next Get call, un=
less PrepareGroupLoading below is used and succeeds
+		virtual	cGroundBlock*	GetGroundBlock	(const int iX,const int iY) =3D 0;
+		=

+		/// bx,by is the center
+		/// used for terrain
+		/// returns true on success, false if not possible
+		/// not all loader implementations might implement this
+		/// guarantees that as long as all succeeding GetGroundBlock calls are i=
nside the area, they don't invalidate each other,
+		/// e.g. you can load more than one block at once
+		/// warning, as soon as something outside the area is requested, all loa=
ded blocks could be invalidated
+		/// not implemented by default -> fails
+		/// 17.12.2007,ghoulsblade : not yet implemented anywhere due to diffloa=
der would also have to be adjusted (or disabled)
+		virtual bool PrepareGroupLoading (const int iBX,const int iBY,const int =
iRadius) { return false; }
 	};
 =

 	/// dummy loader, doesn't load anything, just repeats a predefined mapblo=
ck

Modified: trunk/include/terrain.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/terrain.h (original)
+++ trunk/include/terrain.h Tue Dec 18 05:58:49 2007
@@ -5,9 +5,16 @@
 #include <string>
 =

 class cGroundBlockLoader;
+namespace Lugre {
+	class cRobRenderOp;
+};
 	=

 void			TerrainRayIntersect			(cGroundBlockLoader* pGroundBlockLoader,const=
 int iBlockX,const int iBlockY,const Ogre::Vector3& vOrigin,const Ogre::Vec=
tor3& vDir);
 std::string		BuildTerrainEntity_Simple	(cGroundBlockLoader* pGroundBlockLo=
ader,const int iMinX,const int iMinY,const int iW,const int iH,const bool b=
GenerateNormals);
 std::string		BuildTerrainEntity_Shaded	(cGroundBlockLoader* pGroundBlockLo=
ader,const int iMinX,const int iMinY,const int iW,const int iH);
 =

+void	 		TerrainMultiTexWrite		(cGroundBlockLoader* pGroundBlockLoader,cons=
t int iBlockX,const int iBlockY,Lugre::cRobRenderOp& pRobRenderOp);
+void	 		TerrainMultiTex_SetGroundMaterialTypeLookUp	(const int* piValues,c=
onst int iCount);
+void			TerrainMultiTex_AddTexCoordSet				(int iMode,float tx,float ty,floa=
t tw,float th); ///< 0:ground,1:mainmask,2:mask
+
 #endif

Modified: trunk/src/scripting.iris.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.iris.cpp (original)
+++ trunk/src/scripting.iris.cpp Tue Dec 18 05:58:49 2007
@@ -288,6 +288,48 @@
 	return 1;
 }
 =

+/// for lua : void	Gfx3D_SetMultiTexTerrain (gfx3d,pGroundBlockLoader,bx,b=
y)
+static int l_Gfx3D_SetMultiTexTerrain (lua_State *L) { PROFILE
+	cGfx3D* pGfx3D =3D cLuaBind<cGfx3D>::checkudata_alive(L);
+	cGroundBlockLoader* pGroundBlockLoader =3D cLuaBind<cGroundBlockLoader>::=
checkudata_alive(L,2);
+	int bx =3D luaL_checkint(L,3);
+	int by =3D luaL_checkint(L,4);
+	=

+	pGfx3D->SetSimpleRenderable();
+	cRobRenderOp* pRobRenderOp =3D pGfx3D->mpSimpleRenderable;
+	TerrainMultiTexWrite(pGroundBlockLoader,bx,by,*pRobRenderOp);
+	return 0;
+}
+
+/// for lua : void	TerrainMultiTex_SetGroundMaterialTypeLookUp (table) =

+/// key=3Duo-ground-tiletype-id  value=3Dindex_for_AddTexCoordSet_mode_0
+static int l_TerrainMultiTex_SetGroundMaterialTypeLookUp (lua_State *L) { =
PROFILE
+	enum { kLookUpSize =3D 0x4000 };
+	int myLookUp[kLookUpSize];
+	for (int i=3D0;i<0x4000;++i) {
+		myLookUp[i] =3D 0;
+		if (lua_istable(L,1)) { // table is at index 1
+			lua_rawgeti(L,1,i); // table is at index 1
+			if (lua_isnil(L,-1)) myLookUp[i] =3D luaL_checkint(L,-1);
+			lua_pop(L,1); // pop 1 elements
+		}
+	}
+	TerrainMultiTex_SetGroundMaterialTypeLookUp(myLookUp,kLookUpSize);
+	return 0;
+}
+
+/// for lua : void	TerrainMultiTex_AddTexCoordSet (int iMode,float tx,floa=
t ty,float tw,float th) =

+/// 0:ground,1:mainmask,2:mask
+static int l_TerrainMultiTex_AddTexCoordSet (lua_State *L) { PROFILE
+	int iMode =3D luaL_checkint(L,1);
+	float tx =3D luaL_checknumber(L,2);
+	float ty =3D luaL_checknumber(L,3);
+	float tw =3D luaL_checknumber(L,4);
+	float th =3D luaL_checknumber(L,5);
+	TerrainMultiTex_AddTexCoordSet(iMode,tx,ty,tw,th);
+	return 0;
+}
+	=

 static int l_BuildTerrainEntity_Shaded (lua_State *L) { PROFILE
 	cGroundBlockLoader* pGroundBlockLoader =3D cLuaBind<cGroundBlockLoader>::=
checkudata(L,1);
 	if (!pGroundBlockLoader) return 0;
@@ -367,6 +409,9 @@
 			lua_register(L,"HuffmanDecompress",				l_HuffmanDecompress);
 			lua_register(L,"BuildTerrainEntity_Simple",		l_BuildTerrainEntity_Simpl=
e);
 			lua_register(L,"BuildTerrainEntity_Shaded",		l_BuildTerrainEntity_Shade=
d);
+			lua_register(L,"Gfx3D_SetMultiTexTerrain",		l_Gfx3D_SetMultiTexTerrain);
+			lua_register(L,"TerrainMultiTex_SetGroundMaterialTypeLookUp",	l_Terrain=
MultiTex_SetGroundMaterialTypeLookUp);
+			lua_register(L,"TerrainMultiTex_AddTexCoordSet",				l_TerrainMultiTex_A=
ddTexCoordSet);
 			lua_register(L,"TerrainRayPick",				l_TerrainRayPick);
 			lua_register(L,"GetUOPath",						l_getUOPath);
 			lua_register(L,"PathSearch",					l_PathSearch);



From no-reply at zwischenwelt.org  Tue Dec 18 15:00:05 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 14:00:05 -0000
Subject: [Iris-commit] [IRIS] r1643 - in /trunk/data/lua: lib.3d.dynamic.lua
	lib.3d.map.lua
Message-ID: <20071218140006.12D521C18700@zwischenwelt.org>

Author: hagish
Date: Tue Dec 18 15:00:04 2007
New Revision: 1643

Log:
improved mapchunk rebuild due to multis

Modified:
    trunk/data/lua/lib.3d.dynamic.lua
    trunk/data/lua/lib.3d.map.lua

Modified: trunk/data/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.dynamic.lua (original)
+++ trunk/data/lua/lib.3d.dynamic.lua Tue Dec 18 15:00:04 2007
@@ -55,12 +55,12 @@
 =

 				-- add part
 				table.insert(multi.lparts, {iTileTypeID,iX,iY,iZ,iHue})
+				Renderer3D:RebuildChunkAtUOPos(iX,iY)
 			end
 =

 			item.multi =3D multi
 			item.gfx =3D nil
 			Renderer3D.gMultis[multi] =3D true
-			Renderer3D:RebuildChunkAtUOPos(item.xloc, item.yloc)
 			=

 		-- otherwise ist a Clientside Multi
 		elseif gMultiLoader then
@@ -89,7 +89,7 @@
 				if iFlags =3D=3D 1 then
 					-- add part
 					table.insert(multi.lparts, {iTileTypeID,iX,iY,iZ,iHue})
-					=

+					Renderer3D:RebuildChunkAtUOPos(iX,iY)
 					--print("DEBUG",iTileTypeID,iX,iY,iZ,iHue)
 				end
 			end
@@ -99,9 +99,8 @@
 			item.multi =3D multi
 			item.gfx =3D nil
 			Renderer3D.gMultis[multi] =3D true
-			Renderer3D:RebuildChunkAtUOPos(item.xloc, item.yloc)
 		else =

-			printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed loadi=
ng mesh for dynamic (multi): artid=3D%i z_typename=3D%s\n",item.artid or -1=
,item.z_typename or ""))
+			printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed loadi=
ng mesh for dynamic (multi): artid=3D%i z_typename=3D%s\n",item.artid or -1=
,GetStaticTileTypeName(item.artid) or ""))
 		end
 	else
 		-- normal 1 part object
@@ -139,7 +138,7 @@
 				item.yadd =3D item.yadd + 0.5
 				item.zadd =3D item.zadd + 0.5
 				self:CreateArtBillBoard(item.gfx.billboard,iTranslatedTileTypeID,item.=
hue)
-				printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed load=
ing mesh for dynamic: artid=3D%i z_typename=3D%s\n",item.artid or -1,item.z=
_typename or ""))
+				printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed load=
ing mesh for dynamic: artid=3D%i z_typename=3D%s\n",item.artid or -1,GetSta=
ticTileTypeName(item.artid) or ""))
 			end
 		end
 		item.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)

Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Tue Dec 18 15:00:04 2007
@@ -63,9 +63,20 @@
 		iMidY =3D math.floor(iMidY / self.ROBMAP_CHUNK_SIZE)
 		=

 			=

-		-- release invisible chunks
 		local y,row,x,chunk,k,v
 		local bHit,fHitDist
+
+		-- rebuild chunks if needed
+		for y,row in pairs(self.gMapChunks) do
+			for x,chunk in pairs(row) do
+				if (chunk.mbRebuild) then
+					self:DestroyMapChunk(x,y,chunk)
+					self:LoadMapChunk(x,y)
+				end
+			end
+		end
+
+		-- release invisible chunks
 		for y,row in pairs(self.gMapChunks) do
 			for x,chunk in pairs(row) do
 				if (chunk.miX < minx or chunk.miY < miny or chunk.miX > maxx or chunk.=
miY > maxy) then
@@ -95,9 +106,7 @@
 	for y,row in pairs(self.gMapChunks) do
 		for x,chunk in pairs(row) do
 			if (chunk.miX =3D=3D chunkx and chunk.miY =3D=3D chunky)  then
-				--print("DEBUG","chunk",x,y,chunk.miX,chunk.miY)
-				self:DestroyMapChunk(x,y,chunk)
-				self:LoadMapChunk(x,y)
+				chunk.mbRebuild =3D true
 			end
 		end
 	end
@@ -469,6 +478,7 @@
 -- coords in chunks
 -- TODO : release anything else that was allocated in CreateMapChunk
 function Renderer3D:DestroyMapChunk (x,y,chunk)
+	chunk.mbRebuild =3D nil
 	if (not chunk.bIsDead) then
 		--print("DestroyMapChunk",x,y)
 		chunk.bIsDead =3D true



From no-reply at zwischenwelt.org  Tue Dec 18 19:55:58 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 18:55:58 -0000
Subject: [Iris-commit] [IRIS] r1644 - /trunk/src/builder.cpp
Message-ID: <20071218190008.D4E471C18713@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Dec 18 19:55:58 2007
New Revision: 1644

Log:
bugfixc

Modified:
    trunk/src/builder.cpp

Modified: trunk/src/builder.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/builder.cpp (original)
+++ trunk/src/builder.cpp Tue Dec 18 19:55:58 2007
@@ -355,6 +355,8 @@
 	delete [] pBuf32;
 	=

 	delete [] pImgRaw;
+	=

+	return true;
 }
 =

 bool	WriteTexMapToFile	(cTexMapLoader& oTexMapLoader,const char* szFilePat=
h,const int iID,cHueLoader* pHueLoader,const short iHue) { PROFILE



From no-reply at zwischenwelt.org  Tue Dec 18 20:18:36 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 19:18:36 -0000
Subject: [Iris-commit] [IRIS] r1645 - /trunk/data/lua/lib.3d.map.lua
Message-ID: <20071218191836.E33331C186F5@zwischenwelt.org>

Author: sience
Date: Tue Dec 18 20:18:36 2007
New Revision: 1645

Log:
-local <> global fix

Modified:
    trunk/data/lua/lib.3d.map.lua

Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Tue Dec 18 20:18:36 2007
@@ -157,7 +157,7 @@
 	entity.iTileTypeID =3D iTileTypeID
 	entity.iHue =3D iHue
 	=

-	meshname =3D (not gForceFallBackBillboards_Statics) and GetStaticMeshName=
(iTileTypeID,entity.iHue)
+	local meshname =3D (not gForceFallBackBillboards_Statics) and GetStaticMe=
shName(iTileTypeID,entity.iHue)
 	=

 	-- create Mesh
 	if (meshname and meshname ~=3D false) then 	--and (not MeshIsPseudoBillBo=
ard(iTileTypeID))) then	--currently disabled
@@ -286,8 +286,8 @@
 				for i =3D 0,iStaticCount-1 do
 					iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i) -- oper=
ates on the block that was last loaded using :Load()
 					=

-					xloc =3D (iBlockUO_X+x)*8 + iX
-					yloc =3D (iBlockUO_Y+y)*8 + iY
+					local xloc =3D (iBlockUO_X+x)*8 + iX
+					local yloc =3D (iBlockUO_Y+y)*8 + iY
 					=

 					--print("DEBUG","STATIC",iTileTypeID,xloc,yloc,iZ,iHue)
 					self:CreateMapChunkEntity(chunk,iTileTypeID,xloc,yloc,iZ,iHue)
@@ -331,8 +331,8 @@
 				for i =3D 0,iStaticCount-1 do
 					iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i) -- oper=
ates on the block that was last loaded using :Load()
 =

-					xloc =3D (iBlockUO_X+x)*8 + iX
-					yloc =3D (iBlockUO_Y+y)*8 + iY
+					local xloc =3D (iBlockUO_X+x)*8 + iX
+					local yloc =3D (iBlockUO_Y+y)*8 + iY
 					=

 					self:CreateMapChunkEntity(chunk,iTileTypeID,xloc,yloc,iZ,iHue)
 				end =




From no-reply at zwischenwelt.org  Tue Dec 18 20:20:11 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 19:20:11 -0000
Subject: [Iris-commit] [IRIS] r1646 - /trunk/src/terrain_multitex.cpp
Message-ID: <20071218192011.816DC1C186FB@zwischenwelt.org>

Author: sience
Date: Tue Dec 18 20:20:11 2007
New Revision: 1646

Log:
-macro fix for VS8

Modified:
    trunk/src/terrain_multitex.cpp

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Tue Dec 18 20:20:11 2007
@@ -286,10 +286,10 @@
 	S G D
 	*/
 	inline int GenerateTransitionMask (const int x,const int y,const int iMyT=
ype) {
-		#define MYSUM(dx,dy) ((GetType(x-dx,y-dy) =3D=3D iMyType) ? TransitionMa=
sk(dx,dy) : 0)
-		return	MYSUM(-1,-1) +	MYSUM( 0,-1) + 	MYSUM(+1,-1) + =

-				MYSUM(-1, 0) +  				MYSUM(+1, 0) + =

-				MYSUM(-1,+1) + 	MYSUM( 0,+1) + 	MYSUM(+1,+1);
+		#define MYSUM(dx,dy) ((GetType(x+(dx),y+(dy)) =3D=3D iMyType) ? Transiti=
onMask(dx,dy) : 0)
+		return  MYSUM(-1,-1) + MYSUM( 0,-1) +  MYSUM(+1,-1) + =

+				MYSUM(-1, 0) + MYSUM(+1, 0) + =

+				MYSUM(-1,+1) + MYSUM( 0,+1) +  MYSUM(+1,+1);
 		#undef MYSUM
 	}
 	=




From no-reply at zwischenwelt.org  Tue Dec 18 20:22:37 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 19:22:37 -0000
Subject: [Iris-commit] [IRIS] r1647 - /branches/stable_release/
Message-ID: <20071218192237.3C1351C186FB@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Dec 18 20:22:36 2007
New Revision: 1647

Log:
removing stable for trunk -> stable update

Removed:
    branches/stable_release/



From no-reply at zwischenwelt.org  Tue Dec 18 20:23:03 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 19:23:03 -0000
Subject: [Iris-commit] [IRIS] r1648 - /branches/stable_release/
Message-ID: <20071218192303.A3F251C186F5@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Dec 18 20:23:03 2007
New Revision: 1648

Log:
copying trunk to stable

Added:
    branches/stable_release/
      - copied from r1640, trunk/



From no-reply at zwischenwelt.org  Tue Dec 18 23:22:14 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 22:22:14 -0000
Subject: [Iris-commit] [IRIS] r1649 - /trunk/src/terrain_multitex.cpp
Message-ID: <20071218222214.A75E71C186FB@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Dec 18 23:22:13 2007
New Revision: 1649

Log:
multitex : adjustment for robrenderop

Modified:
    trunk/src/terrain_multitex.cpp

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Tue Dec 18 23:22:13 2007
@@ -133,9 +133,8 @@
 		bool bDynamic			=3D false;
 		bool bKeepOldIndices 	=3D false;
 		int x,y;
-		pRobRenderOp.Begin(iVertexCount,iIndexCount=3D0,bDynamic,bKeepOldIndices=
);
-		pRobRenderOp.miVertexFormat =3D cRobRenderOp::kVertexFormat_pnuv;
-		pRobRenderOp._CalcVertexFormat(4); // 4 tex coord sets
+		pRobRenderOp.Begin(iVertexCount,iIndexCount,bDynamic,bKeepOldIndices);
+		pRobRenderOp.SetVertexFormatFromEnum(cRobRenderOp::kVertexFormat_pnuv,4)=
; // 4 tex coord sets
 		Ogre::Real* pWriter =3D pRobRenderOp.StartCustomWriter(Ogre::Vector3(0,0=
,0),Ogre::Vector3(8,8,256));
 		WriteToVertexBuffer(pGroundBlockLoader,bx,by,pWriter);
 		for (y=3D0;y<8;++y)
@@ -286,10 +285,10 @@
 	S G D
 	*/
 	inline int GenerateTransitionMask (const int x,const int y,const int iMyT=
ype) {
-		#define MYSUM(dx,dy) ((GetType(x+(dx),y+(dy)) =3D=3D iMyType) ? Transiti=
onMask(dx,dy) : 0)
-		return  MYSUM(-1,-1) + MYSUM( 0,-1) +  MYSUM(+1,-1) + =

-				MYSUM(-1, 0) + MYSUM(+1, 0) + =

-				MYSUM(-1,+1) + MYSUM( 0,+1) +  MYSUM(+1,+1);
+		#define MYSUM(dx,dy) ((GetType(x+(dx),y+(dy)) =3D=3D iMyType) ? Transiti=
onMask(dx,dy) : 0)
+		return	MYSUM(-1,-1) +	MYSUM( 0,-1) + 	MYSUM(+1,-1) + =

+				MYSUM(-1, 0) +  				MYSUM(+1, 0) + =

+				MYSUM(-1,+1) + 	MYSUM( 0,+1) + 	MYSUM(+1,+1);
 		#undef MYSUM
 	}
 	=




From no-reply at zwischenwelt.org  Wed Dec 19 00:04:45 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 23:04:45 -0000
Subject: [Iris-commit] [IRIS] r1650 - in /trunk/data/lua: lib.3d.dynamic.lua
 lib.3d.map.lua lib.3d.mobile.lua lib.3d.mousepick.lua
Message-ID: <20071219000006.BDB631C186F5@zwischenwelt.org>

Author: sience
Date: Wed Dec 19 00:04:44 2007
New Revision: 1650

Log:
-some minor optimizations (only some vars changed)
-Updatevisability: mobile moved to mobile, dynamic moved to dynamic
- iMultiChildGfx temp. disabled (not need when Multis are Static) <- but sa=
me is needed for Static Multis

Modified:
    trunk/data/lua/lib.3d.dynamic.lua
    trunk/data/lua/lib.3d.map.lua
    trunk/data/lua/lib.3d.mobile.lua
    trunk/data/lua/lib.3d.mousepick.lua

Modified: trunk/data/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.dynamic.lua (original)
+++ trunk/data/lua/lib.3d.dynamic.lua Wed Dec 19 00:04:44 2007
@@ -1,10 +1,9 @@
 -- see alos lib.3d.dynamic.lua
 =

---[[
-function Renderer3D:DynamicSetVisible (dynamic,bVisible)
-	if (dynamic.gfx) then dynamic.gfx:SetVisible(bVisible) end
-end
-]]--
+-- helperfunction for CreateDynamicGfx. Please use always for function call
+function Renderer3D:AddDynamicItem( item )
+	self:CreateDynamicGfx(item)
+end
 =

 function Renderer3D:UpdateDynamicItemPos ( dynamic )
 	if (dynamic.gfx) then
@@ -12,9 +11,20 @@
 	end
 end
 =

--- helperfunction for CreateDynamicGfx. Please use always for function call
-function Renderer3D:AddDynamicItem( item )
-	self:CreateDynamicGfx(item)
+function Renderer3D:UpdateDynamicVisibility	(dynamic) =

+--	if (dynamic.lMultiChildGfx) then
+--		-- multi
+--		for k,child in pairs(dynamic.lMultiChildGfx) do
+--			if (child.zloc > self.giBlendOutPlayerHeight) then
+--				child:SetVisible(self:IsZLayerVisible(child.zloc))
+--			end
+--		end
+--	else
+	if (dynamic.gfx) then
+		-- normal item
+		dynamic.gfx:SetVisible(self:IsZLayerVisible(dynamic.zloc))
+		if (dynamic.gfx.billboard) then dynamic.gfx.billboard:SetVisible(self:Is=
ZLayerVisible(dynamic.zloc)) end
+	end
 end
 =

 -- TODO: Multis & Serversidemultis don't recognize kTileDataFlag_LightSour=
ce yet
@@ -28,30 +38,27 @@
 =

 	-- Detect Multis
 	if item.artid >=3D gMulti_ID then
-		-- Check if Serverside Multi (Custom Multi)
 		printdebug("multi","-----------------------------")
 		printdebug("multi", sprintf("ARTID",item.artid,vardump(item)) )
 =

+		-- Serverside Multi Check (Custom Multi)
 		if (item.lTile) then
 			printdebug("multi","Serverside Multi detected")
 =

+			local iTileTypeID,iX,iY,iZ
+			local iHue
 			local multi =3D {}
 			multi.lparts =3D {}
 			=

 			for k,v in pairs(item.lTile) do
 				-- create part
-				local iTileTypeID =3D v.artid
-				=

-				local iX =3D -v.x
-				local iY =3D v.y
-				local iZ =3D v.z
+				iTileTypeID =3D v.artid
+				iHue =3D 0				--<- TODO: hueing is WORNG !! Every part of an multi can=
 have its own hue!
 =

 				-- generate absolute coords
-				iX =3D item.xloc + iX + item.xadd
-				iY =3D item.yloc + iY + item.yadd
-				iZ =3D item.zloc + iZ + item.zadd
-				=

-				local iHue =3D 0
+				iX =3D item.xloc +(-v.x)+ item.xadd
+				iY =3D item.yloc + v.y + item.yadd
+				iZ =3D item.zloc + v.z + item.zadd
 =

 				-- add part
 				table.insert(multi.lparts, {iTileTypeID,iX,iY,iZ,iHue})
@@ -62,21 +69,24 @@
 			item.gfx =3D nil
 			Renderer3D.gMultis[multi] =3D true
 			=

-		-- otherwise ist a Clientside Multi
+		-- Clientside Multi Check
 		elseif gMultiLoader then
 			printdebug("multi","Clientside Multi detected")
 			=

 			local multi =3D {}
-			=

 			multi.id =3D item.artid - gMulti_ID
+
 			local parts =3D gMultiLoader:CountMultiParts(multi.id)
 			multi.lparts =3D {}
 			=

 			-- read out parts
 			printdebug("multi","Renderer3D:CreateDynamicGfx: multi id",multi.id,"pa=
rts",parts)
+
+			local iTileTypeID,iX,iY,iZ,iFlags
+			local iHue
 			for p =3D 0, parts-1 do
-				local iTileTypeID,iX,iY,iZ,iFlags =3D gMultiLoader:GetMultiParts(multi=
.id,p)
-				local iHue =3D item.hue
+				iTileTypeID,iX,iY,iZ,iFlags =3D gMultiLoader:GetMultiParts(multi.id,p)
+				iHue =3D 0				--<- TODO: hueing is WORNG !! Every part of an multi can=
 have its own hue!
 				=

 				-- generate absolute coords
 				iX =3D item.xloc + iX + item.xadd
@@ -189,10 +199,10 @@
 function Renderer3D:DestroyDynamicGfx (dynamic)
 	-- print("DEBUG","destroy",vardump(dynamic))
 	if (dynamic.gfx) then
-		if (dynamic.lMultiChildGfx) then
-			for k,child in pairs(dynamic.lMultiChildGfx) do child:Destroy() end
-			dynamic.lMultiChildGfx=3Dnil
-		end
+--		if (dynamic.lMultiChildGfx) then
+--			for k,child in pairs(dynamic.lMultiChildGfx) do child:Destroy() end
+--			dynamic.lMultiChildGfx=3Dnil
+--		end
 		dynamic.gfx:Destroy()
 		dynamic.gfx =3D nil
 	end
@@ -200,7 +210,7 @@
 	if (dynamic.lightname) then Client_RemoveLight(dynamic.lightname) dynamic=
.lightname =3D nil end
 	-- remove multi entry
 	if (dynamic.multi) then =

-		local multi =3D dynamic.multi
+--		local multi =3D dynamic.multi			--obsolete
 		Renderer3D:RebuildChunkAtUOPos(dynamic.xloc,dynamic.yloc)
 		Renderer3D.gMultis[dynamic.multi] =3D nil =

 	end

Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Wed Dec 19 00:04:44 2007
@@ -22,12 +22,12 @@
 		local camx,camy,camz =3D self:GetLookAheadCamPos()
 		local iCamOverBlockX =3D self.giMapOriginX*self.ROBMAP_CHUNK_SIZE + camx=
/8
 		local iCamOverBlockY =3D self.giMapOriginY*self.ROBMAP_CHUNK_SIZE + camy=
/8
-		=

+
 		-- recenter world if too far away, to avoid float-rounding-errors
 		local fCamOriginDist =3D math.sqrt(camx*camx + camy*camy)
 		if (false and fCamOriginDist / 8 > self.ROBMAP_RECENTER_DIST) then -- de=
activated for now, so coordinates are consistent
 			printf("RecenterMap (%d,%d)\n",iCamOverBlockX,iCamOverBlockY)
-			=

+
 			-- calc new origin
 			local ox =3D math.floor(iCamOverBlockX / self.ROBMAP_CHUNK_SIZE)
 			local oy =3D math.floor(iCamOverBlockY / self.ROBMAP_CHUNK_SIZE)
@@ -35,24 +35,23 @@
 			local dify =3D (self.giMapOriginY - oy) * 8 * self.ROBMAP_CHUNK_SIZE =

 			self.giMapOriginX =3D ox
 			self.giMapOriginY =3D oy
-			=

+
 			-- update cam,map,dynamics,mobiles,...
 			GetMainCam():Move(difx,dify,0)
 			self:ClearMapCache()
 			gCurrentRenderer:CheckForUpdateMapOrigin()
 			NotifyListener("Hook_RecenterWorld",difx,dify)
 		end
-		=

+
 		-- mapblocks are loaded and unloaded here  (also iCamOverBlockX will alw=
ays be negative  while over the map)
 		self:UpdateMapCache(-iCamOverBlockX,iCamOverBlockY, gSightRange)
-		=

+
 		self.gNextMapUpdate =3D Client_GetTicks() + self.gMapUpdateInterval -- m=
ake sure the game runs for at least 100msec AFTER this loading without bein=
g interrupted by loading
 	end
 end
 =

 -- these coordinates are in absolute map-blocks, all others are in chunks
 function Renderer3D:UpdateMapCache (iMidX,iMidY,iRad)
-		=

 		local minx =3D math.floor((iMidX-iRad) / self.ROBMAP_CHUNK_SIZE)
 		local miny =3D math.floor((iMidY-iRad) / self.ROBMAP_CHUNK_SIZE)
 		local maxx =3D math.floor((iMidX+iRad) / self.ROBMAP_CHUNK_SIZE)
@@ -62,10 +61,6 @@
 		iMidX =3D math.floor(iMidX / self.ROBMAP_CHUNK_SIZE)
 		iMidY =3D math.floor(iMidY / self.ROBMAP_CHUNK_SIZE)
 		=

-			=

-		local y,row,x,chunk,k,v
-		local bHit,fHitDist
-
 		-- rebuild chunks if needed
 		for y,row in pairs(self.gMapChunks) do
 			for x,chunk in pairs(row) do
@@ -86,14 +81,16 @@
 		end
 =

 		-- load visible chunks into cache if not already there
-		local x,y
 		local iLoadedCount =3D 0 -- make sure only a limited number of blocks is=
 created during update, otherwise the game would hang
 		for y=3Dminy,maxy do
-		for x=3Dminx,maxx do if (iLoadedCount < self.gMaxMapBlocksLoadedPerUpdat=
e) then
-			if (self:LoadMapChunk(x,y)) then
-				iLoadedCount =3D iLoadedCount + 1
-			end
-		end end end
+			for x=3Dminx,maxx do
+				if (iLoadedCount < self.gMaxMapBlocksLoadedPerUpdate) then
+					if (self:LoadMapChunk(x,y)) then
+						iLoadedCount =3D iLoadedCount + 1
+					end
+				end
+			end
+		end
 end
 =

 -- rebuild chunk at uo pos
@@ -218,10 +215,8 @@
 	-- creates a light if lights are enabled and static is a lightsource
 	-- note! lights don't cast shadows
 	if (gLightsources) then
-		local arrtiletype =3D {}
-		arrtiletype =3D GetStaticTileType(iTileTypeID)
-		if( TestBit(arrtiletype.miFlags or 0,kTileDataFlag_LightSource) ) then
-			local x,y,z =3D Renderer3D:UOPosToLocal(entity.x,entity.y,entity.z * 0.=
1)
+		local arrtiletype =3D GetStaticTileType(iTileTypeID)
+		if( arrtiletype and TestBit(arrtiletype.miFlags or 0,kTileDataFlag_Light=
Source) ) then
 			entity.lightname=3DClient_AddPointLight(entity.x-0.5,entity.y-0.5,entit=
y.z+arrtiletype.miHeight, 0.3,0.3,0.0, 0.3,0.3,0.0, 5.0,0.1,0.1,0.0)
 		end
 	end
@@ -271,13 +266,14 @@
 	=

 	-- load statics
 	if (gStaticBlockLoader) then -- probably needs gArtMapLoader
-		local x,y,i
 		local iTileTypeID,iX,iY,iZ,iHue
-		local entity,meshname
+		local iStaticCount
+		local xloc,yloc
+
 		for x =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
 			for y =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
 				gStaticBlockLoader:Load(iBlockUO_X+x,iBlockUO_Y+y)
-				local iStaticCount =3D gStaticBlockLoader:Count() -- operates on the b=
lock that was last loaded using :Load()
+				iStaticCount =3D gStaticBlockLoader:Count() -- operates on the block t=
hat was last loaded using :Load()
 =

 				--printdebug("static","iStaticCount=3D"..iStaticCount)
 				--printdebug("static","iBlockUO_X=3D"..iBlockUO_X.." iBlockUO_Y=3D"..i=
BlockUO_Y)
@@ -286,8 +282,8 @@
 				for i =3D 0,iStaticCount-1 do
 					iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i) -- oper=
ates on the block that was last loaded using :Load()
 					=

-					local xloc =3D (iBlockUO_X+x)*8 + iX
-					local yloc =3D (iBlockUO_Y+y)*8 + iY
+					xloc =3D (iBlockUO_X+x)*8 + iX
+					yloc =3D (iBlockUO_Y+y)*8 + iY
 					=

 					--print("DEBUG","STATIC",iTileTypeID,xloc,yloc,iZ,iHue)
 					self:CreateMapChunkEntity(chunk,iTileTypeID,xloc,yloc,iZ,iHue)
@@ -298,15 +294,16 @@
 	-- add multis as statics
 	if (Renderer3D.gMultis) then -- probably needs gArtMapLoader
 		local iTileTypeID,iX,iY,iZ,iHue
-		local entity,meshname
+		local UO_X,UO_Y
+		local multi
 		=

 		for k,v in pairs(Renderer3D.gMultis) do
-			local multi =3D k
+			multi =3D k
 			=

 			if multi.lparts then
 				for k,v in pairs(multi.lparts) do
-					local UO_X =3D x * self.ROBMAP_CHUNK_SIZE * 8
-					local UO_Y =3D y * self.ROBMAP_CHUNK_SIZE * 8
+					UO_X =3D x * self.ROBMAP_CHUNK_SIZE * 8
+					UO_Y =3D y * self.ROBMAP_CHUNK_SIZE * 8
 =

 					iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
 					--print("DEBUG","TILE",iTileTypeID,iX,iY,iZ,iHue,":",UO_X,UO_Y,self.R=
OBMAP_CHUNK_SIZE*8)
@@ -319,10 +316,13 @@
 			end
 		end
 		=

+		local iStaticCount
+		local xloc, yloc
+
 		for x =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
 			for y =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
 				gStaticBlockLoader:Load(iBlockUO_X+x,iBlockUO_Y+y)
-				local iStaticCount =3D gStaticBlockLoader:Count() -- operates on the b=
lock that was last loaded using :Load()
+				iStaticCount =3D gStaticBlockLoader:Count() -- operates on the block t=
hat was last loaded using :Load()
 =

 				--printdebug("static","iStaticCount=3D"..iStaticCount)
 				--printdebug("static","iBlockUO_X=3D"..iBlockUO_X.." iBlockUO_Y=3D"..i=
BlockUO_Y)
@@ -331,8 +331,8 @@
 				for i =3D 0,iStaticCount-1 do
 					iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i) -- oper=
ates on the block that was last loaded using :Load()
 =

-					local xloc =3D (iBlockUO_X+x)*8 + iX
-					local yloc =3D (iBlockUO_Y+y)*8 + iY
+					xloc =3D (iBlockUO_X+x)*8 + iX
+					yloc =3D (iBlockUO_Y+y)*8 + iY
 					=

 					self:CreateMapChunkEntity(chunk,iTileTypeID,xloc,yloc,iZ,iHue)
 				end =

@@ -357,25 +357,6 @@
 	if (entity and entity.gfx and entity.gfx.billboard) then
 		entity.gfx.billboard:SetVisible(self:IsZLayerVisible(entity.zloc))
 	end
-end
-
-function Renderer3D:UpdateDynamicVisibility	(dynamic) =

-	if (dynamic.lMultiChildGfx) then
-		-- multi
-		for k,child in pairs(dynamic.lMultiChildGfx) do
-			if (child.zloc > self.giBlendOutPlayerHeight) then
-				child:SetVisible(self:IsZLayerVisible(child.zloc))
-			end
-		end
-	elseif (dynamic.gfx) then
-		-- normal item
-		dynamic.gfx:SetVisible(self:IsZLayerVisible(dynamic.zloc))
-		if (dynamic.gfx.billboard) then dynamic.gfx.billboard:SetVisible(self:Is=
ZLayerVisible(dynamic.zloc)) end
-	end
-end
-
-function Renderer3D:UpdateMobileVisibility (mobile) =

-	self:MobileSetVisible(mobile,self:IsZLayerVisible(mobile.zloc))
 end
 =

 -- TODO: blend out mounts
@@ -407,10 +388,6 @@
 			for i =3D 0,iStaticCount-1 do
 				iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i) -- opera=
tes on the block that was last loaded using :Load()
 				if (iX =3D=3D iPX and iY =3D=3D iPY and iZ > playerheadpos) then playe=
rIsInside =3D true end
-					--local testlayer =3D iZ - 1
-					--print("static at ",iZ,testlayer)
-					--if ((not myLayer) or myLayer > testlayer) then myLayer =3D testlaye=
r end
-				--end
 			end
 		end
 =

@@ -420,12 +397,12 @@
 				if (DynamicIsInWorld(dynamic)) then
 					if (x =3D=3D dynamic.xloc and y =3D=3D dynamic.yloc and dynamic.zloc =
> playerheadpos) then
 						playerIsInside =3D true
-					elseif (dynamic.lMultiChildGfx) then
-						for k,child in pairs(dynamic.lMultiChildGfx) do
-							if (x =3D=3D dynamic.xloc+child.xloc and y =3D=3D dynamic.yloc+chil=
d.yloc and dynamic.zloc+child.zloc > playerheadpos) then
-								playerIsInside =3D true
-							end
-						end
+--					elseif (dynamic.lMultiChildGfx) then
+--						for k,child in pairs(dynamic.lMultiChildGfx) do
+--							if (x =3D=3D dynamic.xloc+child.xloc and y =3D=3D dynamic.yloc+ch=
ild.yloc and dynamic.zloc+child.zloc > playerheadpos) then
+--								playerIsInside =3D true
+--							end
+--						end
 					end
 				end
 			end

Modified: trunk/data/lua/lib.3d.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.mobile.lua (original)
+++ trunk/data/lua/lib.3d.mobile.lua Wed Dec 19 00:04:44 2007
@@ -15,6 +15,9 @@
 	--~ printdebug("equip",txt)
 end
 =

+function Renderer3D:UpdateMobileVisibility (mobile) =

+	self:MobileSetVisible(mobile,self:IsZLayerVisible(mobile.zloc))
+end
 =

 function Renderer3D:UpdateMobile( mobile )
 	if (not self.gbActive) then return end

Modified: trunk/data/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.mousepick.lua (original)
+++ trunk/data/lua/lib.3d.mousepick.lua Wed Dec 19 00:04:44 2007
@@ -172,7 +172,7 @@
 =

 	-- dynamics
 	for k,dynamic in pairs(GetDynamicList()) do
-		-- does this dynamic consists of many gfx parts (multi)?
+--[[		-- does this dynamic consists of many gfx parts (multi)?
 		if dynamic.lMultiChildGfx and DynamicIsInWorld(dynamic) then
 			-- handle multi collision
 			for k,gfx in pairs(dynamic.lMultiChildGfx) do =

@@ -187,7 +187,9 @@
 						end
 				end
 			end
-		elseif (dynamic.gfx and DynamicIsInWorld(dynamic)) then
+		else
+]]--
+		if (dynamic.gfx and DynamicIsInWorld(dynamic)) then
 			-- WARNING copy & paste code
 			if (self:IsZLayerVisible(dynamic.zloc)) then
 				if (dynamic.gfx.billboard) then



From no-reply at zwischenwelt.org  Wed Dec 19 00:16:47 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 18 Dec 2007 23:16:47 -0000
Subject: [Iris-commit] [IRIS] r1651 - in /trunk: bin/iris2.exe
 data/skippedfallbacks.lua vs8/iris.vcproj
Message-ID: <20071219000007.20DA41C18078@zwischenwelt.org>

Author: sience
Date: Wed Dec 19 00:16:46 2007
New Revision: 1651

Log:
-new binary
-skippedfallbacks added
-new VS8 project solution

Modified:
    trunk/bin/iris2.exe
    trunk/data/skippedfallbacks.lua
    trunk/vs8/iris.vcproj

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/skippedfallbacks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/skippedfallbacks.lua (original)
+++ trunk/data/skippedfallbacks.lua Wed Dec 19 00:16:46 2007
@@ -419,3 +419,4 @@
 RegisterSkippedArtBillboardFallBack(7510) -- 0x1d56 name=3Dskeleton
 RegisterSkippedArtBillboardFallBack(5952) -- 0x1740 name=3Dfountain
 RegisterSkippedArtBillboardFallBack(5954) -- 0x1742 name=3Dfountain
+RegisterSkippedArtBillboardFallBack(2267) -- 0x08db name=3Dfireplace

Modified: trunk/vs8/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.vcproj (original)
+++ trunk/vs8/iris.vcproj Wed Dec 19 00:16:46 2007
@@ -117,6 +117,7 @@
 			/>
 			<Tool
 				Name=3D"VCCLCompilerTool"
+				UseUnicodeResponseFiles=3D"false"
 				Optimization=3D"4"
 				InlineFunctionExpansion=3D"2"
 				EnableIntrinsicFunctions=3D"true"
@@ -126,6 +127,7 @@
 				WholeProgramOptimization=3D"true"
 				AdditionalIncludeDirectories=3D"&quot;$(INCLUDE)&quot;;&quot;$(OGRE_HO=
ME)\include\&quot;;&quot;$(OGRE_HOME)\include\OIS\&quot;;..\include\;..\inc=
lude\zlib;..\include\fmodx;&quot;..\lugre\lib\lua-5.0.3\include\&quot;;..\l=
ugre\lib\cadune_tree\include;..\lugre\include;&quot;c:\Programme\Microsoft =
Platform SDK\Include\&quot;"
 				PreprocessorDefinitions=3D"WIN32;USE_FMOD;MAIN_WORKING_DIR=3D\&quot;..=
/\&quot;"
+				GeneratePreprocessedFile=3D"0"
 				RuntimeLibrary=3D"0"
 				EnableEnhancedInstructionSet=3D"1"
 				FloatingPointModel=3D"0"
@@ -274,6 +276,18 @@
 			<File
 				RelativePath=3D"..\src\terrain.cpp"
 				>
+			</File>
+			<File
+				RelativePath=3D"..\src\terrain_multitex.cpp"
+				>
+				<FileConfiguration
+					Name=3D"Release|Win32"
+					>
+					<Tool
+						Name=3D"VCCLCompilerTool"
+						GeneratePreprocessedFile=3D"0"
+					/>
+				</FileConfiguration>
 			</File>
 		</Filter>
 		<Filter



From no-reply at zwischenwelt.org  Wed Dec 19 10:07:39 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 19 Dec 2007 09:07:39 -0000
Subject: [Iris-commit] [IRIS] r1652 - in /trunk/data/lua: lib.3d.dynamic.lua
 lib.3d.map.lua lib.3d.mousepick.lua lib.walking2.lua
Message-ID: <20071219090741.130841C186F5@zwischenwelt.org>

Author: hagish
Date: Wed Dec 19 10:07:39 2007
New Revision: 1652

Log:
small changes in new multi handling, mousepicking and collision should work=
 with them

Modified:
    trunk/data/lua/lib.3d.dynamic.lua
    trunk/data/lua/lib.3d.map.lua
    trunk/data/lua/lib.3d.mousepick.lua
    trunk/data/lua/lib.walking2.lua

Modified: trunk/data/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.dynamic.lua (original)
+++ trunk/data/lua/lib.3d.dynamic.lua Wed Dec 19 10:07:39 2007
@@ -1,4 +1,7 @@
 -- see alos lib.3d.dynamic.lua
+
+-- stores a list of the current client/server side multis
+gMultis =3D {}
 =

 -- helperfunction for CreateDynamicGfx. Please use always for function call
 function Renderer3D:AddDynamicItem( item )
@@ -67,7 +70,7 @@
 =

 			item.multi =3D multi
 			item.gfx =3D nil
-			Renderer3D.gMultis[multi] =3D true
+			gMultis[multi] =3D true
 			=

 		-- Clientside Multi Check
 		elseif gMultiLoader then
@@ -108,7 +111,7 @@
 			=

 			item.multi =3D multi
 			item.gfx =3D nil
-			Renderer3D.gMultis[multi] =3D true
+			gMultis[multi] =3D true
 		else =

 			printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed loadi=
ng mesh for dynamic (multi): artid=3D%i z_typename=3D%s\n",item.artid or -1=
,GetStaticTileTypeName(item.artid) or ""))
 		end
@@ -212,6 +215,6 @@
 	if (dynamic.multi) then =

 --		local multi =3D dynamic.multi			--obsolete
 		Renderer3D:RebuildChunkAtUOPos(dynamic.xloc,dynamic.yloc)
-		Renderer3D.gMultis[dynamic.multi] =3D nil =

-	end
-end
+		gMultis[dynamic.multi] =3D nil =

+	end
+end

Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Wed Dec 19 10:07:39 2007
@@ -9,7 +9,6 @@
 Renderer3D.gbBlendOutTerrainVisible =3D true
 Renderer3D.gMapUpdateInterval =3D 100 -- update the map not every frame, d=
ecrease for fly-videos
 Renderer3D.gMaxMapBlocksLoadedPerUpdate =3D 1 -- increase for fly-videos
-Renderer3D.gMultis =3D {} -- list of all multis currently available
 =

 -- the whole map cache consists of (ROBMAP_RECENTER_DIST*2)*(ROBMAP_RECENT=
ER_DIST*2)  chunks
 -- every chunk consists of ROBMAP_CHUNK_SIZE*ROBMAP_CHUNK_SIZE blocks
@@ -132,7 +131,7 @@
 end
 =

 =

--- handles the entity creation for CreateMapChunk
+-- handles the entity creation for CreateMapChunk and adds it to chunk.lSt=
aticEntities
 function Renderer3D:CreateMapChunkEntity (chunk,iTileTypeID,iXLoc,iYLoc,iZ=
Loc,iHue)
 	local entity =3D {}
 =

@@ -292,12 +291,12 @@
 	end
 	=

 	-- add multis as statics
-	if (Renderer3D.gMultis) then -- probably needs gArtMapLoader
+	if (gMultis) then -- probably needs gArtMapLoader
 		local iTileTypeID,iX,iY,iZ,iHue
 		local UO_X,UO_Y
 		local multi
 		=

-		for k,v in pairs(Renderer3D.gMultis) do
+		for k,v in pairs(gMultis) do
 			multi =3D k
 			=

 			if multi.lparts then

Modified: trunk/data/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.mousepick.lua (original)
+++ trunk/data/lua/lib.3d.mousepick.lua Wed Dec 19 10:07:39 2007
@@ -82,7 +82,7 @@
 		for chunkx,chunk in pairs(row) do
 			if (not chunk.bIsDead) then
 =

-				-- statics
+				-- statics and multis (contained int lStaticEntities list)
 				for k,entity in pairs(chunk.lStaticEntities) do =

 					if (Renderer3D:IsZLayerVisible(entity.zloc)) then -- zloc is in integ=
er tilecoords from uo
 						if (entity.gfx and entity.gfx.billboard) then
@@ -170,6 +170,7 @@
 			end
 	end end
 =

+	=

 	-- dynamics
 	for k,dynamic in pairs(GetDynamicList()) do
 --[[		-- does this dynamic consists of many gfx parts (multi)?

Modified: trunk/data/lua/lib.walking2.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.walking2.lua (original)
+++ trunk/data/lua/lib.walking2.lua Wed Dec 19 10:07:39 2007
@@ -155,17 +155,40 @@
 			GetWalkingBlockFlagsHelper(iZ,iTileTypeID,flaglist)
 		end
 	end
+
+
+	local xloc=3Dbx*8+tx
+	local yloc=3Dby*8+ty
+	=

+	-- multis
+	printwalkdebug("---Multis")
+	=

+	for k,v in pairs(gMultis) do
+		local multi =3D k
+		=

+		if multi.lparts then
+			for k,v in pairs(multi.lparts) do
+
+				local iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
+				if	iX =3D=3D xloc and iY =3D=3D yloc  then
+					GetWalkingBlockFlagsHelper(iZ,iTileTypeID,flaglist)
+				end
+			end
+		end
+	end
 	=

 	-- dynamics
 	printwalkdebug("---Dynamics")
 	=

-	local xloc=3Dbx*8+tx
-	local yloc=3Dby*8+ty
 	for k,dynamic in pairs(GetDynamicList()) do
 		if(DynamicIsInWorld(dynamic) and dynamic.artid) then
 =

 			-- is this a normal statictile or multi?
 			if (dynamic.artid >=3D gMulti_ID) then -- gMulti_ID + 100
+				--[[
+				=

+				skip this cause there is a gMultis list with all infos, we handle mult=
is using this list
+				=

 				if (dynamic.lTile) then
 					for k,v in pairs(dynamic.lTile) do
 						if ((dynamic.xloc+v.x) =3D=3D xloc and (dynamic.yloc+v.y) =3D=3D ylo=
c) then
@@ -195,6 +218,7 @@
 				else
 					printwalkdebug("no Multi found")
 				end
+				]]--
 			else
 				--elseif(dynamic.artid < gMulti_ID + 100) then
 				-- no mulit just a normal tile



From no-reply at zwischenwelt.org  Wed Dec 19 18:34:28 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 19 Dec 2007 17:34:28 -0000
Subject: [Iris-commit] [IRIS] r1653 - in /trunk/data:
 customchars/charoverride.lua lua/filter/filter.granny.lua
 lua/lib.3d.dynamic.lua lua/lib.3d.map.lua lua/lib.bodygfx.lua
 lua/lib.debugmenu.lua
Message-ID: <20071219173428.E56131C186BC@zwischenwelt.org>

Author: sience
Date: Wed Dec 19 18:34:27 2007
New Revision: 1653

Log:
-charoverride reorganisation -> now in filter.granny.lua
-some optimizations to multis and statics

Removed:
    trunk/data/customchars/charoverride.lua
Modified:
    trunk/data/lua/filter/filter.granny.lua
    trunk/data/lua/lib.3d.dynamic.lua
    trunk/data/lua/lib.3d.map.lua
    trunk/data/lua/lib.bodygfx.lua
    trunk/data/lua/lib.debugmenu.lua

Modified: trunk/data/lua/filter/filter.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/filter/filter.granny.lua (original)
+++ trunk/data/lua/filter/filter.granny.lua Wed Dec 19 18:34:27 2007
@@ -2,12 +2,24 @@
 gGrannyFilter =3D {}
 =

 -- FILTER: Grannys
-function GrannyOverride(mobileartid)
-	if (gGrannyFilter[mobileartid]) then
-		--printdebug("granny","Mapping: ArtID to GrannyID ",mobileartid," -> ",g=
GrannyFilter[mobileartid].grannyid)
-		return gGrannyFilter[mobileartid].grannyid
+function GrannyOverride(bodyid)
+	if (gGrannyFilter[bodyid]) then
+		if (gGrannyFilter[bodyid].grannyid) then
+			printdebug("granny","Override: GrannyID to new GrannyID ",bodyid," -> "=
,gGrannyFilter[bodyid].grannyid)
+			return gGrannyFilter[bodyid].grannyid
+		end
 	end
-	return mobileartid
+	return bodyid
+end
+
+function GrannyMeshOverride(bodyid)
+	if (gGrannyFilter[bodyid]) then
+		if (gGrannyFilter[bodyid].meshname) then
+			printdebug("granny","OverrideMesh: GrannyID to Mesh ",bodyid," -> ",gGr=
annyFilter[bodyid].meshname)
+			return gGrannyFilter[bodyid].meshname
+		end
+	end
+	return nil
 end
 =

 gGrannyFilter[987]	=3D{grannyid=3D400}
@@ -15,3 +27,7 @@
 gGrannyFilter[778]	=3D{grannyid=3D16}
 gGrannyFilter[292]	=3D{grannyid=3D220}
 gGrannyFilter[970]	=3D{grannyid=3D402}
+--gGrannyFilter[220]	=3D{meshname=3D"Lich.mesh"}
+--gGrannyFilter[5]	=3D{grannyid=3D220}				--birds_eagle
+--gGrannyFilter[39]	=3D{grannyid=3D220}				--mongbats_mongbat
+--gGrannyFilter[105]	=3D{grannyid=3D220}				--dragons_wyrm_ancient

Modified: trunk/data/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.dynamic.lua (original)
+++ trunk/data/lua/lib.3d.dynamic.lua Wed Dec 19 18:34:27 2007
@@ -42,7 +42,7 @@
 	-- Detect Multis
 	if item.artid >=3D gMulti_ID then
 		printdebug("multi","-----------------------------")
-		printdebug("multi", sprintf("ARTID",item.artid,vardump(item)) )
+		printdebug("create multi", sprintf("ARTID",item.artid,vardump(item)) )
 =

 		-- Serverside Multi Check (Custom Multi)
 		if (item.lTile) then
@@ -200,7 +200,17 @@
 =

 -- handle child destroy of Multis
 function Renderer3D:DestroyDynamicGfx (dynamic)
-	-- print("DEBUG","destroy",vardump(dynamic))
+	-- remove multi entry
+	if (dynamic.multi) then
+		printdebug("destroy multi", sprintf("ARTID",dynamic.artid,vardump(dynami=
c)) )
+		Renderer3D:RebuildChunkAtUOPos(dynamic.xloc,dynamic.yloc)
+		gMultis[dynamic.multi] =3D nil =

+	end
+	=

+	-- remove lightsource from dynamic
+	if (dynamic.lightname) then Client_RemoveLight(dynamic.lightname) dynamic=
.lightname =3D nil end
+
+	-- remove dynamic entry
 	if (dynamic.gfx) then
 --		if (dynamic.lMultiChildGfx) then
 --			for k,child in pairs(dynamic.lMultiChildGfx) do child:Destroy() end
@@ -209,12 +219,5 @@
 		dynamic.gfx:Destroy()
 		dynamic.gfx =3D nil
 	end
-	-- if gfx has an assigned lightsource, delete it
-	if (dynamic.lightname) then Client_RemoveLight(dynamic.lightname) dynamic=
.lightname =3D nil end
-	-- remove multi entry
-	if (dynamic.multi) then =

---		local multi =3D dynamic.multi			--obsolete
-		Renderer3D:RebuildChunkAtUOPos(dynamic.xloc,dynamic.yloc)
-		gMultis[dynamic.multi] =3D nil =

-	end
-end
+
+end

Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Wed Dec 19 18:34:27 2007
@@ -197,6 +197,7 @@
 --------------------------------------------------------------------------=
---------------------------------------------------
 ]]--
 	-- if no *.mesh is available, a fallback billboard with original uo_art i=
s generated
+	-- What about cahing here ??
 	elseif (gEnableFallBackBillboards_Statics) then
 		local iTranslatedTileTypeID =3D SeasonalStaticTranslation(iTileTypeID, g=
SeasonSetting)
 		if (not IsArtBillboardFallBackSkipped(iTileTypeID)) then
@@ -207,7 +208,7 @@
 			-- we have to add 16384 for fallbacks
 			self:CreateArtBillBoard(entity.gfx.billboard,iTranslatedTileTypeID + 16=
384,iHue)
 			table.insert(chunk.lStaticEntities,entity)
-			printdebug("missing",sprintf("Fallback: generated : iTranslatedTileType=
ID=3D%i\n", iTranslatedTileTypeID))
+			printdebug("missing",sprintf("Fallback: Billboard created : iTranslated=
TileTypeID=3D%i\n", iTranslatedTileTypeID))
 		end
 	end
 =

@@ -314,7 +315,7 @@
 				end
 			end
 		end
-		=

+--[[
 		local iStaticCount
 		local xloc, yloc
 =

@@ -336,6 +337,7 @@
 					self:CreateMapChunkEntity(chunk,iTileTypeID,xloc,yloc,iZ,iHue)
 				end =

 		end end
+]]--
 	end
 =

 	-- TODO : fish in water ? other gimiks ?
@@ -467,7 +469,6 @@
 			if (v.gfx and v.gfx.billboard) then v.gfx.billboard:Destroy() v.gfx.bil=
lboard =3D nil end
 			if (v.gfx) then v.gfx:Destroy() v.gfx =3D nil end
 		end =

-		chunk.lStaticEntities =3D {}
 		for k,v in pairs(chunk.pStaticGeometryLayers) do v:Destroy() end chunk.p=
StaticGeometryLayers =3D {}
 		if (chunk.sTerrainMeshName) then UnloadMeshName(chunk.sTerrainMeshName) =
chunk.sTerrainMeshName =3D nil end -- unload terrain mesh
 	end

Modified: trunk/data/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.bodygfx.lua (original)
+++ trunk/data/lua/lib.bodygfx.lua Wed Dec 19 18:34:27 2007
@@ -5,10 +5,6 @@
 -- see also lib.3d.walksmooth.lua
 -- interesting mobile artid : 400 401 (admin robe ? or base human ?)
 =

-
-gCharacterModelOverride =3D {}
-kCharacterModelOverrideFilePath =3D datapath.."customchars/charoverride.lu=
a"
-if (file_exists(kCharacterModelOverrideFilePath)) then dofile(kCharacterMo=
delOverrideFilePath) end
 =

 gBodyGfxPrototype =3D {}
 =

@@ -291,7 +287,7 @@
 -- creates childnodes of parentgfx and adds inserts them into the partsarr=
 table
 function CreateBodyGfxPartsFromModelIDArray (bodyid,parentgfx,partsarr,mod=
elidarr,iPrimaryHandItem,iSecondaryHandItem)
 	if (not gGrannyLoaderType) then return end
-	local override_meshname =3D gCharacterModelOverride[bodyid]
+	local override_meshname =3D GrannyMeshOverride(bodyid)
 	local skeleton_name
 	if (override_meshname) then =

 		skeleton_name =3D "character_override_skeleton" -- should not be used, o=
verride models don't support equipment yet

Modified: trunk/data/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.debugmenu.lua (original)
+++ trunk/data/lua/lib.debugmenu.lua Wed Dec 19 18:34:27 2007
@@ -29,9 +29,13 @@
 	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
 	--female
 	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
+
+	{artid=3D hex2num("5") , content=3D{}},		--birds_eagle
+	{artid=3D hex2num("39") , content=3D{}},	--mongbats_mongbat
+	{artid=3D hex2num("105") , content=3D{}},	--dragons_wyrm_ancient
+
 	-- llamas_llama_pack - broken (crash) -> mapped to id: 220 (grannyfilter)
 	{artid=3D 292 , content=3D{}},
-
 	-- k=C3=A4fer - broken animation
 	{artid=3D hex2num("0xA9") , content=3D{}},
 	--791 broken horse



From no-reply at zwischenwelt.org  Wed Dec 19 18:45:50 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 19 Dec 2007 17:45:50 -0000
Subject: [Iris-commit] [IRIS] r1654 - /trunk/COPYING
Message-ID: <20071219174551.027D91C186F5@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Dec 19 18:45:49 2007
New Revision: 1654

Log:
updated COPYING : the iris1 art is now under GPLv3 , log : sience told me t=
ensor said all models were gifts for the iris project, so can license them =
under a license we like, i (ghoulsblade) suggested GPLv3 and sience was ok =
with that

Modified:
    trunk/COPYING

Modified: trunk/COPYING
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/COPYING (original)
+++ trunk/COPYING Wed Dec 19 18:45:49 2007
@@ -3,10 +3,8 @@
 if you don't want it, you can delete the .luac file.
 (note : it will probably be opensourced soon)
 =

-there is currently no license for the models and textures in the data dir,
-they have been created by the iris1 team for use with the iris project.
-We are in the progress of replacing them with new art that will be made av=
ailable =

-under a creative commons license like by-nc-sa or something similar.
+the models and textures in data/models/ are available under GNU GPLv3
+(they are from the iris1 team)
 =

 =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D[ =
CODE LICENSE ]=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
 		    GNU GENERAL PUBLIC LICENSE



From no-reply at zwischenwelt.org  Wed Dec 19 20:07:48 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 19 Dec 2007 19:07:48 -0000
Subject: [Iris-commit] [IRIS] r1655 - in /trunk/data/lua: lib.3d.dynamic.lua
 lib.3d.map.lua lib.3d.mousepick.lua
Message-ID: <20071219190749.04D1D1C186F5@zwischenwelt.org>

Author: sience
Date: Wed Dec 19 20:07:48 2007
New Revision: 1655

Log:
-old multicheck removed

Modified:
    trunk/data/lua/lib.3d.dynamic.lua
    trunk/data/lua/lib.3d.map.lua
    trunk/data/lua/lib.3d.mousepick.lua

Modified: trunk/data/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.dynamic.lua (original)
+++ trunk/data/lua/lib.3d.dynamic.lua Wed Dec 19 20:07:48 2007
@@ -15,14 +15,6 @@
 end
 =

 function Renderer3D:UpdateDynamicVisibility	(dynamic) =

---	if (dynamic.lMultiChildGfx) then
---		-- multi
---		for k,child in pairs(dynamic.lMultiChildGfx) do
---			if (child.zloc > self.giBlendOutPlayerHeight) then
---				child:SetVisible(self:IsZLayerVisible(child.zloc))
---			end
---		end
---	else
 	if (dynamic.gfx) then
 		-- normal item
 		dynamic.gfx:SetVisible(self:IsZLayerVisible(dynamic.zloc))
@@ -154,10 +146,6 @@
 				printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed load=
ing mesh for dynamic: artid=3D%i z_typename=3D%s\n",item.artid or -1,GetSta=
ticTileTypeName(item.artid) or ""))
 			end
 		end
-		item.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)
-
-		-- FILTER: correction
-		item.gfx:SetOrientation(GetStaticMeshOrientation(item.artid))
 =

 		-- creates a light if lights are enabled and static is a lightsource
 		-- note! lights don't cast shadows
@@ -168,6 +156,11 @@
 				item.lightname=3DClient_AddPointLight(x,y,z, 0.3,0.3,0.0, 0.3,0.3,0.0,=
 5.0,0.1,0.1,0.0)
 			end
 		end
+
+		item.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)
+
+		-- FILTER: correction
+		item.gfx:SetOrientation(GetStaticMeshOrientation(item.artid))
 =

 		self:UpdateDynamicItemPos(item)
 	end
@@ -212,10 +205,6 @@
 =

 	-- remove dynamic entry
 	if (dynamic.gfx) then
---		if (dynamic.lMultiChildGfx) then
---			for k,child in pairs(dynamic.lMultiChildGfx) do child:Destroy() end
---			dynamic.lMultiChildGfx=3Dnil
---		end
 		dynamic.gfx:Destroy()
 		dynamic.gfx =3D nil
 	end

Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Wed Dec 19 20:07:48 2007
@@ -316,6 +316,7 @@
 			end
 		end
 --[[
+		-- @hagish: what it's needed for ???!?
 		local iStaticCount
 		local xloc, yloc
 =

@@ -392,18 +393,12 @@
 			end
 		end
 =

-		-- check dynamics for multis to detect house roofs and stuff like this
+		-- check dynamics to detect dynamic houseroofs and other stuff above the=
 head
 		if (not playerIsInside) then
 			for k,dynamic in pairs(GetDynamicList()) do
 				if (DynamicIsInWorld(dynamic)) then
 					if (x =3D=3D dynamic.xloc and y =3D=3D dynamic.yloc and dynamic.zloc =
> playerheadpos) then
 						playerIsInside =3D true
---					elseif (dynamic.lMultiChildGfx) then
---						for k,child in pairs(dynamic.lMultiChildGfx) do
---							if (x =3D=3D dynamic.xloc+child.xloc and y =3D=3D dynamic.yloc+ch=
ild.yloc and dynamic.zloc+child.zloc > playerheadpos) then
---								playerIsInside =3D true
---							end
---						end
 					end
 				end
 			end

Modified: trunk/data/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.mousepick.lua (original)
+++ trunk/data/lua/lib.3d.mousepick.lua Wed Dec 19 20:07:48 2007
@@ -173,23 +173,6 @@
 	=

 	-- dynamics
 	for k,dynamic in pairs(GetDynamicList()) do
---[[		-- does this dynamic consists of many gfx parts (multi)?
-		if dynamic.lMultiChildGfx and DynamicIsInWorld(dynamic) then
-			-- handle multi collision
-			for k,gfx in pairs(dynamic.lMultiChildGfx) do =

-				if (self:IsZLayerVisible(gfx.zloc)) then
-					-- WARNING copy & paste code
-						bHit,fHitDist =3D gfx:RayPick(rx,ry,rz,rvx,rvy,rvz)
-						if (bHit and ((not gMousePickFoundHit) or fHitDist < self.gMousePick=
FoundDist)) then
-							self.gMousePickFoundDist =3D fHitDist
-							gMousePickFoundHit =3D {}
-							gMousePickFoundHit.hittype =3D kMousePickHitType_Dynamic
-							gMousePickFoundHit.dynamic =3D dynamic
-						end
-				end
-			end
-		else
-]]--
 		if (dynamic.gfx and DynamicIsInWorld(dynamic)) then
 			-- WARNING copy & paste code
 			if (self:IsZLayerVisible(dynamic.zloc)) then



From no-reply at zwischenwelt.org  Thu Dec 20 01:09:44 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 20 Dec 2007 00:09:44 -0000
Subject: [Iris-commit] [IRIS] r1656 - /trunk/bin/iris2.exe
Message-ID: <20071220000944.1D28F1C186BC@zwischenwelt.org>

Author: sience
Date: Thu Dec 20 01:09:43 2007
New Revision: 1656

Log:
-new binary

Modified:
    trunk/bin/iris2.exe

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Thu Dec 20 22:14:29 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 20 Dec 2007 21:14:29 -0000
Subject: [Iris-commit] [IRIS] r1657 - in /trunk: mask_rotmir.php
	src/terrain_multitex.cpp
Message-ID: <20071220211429.98CDA1C182C4@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Dec 20 22:14:29 2007
New Revision: 1657

Log:
by rotation and mirroring, 51 masks are enough to express all 2^8=3D256 nei=
ghtborhood cases, see mask_rotmir.php

Added:
    trunk/mask_rotmir.php
Modified:
    trunk/src/terrain_multitex.cpp

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Thu Dec 20 22:14:29 2007
@@ -15,6 +15,7 @@
 using namespace Lugre;
 =

 =

+// note : by rotation and mirroring, 51 masks are enough to express all 2^=
8=3D256 neightborhood cases, see mask_rotmir.php
 =

 // uotypes : nodraw ? 0,2,431,432,433,434,435,436,437 =

 =




From no-reply at zwischenwelt.org  Fri Dec 21 01:12:11 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 21 Dec 2007 00:12:11 -0000
Subject: [Iris-commit] [IRIS] r1658 - in /trunk: data/terrain/multitex/
 data/terrain/multitex/terrain_multitex_mask_64.png
 data/terrain/multitex/terrain_multitex_mask_64_blur.png
 data/terrain/multitex/terrain_multitex_mask_64_blur_man.png mask_rotmir.php
Message-ID: <20071221001212.B45C31C182F9@zwischenwelt.org>

Author: ghoulsblade
Date: Fri Dec 21 01:12:10 2007
New Revision: 1658

Log:
terrain_multitex alpha maps, and php script to analyse the number of cases =
needed

Added:
    trunk/data/terrain/multitex/
    trunk/data/terrain/multitex/terrain_multitex_mask_64.png   (with props)
    trunk/data/terrain/multitex/terrain_multitex_mask_64_blur.png   (with p=
rops)
    trunk/data/terrain/multitex/terrain_multitex_mask_64_blur_man.png   (wi=
th props)
Modified:
    trunk/mask_rotmir.php

Modified: trunk/mask_rotmir.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/mask_rotmir.php (original)
+++ trunk/mask_rotmir.php Fri Dec 21 01:12:10 2007
@@ -1,4 +1,19 @@
+#!/usr/bin/php
 <?php
+
+function hex2imgcolor($img,$hex) {
+	switch($hex) {
+		case "red":		return ImageColorAllocate($img,255,0,0);
+		case "green":	return ImageColorAllocate($img,0,255,0);
+		case "blue":	return ImageColorAllocate($img,0,0,255);
+		case "black":	return ImageColorAllocate($img,0,0,0);
+		case "white":	return ImageColorAllocate($img,255,255,255);
+		case "yellow":	return ImageColorAllocate($img,255,255,0);
+		case "gray":	return ImageColorAllocate($img,204,204,204);
+		default:return ImageColorAllocate($img,hexdec(substr($hex,1,2)),hexdec(s=
ubstr($hex,3,2)),hexdec(substr($hex,5,2)));
+	}
+}
+
 =

 function MaskTest ($a,$posnum)				{ return ($a & (1 << $posnum)) !=3D 0; }
 function MaskFlag ($posnum)					{ return (1 << $posnum); }
@@ -7,12 +22,25 @@
 	return	(MaskTest($a,$posnum1) ? MaskFlag($posnum2) : 0) +
 			(MaskTest($a,$posnum2) ? MaskFlag($posnum1) : 0);
 }
+function MaskPosX ($posnum) {
+	if ($posnum =3D=3D 0 || $posnum =3D=3D 7 || $posnum =3D=3D 6) return -1;
+	if ($posnum =3D=3D 2 || $posnum =3D=3D 3 || $posnum =3D=3D 4) return 1;
+	return 0;
+}
+function MaskPosY ($posnum) {
+	if ($posnum =3D=3D 0 || $posnum =3D=3D 1 || $posnum =3D=3D 2) return -1;
+	if ($posnum =3D=3D 6 || $posnum =3D=3D 5 || $posnum =3D=3D 4) return 1;
+	return 0;
+}
+function MaskTestPos ($a,$dx,$dy) {
+	for ($i=3D0;$i<8;++$i) if (MaskPosX($i) =3D=3D $dx && MaskPosY($i) =3D=3D=
 $dy) return MaskTest($a,$i);
+	return false;
+}
 =

 /*
 0 1 2 =

 7   3
 6 5 4
-
 */
 =

 function MirrorX ($a) {
@@ -52,7 +80,23 @@
 }
 =

 $all_masks =3D array();
-for ($i=3D0x00;$i<=3D0xff;++$i) $all_masks[$i] =3D true;
+for ($i=3D0x00;$i<=3D0xff;++$i) $all_masks[$i] =3D false;
+for ($i=3D0x00;$i<=3D0xff;++$i) {
+	$a =3D $i;
+	if (MaskTest($a,1)) $a |=3D MaskFlag(0) + MaskFlag(2);
+	if (MaskTest($a,5)) $a |=3D MaskFlag(6) + MaskFlag(4);
+	if (MaskTest($a,3)) $a |=3D MaskFlag(2) + MaskFlag(4);
+	if (MaskTest($a,7)) $a |=3D MaskFlag(0) + MaskFlag(6);
+	/*
+	0 1 1 2 =

+	7     3
+	7     3
+	6 5 5 4   =

+	*/
+	$all_masks[$a] =3D true;
+}
+
+
 =

 $res =3D false;
 =

@@ -76,6 +120,7 @@
 	Mark("L3",$d);
 	Mark("MX",MirrorX($a));
 	Mark("MY",MirrorY($a));
+	//~ Mark("MXY",MirrorX(MirrorY($a)));
 	Mark("L1MX",MirrorX($b));
 	Mark("L1MY",MirrorY($b));
 	//~ Mark(MirrorX($c));
@@ -85,6 +130,8 @@
 	$bases[$a] =3D $res;
 }
 =

+/// 1f =3D e1
+
 echo count($bases)."\n";
 foreach ($bases as $base =3D> $arr) {
 	$s =3D sprintf("0x%02x",$base)." -> {";
@@ -93,6 +140,105 @@
 	echo $s;
 }
 =

+exit(0);
+
+/*
+14
+0x00 -> {}
+0x01 -> {0x40:L1,0x10:L2,0x04:L3,}
+0x05 -> {0x41:L1,0x50:L2,0x14:L3,}
+0x07 -> {0xc1:L1,0x70:L2,0x1c:L3,}
+0x11 -> {0x44:L1,}
+0x15 -> {0x45:L1,0x51:L2,0x54:L3,}
+0x17 -> {0xc5:L1,0x71:L2,0x5c:L3,0x47:MX,0x74:MY,0x1d:L1MX,0xd1:L1MY,}
+0x1f -> {0xc7:L1,0xf1:L2,0x7c:L3,}
+0x55 -> {}
+0x57 -> {0xd5:L1,0x75:L2,0x5d:L3,}
+0x5f -> {0xd7:L1,0xf5:L2,0x7d:L3,}
+0x77 -> {0xdd:L1,}
+0x7f -> {0xdf:L1,0xf7:L2,0xfd:L3,}
+0xff -> {}
+
+*/
+
+$basedir =3D "mymask/";
+
+/*
+0 1 1 2 =

+7     3
+7     3
+6 5 5 4
+*/
+
+function MyDrawRect ($img,$col,$x,$y,$dx,$dy) {
+	imagefilledrectangle($img,$x,$y,$x+$dx,$y+$dy,$col);
+}
+
+$images =3D array();
+
+$d =3D 32;
+$e =3D $d/4;
+$blurcount =3D 1;
+
+foreach ($bases as $base =3D> $arr) {
+
+	$img =3D imagecreatetruecolor($d, $d) or die("Cannot Initialize new GD im=
age stream");
+	$col_back =3D hex2imgcolor($img,"#000000");
+	$col_mask =3D hex2imgcolor($img,"#FFFFFF");
+	imagefilledrectangle($img,0,0,$d,$d,$col_back);
+	=

+	if (MaskTest($base,0)) MyDrawRect($img,$col_mask,$e*0,$e*0,$e*1,$e*1);
+	if (MaskTest($base,2)) MyDrawRect($img,$col_mask,$e*3,$e*0,$e*1,$e*1);
+	if (MaskTest($base,6)) MyDrawRect($img,$col_mask,$e*0,$e*3,$e*1,$e*1);
+	if (MaskTest($base,4)) MyDrawRect($img,$col_mask,$e*3,$e*3,$e*1,$e*1);
+	=

+	if (MaskTest($base,1)) MyDrawRect($img,$col_mask,$e*0,$e*0,$e*4,$e*1);
+	if (MaskTest($base,5)) MyDrawRect($img,$col_mask,$e*0,$e*3,$e*4,$e*1);
+	=

+	if (MaskTest($base,7)) MyDrawRect($img,$col_mask,$e*0,$e*0,$e*1,$e*4);
+	if (MaskTest($base,3)) MyDrawRect($img,$col_mask,$e*3,$e*0,$e*1,$e*4);
+	=

+	$out_filename =3D $basedir.sprintf("test1_%02x.png",$base);
+	//~ for ($i=3D0;$i<$blurcount;++$i) imagefilter($img,IMG_FILTER_GAUSSIAN_=
BLUR);
+	$images[] =3D $img;
+	//~ imagepng($img,$out_filename);
+}
+
+if (1) { // completely filled
+	$img =3D imagecreatetruecolor($d, $d) or die("Cannot Initialize new GD im=
age stream");
+	$col_back =3D hex2imgcolor($img,"#000000");
+	$col_mask =3D hex2imgcolor($img,"#FFFFFF");
+	imagefilledrectangle($img,0,0,$d,$d,$col_mask);
+	$images[] =3D $img;
+}
+
+//~ if (1) { // filled center
+	//~ $img =3D imagecreatetruecolor($d, $d) or die("Cannot Initialize new G=
D image stream");
+	//~ $col_back =3D hex2imgcolor($img,"#000000");
+	//~ $col_mask =3D hex2imgcolor($img,"#FFFFFF");
+	//~ imagefilledrectangle($img,0,0,$d,$d,$col_back);
+	//~ MyDrawRect($img,$col_mask,$e*1,$e*1,$e*2,$e*2);
+	//~ $images[] =3D $img;
+//~ }
+
+if (1) { // big master image
+
+	$img =3D imagecreatetruecolor($d*4, $d*4) or die("Cannot Initialize new G=
D image stream");
+	$col_back =3D hex2imgcolor($img,"#000000");
+	$col_mask =3D hex2imgcolor($img,"#FFFFFF");
+	imagefilledrectangle($img,0,0,$d*4,$d*4,$col_mask);
+	=

+	$i=3D0; foreach ($images as $img2) {
+		$x =3D $i % 4;
+		$y =3D floor($i / 4);
+		imagecopy($img,$img2,$x*$d,$y*$d,0,0,$d,$d);
+		++$i;
+	}
+
+	$out_filename =3D sprintf("terrain_multitex_mask_%d.png",$d);
+	imagepng($img,$out_filename);
+	echo "wrote $out_filename\n";
+}
 =

 =

 ?>



From no-reply at zwischenwelt.org  Sat Dec 22 20:38:31 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 22 Dec 2007 19:38:31 -0000
Subject: [Iris-commit] [IRIS] r1659 - in /trunk/data/terrain/multitex:
 terrain_tex_atlas_1024.png terrain_tex_atlas_2048.png
Message-ID: <20071222193831.E0F981C182BB@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Dec 22 20:38:31 2007
New Revision: 1659

Log:
added terrain textureatlas

Added:
    trunk/data/terrain/multitex/terrain_tex_atlas_1024.png   (with props)
    trunk/data/terrain/multitex/terrain_tex_atlas_2048.png   (with props)



From no-reply at zwischenwelt.org  Sat Dec 22 22:05:35 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 22 Dec 2007 21:05:35 -0000
Subject: [Iris-commit] [IRIS] r1660 - in /trunk:
 data/terrain/materials/terrain.material mapinfo.php mask_rotmir.php
 src/terrain_multitex.cpp
Message-ID: <20071222210537.0D8EC1C182BD@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Dec 22 22:05:33 2007
New Revision: 1660

Log:
added multitex terrain mat, multitex code : unhardcoded 8 tiles per block, =
now as template param

Modified:
    trunk/data/terrain/materials/terrain.material
    trunk/mapinfo.php
    trunk/mask_rotmir.php
    trunk/src/terrain_multitex.cpp

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Sat Dec 22 22:05:33 2007
@@ -158,6 +158,44 @@
 }
 =

 //###########################################
+// MULTITEXTURE TERRAIN MAT
+//###########################################
+
+material terrain_multitex_mat
+{
+	technique
+	{
+		pass
+		{
+			texture_unit base
+			{
+				tex_coord_set 0
+				texture terrain_tex_atlas_1024.png
+				// colour_op_ex blend_diffuse_alpha  src_current src_texture
+				// alpha_op_ex ....
+			}
+			/*
+			texture_unit base
+			{
+				tex_coord_set 1
+				texture terrain_multitex_mask_64_blur_man.png
+			}
+			texture_unit base
+			{
+				tex_coord_set 2
+				texture terrain_tex_atlas_1024.png
+			}
+			texture_unit base
+			{
+				tex_coord_set 3
+				texture terrain_multitex_mask_64_blur_man.png
+			}
+			*/
+		}
+	}
+}
+
+//###########################################
 // BASE TILES
 //###########################################
 //dirt road tiles

Modified: trunk/mapinfo.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/mapinfo.php (original)
+++ trunk/mapinfo.php Sat Dec 22 22:05:33 2007
@@ -21,18 +21,24 @@
 function GetArtMapPath ($artmapid) { return sprintf("myartmaps/artmap%08d.=
png",$artmapid); }
 =

 if (isset($_REQUEST["typename"])) {
+	$ids =3D array();
 	foreach ($gTileType as $tiletypeid =3D> $arr) {
 		list($flag,$texmapid,$name) =3D $arr;
 		if ($name !=3D $_REQUEST["typename"]) continue;
 		$texmap_path =3D GetTexMapPath($texmapid);
 		$artmap_path =3D GetArtMapPath($tiletypeid);
-		?>
-		<nowrap>
-		<?php if (file_exists($texmap_path)) {?><img border=3D0 src=3D"<?=3D$tex=
map_path?>" alt=3D"<?=3D$texmapid?>" title=3D"<?=3D$texmapid?>" width=3D64 =
height=3D64><?php }?>
-		<?php if (file_exists($artmap_path)) {?><img border=3D0 src=3D"<?=3D$art=
map_path?>" alt=3D"<?=3D$tiletypeid?>" title=3D"<?=3D$tiletypeid?>"><?php }=
?>
-		</nowrap>
-		<?php
+		$ids[] =3D $tiletypeid;
+		if (1) {
+			?>
+			<nowrap>
+			<?php if (file_exists($texmap_path)) {?><img border=3D0 src=3D"<?=3D$te=
xmap_path?>" alt=3D"<?=3D$texmapid?>" title=3D"<?=3D$texmapid?>" width=3D64=
 height=3D64><?php }?>
+			<?php if (file_exists($artmap_path)) {?><img border=3D0 src=3D"<?=3D$ar=
tmap_path?>" alt=3D"<?=3D$tiletypeid?>" title=3D"<?=3D$tiletypeid?>"><?php =
}?>
+			</nowrap>
+			<?php
+		}
 	}
+	echo "<hr>";
+	echo "terrain.".$_REQUEST["typename"]." =3D {".implode(",",$ids)."}";
 	exit(0);
 }
 =


Modified: trunk/mask_rotmir.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/mask_rotmir.php (original)
+++ trunk/mask_rotmir.php Sat Dec 22 22:05:33 2007
@@ -1,5 +1,6 @@
 #!/usr/bin/php
 <?php
+// see also src/terrain_multitex.cpp
 =

 function hex2imgcolor($img,$hex) {
 	switch($hex) {

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Sat Dec 22 22:05:33 2007
@@ -4,7 +4,6 @@
 #include "lugre_ogrewrapper.h"
 #include "lugre_robrenderable.h"
 #include "lugre_meshshape.h" // for TerrainRayIntersect
-#include "lugre_scripting.h"
 #include "lugre_fifo.h"
 #include "data.h"
 #include <Ogre.h>
@@ -19,20 +18,20 @@
 =

 // uotypes : nodraw ? 0,2,431,432,433,434,435,436,437 =

 =

-class cTiledMultiTexTerrain { public:
+template<int T> class cTiledMultiTexTerrain { public:
 	RawGroundBlock* mpBlocks[3*3];
 	=

 	enum { kMaxZDiff =3D 64 }; ///< mNormalLookup
 	enum { kGroundMatLookUpSize =3D 0x4000 };
 	enum { kShortType_nodraw =3D -1 };
 	=

-	static std::vector<float> mTexCoords_Ground;
-	static std::vector<float> mTexCoords_MainMask;
-	static std::vector<float> mTexCoords_Mask;
-	static int		mGroundMaterialTypeLookUp[kGroundMatLookUpSize]; ///< key=3Du=
o-groundtype, value=3D in [0,16] or so (depends on tex-atlas)
-	static float	mNormalLookup[kMaxZDiff*2+1][kMaxZDiff*2+1][3]; ///< y,x : 1=
92kb with 64 maxdiff
-	static float*	mNormals[9*9]; ///< internal cache
-	static int		mZ[11*11]; ///< internal cache
+	std::vector<float> mTexCoords_Ground;
+	std::vector<float> mTexCoords_MainMask;
+	std::vector<float> mTexCoords_Mask;
+	int		mGroundMaterialTypeLookUp[kGroundMatLookUpSize]; ///< key=3Duo-groun=
dtype, value=3D in [0,16] or so (depends on tex-atlas)
+	float	mNormalLookup[kMaxZDiff*2+1][kMaxZDiff*2+1][3]; ///< y,x : 192kb wi=
th 64 maxdiff
+	float*	mNormals[(T+1)*(T+1)]; ///< internal cache
+	int		mZ[(T+3)*(T+3)]; ///< internal cache
 =

 	/// x,y must be in [-7,8+7]
 	/// returns GroundMaterialType from mGroundMaterialTypeLookUp
@@ -46,19 +45,20 @@
 	/// x,y must be in [-1,9]
 	/// returns original uo z integer (16bit)
 	/// only use this after initializing the cache !
-	static inline int		GetZ	(const int x,const int y) { return mZ[(y+1)*11+(x=
+1)]; }
+	inline int		GetZ	(const int x,const int y) { return mZ[(y+1)*(T+3)+(x+1)]=
; }
+	inline float	GetZF	(const int x,const int y) { return float(GetZ(x,y))*0.=
1; }
 	=

 	/// calc/limit diff... see also cached GetNormal below
 	/// dz_x is the z-difference between x-1,y and x+1,y
 	/// dz_y is the z-difference between x,y-1 and x,y+1
-	static inline float*	LookUpNormal	(const int dz_x,const int dz_y) { =

+	inline float*	LookUpNormal	(const int dz_x,const int dz_y) { =

 		return mNormalLookup[mymax(0,mymin(2*kMaxZDiff,kMaxZDiff+dz_y))]
 							[mymax(0,mymin(2*kMaxZDiff,kMaxZDiff+dz_x))]; =

 	}
 	=

 	/// x,y must be in [0,8]
 	/// only use this after initializing the cache (mNormals) !
-	static inline float*	GetNormal	(const int x,const int y) { return mNormal=
s[y*9+x]; }
+	inline float*	GetNormal	(const int x,const int y) { return mNormals[y*(T+=
1)+x]; }
 	=

 	/// x,y must be in [-7,8+7]
 	inline RawGroundTile& GetTile (const int x,const int y) { =

@@ -79,7 +79,7 @@
 =

 	/// returns true if the terraintype should not be drawn (=3DNoDraw types =
in uo)
 	// todo : unhardcode me, e.g. pass in array from lua
-	static bool IsTerrainTypeNodraw (const int iGroundMaterialType) { =

+	bool IsTerrainTypeNodraw (const int iGroundMaterialType) { =

 		// todo : shorttype here....
 		return	iGroundMaterialType =3D=3D kShortType_nodraw;
 	}
@@ -93,7 +93,7 @@
 		// write position
 		*++w =3D x + dx;
 		*++w =3D y + dy;
-		*++w =3D (float)GetZ(x+idx,y+idy) * 0.1;
+		*++w =3D GetZF(x+idx,y+idy);
 			=

 		// write normal
 		float* temp;
@@ -129,24 +129,20 @@
 	=

 	=

 	void	WriteToRobRenderOp (cGroundBlockLoader* pGroundBlockLoader,int bx,in=
t by,cRobRenderOp& pRobRenderOp) {
-		int iVertexCount		=3D 8*8*4;
-		int iIndexCount			=3D 8*8*6;
+		int iVertexCount		=3D T*T*4;
+		int iIndexCount			=3D T*T*6;
 		bool bDynamic			=3D false;
 		bool bKeepOldIndices 	=3D false;
-		int x,y;
+		int x,y,i;
 		pRobRenderOp.Begin(iVertexCount,iIndexCount,bDynamic,bKeepOldIndices);
 		pRobRenderOp.SetVertexFormatFromEnum(cRobRenderOp::kVertexFormat_pnuv,4)=
; // 4 tex coord sets
-		Ogre::Real* pWriter =3D pRobRenderOp.StartCustomWriter(Ogre::Vector3(0,0=
,0),Ogre::Vector3(8,8,256));
+		Ogre::Real* pWriter =3D pRobRenderOp.StartCustomWriter(Ogre::Vector3(0,0=
,0),Ogre::Vector3(T,T,256));
 		WriteToVertexBuffer(pGroundBlockLoader,bx,by,pWriter);
-		for (y=3D0;y<8;++y)
-		for (x=3D0;x<8;++x) { =

-			pRobRenderOp.Index((y*8+x)*4 + 0);
-			pRobRenderOp.Index((y*8+x)*4 + 1);
-			pRobRenderOp.Index((y*8+x)*4 + 2);
-			=

-			pRobRenderOp.Index((y*8+x)*4 + 2);
-			pRobRenderOp.Index((y*8+x)*4 + 1);
-			pRobRenderOp.Index((y*8+x)*4 + 3);
+		for (y=3D0;y<T;++y)
+		for (x=3D0;x<T;++x) { =

+			i =3D (y*T+x)*4;
+			pRobRenderOp.Index(i + 0,i + 1,i + 2);
+			pRobRenderOp.Index(i + 2,i + 1,i + 3);
 		}
 		pRobRenderOp.End();
 	}
@@ -167,8 +163,8 @@
 		if (myVoidBlockInit) { =

 			myVoidBlockInit =3D false; // only once
 			cGroundBlock* pGroundBlock =3D pGroundBlockLoader->GetGroundBlock(0,0);
-			for (y=3D0;y<8;++y)
-			for (x=3D0;x<8;++x) { =

+			for (y=3D0;y<T;++y)
+			for (x=3D0;x<T;++x) { =

 				myVoidBlock.mTiles[y][x].miTileType	=3D pGroundBlock ? pGroundBlock->m=
pRawGroundBlock->mTiles[0][0].miTileType : 0;
 				myVoidBlock.mTiles[y][x].miZ		=3D pGroundBlock ? pGroundBlock->mpRawGr=
oundBlock->mTiles[0][0].miZ : 0;
 			}
@@ -211,19 +207,19 @@
 		=

 		=

 		// load z buffers to cache, each is used 4 times during vertex writing, =
and 4 times during normal calc
-		for (y=3D-1;y<=3D9;++y) =

-		for (x=3D-1;x<=3D9;++x) mZ[(y+1)*11+(x+1)] =3D GetZRaw(x,y); // init cac=
he for use by GetZ
+		for (y=3D-1;y<=3DT+1;++y) =

+		for (x=3D-1;x<=3DT+1;++x) mZ[(y+1)*(T+3)+(x+1)] =3D GetZRaw(x,y); // ini=
t cache for use by GetZ
 		=

 		// load normals to cache, each is used 4 times during vertex writing
 		// init cache for use by GetNormal
-		for (y=3D0;y<=3D8;++y)
-		for (x=3D0;x<=3D8;++x)	mNormals[y*9+x] =3D LookUpNormal(	GetZ(x+1,y  ) -=
 GetZ(x-1,y  ),
-															GetZ(x  ,y+1) - GetZ(x  ,y-1) );
+		for (y=3D0;y<=3DT;++y)
+		for (x=3D0;x<=3DT;++x)	mNormals[y*(T+1)+x] =3D LookUpNormal(	GetZ(x+1,y =
 ) - GetZ(x-1,y  ),
+																GetZ(x  ,y+1) - GetZ(x  ,y-1) );
 		=

 		// write vertices
 		Ogre::Real* w =3D pWriter-1; // -1 because *++w is used inside instead o=
f *w++ , which saves an internal "-1" calc every time
-		for (y=3D0;y<8;++y)
-		for (x=3D0;x<8;++x) {
+		for (y=3D0;y<T;++y)
+		for (x=3D0;x<T;++x) {
 			iMainType	=3D GetType(x,y);
 			iMainMask	=3D IsTerrainTypeNodraw(iMainType) ? 1 : 0; // 0=3Dfully visi=
ble, 1=3Dfully transparent (nodraw tiles)
 			iTypeA		=3D GetMostFrequentNeighboorType(x,y,iMainType);
@@ -286,57 +282,52 @@
 	S G D
 	*/
 	inline int GenerateTransitionMask (const int x,const int y,const int iMyT=
ype) {
-		#define MYSUM(dx,dy) ((GetType(x+(dx),y+(dy)) =3D=3D iMyType) ? Transiti=
onMask(dx,dy) : 0)
-		return	MYSUM(-1,-1) +	MYSUM( 0,-1) + 	MYSUM(+1,-1) + =

-				MYSUM(-1, 0) +  				MYSUM(+1, 0) + =

-				MYSUM(-1,+1) + 	MYSUM( 0,+1) + 	MYSUM(+1,+1);
+		#define MYSUM(bitnum,dx,dy) ((GetType(x+(dx),y+(dy)) =3D=3D iMyType) ? (=
1<<bitnum) : 0)
+		return	MYSUM(0,-1,-1) +	MYSUM(1, 0,-1) + 	MYSUM(2,+1,-1) + =

+				MYSUM(7,-1, 0) +  						MYSUM(3,+1, 0) + =

+				MYSUM(6,-1,+1) + 	MYSUM(5, 0,+1) + 	MYSUM(4,+1,+1);
 		#undef MYSUM
 	}
 	=

-	/// generates a mask with one bit set, dx,dy in [-1;1]
-	inline static int TransitionMask (const int dx,const int dy) {
-		switch (0x11+dx+0x10*dy) { // encode dx in low halfbyte, and dy in high =
halfbytes, add 1 to both to avoid negative
-			case 0x00: return 0x01;
-			case 0x01: return 0x02;
-			case 0x02: return 0x04;
-			case 0x10: return 0x08;
-			case 0x12: return 0x10;
-			case 0x20: return 0x20;
-			case 0x21: return 0x40;
-			case 0x22: return 0x80;
-		}
+	/*
+	bits representing neighboors area numbered like this :
+	0 1 2 =

+	7   3
+	6 5 4
+	*/
+		=

+	static inline int MaskPosX (const int iPosNum) {
+		if (iPosNum =3D=3D 0 || iPosNum =3D=3D 7 || iPosNum =3D=3D 6) return -1;
+		if (iPosNum =3D=3D 2 || iPosNum =3D=3D 3 || iPosNum =3D=3D 4) return 1;
 		return 0;
 	}
 	=

-	/// tests if a bit in the mask is set
-	inline static bool TestTransitionMask (const int iMask,const int dx,const=
 int dy) { return (iMask & TransitionMask(dx,dy)) !=3D 0; }
+	static inline int MaskPosY (const int iPosNum) {
+		if (iPosNum =3D=3D 0 || iPosNum =3D=3D 1 || iPosNum =3D=3D 2) return -1;
+		if (iPosNum =3D=3D 6 || iPosNum =3D=3D 5 || iPosNum =3D=3D 4) return 1;
+		return 0;
+	}
+	=

 };
 =

 =

-std::vector<float> cTiledMultiTexTerrain::mTexCoords_Ground;
-std::vector<float> cTiledMultiTexTerrain::mTexCoords_MainMask;
-std::vector<float> cTiledMultiTexTerrain::mTexCoords_Mask;
-int		cTiledMultiTexTerrain::mGroundMaterialTypeLookUp[cTiledMultiTexTerrai=
n::kGroundMatLookUpSize]; ///< key=3Duo-groundtype, value=3D in [0,16] or s=
o (depends on tex-atlas)
-float	cTiledMultiTexTerrain::mNormalLookup[kMaxZDiff*2+1][kMaxZDiff*2+1][3=
]; ///< y,x : 192kb with 64 maxdiff
-float*	cTiledMultiTexTerrain::mNormals[9*9];
-int		cTiledMultiTexTerrain::mZ[11*11];
-cTiledMultiTexTerrain	gTiledMultiTexTerrain;
+cTiledMultiTexTerrain<8>	gTiledMultiTexTerrain;
 =

 void	 TerrainMultiTexWrite	(cGroundBlockLoader* pGroundBlockLoader,const i=
nt iBlockX,const int iBlockY,cRobRenderOp& pRobRenderOp) {
 	gTiledMultiTexTerrain.WriteToRobRenderOp(pGroundBlockLoader,iBlockX,iBloc=
kY,pRobRenderOp);
 }
 =

 void	 TerrainMultiTex_SetGroundMaterialTypeLookUp	(const int* piValues,con=
st int iCount) {
-	for (int i=3D0;i<cTiledMultiTexTerrain::kGroundMatLookUpSize;++i)
-		cTiledMultiTexTerrain::mGroundMaterialTypeLookUp[i] =3D (i<iCount) ? piV=
alues[i] : 0;
+	for (int i=3D0;i<cTiledMultiTexTerrain<8>::kGroundMatLookUpSize;++i)
+		gTiledMultiTexTerrain.mGroundMaterialTypeLookUp[i] =3D (i<iCount) ? piVa=
lues[i] : 0;
 }
 =

 void	 TerrainMultiTex_AddTexCoordSet		(int iMode,float tx,float ty,float t=
w,float th) {
 	std::vector<float>* pTarget =3D 0;
 	switch (iMode) { =

-		case 0: pTarget =3D &cTiledMultiTexTerrain::mTexCoords_Ground;	break;
-		case 1: pTarget =3D &cTiledMultiTexTerrain::mTexCoords_MainMask;	break;
-		case 2: pTarget =3D &cTiledMultiTexTerrain::mTexCoords_Mask;		break;
+		case 0: pTarget =3D &gTiledMultiTexTerrain.mTexCoords_Ground;	break;
+		case 1: pTarget =3D &gTiledMultiTexTerrain.mTexCoords_MainMask;	break;
+		case 2: pTarget =3D &gTiledMultiTexTerrain.mTexCoords_Mask;		break;
 	}
 	if (!pTarget) return;
 	pTarget->push_back(tx);



From no-reply at zwischenwelt.org  Sun Dec 23 00:29:49 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 22 Dec 2007 23:29:49 -0000
Subject: [Iris-commit] [IRIS] r1661 - in /trunk/data: config.lua.dist
 lua/lib.3d.map.lua lua/lib.3d.mousepick.lua lua/lib.mainmenu.lua
 lua/lib.terrain.multitex.lua lua/main.lua lua/net.walk.lua
Message-ID: <20071222232950.21B361C18058@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec 23 00:29:48 2007
New Revision: 1661

Log:
started draft for lua part of multitex terrain

Added:
    trunk/data/lua/lib.terrain.multitex.lua
Modified:
    trunk/data/config.lua.dist
    trunk/data/lua/lib.3d.map.lua
    trunk/data/lua/lib.3d.mousepick.lua
    trunk/data/lua/lib.mainmenu.lua
    trunk/data/lua/main.lua
    trunk/data/lua/net.walk.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Dec 23 00:29:48 2007
@@ -406,3 +406,5 @@
 	staidxfilename	=3D "staidx4.mul",
 	staticfilename	=3D "statics4.mul"
 }
+
+gEnableMultiTexTerrain =3D false

Modified: trunk/data/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.map.lua (original)
+++ trunk/data/lua/lib.3d.map.lua Sun Dec 23 00:29:48 2007
@@ -238,7 +238,7 @@
 	local iBlockUO_Y =3D y * self.ROBMAP_CHUNK_SIZE
 	=

 	-- load ground
-	if (gGroundBlockLoader) then -- probably needs gTexMapLoader
+	if (gGroundBlockLoader and (not gEnableMultiTexTerrain)) then -- probably=
 needs gTexMapLoader
 --		local meshname =3D BuildTerrainEntity_Simple(gGroundBlockLoader,iBlock=
UO_X,iBlockUO_Y,self.ROBMAP_CHUNK_SIZE,self.ROBMAP_CHUNK_SIZE,false)
 		local meshname =3D BuildTerrainEntity_Shaded(gGroundBlockLoader,iBlockUO=
_X,iBlockUO_Y,self.ROBMAP_CHUNK_SIZE,self.ROBMAP_CHUNK_SIZE)
 		if (meshname) then

Modified: trunk/data/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.mousepick.lua (original)
+++ trunk/data/lua/lib.3d.mousepick.lua Sun Dec 23 00:29:48 2007
@@ -114,7 +114,11 @@
 						local x,y =3D self:UOPosToLocal(iBlockUO_X*8,iBlockUO_Y*8)
 						bHit,fHitDist =3D chunk.pTerrainEntity:RayPick(rx,ry,rz,rvx,rvy,rvz,=
x,y,0)
 					else
-						bHit,fHitDist =3D chunk.terraingfx:RayPick(rx,ry,rz,rvx,rvy,rvz)
+						if (chunk.terraingfx) then
+							bHit,fHitDist =3D chunk.terraingfx:RayPick(rx,ry,rz,rvx,rvy,rvz)
+						else
+							bHit =3D false
+						end
 					end
 					=

 					if (bHit and ((not gMousePickFoundHit) or fHitDist < self.gMousePickF=
oundDist)) then

Modified: trunk/data/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.mainmenu.lua (original)
+++ trunk/data/lua/lib.mainmenu.lua Sun Dec 23 00:29:48 2007
@@ -241,6 +241,7 @@
 =

 function StartOfflineMode ()
 	gStartGameWithoutNetwork =3D true
+	MulitTexTerrain_NotifyMapChange()
 	=

 	local x,y,z =3D -183,203,0
 	--if (gGroundBlockLoader) then x,y,z =3D -gGroundBlockLoader:GetMapW()*8/=
2,gGroundBlockLoader:GetMapH()*8/2,0 end

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Sun Dec 23 00:29:48 2007
@@ -57,6 +57,7 @@
 dofile(libpath .. "lib.uoids.lua")
 dofile(libpath .. "lib.season.lua")
 dofile(libpath .. "lib.terrain.lua")
+dofile(libpath .. "lib.terrain.multitex.lua")
 dofile(libpath .. "lib.static.lua")
 dofile(libpath .. "lib.compass.lua")
 dofile(libpath .. "lib.gfm.lua")
@@ -246,66 +247,15 @@
 	NotifyListener("Hook_PreLoad")
 	PreLoad()
 =

-	=

-	if (gCommandLineArguments[1] =3D=3D "-ea") then -- export artmaps
-		local count =3D hex2num("0x00004000")
-		print("exporting artmaps : ",count)
-		for iArtMapID =3D 0,count-1 do =

-			local sFilePath =3D sprintf("../myartmaps/artmap%08d.png",iArtMapID)
-			local bSuccess =3D		gArtMapLoader:ExportToFile(sFilePath,iArtMapID)
-			--~ local bSuccess =3D	gArtMapLoader:ExportToFile(sFilePath,iArtMapID,p=
HueLoader=3Dnil,iHue=3D0)
-			print("export",iArtMapID,sFilePath,bSuccess)
-			--~ if (bSuccess) then break end
-		end
-		print("done")
-		os.exit(0)
-	end
-	=

-	if (gCommandLineArguments[1] =3D=3D "-et") then -- export texmaps
-		local count =3D gTexMapLoader:GetCount()
-		print("exporting texmaps : ",count)
-		for iTexMapID =3D 0,count-1 do =

-			local sFilePath =3D sprintf("../mytexmaps/texmap%08d.png",iTexMapID)
-			-- iTexMapID =3D iTranslatedTileTypeID
-			local bSuccess =3D	gTexMapLoader:ExportToFile(sFilePath,iTexMapID)
-			--~ local bSuccess =3D	gTexMapLoader:ExportToFile(sFilePath,iTexMapID,p=
HueLoader=3Dnil,iHue=3D0)
-			print("export",iTexMapID,sFilePath,bSuccess)
-			--~ if (bSuccess) then break end
-		end
-		print("done")
-		os.exit(0)
-	end
-	=

-	if (gCommandLineArguments[1] =3D=3D "-egt") then -- export ground tiletyp=
ecounter
-		local iMapIndex =3D 4
-		LoadMap(iMapIndex)
-		local counter =3D gGroundBlockLoader:CountTileTypes()
-		for k,v in pairs(counter) do print("$gTileTypeCount["..iMapIndex.."]["..=
k.."] =3D "..v..";") end
-		print("done")
-		os.exit(0)
-	end
-	=

-	if (gCommandLineArguments[1] =3D=3D "-ett") then -- export tiletype-infos
-		local iTileTypeEndID =3D gTileTypeLoader:GetEndID()
-
-		-- dump tiletype infos
-		local iGroundTileTypeIDEnd =3D hex2num("0x00004000")
-		for iGroundTileTypeID =3D 0,iGroundTileTypeIDEnd-1 do
-			local miFlags,miTexID,msName =3D gTileTypeLoader:GetGroundTileType(iGro=
undTileTypeID)
-			if (miFlags) then
-				printf("$gTileType[0x%04x] =3D array(0x%04x,0x%04x,'%s');\n",iGroundTi=
leTypeID,miFlags,miTexID,msName)
-			end
-		end
-		=

-		print("done")
-		os.exit(0)
-	end
+	InvokeExporters()
 	=

 	gCurrentRenderer:PreInit()
 =

 	MainMenuFinishedPreLoading()
 =

 	gCurrentRenderer:Init()
+	=

+	MulitTexTerrainInit()
 =

 	-- set fadelines font
 	gFadeLinesFont =3D gFontNameDefault
@@ -419,6 +369,7 @@
 	GUIStep() -- generate mouse_enter, mouse_leave events (might adjust curso=
r -> before CursorStep)
 	ToolTipStep() -- needs mouse_enter, should be after GUIStep
 	CursorStep()
+	MulitTexTerrainStep()
 =

 	NotifyListener("EveryFrame")
 	=

@@ -427,3 +378,60 @@
 	SoundStep()
 	Client_USleep(1) -- just 1 millisecond, but gives other processes a chanc=
e to do something
 end
+
+-- exports data if some commandline parameters are set
+function InvokeExporters ()
+	if (gCommandLineArguments[1] =3D=3D "-ea") then -- export artmaps
+		local count =3D hex2num("0x00004000")
+		print("exporting artmaps : ",count)
+		for iArtMapID =3D 0,count-1 do =

+			local sFilePath =3D sprintf("../myartmaps/artmap%08d.png",iArtMapID)
+			local bSuccess =3D		gArtMapLoader:ExportToFile(sFilePath,iArtMapID)
+			--~ local bSuccess =3D	gArtMapLoader:ExportToFile(sFilePath,iArtMapID,p=
HueLoader=3Dnil,iHue=3D0)
+			print("export",iArtMapID,sFilePath,bSuccess)
+			--~ if (bSuccess) then break end
+		end
+		print("done")
+		os.exit(0)
+	end
+	=

+	if (gCommandLineArguments[1] =3D=3D "-et") then -- export texmaps
+		local count =3D gTexMapLoader:GetCount()
+		print("exporting texmaps : ",count)
+		for iTexMapID =3D 0,count-1 do =

+			local sFilePath =3D sprintf("../mytexmaps/texmap%08d.png",iTexMapID)
+			-- iTexMapID =3D iTranslatedTileTypeID
+			local bSuccess =3D	gTexMapLoader:ExportToFile(sFilePath,iTexMapID)
+			--~ local bSuccess =3D	gTexMapLoader:ExportToFile(sFilePath,iTexMapID,p=
HueLoader=3Dnil,iHue=3D0)
+			print("export",iTexMapID,sFilePath,bSuccess)
+			--~ if (bSuccess) then break end
+		end
+		print("done")
+		os.exit(0)
+	end
+	=

+	if (gCommandLineArguments[1] =3D=3D "-egt") then -- export ground tiletyp=
ecounter
+		local iMapIndex =3D 4
+		LoadMap(iMapIndex)
+		local counter =3D gGroundBlockLoader:CountTileTypes()
+		for k,v in pairs(counter) do print("$gTileTypeCount["..iMapIndex.."]["..=
k.."] =3D "..v..";") end
+		print("done")
+		os.exit(0)
+	end
+	=

+	if (gCommandLineArguments[1] =3D=3D "-ett") then -- export tiletype-infos
+		local iTileTypeEndID =3D gTileTypeLoader:GetEndID()
+
+		-- dump tiletype infos
+		local iGroundTileTypeIDEnd =3D hex2num("0x00004000")
+		for iGroundTileTypeID =3D 0,iGroundTileTypeIDEnd-1 do
+			local miFlags,miTexID,msName =3D gTileTypeLoader:GetGroundTileType(iGro=
undTileTypeID)
+			if (miFlags) then
+				printf("$gTileType[0x%04x] =3D array(0x%04x,0x%04x,'%s');\n",iGroundTi=
leTypeID,miFlags,miTexID,msName)
+			end
+		end
+		=

+		print("done")
+		os.exit(0)
+	end
+end

Modified: trunk/data/lua/net.walk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.walk.lua (original)
+++ trunk/data/lua/net.walk.lua Sun Dec 23 00:29:48 2007
@@ -316,6 +316,7 @@
 	SetPlayerPos(mobiledata.xloc,mobiledata.yloc,mobiledata.zloc,mobiledata.d=
ir) -- always call this, affects gPlayerPos
 	gTileFreeWalk:NotifyPlayerMobileTeleport(GetPlayerMobile())
 	gCurrentRenderer:NotifyPlayerTeleported()
+	MulitTexTerrain_NotifyTeleport()
 	WalkLog("NotifyTeleport end")
 end
 =




From no-reply at zwischenwelt.org  Sun Dec 23 02:34:59 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 01:34:59 -0000
Subject: [Iris-commit] [IRIS] r1662 - in /trunk: bin/resources.cfg
 data/lua/lib.mainmenu.lua data/lua/lib.terrain.multitex.lua
 data/lua/main.lua data/lua/net.walk.lua
 data/terrain/materials/terrain.material src/scripting.iris.cpp
 src/terrain_multitex.cpp
Message-ID: <20071223013459.8A52B1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec 23 02:34:59 2007
New Revision: 1662

Log:
working on multitex-terrain

Modified:
    trunk/bin/resources.cfg
    trunk/data/lua/lib.mainmenu.lua
    trunk/data/lua/lib.terrain.multitex.lua
    trunk/data/lua/main.lua
    trunk/data/lua/net.walk.lua
    trunk/data/terrain/materials/terrain.material
    trunk/src/scripting.iris.cpp
    trunk/src/terrain_multitex.cpp

Modified: trunk/bin/resources.cfg
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/bin/resources.cfg (original)
+++ trunk/bin/resources.cfg Sun Dec 23 02:34:59 2007
@@ -72,6 +72,7 @@
 FileSystem=3D../data/terrain/materials
 FileSystem=3D../data/terrain/programs
 FileSystem=3D../data/terrain/textures
+FileSystem=3D../data/terrain/multitex
 =

 # new Grannys
 FileSystem=3D../data/grannys/materials

Modified: trunk/data/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.mainmenu.lua (original)
+++ trunk/data/lua/lib.mainmenu.lua Sun Dec 23 02:34:59 2007
@@ -241,7 +241,7 @@
 =

 function StartOfflineMode ()
 	gStartGameWithoutNetwork =3D true
-	MulitTexTerrain_NotifyMapChange()
+	MultiTexTerrain_NotifyMapChange()
 	=

 	local x,y,z =3D -183,203,0
 	--if (gGroundBlockLoader) then x,y,z =3D -gGroundBlockLoader:GetMapW()*8/=
2,gGroundBlockLoader:GetMapH()*8/2,0 end

Modified: trunk/data/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.terrain.multitex.lua (original)
+++ trunk/data/lua/lib.terrain.multitex.lua Sun Dec 23 02:34:59 2007
@@ -37,21 +37,50 @@
 gTerrain_MultiTexType_Fallback =3D "dirt"
 gMultiTextureAtlasList_Span =3D {"grass","dirt","rock","sand","forest","ju=
ngle","cobblestone","snow","void"}
 =

+gMultiTexTerrain_NextStep =3D 0
+kMultiTexTerrain_StepInterval =3D 200
+gMultiTexTerrain_BX =3D nil
+gMultiTexTerrain_BY =3D nil
+gMultiTexTerrain_Gfx =3D nil
 =

-function MulitTexTerrainInit ()
+function MultiTexTerrainInit ()
+	if (not gEnableMultiTexTerrain) then return end
 	=

+	-- TerrainMultiTex_AddTexCoordSet (int iMode,float tx,float ty,float tw,f=
loat th)  -- 0:ground,1:mainmask,2:mask
+	local e =3D 1/4
+	local f =3D e/4
+	TerrainMultiTex_AddTexCoordSet(0, 0*e,0*e,f,f) =

+	TerrainMultiTex_AddTexCoordSet(1, 0,0,1,1) =

+	TerrainMultiTex_AddTexCoordSet(2, 0,0,1,1) =

+	TerrainMultiTex_SetGroundMaterialTypeLookUp({}) =

 end
 =

-function MulitTexTerrain_NotifyMapChange ()
-	print("MulitTexTerrain_NotifyMapChange")
+function MultiTexTerrain_NotifyMapChange ()
+	print("MultiTexTerrain_NotifyMapChange")
 end
 =

-function MulitTexTerrain_NotifyTeleport ()
-	print("MulitTexTerrain_NotifyTeleport")
-	--~ MulitTexTerrain_NotifyMapChange()
+function MultiTexTerrain_NotifyTeleport ()
+	print("MultiTexTerrain_NotifyTeleport")
+	--~ MultiTexTerrain_NotifyMapChange()
 end
 =

-function MulitTexTerrainStep ()
+function MultiTexTerrainStep ()
+	if (not gEnableMultiTexTerrain) then return end
+	if (gMultiTexTerrain_NextStep > gMyTicks) then return end
+	gMultiTexTerrain_NextStep =3D gMyTicks + kMultiTexTerrain_StepInterval
 	=

+	local camx,camy,camz =3D gCurrentRenderer:GetLookAheadCamPos()
+	local bx =3D -math.floor(gCurrentRenderer.giMapOriginX*gCurrentRenderer.R=
OBMAP_CHUNK_SIZE + camx/8)
+	local by =3D  math.floor(gCurrentRenderer.giMapOriginY*gCurrentRenderer.R=
OBMAP_CHUNK_SIZE + camy/8)
+	if (gMultiTexTerrain_BX =3D=3D bx and gMultiTexTerrain_BY =3D=3D by) then=
 return end
+	gMultiTexTerrain_BX =3D bx
+	gMultiTexTerrain_BY =3D by
+	print("MultiTexTerrainStep",bx,by)
+	if (gMultiTexTerrain_Gfx) then gMultiTexTerrain_Gfx:Destroy() end
+	gMultiTexTerrain_Gfx =3D CreateRootGfx3D()
+	local x,y,z =3D gCurrentRenderer:UOPosToLocal(bx*8,by*8,0)
+	gMultiTexTerrain_Gfx:SetPosition(x,y,z)
+	--~ gMultiTexTerrain_Gfx:SetMesh("axes.mesh")
+	if (gGroundBlockLoader) then Gfx3D_SetMultiTexTerrain(gMultiTexTerrain_Gf=
x,gGroundBlockLoader,bx,by) end
+	gMultiTexTerrain_Gfx:SetMaterial(kTerrainMultiTexMatName)
 end
-

Modified: trunk/data/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/main.lua (original)
+++ trunk/data/lua/main.lua Sun Dec 23 02:34:59 2007
@@ -255,7 +255,7 @@
 =

 	gCurrentRenderer:Init()
 	=

-	MulitTexTerrainInit()
+	MultiTexTerrainInit()
 =

 	-- set fadelines font
 	gFadeLinesFont =3D gFontNameDefault
@@ -369,7 +369,7 @@
 	GUIStep() -- generate mouse_enter, mouse_leave events (might adjust curso=
r -> before CursorStep)
 	ToolTipStep() -- needs mouse_enter, should be after GUIStep
 	CursorStep()
-	MulitTexTerrainStep()
+	MultiTexTerrainStep()
 =

 	NotifyListener("EveryFrame")
 	=


Modified: trunk/data/lua/net.walk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.walk.lua (original)
+++ trunk/data/lua/net.walk.lua Sun Dec 23 02:34:59 2007
@@ -316,7 +316,7 @@
 	SetPlayerPos(mobiledata.xloc,mobiledata.yloc,mobiledata.zloc,mobiledata.d=
ir) -- always call this, affects gPlayerPos
 	gTileFreeWalk:NotifyPlayerMobileTeleport(GetPlayerMobile())
 	gCurrentRenderer:NotifyPlayerTeleported()
-	MulitTexTerrain_NotifyTeleport()
+	MultiTexTerrain_NotifyTeleport()
 	WalkLog("NotifyTeleport end")
 end
 =


Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Sun Dec 23 02:34:59 2007
@@ -174,7 +174,23 @@
 				// colour_op_ex blend_diffuse_alpha  src_current src_texture
 				// alpha_op_ex ....
 			}
-			/*
+		}
+	}
+}
+
+material terrain_multitex_mat2
+{
+	technique
+	{
+		pass
+		{
+			texture_unit base
+			{
+				tex_coord_set 0
+				texture terrain_tex_atlas_1024.png
+				// colour_op_ex blend_diffuse_alpha  src_current src_texture
+				// alpha_op_ex ....
+			}
 			texture_unit base
 			{
 				tex_coord_set 1
@@ -190,7 +206,6 @@
 				tex_coord_set 3
 				texture terrain_multitex_mask_64_blur_man.png
 			}
-			*/
 		}
 	}
 }

Modified: trunk/src/scripting.iris.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.iris.cpp (original)
+++ trunk/src/scripting.iris.cpp Sun Dec 23 02:34:59 2007
@@ -310,7 +310,7 @@
 		myLookUp[i] =3D 0;
 		if (lua_istable(L,1)) { // table is at index 1
 			lua_rawgeti(L,1,i); // table is at index 1
-			if (lua_isnil(L,-1)) myLookUp[i] =3D luaL_checkint(L,-1);
+			if (lua_isnil(L,-1)) myLookUp[i] =3D (int)lua_tonumber(L,-1);
 			lua_pop(L,1); // pop 1 elements
 		}
 	}

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Sun Dec 23 02:34:59 2007
@@ -10,6 +10,10 @@
 #include <vector>
 =

 #define ANTI_XMIRROR
+
+#ifndef PROFILE
+#define PROFILE
+#endif
 =

 using namespace Lugre;
 =

@@ -93,14 +97,18 @@
 		// write position
 		*++w =3D x + dx;
 		*++w =3D y + dy;
-		*++w =3D GetZF(x+idx,y+idy);
+		*++w =3D 0;
+		//~ *++w =3D GetZF(x+idx,y+idy);
 			=

 		// write normal
 		float* temp;
-		temp =3D GetNormal(x+idx,y+idy);
-		*++w =3D temp[0];
-		*++w =3D temp[1];
-		*++w =3D temp[2];
+		//~ temp =3D GetNormal(x+idx,y+idy);
+		//~ *++w =3D temp[0];
+		//~ *++w =3D temp[1];
+		//~ *++w =3D temp[2];
+		*++w =3D 0;
+		*++w =3D 0;
+		*++w =3D 1;
 			=

 		// write texcoords 1 : spanning of type_main
 		temp =3D GetTexCoordInfo_GroundMaterialType(iMainType);
@@ -123,9 +131,9 @@
 		*++w =3D temp[1] + dy*temp[3];
 	}
 	=

-	inline float*	GetTexCoordInfo_GroundMaterialType	(const int iID) { return=
 &mTexCoords_Ground[	iID*4]; }
-	inline float*	GetTexCoordInfo_MainMask			(const int iID) { return &mTexCo=
ords_MainMask[	iID*4]; }
-	inline float*	GetTexCoordInfo_Mask				(const int iID) { return &mTexCoord=
s_Mask[		iID*4]; }
+	inline float*	GetTexCoordInfo_GroundMaterialType	(const int iID) { return=
 &mTexCoords_Ground[	iID*0*4]; }
+	inline float*	GetTexCoordInfo_MainMask			(const int iID) { return &mTexCo=
ords_MainMask[	iID*0*4]; }
+	inline float*	GetTexCoordInfo_Mask				(const int iID) { return &mTexCoord=
s_Mask[		iID*0*4]; }
 	=

 	=

 	void	WriteToRobRenderOp (cGroundBlockLoader* pGroundBlockLoader,int bx,in=
t by,cRobRenderOp& pRobRenderOp) {
@@ -157,6 +165,7 @@
 		int iMaskA;	=

 		float spanx,spany;
 		=

+		#if 0
 		// initialize void block if neccessary: used "outside" the map, e.g. on =
the borders...
 		static RawGroundBlock	myVoidBlock;
 		static bool				myVoidBlockInit =3D true;
@@ -216,16 +225,18 @@
 		for (x=3D0;x<=3DT;++x)	mNormals[y*(T+1)+x] =3D LookUpNormal(	GetZ(x+1,y =
 ) - GetZ(x-1,y  ),
 																GetZ(x  ,y+1) - GetZ(x  ,y-1) );
 		=

+		#endif
+		=

 		// write vertices
 		Ogre::Real* w =3D pWriter-1; // -1 because *++w is used inside instead o=
f *w++ , which saves an internal "-1" calc every time
 		for (y=3D0;y<T;++y)
 		for (x=3D0;x<T;++x) {
-			iMainType	=3D GetType(x,y);
-			iMainMask	=3D IsTerrainTypeNodraw(iMainType) ? 1 : 0; // 0=3Dfully visi=
ble, 1=3Dfully transparent (nodraw tiles)
-			iTypeA		=3D GetMostFrequentNeighboorType(x,y,iMainType);
-			iMaskA		=3D (iTypeA =3D=3D iMainType) ? 0 : GenerateTransitionMask(x,y,=
iTypeA);
-			spanx =3D float(x & 4);
-			spany =3D float(y & 4);
+			iMainType	=3D 0; // GetType(x,y);
+			iMainMask	=3D 0; // IsTerrainTypeNodraw(iMainType) ? 1 : 0; // 0=3Dfull=
y visible, 1=3Dfully transparent (nodraw tiles)
+			iTypeA		=3D 0; // GetMostFrequentNeighboorType(x,y,iMainType);
+			iMaskA		=3D 0; // (iTypeA =3D=3D iMainType) ? 0 : GenerateTransitionMas=
k(x,y,iTypeA);
+			spanx =3D float(x % 4);
+			spany =3D float(y % 4);
 			=

 			WriteVertex(w,x,y,iMainType,iMainMask,iTypeA,iMaskA, spanx,spany, 0,0, =
0.0,0.0);
 			WriteVertex(w,x,y,iMainType,iMainMask,iTypeA,iMaskA, spanx,spany, 1,0, =
1.0,0.0);
@@ -325,7 +336,7 @@
 void	 TerrainMultiTex_AddTexCoordSet		(int iMode,float tx,float ty,float t=
w,float th) {
 	std::vector<float>* pTarget =3D 0;
 	switch (iMode) { =

-		case 0: pTarget =3D &gTiledMultiTexTerrain.mTexCoords_Ground;	break;
+		case 0: pTarget =3D &gTiledMultiTexTerrain.mTexCoords_Ground;		break;
 		case 1: pTarget =3D &gTiledMultiTexTerrain.mTexCoords_MainMask;	break;
 		case 2: pTarget =3D &gTiledMultiTexTerrain.mTexCoords_Mask;		break;
 	}



From no-reply at zwischenwelt.org  Sun Dec 23 15:44:33 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 14:44:33 -0000
Subject: [Iris-commit] [IRIS] r1663 - in /trunk: mapinfo.php
	src/terrain_multitex.cpp
Message-ID: <20071223144433.91B401C1829F@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec 23 15:44:32 2007
New Revision: 1663

Log:
working on multi-tex-terrain

Modified:
    trunk/mapinfo.php
    trunk/src/terrain_multitex.cpp

Modified: trunk/mapinfo.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/mapinfo.php (original)
+++ trunk/mapinfo.php Sun Dec 23 15:44:32 2007
@@ -8,6 +8,13 @@
 $gTileType =3D array(); // $gTileType[$iTileTypeID] =3D array($iFlags,$iTe=
xMapID,$sName)
 include("mapdata.php");
 include("mytiletypes.php");
+
+if (0) {
+	for ($i=3D0;$i<5;++$i) {
+		foreach ($gTileTypeCount as $k =3D> $c) { if ($k >=3D 0x4000) echo "warn=
ing ! terraintype outside 0x4000 ! $k\n"; }
+	}
+	exit(0);
+}
 =

 $gTileTypeNames =3D array("NoName","sand","forest","jungle","grass","rock"=
,"cave",
 	"snow","water","stone","dirt","wooden floor","sand stone","marble","flags=
tone",

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Sun Dec 23 15:44:32 2007
@@ -97,18 +97,14 @@
 		// write position
 		*++w =3D x + dx;
 		*++w =3D y + dy;
-		*++w =3D 0;
-		//~ *++w =3D GetZF(x+idx,y+idy);
+		*++w =3D GetZF(x+idx,y+idy);
 			=

 		// write normal
 		float* temp;
-		//~ temp =3D GetNormal(x+idx,y+idy);
-		//~ *++w =3D temp[0];
-		//~ *++w =3D temp[1];
-		//~ *++w =3D temp[2];
-		*++w =3D 0;
-		*++w =3D 0;
-		*++w =3D 1;
+		temp =3D GetNormal(x+idx,y+idy);
+		*++w =3D temp[0];
+		*++w =3D temp[1];
+		*++w =3D temp[2];
 			=

 		// write texcoords 1 : spanning of type_main
 		temp =3D GetTexCoordInfo_GroundMaterialType(iMainType);
@@ -165,7 +161,6 @@
 		int iMaskA;	=

 		float spanx,spany;
 		=

-		#if 0
 		// initialize void block if neccessary: used "outside" the map, e.g. on =
the borders...
 		static RawGroundBlock	myVoidBlock;
 		static bool				myVoidBlockInit =3D true;
@@ -186,7 +181,7 @@
 			for (int dz_y=3D-kMaxZDiff;dz_y<=3DkMaxZDiff;++dz_y)
 			for (int dz_x=3D-kMaxZDiff;dz_x<=3DkMaxZDiff;++dz_x) {
 				Ogre::Vector3 n =3D Ogre::Vector3(2,0,dz_x).crossProduct(Ogre::Vector3=
(0,2,dz_y)).normalisedCopy();
-				float* p =3D GetNormal(dz_x,dz_y);
+				float* p =3D LookUpNormal(dz_x,dz_y);
 				p[0] =3D n.x;
 				p[1] =3D n.y;
 				p[2] =3D n.z;
@@ -214,7 +209,6 @@
 			}
 		}
 		=

-		=

 		// load z buffers to cache, each is used 4 times during vertex writing, =
and 4 times during normal calc
 		for (y=3D-1;y<=3DT+1;++y) =

 		for (x=3D-1;x<=3DT+1;++x) mZ[(y+1)*(T+3)+(x+1)] =3D GetZRaw(x,y); // ini=
t cache for use by GetZ
@@ -225,13 +219,12 @@
 		for (x=3D0;x<=3DT;++x)	mNormals[y*(T+1)+x] =3D LookUpNormal(	GetZ(x+1,y =
 ) - GetZ(x-1,y  ),
 																GetZ(x  ,y+1) - GetZ(x  ,y-1) );
 		=

-		#endif
 		=

 		// write vertices
 		Ogre::Real* w =3D pWriter-1; // -1 because *++w is used inside instead o=
f *w++ , which saves an internal "-1" calc every time
 		for (y=3D0;y<T;++y)
 		for (x=3D0;x<T;++x) {
-			iMainType	=3D 0; // GetType(x,y);
+			iMainType	=3D GetType(x,y);
 			iMainMask	=3D 0; // IsTerrainTypeNodraw(iMainType) ? 1 : 0; // 0=3Dfull=
y visible, 1=3Dfully transparent (nodraw tiles)
 			iTypeA		=3D 0; // GetMostFrequentNeighboorType(x,y,iMainType);
 			iMaskA		=3D 0; // (iTypeA =3D=3D iMainType) ? 0 : GenerateTransitionMas=
k(x,y,iTypeA);



From no-reply at zwischenwelt.org  Sun Dec 23 16:46:18 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 15:46:18 -0000
Subject: [Iris-commit] [IRIS] r1664 - in /trunk:
 data/lua/lib.terrain.multitex.lua src/terrain_multitex.cpp
Message-ID: <20071223154618.1B71C1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec 23 16:46:17 2007
New Revision: 1664

Log:
working on multitex terrain

Modified:
    trunk/data/lua/lib.terrain.multitex.lua
    trunk/src/terrain_multitex.cpp

Modified: trunk/data/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.terrain.multitex.lua (original)
+++ trunk/data/lua/lib.terrain.multitex.lua Sun Dec 23 16:46:17 2007
@@ -41,7 +41,7 @@
 kMultiTexTerrain_StepInterval =3D 200
 gMultiTexTerrain_BX =3D nil
 gMultiTexTerrain_BY =3D nil
-gMultiTexTerrain_Gfx =3D nil
+gMultiTexTerrain_GfxList =3D {}
 =

 function MultiTexTerrainInit ()
 	if (not gEnableMultiTexTerrain) then return end
@@ -67,6 +67,7 @@
 function MultiTexTerrainStep ()
 	if (not gEnableMultiTexTerrain) then return end
 	if (gMultiTexTerrain_NextStep > gMyTicks) then return end
+	if (not gGroundBlockLoader) then return end
 	gMultiTexTerrain_NextStep =3D gMyTicks + kMultiTexTerrain_StepInterval
 	=

 	local camx,camy,camz =3D gCurrentRenderer:GetLookAheadCamPos()
@@ -76,11 +77,26 @@
 	gMultiTexTerrain_BX =3D bx
 	gMultiTexTerrain_BY =3D by
 	print("MultiTexTerrainStep",bx,by)
-	if (gMultiTexTerrain_Gfx) then gMultiTexTerrain_Gfx:Destroy() end
-	gMultiTexTerrain_Gfx =3D CreateRootGfx3D()
-	local x,y,z =3D gCurrentRenderer:UOPosToLocal(bx*8,by*8,0)
-	gMultiTexTerrain_Gfx:SetPosition(x,y,z)
-	--~ gMultiTexTerrain_Gfx:SetMesh("axes.mesh")
-	if (gGroundBlockLoader) then Gfx3D_SetMultiTexTerrain(gMultiTexTerrain_Gf=
x,gGroundBlockLoader,bx,by) end
-	gMultiTexTerrain_Gfx:SetMaterial(kTerrainMultiTexMatName)
+	local r =3D 3
+	for k,gfx in pairs(gMultiTexTerrain_GfxList) do =

+		if (math.abs(gfx.bx - bx) > r or math.abs(gfx.by - by) > r) then
+			gfx:Destroy() =

+			gMultiTexTerrain_GfxList[k] =3D nil
+		end
+	end
+	for dy =3D -r,r do
+	for dx =3D -r,r do
+		local name =3D (bx+dx).."_"..(by+dy)
+		if (not gMultiTexTerrain_GfxList[name]) then =

+			local gfx =3D CreateRootGfx3D()
+			gfx.bx =3D bx+dx
+			gfx.by =3D by+dy
+			local x,y,z =3D gCurrentRenderer:UOPosToLocal((bx+dx)*8,(by+dy)*8,0)
+			gfx:SetPosition(x,y,z)
+			Gfx3D_SetMultiTexTerrain(gfx,gGroundBlockLoader,bx+dx,by+dy)
+			gfx:SetMaterial(kTerrainMultiTexMatName)
+			gMultiTexTerrain_GfxList[name] =3D gfx
+		end
+	end
+	end
 end

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Sun Dec 23 16:46:17 2007
@@ -9,7 +9,13 @@
 #include <Ogre.h>
 #include <vector>
 =

-#define ANTI_XMIRROR
+#define XMIRROR
+
+#ifdef XMIRROR
+#define XMIRROR_ONE_OR_ZERO 1
+#else
+#define XMIRROR_ONE_OR_ZERO 0
+#endif
 =

 #ifndef PROFILE
 #define PROFILE
@@ -28,6 +34,8 @@
 	enum { kMaxZDiff =3D 64 }; ///< mNormalLookup
 	enum { kGroundMatLookUpSize =3D 0x4000 };
 	enum { kShortType_nodraw =3D -1 };
+	=

+	static inline float GetBlockZBounds() { return 20.0; } ///< 12.8 =3D 128*=
0.1 would be enough, but lets give a bit of space, in case of water-z-trans=
form
 	=

 	std::vector<float> mTexCoords_Ground;
 	std::vector<float> mTexCoords_MainMask;
@@ -95,8 +103,12 @@
 		const float dx,const float dy) {
 		=

 		// write position
-		*++w =3D x + dx;
-		*++w =3D y + dy;
+		#ifdef XMIRROR
+		*++w =3D -(x + dx);
+		#else
+		*++w =3D  (x + dx);
+		#endif
+		*++w =3D  (y + dy);
 		*++w =3D GetZF(x+idx,y+idy);
 			=

 		// write normal
@@ -140,13 +152,19 @@
 		int x,y,i;
 		pRobRenderOp.Begin(iVertexCount,iIndexCount,bDynamic,bKeepOldIndices);
 		pRobRenderOp.SetVertexFormatFromEnum(cRobRenderOp::kVertexFormat_pnuv,4)=
; // 4 tex coord sets
-		Ogre::Real* pWriter =3D pRobRenderOp.StartCustomWriter(Ogre::Vector3(0,0=
,0),Ogre::Vector3(T,T,256));
+		=

+		Ogre::Real* pWriter =3D pRobRenderOp.StartCustomWriter(Ogre::Vector3(XMI=
RROR_ONE_OR_ZERO?(-T):0,0,-GetBlockZBounds()),Ogre::Vector3(XMIRROR_ONE_OR_=
ZERO?0:T,T,GetBlockZBounds()));
 		WriteToVertexBuffer(pGroundBlockLoader,bx,by,pWriter);
 		for (y=3D0;y<T;++y)
 		for (x=3D0;x<T;++x) { =

 			i =3D (y*T+x)*4;
+			#ifdef XMIRROR
+			pRobRenderOp.Index(i + 0,i + 2,i + 1);
+			pRobRenderOp.Index(i + 1,i + 2,i + 3);
+			#else
 			pRobRenderOp.Index(i + 0,i + 1,i + 2);
 			pRobRenderOp.Index(i + 2,i + 1,i + 3);
+			#endif
 		}
 		pRobRenderOp.End();
 	}
@@ -180,7 +198,7 @@
 			bNormalLookupInit =3D false; // only once
 			for (int dz_y=3D-kMaxZDiff;dz_y<=3DkMaxZDiff;++dz_y)
 			for (int dz_x=3D-kMaxZDiff;dz_x<=3DkMaxZDiff;++dz_x) {
-				Ogre::Vector3 n =3D Ogre::Vector3(2,0,dz_x).crossProduct(Ogre::Vector3=
(0,2,dz_y)).normalisedCopy();
+				Ogre::Vector3 n =3D Ogre::Vector3(2,0,dz_x*0.1).crossProduct(Ogre::Vec=
tor3(0,2,dz_y*0.1)).normalisedCopy();
 				float* p =3D LookUpNormal(dz_x,dz_y);
 				p[0] =3D n.x;
 				p[1] =3D n.y;



From no-reply at zwischenwelt.org  Sun Dec 23 18:32:44 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 17:32:44 -0000
Subject: [Iris-commit] [IRIS] r1665 - in /trunk:
 data/lua/lib.terrain.multitex.lua data/terrain/materials/terrain.material
 data/terrain/multitex/terrain_multitex_mask_64_blur_man.png
 src/terrain_multitex.cpp
Message-ID: <20071223173245.6DCBB1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec 23 18:32:43 2007
New Revision: 1665

Log: (empty)

Modified:
    trunk/data/lua/lib.terrain.multitex.lua
    trunk/data/terrain/materials/terrain.material
    trunk/data/terrain/multitex/terrain_multitex_mask_64_blur_man.png
    trunk/src/terrain_multitex.cpp

Modified: trunk/data/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.terrain.multitex.lua (original)
+++ trunk/data/lua/lib.terrain.multitex.lua Sun Dec 23 18:32:43 2007
@@ -38,7 +38,7 @@
 gMultiTextureAtlasList_Span =3D {"grass","dirt","rock","sand","forest","ju=
ngle","cobblestone","snow","void"}
 =

 gMultiTexTerrain_NextStep =3D 0
-kMultiTexTerrain_StepInterval =3D 200
+kMultiTexTerrain_StepInterval =3D 500
 gMultiTexTerrain_BX =3D nil
 gMultiTexTerrain_BY =3D nil
 gMultiTexTerrain_GfxList =3D {}
@@ -50,8 +50,9 @@
 	local e =3D 1/4
 	local f =3D e/4
 	TerrainMultiTex_AddTexCoordSet(0, 0*e,0*e,f,f) =

-	TerrainMultiTex_AddTexCoordSet(1, 0,0,1,1) =

-	TerrainMultiTex_AddTexCoordSet(2, 0,0,1,1) =

+	TerrainMultiTex_AddTexCoordSet(0, 1*e,0*e,f,f) =

+	TerrainMultiTex_AddTexCoordSet(1, 3*e,3*e,e,e) -- mainmask
+	TerrainMultiTex_AddTexCoordSet(2, 1*e,3*e,e,e) -- mask
 	TerrainMultiTex_SetGroundMaterialTypeLookUp({}) =

 end
 =


Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Sun Dec 23 18:32:43 2007
@@ -167,48 +167,53 @@
 	{
 		pass
 		{
-			texture_unit base
-			{
-				tex_coord_set 0
-				texture terrain_tex_atlas_1024.png
-				// colour_op_ex blend_diffuse_alpha  src_current src_texture
-				// alpha_op_ex ....
+			//scene_blend alpha_blend
+			//alpha_rejection greater 0
+			texture_unit
+			{
+				texture terrain_tex_atlas_512.png
+				tex_coord_set	0
+				colour_op_ex	source1 src_texture src_texture
+			}
+			texture_unit
+			{
+				texture terrain_multitex_mask_64_blur_man.png alpha
+				tex_coord_set 3
+				colour_op_ex	source1 src_current src_current
+				alpha_op_ex		source1 src_texture src_texture
+			}
+			texture_unit
+			{
+				texture terrain_tex_atlas_512.png
+				tex_coord_set 2
+				colour_op_ex	blend_current_alpha src_texture src_current
+				alpha_op_ex		source1 src_current src_current
 			}
 		}
 	}
 }
-
+			=

 material terrain_multitex_mat2
 {
 	technique
 	{
 		pass
 		{
-			texture_unit base
-			{
-				tex_coord_set 0
-				texture terrain_tex_atlas_1024.png
-				// colour_op_ex blend_diffuse_alpha  src_current src_texture
-				// alpha_op_ex ....
-			}
-			texture_unit base
-			{
+			//scene_blend alpha_blend
+			alpha_rejection greater 0
+			texture_unit
+			{
+				texture terrain_multitex_mask_64_blur_man.png alpha
 				tex_coord_set 1
-				texture terrain_multitex_mask_64_blur_man.png
-			}
-			texture_unit base
-			{
-				tex_coord_set 2
-				texture terrain_tex_atlas_1024.png
-			}
-			texture_unit base
-			{
-				tex_coord_set 3
-				texture terrain_multitex_mask_64_blur_man.png
+				colour_op_ex	modulate src_current src_diffuse
+				alpha_op_ex		source1 src_texture src_texture
 			}
 		}
 	}
 }
+
+// colour_op_ex blend_diffuse_alpha  src_current src_texture
+// alpha_op_ex ....
 =

 //###########################################
 // BASE TILES

Modified: trunk/data/terrain/multitex/terrain_multitex_mask_64_blur_man.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Sun Dec 23 18:32:43 2007
@@ -139,9 +139,9 @@
 		*++w =3D temp[1] + dy*temp[3];
 	}
 	=

-	inline float*	GetTexCoordInfo_GroundMaterialType	(const int iID) { return=
 &mTexCoords_Ground[	iID*0*4]; }
-	inline float*	GetTexCoordInfo_MainMask			(const int iID) { return &mTexCo=
ords_MainMask[	iID*0*4]; }
-	inline float*	GetTexCoordInfo_Mask				(const int iID) { return &mTexCoord=
s_Mask[		iID*0*4]; }
+	inline float*	GetTexCoordInfo_GroundMaterialType	(const int iID) { return=
 &mTexCoords_Ground[	iID*4]; }
+	inline float*	GetTexCoordInfo_MainMask			(const int iID) { return &mTexCo=
ords_MainMask[	iID*4]; }
+	inline float*	GetTexCoordInfo_Mask				(const int iID) { return &mTexCoord=
s_Mask[		iID*4]; }
 	=

 	=

 	void	WriteToRobRenderOp (cGroundBlockLoader* pGroundBlockLoader,int bx,in=
t by,cRobRenderOp& pRobRenderOp) {
@@ -244,7 +244,7 @@
 		for (x=3D0;x<T;++x) {
 			iMainType	=3D GetType(x,y);
 			iMainMask	=3D 0; // IsTerrainTypeNodraw(iMainType) ? 1 : 0; // 0=3Dfull=
y visible, 1=3Dfully transparent (nodraw tiles)
-			iTypeA		=3D 0; // GetMostFrequentNeighboorType(x,y,iMainType);
+			iTypeA		=3D 1; // GetMostFrequentNeighboorType(x,y,iMainType);
 			iMaskA		=3D 0; // (iTypeA =3D=3D iMainType) ? 0 : GenerateTransitionMas=
k(x,y,iTypeA);
 			spanx =3D float(x % 4);
 			spany =3D float(y % 4);



From no-reply at zwischenwelt.org  Sun Dec 23 18:45:37 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 17:45:37 -0000
Subject: [Iris-commit] [IRIS] r1666 -
	/trunk/data/terrain/multitex/terrain_tex_atlas_512.png
Message-ID: <20071223174537.C7D3E1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec 23 18:45:37 2007
New Revision: 1666

Log:
terrain multitex 512

Added:
    trunk/data/terrain/multitex/terrain_tex_atlas_512.png   (with props)



From no-reply at zwischenwelt.org  Sun Dec 23 20:11:20 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 19:11:20 -0000
Subject: [Iris-commit] [IRIS] r1667 - in /trunk/data/lua: net.other.lua
	obj/obj.dynamic.lua
Message-ID: <20071223191121.1C6F91524004@zwischenwelt.org>

Author: hagish
Date: Sun Dec 23 20:11:20 2007
New Revision: 1667

Log:
suprise! :)

Modified:
    trunk/data/lua/net.other.lua
    trunk/data/lua/obj/obj.dynamic.lua

Modified: trunk/data/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/net.other.lua (original)
+++ trunk/data/lua/net.other.lua Sun Dec 23 20:11:20 2007
@@ -712,6 +712,17 @@
 	GumpParser(newgump)
 end
 =

+
+-- rename a mobile
+function Send_Rename_MOB (serial, name)
+	local out =3D GetSendFIFO()
+	out:PushNetUint8(kPacket_Rename_MOB)
+	out:PushNetUint32(serial)
+	out:PushFilledString(name, 30)
+	out:SendPacket()
+end
+
+
 --Subcommand 0x1c: Spell selected, client side
 --[[
 word	Has Spellbook or Spell(2=3Dno spell,1=3Dhas spellbook,0=3Dno spellboo=
k, but has spell)

Modified: trunk/data/lua/obj/obj.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/obj/obj.dynamic.lua (original)
+++ trunk/data/lua/obj/obj.dynamic.lua Sun Dec 23 20:11:20 2007
@@ -131,7 +131,7 @@
 	-- gMulti_ID =3D hex2num("0x4000")
 	-- TODO : check self.artid for boat
 =

-	if (gTileTypeLoader) then self.z_typename=3DGetStaticTileTypeName(self.ar=
tid) end
+	-- if (gTileTypeLoader) then self.z_typename=3DGetStaticTileTypeName(self=
.artid) end
 =

 	-- update container
 	self:SetContainer(self.iContainerSerial)



From no-reply at zwischenwelt.org  Sun Dec 23 20:24:26 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 19:24:26 -0000
Subject: [Iris-commit] [IRIS] r1668 - in /trunk: data/lua/ lua/
 lua/lib.input.iris.lua lua/main.lua lua/net.other.lua lua/obj/
Message-ID: <20071223192426.7EC331524004@zwischenwelt.org>

Author: hagish
Date: Sun Dec 23 20:24:26 2007
New Revision: 1668

Log:
moved lua from data/lua to lua

Added:
    trunk/lua/
      - copied from r1666, trunk/data/lua/
    trunk/lua/net.other.lua
      - copied unchanged from r1667, trunk/data/lua/net.other.lua
    trunk/lua/obj/
      - copied from r1667, trunk/data/lua/obj/
Removed:
    trunk/data/lua/
Modified:
    trunk/lua/lib.input.iris.lua
    trunk/lua/main.lua

Modified: trunk/lua/lib.input.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.input.iris.lua (original)
+++ trunk/lua/lib.input.iris.lua Sun Dec 23 20:24:26 2007
@@ -20,4 +20,4 @@
 --~ RegisterListener("mouse_left_drag_start",	function () MouseDownUODragD=
rop() end)
 RegisterListener("mouse_left_down",			function () MouseDownUODragDrop() en=
d)
 =

--- for keybinds see data/lua/lib.keybinds.lua
+-- for keybinds see lua/lib.keybinds.lua

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sun Dec 23 20:24:26 2007
@@ -4,7 +4,7 @@
 =

 gMainWorkingDir =3D GetMainWorkingDir and GetMainWorkingDir() or ""
 datapath =3D gMainWorkingDir.."data/"
-libpath =3D datapath.."lua/"
+libpath =3D gMainWorkingDir.."lua/"
 lugreluapath =3D gMainWorkingDir..(file_exists(gMainWorkingDir.."mylugre")=
 and "mylugre/lua/" or "lugre/lua/")
 gConfigPath 		=3D datapath.."config.lua"
 gConfigPathFallback	=3D datapath.."config.lua.dist"



From no-reply at zwischenwelt.org  Sun Dec 23 20:24:34 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 19:24:34 -0000
Subject: [Iris-commit] [IRIS] r1669 - /trunk/src/main.cpp
Message-ID: <20071223192435.4BCFF1524004@zwischenwelt.org>

Author: hagish
Date: Sun Dec 23 20:24:34 2007
New Revision: 1669

Log:
moved lua from data/lua to lua

Modified:
    trunk/src/main.cpp

Modified: trunk/src/main.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/main.cpp (original)
+++ trunk/src/main.cpp Sun Dec 23 20:24:34 2007
@@ -6,7 +6,7 @@
 #include "windows.h"
 #endif
 =

-#define PATH_MAIN_LUA		LUGRE_PATH("data/lua/main.lua")
+#define PATH_MAIN_LUA		LUGRE_PATH("lua/main.lua")
 #define PATH_LUGRE_LUA		LUGRE_PATH("lugre/lua")
 =

 using namespace Lugre;



From no-reply at zwischenwelt.org  Sun Dec 23 23:40:14 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 22:40:14 -0000
Subject: [Iris-commit] [IRIS] r1670 - in /trunk/data/models:
 materials/textures.material models/to_006000/mdl_005351.mesh
 textures/tex_5351.png
Message-ID: <20071223224016.B0B031524004@zwischenwelt.org>

Author: hagish
Date: Sun Dec 23 23:40:13 2007
New Revision: 1670

Log:
new model: hitchingpost

Added:
    trunk/data/models/models/to_006000/mdl_005351.mesh   (with props)
    trunk/data/models/textures/tex_5351.png   (with props)
Modified:
    trunk/data/models/materials/textures.material

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Sun Dec 23 23:40:13 2007
@@ -58,6 +58,7 @@
 		}
 	} =

 }
+
 =

 material tex_100 : tex_base
 { =

@@ -8141,4 +8142,19 @@
 			}
 		}
 	}
-}
+}
+
+
+material tex_5351 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_5351.png =

+			}	=

+		}
+	} =

+}



From no-reply at zwischenwelt.org  Sun Dec 23 23:42:05 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 22:42:05 -0000
Subject: [Iris-commit] [IRIS] r1671 - /rawdata/
Message-ID: <20071223224205.EA7161524004@zwischenwelt.org>

Author: hagish
Date: Sun Dec 23 23:42:05 2007
New Revision: 1671

Log:
for blender files and raw gfx stuff

Added:
    rawdata/



From no-reply at zwischenwelt.org  Sun Dec 23 23:42:35 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 22:42:35 -0000
Subject: [Iris-commit] [IRIS] r1672 - /rawdata/sd_pd/
Message-ID: <20071223224235.AFE371524004@zwischenwelt.org>

Author: hagish
Date: Sun Dec 23 23:42:35 2007
New Revision: 1672

Log:
hagish's public domain stuff

Added:
    rawdata/sd_pd/



From no-reply at zwischenwelt.org  Sun Dec 23 23:44:15 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 22:44:15 -0000
Subject: [Iris-commit] [IRIS] r1673 - in /rawdata/sd_pd: hitchingpost.blend
 hitchingpost_sd_hitchingpost.png
Message-ID: <20071223224415.E1FB31C18052@zwischenwelt.org>

Author: hagish
Date: Sun Dec 23 23:44:15 2007
New Revision: 1673

Log:
rawdata for hitingpost

Added:
    rawdata/sd_pd/hitchingpost.blend   (with props)
    rawdata/sd_pd/hitchingpost_sd_hitchingpost.png   (with props)



From no-reply at zwischenwelt.org  Sun Dec 23 23:47:22 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 22:47:22 -0000
Subject: [Iris-commit] [IRIS] r1674 - /branches/knut/
Message-ID: <20071223224725.156EF1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec 23 23:47:21 2007
New Revision: 1674

Log:
removed knut branch, no longer needed


Removed:
    branches/knut/



From no-reply at zwischenwelt.org  Mon Dec 24 00:50:55 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 23:50:55 -0000
Subject: [Iris-commit] [IRIS] r1675 - in /trunk/data/models:
 materials/textures.material models/to_006000/mdl_005632.mesh
 models/to_006000/mdl_005634.mesh textures/tex_5634.png
Message-ID: <20071223235055.BE5051C18052@zwischenwelt.org>

Author: hagish
Date: Mon Dec 24 00:50:47 2007
New Revision: 1675

Log:
new models: super-plant-pott

Added:
    trunk/data/models/models/to_006000/mdl_005632.mesh   (with props)
    trunk/data/models/models/to_006000/mdl_005634.mesh   (with props)
    trunk/data/models/textures/tex_5634.png   (with props)
Modified:
    trunk/data/models/materials/textures.material

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Mon Dec 24 00:50:47 2007
@@ -8158,3 +8158,31 @@
 		}
 	} =

 }
+material tex_5634 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_5634.png =

+			}	=

+		}
+	} =

+}
+
+material tex_5632 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_5634.png =

+			}	=

+		}
+	} =

+}
+



From no-reply at zwischenwelt.org  Mon Dec 24 00:51:26 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 23 Dec 2007 23:51:26 -0000
Subject: [Iris-commit] [IRIS] r1676 - in /rawdata/sd_pd: topf.blend
	topf_mld_005634.tga
Message-ID: <20071223235126.DF6911C18052@zwischenwelt.org>

Author: hagish
Date: Mon Dec 24 00:51:25 2007
New Revision: 1676

Log:
rawdata for plant pot

Added:
    rawdata/sd_pd/topf.blend   (with props)
    rawdata/sd_pd/topf_mld_005634.tga   (with props)



From no-reply at zwischenwelt.org  Mon Dec 24 01:41:46 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 24 Dec 2007 00:41:46 -0000
Subject: [Iris-commit] [IRIS] r1677 - in /rawdata/sd_pd: topf.blend
	topf_mdl_002481.png
Message-ID: <20071224004146.8DA231524004@zwischenwelt.org>

Author: hagish
Date: Mon Dec 24 01:41:45 2007
New Revision: 1677

Log:
new raw model basket

Added:
    rawdata/sd_pd/topf_mdl_002481.png   (with props)
Modified:
    rawdata/sd_pd/topf.blend

Modified: rawdata/sd_pd/topf.blend
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Mon Dec 24 01:42:53 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 24 Dec 2007 00:42:53 -0000
Subject: [Iris-commit] [IRIS] r1678 - in /trunk/data/models:
 materials/textures.material models/to_003000/mdl_002481.mesh
 textures/tex_2481.png
Message-ID: <20071224004254.195F01524004@zwischenwelt.org>

Author: hagish
Date: Mon Dec 24 01:42:53 2007
New Revision: 1678

Log:
new model: basket

Added:
    trunk/data/models/models/to_003000/mdl_002481.mesh   (with props)
    trunk/data/models/textures/tex_2481.png   (with props)
Modified:
    trunk/data/models/materials/textures.material

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Mon Dec 24 01:42:53 2007
@@ -8186,3 +8186,16 @@
 	} =

 }
 =

+material tex_2481 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_2481.png =

+			}	=

+		}
+	} =

+}



From no-reply at zwischenwelt.org  Mon Dec 24 04:42:16 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 24 Dec 2007 03:42:16 -0000
Subject: [Iris-commit] [IRIS] r1679 - in /trunk:
 data/terrain/materials/terrain.material lua/lib.3d.map.lua
Message-ID: <20071224034216.7BCB11524004@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Dec 24 04:42:15 2007
New Revision: 1679

Log:
minor changes

Modified:
    trunk/data/terrain/materials/terrain.material
    trunk/lua/lib.3d.map.lua

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Mon Dec 24 04:42:15 2007
@@ -175,20 +175,6 @@
 				tex_coord_set	0
 				colour_op_ex	source1 src_texture src_texture
 			}
-			texture_unit
-			{
-				texture terrain_multitex_mask_64_blur_man.png alpha
-				tex_coord_set 3
-				colour_op_ex	source1 src_current src_current
-				alpha_op_ex		source1 src_texture src_texture
-			}
-			texture_unit
-			{
-				texture terrain_tex_atlas_512.png
-				tex_coord_set 2
-				colour_op_ex	blend_current_alpha src_texture src_current
-				alpha_op_ex		source1 src_current src_current
-			}
 		}
 	}
 }
@@ -204,6 +190,20 @@
 			texture_unit
 			{
 				texture terrain_multitex_mask_64_blur_man.png alpha
+				tex_coord_set 3
+				colour_op_ex	source1 src_current src_current
+				alpha_op_ex		source1 src_texture src_texture
+			}
+			texture_unit
+			{
+				texture terrain_tex_atlas_512.png
+				tex_coord_set 2
+				colour_op_ex	blend_current_alpha src_texture src_current
+				alpha_op_ex		source1 src_current src_current
+			}
+			texture_unit
+			{
+				texture terrain_multitex_mask_64_blur_man.png alpha
 				tex_coord_set 1
 				colour_op_ex	modulate src_current src_diffuse
 				alpha_op_ex		source1 src_texture src_texture

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Mon Dec 24 04:42:15 2007
@@ -315,30 +315,6 @@
 				end
 			end
 		end
---[[
-		-- @hagish: what it's needed for ???!?
-		local iStaticCount
-		local xloc, yloc
-
-		for x =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
-			for y =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
-				gStaticBlockLoader:Load(iBlockUO_X+x,iBlockUO_Y+y)
-				iStaticCount =3D gStaticBlockLoader:Count() -- operates on the block t=
hat was last loaded using :Load()
-
-				--printdebug("static","iStaticCount=3D"..iStaticCount)
-				--printdebug("static","iBlockUO_X=3D"..iBlockUO_X.." iBlockUO_Y=3D"..i=
BlockUO_Y)
-				--printdebug("static","BlockX=3D"..x.." BlockY=3D"..y)
-
-				for i =3D 0,iStaticCount-1 do
-					iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i) -- oper=
ates on the block that was last loaded using :Load()
-
-					xloc =3D (iBlockUO_X+x)*8 + iX
-					yloc =3D (iBlockUO_Y+y)*8 + iY
-					=

-					self:CreateMapChunkEntity(chunk,iTileTypeID,xloc,yloc,iZ,iHue)
-				end =

-		end end
-]]--
 	end
 =

 	-- TODO : fish in water ? other gimiks ?



From no-reply at zwischenwelt.org  Tue Dec 25 01:49:38 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Dec 2007 00:49:38 -0000
Subject: [Iris-commit] [IRIS] r1680 - /trunk/lua/lib.3d.map.lua
Message-ID: <20071225004938.617351C18172@zwischenwelt.org>

Author: hagish
Date: Tue Dec 25 01:49:37 2007
New Revision: 1680

Log:
bugfix: hide mutli layers above player

Modified:
    trunk/lua/lib.3d.map.lua

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Tue Dec 25 01:49:37 2007
@@ -369,6 +369,20 @@
 			end
 		end
 =

+		-- check multis
+		for k,v in pairs(gMultis) do
+			local multi =3D k
+			if multi.lparts then
+				for k,v in pairs(multi.lparts) do
+
+					local iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
+					if	iX =3D=3D x and iY =3D=3D y  and iZ > playerheadpos then
+						playerIsInside =3D true
+					end
+				end
+			end
+		end
+
 		-- check dynamics to detect dynamic houseroofs and other stuff above the=
 head
 		if (not playerIsInside) then
 			for k,dynamic in pairs(GetDynamicList()) do



From no-reply at zwischenwelt.org  Tue Dec 25 01:51:06 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Dec 2007 00:51:06 -0000
Subject: [Iris-commit] [IRIS] r1681 - in /trunk: data/config.lua.dist
 lua/lib.3d.dynamic.lua lua/lib.fallback.lua
Message-ID: <20071225005107.8E3EB1524004@zwischenwelt.org>

Author: hagish
Date: Tue Dec 25 01:51:05 2007
New Revision: 1681

Log:
its possible to show a box as fallback -> gUseWhiteBoxAsFallBack

Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.fallback.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Tue Dec 25 01:51:05 2007
@@ -86,7 +86,7 @@
 =

 -- Fog of War
 gUseDistanceFog =3D true	-- enable/disable fog
-gFogValue=3D8				-- distance from cam
+gFogValue=3D16				-- distance from cam
 gFogcolorred=3D0
 gFogcolorgreen=3D0
 gFogcolorblue=3D0
@@ -229,10 +229,11 @@
 -- approx. 700MB RAM needed
 gPreloadStaticMesh =3D false
 =

-gEnableFallBackBillboards_Statics =3D true -- incorrect fallbacks can be a=
dded to the skiplist using the fallbacktool (f11)
+gEnableFallBackBillboards_Statics =3D false -- incorrect fallbacks can be =
added to the skiplist using the fallbacktool (f11)
 gEnableFallBackBillboards_Dynamics =3D true
 gForceFallBackBillboards_Statics =3D false
 gForceFallBackBillboards_Dynamics =3D false
+gUseWhiteBoxAsFallBack =3D true	-- use boxes not uo art billboards as fall=
backs
 =

 -- timeout of the text shown over the mobiles head in ms
 gHeadTextTimeout =3D 2 * 1000

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Tue Dec 25 01:51:05 2007
@@ -138,12 +138,19 @@
 =

 			-- fallback to billboard with original art
 			if (not IsArtBillboardFallBackSkipped(item.artid)) then
-				item.gfx.billboard =3D item.gfx:CreateChild()
-				item.xadd =3D item.xadd + 0.5
-				item.yadd =3D item.yadd + 0.5
-				item.zadd =3D item.zadd + 0.5
-				self:CreateArtBillBoard(item.gfx.billboard,iTranslatedTileTypeID,item.=
hue)
-				printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed load=
ing mesh for dynamic: artid=3D%i z_typename=3D%s\n",item.artid or -1,GetSta=
ticTileTypeName(item.artid) or ""))
+				if gUseWhiteBoxAsFallBack then
+					-- use just a white box as fallback
+					SetFallBackBox(item.gfx)
+					printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed loa=
ding mesh for dynamic: artid=3D%i z_typename=3D%s -> box fallback\n",item.a=
rtid or -1,GetStaticTileTypeName(item.artid) or ""))
+				else
+					-- generate uoart billboard fallback
+					item.gfx.billboard =3D item.gfx:CreateChild()
+					item.xadd =3D item.xadd + 0.5
+					item.yadd =3D item.yadd + 0.5
+					item.zadd =3D item.zadd + 0.5
+					self:CreateArtBillBoard(item.gfx.billboard,iTranslatedTileTypeID,item=
.hue)
+					printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed loa=
ding mesh for dynamic: artid=3D%i z_typename=3D%s\n",item.artid or -1,GetSt=
aticTileTypeName(item.artid) or ""))
+				end
 			end
 		end
 =


Modified: trunk/lua/lib.fallback.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.fallback.lua (original)
+++ trunk/lua/lib.fallback.lua Tue Dec 25 01:51:05 2007
@@ -110,3 +110,14 @@
 	end
 	return res
 end
+
+function SetFallBackBox (gfx)
+	if not gFallBackBoxMesh then
+		GfxSetBox(gfx,1,1,1,nil,nil,-1,0,0)
+		local mat =3D GetPlainTextureMat("art_fallback.png")
+		gfx:SetMaterial(mat)
+		gFallBackBoxMesh =3D gfx:RenderableConvertToMesh()
+	end
+	=

+	gfx:SetMesh(gFallBackBoxMesh)
+end



From no-reply at zwischenwelt.org  Tue Dec 25 02:28:48 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Dec 2007 01:28:48 -0000
Subject: [Iris-commit] [IRIS] r1682 - in /trunk: data/config.lua.dist
 data/terrain/materials/terrain.material lua/lib.terrain.multitex.lua
 src/scripting.iris.cpp src/terrain_multitex.cpp
Message-ID: <20071225012848.B89331C186B9@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Dec 25 02:28:48 2007
New Revision: 1682

Log:
working on multitex terrain

Modified:
    trunk/data/config.lua.dist
    trunk/data/terrain/materials/terrain.material
    trunk/lua/lib.terrain.multitex.lua
    trunk/src/scripting.iris.cpp
    trunk/src/terrain_multitex.cpp

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Tue Dec 25 02:28:48 2007
@@ -409,3 +409,4 @@
 }
 =

 gEnableMultiTexTerrain =3D false
+gDisableMultiTexTerrainTransitions =3D false -- ugly, but faster

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Tue Dec 25 02:28:48 2007
@@ -161,7 +161,8 @@
 // MULTITEXTURE TERRAIN MAT
 //###########################################
 =

-material terrain_multitex_mat
+// simple material without transitions
+material terrain_multitex_simple_mat
 {
 	technique
 	{
@@ -173,20 +174,26 @@
 			{
 				texture terrain_tex_atlas_512.png
 				tex_coord_set	0
-				colour_op_ex	source1 src_texture src_texture
+				colour_op_ex	modulate src_texture src_diffuse
 			}
 		}
 	}
 }
-			=

-material terrain_multitex_mat2
+
+material terrain_multitex_mat
 {
 	technique
 	{
 		pass
 		{
 			//scene_blend alpha_blend
-			alpha_rejection greater 0
+			//alpha_rejection greater 0
+			texture_unit
+			{
+				texture terrain_tex_atlas_512.png
+				tex_coord_set	0
+				colour_op_ex	source1 src_texture src_texture
+			}
 			texture_unit
 			{
 				texture terrain_multitex_mask_64_blur_man.png alpha
@@ -208,6 +215,16 @@
 				colour_op_ex	modulate src_current src_diffuse
 				alpha_op_ex		source1 src_texture src_texture
 			}
+		}
+	}
+}
+			=

+material terrain_multitex_mat2
+{
+	technique
+	{
+		pass
+		{
 		}
 	}
 }

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Tue Dec 25 02:28:48 2007
@@ -1,7 +1,12 @@
 -- handles multitexture-terrain
 -- see also src/terrain_multitex.cpp
 =

-kTerrainMultiTexMatName =3D "terrain_multitex_mat"
+kTerrainMultiTexMatName			=3D "terrain_multitex_mat" -- see data/terrain/m=
aterial/
+kTerrainMultiTexMatNameNoTrans	=3D "terrain_multitex_simple_mat" -- ugly, =
but faster
+
+function MultiTexTerrainGetMat () =

+	return gDisableMultiTexTerrainTransitions and kTerrainMultiTexMatNameNoTr=
ans or kTerrainMultiTexMatName
+end
 =

 gTerrain_MultiTexTypes =3D {}
 gTerrain_MultiTexTypes.grass		=3D {3,4,5,6,59,60,61,62,125,126,127,192,193=
,194,195,216,217,218,219,420,421,422,423,561,562,563,564,569,570,571,572,57=
3,574,575,576,577,578,579,879,880,881,882,883,884,885,886,891,892,893,894,9=
59,960,961,962,963,964,965,966,971,972,973,974,1401,1402,1403,1404,1405,140=
6,1407,1408,1419,1420,1495,1496,1497,1498,1499,1500,1501,1502,1507,1508,150=
9,1510,1661,1662,1663,1664,1665,1666,1667,1668,1673,1674,1675,1676,1685,168=
6,1687,1688,1689,1690,1691,1692,1697,1698,1699,1700,1717,1718,1719,1720,172=
1,1722,1727,1728,1729,1730,1746,1747,1748,1749,1750,1751,1752,1753,1758,175=
9,1760,1761}
@@ -49,11 +54,20 @@
 	-- TerrainMultiTex_AddTexCoordSet (int iMode,float tx,float ty,float tw,f=
loat th)  -- 0:ground,1:mainmask,2:mask
 	local e =3D 1/4
 	local f =3D e/4
-	TerrainMultiTex_AddTexCoordSet(0, 0*e,0*e,f,f) =

-	TerrainMultiTex_AddTexCoordSet(0, 1*e,0*e,f,f) =

+	=

+	--~ TerrainMultiTex_AddTexCoordSet(0, 0*e,0*e,f,f)
+	--~ TerrainMultiTex_AddTexCoordSet(0, 1*e,0*e,f,f)
 	TerrainMultiTex_AddTexCoordSet(1, 3*e,3*e,e,e) -- mainmask
 	TerrainMultiTex_AddTexCoordSet(2, 1*e,3*e,e,e) -- mask
-	TerrainMultiTex_SetGroundMaterialTypeLookUp({}) =

+	local mylookup =3D {}
+	for k1,name in pairs(gMultiTextureAtlasList_Span) do =

+		local myid =3D k1 - 1
+		local x =3D math.mod(myid,4)
+		local y =3D math.floor(myid / 4)
+		for k2,uoid in pairs(gTerrain_MultiTexTypes[name]) do mylookup[uoid] =3D=
 myid end
+		TerrainMultiTex_AddTexCoordSet(0, x*e,y*e,f,f)
+	end
+	TerrainMultiTex_SetGroundMaterialTypeLookUp(mylookup) =

 end
 =

 function MultiTexTerrain_NotifyMapChange ()
@@ -77,7 +91,6 @@
 	if (gMultiTexTerrain_BX =3D=3D bx and gMultiTexTerrain_BY =3D=3D by) then=
 return end
 	gMultiTexTerrain_BX =3D bx
 	gMultiTexTerrain_BY =3D by
-	print("MultiTexTerrainStep",bx,by)
 	local r =3D 3
 	for k,gfx in pairs(gMultiTexTerrain_GfxList) do =

 		if (math.abs(gfx.bx - bx) > r or math.abs(gfx.by - by) > r) then
@@ -95,7 +108,7 @@
 			local x,y,z =3D gCurrentRenderer:UOPosToLocal((bx+dx)*8,(by+dy)*8,0)
 			gfx:SetPosition(x,y,z)
 			Gfx3D_SetMultiTexTerrain(gfx,gGroundBlockLoader,bx+dx,by+dy)
-			gfx:SetMaterial(kTerrainMultiTexMatName)
+			gfx:SetMaterial(MultiTexTerrainGetMat())
 			gMultiTexTerrain_GfxList[name] =3D gfx
 		end
 	end

Modified: trunk/src/scripting.iris.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.iris.cpp (original)
+++ trunk/src/scripting.iris.cpp Tue Dec 25 02:28:48 2007
@@ -306,11 +306,12 @@
 static int l_TerrainMultiTex_SetGroundMaterialTypeLookUp (lua_State *L) { =
PROFILE
 	enum { kLookUpSize =3D 0x4000 };
 	int myLookUp[kLookUpSize];
+	bool bFirstParamOk =3D lua_istable(L,1);
 	for (int i=3D0;i<0x4000;++i) {
 		myLookUp[i] =3D 0;
-		if (lua_istable(L,1)) { // table is at index 1
+		if (bFirstParamOk) { // table is at index 1
 			lua_rawgeti(L,1,i); // table is at index 1
-			if (lua_isnil(L,-1)) myLookUp[i] =3D (int)lua_tonumber(L,-1);
+			if (!lua_isnil(L,-1)) myLookUp[i] =3D (int)lua_tonumber(L,-1);
 			lua_pop(L,1); // pop 1 elements
 		}
 	}

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Tue Dec 25 02:28:48 2007
@@ -340,8 +340,9 @@
 }
 =

 void	 TerrainMultiTex_SetGroundMaterialTypeLookUp	(const int* piValues,con=
st int iCount) {
-	for (int i=3D0;i<cTiledMultiTexTerrain<8>::kGroundMatLookUpSize;++i)
+	for (int i=3D0;i<cTiledMultiTexTerrain<8>::kGroundMatLookUpSize;++i) {
 		gTiledMultiTexTerrain.mGroundMaterialTypeLookUp[i] =3D (i<iCount) ? piVa=
lues[i] : 0;
+	}
 }
 =

 void	 TerrainMultiTex_AddTexCoordSet		(int iMode,float tx,float ty,float t=
w,float th) {



From no-reply at zwischenwelt.org  Tue Dec 25 02:29:48 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Dec 2007 01:29:48 -0000
Subject: [Iris-commit] [IRIS] r1683 - in /trunk/lua: lib.3d.dynamic.lua
	lib.data.lua
Message-ID: <20071225012948.7D0481C186B9@zwischenwelt.org>

Author: hagish
Date: Tue Dec 25 02:29:47 2007
New Revision: 1683

Log:
small dynamic hueing changes

Modified:
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.data.lua

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Tue Dec 25 02:29:47 2007
@@ -110,12 +110,19 @@
 	else
 		-- normal 1 part object
 		item.gfx =3D CreateRootGfx3D()
-		local meshname =3D (not gForceFallBackBillboards_Dynamics) and GetStatic=
MeshName(item.artid,item.hue)
+		local meshname =3D (not gForceFallBackBillboards_Dynamics) and GetStatic=
MeshName(item.artid) -- ,item.hue)
 		if (meshname and meshname ~=3D false) then
 			item.gfx:SetMesh(meshname)
 			item.gfx:SetScale(-1,1,1)		-- (-1) thats because xmirror bug and wrong =
mirrored mashes
 			item.gfx:SetNormaliseNormals(true)
 =

+			-- primary color hueing
+			if gHueLoader and item.hue > 0 then
+				local r,g,b =3D gHueLoader:GetColor(item.hue - 1,31) -- get first color
+				print("DEBUG","hue",r,g,b)
+				HueMeshEntity(item.gfx,r,g,b,r,g,b)
+			end
+			=

 			-- --------------------------------------------------------------------=
-----
 			-- todo: HACK here (zadd because dynamic street-tiles dont look good (f=
lying)
 			-- groundtiles and item billboards shouldn't cast shadows

Modified: trunk/lua/lib.data.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.data.lua (original)
+++ trunk/lua/lib.data.lua Tue Dec 25 02:29:47 2007
@@ -144,7 +144,7 @@
 =

 -- GetArtSize from gArtMatCache or generateSize
 function GetArtSize (iArtID,iHue)
-	if (not(iHue) or (iHue > gMaxHueValue)) then iHue=3D0 end
+	if (not(iHue) or (tonumber(iHue) > gMaxHueValue)) then iHue=3D0 end
 	local res =3D gArtMatCache[iArtID.."_"..iHue]
 =

 	if (not res and gArtMapLoader) then



From no-reply at zwischenwelt.org  Tue Dec 25 02:33:22 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Dec 2007 01:33:22 -0000
Subject: [Iris-commit] [IRIS] r1684 - /trunk/lua/lib.3d.dynamic.lua
Message-ID: <20071225013322.D3E6A1C186B9@zwischenwelt.org>

Author: hagish
Date: Tue Dec 25 02:33:21 2007
New Revision: 1684

Log:
removed debug output

Modified:
    trunk/lua/lib.3d.dynamic.lua

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Tue Dec 25 02:33:21 2007
@@ -119,7 +119,6 @@
 			-- primary color hueing
 			if gHueLoader and item.hue > 0 then
 				local r,g,b =3D gHueLoader:GetColor(item.hue - 1,31) -- get first color
-				print("DEBUG","hue",r,g,b)
 				HueMeshEntity(item.gfx,r,g,b,r,g,b)
 			end
 			=




From no-reply at zwischenwelt.org  Tue Dec 25 02:44:40 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Dec 2007 01:44:40 -0000
Subject: [Iris-commit] [IRIS] r1685 - /trunk/lua/net.other.lua
Message-ID: <20071225014440.1024C1C186B9@zwischenwelt.org>

Author: hagish
Date: Tue Dec 25 02:44:39 2007
New Revision: 1685

Log:
small cosmetic changes (removed :)

Modified:
    trunk/lua/net.other.lua

Modified: trunk/lua/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net.other.lua (original)
+++ trunk/lua/net.other.lua Tue Dec 25 02:44:39 2007
@@ -426,7 +426,13 @@
 	=

 	-- TODO : Display as TOOLTIP !
 	plaintext =3D UnicodeFix(plaintext)
-	AddFadeLines(sprintf("%s: %s",text_charname,plaintext)) -- TODO : color,f=
ont,...
+	=

+	if string.len(text_charname) > 0 then =

+		AddFadeLines(sprintf("%s: %s",text_charname,plaintext)) -- TODO : color,=
font,...
+	else
+		AddFadeLines(plaintext) -- TODO : color,font,...
+	end
+	=

 	JournalAddText(text_charname,plaintext)
 	NotifyListener("Hook_Text",text_charname,plaintext)
 end



From no-reply at zwischenwelt.org  Tue Dec 25 15:54:10 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Dec 2007 14:54:10 -0000
Subject: [Iris-commit] [IRIS] r1686 - in /trunk: ./ data/terrain/materials/
 data/terrain/multitex/ include/ lua/ src/
Message-ID: <20071225145413.ED9741C1868F@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Dec 25 15:54:07 2007
New Revision: 1686

Log:
multitexturing terrain transitions are working

Added:
    trunk/data/terrain/multitex/terrain_multitex_mask_64_blur_man.hard.png =
  (with props)
Modified:
    trunk/data/terrain/materials/terrain.material
    trunk/data/terrain/multitex/terrain_multitex_mask_64_blur_man.png
    trunk/include/terrain.h
    trunk/lua/lib.terrain.multitex.lua
    trunk/mask_rotmir.php
    trunk/src/scripting.iris.cpp
    trunk/src/terrain_multitex.cpp

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Tue Dec 25 15:54:07 2007
@@ -172,7 +172,8 @@
 			//alpha_rejection greater 0
 			texture_unit
 			{
-				texture terrain_tex_atlas_512.png
+				// draws ground and applies diffuse lighting
+				texture terrain_tex_atlas_1024.png
 				tex_coord_set	0
 				colour_op_ex	modulate src_texture src_diffuse
 			}
@@ -190,41 +191,35 @@
 			//alpha_rejection greater 0
 			texture_unit
 			{
-				texture terrain_tex_atlas_512.png
+				// draws ground at full brightness
+				texture terrain_tex_atlas_1024.png
 				tex_coord_set	0
 				colour_op_ex	source1 src_texture src_texture
 			}
-			texture_unit
-			{
+			texture_unit =

+			{
+				// loads transition mask into alpha channel
 				texture terrain_multitex_mask_64_blur_man.png alpha
-				tex_coord_set 3
+				tex_coord_set 1
 				colour_op_ex	source1 src_current src_current
 				alpha_op_ex		source1 src_texture src_texture
 			}
 			texture_unit
 			{
-				texture terrain_tex_atlas_512.png
+				// loads secondardy ground and blends it using transition mask
+				texture terrain_tex_atlas_1024.png
 				tex_coord_set 2
 				colour_op_ex	blend_current_alpha src_texture src_current
-				alpha_op_ex		source1 src_current src_current
+				// alpha_op_ex		source1 src_current src_current
 			}
 			texture_unit
 			{
-				texture terrain_multitex_mask_64_blur_man.png alpha
-				tex_coord_set 1
+				// applies diffuse lighting
+				// texture terrain_multitex_mask_64_blur_man.png alpha
+				// tex_coord_set 3
 				colour_op_ex	modulate src_current src_diffuse
-				alpha_op_ex		source1 src_texture src_texture
-			}
-		}
-	}
-}
-			=

-material terrain_multitex_mat2
-{
-	technique
-	{
-		pass
-		{
+				// alpha_op_ex		source1 src_texture src_texture
+			}
 		}
 	}
 }

Modified: trunk/data/terrain/multitex/terrain_multitex_mask_64_blur_man.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/include/terrain.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/terrain.h (original)
+++ trunk/include/terrain.h Tue Dec 25 15:54:07 2007
@@ -16,5 +16,5 @@
 void	 		TerrainMultiTexWrite		(cGroundBlockLoader* pGroundBlockLoader,cons=
t int iBlockX,const int iBlockY,Lugre::cRobRenderOp& pRobRenderOp);
 void	 		TerrainMultiTex_SetGroundMaterialTypeLookUp	(const int* piValues,c=
onst int iCount);
 void			TerrainMultiTex_AddTexCoordSet				(int iMode,float tx,float ty,floa=
t tw,float th); ///< 0:ground,1:mainmask,2:mask
-
+void			TerrainMultiTex_AddMaskTexCoordSet			(float u1,float v1, float u2,f=
loat v2, float u3,float v3, float u4,float v4);
 #endif

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Tue Dec 25 15:54:07 2007
@@ -51,14 +51,14 @@
 function MultiTexTerrainInit ()
 	if (not gEnableMultiTexTerrain) then return end
 	=

-	-- TerrainMultiTex_AddTexCoordSet (int iMode,float tx,float ty,float tw,f=
loat th)  -- 0:ground,1:mainmask,2:mask
+	-- TerrainMultiTex_AddTexCoordSet (iMode,tx,ty,tw,th)  -- 0:ground,1:main=
mask,2:mask
 	local e =3D 1/4
 	local f =3D e/4
 	=

+	=

+	-- TexCoordSet 0 : ground
 	--~ TerrainMultiTex_AddTexCoordSet(0, 0*e,0*e,f,f)
 	--~ TerrainMultiTex_AddTexCoordSet(0, 1*e,0*e,f,f)
-	TerrainMultiTex_AddTexCoordSet(1, 3*e,3*e,e,e) -- mainmask
-	TerrainMultiTex_AddTexCoordSet(2, 1*e,3*e,e,e) -- mask
 	local mylookup =3D {}
 	for k1,name in pairs(gMultiTextureAtlasList_Span) do =

 		local myid =3D k1 - 1
@@ -67,6 +67,82 @@
 		for k2,uoid in pairs(gTerrain_MultiTexTypes[name]) do mylookup[uoid] =3D=
 myid end
 		TerrainMultiTex_AddTexCoordSet(0, x*e,y*e,f,f)
 	end
+	=

+	-- TexCoordSet 1 : main mask
+	if (true) then
+		TerrainMultiTex_AddTexCoordSet(1, 3*e,3*e,e,e) -- mainmask
+	end
+	=

+	=

+	-- TexCoordSet 2 : masks
+	if (true) then
+		local myarr =3D {}
+		myarr[0]        =3D { 0,{}}
+		myarr[1]        =3D { 1,{[64]=3D"L1",[16]=3D"L2",[4]=3D"L3",}}
+		myarr[5]        =3D { 2,{[65]=3D"L1",[80]=3D"L2",[20]=3D"L3",}}
+		myarr[7]        =3D { 3,{[193]=3D"L1",[112]=3D"L2",[28]=3D"L3",}}
+		myarr[17]       =3D { 4,{[68]=3D"L1",}}
+		myarr[21]       =3D { 5,{[69]=3D"L1",[81]=3D"L2",[84]=3D"L3",}}
+		myarr[23]       =3D { 6,{[197]=3D"L1",[113]=3D"L2",[92]=3D"L3",[71]=3D"M=
X",[116]=3D"MY",[29]=3D"L1MX",[209]=3D"L1MY",}}
+		myarr[31]       =3D { 7,{[199]=3D"L1",[241]=3D"L2",[124]=3D"L3",}}
+		myarr[85]       =3D { 8,{}}
+		myarr[87]       =3D { 9,{[213]=3D"L1",[117]=3D"L2",[93]=3D"L3",}}
+		myarr[95]       =3D {10,{[215]=3D"L1",[245]=3D"L2",[125]=3D"L3",}}
+		myarr[119]      =3D {11,{[221]=3D"L1",}}
+		myarr[127]      =3D {12,{[223]=3D"L1",[247]=3D"L2",[253]=3D"L3",}}
+		myarr[255]      =3D {13,{}}
+		=

+		=

+		function RotL		(u1,v1, u2,v2, u3,v3, u4,v4) return u2,v2, u4,v4, u1,v1, =
u3,v3 end
+		function RotR		(u1,v1, u2,v2, u3,v3, u4,v4) return u3,v3, u1,v1, u4,v4, =
u2,v2 end
+		function MirrorX	(u1,v1, u2,v2, u3,v3, u4,v4) return u2,v2, u1,v1, u4,v4=
, u3,v3 end
+		function MirrorY	(u1,v1, u2,v2, u3,v3, u4,v4) return u3,v3, u4,v4, u1,v1=
, u2,v2 end
+		=

+		local u1,v1, u2,v2, u3,v3, u4,v4 =3D 1,2,3,4,5,6,7,8
+		for k,v in pairs({MirrorX(MirrorX(u1,v1, u2,v2, u3,v3, u4,v4))}) 				do =
assert(k=3D=3Dv) end
+		for k,v in pairs({MirrorY(MirrorY(u1,v1, u2,v2, u3,v3, u4,v4))}) 				do =
assert(k=3D=3Dv) end
+		for k,v in pairs({RotL(RotR(u1,v1, u2,v2, u3,v3, u4,v4))}) 						do asse=
rt(k=3D=3Dv) end
+		for k,v in pairs({RotL(RotL(RotL(RotL(u1,v1, u2,v2, u3,v3, u4,v4))))}) 	=
		do assert(k=3D=3Dv) end
+		for k,v in pairs({MirrorX(MirrorY(RotL(RotL(u1,v1, u2,v2, u3,v3, u4,v4))=
))})	do assert(k=3D=3Dv) end
+		=

+		=

+		local mycoords =3D {}
+		for code,data in pairs(myarr) do
+			local maskindex,derivates =3D unpack(data)
+			local x =3D math.mod(maskindex,4)
+			local y =3D math.floor(maskindex / 4)
+			local u,v =3D x*e,y*e
+			local u1,v1, u2,v2, u3,v3, u4,v4 =3D u,v, u+e,v, u,v+e, u+e,v+e
+			mycoords[code] =3D {u1,v1, u2,v2, u3,v3, u4,v4}
+			for code2,transform in pairs(derivates) do
+				local coords
+				if (transform =3D=3D "L1")		then coords =3D {	RotL(				u1,v1, u2,v2, u=
3,v3, u4,v4)		} end
+				if (transform =3D=3D "L2")		then coords =3D {	RotL(RotL(			u1,v1, u2,v=
2, u3,v3, u4,v4))	} end
+				if (transform =3D=3D "L3")		then coords =3D {	RotL(RotL(RotL(		u1,v1, =
u2,v2, u3,v3, u4,v4)))	} end
+				if (transform =3D=3D "MX")		then coords =3D {	MirrorX(			u1,v1, u2,v2,=
 u3,v3, u4,v4)		} end
+				if (transform =3D=3D "MY")		then coords =3D {	MirrorY(			u1,v1, u2,v2,=
 u3,v3, u4,v4)		} end
+				if (transform =3D=3D "L1MX")	then coords =3D {	MirrorX(RotL(		u1,v1, u=
2,v2, u3,v3, u4,v4))	} end
+				if (transform =3D=3D "L1MY")	then coords =3D {	MirrorY(RotL(		u1,v1, u=
2,v2, u3,v3, u4,v4))	} end
+				mycoords[code2] =3D coords
+			end
+		end
+		=

+		function MaskFlag (posnum)		return math.pow(2,posnum) end -- =3D 1 << po=
snum
+		function MaskTest (a,posnum)	return BitwiseAND(a,MaskFlag(posnum)) ~=3D =
0 end
+		for i=3D0,255 do
+			--~ 0 1 1 2 =

+			--~ 7     3
+			--~ 7     3
+			--~ 6 5 5 4  =

+			local code =3D i
+			if (MaskTest(code,1)) then code =3D BitwiseOR(code,MaskFlag(0) + MaskFl=
ag(2)) end
+			if (MaskTest(code,5)) then code =3D BitwiseOR(code,MaskFlag(6) + MaskFl=
ag(4)) end
+			if (MaskTest(code,3)) then code =3D BitwiseOR(code,MaskFlag(2) + MaskFl=
ag(4)) end
+			if (MaskTest(code,7)) then code =3D BitwiseOR(code,MaskFlag(0) + MaskFl=
ag(6)) end
+			TerrainMultiTex_AddMaskTexCoordSet(unpack(mycoords[code]))
+		end
+	end
+	=

 	TerrainMultiTex_SetGroundMaterialTypeLookUp(mylookup) =

 end
 =


Modified: trunk/mask_rotmir.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/mask_rotmir.php (original)
+++ trunk/mask_rotmir.php Tue Dec 25 15:54:07 2007
@@ -135,8 +135,8 @@
 =

 echo count($bases)."\n";
 foreach ($bases as $base =3D> $arr) {
-	$s =3D sprintf("0x%02x",$base)." -> {";
-	foreach ($arr as $b =3D> $transform) $s .=3D sprintf("0x%02x",$b) . ":". =
$transform.",";
+	$s =3D sprintf("myarr[%d]\t=3D {",$base);
+	foreach ($arr as $b =3D> $transform) $s .=3D sprintf('[%d]=3D"%s",',$b,$t=
ransform);
 	$s .=3D "}\n";
 	echo $s;
 }
@@ -144,22 +144,20 @@
 exit(0);
 =

 /*
-14
-0x00 -> {}
-0x01 -> {0x40:L1,0x10:L2,0x04:L3,}
-0x05 -> {0x41:L1,0x50:L2,0x14:L3,}
-0x07 -> {0xc1:L1,0x70:L2,0x1c:L3,}
-0x11 -> {0x44:L1,}
-0x15 -> {0x45:L1,0x51:L2,0x54:L3,}
-0x17 -> {0xc5:L1,0x71:L2,0x5c:L3,0x47:MX,0x74:MY,0x1d:L1MX,0xd1:L1MY,}
-0x1f -> {0xc7:L1,0xf1:L2,0x7c:L3,}
-0x55 -> {}
-0x57 -> {0xd5:L1,0x75:L2,0x5d:L3,}
-0x5f -> {0xd7:L1,0xf5:L2,0x7d:L3,}
-0x77 -> {0xdd:L1,}
-0x7f -> {0xdf:L1,0xf7:L2,0xfd:L3,}
-0xff -> {}
-
+myarr[0]        =3D {}
+myarr[1]        =3D {[64]=3D"L1",[16]=3D"L2",[4]=3D"L3",}
+myarr[5]        =3D {[65]=3D"L1",[80]=3D"L2",[20]=3D"L3",}
+myarr[7]        =3D {[193]=3D"L1",[112]=3D"L2",[28]=3D"L3",}
+myarr[17]       =3D {[68]=3D"L1",}
+myarr[21]       =3D {[69]=3D"L1",[81]=3D"L2",[84]=3D"L3",}
+myarr[23]       =3D {[197]=3D"L1",[113]=3D"L2",[92]=3D"L3",[71]=3D"MX",[11=
6]=3D"MY",[29]=3D"L1MX",[209]=3D"L1MY",}
+myarr[31]       =3D {[199]=3D"L1",[241]=3D"L2",[124]=3D"L3",}
+myarr[85]       =3D {}
+myarr[87]       =3D {[213]=3D"L1",[117]=3D"L2",[93]=3D"L3",}
+myarr[95]       =3D {[215]=3D"L1",[245]=3D"L2",[125]=3D"L3",}
+myarr[119]      =3D {[221]=3D"L1",}
+myarr[127]      =3D {[223]=3D"L1",[247]=3D"L2",[253]=3D"L3",}
+myarr[255]      =3D {}
 */
 =

 $basedir =3D "mymask/";

Modified: trunk/src/scripting.iris.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.iris.cpp (original)
+++ trunk/src/scripting.iris.cpp Tue Dec 25 15:54:07 2007
@@ -320,7 +320,7 @@
 }
 =

 /// for lua : void	TerrainMultiTex_AddTexCoordSet (int iMode,float tx,floa=
t ty,float tw,float th) =

-/// 0:ground,1:mainmask,2:mask
+/// 0:ground,1:mainmask
 static int l_TerrainMultiTex_AddTexCoordSet (lua_State *L) { PROFILE
 	int iMode =3D luaL_checkint(L,1);
 	float tx =3D luaL_checknumber(L,2);
@@ -328,6 +328,21 @@
 	float tw =3D luaL_checknumber(L,4);
 	float th =3D luaL_checknumber(L,5);
 	TerrainMultiTex_AddTexCoordSet(iMode,tx,ty,tw,th);
+	return 0;
+}
+
+/// for lua : void	TerrainMultiTex_AddMaskTexCoordSet (u1,v1, u2,v2, u3,v3=
, u4,v4)
+/// 1:left-top 2:right-top 3:left-bottom 4:right-bottom
+static int l_TerrainMultiTex_AddMaskTexCoordSet (lua_State *L) { PROFILE
+	float u1 =3D luaL_checknumber(L,1);
+	float v1 =3D luaL_checknumber(L,2);
+	float u2 =3D luaL_checknumber(L,3);
+	float v2 =3D luaL_checknumber(L,4);
+	float u3 =3D luaL_checknumber(L,5);
+	float v3 =3D luaL_checknumber(L,6);
+	float u4 =3D luaL_checknumber(L,7);
+	float v4 =3D luaL_checknumber(L,8);
+	TerrainMultiTex_AddMaskTexCoordSet(u1,v1, u2,v2, u3,v3, u4,v4);
 	return 0;
 }
 	=

@@ -413,6 +428,7 @@
 			lua_register(L,"Gfx3D_SetMultiTexTerrain",		l_Gfx3D_SetMultiTexTerrain);
 			lua_register(L,"TerrainMultiTex_SetGroundMaterialTypeLookUp",	l_Terrain=
MultiTex_SetGroundMaterialTypeLookUp);
 			lua_register(L,"TerrainMultiTex_AddTexCoordSet",				l_TerrainMultiTex_A=
ddTexCoordSet);
+			lua_register(L,"TerrainMultiTex_AddMaskTexCoordSet",			l_TerrainMultiTe=
x_AddMaskTexCoordSet);
 			lua_register(L,"TerrainRayPick",				l_TerrainRayPick);
 			lua_register(L,"GetUOPath",						l_getUOPath);
 			lua_register(L,"PathSearch",					l_PathSearch);

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Tue Dec 25 15:54:07 2007
@@ -118,30 +118,36 @@
 		*++w =3D temp[1];
 		*++w =3D temp[2];
 			=

-		// write texcoords 1 : spanning of type_main
+		// write texcoords 0 : spanning of type_main
 		temp =3D GetTexCoordInfo_GroundMaterialType(iMainType);
 		*++w =3D temp[0] + (spanx+dx)*temp[2];
 		*++w =3D temp[1] + (spany+dy)*temp[3];
 			=

-		// write texcoords 2 : mask_main
+		// write texcoords 1 : mask_a
+		temp =3D GetTexCoordInfo_Mask(iMaskA);
+		//~ #ifdef XMIRROR  // shouldn't be neccessary, as the vertex pos is alr=
eady mirrored
+		//~ *++w =3D temp[idy*4+(1-idx)*2+0];
+		//~ *++w =3D temp[idy*4+(1-idx)*2+1];
+		//~ #else
+		*++w =3D temp[idy*4+idx*2+0];
+		*++w =3D temp[idy*4+idx*2+1];
+		//~ #endif
+			=

+		// write texcoords 2 : spanning of type_a
+		temp =3D GetTexCoordInfo_GroundMaterialType(iTypeA);
+		*++w =3D temp[0] + (spanx+dx)*temp[2];
+		*++w =3D temp[1] + (spany+dy)*temp[3];
+		=

+		// write texcoords 3 : mask_main (currently unused, can be used to leave=
 terrain parts out using alpha-reject)
 		temp =3D GetTexCoordInfo_MainMask(iMainMask);
 		*++w =3D temp[0] + dx*temp[2];
 		*++w =3D temp[1] + dy*temp[3];
-			=

-		// write texcoords 3 : spanning of type_a
-		temp =3D GetTexCoordInfo_GroundMaterialType(iTypeA);
-		*++w =3D temp[0] + (spanx+dx)*temp[2];
-		*++w =3D temp[1] + (spany+dy)*temp[3];
-		=

-		// write texcoords 4 : mask_a
-		temp =3D GetTexCoordInfo_Mask(iMaskA);
-		*++w =3D temp[0] + dx*temp[2];
-		*++w =3D temp[1] + dy*temp[3];
+		=

 	}
 	=

 	inline float*	GetTexCoordInfo_GroundMaterialType	(const int iID) { return=
 &mTexCoords_Ground[	iID*4]; }
 	inline float*	GetTexCoordInfo_MainMask			(const int iID) { return &mTexCo=
ords_MainMask[	iID*4]; }
-	inline float*	GetTexCoordInfo_Mask				(const int iID) { return &mTexCoord=
s_Mask[		iID*4]; }
+	inline float*	GetTexCoordInfo_Mask				(const int iID) { return &mTexCoord=
s_Mask[		iID*8]; }
 	=

 	=

 	void	WriteToRobRenderOp (cGroundBlockLoader* pGroundBlockLoader,int bx,in=
t by,cRobRenderOp& pRobRenderOp) {
@@ -244,8 +250,8 @@
 		for (x=3D0;x<T;++x) {
 			iMainType	=3D GetType(x,y);
 			iMainMask	=3D 0; // IsTerrainTypeNodraw(iMainType) ? 1 : 0; // 0=3Dfull=
y visible, 1=3Dfully transparent (nodraw tiles)
-			iTypeA		=3D 1; // GetMostFrequentNeighboorType(x,y,iMainType);
-			iMaskA		=3D 0; // (iTypeA =3D=3D iMainType) ? 0 : GenerateTransitionMas=
k(x,y,iTypeA);
+			iTypeA		=3D GetMostFrequentNeighboorType(x,y,iMainType);
+			iMaskA		=3D (iTypeA =3D=3D iMainType) ? 0 : GenerateTransitionMask(x,y,=
iTypeA);
 			spanx =3D float(x % 4);
 			spany =3D float(y % 4);
 			=

@@ -269,7 +275,7 @@
 			if (dx =3D=3D 0 && dy =3D=3D 0) continue;
 			// add type to counter
 			iCurType =3D GetType(x+dx,y+dy);
-			if (iCurType !=3D iMainType) {
+			if (iCurType > iMainType) {
 				for (i=3D0;i<myNumTypes;++i) if (myTypes[i] =3D=3D iCurType) { ++myCou=
nts[i]; break; }
 				if (i >=3D myNumTypes) { // loop above finished without break
 					myTypes[ myNumTypes] =3D iCurType;
@@ -350,7 +356,7 @@
 	switch (iMode) { =

 		case 0: pTarget =3D &gTiledMultiTexTerrain.mTexCoords_Ground;		break;
 		case 1: pTarget =3D &gTiledMultiTexTerrain.mTexCoords_MainMask;	break;
-		case 2: pTarget =3D &gTiledMultiTexTerrain.mTexCoords_Mask;		break;
+		//~ case 2: pTarget =3D &gTiledMultiTexTerrain.mTexCoords_Mask;		break;
 	}
 	if (!pTarget) return;
 	pTarget->push_back(tx);
@@ -359,3 +365,13 @@
 	pTarget->push_back(th);
 }
 =

+void	TerrainMultiTex_AddMaskTexCoordSet			(float u1,float v1, float u2,flo=
at v2, float u3,float v3, float u4,float v4) {
+	gTiledMultiTexTerrain.mTexCoords_Mask.push_back(u1);
+	gTiledMultiTexTerrain.mTexCoords_Mask.push_back(v1);
+	gTiledMultiTexTerrain.mTexCoords_Mask.push_back(u2);
+	gTiledMultiTexTerrain.mTexCoords_Mask.push_back(v2);
+	gTiledMultiTexTerrain.mTexCoords_Mask.push_back(u3);
+	gTiledMultiTexTerrain.mTexCoords_Mask.push_back(v3);
+	gTiledMultiTexTerrain.mTexCoords_Mask.push_back(u4);
+	gTiledMultiTexTerrain.mTexCoords_Mask.push_back(v4);
+}



From no-reply at zwischenwelt.org  Tue Dec 25 18:35:25 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 25 Dec 2007 17:35:25 -0000
Subject: [Iris-commit] [IRIS] r1687 - in /trunk: ./ data/terrain/multitex/
 data/terrain/multitex/parts/ lua/
Message-ID: <20071225173525.CA2D51C186D8@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Dec 25 18:35:23 2007
New Revision: 1687

Log:
fixed atlas-related border artifacts, generated new atlas 1024 and 2048

Added:
    trunk/data/terrain/multitex/parts/
    trunk/data/terrain/multitex/parts/0_grass.png   (with props)
    trunk/data/terrain/multitex/parts/0_grass_num.png   (with props)
    trunk/data/terrain/multitex/parts/1_dirt.png   (with props)
    trunk/data/terrain/multitex/parts/2_rock.png   (with props)
    trunk/data/terrain/multitex/parts/3_sand.png   (with props)
    trunk/data/terrain/multitex/parts/4_forest.png   (with props)
    trunk/data/terrain/multitex/parts/5_jungle.png   (with props)
    trunk/data/terrain/multitex/parts/6_cobblestones.png   (with props)
    trunk/data/terrain/multitex/parts/7_snow.png   (with props)
    trunk/data/terrain/multitex/parts/8_void.png   (with props)
    trunk/makemultitex.php
Modified:
    trunk/data/terrain/multitex/terrain_tex_atlas_1024.png
    trunk/data/terrain/multitex/terrain_tex_atlas_2048.png
    trunk/lua/lib.terrain.multitex.lua

Modified: trunk/data/terrain/multitex/terrain_tex_atlas_1024.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/terrain/multitex/terrain_tex_atlas_2048.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Tue Dec 25 18:35:23 2007
@@ -54,6 +54,7 @@
 	-- TerrainMultiTex_AddTexCoordSet (iMode,tx,ty,tw,th)  -- 0:ground,1:main=
mask,2:mask
 	local e =3D 1/4
 	local f =3D e/4
+	local b =3D 8/1024 -- 4 pixel border on each side for the 1024 texture
 	=

 	=

 	-- TexCoordSet 0 : ground
@@ -65,7 +66,8 @@
 		local x =3D math.mod(myid,4)
 		local y =3D math.floor(myid / 4)
 		for k2,uoid in pairs(gTerrain_MultiTexTypes[name]) do mylookup[uoid] =3D=
 myid end
-		TerrainMultiTex_AddTexCoordSet(0, x*e,y*e,f,f)
+		=

+		TerrainMultiTex_AddTexCoordSet(0, x*e+b,y*e+b,(e-b-b)/4,(e-b-b)/4)
 	end
 	=

 	-- TexCoordSet 1 : main mask



From no-reply at zwischenwelt.org  Wed Dec 26 15:36:59 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 26 Dec 2007 14:36:59 -0000
Subject: [Iris-commit] [IRIS] r1688 - in /trunk/data/models/models:
 generate_alpha_tex_atlas.php generate_tex_atlas.php
Message-ID: <20071226143659.31D2B1C186F7@zwischenwelt.org>

Author: hagish
Date: Wed Dec 26 15:36:58 2007
New Revision: 1688

Log:
some fixes in the texture atlas generation scripts

Modified:
    trunk/data/models/models/generate_alpha_tex_atlas.php
    trunk/data/models/models/generate_tex_atlas.php

Modified: trunk/data/models/models/generate_alpha_tex_atlas.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_alpha_tex_atlas.php (original)
+++ trunk/data/models/models/generate_alpha_tex_atlas.php Wed Dec 26 15:36:=
58 2007
@@ -116,8 +116,8 @@
 =

 		$r =3D array();
 		if(!$skip && eregi('texcoord u=3D"([^"]+)" v=3D"([^"]+)"',$line,$r)){
-			$u =3D $r[1];
-			$v =3D $r[2];
+			$u =3D max(0,$r[1]);
+			$v =3D min(1,$r[2]);
 			=

 			$x =3D $u * $meshw;
 			$y =3D $v * $meshh;
@@ -154,8 +154,11 @@
 }
 =

 function AlphaBackground($im){
-	$color_alpha =3D imagecolorallocate($im, 255, 0, 150);
-	imagefilledrectangle($im, 0, 0, imagesx($im), imagesy($im), $color_alpha);
+	//$color_alpha =3D imagecolorallocatealpha($im, 255, 0, 150, 127);
+	//imagealphablending($im,false);
+	//imagesavealpha($im,true);
+	//imagecolortransparent($im,$color_alpha);
+	//imagefilledrectangle($im, 0, 0, imagesx($im), imagesy($im), $color_alph=
a);
 }
 =

 // ####################################################################
@@ -181,6 +184,11 @@
 		if(substr_count($mat,"uo_art_") > 0)continue;
 	=

 		list($minu,$minv,$maxu,$maxv) =3D GetUVBorders($l,$mat);
+		=

+		$minu =3D max(0,$minu);
+		$minv =3D max(0,$minv);
+		$maxu =3D min(1,$maxu);
+		$maxv =3D min(1,$maxv);
 =

 		echo "file=3D$f\tmaterial: $mat\tuv: $minu,$minv,$maxu,$maxv\t";
 		if($minu >=3D 0 && $maxu <=3D 1 && $minv >=3D 0 && $maxv <=3D 1){
@@ -318,9 +326,9 @@
 // generate material script
 $f =3D fopen("alpha_tex_atlas.material","w");
 for($i=3D0;$i<=3D$number;++$i){
-	$name =3D "tex_atlas_$i";
-	$base =3D "tex_alpha_base";
-	$img =3D "tex_atlas_$i.png";
+	$name =3D "alpha_tex_atlas_$i";
+	$base =3D "tex_base_alpha";
+	$img =3D "alpha_tex_atlas_$i.png";
 	=

 	fwrite($f,"material $name : $base \n{ \n	technique \n	{ \n		pass\n		{		\n=
			texture_unit \n			{ \n				texture $img \n			}	\n		}\n	} \n}\n");
 }

Modified: trunk/data/models/models/generate_tex_atlas.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_tex_atlas.php (original)
+++ trunk/data/models/models/generate_tex_atlas.php Wed Dec 26 15:36:58 2007
@@ -116,8 +116,8 @@
 =

 		$r =3D array();
 		if(!$skip && eregi('texcoord u=3D"([^"]+)" v=3D"([^"]+)"',$line,$r)){
-			$u =3D $r[1];
-			$v =3D $r[2];
+			$u =3D max(0,$r[1]);
+			$v =3D min(1,$r[2]);
 			=

 			$x =3D $u * $meshw;
 			$y =3D $v * $meshh;
@@ -176,6 +176,11 @@
 		if(substr_count($mat,"uo_art_") > 0)continue;
 	=

 		list($minu,$minv,$maxu,$maxv) =3D GetUVBorders($l,$mat);
+		=

+		$minu =3D max(0,$minu);
+		$minv =3D max(0,$minv);
+		$maxu =3D min(1,$maxu);
+		$maxv =3D min(1,$maxv);
 =

 		echo "file=3D$f\tmaterial: $mat\tuv: $minu,$minv,$maxu,$maxv\t";
 		if($minu >=3D 0 && $maxu <=3D 1 && $minv >=3D 0 && $maxv <=3D 1){



From no-reply at zwischenwelt.org  Wed Dec 26 21:46:40 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 26 Dec 2007 20:46:40 -0000
Subject: [Iris-commit] [IRIS] r1689 - in /trunk/data/models/models:
 generate_alpha_tex_atlas.php generate_tex_atlas.php tomesh.sh toxml.sh
Message-ID: <20071226204640.CD03A1C186F7@zwischenwelt.org>

Author: hagish
Date: Wed Dec 26 21:46:39 2007
New Revision: 1689

Log:
improved speed

Modified:
    trunk/data/models/models/generate_alpha_tex_atlas.php
    trunk/data/models/models/generate_tex_atlas.php
    trunk/data/models/models/tomesh.sh
    trunk/data/models/models/toxml.sh

Modified: trunk/data/models/models/generate_alpha_tex_atlas.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_alpha_tex_atlas.php (original)
+++ trunk/data/models/models/generate_alpha_tex_atlas.php Wed Dec 26 21:46:=
39 2007
@@ -9,8 +9,8 @@
 	$skip =3D true;
 	=

 	foreach($l as $line){ =

-		if(eregi('</submesh>',$line))$skip =3D true;
-		else if(eregi('submesh material=3D"([^"]+)"',$line,$r)){
+		if(strpos($line,'</submesh>') !=3D=3D false)$skip =3D true;
+		else if(eregi('^<submesh material=3D"([^"]+)"',trim($line),$r)){
 			// material check
 			if($mat =3D=3D $r[1])$skip =3D false;
 		}
@@ -108,8 +108,8 @@
 	$l =3D file($mesh);
 	=

 	foreach($l as $line){
-		if(eregi('</submesh>',$line))$skip =3D true;
-		else if(eregi('submesh material=3D"([^"]+)"',$line,$r)){
+		if(strpos($line,'</submesh>') !=3D=3D false)$skip =3D true;
+		else if(eregi('<submesh material=3D"([^"]+)"',$line,$r)){
 			// material check
 			if($mat =3D=3D $r[1])$skip =3D false;
 		}
@@ -181,18 +181,21 @@
 	$materials =3D GetMaterials($l);
 	=

 	foreach($materials as $mat){
-		if(substr_count($mat,"uo_art_") > 0)continue;
-	=

-		list($minu,$minv,$maxu,$maxv) =3D GetUVBorders($l,$mat);
+		if(strpos($mat,"uo_art_") !=3D=3D false)continue;
+	=

+		/*list($minu,$minv,$maxu,$maxv) =3D GetUVBorders($l,$mat);
 		=

 		$minu =3D max(0,$minu);
 		$minv =3D max(0,$minv);
 		$maxu =3D min(1,$maxu);
 		$maxv =3D min(1,$maxv);
 =

-		echo "file=3D$f\tmaterial: $mat\tuv: $minu,$minv,$maxu,$maxv\t";
+		echo "file=3D$f\tmaterial: $mat\tuv: $minu,$minv,$maxu,$maxv\n";
 		if($minu >=3D 0 && $maxu <=3D 1 && $minv >=3D 0 && $maxv <=3D 1){
-			if(empty($lTex[$mat])){
+		*/
+		echo "file=3D$f\tmaterial: $mat\n";
+		=

+			if(!array_key_exists($mat,$lTex)){
 				$file =3D "../textures/$mat.png";
 				list($x,$y) =3D GetMaterialSize($file);
 				if($x >=3D 512 || $y >=3D 512 || empty($x) || empty($y))continue;
@@ -210,7 +213,7 @@
 			$count =3D $m["count"];
 			$file =3D $m["file"];
 			=

-			echo "REMAPABLE -> $mat $x x $y px $count times\n";
+			echo "\tREMAPABLE -> $mat $x x $y px $count times\n";
 			=

 			$ar =3D $y;
 			if(empty($lSize[$ar])){
@@ -218,7 +221,7 @@
 			} else if(!in_array($mat,$lSize[$ar])) {
 				$lSize[$ar][] =3D $mat;
 			}
-		} else echo "\n";
+		//}
 	}
 =

 }

Modified: trunk/data/models/models/generate_tex_atlas.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_tex_atlas.php (original)
+++ trunk/data/models/models/generate_tex_atlas.php Wed Dec 26 21:46:39 2007
@@ -9,8 +9,8 @@
 	$skip =3D true;
 	=

 	foreach($l as $line){ =

-		if(eregi('</submesh>',$line))$skip =3D true;
-		else if(eregi('submesh material=3D"([^"]+)"',$line,$r)){
+		if(strpos($line,'</submesh>') !=3D=3D false)$skip =3D true;
+		else if(eregi('^<submesh material=3D"([^"]+)"',trim($line),$r)){
 			// material check
 			if($mat =3D=3D $r[1])$skip =3D false;
 		}
@@ -108,8 +108,8 @@
 	$l =3D file($mesh);
 	=

 	foreach($l as $line){
-		if(eregi('</submesh>',$line))$skip =3D true;
-		else if(eregi('submesh material=3D"([^"]+)"',$line,$r)){
+		if(strpos($line,'</submesh>') !=3D=3D false)$skip =3D true;
+		else if(eregi('<submesh material=3D"([^"]+)"',$line,$r)){
 			// material check
 			if($mat =3D=3D $r[1])$skip =3D false;
 		}
@@ -173,18 +173,21 @@
 	$materials =3D GetMaterials($l);
 	=

 	foreach($materials as $mat){
-		if(substr_count($mat,"uo_art_") > 0)continue;
-	=

-		list($minu,$minv,$maxu,$maxv) =3D GetUVBorders($l,$mat);
+		if(strpos($mat,"uo_art_") !=3D=3D false)continue;
+	=

+		/*list($minu,$minv,$maxu,$maxv) =3D GetUVBorders($l,$mat);
 		=

 		$minu =3D max(0,$minu);
 		$minv =3D max(0,$minv);
 		$maxu =3D min(1,$maxu);
 		$maxv =3D min(1,$maxv);
 =

-		echo "file=3D$f\tmaterial: $mat\tuv: $minu,$minv,$maxu,$maxv\t";
+		echo "file=3D$f\tmaterial: $mat\tuv: $minu,$minv,$maxu,$maxv\n";
 		if($minu >=3D 0 && $maxu <=3D 1 && $minv >=3D 0 && $maxv <=3D 1){
-			if(empty($lTex[$mat])){
+		*/
+		echo "file=3D$f\tmaterial: $mat\n";
+		=

+			if(!array_key_exists($mat,$lTex)){
 				$file =3D "../textures/$mat.png";
 				list($x,$y) =3D GetMaterialSize($file);
 				if($x >=3D 512 || $y >=3D 512 || empty($x) || empty($y))continue;
@@ -202,7 +205,7 @@
 			$count =3D $m["count"];
 			$file =3D $m["file"];
 			=

-			echo "REMAPABLE -> $mat $x x $y px $count times\n";
+			echo "\tREMAPABLE -> $mat $x x $y px $count times\n";
 			=

 			$ar =3D $y;
 			if(empty($lSize[$ar])){
@@ -210,7 +213,7 @@
 			} else if(!in_array($mat,$lSize[$ar])) {
 				$lSize[$ar][] =3D $mat;
 			}
-		} else echo "\n";
+		//}
 	}
 =

 }

Modified: trunk/data/models/models/tomesh.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/tomesh.sh (original)
+++ trunk/data/models/models/tomesh.sh Wed Dec 26 21:46:39 2007
@@ -2,5 +2,6 @@
 =

 NAME=3D$1
 =

-test -e $1.xml && OgreXMLConverter -t $1.xml $1
+echo $1.xml to $1
+test -e $1.xml && OgreXMLConverter -q -log /dev/null -t $1.xml $1
 =


Modified: trunk/data/models/models/toxml.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/toxml.sh (original)
+++ trunk/data/models/models/toxml.sh Wed Dec 26 21:46:39 2007
@@ -2,5 +2,6 @@
 =

 NAME=3D$1
 =

-test -e $1 && OgreXMLConverter $1 $1.xml
+echo $1 to $1.xml
+test -e $1 && OgreXMLConverter -q -log /dev/null $1 $1.xml
 =




From no-reply at zwischenwelt.org  Thu Dec 27 00:34:13 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 26 Dec 2007 23:34:13 -0000
Subject: [Iris-commit] [IRIS] r1690 - /trunk/lua/lib.3d.map.lua
Message-ID: <20071226233417.A6B971C186BB@zwischenwelt.org>

Author: hagish
Date: Thu Dec 27 00:34:12 2007
New Revision: 1690

Log:
increased the layer size of the static geom layers

Modified:
    trunk/lua/lib.3d.map.lua

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Thu Dec 27 00:34:12 2007
@@ -13,6 +13,13 @@
 -- the whole map cache consists of (ROBMAP_RECENTER_DIST*2)*(ROBMAP_RECENT=
ER_DIST*2)  chunks
 -- every chunk consists of ROBMAP_CHUNK_SIZE*ROBMAP_CHUNK_SIZE blocks
 -- every block is equivalent to one MapBlock3D
+
+function Renderer3D:ZToLayer(zloc)
+	return math.floor(zloc / Renderer3D.giBlendOutPlayerHeight)
+end
+function Renderer3D:LayerToZ(zlayer)
+	return zlayer * Renderer3D.giBlendOutPlayerHeight
+end
 =

 function Renderer3D:UpdateMap ()
 	if (not self.gbActive) then return end
@@ -168,7 +175,7 @@
 		entity.sy =3D sy
 		entity.sz =3D sz
 =

-		local myLayer =3D entity.zloc
+		local myLayer =3D Renderer3D:ZToLayer(entity.zloc)
 		local myLayerStaticGeom =3D chunk.pStaticGeometryLayers[myLayer]
 		if (not myLayerStaticGeom) then
 			myLayerStaticGeom =3D CreateStaticGeometry()
@@ -321,12 +328,13 @@
 	=

 	for layerZ,layerStaticGeom in pairs(chunk.pStaticGeometryLayers) do =

 		layerStaticGeom:SetCastShadows(gStaticsCastShadows)
-		layerStaticGeom:SetVisible(self:IsZLayerVisible(layerZ))
+		layerStaticGeom:SetVisible(self:IsZLayerVisible(Renderer3D:LayerToZ(laye=
rZ)))
 		layerStaticGeom:Build()
 	end
 	return chunk
 end
 =

+-- NOTE: layerZ is a uo zloc not the layer index in pStaticGeometryLayers
 function Renderer3D:IsZLayerVisible (layerZ)
 	return (not self.giBlendOutCurZ) or layerZ <=3D self.giBlendOutCurZ
 end
@@ -370,14 +378,16 @@
 		end
 =

 		-- check multis
-		for k,v in pairs(gMultis) do
-			local multi =3D k
-			if multi.lparts then
-				for k,v in pairs(multi.lparts) do
-
-					local iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
-					if	iX =3D=3D x and iY =3D=3D y  and iZ > playerheadpos then
-						playerIsInside =3D true
+		if (not playerIsInside) then
+			for k,v in pairs(gMultis) do
+				local multi =3D k
+				if multi.lparts then
+					for k,v in pairs(multi.lparts) do
+
+						local iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
+						if	iX =3D=3D x and iY =3D=3D y  and iZ > playerheadpos then
+							playerIsInside =3D true
+						end
 					end
 				end
 			end
@@ -401,7 +411,7 @@
 	-- only update if changed
 	if (self.giBlendOutCurZ ~=3D myLayer or self.gbBlendOutTerrainVisible ~=
=3D bTerrainVisible) then
 		self.giBlendOutCurZ =3D myLayer
-		=

+	=

 		-- skybox not visible underground
 		if (self.gbBlendOutTerrainVisible ~=3D bTerrainVisible) then
 			self:SetMapEnvironment(not bTerrainVisible)
@@ -414,7 +424,7 @@
 				if (not chunk.bIsDead) then
 					-- update statics
 					for layerZ,layerStaticGeom in pairs(chunk.pStaticGeometryLayers) do
-						layerStaticGeom:SetVisible(self:IsZLayerVisible(layerZ))
+						layerStaticGeom:SetVisible(self:IsZLayerVisible(Renderer3D:LayerToZ(=
layerZ + 1)))
 					end
 					for k,entity in pairs(chunk.lStaticEntities) do =

 						self:UpdateStaticVisibility(entity) =




From no-reply at zwischenwelt.org  Thu Dec 27 01:49:43 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 27 Dec 2007 00:49:43 -0000
Subject: [Iris-commit] [IRIS] r1691 - /trunk/lua/lib.terrain.multitex.lua
Message-ID: <20071227010007.D15A51C18710@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Dec 27 01:49:42 2007
New Revision: 1691

Log:
multitex terrain : dirt as fallback for special terrain (indoor etc)

Modified:
    trunk/lua/lib.terrain.multitex.lua

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Thu Dec 27 01:49:42 2007
@@ -69,6 +69,9 @@
 		=

 		TerrainMultiTex_AddTexCoordSet(0, x*e+b,y*e+b,(e-b-b)/4,(e-b-b)/4)
 	end
+	for uoid=3D0,hex2num("0x4000") do =

+		if (not mylookup[uoid]) then mylookup[uoid] =3D 1 end -- dirt
+	end	=

 	=

 	-- TexCoordSet 1 : main mask
 	if (true) then



From no-reply at zwischenwelt.org  Sat Dec 29 00:09:54 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 28 Dec 2007 23:09:54 -0000
Subject: [Iris-commit] [IRIS] r1692 - in /trunk: bin/iris2.exe
 data/models/models/to_016000/mdl_015959.mesh
 data/models/models/to_016000/mdl_015962.mesh
 data/models/models/to_016000/mdl_015986.mesh lua/lib.spellbooks.lua
 vs8/iris.vcproj
Message-ID: <20071228230955.01A3D1C182BB@zwischenwelt.org>

Author: sience
Date: Sat Dec 29 00:09:54 2007
New Revision: 1692

Log:
-new binary
-vs8 project updated
-3 obsolete meshes deleted

Removed:
    trunk/data/models/models/to_016000/mdl_015959.mesh
    trunk/data/models/models/to_016000/mdl_015962.mesh
    trunk/data/models/models/to_016000/mdl_015986.mesh
Modified:
    trunk/bin/iris2.exe
    trunk/lua/lib.spellbooks.lua
    trunk/vs8/iris.vcproj

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/lib.spellbooks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.spellbooks.lua (original)
+++ trunk/lua/lib.spellbooks.lua Sat Dec 29 00:09:54 2007
@@ -1,5 +1,10 @@
 -- Spellbook definitions
 -- TODO: update definition needed
+
+gSpellbookExpansion =3D {}
+gSpellbookExpansion["AOS"]=3D hex2num("0x00")		--Mage, Necromancer and Pal=
adin spells
+gSpellbookExpansion["SE"]=3D hex2num("0x01")		--Samurai and Ninja Spells
+gSpellbookExpansion["ML"]=3D hex2num("0x02")		--Spellweaving Spells
 =

 --RunUO1 old_spellbook Items
 --[[
@@ -489,8 +494,3 @@
 	}
 	=

 ]]--
-
-gSpellbookExpansion =3D {}
-gSpellbookExpansion["AOS"]=3D hex2num("0x00")		--Mage, Necromancer and Pal=
adin spells
-gSpellbookExpansion["SE"]=3D hex2num("0x01")		--Samurai and Ninja Spells
-gSpellbookExpansion["ML"]=3D hex2num("0x02")		--Spellweaving Spells

Modified: trunk/vs8/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.vcproj (original)
+++ trunk/vs8/iris.vcproj Sat Dec 29 00:09:54 2007
@@ -387,6 +387,10 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\include\lugre_fastbatch.h"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\include\lugre_fifo.h"
 					>
 				</File>
@@ -420,6 +424,10 @@
 				</File>
 				<File
 					RelativePath=3D"..\lugre\include\lugre_main.h"
+					>
+				</File>
+				<File
+					RelativePath=3D"..\lugre\include\lugre_meshbuffer.h"
 					>
 				</File>
 				<File
@@ -559,6 +567,14 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\src\lugre_fastbatch.cpp"
+					>
+				</File>
+				<File
+					RelativePath=3D"..\lugre\src\lugre_fastbatch_L.cpp"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\src\lugre_fifo_L.cpp"
 					>
 				</File>
@@ -600,6 +616,10 @@
 				</File>
 				<File
 					RelativePath=3D"..\lugre\src\lugre_material_L.cpp"
+					>
+				</File>
+				<File
+					RelativePath=3D"..\lugre\src\lugre_meshbuffer.cpp"
 					>
 				</File>
 				<File



From no-reply at zwischenwelt.org  Sun Dec 30 02:42:00 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 30 Dec 2007 01:42:00 -0000
Subject: [Iris-commit] [IRIS] r1693 - /trunk/premake.lua
Message-ID: <20071230014200.EE85D1524004@zwischenwelt.org>

Author: hagish
Date: Sun Dec 30 02:42:00 2007
New Revision: 1693

Log:
some small fixes in premake

Modified:
    trunk/premake.lua

Modified: trunk/premake.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/premake.lua (original)
+++ trunk/premake.lua Sun Dec 30 02:42:00 2007
@@ -1,10 +1,11 @@
 -- this is a premake sample script to compile lugre/linux programs. =

 -- you need to put this file next to the lugre directory.
 =

-project.name =3D "Iris2"
+gName =3D "iris2"
+
+project.name =3D gName
 -- project.path =3D "build"
 -- project.bindir =3D "."
-
 gbExtraWarnings =3D false
 =

 addoption("wall","very verbose report, most warnings enabled")
@@ -18,9 +19,48 @@
 -- list of easy libs inclusion (located in lugre/lib/NAME). this will add =
lugre/lib/NAME/src and lugre/lib/NAME/include.
 gLugreLibList =3D {
 	"cadune_tree",
-	"md5"
+	"md5",
+	"paged_geometry",
+	"caelum",
 }
 =

+-- lugre dependencies, ie. ogre
+function AddLugreDeps(package)
+	package.defines =3D { =

+	"USE_OPENAL",
+	"MAIN_WORKING_DIR=3D\\\"..\\\"",
+	"LUA_DIR=3D\\\"lua\\\"",
+	"LUGRE_DIR=3D\\\""..gLugreDir.."\\\"",
+	"DATA_DIR=3D\\\"data\\\"",
+	"ENABLE_THREADS",
+}	=

+
+	addpkgconfiglib(package, "OGRE")
+	addpkgconfiglib(package, "OIS")
+	addpkgconfiglib(package, "openal")
+	addpkgconfiglib(package, "vorbisfile")
+
+	addcustomconfiglib(package, "ode-config")
+
+	addcustomlib(package,"boost_thread")
+	addcustomlib(package,"boost_thread-mt")	=

+
+	table.insert(package.links, "lugrelua")
+	table.insert(package.links, "lugrelualib")
+
+	-- add lib defines like USE_LUGRE_LIB_NAME
+	for k,v in pairs(gLugreLibList) do =

+		table.insert(package.defines, "USE_LUGRE_LIB_"..string.upper(v))
+		table.insert(package.links, v.."lib")
+		table.insert(package.includepaths, gLugreDir.."/lib/"..v.."/include/") =

+	end
+end
+
+function AddLugreLibDeps(package)
+	addpkgconfiglib(package, "OGRE")
+end
+
+-- add libs the linux way
 function addpkgconfiglib (package, libname)
     if options.target =3D=3D "gnu" and os.execute("pkg-config --exists "..=
libname) =3D=3D 0 then
       tinsert (package.buildoptions, "`pkg-config --cflags "..libname.."`")
@@ -49,6 +89,7 @@
   end
 =

 -- ---------------------------------------------
+-- LUA
 -- ---------------------------------------------
 =

 package =3D newpackage()
@@ -63,7 +104,6 @@
 }
 =

 -- ---------------------------------------------
--- ---------------------------------------------
 =

 package =3D newpackage()
 package.name =3D "lugrelualib"
@@ -77,10 +117,51 @@
 }
 =

 -- ---------------------------------------------
+-- LUGRE LIBS
+-- ---------------------------------------------
+
+-- add lib packages
+for k,v in pairs(gLugreLibList) do =

+	package =3D newpackage()
+	package.name =3D v.."lib"
+	package.kind =3D "lib"
+	package.language =3D "c++"
+	package.buildflags =3D { gbExtraWarnings and "extra-warnings" or nil, "op=
timize" }
+	package.buildoptions =3D {}
+	package.includepaths =3D { gLugreDir.."/include", gLugreLuaSrcDir.."/incl=
ude/", "include" }
+	package.files =3D {
+		matchfiles(gLugreLuaSrcDir.."/include/*.h", gLugreLuaSrcDir.."/src/lib/*=
.c"),
+	}
+	table.insert(package.files, matchrecursive(gLugreDir.."/lib/"..v.."/inclu=
de/*.h")) =

+	table.insert(package.files, matchrecursive(gLugreDir.."/lib/"..v.."/src/*=
.cpp")) =

+	table.insert(package.files, matchrecursive(gLugreDir.."/lib/"..v.."/src/*=
.c")) =

+	table.insert(package.includepaths, gLugreDir.."/lib/"..v.."/include/") =

+	AddLugreLibDeps(package)
+end
+
+-- ---------------------------------------------
+-- LUGRE
 -- ---------------------------------------------
 =

 package =3D newpackage()
-package.name =3D "iris"
+package.name =3D "lugrelib"
+package.kind =3D "lib"
+package.language =3D "c++"
+package.links =3D { "lugrelua", "lugrelualib" }
+package.buildflags =3D { bExtraWarnings and "extra-warnings" or nil, "opti=
mize" }
+package.buildoptions =3D {}
+package.includepaths =3D { gLugreLuaSrcDir.."/include", gLugreDir.."/inclu=
de" }
+package.files =3D {
+  matchrecursive(gLugreDir.."/include/*.h", gLugreDir.."/src/*.cpp"),
+}
+AddLugreDeps(package)
+
+-- ---------------------------------------------
+-- MAIN
+-- ---------------------------------------------
+
+package =3D newpackage()
+package.name =3D gName
 package.kind =3D "exe"
 package.language =3D "c++"
 package.bindir =3D "bin"
@@ -96,44 +177,14 @@
 package.linkoptions =3D {}
 package.links =3D { "lugrelua","lugrelualib" }
 =

-package.defines =3D { =

-	"USE_OPENAL",
-	"MAIN_WORKING_DIR=3D\\\"..\\\"",
-	"LUA_DIR=3D\\\"lua\\\"",
-	"LUGRE_DIR=3D\\\""..gLugreDir.."\\\"",
-	"DATA_DIR=3D\\\"data\\\"",
-	"ENABLE_THREADS",
-}
-
--- add lib defines like USE_LUGRE_LIB_NAME
-for k,v in pairs(gLugreLibList) do =

-	table.insert(package.defines, "USE_LUGRE_LIB_"..string.upper(v))
-end
-
-addpkgconfiglib(package, "OGRE")
-addpkgconfiglib(package, "OIS")
-addpkgconfiglib(package, "openal")
-addpkgconfiglib(package, "vorbisfile")
-
-addcustomconfiglib(package, "ode-config")
-
-addcustomlib(package,"boost_thread")
-addcustomlib(package,"boost_thread-mt")
+package.links =3D { "lugrelib" }
+AddLugreDeps(package)
 =

 package.files =3D {
-  matchrecursive(gLugreDir.."/include/*.h", gLugreDir.."/src/*.cpp"),
+  matchrecursive(gLugreDir.."/include/*.h"),
   matchrecursive("include/*.h", "src/*.cpp"),
 }
-
--- add lib src
-for k,v in pairs(gLugreLibList) do =

-	table.insert(package.files, matchrecursive(gLugreDir.."/lib/"..v.."/inclu=
de/*.h")) =

-	table.insert(package.files, matchrecursive(gLugreDir.."/lib/"..v.."/src/*=
.cpp")) =

-	table.insert(package.files, matchrecursive(gLugreDir.."/lib/"..v.."/src/*=
.c")) =

-end
-
 =

 package.excludes =3D {
 --  "dont_build_this.c"
 }
-



From no-reply at zwischenwelt.org  Sun Dec 30 03:02:50 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 30 Dec 2007 02:02:50 -0000
Subject: [Iris-commit] [IRIS] r1694 - /trunk/premake.lua
Message-ID: <20071230020251.33BF91C186BB@zwischenwelt.org>

Author: hagish
Date: Sun Dec 30 03:02:49 2007
New Revision: 1694

Log:
ups wrong binary name

Modified:
    trunk/premake.lua

Modified: trunk/premake.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/premake.lua (original)
+++ trunk/premake.lua Sun Dec 30 03:02:49 2007
@@ -1,7 +1,7 @@
 -- this is a premake sample script to compile lugre/linux programs. =

 -- you need to put this file next to the lugre directory.
 =

-gName =3D "iris2"
+gName =3D "iris"
 =

 project.name =3D gName
 -- project.path =3D "build"



From no-reply at zwischenwelt.org  Sun Dec 30 03:43:59 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 30 Dec 2007 02:43:59 -0000
Subject: [Iris-commit] [IRIS] r1695 - /trunk/premakelinux.sh
Message-ID: <20071230024359.623E91C18690@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec 30 03:43:59 2007
New Revision: 1695

Log:
added -j 2 to make call in premakelinux.sh to use cpu more efficiently duri=
ng compile, especially multi-core cpu's

Modified:
    trunk/premakelinux.sh

Modified: trunk/premakelinux.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/premakelinux.sh (original)
+++ trunk/premakelinux.sh Sun Dec 30 03:43:59 2007
@@ -1,2 +1,3 @@
 #!/bin/bash
-./premake --target gnu && make   =

+./premake --target gnu && make -j 2 =

+# -j 2 : start 2 jobs in parallalel, to avoid wait-for-io and use multi-cp=
u processors efficiently during compile



From no-reply at zwischenwelt.org  Sun Dec 30 14:28:41 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 30 Dec 2007 13:28:41 -0000
Subject: [Iris-commit] [IRIS] r1696 - in /trunk/bin: OIS.dll OgreMain.dll
 Plugin_CgProgramManager.dll Plugin_ParticleFX.dll
 RenderSystem_Direct3D9.dll RenderSystem_GL.dll cg.dll iris2.exe
Message-ID: <20071230132841.4A64E1C18690@zwischenwelt.org>

Author: sience
Date: Sun Dec 30 14:28:40 2007
New Revision: 1696

Log:
-win binarys updated to ogre 1.4.6
this includes:
- Cg 2.0 beta (glsl profiles now supported)
- OIS latest CVS v1-0 branch =

- FreeType 2.3.5

Modified:
    trunk/bin/OIS.dll
    trunk/bin/OgreMain.dll
    trunk/bin/Plugin_CgProgramManager.dll
    trunk/bin/Plugin_ParticleFX.dll
    trunk/bin/RenderSystem_Direct3D9.dll
    trunk/bin/RenderSystem_GL.dll
    trunk/bin/cg.dll
    trunk/bin/iris2.exe

Modified: trunk/bin/OIS.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/OgreMain.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/Plugin_CgProgramManager.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/Plugin_ParticleFX.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/RenderSystem_Direct3D9.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/RenderSystem_GL.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/cg.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Sun Dec 30 21:42:24 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 30 Dec 2007 20:42:24 -0000
Subject: [Iris-commit] [IRIS] r1697 - in /trunk: bin/iris2.exe
	lua/lib.3d.map.lua vs8/iris.vcproj
Message-ID: <20071230204224.4CDE31C186D9@zwischenwelt.org>

Author: sience
Date: Sun Dec 30 21:42:22 2007
New Revision: 1697

Log:
-project vs8 updated
-new binary (supports canduntree leaves)

Modified:
    trunk/bin/iris2.exe
    trunk/lua/lib.3d.map.lua
    trunk/vs8/iris.vcproj

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sun Dec 30 21:42:22 2007
@@ -161,7 +161,39 @@
 	entity.iHue =3D iHue
 	=

 	local meshname =3D (not gForceFallBackBillboards_Statics) and GetStaticMe=
shName(iTileTypeID,entity.iHue)
-	=

+
+--[[	=

+--------------------------------------------------------------------------=
---------------------------------------------------
+	if ((iTileTypeID =3D=3D 3296) or (iTileTypeID =3D=3D 3297)) then
+		if (iTileTypeID =3D=3D 3296) then
+			print("generate tree")
+			local p =3D CreateCaduneTreeParameters()
+			local s =3D CreateCaduneTreeStem(p)
+			s:Grow()
+			entity.gfx =3D s:CreateGeometry()
+
+			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
+			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
+			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
+			entity.gfx:SetScale(0.4,0.4,0.5)
+			entity.gfx:SetNormaliseNormals(true)
+		end
+		if (iTileTypeID =3D=3D 3297) then
+			print("generate leaves")
+			local p =3D CreateCaduneTreeParameters()
+			local s =3D CreateCaduneTreeStem(p)
+			s:Grow()
+			entity.gfx =3D s:CreateLeaves()
+	=

+			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
+			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
+			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
+			entity.gfx:SetScale(0.4,0.4,0.5)
+			entity.gfx:SetNormaliseNormals(true)
+		end
+	elseif
+--------------------------------------------------------------------------=
---------------------------------------------------
+]]--
 	-- create Mesh
 	if (meshname and meshname ~=3D false) then 	--and (not MeshIsPseudoBillBo=
ard(iTileTypeID))) then	--currently disabled
 		entity.staticentity =3D CreateMeshEntity(meshname)
@@ -185,24 +217,7 @@
 		-- apply x mirror
 		myLayerStaticGeom:AddEntity(entity.staticentity,entity.x,entity.y,entity=
.z,qw,qx,qy,qz,sx,sy,sz)
 		table.insert(chunk.lStaticEntities,entity)
---[[
---------------------------------------------------------------------------=
---------------------------------------------------
-	elseif (gEnableCanduneTreegeneration_Statics) then
-		if (iTileTypeID =3D=3D 3296) then
-			print("generate tree")
-			local p =3D CreateCaduneTreeParameters()
-			local s =3D CreateCaduneTreeStem(p)
-			s:Grow()
-			entity.gfx =3D s:CreateGeometry()
-
-			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
-			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
-			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
-			entity.gfx:SetScale(0.4,0.4,0.5)
-			entity.gfx:SetNormaliseNormals(true)
-		end
---------------------------------------------------------------------------=
---------------------------------------------------
-]]--
+
 	-- if no *.mesh is available, a fallback billboard with original uo_art i=
s generated
 	-- What about cahing here ??
 	elseif (gEnableFallBackBillboards_Statics) then

Modified: trunk/vs8/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.vcproj (original)
+++ trunk/vs8/iris.vcproj Sun Dec 30 21:42:22 2007
@@ -126,7 +126,7 @@
 				EnableFiberSafeOptimizations=3D"false"
 				WholeProgramOptimization=3D"true"
 				AdditionalIncludeDirectories=3D"&quot;$(INCLUDE)&quot;;&quot;$(OGRE_HO=
ME)\include\&quot;;&quot;$(OGRE_HOME)\include\OIS\&quot;;..\include\;..\inc=
lude\zlib;..\include\fmodx;&quot;..\lugre\lib\lua-5.0.3\include\&quot;;..\l=
ugre\lib\cadune_tree\include;..\lugre\include;&quot;c:\Programme\Microsoft =
Platform SDK\Include\&quot;"
-				PreprocessorDefinitions=3D"WIN32;USE_FMOD;MAIN_WORKING_DIR=3D\&quot;..=
/\&quot;"
+				PreprocessorDefinitions=3D"WIN32;USE_FMOD;USE_LUGRE_LIB_CADUNE_TREE;MA=
IN_WORKING_DIR=3D\&quot;../\&quot;"
 				GeneratePreprocessedFile=3D"0"
 				RuntimeLibrary=3D"0"
 				EnableEnhancedInstructionSet=3D"1"



From no-reply at zwischenwelt.org  Sun Dec 30 23:15:23 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 30 Dec 2007 22:15:23 -0000
Subject: [Iris-commit] [IRIS] r1698 - /trunk/lua/lib.debugmenu.lua
Message-ID: <20071230221523.AA1DE1C186D9@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Dec 30 23:15:22 2007
New Revision: 1698

Log:
unbind macros before adding custom binds

Modified:
    trunk/lua/lib.debugmenu.lua

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Sun Dec 30 23:15:22 2007
@@ -293,6 +293,7 @@
 	DebugMenuShowModel()
 	=

 	UnbindAll()
+	ClearAllMacros()
 =

 	BindDown("escape",	function () Terminate() end)
 	Bind("wheelup",		function (state) if (not gActiveEditText) then if (state=
 > 0) then gCurrentRenderer:CamChangeZoom( 0.3) end end end)



From no-reply at zwischenwelt.org  Sun Dec 30 23:41:54 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 30 Dec 2007 22:41:54 -0000
Subject: [Iris-commit] [IRIS] r1699 - /trunk/lua/lib.3d.map.lua
Message-ID: <20071230224156.9A6CD1C186D9@zwischenwelt.org>

Author: sience
Date: Sun Dec 30 23:41:53 2007
New Revision: 1699

Log:
-cadunetree test updated

Modified:
    trunk/lua/lib.3d.map.lua

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sun Dec 30 23:41:53 2007
@@ -137,6 +137,10 @@
 	self.gMapChunks =3D {}
 end
 =

+--gobal tree params
+-- TODO: put them into an array
+gTreeParameters =3D nil
+gTreeStemParameters =3D nil
 =

 -- handles the entity creation for CreateMapChunk and adds it to chunk.lSt=
aticEntities
 function Renderer3D:CreateMapChunkEntity (chunk,iTileTypeID,iXLoc,iYLoc,iZ=
Loc,iHue)
@@ -162,15 +166,19 @@
 	=

 	local meshname =3D (not gForceFallBackBillboards_Statics) and GetStaticMe=
shName(iTileTypeID,entity.iHue)
 =

---[[	=

+--[[
 --------------------------------------------------------------------------=
---------------------------------------------------
+	-- just to test the cadunetree generation code
 	if ((iTileTypeID =3D=3D 3296) or (iTileTypeID =3D=3D 3297)) then
+		if (not gTreeParameters) then
+			gTreeParameters =3D CreateCaduneTreeParameters()
+			gTreeStemParameters =3D CreateCaduneTreeStem(gTreeParameters)
+			gTreeStemParameters:Grow()
+		end
+
 		if (iTileTypeID =3D=3D 3296) then
 			print("generate tree")
-			local p =3D CreateCaduneTreeParameters()
-			local s =3D CreateCaduneTreeStem(p)
-			s:Grow()
-			entity.gfx =3D s:CreateGeometry()
+			entity.gfx =3D gTreeStemParameters:CreateGeometry()
 =

 			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
 			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
@@ -180,10 +188,7 @@
 		end
 		if (iTileTypeID =3D=3D 3297) then
 			print("generate leaves")
-			local p =3D CreateCaduneTreeParameters()
-			local s =3D CreateCaduneTreeStem(p)
-			s:Grow()
-			entity.gfx =3D s:CreateLeaves()
+			entity.gfx =3D gTreeStemParameters:CreateLeaves()
 	=

 			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
 			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )



From no-reply at zwischenwelt.org  Mon Dec 31 02:04:11 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 31 Dec 2007 01:04:11 -0000
Subject: [Iris-commit] [IRIS] r1700 - /trunk/premakelinux.sh
Message-ID: <20071231010411.9E0F81C18690@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Dec 31 02:04:11 2007
New Revision: 1700

Log:
removed -j 2 from make call, can be harmful for system performance

Modified:
    trunk/premakelinux.sh

Modified: trunk/premakelinux.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/premakelinux.sh (original)
+++ trunk/premakelinux.sh Mon Dec 31 02:04:11 2007
@@ -1,3 +1,3 @@
 #!/bin/bash
-./premake --target gnu && make -j 2 =

-# -j 2 : start 2 jobs in parallalel, to avoid wait-for-io and use multi-cp=
u processors efficiently during compile
+./premake --target gnu && make
+# tipp : try "make -j 2" : start 2 jobs in parallel, to avoid wait-for-io =
and use multi-cpu processors efficiently during compile



From no-reply at zwischenwelt.org  Mon Dec 31 16:20:52 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 31 Dec 2007 15:20:52 -0000
Subject: [Iris-commit] [IRIS] r1701 - in /trunk: bin/iris2.exe
 data/config.lua.dist lua/lib.mousepick.lua lua/lib.uoids.lua lua/main.lua
Message-ID: <20071231152052.AD2DA1524004@zwischenwelt.org>

Author: sience
Date: Mon Dec 31 16:20:52 2007
New Revision: 1701

Log:
-small fixes
-new binary

Modified:
    trunk/bin/iris2.exe
    trunk/data/config.lua.dist
    trunk/lua/lib.mousepick.lua
    trunk/lua/lib.uoids.lua
    trunk/lua/main.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Mon Dec 31 16:20:52 2007
@@ -259,6 +259,7 @@
 gDynamicsCastShadows =3D false
 gMobileCastShadows =3D false
 =

+--[[
 -- sample shadow setting
 gEnableShadows =3D false
 if (gEnableShadows) then
@@ -268,6 +269,7 @@
 	gDynamicsCastShadows =3D true
 	gMobileCastShadows =3D true
 end
+]]--
 =

 -- activate Shader 2.0 for TerrainShader Engine
 gTerrainShader =3D false

Modified: trunk/lua/lib.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mousepick.lua (original)
+++ trunk/lua/lib.mousepick.lua Mon Dec 31 16:20:52 2007
@@ -31,13 +31,13 @@
 		local pm =3D GetPlayerMobile()
 		if (gActWarmode =3D=3D gWarmode_Normal or (pm and iSerial =3D=3D pm.seri=
al) ) then
 			if (iSerial and iSerial ~=3D 0) then
-				printdebug("UO","IrisDoubleClick: serial=3D0x%08x\n",iSerial)
+				printdebug("UO",sprintf("IrisDoubleClick: serial=3D0x%08x\n",iSerial))
 				Send_DoubleClick(iSerial)
 			end
 		end
 		if (gActWarmode =3D=3D gWarmode_Combat) then
 			if (iSerial and iSerial ~=3D 0) then
-				printdebug("UO","IrisDoubleClickAttack: serial=3D0x%08x\n",iSerial)
+				printdebug("UO",sprintf("IrisDoubleClickAttack: serial=3D0x%08x\n",iSe=
rial))
 				Send_AttackReq(iSerial)
 			end
 		end
@@ -52,7 +52,7 @@
 	else
 		local iSerial =3D gCurrentRenderer:GetMouseHitSerial()
 		if (iSerial and iSerial ~=3D 0) then =

-			printdebug("UO","IrisSingleClick: serial=3D0x%08x\n",iSerial)
+			printdebug("UO",sprintf("IrisSingleClick: serial=3D0x%08x\n",iSerial))
 			Send_SingleClick(iSerial)
 			gCurrentRenderer:SelectMobile(iSerial)
 		else
@@ -66,7 +66,7 @@
 	local iSerial =3D gCurrentRenderer:GetMouseHitSerial()
 	gLastRightClickSerial =3D nil
 	if (iSerial and iSerial ~=3D 0) then =

-		printdebug("UO","IrisRightClick: serial=3D0x%08x\n",iSerial)
+		printdebug("UO",sprintf("IrisRightClick: serial=3D0x%08x\n",iSerial))
 		Send_PopupRequest(iSerial) =

 		gLastRightClickSerial =3D iSerial
 	end

Modified: trunk/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoids.lua (original)
+++ trunk/lua/lib.uoids.lua Mon Dec 31 16:20:52 2007
@@ -38,9 +38,7 @@
 gMaxZ_Climb	=3D 7		--3 is to low for ladders
 gMaxZ_Fall	=3D 20	--19 is maybe too much
 gIllegalZ	=3D 127
---gMaxZ_Influence =3D 15
 gMaxZ_Blocks =3D 14
---gMaxZstep	=3D 5
 =

 kAnimTypeID_Monster	=3D 0
 kAnimTypeID_Sea		=3D 1

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Mon Dec 31 16:20:52 2007
@@ -224,12 +224,14 @@
 	-- set global shadow settings
 	if (gEnableShadows) then
 		OgreShadowTechnique(gShadowTechnique)
-		OgreSetShadowTextureSize(512)
-		--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --??
-		--OgreSetShadowTextureCasterMaterial
-		--OgreSetShadowTextureReceiverMaterial
-		--OgreSetShadowTextureSelfShadow(false)
-		--OgreSetShadowFarDistance(100.0)
+		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique =
=3D=3D "texture_additive")) then
+			OgreSetShadowTextureSize(1024)
+			OgreSetShadowTextureSelfShadow(false)
+			OgreSetShadowFarDistance(gSightRange*5.0)
+			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --only for accuracy
+			--OgreSetShadowTextureCasterMaterial(matname)
+			--OgreSetShadowTextureReceiverMaterial(matname)
+		end
 	end
 =

 	-- maybe we should check here if in offline or online mode!?



From no-reply at zwischenwelt.org  Mon Dec 31 16:23:07 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 31 Dec 2007 15:23:07 -0000
Subject: [Iris-commit] [IRIS] r1702 - /trunk/lua/main.lua
Message-ID: <20071231152308.32F5A1C180EC@zwischenwelt.org>

Author: sience
Date: Mon Dec 31 16:23:07 2007
New Revision: 1702

Log:
-small bugfix

Modified:
    trunk/lua/main.lua

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Mon Dec 31 16:23:07 2007
@@ -222,7 +222,7 @@
 	SetCursorBaseOffset(0,0)
 =

 	-- set global shadow settings
-	if (gEnableShadows) then
+	if (gShadowTechnique ~=3D "none") then
 		OgreShadowTechnique(gShadowTechnique)
 		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique =
=3D=3D "texture_additive")) then
 			OgreSetShadowTextureSize(1024)



From no-reply at zwischenwelt.org  Mon Dec 31 16:47:29 2007
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 31 Dec 2007 15:47:29 -0000
Subject: [Iris-commit] [IRIS] r1703 - in /trunk: bin/iris2.exe
 lua/lib.terrain.multitex.lua lua/main.lua
Message-ID: <20071231154729.1E1901C18124@zwischenwelt.org>

Author: sience
Date: Mon Dec 31 16:47:28 2007
New Revision: 1703

Log:
-gSightRange added to lib.terrain.multitex.lua (as distance factor)
-shadow texturesize increased to 2048pixel
-new binary (without lights cast shadows)

Modified:
    trunk/bin/iris2.exe
    trunk/lua/lib.terrain.multitex.lua
    trunk/lua/main.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Mon Dec 31 16:47:28 2007
@@ -172,7 +172,7 @@
 	if (gMultiTexTerrain_BX =3D=3D bx and gMultiTexTerrain_BY =3D=3D by) then=
 return end
 	gMultiTexTerrain_BX =3D bx
 	gMultiTexTerrain_BY =3D by
-	local r =3D 3
+	local r =3D gSightRange
 	for k,gfx in pairs(gMultiTexTerrain_GfxList) do =

 		if (math.abs(gfx.bx - bx) > r or math.abs(gfx.by - by) > r) then
 			gfx:Destroy() =


Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Mon Dec 31 16:47:28 2007
@@ -225,7 +225,7 @@
 	if (gShadowTechnique ~=3D "none") then
 		OgreShadowTechnique(gShadowTechnique)
 		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique =
=3D=3D "texture_additive")) then
-			OgreSetShadowTextureSize(1024)
+			OgreSetShadowTextureSize(2048)
 			OgreSetShadowTextureSelfShadow(false)
 			OgreSetShadowFarDistance(gSightRange*5.0)
 			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --only for accuracy



