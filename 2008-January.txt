From no-reply at zwischenwelt.org  Tue Jan  1 16:03:42 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 01 Jan 2008 15:03:42 -0000
Subject: [Iris-commit] [IRIS] r1704 - /trunk/lua/main.lua
Message-ID: <20080101160002.E07911C18178@zwischenwelt.org>

Author: sience
Date: Tue Jan  1 16:03:41 2008
New Revision: 1704

Log:
-shadow distance increased

Modified:
    trunk/lua/main.lua

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Tue Jan  1 16:03:41 2008
@@ -227,7 +227,7 @@
 		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique =
=3D=3D "texture_additive")) then
 			OgreSetShadowTextureSize(2048)
 			OgreSetShadowTextureSelfShadow(false)
-			OgreSetShadowFarDistance(gSightRange*5.0)
+			OgreSetShadowFarDistance(gSightRange*10.0)
 			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --only for accuracy
 			--OgreSetShadowTextureCasterMaterial(matname)
 			--OgreSetShadowTextureReceiverMaterial(matname)



From no-reply at zwischenwelt.org  Wed Jan  2 17:36:59 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 02 Jan 2008 16:36:59 -0000
Subject: [Iris-commit] [IRIS] r1705 - /trunk/bin/iris2.exe
Message-ID: <20080102163659.4635F1C186E6@zwischenwelt.org>

Author: sience
Date: Wed Jan  2 17:36:58 2008
New Revision: 1705

Log:
-new binary (win32)

Modified:
    trunk/bin/iris2.exe

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Wed Jan  2 17:54:22 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 02 Jan 2008 16:54:22 -0000
Subject: [Iris-commit] [IRIS] r1706 - /trunk/data/config.lua.dist
Message-ID: <20080102165430.0F17B1C182F9@zwischenwelt.org>

Author: sience
Date: Wed Jan  2 17:54:21 2008
New Revision: 1706

Log:
-gUseWhiteBoxAsFallBack changed to false as standardoption

Modified:
    trunk/data/config.lua.dist

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Wed Jan  2 17:54:21 2008
@@ -233,7 +233,7 @@
 gEnableFallBackBillboards_Dynamics =3D true
 gForceFallBackBillboards_Statics =3D false
 gForceFallBackBillboards_Dynamics =3D false
-gUseWhiteBoxAsFallBack =3D true	-- use boxes not uo art billboards as fall=
backs
+gUseWhiteBoxAsFallBack =3D false	-- use boxes not uo art billboards as fal=
lbacks
 =

 -- timeout of the text shown over the mobiles head in ms
 gHeadTextTimeout =3D 2 * 1000



From no-reply at zwischenwelt.org  Thu Jan  3 14:11:46 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 03 Jan 2008 13:11:46 -0000
Subject: [Iris-commit] [IRIS] r1707 -
	/trunk/data/skybox/materials/skybox.material
Message-ID: <20080103131146.CBAAC1C18072@zwischenwelt.org>

Author: sience
Date: Thu Jan  3 14:11:45 2008
New Revision: 1707

Log:
-skybox filtering fixed

Modified:
    trunk/data/skybox/materials/skybox.material

Modified: trunk/data/skybox/materials/skybox.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/skybox/materials/skybox.material (original)
+++ trunk/data/skybox/materials/skybox.material Thu Jan  3 14:11:45 2008
@@ -16,7 +16,7 @@
 =

 			texture_unit
 			{
-				filtering none
+				//filtering none
 				cubic_texture stone512.dds stone512.dds stone512.dds stone512.dds ston=
e512.dds stone512.dds separateUV
 				tex_address_mode clamp
 			}



From no-reply at zwischenwelt.org  Fri Jan  4 00:45:05 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 03 Jan 2008 23:45:05 -0000
Subject: [Iris-commit] [IRIS] r1708 - /trunk/lua/lib.data.lua
Message-ID: <20080104000015.C0DC01C186F8@zwischenwelt.org>

Author: sience
Date: Fri Jan  4 00:45:05 2008
New Revision: 1708

Log:
-cleaned a bit

Modified:
    trunk/lua/lib.data.lua

Modified: trunk/lua/lib.data.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.data.lua (original)
+++ trunk/lua/lib.data.lua Fri Jan  4 00:45:05 2008
@@ -42,41 +42,13 @@
 	return res
 end
 =

+function SaveUOModelImageToFile(rtt,texname)
+	if (rtt) then rtt:WriteContentsToFile("t"..texname..".bmp") end
+end
+
 -- art material loader with caching
 -- if someone what to view runned tiles (static tiles) he has to add (iArt=
ID + 16384)
 gArtMatCache =3D {}
---[[
-function old_GetArtMat (iArtID,iHue)
-	if (not gArtMapLoader) then return "art_fallback" end
-	if (not(iHue) or (tonumber(iHue) > gMaxHueValue)) then iHue=3D0 end
-	local res =3D gArtMatCache[iArtID.."_"..iHue]
-	if (not res) then
-		res =3D {}
-		-- bPixelExact,bInvertY,bInvertX,bHasAlpha,bEnableLighting,bEnableDepthW=
rite,HueLoader,iHue
-		res.material =3D gArtMapLoader:CreateMaterial(iArtID,true,false,false,tr=
ue,false,false, gHueLoader, iHue)
-		=

-		local iWidth, iHeight =3D gArtMapLoader:GetSize()
-		res.width =3D iWidth
-		res.height =3D iHeight
-		=

-		gArtMatCache[iArtID.."_"..iHue] =3D res
-	end
-	=

-	if (not res.material) then
-		-- fallbacks if not found
-		if (iArtID < 16384) then
-			return GetArtMat( 0 ) -- fallback first ground
-		else
-			return GetArtMat( 16384 ) -- fallback first static
-		end
-	end
-	=

-	return res.material
-end
-]]--
-function SaveUOModelImageToFile(rtt,texname)
-	if (rtt) then rtt:WriteContentsToFile("t"..texname..".bmp") end
-end
 -- New GetArtMat with RTT support
 function GetArtMat (iArtID,iHue)
 	if (not(iHue) or (tonumber(iHue) > gMaxHueValue)) then iHue=3D0 end



From no-reply at zwischenwelt.org  Fri Jan  4 01:21:09 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 04 Jan 2008 00:21:09 -0000
Subject: [Iris-commit] [IRIS] r1709 - /trunk/lua/lib.3d.dynamic.lua
Message-ID: <20080104002109.A9AA21C186F8@zwischenwelt.org>

Author: sience
Date: Fri Jan  4 01:21:09 2008
New Revision: 1709

Log:
-obsolete functionality removed

Modified:
    trunk/lua/lib.3d.dynamic.lua

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Fri Jan  4 01:21:09 2008
@@ -115,28 +115,12 @@
 			item.gfx:SetMesh(meshname)
 			item.gfx:SetScale(-1,1,1)		-- (-1) thats because xmirror bug and wrong =
mirrored mashes
 			item.gfx:SetNormaliseNormals(true)
-
+			item.gfx:SetCastShadows(gDynamicsCastShadows)
 			-- primary color hueing
 			if gHueLoader and item.hue > 0 then
 				local r,g,b =3D gHueLoader:GetColor(item.hue - 1,31) -- get first color
 				HueMeshEntity(item.gfx,r,g,b,r,g,b)
 			end
-			=

-			-- --------------------------------------------------------------------=
-----
-			-- todo: HACK here (zadd because dynamic street-tiles dont look good (f=
lying)
-			-- groundtiles and item billboards shouldn't cast shadows
-			if (CountMeshTriangles(meshname) <=3D 4) then =

-				item.gfx:SetCastShadows(false)	-- groundtiles and item billboards shou=
ldn't cast shadows
-				if (gTileTypeLoader) then
-					if not(isSurface( GetStaticTileTypeFlags(item.artid) or 0 )) then
-						item.zadd =3D self.gDynamicZAdd
-					end
-				end
-			else
-				item.gfx:SetCastShadows(gDynamicsCastShadows)
-			end
-			-- --------------------------------------------------------------------=
-----
-
 		elseif (gEnableFallBackBillboards_Dynamics) then
 			local iTranslatedTileTypeID =3D SeasonalStaticTranslation(item.artid, g=
SeasonSetting)
 			-- we have to add 16384 for fallbacks, because static Art starts on 163=
84 in Art.mul file



From no-reply at zwischenwelt.org  Sat Jan  5 01:03:06 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 00:03:06 -0000
Subject: [Iris-commit] [IRIS] r1710 - in /trunk: data/config.lua.dist
 lua/filter/filter.art.lua lua/lib.3d.map.lua lua/lib.3d.mousepick.lua
 lua/lib.static.lua
Message-ID: <20080105000306.A28911C1868F@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan  5 01:03:04 2008
New Revision: 1710

Log:
fastbatch experiment for statics

Modified:
    trunk/data/config.lua.dist
    trunk/lua/filter/filter.art.lua
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.3d.mousepick.lua
    trunk/lua/lib.static.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Jan  5 01:03:04 2008
@@ -412,3 +412,4 @@
 =

 gEnableMultiTexTerrain =3D false
 gDisableMultiTexTerrainTransitions =3D false -- ugly, but faster
+gFastBatchStatics =3D false -- faster, but mousepicking and blend-out-uppe=
r-floors doesn't work yet

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Sat Jan  5 01:03:04 2008
@@ -9,9 +9,10 @@
 	return iTranslatedTileTypeID
 end
 function FilterOrientation(iTranslatedTileTypeID)
-	if (gArtFilter[iTranslatedTileTypeID]) then
-		if (gArtFilter[iTranslatedTileTypeID].rotation) then
-			return QuaternionFromString(gArtFilter[iTranslatedTileTypeID].rotation)
+	local f =3D gArtFilter[iTranslatedTileTypeID]
+	if (f) then
+		if (f.rotation) then
+			return QuaternionFromString(f.rotation)
 		end
 	end
 	return nil

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sat Jan  5 01:03:04 2008
@@ -201,7 +201,6 @@
 ]]--
 	-- create Mesh
 	if (meshname and meshname ~=3D false) then 	--and (not MeshIsPseudoBillBo=
ard(iTileTypeID))) then	--currently disabled
-		entity.staticentity =3D CreateMeshEntity(meshname)
 		local qw,qx,qy,qz =3D GetStaticMeshOrientation(iTileTypeID)
 		local sx,sy,sz =3D -1,1,1 -- scale
 		entity.qw =3D qw
@@ -212,15 +211,22 @@
 		entity.sy =3D sy
 		entity.sz =3D sz
 =

-		local myLayer =3D Renderer3D:ZToLayer(entity.zloc)
-		local myLayerStaticGeom =3D chunk.pStaticGeometryLayers[myLayer]
-		if (not myLayerStaticGeom) then
-			myLayerStaticGeom =3D CreateStaticGeometry()
-			chunk.pStaticGeometryLayers[myLayer] =3D myLayerStaticGeom
-		end
-
-		-- apply x mirror
-		myLayerStaticGeom:AddEntity(entity.staticentity,entity.x,entity.y,entity=
.z,qw,qx,qy,qz,sx,sy,sz)
+		if (gFastBatchStatics) then
+			-- fastbatch : todo : mousepicking withtout entity, meshname+meshbuffer=
 ?
+			chunk.fastbatch:FastBatch_AddMesh(meshname,entity.x,entity.y,entity.z, =
qw,qx,qy,qz, sx,sy,sz) =

+			-- pos,rot,scale
+			-- pos,rot,scale,col_rgba
+		else
+			entity.staticentity =3D CreateMeshEntity(meshname)
+			local myLayer =3D Renderer3D:ZToLayer(entity.zloc)
+			local myLayerStaticGeom =3D chunk.pStaticGeometryLayers[myLayer]
+			if (not myLayerStaticGeom) then
+				myLayerStaticGeom =3D CreateStaticGeometry()
+				chunk.pStaticGeometryLayers[myLayer] =3D myLayerStaticGeom
+			end
+			myLayerStaticGeom:AddEntity(entity.staticentity,entity.x,entity.y,entit=
y.z,qw,qx,qy,qz,sx,sy,sz)
+		end
+
 		table.insert(chunk.lStaticEntities,entity)
 =

 	-- if no *.mesh is available, a fallback billboard with original uo_art i=
s generated
@@ -254,12 +260,19 @@
 -- coords in chunks
 function Renderer3D:CreateMapChunk (x,y)
 	if ((x < 0) or (y < 0)) then return end	-- we might also check the heighs=
t value !?
+	=

 =

 	local chunk =3D {}
 	chunk.bIsDead =3D false
 	chunk.miX =3D x
 	chunk.miY =3D y
 	chunk.pStaticGeometryLayers =3D {}
+	=

+	-- start fastbatch
+	if (gFastBatchStatics) then
+		chunk.fastbatch =3D CreateRootGfx3D()
+		chunk.fastbatch:SetFastBatch()
+	end
 =

 	local iBlockUO_X =3D x * self.ROBMAP_CHUNK_SIZE
 	local iBlockUO_Y =3D y * self.ROBMAP_CHUNK_SIZE
@@ -346,11 +359,16 @@
 =

 	-- TODO : fish in water ? other gimiks ?
 	=

-	for layerZ,layerStaticGeom in pairs(chunk.pStaticGeometryLayers) do =

-		layerStaticGeom:SetCastShadows(gStaticsCastShadows)
-		layerStaticGeom:SetVisible(self:IsZLayerVisible(Renderer3D:LayerToZ(laye=
rZ)))
-		layerStaticGeom:Build()
-	end
+	if (gFastBatchStatics) then
+		chunk.fastbatch:FastBatch_Build()
+	else
+		for layerZ,layerStaticGeom in pairs(chunk.pStaticGeometryLayers) do =

+			layerStaticGeom:SetCastShadows(gStaticsCastShadows)
+			layerStaticGeom:SetVisible(self:IsZLayerVisible(Renderer3D:LayerToZ(lay=
erZ)))
+			layerStaticGeom:Build()
+		end
+	end
+	=

 	return chunk
 end
 =

@@ -475,6 +493,7 @@
 	if (not chunk.bIsDead) then
 		--print("DestroyMapChunk",x,y)
 		chunk.bIsDead =3D true
+		if (chunk.fastbatch) then chunk.fastbatch:Destroy() end
 		if (chunk.pStaticGeometryTerrain) then chunk.pStaticGeometryTerrain:Dest=
roy() chunk.pStaticGeometryTerrain =3D nil end
 		if (chunk.terraingfx) then chunk.terraingfx:Destroy() chunk.terraingfx =
=3D nil end
 		if (chunk.pTerrainEntity) then chunk.pTerrainEntity:Destroy() chunk.pTer=
rainEntity =3D nil end

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Sat Jan  5 01:03:04 2008
@@ -90,7 +90,7 @@
 							local x,y,z =3D entity.gfx.billboard:GetDerivedPosition()
 							fHitDist =3D SphereRayPick(x,y,z,0.5,rx,ry,rz,rvx,rvy,rvz) -- 0.5 r=
ad
 							bHit =3D (fHitDist ~=3D nil)
-						else
+						elseif (entity.staticentity) then
 							bHit,fHitDist =3D entity.staticentity:RayPick(rx,ry,rz,rvx,rvy,rvz,
 								entity.x,entity.y,entity.z,
 								entity.qw,entity.qx,entity.qy,entity.qz,

Modified: trunk/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.static.lua (original)
+++ trunk/lua/lib.static.lua Sat Jan  5 01:03:04 2008
@@ -162,9 +162,7 @@
 =

 function GetStaticMeshOrientation (iTileTypeID)
 	local w,x,y,z =3D FilterOrientation(iTileTypeID)
-	if (not w or not x or not y or not z) then
-		w,x,y,z =3D Quaternion.identity()
-	end
+	if (not w) then return 1,0,0,0 end -- identity
 	return w,x,y,z
 end
 =




From no-reply at zwischenwelt.org  Sat Jan  5 02:49:34 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 01:49:34 -0000
Subject: [Iris-commit] [IRIS] r1712 - /trunk/src/builder_L.cpp
Message-ID: <20080105014934.74C6C1C1868F@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan  5 02:49:33 2008
New Revision: 1712

Log:
comment fixed

Modified:
    trunk/src/builder_L.cpp

Modified: trunk/src/builder_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/builder_L.cpp (original)
+++ trunk/src/builder_L.cpp Sat Jan  5 02:49:33 2008
@@ -82,7 +82,7 @@
 =

 	// static methods exported to lua
 		=

-		/// cMeshEntity*	CreateMeshEntity		(); for lua
+		/// cMeshEntity*	CreateMeshEntity		(sMeshName); for lua
 		static int			CreateMeshEntity		(lua_State *L) { PROFILE
 			return CreateUData(L,new cMeshEntity(luaL_checkstring(L,1)));
 		}



From no-reply at zwischenwelt.org  Sat Jan  5 02:49:07 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 01:49:07 -0000
Subject: [Iris-commit] [IRIS] r1711 - in /trunk/lua: lib.3d.map.lua
	lib.3d.mousepick.lua
Message-ID: <20080105014908.1BD221C1868F@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan  5 02:49:06 2008
New Revision: 1711

Log:
meshbuffer mousepicking

Modified:
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.3d.mousepick.lua

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sat Jan  5 02:49:06 2008
@@ -212,10 +212,9 @@
 		entity.sz =3D sz
 =

 		if (gFastBatchStatics) then
-			-- fastbatch : todo : mousepicking withtout entity, meshname+meshbuffer=
 ?
+			entity.meshbuffer =3D GetMeshBuffer(meshname) -- for mousepicking
 			chunk.fastbatch:FastBatch_AddMesh(meshname,entity.x,entity.y,entity.z, =
qw,qx,qy,qz, sx,sy,sz) =

-			-- pos,rot,scale
-			-- pos,rot,scale,col_rgba
+			-- todo : pos,rot,scale,col_rgba : hue
 		else
 			entity.staticentity =3D CreateMeshEntity(meshname)
 			local myLayer =3D Renderer3D:ZToLayer(entity.zloc)

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Sat Jan  5 02:49:06 2008
@@ -92,6 +92,11 @@
 							bHit =3D (fHitDist ~=3D nil)
 						elseif (entity.staticentity) then
 							bHit,fHitDist =3D entity.staticentity:RayPick(rx,ry,rz,rvx,rvy,rvz,
+								entity.x,entity.y,entity.z,
+								entity.qw,entity.qx,entity.qy,entity.qz,
+								entity.sx,entity.sy,entity.sz)
+						elseif (entity.meshbuffer) then
+							bHit,fHitDist =3D entity.meshbuffer:RayPick(rx,ry,rz,rvx,rvy,rvz,
 								entity.x,entity.y,entity.z,
 								entity.qw,entity.qx,entity.qy,entity.qz,
 								entity.sx,entity.sy,entity.sz)



From no-reply at zwischenwelt.org  Sat Jan  5 02:55:43 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 01:55:43 -0000
Subject: [Iris-commit] [IRIS] r1713 - /trunk/lua/lib.3d.dynamic.lua
Message-ID: <20080105015543.A718C1C18701@zwischenwelt.org>

Author: sience
Date: Sat Jan  5 02:55:42 2008
New Revision: 1713

Log:
-serverside multi fix (was wrong since its build with statics)

Modified:
    trunk/lua/lib.3d.dynamic.lua

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sat Jan  5 02:55:42 2008
@@ -51,7 +51,7 @@
 				iHue =3D 0				--<- TODO: hueing is WORNG !! Every part of an multi can=
 have its own hue!
 =

 				-- generate absolute coords
-				iX =3D item.xloc +(-v.x)+ item.xadd
+				iX =3D item.xloc + v.x + item.xadd
 				iY =3D item.yloc + v.y + item.yadd
 				iZ =3D item.zloc + v.z + item.zadd
 =




From no-reply at zwischenwelt.org  Sat Jan  5 03:24:48 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 02:24:48 -0000
Subject: [Iris-commit] [IRIS] r1717 - in /trunk: lua/net/net.multi.lua
	vs8/iris.vcproj
Message-ID: <20080105022449.296FC1C1868F@zwischenwelt.org>

Author: sience
Date: Sat Jan  5 03:24:47 2008
New Revision: 1717

Log:
-project updated
-test with multis

Modified:
    trunk/lua/net/net.multi.lua
    trunk/vs8/iris.vcproj

Modified: trunk/lua/net/net.multi.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.multi.lua (original)
+++ trunk/lua/net/net.multi.lua Sat Jan  5 03:24:47 2008
@@ -213,7 +213,10 @@
 					tile.x =3D x + dx
 					tile.y =3D y + dy
 					tile.z =3D z + dz
-					=

+
+					--fix to remove space between housesocket and the rest/don't look goo=
d with dynamics inside
+					--if (i>0) then tile.z=3Dtile.z-2 end
+
 					if (tile.artid > 0) then =

 						printdebug("net",sprintf("NET: Custom_House Plane: artid=3D0x%04x x=
=3D%i y=3D%i z=3D%i\n",
 								tile.artid, tile.x, tile.y, tile.z))

Modified: trunk/vs8/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.vcproj (original)
+++ trunk/vs8/iris.vcproj Sat Jan  5 03:24:47 2008
@@ -571,10 +571,6 @@
 					>
 				</File>
 				<File
-					RelativePath=3D"..\lugre\src\lugre_fastbatch_L.cpp"
-					>
-				</File>
-				<File
 					RelativePath=3D"..\lugre\src\lugre_fifo_L.cpp"
 					>
 				</File>



From no-reply at zwischenwelt.org  Sat Jan  5 03:26:03 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 02:26:03 -0000
Subject: [Iris-commit] [IRIS] r1718 - /trunk/
Message-ID: <20080105022603.EA5E91C18701@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan  5 03:26:03 2008
New Revision: 1718

Log:
added .a and .make to ignore list in root dir

Modified:
    trunk/   (props changed)



From no-reply at zwischenwelt.org  Sat Jan  5 03:01:57 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 02:01:57 -0000
Subject: [Iris-commit] [IRIS] r1716 - in /trunk/data/models/models:
	generate.sh generate_alpha.sh
Message-ID: <20080105020157.4D83B1C18701@zwischenwelt.org>

Author: hagish
Date: Sat Jan  5 03:01:57 2008
New Revision: 1716

Log:
some scripts

Removed:
    trunk/data/models/models/generate.sh
    trunk/data/models/models/generate_alpha.sh



From no-reply at zwischenwelt.org  Sat Jan  5 03:01:31 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 02:01:31 -0000
Subject: [Iris-commit] [IRIS] r1715 - in /trunk/data/models:
 models/generate_all.sh textures/shrink.sh
Message-ID: <20080105020131.D26E01C18701@zwischenwelt.org>

Author: hagish
Date: Sat Jan  5 03:01:30 2008
New Revision: 1715

Log:
some scripts

Added:
    trunk/data/models/models/generate_all.sh   (with props)
    trunk/data/models/textures/shrink.sh   (with props)



From no-reply at zwischenwelt.org  Sat Jan  5 03:00:43 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 02:00:43 -0000
Subject: [Iris-commit] [IRIS] r1714 - in /trunk/lua: lib.3d.dynamic.lua
 lib.3d.map.lua lib.3d.mousepick.lua
Message-ID: <20080105020043.DB3701C18701@zwischenwelt.org>

Author: hagish
Date: Sat Jan  5 03:00:43 2008
New Revision: 1714

Log:
first version of static dynamic

Modified:
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.3d.mousepick.lua

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sat Jan  5 03:00:43 2008
@@ -2,10 +2,47 @@
 =

 -- stores a list of the current client/server side multis
 gMultis =3D {}
+
+-- fast batch geometry gfx3d that contains the dynamics
+Renderer3D.gFastBatchDynamics =3D nil
+Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
+Renderer3D.gFastBatchDynamicsUpdateNext =3D nil
+Renderer3D.gFastBatchDynamicsUpdateNextTimout =3D 1 * 1000
 =

 -- helperfunction for CreateDynamicGfx. Please use always for function call
 function Renderer3D:AddDynamicItem( item )
 	self:CreateDynamicGfx(item)
+end
+
+function Renderer3D:CheckForFastBatchDynamicsUpdate ()
+	if Renderer3D.gFastBatchDynamicsUpdateNeeded and =

+		(not Renderer3D.gFastBatchDynamicsUpdateNext or Renderer3D.gFastBatchDyn=
amicsUpdateNext < gMyTicks) then
+		=

+		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D false
+		=

+		-- on demand create
+		if not Renderer3D.gFastBatchDynamics then
+			Renderer3D.gFastBatchDynamics =3D CreateRootGfx3D()
+		end
+		=

+		-- clear
+		Renderer3D.gFastBatchDynamics:SetFastBatch()
+		=

+		-- add dynamics
+		for k,dynamic in pairs(GetDynamicList()) do
+			if (dynamic.meshname and DynamicIsInWorld(dynamic)) then
+				if (self:IsZLayerVisible(dynamic.zloc)) then
+						local x,y,z =3D Renderer3D:UOPosToLocal (dynamic.xloc,dynamic.yloc,d=
ynamic.zloc * 0.1) =

+						local qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
+						Renderer3D.gFastBatchDynamics:FastBatch_AddMesh(dynamic.meshname, x,=
y,z, qw,qx,qy,qz, -1,1,1)
+				end
+			end
+		end
+		=

+		Renderer3D.gFastBatchDynamics:FastBatch_Build()
+		=

+		Renderer3D.gFastBatchDynamicsUpdateNext =3D gMyTicks + Renderer3D.gFastB=
atchDynamicsUpdateNextTimout
+	end
 end
 =

 function Renderer3D:UpdateDynamicItemPos ( dynamic )
@@ -109,39 +146,56 @@
 		end
 	else
 		-- normal 1 part object
-		item.gfx =3D CreateRootGfx3D()
 		local meshname =3D (not gForceFallBackBillboards_Dynamics) and GetStatic=
MeshName(item.artid) -- ,item.hue)
-		if (meshname and meshname ~=3D false) then
-			item.gfx:SetMesh(meshname)
-			item.gfx:SetScale(-1,1,1)		-- (-1) thats because xmirror bug and wrong =
mirrored mashes
-			item.gfx:SetNormaliseNormals(true)
-			item.gfx:SetCastShadows(gDynamicsCastShadows)
-			-- primary color hueing
-			if gHueLoader and item.hue > 0 then
-				local r,g,b =3D gHueLoader:GetColor(item.hue - 1,31) -- get first color
-				HueMeshEntity(item.gfx,r,g,b,r,g,b)
-			end
-		elseif (gEnableFallBackBillboards_Dynamics) then
-			local iTranslatedTileTypeID =3D SeasonalStaticTranslation(item.artid, g=
SeasonSetting)
-			-- we have to add 16384 for fallbacks, because static Art starts on 163=
84 in Art.mul file
-			iTranslatedTileTypeID =3D iTranslatedTileTypeID + 16384
-
-			-- fallback to billboard with original art
-			if (not IsArtBillboardFallBackSkipped(item.artid)) then
-				if gUseWhiteBoxAsFallBack then
-					-- use just a white box as fallback
-					SetFallBackBox(item.gfx)
-					printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed loa=
ding mesh for dynamic: artid=3D%i z_typename=3D%s -> box fallback\n",item.a=
rtid or -1,GetStaticTileTypeName(item.artid) or ""))
-				else
-					-- generate uoart billboard fallback
-					item.gfx.billboard =3D item.gfx:CreateChild()
-					item.xadd =3D item.xadd + 0.5
-					item.yadd =3D item.yadd + 0.5
-					item.zadd =3D item.zadd + 0.5
-					self:CreateArtBillBoard(item.gfx.billboard,iTranslatedTileTypeID,item=
.hue)
-					printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed loa=
ding mesh for dynamic: artid=3D%i z_typename=3D%s\n",item.artid or -1,GetSt=
aticTileTypeName(item.artid) or ""))
-				end
-			end
+		item.meshname =3D meshname
+		=

+		if gFastBatchDynamics and meshname and meshname ~=3D false then
+			-- trigger: burn all dynamics into the dynamic fastbatch
+			item.meshbuffer =3D GetMeshBuffer(meshname) -- for mousepicking
+			Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
+		else
+			-- just add the dynamic as a scene node
+			item.gfx =3D CreateRootGfx3D()
+			if (meshname and meshname ~=3D false) then
+				item.gfx:SetMesh(meshname)
+				item.gfx:SetScale(-1,1,1)		-- (-1) thats because xmirror bug and wrong=
 mirrored mashes
+				item.gfx:SetNormaliseNormals(true)
+				item.gfx:SetCastShadows(gDynamicsCastShadows)
+				-- primary color hueing
+				if gHueLoader and item.hue > 0 then
+					local r,g,b =3D gHueLoader:GetColor(item.hue - 1,31) -- get first col=
or
+					HueMeshEntity(item.gfx,r,g,b,r,g,b)
+				end
+			elseif (gEnableFallBackBillboards_Dynamics) then
+				local iTranslatedTileTypeID =3D SeasonalStaticTranslation(item.artid, =
gSeasonSetting)
+				-- we have to add 16384 for fallbacks, because static Art starts on 16=
384 in Art.mul file
+				iTranslatedTileTypeID =3D iTranslatedTileTypeID + 16384
+
+				-- fallback to billboard with original art
+				if (not IsArtBillboardFallBackSkipped(item.artid)) then
+					if gUseWhiteBoxAsFallBack then
+						-- use just a white box as fallback
+						SetFallBackBox(item.gfx)
+						printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed lo=
ading mesh for dynamic: artid=3D%i z_typename=3D%s -> box fallback\n",item.=
artid or -1,GetStaticTileTypeName(item.artid) or ""))
+					else
+						-- generate uoart billboard fallback
+						item.gfx.billboard =3D item.gfx:CreateChild()
+						item.xadd =3D item.xadd + 0.5
+						item.yadd =3D item.yadd + 0.5
+						item.zadd =3D item.zadd + 0.5
+						self:CreateArtBillBoard(item.gfx.billboard,iTranslatedTileTypeID,ite=
m.hue)
+						printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed lo=
ading mesh for dynamic: artid=3D%i z_typename=3D%s\n",item.artid or -1,GetS=
taticTileTypeName(item.artid) or ""))
+					end
+				end
+			end
+
+			item.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)
+
+			-- FILTER: correction
+			item.gfx:SetOrientation(GetStaticMeshOrientation(item.artid))
+
+			self:UpdateDynamicItemPos(item)
+
 		end
 =

 		-- creates a light if lights are enabled and static is a lightsource
@@ -154,12 +208,6 @@
 			end
 		end
 =

-		item.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)
-
-		-- FILTER: correction
-		item.gfx:SetOrientation(GetStaticMeshOrientation(item.artid))
-
-		self:UpdateDynamicItemPos(item)
 	end
 	self:UpdateDynamicVisibility(item)
 end
@@ -206,4 +254,9 @@
 		dynamic.gfx =3D nil
 	end
 =

-end
+	if gFastBatchDynamics then =

+		-- just trigger dynamic fastbatch update
+		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
+	end
+	=

+end

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sat Jan  5 03:00:43 2008
@@ -53,6 +53,11 @@
 		self:UpdateMapCache(-iCamOverBlockX,iCamOverBlockY, gSightRange)
 =

 		self.gNextMapUpdate =3D Client_GetTicks() + self.gMapUpdateInterval -- m=
ake sure the game runs for at least 100msec AFTER this loading without bein=
g interrupted by loading
+	end
+	=

+	if gFastBatchDynamics then
+		-- need to reburn dynamics?
+		gCurrentRenderer:CheckForFastBatchDynamicsUpdate()
 	end
 end
 =

@@ -213,7 +218,9 @@
 =

 		if (gFastBatchStatics) then
 			entity.meshbuffer =3D GetMeshBuffer(meshname) -- for mousepicking
-			chunk.fastbatch:FastBatch_AddMesh(meshname,entity.x,entity.y,entity.z, =
qw,qx,qy,qz, sx,sy,sz) =

+			if (not self.giBlendOutCurZ) or entity.zloc <=3D self.giBlendOutCurZ th=
en
+				chunk.fastbatch:FastBatch_AddMesh(meshname,entity.x,entity.y,entity.z,=
 qw,qx,qy,qz, sx,sy,sz)
+			end
 			-- todo : pos,rot,scale,col_rgba : hue
 		else
 			entity.staticentity =3D CreateMeshEntity(meshname)
@@ -467,6 +474,12 @@
 						self:UpdateStaticVisibility(entity) =

 					end
 					=

+					-- update fast batch
+					if gFastBatchStatics then
+						-- invalidate map chunk and trigger rebuild
+						chunk.mbRebuild =3D true
+					end
+					=

 					-- update terrain
 					if (chunk.pStaticGeometryTerrain) then
 						chunk.pStaticGeometryTerrain:SetVisible(bTerrainVisible)

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Sat Jan  5 03:00:43 2008
@@ -192,8 +192,20 @@
 					bHit =3D (fHitDist ~=3D nil)
 				else
 					-- mesh mousepick
-					bHit,fHitDist =3D dynamic.gfx:RayPick(rx,ry,rz,rvx,rvy,rvz)
+					if ( dynamic.meshbuffer) then
+						local x,y,z =3D Renderer3D:UOPosToLocal (dynamic.xloc,dynamic.yloc,d=
ynamic.zloc * 0.1) =

+						local qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
+						=

+						print("DEBUG",x,y,z)
+						=

+						bHit,fHitDist =3D dynamic.meshbuffer:RayPick(rx,ry,rz,rvx,rvy,rvz,
+							x,y,z, qw,qx,qy,qz, -1,1,1)
+					else
+						bHit,fHitDist =3D dynamic.gfx:RayPick(rx,ry,rz,rvx,rvy,rvz)
+					end
+					=

 				end
+				=

 				if (bHit and ((not gMousePickFoundHit) or fHitDist < self.gMousePickFo=
undDist)) then
 					self.gMousePickFoundDist =3D fHitDist
 					gMousePickFoundHit =3D {}



From no-reply at zwischenwelt.org  Sat Jan  5 13:28:05 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 12:28:05 -0000
Subject: [Iris-commit] [IRIS] r1719 - in /trunk: bin/resources.cfg
	data/config.lua.dist lua/main.lua
Message-ID: <20080105122805.7931D1C184AA@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan  5 13:28:04 2008
New Revision: 1719

Log:
emptied resources.cfg and moved paths to CollectOgreResLocs() in main.lua, =
so they can be adjusted at runtime, added config vars gModelPath_Mesh gMode=
lPath_Tex to help when experimenting with texture-atlases

Modified:
    trunk/bin/resources.cfg
    trunk/data/config.lua.dist
    trunk/lua/main.lua

Modified: trunk/bin/resources.cfg
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/bin/resources.cfg (original)
+++ trunk/bin/resources.cfg Sat Jan  5 13:28:04 2008
@@ -1,84 +1,3 @@
 # Resource locations to be added to the 'boostrap' path
 # This also contains the minimum you need to use the Ogre example framework
-[Bootstrap]
-Zip=3D../data/base/OgreCore.zip
-
-# Resource locations to be added to the default path
-[General]
-FileSystem=3D./
-FileSystem=3D../data/base
-FileSystem=3D../data/base/ui
-FileSystem=3D../data/base/font
-FileSystem=3D../data/skybox/materials
-FileSystem=3D../data/skybox/textures
-FileSystem=3D../data/particles/materials
-FileSystem=3D../data/particles/particles
-FileSystem=3D../data/particles/textures
-FileSystem=3D../data/compositors
-
-# distributet models
-FileSystem=3D../data/models/materials
-FileSystem=3D../data/models/meta
-FileSystem=3D../data/models/models/to_001000
-FileSystem=3D../data/models/models/to_002000
-FileSystem=3D../data/models/models/to_003000
-FileSystem=3D../data/models/models/to_004000
-FileSystem=3D../data/models/models/to_005000
-FileSystem=3D../data/models/models/to_006000
-FileSystem=3D../data/models/models/to_007000
-FileSystem=3D../data/models/models/to_008000
-FileSystem=3D../data/models/models/to_009000
-FileSystem=3D../data/models/models/to_010000
-FileSystem=3D../data/models/models/to_011000
-FileSystem=3D../data/models/models/to_012000
-FileSystem=3D../data/models/models/to_013000
-FileSystem=3D../data/models/models/to_014000
-FileSystem=3D../data/models/models/to_015000
-FileSystem=3D../data/models/models/to_016000
-FileSystem=3D../data/models/models/to_017000
-FileSystem=3D../data/models/models/to_018000
-FileSystem=3D../data/models/models/to_019000
-FileSystem=3D../data/models/models/to_020000
-FileSystem=3D../data/models/programs
-FileSystem=3D../data/models/textures
-
-# custom models
-FileSystem=3D../data/custom/materials
-FileSystem=3D../data/custom/meta
-FileSystem=3D../data/custom/models/to_001000
-FileSystem=3D../data/custom/models/to_002000
-FileSystem=3D../data/custom/models/to_003000
-FileSystem=3D../data/custom/models/to_004000
-FileSystem=3D../data/custom/models/to_005000
-FileSystem=3D../data/custom/models/to_006000
-FileSystem=3D../data/custom/models/to_007000
-FileSystem=3D../data/custom/models/to_008000
-FileSystem=3D../data/custom/models/to_009000
-FileSystem=3D../data/custom/models/to_010000
-FileSystem=3D../data/custom/models/to_011000
-FileSystem=3D../data/custom/models/to_012000
-FileSystem=3D../data/custom/models/to_013000
-FileSystem=3D../data/custom/models/to_014000
-FileSystem=3D../data/custom/models/to_015000
-FileSystem=3D../data/custom/models/to_016000
-FileSystem=3D../data/custom/models/to_017000
-FileSystem=3D../data/custom/models/to_018000
-FileSystem=3D../data/custom/models/to_019000
-FileSystem=3D../data/custom/models/to_020000
-FileSystem=3D../data/custom/programs
-FileSystem=3D../data/custom/textures
-
-# new Terrain Shaderengine
-FileSystem=3D../data/terrain/materials
-FileSystem=3D../data/terrain/programs
-FileSystem=3D../data/terrain/textures
-FileSystem=3D../data/terrain/multitex
-
-# new Grannys
-FileSystem=3D../data/grannys/materials
-FileSystem=3D../data/grannys/programs
-
-# custom Grannys (Ogre.mesh + Ogre.skeleton)
-FileSystem=3D../data/customchars/materials
-FileSystem=3D../data/customchars/models
-FileSystem=3D../data/customchars/textures
+# now loaded dynamically in CollectOgreResLocs() in main.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Jan  5 13:28:04 2008
@@ -413,3 +413,8 @@
 gEnableMultiTexTerrain =3D false
 gDisableMultiTexTerrainTransitions =3D false -- ugly, but faster
 gFastBatchStatics =3D false -- faster, but mousepicking and blend-out-uppe=
r-floors doesn't work yet
+
+gModelPath_Mesh	=3D "models/models/" -- overrideable for texture-atlas exp=
eriments
+gModelPath_Tex	=3D "models/textures/"
+--~ gModelPath_Mesh	=3D "models/models_texatlas/"
+--~ gModelPath_Tex	=3D "models/textures_texatlas/"

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Jan  5 13:28:04 2008
@@ -146,6 +146,60 @@
 end
 =

 --###############################
+--##  OGRE RESOURCE LOCATIONS  ##
+--###############################
+
+function CollectOgreResLocs	()
+	local mydatapath =3D gMainWorkingDir.."data/"
+	OgreAddResLoc(mydatapath.."base/OgreCore.zip"			,"Zip","Bootstrap")
+	=

+	--~ # Resource locations to be added to the default path
+	--~ OgreAddResLoc(gMainWorkingDir.."/."						,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."."							,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."base"						,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."base/ui"						,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."base/font"					,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."skybox/materials"			,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."skybox/textures"				,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."particles/materials"			,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."particles/particles"			,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."particles/textures"			,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."compositors"					,"FileSystem","General")
+
+	--~ # distributet models
+	OgreAddResLoc(mydatapath.."models/materials"			,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."models/meta"					,"FileSystem","General")
+	for i=3D1,20 do OgreAddResLoc(mydatapath..gModelPath_Mesh..sprintf("to_%0=
3d000",i)	,"FileSystem","General") end
+	OgreAddResLoc(mydatapath..gModelPath_Tex				,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."models/programs"				,"FileSystem","General")
+
+	--~ # custom models
+	OgreAddResLoc(mydatapath.."custom/materials"			,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."custom/meta"					,"FileSystem","General")
+	for i=3D1,20 do OgreAddResLoc(mydatapath..sprintf("custom/models/to_%03d0=
00",i)	,"FileSystem","General") end
+	OgreAddResLoc(mydatapath.."custom/programs"				,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."custom/textures"				,"FileSystem","General")
+
+	--~ # new Terrain Shaderengine
+	OgreAddResLoc(mydatapath.."terrain/materials"			,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."terrain/programs"			,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."terrain/textures"			,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."terrain/multitex"			,"FileSystem","General")
+
+	--~ # new Grannys
+	OgreAddResLoc(mydatapath.."grannys/materials"			,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."grannys/programs"			,"FileSystem","General")
+
+	--~ # custom Grannys (Ogre.mesh + Ogre.skeleton)
+	OgreAddResLoc(mydatapath.."customchars/materials"		,"FileSystem","General=
")
+	OgreAddResLoc(mydatapath.."customchars/models"			,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."customchars/textures"		,"FileSystem","General")
+
+	--~ OgreAddResLoc(kObjTypePreviewDir.."."			,"FileSystem","General")
+	OgreInitResLocs()
+end
+
+--###############################
 --###        FUNCTIONS        ###
 --###############################
 =

@@ -218,7 +272,7 @@
 	LoadingProfile("initializing Ogre",true)
 	gPreOgreTime =3D gLoadingProfileLastTime
 	if (not InitOgre("Iris2",lugre_detect_ogre_plugin_path(),"../bin/")) then=
 Exit() end
-	if (OgreInitResLocs) then OgreInitResLocs() end
+	CollectOgreResLocs()
 	SetCursorBaseOffset(0,0)
 =

 	-- set global shadow settings



From no-reply at zwischenwelt.org  Sat Jan  5 17:28:11 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 16:28:11 -0000
Subject: [Iris-commit] [IRIS] r1720 - /trunk/bin/iris2.exe
Message-ID: <20080105162811.8BB491C181A7@zwischenwelt.org>

Author: sience
Date: Sat Jan  5 17:28:10 2008
New Revision: 1720

Log:
-new binary

Modified:
    trunk/bin/iris2.exe

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Sat Jan  5 18:51:44 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 17:51:44 -0000
Subject: [Iris-commit] [IRIS] r1721 - in /trunk/data/terrain:
 materials/terrain.material misc/terrain_textures_dds_profile.dpf
 multitex/terrain_tex_atlas_1024.dds multitex/terrain_tex_atlas_2048.dds
 multitex/terrain_tex_atlas_512.dds
Message-ID: <20080105175146.8F0451C18701@zwischenwelt.org>

Author: sience
Date: Sat Jan  5 18:51:39 2008
New Revision: 1721

Log:
-dds textures added (saves 4mb vram)
-profile updated
-terrain.material updated

Added:
    trunk/data/terrain/multitex/terrain_tex_atlas_1024.dds   (with props)
    trunk/data/terrain/multitex/terrain_tex_atlas_2048.dds   (with props)
    trunk/data/terrain/multitex/terrain_tex_atlas_512.dds   (with props)
Modified:
    trunk/data/terrain/materials/terrain.material
    trunk/data/terrain/misc/terrain_textures_dds_profile.dpf

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Sat Jan  5 18:51:39 2008
@@ -173,7 +173,7 @@
 			texture_unit
 			{
 				// draws ground and applies diffuse lighting
-				texture terrain_tex_atlas_1024.png
+				texture terrain_tex_atlas_1024.dds
 				tex_coord_set	0
 				colour_op_ex	modulate src_texture src_diffuse
 			}
@@ -192,7 +192,7 @@
 			texture_unit
 			{
 				// draws ground at full brightness
-				texture terrain_tex_atlas_1024.png
+				texture terrain_tex_atlas_1024.dds
 				tex_coord_set	0
 				colour_op_ex	source1 src_texture src_texture
 			}
@@ -207,13 +207,15 @@
 			texture_unit
 			{
 				// loads secondardy ground and blends it using transition mask
-				texture terrain_tex_atlas_1024.png
+				texture terrain_tex_atlas_1024.dds
 				tex_coord_set 2
 				colour_op_ex	blend_current_alpha src_texture src_current
 				// alpha_op_ex		source1 src_current src_current
 			}
 			texture_unit
 			{
+                filtering anisotropic
+                max_anisotropy 8
 				// applies diffuse lighting
 				// texture terrain_multitex_mask_64_blur_man.png alpha
 				// tex_coord_set 3

Modified: trunk/data/terrain/misc/terrain_textures_dds_profile.dpf
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/misc/terrain_textures_dds_profile.dpf (original)
+++ trunk/data/terrain/misc/terrain_textures_dds_profile.dpf Sat Jan  5 18:=
51:39 2008
@@ -9,7 +9,7 @@
 g_b_error_diffusion 0
 g_error_diffusion_width 1
 g_user_specified_fading_amounts 0
-g_texture_format 0
+g_texture_format 1
 g_weighttype 0
 g_texturemap_type 0
 g_mip_map_type 30
@@ -54,6 +54,7 @@
 g_normalmap_minz 0
 g_busebackgroundimage 0
 g_backgroundfilename =

+
 g_blightenable 0
 g_bshowdifferences 0
 g_bshowfiltering 0



From no-reply at zwischenwelt.org  Sat Jan  5 19:06:54 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Jan 2008 18:06:54 -0000
Subject: [Iris-commit] [IRIS] r1722 -
	/trunk/data/terrain/materials/terrain.material
Message-ID: <20080105190006.CFF661C184AA@zwischenwelt.org>

Author: sience
Date: Sat Jan  5 19:06:53 2008
New Revision: 1722

Log:
-filter fix for terrain textures

Modified:
    trunk/data/terrain/materials/terrain.material

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Sat Jan  5 19:06:53 2008
@@ -191,6 +191,8 @@
 			//alpha_rejection greater 0
 			texture_unit
 			{
+                filtering anisotropic
+                max_anisotropy 8
 				// draws ground at full brightness
 				texture terrain_tex_atlas_1024.dds
 				tex_coord_set	0
@@ -206,6 +208,8 @@
 			}
 			texture_unit
 			{
+                filtering anisotropic
+                max_anisotropy 8
 				// loads secondardy ground and blends it using transition mask
 				texture terrain_tex_atlas_1024.dds
 				tex_coord_set 2
@@ -214,8 +218,6 @@
 			}
 			texture_unit
 			{
-                filtering anisotropic
-                max_anisotropy 8
 				// applies diffuse lighting
 				// texture terrain_multitex_mask_64_blur_man.png alpha
 				// tex_coord_set 3



From no-reply at zwischenwelt.org  Sun Jan  6 01:46:46 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 00:46:46 -0000
Subject: [Iris-commit] [IRIS] r1723 - in /trunk: data/config.lua.dist
 data/models/models/generate_all.sh
 data/models/models/generate_alpha_tex_atlas.php
 data/models/models/generate_tex_atlas.php lua/main.lua
Message-ID: <20080106004648.1FF5F1524004@zwischenwelt.org>

Author: hagish
Date: Sun Jan  6 01:46:44 2008
New Revision: 1723

Log:
improved texture generate script (removed double code, alpha channel workin=
g, on the fly shrink or texture parts)

Removed:
    trunk/data/models/models/generate_alpha_tex_atlas.php
Modified:
    trunk/data/config.lua.dist
    trunk/data/models/models/generate_all.sh
    trunk/data/models/models/generate_tex_atlas.php
    trunk/lua/main.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Jan  6 01:46:44 2008
@@ -413,6 +413,7 @@
 gEnableMultiTexTerrain =3D false
 gDisableMultiTexTerrainTransitions =3D false -- ugly, but faster
 gFastBatchStatics =3D false -- faster, but mousepicking and blend-out-uppe=
r-floors doesn't work yet
+gFastBatchDynamics =3D false
 =

 gModelPath_Mesh	=3D "models/models/" -- overrideable for texture-atlas exp=
eriments
 gModelPath_Tex	=3D "models/textures/"

Modified: trunk/data/models/models/generate_all.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_all.sh (original)
+++ trunk/data/models/models/generate_all.sh Sun Jan  6 01:46:44 2008
@@ -1,10 +1,14 @@
 #!/bin/bash
 =

+ATLASSIZE=3D2048
+TEXSIZE=3D256
+
 rm -f tex_atlas*
+rm -f alpha_tex_atlas*
 find -name \*.mesh -exec ./toxml.sh {} \;
 find -name \*.mesh.xml | sort > xml.txt
-php generate_tex_atlas.php
-php generate_alpha_tex_atlas.php
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE alpha
 find -name \*.mesh -exec ./tomesh.sh {} \;
 find -name \*.xml -exec rm {} \;
 rm xml.txt

Modified: trunk/data/models/models/generate_tex_atlas.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_tex_atlas.php (original)
+++ trunk/data/models/models/generate_tex_atlas.php Sun Jan  6 01:46:44 2008
@@ -67,15 +67,37 @@
 	} else return null;
 }
 =

-function BlendImageAtSlot($im, $file, $px, $py, $b, $tw, $th){
-	echo "BlendImageAtSlot($im, $file, $px, $py, $b, $tw, $th)\n";
+function ShrinkToMax($w,$h){
+	if($w > TEXSIZE || $h > TEXSIZE){
+		$nw =3D $w;
+		$nh =3D $h;
+		=

+		$r =3D $w / $h;
+		=

+		if($nw > $nh){
+			$nw =3D TEXSIZE;
+			$nh =3D $nw / $r;
+		} else {
+			$nh =3D TEXSIZE;
+			$nw =3D $nh * $r;
+		}
+		=

+		return array(floor($nw),floor($nh));
+	} else {
+		return array(floor($w),floor($h));
+	}
+}
+
+function BlendImageAtSlot($im, $file, $px, $py, $b, $tw, $th, $ow, $oh){
+	echo "BlendImageAtSlot($im, $file, $px, $py, $b, $tw, $th, $ow, $oh)\n";
 	$src =3D @imagecreatefrompng($file); /* Attempt to open */
 	if($src){
 		// target size
 		$w =3D imagesx($im);
 		$h =3D imagesy($im);
 		=

-		imagecopy($im, $src, $px+$b, $py+$b, 0, 0, $tw, $th);
+		imagecopyresampled($im, $src, $px+$b, $py+$b, 0,0, $tw, $th, $ow, $oh);
+		//imagecopy($im, $src, $px+$b, $py+$b, 0, 0, $tw, $th);
 		=

 		imagedestroy($src);
 		=

@@ -153,16 +175,52 @@
 	return $k[0];
 }
 =

+function CreateBlankImage($w,$h){
+	$im =3D imagecreatetruecolor($w, $h);
+	imagealphablending($im, false);
+	imagesavealpha($im, true);
+	$bg =3D imagecolorallocatealpha($im, 255, 0, 255, 127);
+	imagefilledrectangle($im, 0, 0, $w, $h, $bg);
+	return $im;
+}
+
 // ####################################################################
 // ####################################################################
 =

+$filelist =3D $argv[1];
+$atlassize =3D $argv[2];
+$texsize =3D $argv[3];
+$doalpha =3D $argv[4];
+
+if(empty($filelist) || empty($atlassize) || empty($texsize) || !is_numeric=
($atlassize) || !is_numeric($texsize)){
+	echo "1. parameter need to be a filelist like xml.txt\n";
+	echo "2. parameter need to be texture atlas size in pixel, like 1024 for =
1024x1024\n";
+	echo "3. parameter need to be texture part max size in pixel, like 128 fo=
r 128x128>\n";
+	echo "4. parameter can be alpha if you want alpha mode\n";
+	exit(1);
+}
+
+define("TEXSIZE",$texsize);
+
+if($doalpha =3D=3D "alpha"){
+	$doalpha =3D true;
+} else {
+	$doalpha =3D false;
+}
+
+echo "alpha: ".($doalpha?"true":"false")."\n";
+echo "atlas size: $atlassize x $atlassize\n";
+echo "tex max size: $texsize x $texsize\n";
+
+// oki lets rock
+
 $lTex =3D array();
 =

 $lSize =3D array();
 =

 unset($argv[0]);
 =

-$argv =3D file("xml.txt");
+$argv =3D file($filelist);
 =

 foreach($argv as $f){
 	$f =3D trim($f);
@@ -174,6 +232,7 @@
 	=

 	foreach($materials as $mat){
 		if(strpos($mat,"uo_art_") !=3D=3D false)continue;
+		if(strpos($mat,"tex_atlas_") !=3D=3D false)continue;
 	=

 		/*list($minu,$minv,$maxu,$maxv) =3D GetUVBorders($l,$mat);
 		=

@@ -189,11 +248,19 @@
 		=

 			if(!array_key_exists($mat,$lTex)){
 				$file =3D "../textures/$mat.png";
-				list($x,$y) =3D GetMaterialSize($file);
-				if($x >=3D 512 || $y >=3D 512 || empty($x) || empty($y))continue;
-				if(ImageHasAlpha($file))continue;
+				// original file size
+				list($ox,$oy) =3D GetMaterialSize($file);
+				// shrinked file size
+				list($x,$y) =3D ShrinkToMax($ox,$oy);
+				if(empty($x) || empty($y))continue;
 				=

-				$lTex[$mat] =3D array("count"=3D>1,"file"=3D>"$file","mat"=3D>"$mat","=
x"=3D>$x,"y"=3D>$y,"meshs"=3D>array($f));
+				if($doalpha){
+					if(!ImageHasAlpha($file))continue;
+				} else {
+					if(ImageHasAlpha($file))continue;
+				}
+				=

+				$lTex[$mat] =3D array("count"=3D>1,"file"=3D>"$file","mat"=3D>"$mat","=
x"=3D>$x,"y"=3D>$y,"ox"=3D>$ox,"oy"=3D>$oy,"meshs"=3D>array($f));
 			} else {
 				$lTex[$mat]["count"]++;
 				if(!in_array($f,$lTex[$mat]["meshs"]))$lTex[$mat]["meshs"][] =3D $f;
@@ -218,14 +285,19 @@
 =

 }
 =

-$w =3D 1024;
-$h =3D 1024;
+$w =3D $atlassize;
+$h =3D $atlassize;
 $b =3D 2;
 =

 $number =3D 0;
 =

-$atlasname =3D "tex_atlas_$number";
-$im =3D imagecreatetruecolor($w, $h);
+if($doalpha){
+	$atlasname =3D "alpha_tex_atlas_$number";
+} else {
+	$atlasname =3D "tex_atlas_$number";
+}
+
+$im =3D CreateBlankImage($w, $h);
 =

 // current position
 $px =3D 0;
@@ -254,6 +326,9 @@
 	$tw =3D $tex["x"];
 	$th =3D $tex["y"];
 	=

+	$ow =3D $tex["ox"];
+	$oh =3D $tex["oy"];
+	=

 	if($px + $tw + 2*$b > $w){
 		// go to next line
 		$px =3D 0;
@@ -273,9 +348,13 @@
 		=

 		++$number;
 =

-		$atlasname =3D "tex_atlas_$number";
-		=

-		$im =3D imagecreatetruecolor($w, $h);
+		if($doalpha){
+			$atlasname =3D "alpha_tex_atlas_$number";
+		} else {		=

+			$atlasname =3D "tex_atlas_$number";
+		}
+
+		$im =3D CreateBlankImage($w, $h);
 		=

 		echo "NEXT ATLAS $i\n";
 		=

@@ -285,7 +364,7 @@
 	=

 	echo "key=3D$key tw=3D$tw th=3D$th px=3D$py py=3D$py ph=3D$ph P=3D".round=
($px*100/$w).",".round($py*100/$h)."\n";
 =

-	list($left,$top,$right,$bottom) =3D BlendImageAtSlot($im, $tex["file"], $=
px, $py, $b, $tw, $th);
+	list($left,$top,$right,$bottom) =3D BlendImageAtSlot($im, $tex["file"], $=
px, $py, $b, $tw, $th, $ow, $oh);
 	=

 	if($right > 0 && $bottom > 0){
 		// remap meshes
@@ -317,14 +396,30 @@
 imagedestroy($im);
 =

 // generate material script
-$f =3D fopen("tex_atlas.material","w");
-for($i=3D0;$i<=3D$number;++$i){
-	$name =3D "tex_atlas_$i";
-	$base =3D "tex_base";
-	$img =3D "tex_atlas_$i.png";
-	=

-	fwrite($f,"material $name : $base \n{ \n	technique \n	{ \n		pass\n		{		\n=
			texture_unit \n			{ \n				texture $img \n			}	\n		}\n	} \n}\n");
-}
-fclose($f);
+if($doalpha){
+
+	$f =3D fopen("alpha_tex_atlas.material","w");
+	for($i=3D0;$i<=3D$number;++$i){
+		$name =3D "alpha_tex_atlas_$i";
+		$base =3D "tex_base_alpha";
+		$img =3D "alpha_tex_atlas_$i.png";
+		=

+		fwrite($f,"material $name : $base \n{ \n	technique \n	{ \n		pass\n		{		\=
n			texture_unit \n			{ \n				texture $img \n			}	\n		}\n	} \n}\n");
+	}
+	fclose($f);
+
+} else {
+
+	$f =3D fopen("tex_atlas.material","w");
+	for($i=3D0;$i<=3D$number;++$i){
+		$name =3D "tex_atlas_$i";
+		$base =3D "tex_base";
+		$img =3D "tex_atlas_$i.png";
+		=

+		fwrite($f,"material $name : $base \n{ \n	technique \n	{ \n		pass\n		{		\=
n			texture_unit \n			{ \n				texture $img \n			}	\n		}\n	} \n}\n");
+	}
+	fclose($f);
+
+}
 =

 ?>

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sun Jan  6 01:46:44 2008
@@ -172,6 +172,7 @@
 	for i=3D1,20 do OgreAddResLoc(mydatapath..gModelPath_Mesh..sprintf("to_%0=
3d000",i)	,"FileSystem","General") end
 	OgreAddResLoc(mydatapath..gModelPath_Tex				,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."models/programs"				,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."models/models"				,"FileSystem","General")
 =

 	--~ # custom models
 	OgreAddResLoc(mydatapath.."custom/materials"			,"FileSystem","General")



From no-reply at zwischenwelt.org  Sun Jan  6 02:37:57 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 01:37:57 -0000
Subject: [Iris-commit] [IRIS] r1724 - in /trunk: include/terrain.h
 lua/lib.terrain.multitex.lua src/scripting.iris.cpp
 src/terrain_multitex.cpp
Message-ID: <20080106013757.7E4C71C18701@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan  6 02:37:57 2008
New Revision: 1724

Log:
added chunksize params to multitex terrain, increased chunksize to 2x2 so t=
errain uses 1/4 of the batches it did before, increased terrain sightrange =
a bit

Modified:
    trunk/include/terrain.h
    trunk/lua/lib.terrain.multitex.lua
    trunk/src/scripting.iris.cpp
    trunk/src/terrain_multitex.cpp

Modified: trunk/include/terrain.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/terrain.h (original)
+++ trunk/include/terrain.h Sun Jan  6 02:37:57 2008
@@ -13,7 +13,7 @@
 std::string		BuildTerrainEntity_Simple	(cGroundBlockLoader* pGroundBlockLo=
ader,const int iMinX,const int iMinY,const int iW,const int iH,const bool b=
GenerateNormals);
 std::string		BuildTerrainEntity_Shaded	(cGroundBlockLoader* pGroundBlockLo=
ader,const int iMinX,const int iMinY,const int iW,const int iH);
 =

-void	 		TerrainMultiTexWrite		(cGroundBlockLoader* pGroundBlockLoader,cons=
t int iBlockX,const int iBlockY,Lugre::cRobRenderOp& pRobRenderOp);
+void	 		TerrainMultiTexWrite		(cGroundBlockLoader* pGroundBlockLoader,cons=
t int iBlockX,const int iBlockY,const int iDX,const int iDY,Lugre::cRobRend=
erOp& pRobRenderOp);
 void	 		TerrainMultiTex_SetGroundMaterialTypeLookUp	(const int* piValues,c=
onst int iCount);
 void			TerrainMultiTex_AddTexCoordSet				(int iMode,float tx,float ty,floa=
t tw,float th); ///< 0:ground,1:mainmask,2:mask
 void			TerrainMultiTex_AddMaskTexCoordSet			(float u1,float v1, float u2,f=
loat v2, float u3,float v3, float u4,float v4);

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Sun Jan  6 02:37:57 2008
@@ -172,15 +172,16 @@
 	if (gMultiTexTerrain_BX =3D=3D bx and gMultiTexTerrain_BY =3D=3D by) then=
 return end
 	gMultiTexTerrain_BX =3D bx
 	gMultiTexTerrain_BY =3D by
-	local r =3D gSightRange
+	local r =3D gSightRange * 1.5
 	for k,gfx in pairs(gMultiTexTerrain_GfxList) do =

 		if (math.abs(gfx.bx - bx) > r or math.abs(gfx.by - by) > r) then
 			gfx:Destroy() =

 			gMultiTexTerrain_GfxList[k] =3D nil
 		end
 	end
-	for dy =3D -r,r do
-	for dx =3D -r,r do
+	local chunksize =3D 2
+	for dy =3D -r,r,chunksize do
+	for dx =3D -r,r,chunksize do
 		local name =3D (bx+dx).."_"..(by+dy)
 		if (not gMultiTexTerrain_GfxList[name]) then =

 			local gfx =3D CreateRootGfx3D()
@@ -188,7 +189,7 @@
 			gfx.by =3D by+dy
 			local x,y,z =3D gCurrentRenderer:UOPosToLocal((bx+dx)*8,(by+dy)*8,0)
 			gfx:SetPosition(x,y,z)
-			Gfx3D_SetMultiTexTerrain(gfx,gGroundBlockLoader,bx+dx,by+dy)
+			Gfx3D_SetMultiTexTerrain(gfx,gGroundBlockLoader,bx+dx,by+dy,chunksize,c=
hunksize)
 			gfx:SetMaterial(MultiTexTerrainGetMat())
 			gMultiTexTerrain_GfxList[name] =3D gfx
 		end

Modified: trunk/src/scripting.iris.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.iris.cpp (original)
+++ trunk/src/scripting.iris.cpp Sun Jan  6 02:37:57 2008
@@ -288,16 +288,20 @@
 	return 1;
 }
 =

-/// for lua : void	Gfx3D_SetMultiTexTerrain (gfx3d,pGroundBlockLoader,bx,b=
y)
+/// dx,dy : size in blocks, 1,1 default
+/// bx,by : block coordinates, =

+/// for lua : void	Gfx3D_SetMultiTexTerrain (gfx3d,pGroundBlockLoader,bx,b=
y,dx,dy)
 static int l_Gfx3D_SetMultiTexTerrain (lua_State *L) { PROFILE
 	cGfx3D* pGfx3D =3D cLuaBind<cGfx3D>::checkudata_alive(L);
 	cGroundBlockLoader* pGroundBlockLoader =3D cLuaBind<cGroundBlockLoader>::=
checkudata_alive(L,2);
 	int bx =3D luaL_checkint(L,3);
 	int by =3D luaL_checkint(L,4);
+	int dx =3D (lua_gettop(L) >=3D 5 && !lua_isnil(L,5)) ? luaL_checkint(L,5)=
 : 1;
+	int dy =3D (lua_gettop(L) >=3D 6 && !lua_isnil(L,6)) ? luaL_checkint(L,6)=
 : 1;
 	=

 	pGfx3D->SetSimpleRenderable();
 	cRobRenderOp* pRobRenderOp =3D pGfx3D->mpSimpleRenderable;
-	TerrainMultiTexWrite(pGroundBlockLoader,bx,by,*pRobRenderOp);
+	TerrainMultiTexWrite(pGroundBlockLoader,bx,by,dx,dy,*pRobRenderOp);
 	return 0;
 }
 =


Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Sun Jan  6 02:37:57 2008
@@ -30,6 +30,10 @@
 =

 template<int T> class cTiledMultiTexTerrain { public:
 	RawGroundBlock* mpBlocks[3*3];
+	float			mfAddX;
+	float			mfAddY;
+	=

+	cTiledMultiTexTerrain() : mfAddX(0), mfAddY(0) {}
 	=

 	enum { kMaxZDiff =3D 64 }; ///< mNormalLookup
 	enum { kGroundMatLookUpSize =3D 0x4000 };
@@ -104,11 +108,11 @@
 		=

 		// write position
 		#ifdef XMIRROR
-		*++w =3D -(x + dx);
+		*++w =3D mfAddX-(x + dx);
 		#else
-		*++w =3D  (x + dx);
+		*++w =3D mfAddX+(x + dx);
 		#endif
-		*++w =3D  (y + dy);
+		*++w =3D mfAddY+(y + dy);
 		*++w =3D GetZF(x+idx,y+idy);
 			=

 		// write normal
@@ -150,27 +154,40 @@
 	inline float*	GetTexCoordInfo_Mask				(const int iID) { return &mTexCoord=
s_Mask[		iID*8]; }
 	=

 	=

-	void	WriteToRobRenderOp (cGroundBlockLoader* pGroundBlockLoader,int bx,in=
t by,cRobRenderOp& pRobRenderOp) {
-		int iVertexCount		=3D T*T*4;
-		int iIndexCount			=3D T*T*6;
-		bool bDynamic			=3D false;
-		bool bKeepOldIndices 	=3D false;
-		int x,y,i;
+	void	WriteToRobRenderOp (cGroundBlockLoader* pGroundBlockLoader,int bx,in=
t by,const int iDX,const int iDY,cRobRenderOp& pRobRenderOp) {
+		int iVertexCountPerBlock	=3D T*T*4;
+		int iVertexCount			=3D iDX*iDY*iVertexCountPerBlock;
+		int iIndexCount				=3D iDX*iDY*T*T*6;
+		bool bDynamic				=3D false;
+		bool bKeepOldIndices 		=3D false;
+		int x,y,i,ai,ax,ay;
 		pRobRenderOp.Begin(iVertexCount,iIndexCount,bDynamic,bKeepOldIndices);
 		pRobRenderOp.SetVertexFormatFromEnum(cRobRenderOp::kVertexFormat_pnuv,4)=
; // 4 tex coord sets
 		=

-		Ogre::Real* pWriter =3D pRobRenderOp.StartCustomWriter(Ogre::Vector3(XMI=
RROR_ONE_OR_ZERO?(-T):0,0,-GetBlockZBounds()),Ogre::Vector3(XMIRROR_ONE_OR_=
ZERO?0:T,T,GetBlockZBounds()));
-		WriteToVertexBuffer(pGroundBlockLoader,bx,by,pWriter);
-		for (y=3D0;y<T;++y)
-		for (x=3D0;x<T;++x) { =

-			i =3D (y*T+x)*4;
-			#ifdef XMIRROR
-			pRobRenderOp.Index(i + 0,i + 2,i + 1);
-			pRobRenderOp.Index(i + 1,i + 2,i + 3);
-			#else
-			pRobRenderOp.Index(i + 0,i + 1,i + 2);
-			pRobRenderOp.Index(i + 2,i + 1,i + 3);
-			#endif
+		Ogre::Real* pWriter =3D pRobRenderOp.StartCustomWriter(
+			Ogre::Vector3(XMIRROR_ONE_OR_ZERO?(-T):(0),0,-GetBlockZBounds()),
+			Ogre::Vector3(XMIRROR_ONE_OR_ZERO?( 0):(T),T, GetBlockZBounds()));
+		=

+		=

+		for (ay=3D0;ay<iDY;++ay)
+		for (ax=3D0;ax<iDX;++ax) {
+			mfAddX =3D -8*ax;
+			mfAddY =3D  8*ay;
+			WriteToVertexBuffer(pGroundBlockLoader,bx+ax,by+ay,pWriter);
+			pWriter +=3D iVertexCountPerBlock * (3+3+4*2); // p,n,uv*4
+			=

+			ai =3D (ay*iDX+ax)*iVertexCountPerBlock;
+			for (y=3D0;y<T;++y)
+			for (x=3D0;x<T;++x) {
+				i =3D ai + (y*T+x)*4;
+				#ifdef XMIRROR
+				pRobRenderOp.Index(i + 0,i + 2,i + 1);
+				pRobRenderOp.Index(i + 1,i + 2,i + 3);
+				#else
+				pRobRenderOp.Index(i + 0,i + 1,i + 2);
+				pRobRenderOp.Index(i + 2,i + 1,i + 3);
+				#endif
+			}
 		}
 		pRobRenderOp.End();
 	}
@@ -341,8 +358,8 @@
 =

 cTiledMultiTexTerrain<8>	gTiledMultiTexTerrain;
 =

-void	 TerrainMultiTexWrite	(cGroundBlockLoader* pGroundBlockLoader,const i=
nt iBlockX,const int iBlockY,cRobRenderOp& pRobRenderOp) {
-	gTiledMultiTexTerrain.WriteToRobRenderOp(pGroundBlockLoader,iBlockX,iBloc=
kY,pRobRenderOp);
+void	 TerrainMultiTexWrite	(cGroundBlockLoader* pGroundBlockLoader,const i=
nt iBlockX,const int iBlockY,const int iDX,const int iDY,cRobRenderOp& pRob=
RenderOp) {
+	gTiledMultiTexTerrain.WriteToRobRenderOp(pGroundBlockLoader,iBlockX,iBloc=
kY,iDX,iDY,pRobRenderOp);
 }
 =

 void	 TerrainMultiTex_SetGroundMaterialTypeLookUp	(const int* piValues,con=
st int iCount) {



From no-reply at zwischenwelt.org  Sun Jan  6 02:38:21 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 01:38:21 -0000
Subject: [Iris-commit] [IRIS] r1725 - /trunk/lua/lib.terrain.multitex.lua
Message-ID: <20080106013821.7B88A1C184AA@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan  6 02:38:20 2008
New Revision: 1725

Log:
typo

Modified:
    trunk/lua/lib.terrain.multitex.lua

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Sun Jan  6 02:38:20 2008
@@ -172,7 +172,7 @@
 	if (gMultiTexTerrain_BX =3D=3D bx and gMultiTexTerrain_BY =3D=3D by) then=
 return end
 	gMultiTexTerrain_BX =3D bx
 	gMultiTexTerrain_BY =3D by
-	local r =3D gSightRange * 1.5
+	local r =3D math.floor(gSightRange * 1.5)
 	for k,gfx in pairs(gMultiTexTerrain_GfxList) do =

 		if (math.abs(gfx.bx - bx) > r or math.abs(gfx.by - by) > r) then
 			gfx:Destroy() =




From no-reply at zwischenwelt.org  Sun Jan  6 02:41:18 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 01:41:18 -0000
Subject: [Iris-commit] [IRIS] r1726 - /trunk/lua/lib.terrain.multitex.lua
Message-ID: <20080106014118.C03841C18701@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan  6 02:41:18 2008
New Revision: 1726

Log:
mulittex terrain : campos rounding fix

Modified:
    trunk/lua/lib.terrain.multitex.lua

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Sun Jan  6 02:41:18 2008
@@ -167,12 +167,12 @@
 	gMultiTexTerrain_NextStep =3D gMyTicks + kMultiTexTerrain_StepInterval
 	=

 	local camx,camy,camz =3D gCurrentRenderer:GetLookAheadCamPos()
-	local bx =3D -math.floor(gCurrentRenderer.giMapOriginX*gCurrentRenderer.R=
OBMAP_CHUNK_SIZE + camx/8)
-	local by =3D  math.floor(gCurrentRenderer.giMapOriginY*gCurrentRenderer.R=
OBMAP_CHUNK_SIZE + camy/8)
+	local bx =3D -math.floor(0.5 + gCurrentRenderer.giMapOriginX*gCurrentRend=
erer.ROBMAP_CHUNK_SIZE + camx/8)
+	local by =3D  math.floor(0.5 + gCurrentRenderer.giMapOriginY*gCurrentRend=
erer.ROBMAP_CHUNK_SIZE + camy/8)
 	if (gMultiTexTerrain_BX =3D=3D bx and gMultiTexTerrain_BY =3D=3D by) then=
 return end
 	gMultiTexTerrain_BX =3D bx
 	gMultiTexTerrain_BY =3D by
-	local r =3D math.floor(gSightRange * 1.5)
+	local r =3D math.floor(1 + gSightRange * 1.5)
 	for k,gfx in pairs(gMultiTexTerrain_GfxList) do =

 		if (math.abs(gfx.bx - bx) > r or math.abs(gfx.by - by) > r) then
 			gfx:Destroy() =




From no-reply at zwischenwelt.org  Sun Jan  6 14:37:31 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 13:37:31 -0000
Subject: [Iris-commit] [IRIS] r1727 - /trunk/src/terrain_multitex.cpp
Message-ID: <20080106133732.A02181C1829E@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan  6 14:37:30 2008
New Revision: 1727

Log:
multitex-terrain : fixed boundingbox for chunksize > 1

Modified:
    trunk/src/terrain_multitex.cpp

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Sun Jan  6 14:37:30 2008
@@ -165,9 +165,8 @@
 		pRobRenderOp.SetVertexFormatFromEnum(cRobRenderOp::kVertexFormat_pnuv,4)=
; // 4 tex coord sets
 		=

 		Ogre::Real* pWriter =3D pRobRenderOp.StartCustomWriter(
-			Ogre::Vector3(XMIRROR_ONE_OR_ZERO?(-T):(0),0,-GetBlockZBounds()),
-			Ogre::Vector3(XMIRROR_ONE_OR_ZERO?( 0):(T),T, GetBlockZBounds()));
-		=

+			Ogre::Vector3(XMIRROR_ONE_OR_ZERO?(-T*iDX):(    0),    0,-GetBlockZBoun=
ds()),
+			Ogre::Vector3(XMIRROR_ONE_OR_ZERO?(     0):(T*iDX),T*iDY, GetBlockZBoun=
ds()));
 		=

 		for (ay=3D0;ay<iDY;++ay)
 		for (ax=3D0;ax<iDX;++ax) {



From no-reply at zwischenwelt.org  Sun Jan  6 15:25:20 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 14:25:20 -0000
Subject: [Iris-commit] [IRIS] r1728 - /trunk/lua/lib.terrain.multitex.lua
Message-ID: <20080106150024.661731C18223@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan  6 15:25:20 2008
New Revision: 1728

Log:
multitex-terrain SetCastShadows(false)

Modified:
    trunk/lua/lib.terrain.multitex.lua

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Sun Jan  6 15:25:20 2008
@@ -191,6 +191,7 @@
 			gfx:SetPosition(x,y,z)
 			Gfx3D_SetMultiTexTerrain(gfx,gGroundBlockLoader,bx+dx,by+dy,chunksize,c=
hunksize)
 			gfx:SetMaterial(MultiTexTerrainGetMat())
+			gfx:SetCastShadows(false)
 			gMultiTexTerrain_GfxList[name] =3D gfx
 		end
 	end



From no-reply at zwischenwelt.org  Sun Jan  6 16:05:22 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 15:05:22 -0000
Subject: [Iris-commit] [IRIS] r1729 - in /trunk: bin/iris2.exe
 lua/lib.terrain.multitex.lua lua/main.lua vs8/iris.vcproj
Message-ID: <20080106150524.4A2711C182A2@zwischenwelt.org>

Author: sience
Date: Sun Jan  6 16:05:21 2008
New Revision: 1729

Log:
-terrain gfx:SetCastShadows(gTerrainCastShadows)
-vs8 project updated
-shadowrange increased

Modified:
    trunk/bin/iris2.exe
    trunk/lua/lib.terrain.multitex.lua
    trunk/lua/main.lua
    trunk/vs8/iris.vcproj

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Sun Jan  6 16:05:21 2008
@@ -191,7 +191,7 @@
 			gfx:SetPosition(x,y,z)
 			Gfx3D_SetMultiTexTerrain(gfx,gGroundBlockLoader,bx+dx,by+dy,chunksize,c=
hunksize)
 			gfx:SetMaterial(MultiTexTerrainGetMat())
-			gfx:SetCastShadows(false)
+			gfx:SetCastShadows(gTerrainCastShadows)
 			gMultiTexTerrain_GfxList[name] =3D gfx
 		end
 	end

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sun Jan  6 16:05:21 2008
@@ -282,7 +282,7 @@
 		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique =
=3D=3D "texture_additive")) then
 			OgreSetShadowTextureSize(2048)
 			OgreSetShadowTextureSelfShadow(false)
-			OgreSetShadowFarDistance(gSightRange*10.0)
+			OgreSetShadowFarDistance(gSightRange*20.0)
 			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --only for accuracy
 			--OgreSetShadowTextureCasterMaterial(matname)
 			--OgreSetShadowTextureReceiverMaterial(matname)

Modified: trunk/vs8/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.vcproj (original)
+++ trunk/vs8/iris.vcproj Sun Jan  6 16:05:21 2008
@@ -619,6 +619,10 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\src\lugre_meshbuffer_L.cpp"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\src\lugre_meshshape.cpp"
 					>
 				</File>



From no-reply at zwischenwelt.org  Sun Jan  6 16:53:48 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 15:53:48 -0000
Subject: [Iris-commit] [IRIS] r1730 - /trunk/data/config.lua.dist
Message-ID: <20080106155351.70A171C1829E@zwischenwelt.org>

Author: sience
Date: Sun Jan  6 16:53:17 2008
New Revision: 1730

Log:
-gHideFps set to true (as standard), so please use gHideFPS =3D false if yo=
u want to view fps

Modified:
    trunk/data/config.lua.dist

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Jan  6 16:53:17 2008
@@ -26,7 +26,7 @@
 -- GUI Stuff
 gHideHUDNames =3D false
 gHideUOCursor =3D false
-gHideFPS =3D false
+gHideFPS =3D true
 gHideMemoryUsage =3D true
 gHideOfflineModeTeleportMenu =3D true		-- currently broken
 =




From no-reply at zwischenwelt.org  Sun Jan  6 17:15:07 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 16:15:07 -0000
Subject: [Iris-commit] [IRIS] r1731 - in /trunk: data/config.lua.dist
 lua/lib.gui.iris.lua lua/main.lua
Message-ID: <20080106170006.ECA0B1C182A7@zwischenwelt.org>

Author: sience
Date: Sun Jan  6 17:15:07 2008
New Revision: 1731

Log:
-fps should now be displayed at the top stats

Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.gui.iris.lua
    trunk/lua/main.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Jan  6 17:15:07 2008
@@ -27,7 +27,7 @@
 gHideHUDNames =3D false
 gHideUOCursor =3D false
 gHideFPS =3D true
-gHideMemoryUsage =3D true
+gHideMemoryUsage =3D false
 gHideOfflineModeTeleportMenu =3D true		-- currently broken
 =

 -- Font settings

Modified: trunk/lua/lib.gui.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gui.iris.lua (original)
+++ trunk/lua/lib.gui.iris.lua Sun Jan  6 17:15:07 2008
@@ -36,7 +36,7 @@
 	if (gMyTicks > gMemStats_NextUpdate) then
 		gMemStats_NextUpdate =3D gMyTicks + 1000
 		local mem_dyn, mem_tresh =3D gcinfo()
-		local text =3D sprintf("%0.1fmb %dt %db OGRE %0.fmb / %0.1fmb LUA",memor=
yusage / 1024 / 1024, OgreTriangleCount(), OgreBatchCount(), mem_dyn / 1024=
, mem_tresh / 1024)
+		local text =3D sprintf("%5.1ffps %0.1fmb %dt %db OGRE %0.fmb / %0.1fmb L=
UA",OgreAvgFPS(),memoryusage / 1024 / 1024, OgreTriangleCount(), OgreBatchC=
ount(), mem_dyn / 1024, mem_tresh / 1024)
 		if (not gMemoryUsageField) then
 			local vw,vh =3D GetViewportSize()
 			local w,h =3D 0,12
@@ -45,7 +45,7 @@
 			local col_text =3D {1,0,0,1}
 			gMemoryUsageField =3D guimaker.MyCreateDialog()
 			gMemoryUsageField.panel	=3D guimaker.MakeBorderPanel(gMemoryUsageField,=
x,y,w,h,col_back)
-			gMemoryUsageField.text	=3D guimaker.MakeText(gMemoryUsageField.panel,0,=
0,text,gFontSizeDefault,col_text,gFontNameDefault)
+			gMemoryUsageField.text	=3D guimaker.MakeText(gMemoryUsageField.panel,0,=
0,text,gFontSizeDefault+2,col_text,gFontNameDefault)
 		else
 			gMemoryUsageField.text.gfx:SetText(text)
 		end

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sun Jan  6 17:15:07 2008
@@ -282,7 +282,7 @@
 		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique =
=3D=3D "texture_additive")) then
 			OgreSetShadowTextureSize(2048)
 			OgreSetShadowTextureSelfShadow(false)
-			OgreSetShadowFarDistance(gSightRange*20.0)
+			OgreSetShadowFarDistance(gSightRange*14.0)
 			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --only for accuracy
 			--OgreSetShadowTextureCasterMaterial(matname)
 			--OgreSetShadowTextureReceiverMaterial(matname)



From no-reply at zwischenwelt.org  Sun Jan  6 18:43:41 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 17:43:41 -0000
Subject: [Iris-commit] [IRIS] r1732 - in /trunk: bin/iris2.exe
	data/config.lua.dist
Message-ID: <20080106174341.A2E481C182A2@zwischenwelt.org>

Author: sience
Date: Sun Jan  6 18:43:40 2008
New Revision: 1732

Log:
-new win32 binary
-comments added to config.lua.dist

Modified:
    trunk/bin/iris2.exe
    trunk/data/config.lua.dist

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Jan  6 18:43:40 2008
@@ -26,8 +26,8 @@
 -- GUI Stuff
 gHideHUDNames =3D false
 gHideUOCursor =3D false
-gHideFPS =3D true
-gHideMemoryUsage =3D false
+gHideFPS =3D true							-- old but required for lugre
+gHideMemoryUsage =3D false				-- includes now also fps
 gHideOfflineModeTeleportMenu =3D true		-- currently broken
 =

 -- Font settings



From no-reply at zwischenwelt.org  Sun Jan  6 19:14:33 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 18:14:33 -0000
Subject: [Iris-commit] [IRIS] r1733 - in /trunk:
 data/terrain/materials/terrain.material lua/lib.3d.renderer.lua
Message-ID: <20080106181434.3A2C51C1806A@zwischenwelt.org>

Author: sience
Date: Sun Jan  6 19:14:31 2008
New Revision: 1733

Log:
-slight mods to Fog & anisotrophic filtering

Modified:
    trunk/data/terrain/materials/terrain.material
    trunk/lua/lib.3d.renderer.lua

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Sun Jan  6 19:14:31 2008
@@ -218,6 +218,8 @@
 			}
 			texture_unit
 			{
+                filtering anisotropic
+                max_anisotropy 8
 				// applies diffuse lighting
 				// texture terrain_multitex_mask_64_blur_man.png alpha
 				// tex_coord_set 3

Modified: trunk/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.renderer.lua (original)
+++ trunk/lua/lib.3d.renderer.lua Sun Jan  6 19:14:31 2008
@@ -55,7 +55,7 @@
 	end
 	=

 	if (gUseDistanceFog) then
-		Client_SetFog(3, gFogcolorred/255, gFogcolorgreen/255, gFogcolorblue/255=
, 1.0, 0, 8*gSightRange, 8*gSightRange+gFogValue)
+		Client_SetFog(3, gFogcolorred/255, gFogcolorgreen/255, gFogcolorblue/255=
, 1.0, 0, 10*gSightRange, 10*gSightRange+gFogValue)
 	end
 end
 =




From no-reply at zwischenwelt.org  Sun Jan  6 23:29:30 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 22:29:30 -0000
Subject: [Iris-commit] [IRIS] r1734 - /trunk/premake.lua
Message-ID: <20080106222930.7024A1C182A2@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan  6 23:29:29 2008
New Revision: 1734

Log:
removed ode from premake.lua

Modified:
    trunk/premake.lua

Modified: trunk/premake.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/premake.lua (original)
+++ trunk/premake.lua Sun Jan  6 23:29:29 2008
@@ -40,7 +40,7 @@
 	addpkgconfiglib(package, "openal")
 	addpkgconfiglib(package, "vorbisfile")
 =

-	addcustomconfiglib(package, "ode-config")
+	--~ addcustomconfiglib(package, "ode-config")
 =

 	addcustomlib(package,"boost_thread")
 	addcustomlib(package,"boost_thread-mt")	=




From no-reply at zwischenwelt.org  Mon Jan  7 00:03:32 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Jan 2008 23:03:32 -0000
Subject: [Iris-commit] [IRIS] r1735 - /trunk/data/models/textures/tex_514.png
Message-ID: <20080106230333.B07EF1524004@zwischenwelt.org>

Author: sience
Date: Mon Jan  7 00:03:26 2008
New Revision: 1735

Log:
-texture updated

Modified:
    trunk/data/models/textures/tex_514.png

Modified: trunk/data/models/textures/tex_514.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Mon Jan  7 02:19:41 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 07 Jan 2008 01:19:41 -0000
Subject: [Iris-commit] [IRIS] r1736 - /trunk/installdeps.ubuntu.sh
Message-ID: <20080107011941.1DF201C18072@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Jan  7 02:19:40 2008
New Revision: 1736

Log:
added dependency install script for ubuntu

Added:
    trunk/installdeps.ubuntu.sh   (with props)



From no-reply at zwischenwelt.org  Mon Jan  7 13:45:18 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 07 Jan 2008 12:45:18 -0000
Subject: [Iris-commit] [IRIS] r1737 -
	/trunk/data/models/models/generate_tex_atlas.php
Message-ID: <20080107124522.571C71C18690@zwischenwelt.org>

Author: hagish
Date: Mon Jan  7 13:45:16 2008
New Revision: 1737

Log:
black is better than pink as alpha color due to nicer mipmaps

Modified:
    trunk/data/models/models/generate_tex_atlas.php

Modified: trunk/data/models/models/generate_tex_atlas.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_tex_atlas.php (original)
+++ trunk/data/models/models/generate_tex_atlas.php Mon Jan  7 13:45:16 2008
@@ -179,7 +179,7 @@
 	$im =3D imagecreatetruecolor($w, $h);
 	imagealphablending($im, false);
 	imagesavealpha($im, true);
-	$bg =3D imagecolorallocatealpha($im, 255, 0, 255, 127);
+	$bg =3D imagecolorallocatealpha($im, 0, 0, 0, 127);
 	imagefilledrectangle($im, 0, 0, $w, $h, $bg);
 	return $im;
 }



From no-reply at zwischenwelt.org  Tue Jan  8 01:33:48 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 08 Jan 2008 00:33:48 -0000
Subject: [Iris-commit] [IRIS] r1738 - in /trunk:
 data/terrain/materials/terrain.material
 data/terrain/multitex/terrain_tex_atlas_256.png lua/main.lua
Message-ID: <20080108003348.D6C8C1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Jan  8 01:33:48 2008
New Revision: 1738

Log:
terrain ugly mode texturesize reduced to 256x256

Added:
    trunk/data/terrain/multitex/terrain_tex_atlas_256.png   (with props)
Modified:
    trunk/data/terrain/materials/terrain.material
    trunk/lua/main.lua

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Tue Jan  8 01:33:48 2008
@@ -173,7 +173,8 @@
 			texture_unit
 			{
 				// draws ground and applies diffuse lighting
-				texture terrain_tex_atlas_1024.dds
+				// texture terrain_tex_atlas_1024.dds
+				texture terrain_tex_atlas_256.png
 				tex_coord_set	0
 				colour_op_ex	modulate src_texture src_diffuse
 			}

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Tue Jan  8 01:33:48 2008
@@ -172,7 +172,8 @@
 	for i=3D1,20 do OgreAddResLoc(mydatapath..gModelPath_Mesh..sprintf("to_%0=
3d000",i)	,"FileSystem","General") end
 	OgreAddResLoc(mydatapath..gModelPath_Tex				,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."models/programs"				,"FileSystem","General")
-	OgreAddResLoc(mydatapath.."models/models"				,"FileSystem","General")
+	--~ OgreAddResLoc(mydatapath.."models/models"				,"FileSystem","General")
+	OgreAddResLoc(mydatapath..gModelPath_Mesh				,"FileSystem","General")
 =

 	--~ # custom models
 	OgreAddResLoc(mydatapath.."custom/materials"			,"FileSystem","General")



From no-reply at zwischenwelt.org  Tue Jan  8 01:37:33 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 08 Jan 2008 00:37:33 -0000
Subject: [Iris-commit] [IRIS] r1739 - in /trunk: data/mymacros.lua.dist
	lua/main.lua
Message-ID: <20080108003733.BDEDC1524004@zwischenwelt.org>

Author: sience
Date: Tue Jan  8 01:37:32 2008
New Revision: 1739

Log:
-key "y" switchRenderer deactivated (otherwise crashs)
-shadowdistance increased

Modified:
    trunk/data/mymacros.lua.dist
    trunk/lua/main.lua

Modified: trunk/data/mymacros.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/mymacros.lua.dist (original)
+++ trunk/data/mymacros.lua.dist Tue Jan  8 01:37:32 2008
@@ -53,7 +53,7 @@
 SetMacro("q",			function() MacroCmd_SelectNearestMobile() end)
 SetMacro("e",			function() MacroCmd_SelectNextMobile() end)
 SetMacro("space",		function() MacroCmd_AttackSelectedMobile() end) -- curr=
ently broken
-SetMacro("z",			function() MacroCmd_ActivateNextRenderer() end) -- current=
ly broken
+--SetMacro("z",			function() MacroCmd_ActivateNextRenderer() end) -- curre=
ntly broken
 SetMacro("u",			function() MacroCmd_WalkToMouse() end) -- currently broken
 =

 =


Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Tue Jan  8 01:37:32 2008
@@ -283,7 +283,7 @@
 		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique =
=3D=3D "texture_additive")) then
 			OgreSetShadowTextureSize(2048)
 			OgreSetShadowTextureSelfShadow(false)
-			OgreSetShadowFarDistance(gSightRange*14.0)
+			OgreSetShadowFarDistance(gSightRange*18.0)
 			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --only for accuracy
 			--OgreSetShadowTextureCasterMaterial(matname)
 			--OgreSetShadowTextureReceiverMaterial(matname)



From no-reply at zwischenwelt.org  Wed Jan  9 00:46:27 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 08 Jan 2008 23:46:27 -0000
Subject: [Iris-commit] [IRIS] r1740 - in /trunk: bin/iris2.exe
 data/models/materials/textures.material
 data/terrain/materials/terrain.material lua/lib.3d.dynamic.lua
 lua/lib.3d.map.lua
Message-ID: <20080109000013.39C0A1C18071@zwischenwelt.org>

Author: sience
Date: Wed Jan  9 00:46:26 2008
New Revision: 1740

Log:
-setshadow added for fastbatch statics/dynamics
-new binary
-256pixel terrain texatlas converted to dds

Modified:
    trunk/bin/iris2.exe
    trunk/data/models/materials/textures.material
    trunk/data/terrain/materials/terrain.material
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.map.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Wed Jan  9 00:46:26 2008
@@ -5,14 +5,15 @@
 // MESH BASE MATERIAL TEMPLATE
 material tex_base
 {
+	receive_shadows off
 	// FIXED FUNCTION
 	technique
 	{
 		pass
 		{
 			lighting on
-			ambient 1.0 1.0 1.0
-			diffuse 1.0 1.0 1.0
+			ambient 1.0 1.0 1.0 1.0
+			diffuse 1.0 1.0 1.0 1.0
 			=

 			// needed for xmirror fix
 			//cull_hardware anticlockwise
@@ -58,7 +59,7 @@
 		}
 	} =

 }
-
+
 =

 material tex_100 : tex_base
 { =

@@ -8142,9 +8143,9 @@
 			}
 		}
 	}
-}
-
-
+}
+
+
 material tex_5351 : tex_base =

 { =

 	technique =

@@ -8170,8 +8171,8 @@
 			}	=

 		}
 	} =

-}
-
+}
+
 material tex_5632 : tex_base =

 { =

 	technique =

@@ -8184,8 +8185,8 @@
 			}	=

 		}
 	} =

-}
-
+}
+
 material tex_2481 : tex_base =

 { =

 	technique =

@@ -8198,4 +8199,4 @@
 			}	=

 		}
 	} =

-}
+}

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Wed Jan  9 00:46:26 2008
@@ -174,7 +174,7 @@
 			{
 				// draws ground and applies diffuse lighting
 				// texture terrain_tex_atlas_1024.dds
-				texture terrain_tex_atlas_256.png
+				texture terrain_tex_atlas_256.dds
 				tex_coord_set	0
 				colour_op_ex	modulate src_texture src_diffuse
 			}

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Wed Jan  9 00:46:26 2008
@@ -39,6 +39,7 @@
 			end
 		end
 		=

+		Renderer3D.gFastBatchDynamics:SetCastShadows(gDynamicsCastShadows)
 		Renderer3D.gFastBatchDynamics:FastBatch_Build()
 		=

 		Renderer3D.gFastBatchDynamicsUpdateNext =3D gMyTicks + Renderer3D.gFastB=
atchDynamicsUpdateNextTimout

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Wed Jan  9 00:46:26 2008
@@ -366,6 +366,7 @@
 	-- TODO : fish in water ? other gimiks ?
 	=

 	if (gFastBatchStatics) then
+		chunk.fastbatch:SetCastShadows(gStaticsCastShadows)
 		chunk.fastbatch:FastBatch_Build()
 	else
 		for layerZ,layerStaticGeom in pairs(chunk.pStaticGeometryLayers) do =




From no-reply at zwischenwelt.org  Wed Jan  9 00:48:59 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 08 Jan 2008 23:48:59 -0000
Subject: [Iris-commit] [IRIS] r1741 -
	/trunk/data/terrain/multitex/terrain_tex_atlas_256.dds
Message-ID: <20080109000013.8066D1C18071@zwischenwelt.org>

Author: sience
Date: Wed Jan  9 00:48:59 2008
New Revision: 1741

Log:
-dds texture

Added:
    trunk/data/terrain/multitex/terrain_tex_atlas_256.dds   (with props)



From no-reply at zwischenwelt.org  Wed Jan  9 01:36:28 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 09 Jan 2008 00:36:28 -0000
Subject: [Iris-commit] [IRIS] r1742 - /trunk/lua/lib.terrain.multitex.lua
Message-ID: <20080109003628.36D2A1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Jan  9 01:36:28 2008
New Revision: 1742

Log:
multitex-terrain bugfix : when using chunksize > 1, campos must be rounded,=
 otherwise we get overlapping terrain, e.g. [0,1] overlaps with [1,2]

Modified:
    trunk/lua/lib.terrain.multitex.lua

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Wed Jan  9 01:36:28 2008
@@ -166,9 +166,11 @@
 	if (not gGroundBlockLoader) then return end
 	gMultiTexTerrain_NextStep =3D gMyTicks + kMultiTexTerrain_StepInterval
 	=

+	local chunksize =3D 2
 	local camx,camy,camz =3D gCurrentRenderer:GetLookAheadCamPos()
-	local bx =3D -math.floor(0.5 + gCurrentRenderer.giMapOriginX*gCurrentRend=
erer.ROBMAP_CHUNK_SIZE + camx/8)
-	local by =3D  math.floor(0.5 + gCurrentRenderer.giMapOriginY*gCurrentRend=
erer.ROBMAP_CHUNK_SIZE + camy/8)
+	local bx =3D -math.floor((0.5 + gCurrentRenderer.giMapOriginX*gCurrentRen=
derer.ROBMAP_CHUNK_SIZE + camx/8)/chunksize) * chunksize
+	local by =3D  math.floor((0.5 + gCurrentRenderer.giMapOriginY*gCurrentRen=
derer.ROBMAP_CHUNK_SIZE + camy/8)/chunksize) * chunksize
+	=

 	if (gMultiTexTerrain_BX =3D=3D bx and gMultiTexTerrain_BY =3D=3D by) then=
 return end
 	gMultiTexTerrain_BX =3D bx
 	gMultiTexTerrain_BY =3D by
@@ -179,7 +181,6 @@
 			gMultiTexTerrain_GfxList[k] =3D nil
 		end
 	end
-	local chunksize =3D 2
 	for dy =3D -r,r,chunksize do
 	for dx =3D -r,r,chunksize do
 		local name =3D (bx+dx).."_"..(by+dy)



From no-reply at zwischenwelt.org  Wed Jan  9 15:47:44 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 09 Jan 2008 14:47:44 -0000
Subject: [Iris-commit] [IRIS] r1743 - /trunk/lua/lib.walking3.lua
Message-ID: <20080109144744.AD2001524004@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Jan  9 15:47:44 2008
New Revision: 1743

Log:
walk code rewrite draft

Added:
    trunk/lua/lib.walking3.lua



From no-reply at zwischenwelt.org  Thu Jan 10 03:01:50 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 10 Jan 2008 02:01:50 -0000
Subject: [Iris-commit] [IRIS] r1744 - in /trunk:
 lua/lib.terrain.multitex.lua src/scripting.iris.cpp
 src/terrain_multitex.cpp
Message-ID: <20080110020150.BEAB71524004@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Jan 10 03:01:49 2008
New Revision: 1744

Log:
mulit tex terrain now skips water tiles

Modified:
    trunk/lua/lib.terrain.multitex.lua
    trunk/src/scripting.iris.cpp
    trunk/src/terrain_multitex.cpp

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Thu Jan 10 03:01:49 2008
@@ -19,9 +19,10 @@
 gTerrain_MultiTexTypes.snow			=3D {268,269,270,271,276,277,278,279,282,283=
,284,285,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,39=
3,394,901,902,903,904,905,906,907,908,913,914,915,916,925,926,927,928,929,9=
30,931,932,937,938,939,940,1471,1472,1473,1474,1475,1476,1477,1478,1479,148=
0,1481,1482,1483,1484,1485,1486,1487,1488,1489,1490,1491,1492,1493,1494,150=
3,1504,1505,1506,1861,1862,1863,1864,1873,1874,1875,1876,1877,1878,1879,188=
0,1885,1886,1887,1888,1901,1902,1903,1904,1905,1906,1907}
 gTerrain_MultiTexTypes.void			=3D {506,507,508,509,510,511}
 =

+gTerrain_MultiTexTypes.water		=3D {168,169,170,171,310,311}
+
 --[[
 gTerrain_MultiTexTypes.cave			=3D {581,582,583,584,585,586,587,588,589,590=
,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,60=
9,610,611,612,613,614,615,616,617,618,619,620,621,700,701,702,703,704,705,7=
06,707,708,709,710,711,712,713,714,715,1595,1596,1597,1598}
-gTerrain_MultiTexTypes.water		=3D {168,169,170,171,310,311}
 gTerrain_MultiTexTypes.stone		=3D {1078,1079,1080,1081,1082,1083,1084,1085=
,1086,1087,1088,1089,1090,1091,1092,1093}  -- tiles,manmade
 gTerrain_MultiTexTypes.woodenfloor	=3D {1030,1031,1032,1033,1034,1035,1036=
,1037,1038,1039,1040,1041,1042,1043,1044,1045,1203,1204,1205,1206,1207,1208=
,1209,1210,1211,1212,1213,1214,1215,1216,1217,1218,1219,1220,1221,1222,1227=
,1228,1229,1230,1231,1232,1233,1234,1235,1236,1237,1238,1239,1240,1241,1242=
,1243,1244,1245,1246,1247,1248,1249}
 gTerrain_MultiTexTypes.sandstone	=3D {1094,1095,1096,1097,1098,1099,1100,1=
101,1102,1103,1104,1105,1106,1107,1108,1109,1110,1111,1112,1113,1114,1115,1=
116,1117,1118,1119,1120,1121,1122,1123,1124,1125,1126,1127,1128,1129,1130,1=
131,1132,1133,1134,1135,1136,1137,1138,1139,1140,1141,1142,1143,1144,1145}
@@ -72,6 +73,9 @@
 	for uoid=3D0,hex2num("0x4000") do =

 		if (not mylookup[uoid]) then mylookup[uoid] =3D 1 end -- dirt
 	end	=

+	=

+	for k2,uoid in pairs(gTerrain_MultiTexTypes.water) do mylookup[uoid] =3D =
-1 end -- skip water tiles
+	TerrainMultiTex_SetGroundMaterialTypeLookUp(mylookup) =

 	=

 	-- TexCoordSet 1 : main mask
 	if (true) then
@@ -147,8 +151,6 @@
 			TerrainMultiTex_AddMaskTexCoordSet(unpack(mycoords[code]))
 		end
 	end
-	=

-	TerrainMultiTex_SetGroundMaterialTypeLookUp(mylookup) =

 end
 =

 function MultiTexTerrain_NotifyMapChange ()

Modified: trunk/src/scripting.iris.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.iris.cpp (original)
+++ trunk/src/scripting.iris.cpp Thu Jan 10 03:01:49 2008
@@ -307,6 +307,7 @@
 =

 /// for lua : void	TerrainMultiTex_SetGroundMaterialTypeLookUp (table) =

 /// key=3Duo-ground-tiletype-id  value=3Dindex_for_AddTexCoordSet_mode_0
+/// use value=3D-1 to skip tiles
 static int l_TerrainMultiTex_SetGroundMaterialTypeLookUp (lua_State *L) { =
PROFILE
 	enum { kLookUpSize =3D 0x4000 };
 	int myLookUp[kLookUpSize];

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Thu Jan 10 03:01:49 2008
@@ -29,6 +29,7 @@
 // uotypes : nodraw ? 0,2,431,432,433,434,435,436,437 =

 =

 template<int T> class cTiledMultiTexTerrain { public:
+	enum { kVertexSizeInFloats =3D (3+3+4*2) }; // p,n,uv*4
 	RawGroundBlock* mpBlocks[3*3];
 	float			mfAddX;
 	float			mfAddY;
@@ -173,11 +174,17 @@
 			mfAddX =3D -8*ax;
 			mfAddY =3D  8*ay;
 			WriteToVertexBuffer(pGroundBlockLoader,bx+ax,by+ay,pWriter);
-			pWriter +=3D iVertexCountPerBlock * (3+3+4*2); // p,n,uv*4
+			pWriter +=3D iVertexCountPerBlock * kVertexSizeInFloats;
 			=

 			ai =3D (ay*iDX+ax)*iVertexCountPerBlock;
 			for (y=3D0;y<T;++y)
 			for (x=3D0;x<T;++x) {
+				if (GetType(x,y) < 0) { // skipped
+					pRobRenderOp.Index(0,0,0);
+					pRobRenderOp.Index(0,0,0);
+					//~ pRobRenderOp.SkipIndices(6);  // TODO : BUG : this crashes, no id=
ea why
+					continue;
+				}
 				i =3D ai + (y*T+x)*4;
 				#ifdef XMIRROR
 				pRobRenderOp.Index(i + 0,i + 2,i + 1);
@@ -265,9 +272,12 @@
 		for (y=3D0;y<T;++y)
 		for (x=3D0;x<T;++x) {
 			iMainType	=3D GetType(x,y);
+			if (iMainType < 0) iMainType =3D 0;
+			//~ if (iMainType < 0) { w +=3D kVertexSizeInFloats*4; continue; }
 			iMainMask	=3D 0; // IsTerrainTypeNodraw(iMainType) ? 1 : 0; // 0=3Dfull=
y visible, 1=3Dfully transparent (nodraw tiles)
 			iTypeA		=3D GetMostFrequentNeighboorType(x,y,iMainType);
-			iMaskA		=3D (iTypeA =3D=3D iMainType) ? 0 : GenerateTransitionMask(x,y,=
iTypeA);
+			iMaskA		=3D (iTypeA =3D=3D iMainType || iTypeA < 0) ? 0 : GenerateTrans=
itionMask(x,y,iTypeA);
+			if (iTypeA < 0) iTypeA =3D 0;
 			spanx =3D float(x % 4);
 			spany =3D float(y % 4);
 			=

@@ -291,7 +301,7 @@
 			if (dx =3D=3D 0 && dy =3D=3D 0) continue;
 			// add type to counter
 			iCurType =3D GetType(x+dx,y+dy);
-			if (iCurType > iMainType) {
+			if (iCurType > iMainType && iCurType >=3D 0) {
 				for (i=3D0;i<myNumTypes;++i) if (myTypes[i] =3D=3D iCurType) { ++myCou=
nts[i]; break; }
 				if (i >=3D myNumTypes) { // loop above finished without break
 					myTypes[ myNumTypes] =3D iCurType;



From no-reply at zwischenwelt.org  Thu Jan 10 20:27:56 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 10 Jan 2008 19:27:56 -0000
Subject: [Iris-commit] [IRIS] r1746 - in /trunk: include/terrain.h
 src/scripting.iris.cpp src/terrain_multitex.cpp
Message-ID: <20080115170821.9A9071C181AD@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Jan 10 20:27:56 2008
New Revision: 1746

Log:
started working on terrain raypick

Modified:
    trunk/include/terrain.h
    trunk/src/scripting.iris.cpp
    trunk/src/terrain_multitex.cpp

Modified: trunk/include/terrain.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/terrain.h (original)
+++ trunk/include/terrain.h Thu Jan 10 20:27:56 2008
@@ -17,4 +17,12 @@
 void	 		TerrainMultiTex_SetGroundMaterialTypeLookUp	(const int* piValues,c=
onst int iCount);
 void			TerrainMultiTex_AddTexCoordSet				(int iMode,float tx,float ty,floa=
t tw,float th); ///< 0:ground,1:mainmask,2:mask
 void			TerrainMultiTex_AddMaskTexCoordSet			(float u1,float v1, float u2,f=
loat v2, float u3,float v3, float u4,float v4);
+
+
+/// returns true if something was hit
+/// output : float& pfHitDist,int& pTX,int& pTY
+/// the terrain is assumed to start at 0,0,0,  if this is not the case, ju=
st adjust the ray origin : rx,ry,rz
+/// tx,ty are the relative tile coordinates, in the range [0,8*dx[ , [0,8*=
dy[ =

+bool			TerrainMultiTex_RayPick		(cGroundBlockLoader* pGroundBlockLoader,co=
nst int iBlockX,const int iBlockY,const int iDX,const int iDY,const Ogre::V=
ector3& vRayPos,const Ogre::Vector3& vRayDir,float& pfHitDist,int& pTX,int&=
 pTY);
+
 #endif

Modified: trunk/src/scripting.iris.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.iris.cpp (original)
+++ trunk/src/scripting.iris.cpp Thu Jan 10 20:27:56 2008
@@ -305,6 +305,29 @@
 	return 0;
 }
 =

+/// bhit,bhitdist,tx,ty =3D MultiTexTerrain_RayPick(pGroundBlockLoader,bx,=
by,dx,dy, rx,ry,rz, rvx,rvy,rvz) -- mainly for mousepicking
+/// see also  TerrainMultiTex_RayPick (terrain.h,terrain_multitex.cpp)
+static int	l_TerrainMultiTex_RayPick			(lua_State *L) { PROFILE =

+	cGroundBlockLoader* pGroundBlockLoader =3D cLuaBind<cGroundBlockLoader>::=
checkudata_alive(L,2);
+	int bx =3D luaL_checkint(L,3);
+	int by =3D luaL_checkint(L,4);
+	int dx =3D luaL_checkint(L,5);
+	int dy =3D luaL_checkint(L,6);
+
+	// don't use ++i or something here, the compiler might mix the order
+	Ogre::Vector3	vRayPos(luaL_checknumber(L, 7),luaL_checknumber(L, 8),luaL_=
checknumber(L, 9));
+	Ogre::Vector3	vRayDir(luaL_checknumber(L,10),luaL_checknumber(L,11),luaL_=
checknumber(L,12));
+	=

+	float fHitDist =3D 0;
+	int tx =3D 0,ty =3D 0;
+	bool bHit =3D TerrainMultiTex_RayPick(pGroundBlockLoader,bx,by,dx,dy,vRay=
Pos,vRayDir,fHitDist,tx,ty);
+	lua_pushboolean(L,bHit);
+	lua_pushnumber(L,fHitDist);
+	lua_pushnumber(L,tx);
+	lua_pushnumber(L,ty);
+	return 4;
+}
+
 /// for lua : void	TerrainMultiTex_SetGroundMaterialTypeLookUp (table) =

 /// key=3Duo-ground-tiletype-id  value=3Dindex_for_AddTexCoordSet_mode_0
 /// use value=3D-1 to skip tiles
@@ -431,6 +454,7 @@
 			lua_register(L,"BuildTerrainEntity_Simple",		l_BuildTerrainEntity_Simpl=
e);
 			lua_register(L,"BuildTerrainEntity_Shaded",		l_BuildTerrainEntity_Shade=
d);
 			lua_register(L,"Gfx3D_SetMultiTexTerrain",		l_Gfx3D_SetMultiTexTerrain);
+			lua_register(L,"TerrainMultiTex_RayPick",		l_TerrainMultiTex_RayPick);
 			lua_register(L,"TerrainMultiTex_SetGroundMaterialTypeLookUp",	l_Terrain=
MultiTex_SetGroundMaterialTypeLookUp);
 			lua_register(L,"TerrainMultiTex_AddTexCoordSet",				l_TerrainMultiTex_A=
ddTexCoordSet);
 			lua_register(L,"TerrainMultiTex_AddMaskTexCoordSet",			l_TerrainMultiTe=
x_AddMaskTexCoordSet);

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Thu Jan 10 20:27:56 2008
@@ -3,7 +3,7 @@
 #include "data.h"
 #include "lugre_ogrewrapper.h"
 #include "lugre_robrenderable.h"
-#include "lugre_meshshape.h" // for TerrainRayIntersect
+#include "lugre_meshshape.h" // for RayPick
 #include "lugre_fifo.h"
 #include "data.h"
 #include <Ogre.h>
@@ -109,9 +109,9 @@
 		=

 		// write position
 		#ifdef XMIRROR
-		*++w =3D mfAddX-(x + dx);
+		*++w =3D -(mfAddX+(x + dx));
 		#else
-		*++w =3D mfAddX+(x + dx);
+		*++w =3D   mfAddX+(x + dx);
 		#endif
 		*++w =3D mfAddY+(y + dy);
 		*++w =3D GetZF(x+idx,y+idy);
@@ -171,8 +171,8 @@
 		=

 		for (ay=3D0;ay<iDY;++ay)
 		for (ax=3D0;ax<iDX;++ax) {
-			mfAddX =3D -8*ax;
-			mfAddY =3D  8*ay;
+			mfAddX =3D 8*ax;
+			mfAddY =3D 8*ay;
 			WriteToVertexBuffer(pGroundBlockLoader,bx+ax,by+ay,pWriter);
 			pWriter +=3D iVertexCountPerBlock * kVertexSizeInFloats;
 			=

@@ -196,15 +196,51 @@
 		pRobRenderOp.End();
 	}
 	=

-	/// pWriter should point to a locked vertex buffer (vram)
-	/// format has to be   p,n,uv1,uv2,uv3,uv4
-	void	WriteToVertexBuffer (cGroundBlockLoader* pGroundBlockLoader,int bx,i=
nt by,Ogre::Real* pWriter) {
+	inline Ogre::Vector3 GetVertexPos	(const int x,const int y) {
+		#ifdef XMIRROR
+		return Ogre::Vector3(-(mfAddX+float(x)),mfAddY+float(y),GetZF(x,y));
+		#else
+		return Ogre::Vector3(  mfAddX+float(x) ,mfAddY+float(y),GetZF(x,y));
+		#endif
+	}
+	=

+	/// don't call before WriteToVertexBuffer has been called at least once t=
o set up lookup tables
+	bool	RayPick		(cGroundBlockLoader* pGroundBlockLoader,const int iBlockX,c=
onst int iBlockY,const int iDX,const int iDY,const Ogre::Vector3& vRayPos,c=
onst Ogre::Vector3& vRayDir,float& pfHitDist,int& pTX,int& pTY) {
+		=

+		//~ if (!Ogre::Ray(vRayPos,vRayDir).intersects(Ogre::Sphere(Ogre::Vector=
3::ZERO,mfBoundRad + 0.1)).first) return -1;
+		bool bNothingFoundYet =3D true;
+		int x,y,k,ax,ay;
+		float myHitDist;
+		for (ay=3D0;ay<iDY;++ay)
+		for (ax=3D0;ax<iDX;++ax) {
+			mfAddX =3D 8*ax;
+			mfAddY =3D 8*ay;
+			int bx =3D iBlockX + ax;
+			int by =3D iBlockY + ay;
+			=

+			// needed for GetZF() and GetVertexPos() to work...
+			LoadNearbyData(pGroundBlockLoader,bx,by);
+			=

+			for (y=3D0;y<T;++y)
+			for (x=3D0;x<T;++x)
+			for (k=3D0;k<2;++k) { // k:face  =

+				// raypick face triangle
+				if (IntersectRayTriangle(vRayPos,vRayDir,
+					GetVertexPos(x+k,y+k),GetVertexPos(x+1,y),GetVertexPos(x,y+1),&myHitD=
ist)) {
+					if (bNothingFoundYet || myHitDist < pfHitDist) { =

+						bNothingFoundYet =3D false; =

+						pfHitDist =3D myHitDist; =

+						pTX =3D x + ax*T; =

+						pTY =3D y + ay*T;
+					}
+				}
+			}
+		}
+		return !bNothingFoundYet;
+	}
+	=

+	void	LoadNearbyData	(cGroundBlockLoader* pGroundBlockLoader,int bx,int by=
) {
 		int x,y;
-		int iMainType;	=

-		int iMainMask;	=

-		int iTypeA;		=

-		int iMaskA;	=

-		float spanx,spany;
 		=

 		// initialize void block if neccessary: used "outside" the map, e.g. on =
the borders...
 		static RawGroundBlock	myVoidBlock;
@@ -233,7 +269,6 @@
 			}
 		}
 		=

-		=

 		// load nearby blocks
 		if (pGroundBlockLoader->PrepareGroupLoading(bx,by,1)) {
 			for (y=3D0;y<3;++y)
@@ -257,6 +292,20 @@
 		// load z buffers to cache, each is used 4 times during vertex writing, =
and 4 times during normal calc
 		for (y=3D-1;y<=3DT+1;++y) =

 		for (x=3D-1;x<=3DT+1;++x) mZ[(y+1)*(T+3)+(x+1)] =3D GetZRaw(x,y); // ini=
t cache for use by GetZ
+	}
+	=

+	/// pWriter should point to a locked vertex buffer (vram)
+	/// format has to be   p,n,uv1,uv2,uv3,uv4
+	void	WriteToVertexBuffer (cGroundBlockLoader* pGroundBlockLoader,int bx,i=
nt by,Ogre::Real* pWriter) {
+		int x,y;
+		int iMainType;	=

+		int iMainMask;	=

+		int iTypeA;		=

+		int iMaskA;	=

+		float spanx,spany;
+		=

+		// GetZ can only be used after this
+		LoadNearbyData(pGroundBlockLoader,bx,by);
 		=

 		// load normals to cache, each is used 4 times during vertex writing
 		// init cache for use by GetNormal
@@ -398,3 +447,8 @@
 	gTiledMultiTexTerrain.mTexCoords_Mask.push_back(u4);
 	gTiledMultiTexTerrain.mTexCoords_Mask.push_back(v4);
 }
+
+bool	TerrainMultiTex_RayPick		(cGroundBlockLoader* pGroundBlockLoader,cons=
t int iBlockX,const int iBlockY,const int iDX,const int iDY,const Ogre::Vec=
tor3& vRayPos,const Ogre::Vector3& vRayDir,float& pfHitDist,int& pTX,int& p=
TY) {
+	return gTiledMultiTexTerrain.RayPick(pGroundBlockLoader,iBlockX,iBlockY,i=
DX,iDY,vRayPos,vRayDir,pfHitDist,pTX,pTY);
+}
+



From no-reply at zwischenwelt.org  Thu Jan 10 21:29:14 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 10 Jan 2008 20:29:14 -0000
Subject: [Iris-commit] [IRIS] r1747 - in /trunk: bin/ data/ lua/ lua/net/
	vs8/
Message-ID: <20080115170821.BB0121C1804C@zwischenwelt.org>

Author: sience
Date: Thu Jan 10 21:29:13 2008
New Revision: 1747

Log:
-some code reorganization
-net.cursor.lua split into lib.cursor.lua & net/net.cursor.lua
-net.other.lua moved to net/net.other.lua
-Tooltips fixed (now activated by server)
-new binary

Added:
    trunk/lua/lib.cursor.lua
    trunk/lua/net/net.cursor.lua
    trunk/lua/net/net.other.lua
    trunk/vs8/premake.exe   (with props)
Removed:
    trunk/lua/net.cursor.lua
    trunk/lua/net.other.lua
Modified:
    trunk/bin/iris2.exe
    trunk/data/config.lua.dist
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.3d.renderer.lua
    trunk/lua/lib.mainmenu.lua
    trunk/lua/lib.mousepick.lua
    trunk/lua/main.lua
    trunk/lua/net/net.login.lua
    trunk/lua/net/net.main.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Thu Jan 10 21:29:13 2008
@@ -3,7 +3,6 @@
 -- you can override individual settings there.
 =

 kGuiToolTipWait =3D 100
-gTooltipSupport =3D true
 =

 -- Client Identification String
 gClientVersion =3D "6.0.1.6"  -- try other version for example "4.0.11c5"

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Thu Jan 10 21:29:13 2008
@@ -17,31 +17,33 @@
 function Renderer3D:CheckForFastBatchDynamicsUpdate ()
 	if Renderer3D.gFastBatchDynamicsUpdateNeeded and =

 		(not Renderer3D.gFastBatchDynamicsUpdateNext or Renderer3D.gFastBatchDyn=
amicsUpdateNext < gMyTicks) then
-		=

+
 		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D false
-		=

+
 		-- on demand create
 		if not Renderer3D.gFastBatchDynamics then
 			Renderer3D.gFastBatchDynamics =3D CreateRootGfx3D()
 		end
-		=

+
 		-- clear
 		Renderer3D.gFastBatchDynamics:SetFastBatch()
-		=

+
+		local x,y,z
+		local qw,qx,qy,qz
 		-- add dynamics
 		for k,dynamic in pairs(GetDynamicList()) do
 			if (dynamic.meshname and DynamicIsInWorld(dynamic)) then
 				if (self:IsZLayerVisible(dynamic.zloc)) then
-						local x,y,z =3D Renderer3D:UOPosToLocal (dynamic.xloc,dynamic.yloc,d=
ynamic.zloc * 0.1) =

-						local qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
+						x,y,z =3D Renderer3D:UOPosToLocal (dynamic.xloc,dynamic.yloc,dynamic=
.zloc * 0.1) =

+						qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
 						Renderer3D.gFastBatchDynamics:FastBatch_AddMesh(dynamic.meshname, x,=
y,z, qw,qx,qy,qz, -1,1,1)
 				end
 			end
 		end
-		=

+
 		Renderer3D.gFastBatchDynamics:SetCastShadows(gDynamicsCastShadows)
 		Renderer3D.gFastBatchDynamics:FastBatch_Build()
-		=

+
 		Renderer3D.gFastBatchDynamicsUpdateNext =3D gMyTicks + Renderer3D.gFastB=
atchDynamicsUpdateNextTimout
 	end
 end

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Thu Jan 10 21:29:13 2008
@@ -144,8 +144,8 @@
 =

 --gobal tree params
 -- TODO: put them into an array
-gTreeParameters =3D nil
-gTreeStemParameters =3D nil
+Renderer3D.gTreeParameters =3D nil
+Renderer3D.gTreeStemParameters =3D nil
 =

 -- handles the entity creation for CreateMapChunk and adds it to chunk.lSt=
aticEntities
 function Renderer3D:CreateMapChunkEntity (chunk,iTileTypeID,iXLoc,iYLoc,iZ=
Loc,iHue)
@@ -170,20 +170,19 @@
 	entity.iHue =3D iHue
 	=

 	local meshname =3D (not gForceFallBackBillboards_Statics) and GetStaticMe=
shName(iTileTypeID,entity.iHue)
-
 --[[
 --------------------------------------------------------------------------=
---------------------------------------------------
 	-- just to test the cadunetree generation code
 	if ((iTileTypeID =3D=3D 3296) or (iTileTypeID =3D=3D 3297)) then
-		if (not gTreeParameters) then
-			gTreeParameters =3D CreateCaduneTreeParameters()
-			gTreeStemParameters =3D CreateCaduneTreeStem(gTreeParameters)
-			gTreeStemParameters:Grow()
+		if (not self.gTreeParameters) then
+			self.gTreeParameters =3D CreateCaduneTreeParameters()
+			self.gTreeStemParameters =3D CreateCaduneTreeStem(self.gTreeParameters)
+			self.gTreeStemParameters:Grow()
 		end
 =

 		if (iTileTypeID =3D=3D 3296) then
 			print("generate tree")
-			entity.gfx =3D gTreeStemParameters:CreateGeometry()
+			entity.gfx =3D self.gTreeStemParameters:CreateGeometry()
 =

 			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
 			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
@@ -193,7 +192,7 @@
 		end
 		if (iTileTypeID =3D=3D 3297) then
 			print("generate leaves")
-			entity.gfx =3D gTreeStemParameters:CreateLeaves()
+			entity.gfx =3D self.gTreeStemParameters:CreateLeaves()
 	=

 			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
 			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )

Modified: trunk/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.renderer.lua (original)
+++ trunk/lua/lib.3d.renderer.lua Thu Jan 10 21:29:13 2008
@@ -404,14 +404,14 @@
 --###############################
 --###       QUEST ARROW       ###
 --###############################
-gQuestArrow =3D nil
+Renderer3D.gQuestArrow =3D nil
 =

 function Renderer3D:ShowQuestArrow( active, x, y )
 	if (active=3D=3D1) then
-		if (not gQuestArrow) then
-			gQuestArrow =3D CreateRootGfx3D()
-			gQuestArrow:SetSimpleRenderable()
-			gQuestArrow:SetMaterial("quest_arrow")
+		if (not self.gQuestArrow) then
+			self.gQuestArrow =3D CreateRootGfx3D()
+			self.gQuestArrow:SetSimpleRenderable()
+			self.gQuestArrow:SetMaterial("quest_arrow")
 		end
 =

 		local nx,ny,nz =3D 0,0,1
@@ -422,20 +422,20 @@
 		local a =3D 0.6
 		local e =3D 0.3
 =

-		gQuestArrow:RenderableBegin(4,6,false,false,OT_TRIANGLE_LIST)
-		gQuestArrow:RenderableVertex(-e,-e,0, nx,ny,nz, 0,0, r,g,b,a)
-		gQuestArrow:RenderableVertex( e,-e,0, nx,ny,nz, 1,0, r,g,b,a)
-		gQuestArrow:RenderableVertex(-e, e,0, nx,ny,nz, 0,1, r,g,b,a)
-		gQuestArrow:RenderableVertex( e, e,0, nx,ny,nz, 1,1, r,g,b,a)
-		gQuestArrow:RenderableIndex3(0,1,2)
-		gQuestArrow:RenderableIndex3(1,3,2)
-		gQuestArrow:RenderableEnd()
-		gQuestArrow:SetForceRotCam(GetMainCam())
-		gQuestArrow:SetPosition( self:UOPosToLocal(0.5 + x,0.5 + y,0.1 + ( iZLoc=
+30) * 0.1) )
+		self.gQuestArrow:RenderableBegin(4,6,false,false,OT_TRIANGLE_LIST)
+		self.gQuestArrow:RenderableVertex(-e,-e,0, nx,ny,nz, 0,0, r,g,b,a)
+		self.gQuestArrow:RenderableVertex( e,-e,0, nx,ny,nz, 1,0, r,g,b,a)
+		self.gQuestArrow:RenderableVertex(-e, e,0, nx,ny,nz, 0,1, r,g,b,a)
+		self.gQuestArrow:RenderableVertex( e, e,0, nx,ny,nz, 1,1, r,g,b,a)
+		self.gQuestArrow:RenderableIndex3(0,1,2)
+		self.gQuestArrow:RenderableIndex3(1,3,2)
+		self.gQuestArrow:RenderableEnd()
+		self.gQuestArrow:SetForceRotCam(GetMainCam())
+		self.gQuestArrow:SetPosition( self:UOPosToLocal(0.5 + x,0.5 + y,0.1 + ( =
iZLoc+30) * 0.1) )
 	else
-		if (gQuestArrow) then
-			gQuestArrow:Destroy()
-			gQuestArrow=3Dnil
+		if (self.gQuestArrow) then
+			self.gQuestArrow:Destroy()
+			self.gQuestArrow=3Dnil
 		end
 	end
 end

Modified: trunk/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.lua (original)
+++ trunk/lua/lib.mainmenu.lua Thu Jan 10 21:29:13 2008
@@ -68,7 +68,7 @@
 		ProtocolSend_GameServer_Select(server.index or 0) -- 0xA0 kPacket_Server=
_Select =

 		-- answered by kPacket_Server_Redirect 0x8C, =

 		-- which calls ProtocolSend_GameServer_PostLogin kPacket_Post_Login 0x91 =

-		-- answered by kPacket_Features 0xB9 (gClientFeatures)  and  kPacket_Cha=
racter_List 0xA9 which calls MainMenuShowCharList
+		-- answered by kPacket_Features 0xB9 and  kPacket_Character_List 0xA9 wh=
ich calls MainMenuShowCharList
 	end
 	=

 	-- if there is only one entry, select it automatically

Modified: trunk/lua/lib.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mousepick.lua (original)
+++ trunk/lua/lib.mousepick.lua Thu Jan 10 21:29:13 2008
@@ -48,7 +48,7 @@
 -- TODO : maybe only send on mouseup if no dragdrop took place ?
 function IrisSingleClick ()
 	if (IsTargetModeActive()) then =

-		CompleteTargetMode() -- see net.cursor.lua
+		CompleteTargetMode() -- see net/net.cursor.lua
 	else
 		local iSerial =3D gCurrentRenderer:GetMouseHitSerial()
 		if (iSerial and iSerial ~=3D 0) then =


Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Thu Jan 10 21:29:13 2008
@@ -77,6 +77,7 @@
 dofile(libpath .. "lib.test.lua")
 dofile(libpath .. "lib.filepath.lua")
 dofile(libpath .. "lib.loading.lua")
+dofile(libpath .. "lib.cursor.lua")
 dofile(libpath .. "lib.mainmenu.lua")
 dofile(libpath .. "lib.debugmenu.lua")
 dofile(libpath .. "lib.pagedialog.lua")

Modified: trunk/lua/net/net.login.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.login.lua (original)
+++ trunk/lua/net/net.login.lua Thu Jan 10 21:29:13 2008
@@ -1,8 +1,7 @@
 -- packet handlers for game startup
 -- see also lib.packet.lua and lib.protocol.lua
 =

--- index on which server we play (maybe it's important later)
-gServerNumber =3D 0
+gTooltipSupport =3D false
 =

 -- TODO : write Set_ClientFeatures function !!
 function gPacketHandler.kPacket_Server_List () --0xa8 - Recieve Serverlist=
 from LoginServer
@@ -11,12 +10,11 @@
 	local serverlist =3D {}
 	serverlist.size =3D input:PopNetUint16()
 	serverlist.flags =3D input:PopNetUint8()
-	serverlist.iServerNumber =3D input:PopNetUint16()
+	serverlist.iServerNumber =3D input:PopNetUint16()	-- index on which serve=
r we play (maybe it's important later)
 	printdebug("login",sprintf("NET: server list: size=3D0x%04x flags=3D0x%02=
x number=3D0x%04x\n",serverlist.size,serverlist.flags,serverlist.iServerNum=
ber))
 =

 	-- use flag to find out the server emulator
 	gServerEmulator	=3D serverlist.flags
-	gServerNumber	=3D serverlist.iServerNumber
 	printdebug("login",sprintf("-> Emulator=3D: %s\n",gServerType[gServerEmul=
ator] or "Unknown Server"))
 =

 	serverlist.servers =3D {}
@@ -28,7 +26,7 @@
 		server.tz =3D input:PopNetUint8() -- timezone
 		server.ip =3D input:PopNetUint32()
 		serverlist.servers[i] =3D server
-		-- NET: [0] 'RunUO Test Center' full=3D0 tz=3D2 ip=3Dac21c658
+
 		printdebug("login",sprintf("NET: [%i] '%s' full=3D%i tz=3D%i ip=3D%x\n",=
server.index,server.name,server.full,server.tz,server.ip))
 	end
 	MainMenuShowServerList(serverlist)
@@ -76,21 +74,21 @@
 function gPacketHandler.kPacket_Server_Redirect ()
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
-	gGameServerIP =3D input:PopNetUint32()
-	gGameServerPort =3D input:PopNetUint16()
-	gGameServerAccount =3D input:PopNetUint32()
+	local gameserverip =3D input:PopNetUint32()
+	local gameserverport =3D input:PopNetUint16()
+	local gameserveraccount =3D input:PopNetUint32()
 	printdebug("login",sprintf("NET: server redirect: id=3D%i ip=3D%x port=3D=
%i AccountNr.:0x%08x\n",
-			id,gGameServerIP,gGameServerPort,gGameServerAccount))
-	printdebug("login",sprintf("DEBUG IP STRINGS %s <> %s\n",NtoA(gGameServer=
IP),GetHostByName(gLoginServerIP)))
+			id,gameserverip,gameserverport,gameserveraccount))
+	printdebug("login",sprintf("DEBUG IP STRINGS %s <> %s\n",NtoA(gameserveri=
p),GetHostByName(gLoginServerIP)))
 =

 	-- login & gameserver are not the same: redirect is received
-	if ((gServerType[gServerEmulator] =3D=3D "SpherePolUox3") or (NtoA(gGameS=
erverIP) ~=3D GetHostByName(gLoginServerIP)) or (gGameServerPort ~=3D gLogi=
nServerPort)) then
+	if ((gServerType[gServerEmulator] =3D=3D "SpherePolUox3") or (NtoA(gamese=
rverip) ~=3D GetHostByName(gLoginServerIP)) or (gameserverport ~=3D gLoginS=
erverPort)) then
 		--disconnect from Loginserver
 		printdebug("login","NET: disconnect from loginserver")
 		NetDisconnect()
 		--connect to gameserver
 		printdebug("login","NET: connect to gameserver")
-		local res =3D NetConnectWithKey(NtoA(gGameServerIP),gGameServerPort,gGam=
eServerAccount)
+		local res =3D NetConnectWithKey(NtoA(gameserverip),gameserverport,gamese=
rveraccount)
 		if (not res) then
 			FatalErrorMessage("kPacket_Server_Redirect : login server redirect fail=
ed")
 		end
@@ -100,7 +98,7 @@
 	if (gHuffmanCompression) then
 		NetStartHuffman()
 	end
-	ProtocolSend_GameServer_PostLogin(gLoginname,gPassword,gGameServerAccount)
+	ProtocolSend_GameServer_PostLogin(gLoginname,gPassword,gameserveraccount)
 end
 =

 -- Receive Client Features - this enabled several Features in Client   kPa=
cket_Features 0xB9
@@ -117,8 +115,8 @@
 function gPacketHandler.kPacket_Features ()
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
-	gClientFeatures =3D input:PopNetUint16()
-	printdebug("login",sprintf("NET: Client features received: 0x%04x\n",gCli=
entFeatures))
+	local clientfeatures =3D input:PopNetUint16()
+	printdebug("login",sprintf("NET: Client features received: 0x%04x\n",clie=
ntfeatures))
 end
 =

 -- Receive Character List from GameServer
@@ -160,8 +158,13 @@
 	charlist.flags =3D input:PopNetUint32()
 	printdebug("login",sprintf("ServerFlag: 0x%08x\n",charlist.flags))
 =

-	-- diable tooltip support for preAos servers (<0x8)
-	if ( TestBit(charlist.flags,hex2num("0x08")) ) then gTooltipSupport=3Dfal=
se end
+	--Flags list: =

+	--0x02 =3D send config/req logout (IGR?) =

+	--0x04 =3D single character (siege) =

+	--0x08 =3D enable npcpopup menus =

+	--0x10 =3D unknown =

+	--0x20: enable common AOS features (tooltip thing/fight system book, but =
not AOS monsters/map/skills) =

+	if ( TestBit(charlist.flags,hex2num("0x20")) ) then gTooltipSupport=3Dtru=
e end
 =

 	--[[
 	Flags (each flag is for each feature, if you need to combine features, yo=
u need to summ flags):
@@ -307,7 +310,7 @@
 =

 -- send postlogin to gameserver  kPacket_Post_Login 0x91
 -- something is wrong...runuo & wolfpack detects invalid client
--- answered by kPacket_Features 0xB9 (gClientFeatures)  and  kPacket_Chara=
cter_List 0xA9
+-- answered by kPacket_Features 0xB9 and  kPacket_Character_List 0xA9
 function ProtocolSend_GameServer_PostLogin(sName,sPassword,iAccount)
 	printdebug("login",sprintf("NET: GameServer_PostLogin: Name: %s Password:=
 %s AccountNr.: 0x%08x\n",sName,sPassword,iAccount))
 	local out =3D GetSendFIFO()
@@ -328,7 +331,7 @@
 	out:PushFilledString(gCharacterList[iCharacterID].name,30)
 	out:PushFilledString(gCharacterList[iCharacterID].pw,30)
 	out:PushNetUint32(iCharacterID)
-	out:PushNetUint32(hex2num("0xC0A83016"))	--out:PushNetUint32(gGameServerI=
P)		--TODO: check: iAccount or gGameServerIP
+	out:PushNetUint32(hex2num("0xC0A83016"))	--TODO: check: iAccount or GameS=
erverIP
 	out:SendPacket()
 end
 =


Modified: trunk/lua/net/net.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.main.lua (original)
+++ trunk/lua/net/net.main.lua Thu Jan 10 21:29:13 2008
@@ -11,12 +11,12 @@
 dofile(libpath .. "net/net.skill.lua")
 dofile(libpath .. "net/net.buff.lua")
 dofile(libpath .. "net/net.aoscommand.lua")
+dofile(libpath .. "net/net.cursor.lua")
+dofile(libpath .. "net/net.other.lua")
 =

 -- only things that have at least 2 packets get its own file, everything e=
lse is handled here:
 dofile(libpath .. "net/net.packethandlers.lua")
 =

-dofile(libpath .. "net.cursor.lua")
-dofile(libpath .. "net.other.lua")
 dofile(libpath .. "net.popup.lua")
 dofile(libpath .. "net.trade.lua")
 dofile(libpath .. "net.securetrade.lua")



From no-reply at zwischenwelt.org  Thu Jan 10 17:24:24 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 10 Jan 2008 16:24:24 -0000
Subject: [Iris-commit] [IRIS] r1745 - /trunk/src/terrain_multitex.cpp
Message-ID: <20080115170821.55F5A1C18004@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Jan 10 17:24:23 2008
New Revision: 1745

Log:
multitex-terrain tile-skipping bugfix

Modified:
    trunk/src/terrain_multitex.cpp

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Thu Jan 10 17:24:23 2008
@@ -180,9 +180,7 @@
 			for (y=3D0;y<T;++y)
 			for (x=3D0;x<T;++x) {
 				if (GetType(x,y) < 0) { // skipped
-					pRobRenderOp.Index(0,0,0);
-					pRobRenderOp.Index(0,0,0);
-					//~ pRobRenderOp.SkipIndices(6);  // TODO : BUG : this crashes, no id=
ea why
+					pRobRenderOp.SkipIndices(6);
 					continue;
 				}
 				i =3D ai + (y*T+x)*4;
@@ -272,12 +270,11 @@
 		for (y=3D0;y<T;++y)
 		for (x=3D0;x<T;++x) {
 			iMainType	=3D GetType(x,y);
-			if (iMainType < 0) iMainType =3D 0;
-			//~ if (iMainType < 0) { w +=3D kVertexSizeInFloats*4; continue; }
+			//~ if (iMainType < 0) iMainType =3D 0;
+			if (iMainType < 0) { w +=3D kVertexSizeInFloats*4; continue; }
 			iMainMask	=3D 0; // IsTerrainTypeNodraw(iMainType) ? 1 : 0; // 0=3Dfull=
y visible, 1=3Dfully transparent (nodraw tiles)
 			iTypeA		=3D GetMostFrequentNeighboorType(x,y,iMainType);
-			iMaskA		=3D (iTypeA =3D=3D iMainType || iTypeA < 0) ? 0 : GenerateTrans=
itionMask(x,y,iTypeA);
-			if (iTypeA < 0) iTypeA =3D 0;
+			iMaskA		=3D (iTypeA =3D=3D iMainType) ? 0 : GenerateTransitionMask(x,y,=
iTypeA);
 			spanx =3D float(x % 4);
 			spany =3D float(y % 4);
 			=




From no-reply at zwischenwelt.org  Fri Jan 11 20:12:17 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 11 Jan 2008 19:12:17 -0000
Subject: [Iris-commit] [IRIS] r1749 - in /trunk: bin/iris2.exe
 data/config.lua.dist lua/filter/filter.art.lua lua/lib.debugmenu.lua
 lua/lib.mainmenu.lua lua/main.lua
Message-ID: <20080115170822.BE3211C18004@zwischenwelt.org>

Author: sience
Date: Fri Jan 11 20:12:16 2008
New Revision: 1749

Log:
-new binary
-shard profile options added (gCustomArtFilterFilePath, gStartInDebugMode)

Modified:
    trunk/bin/iris2.exe
    trunk/data/config.lua.dist
    trunk/lua/filter/filter.art.lua
    trunk/lua/lib.debugmenu.lua
    trunk/lua/lib.mainmenu.lua
    trunk/lua/main.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Fri Jan 11 20:12:16 2008
@@ -159,6 +159,14 @@
 		gPolServer =3D false
 	}
 =

+gShardList["#offline"] =3D { =

+		gStartGameWithoutNetwork =3D true
+	}
+
+gShardList["#debug"] =3D { =

+		gStartInDebugMode =3D true
+	}
+
 -- in config.lua you can add shards like this: 	=

 -- gShardList["myshard"] =3D { ..... } =

 =

@@ -171,10 +179,15 @@
 -- gShardList["localhost"].gLoginServerPort=3D5003
 -- gShardList["localhost"].gGameServerPort=3D5003
 =

+-- you can specify a specialised filter file for your shard
+-- gShardList["localhost"].gCustomArtFilterFilePath =3D "data\\iris.filter=
.lua"
+
 =

 -- Standard Serversettings
 --------------------------
 gStartGameWithoutNetwork =3D false
+gStartInDebugMode =3D false
+gCustomArtFilterFilePath =3D ""
 =

 gServerEmulator=3D0
 gServerType =3D {

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Fri Jan 11 20:12:16 2008
@@ -3,8 +3,11 @@
 =

 --FILTER: map Mesh to other Mesh
 function FilterMesh(iTranslatedTileTypeID)
-	if (gArtFilter[iTranslatedTileTypeID]) then
-		return gArtFilter[iTranslatedTileTypeID].maptoid
+	local f =3D gArtFilter[iTranslatedTileTypeID]
+	if (f) then
+		if (f.maptoid) then
+			return gArtFilter[iTranslatedTileTypeID].maptoid
+		end
 	end
 	return iTranslatedTileTypeID
 end

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Fri Jan 11 20:12:16 2008
@@ -248,6 +248,7 @@
 =

 function StartDebugMenu ()
 	--CrashSegFault() -- testing =3DD
+	gStartInDebugMode =3D true
 	gDebugMenuRunning =3D true
 	gDialog_IrisLogo:SetVisible(false)
 	gCurrentRenderer:Init()

Modified: trunk/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.lua (original)
+++ trunk/lua/lib.mainmenu.lua Fri Jan 11 20:12:16 2008
@@ -190,14 +190,22 @@
 	gCharCreateDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefa=
ultStyleSet,"window")
 end
 =

+function LoadShardfilter(filterfilepath)
+	if (filterfilepath) then
+		if (file_exists(gMainWorkingDir..filterfilepath) ) then
+			print("Load custom shard-specific Filter: "..gMainWorkingDir..filterfil=
epath)
+			dofile(gMainWorkingDir..filterfilepath)
+		else
+			print("Shard-specific Filter not found: "..gMainWorkingDir..filterfilep=
ath)
+		end
+	end
+end
 =

 function MainMenuShowLoginDialog (shard,shardname)
 	-- TODO : unfinished, pol server options...
 	=

 	local MyLogin =3D function (widget) =

 		local shard =3D widget.shard
-		--shard.gGameServerIP 	=3D 			widget.dialog.controls["gameserverinput"].=
plaintext
-		--shard.gGameServerPort 	=3D tonumber(	widget.dialog.controls["gameporti=
nput"].plaintext)
 		shard.gLoginServerIP 	=3D 			widget.dialog.controls["loginserverinput"].=
plaintext
 		shard.gLoginServerPort 	=3D tonumber(	widget.dialog.controls["loginporti=
nput"].plaintext)
 		local nameinput =3D widget.dialog.controls["nameinput"].plaintext
@@ -209,10 +217,6 @@
 	end
 	local rows =3D {
 		{	{type=3D"Label",		text=3D"Login"} },
-		=

-		--{	{type=3D"Label",		text=3D"GameServer:"},
-		--	{type=3D"EditText",	w=3D300,h=3D16,text=3D(shard.gGameServerIP or "")=
,controlname=3D"gameserverinput"} ,
-		--	{type=3D"EditText",	w=3D100,h=3D16,text=3D(shard.gGameServerPort or "=
"),controlname=3D"gameportinput"}  },
 			=

 		{	{type=3D"Label",		text=3D"LoginServer:"},
 			{type=3D"EditText",	w=3D300,h=3D16,text=3D(shard.gLoginServerIP or ""),=
controlname=3D"loginserverinput"},
@@ -231,8 +235,16 @@
 		{	{type=3D"Button",onLeftClick=3DMyLogin,shard=3Dshard,shardname=3Dshard=
name,text=3D"Login"}, },
 		=

 	}
-	=

-	gLoginDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefaultSt=
yleSet,"window")
+
+	LoadShardfilter(shard.gCustomArtFilterFilePath)
+
+	if (shard.gStartGameWithoutNetwork =3D=3D true) then
+		StartOfflineMode()
+	elseif(shard.gStartInDebugMode =3D=3D true) then
+		StartDebugMenu()
+	else
+		gLoginDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefaultS=
tyleSet,"window")
+	end
 end
 =

 function GetShardButtonText (shard,shardname)
@@ -278,19 +290,17 @@
 	for shardname,shard in pairs(gShardList) do
 		table.insert(rows,{ {type=3D"Button",	onLeftClick=3Dfun,shard=3Dshard,sh=
ardname=3Dshardname,text=3DGetShardButtonText(shard,shardname)} })
 	end
-	=

-	table.insert(rows,{ {type=3D"Button",text=3D"#gfx-config",onLeftClick=3Df=
unction () =

+
+	table.insert(rows,{ {type=3D"Button",text=3D"#gfx-config",onLeftClick=3Df=
unction ()
+		StopMainMenu()
 		if (Client_ShowOgreConfig()) then
 			DisplayNotice("please restart iris2 for the changes to take effekt")
 			Exit() -- Terminate()  -- terminate softly is not enough, no frame can =
be drawn since ogre::root has to be killed for fullscreen switch
 			-- todo : reinit ogre here ? might loose already loaded textures =3D(
 		end	=

 		end } })
-	table.insert(rows,{ {type=3D"Button",text=3D"#offline",onLeftClick=3Dfunc=
tion () StopMainMenu() StartOfflineMode() end } })
-	table.insert(rows,{ {type=3D"Button",text=3D"#debug",onLeftClick=3Dfuncti=
on () StopMainMenu() StartDebugMenu() end } })
+--	table.insert(rows,{ {type=3D"Button",text=3D"#debug",onLeftClick=3Dfunc=
tion () StopMainMenu() StartDebugMenu() end } })
 	table.insert(rows,{ {type=3D"Button",text=3D"#exit",onLeftClick=3Dfunctio=
n () Terminate() end } })
-	=

---	gMainMenuDialog =3D guimaker.MakeTableDlg(rows,10,10)
 =

 	MainMenuSetBackground_Sky()
 =


Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Fri Jan 11 20:12:16 2008
@@ -284,10 +284,10 @@
 		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique =
=3D=3D "texture_additive")) then
 			OgreSetShadowTextureSize(2048)
 			OgreSetShadowTextureSelfShadow(false)
-			OgreSetShadowFarDistance(gSightRange*18.0)
-			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --only for accuracy
 			--OgreSetShadowTextureCasterMaterial(matname)
 			--OgreSetShadowTextureReceiverMaterial(matname)
+			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --only for accuracy
+			OgreSetShadowFarDistance(gSightRange*18.0)
 		end
 	end
 =

@@ -323,8 +323,6 @@
 	gFadeLineOffY =3D 30 + gFadeLineTextH
 =

 	StartMainMenu()
-
-	if (gStartInDebugMode) then StopMainMenu() StartDebugMenu() end
 =

 	-- mainloop
 	while (Client_IsAlive()) do =




From no-reply at zwischenwelt.org  Sat Jan 12 02:28:19 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 01:28:19 -0000
Subject: [Iris-commit] [IRIS] r1750 - in /trunk: data/config.lua.dist
 lua/lib.3d.dynamic.lua lua/lib.3d.map.lua
Message-ID: <20080115170823.7E5AD1C1804C@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 12 02:28:19 2008
New Revision: 1750

Log:
textatlas tools

Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.map.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Jan 12 02:28:19 2008
@@ -431,3 +431,4 @@
 gModelPath_Tex	=3D "models/textures/"
 --~ gModelPath_Mesh	=3D "models/models_texatlas/"
 --~ gModelPath_Tex	=3D "models/textures_texatlas/"
+gUseTexAtlas =3D true -- only used if fastbatch is active

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sat Jan 12 02:28:19 2008
@@ -155,6 +155,7 @@
 		if gFastBatchDynamics and meshname and meshname ~=3D false then
 			-- trigger: burn all dynamics into the dynamic fastbatch
 			item.meshbuffer =3D GetMeshBuffer(meshname) -- for mousepicking
+			TexAtlas_AdjustMeshBufferIfNeeded(meshname,item.meshbuffer)
 			Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
 		else
 			-- just add the dynamic as a scene node

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sat Jan 12 02:28:19 2008
@@ -17,6 +17,7 @@
 function Renderer3D:ZToLayer(zloc)
 	return math.floor(zloc / Renderer3D.giBlendOutPlayerHeight)
 end
+
 function Renderer3D:LayerToZ(zlayer)
 	return zlayer * Renderer3D.giBlendOutPlayerHeight
 end
@@ -217,6 +218,7 @@
 =

 		if (gFastBatchStatics) then
 			entity.meshbuffer =3D GetMeshBuffer(meshname) -- for mousepicking
+			TexAtlas_AdjustMeshBufferIfNeeded(meshname,entity.meshbuffer)
 			if (not self.giBlendOutCurZ) or entity.zloc <=3D self.giBlendOutCurZ th=
en
 				chunk.fastbatch:FastBatch_AddMesh(meshname,entity.x,entity.y,entity.z,=
 qw,qx,qy,qz, sx,sy,sz)
 			end



From no-reply at zwischenwelt.org  Sat Jan 12 02:53:55 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 01:53:55 -0000
Subject: [Iris-commit] [IRIS] r1751 - in /trunk/data/models/models:
 alpha_tex_atlas.material alpha_tex_atlas_0.png alpha_tex_atlas_map.lua
 generate_all.sh generate_tex_atlas.php tex_atlas.material tex_atlas_0.png
 tex_atlas_map.lua
Message-ID: <20080115170823.A99EB1C18004@zwischenwelt.org>

Author: hagish
Date: Sat Jan 12 02:53:54 2008
New Revision: 1751

Log:
atlas on the fly mapping test data

Added:
    trunk/data/models/models/alpha_tex_atlas.material
    trunk/data/models/models/alpha_tex_atlas_0.png   (with props)
    trunk/data/models/models/alpha_tex_atlas_map.lua
    trunk/data/models/models/tex_atlas.material
    trunk/data/models/models/tex_atlas_0.png   (with props)
    trunk/data/models/models/tex_atlas_map.lua
Modified:
    trunk/data/models/models/generate_all.sh
    trunk/data/models/models/generate_tex_atlas.php

Modified: trunk/data/models/models/generate_all.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_all.sh (original)
+++ trunk/data/models/models/generate_all.sh Sat Jan 12 02:53:54 2008
@@ -1,7 +1,7 @@
 #!/bin/bash
 =

 ATLASSIZE=3D2048
-TEXSIZE=3D256
+TEXSIZE=3D128
 =

 rm -f tex_atlas*
 rm -f alpha_tex_atlas*
@@ -9,6 +9,6 @@
 find -name \*.mesh.xml | sort > xml.txt
 php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE
 php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE alpha
-find -name \*.mesh -exec ./tomesh.sh {} \;
+#find -name \*.mesh -exec ./tomesh.sh {} \;
 find -name \*.xml -exec rm {} \;
 rm xml.txt

Modified: trunk/data/models/models/generate_tex_atlas.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_tex_atlas.php (original)
+++ trunk/data/models/models/generate_tex_atlas.php Sat Jan 12 02:53:54 2008
@@ -186,6 +186,8 @@
 =

 // ####################################################################
 // ####################################################################
+
+$gTextureAtlasMap =3D array();
 =

 $filelist =3D $argv[1];
 $atlassize =3D $argv[2];
@@ -367,11 +369,14 @@
 	list($left,$top,$right,$bottom) =3D BlendImageAtSlot($im, $tex["file"], $=
px, $py, $b, $tw, $th, $ow, $oh);
 	=

 	if($right > 0 && $bottom > 0){
+		$gTextureAtlasMap[] =3D array($mat, $atlasname, $left,$top,$right,$botto=
m);
+		=

+		/*
 		// remap meshes
-		=

 		foreach($tex["meshs"] as $mesh){
 			RemapUV($mesh,$left,$top,$right,$bottom,$tw,$th,$w,$h,$atlasname,$mat);
 		}
+		*/
 	}
 =

 	// next on x
@@ -422,4 +427,23 @@
 =

 }
 =

+if($doalpha){
+	$atlasmapname =3D "alpha_tex_atlas_map.lua";
+} else {		=

+	$atlasmapname =3D "tex_atlas_map.lua";
+}
+
+$f =3D fopen($atlasmapname, "w");
+foreach($gTextureAtlasMap as $x){
+	list($mat, $atlasname, $left,$top,$right,$bottom) =3D $x;
+	=

+	$left /=3D $atlassize;
+	$top /=3D $atlassize;
+	$right /=3D $atlassize;
+	$bottom /=3D $atlassize;
+	=

+	fwrite($f, "TexAtlas_RegisterMatTransform('$mat', '$atlasname', $left,$to=
p,$right,$bottom)\n");
+}
+fclose($f);
+
 ?>



From no-reply at zwischenwelt.org  Sat Jan 12 03:26:29 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 02:26:29 -0000
Subject: [Iris-commit] [IRIS] r1752 - /trunk/lua/main.lua
Message-ID: <20080115170823.C5CE11C1817E@zwischenwelt.org>

Author: hagish
Date: Sat Jan 12 03:26:29 2008
New Revision: 1752

Log:
load tex atlas map

Modified:
    trunk/lua/main.lua

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Jan 12 03:26:29 2008
@@ -299,6 +299,10 @@
 =

 	LoadBasicData()
 	=

+	-- load texture atlas mappings
+	dofile(datapath .. "models/models/alpha_tex_atlas_map.lua")
+	dofile(datapath .. "models/models/tex_atlas_map.lua")
+	=

 	-- show loading screen
 	SetLoadingBackground()
 	Client_RenderOneFrame() -- first frame rendered with ogre, needed for ini=
t of viewport size



From no-reply at zwischenwelt.org  Fri Jan 11 01:12:18 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 11 Jan 2008 00:12:18 -0000
Subject: [Iris-commit] [IRIS] r1748 - in /trunk: lua/lib.3d.mousepick.lua
 lua/lib.terrain.multitex.lua src/scripting.iris.cpp
Message-ID: <20080115170822.6FA7C1C181A7@zwischenwelt.org>

Author: ghoulsblade
Date: Fri Jan 11 01:12:18 2008
New Revision: 1748

Log:
started some terrain mousepick code, but not working yet

Modified:
    trunk/lua/lib.3d.mousepick.lua
    trunk/lua/lib.terrain.multitex.lua
    trunk/src/scripting.iris.cpp

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Fri Jan 11 01:12:18 2008
@@ -78,6 +78,15 @@
 =

 	local y,row,x,chunk,k,v
 	local bHit,fHitDist
+	=

+	-- terrain : new ... TODO
+	if (gEnableMultiTexTerrain) then
+		local bx,by,tx,ty
+		bHit,fHitDist,bx,by,tx,ty =3D MultiTexTerrain_RayPickAll(rx,ry,rz,rvx,rv=
y,rvz)
+		print("Renderer3D:MousePick_3D MultiTexTerrain_RayPick",bHit,fHitDist,bx=
,by,tx,ty)
+		--- TODO  : calc vars... blockx etc , register mousehit....
+	end
+	=

 	for chunky,row in pairs(self.gMapChunks) do
 		for chunkx,chunk in pairs(row) do
 			if (not chunk.bIsDead) then
@@ -111,7 +120,7 @@
 					end
 				end
 =

-				-- terrain
+				-- terrain : old
 				if (gGroundBlockLoader and self.gbBlendOutTerrainVisible) then
 					local iBlockUO_X =3D chunk.miX * self.ROBMAP_CHUNK_SIZE
 					local iBlockUO_Y =3D chunk.miY * self.ROBMAP_CHUNK_SIZE

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Fri Jan 11 01:12:18 2008
@@ -48,6 +48,7 @@
 gMultiTexTerrain_BX =3D nil
 gMultiTexTerrain_BY =3D nil
 gMultiTexTerrain_GfxList =3D {}
+kMultiTexTerrainChunkSize =3D 2
 =

 function MultiTexTerrainInit ()
 	if (not gEnableMultiTexTerrain) then return end
@@ -162,13 +163,39 @@
 	--~ MultiTexTerrain_NotifyMapChange()
 end
 =

+
+-- returns bHit,fHitDist,bx,by,tx,ty
+function MultiTexTerrain_RayPickAll(rx,ry,rz,rvx,rvy,rvz)
+	if (true) then return end
+	if (not gGroundBlockLoader) then return end
+	local d =3D kMultiTexTerrainChunkSize
+	local fHitDist =3D nil
+	local bx,by,tx,ty
+
+	for k,gfx in pairs(gMultiTexTerrain_GfxList) do =

+		local bhit,_hitdist,_tx,_ty =3D TerrainMultiTex_RayPick(gGroundBlockLoad=
er,gfx.bx,gfx.by,d,d, rx-gfx.x,ry-gfx.y,rz-gfx.z, rvx,rvy,rvz)
+		if (bhit) then
+			if ((not fHitDist) or _hitdist < fHitDist) then
+				_hitdist =3D fHitDist
+				bx,by,tx,ty =3D gfx.bx,gfx.by,_tx,_ty
+			end
+		end
+	end
+	if (fHitDist) then
+		if (tx >=3D 8) then bx =3D bx + 1   tx =3D tx - 8 end
+		if (ty >=3D 8) then by =3D by + 1   ty =3D ty - 8 end
+		return true,fHitDist,bx,by,tx,ty
+	end
+end
+
+
 function MultiTexTerrainStep ()
 	if (not gEnableMultiTexTerrain) then return end
 	if (gMultiTexTerrain_NextStep > gMyTicks) then return end
 	if (not gGroundBlockLoader) then return end
 	gMultiTexTerrain_NextStep =3D gMyTicks + kMultiTexTerrain_StepInterval
 	=

-	local chunksize =3D 2
+	local chunksize =3D kMultiTexTerrainChunkSize
 	local camx,camy,camz =3D gCurrentRenderer:GetLookAheadCamPos()
 	local bx =3D -math.floor((0.5 + gCurrentRenderer.giMapOriginX*gCurrentRen=
derer.ROBMAP_CHUNK_SIZE + camx/8)/chunksize) * chunksize
 	local by =3D  math.floor((0.5 + gCurrentRenderer.giMapOriginY*gCurrentRen=
derer.ROBMAP_CHUNK_SIZE + camy/8)/chunksize) * chunksize
@@ -191,6 +218,9 @@
 			gfx.bx =3D bx+dx
 			gfx.by =3D by+dy
 			local x,y,z =3D gCurrentRenderer:UOPosToLocal((bx+dx)*8,(by+dy)*8,0)
+			gfx.x =3D x
+			gfx.y =3D y
+			gfx.z =3D z
 			gfx:SetPosition(x,y,z)
 			Gfx3D_SetMultiTexTerrain(gfx,gGroundBlockLoader,bx+dx,by+dy,chunksize,c=
hunksize)
 			gfx:SetMaterial(MultiTexTerrainGetMat())

Modified: trunk/src/scripting.iris.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.iris.cpp (original)
+++ trunk/src/scripting.iris.cpp Fri Jan 11 01:12:18 2008
@@ -305,18 +305,18 @@
 	return 0;
 }
 =

-/// bhit,bhitdist,tx,ty =3D MultiTexTerrain_RayPick(pGroundBlockLoader,bx,=
by,dx,dy, rx,ry,rz, rvx,rvy,rvz) -- mainly for mousepicking
+/// bhit,bhitdist,tx,ty =3D TerrainMultiTex_RayPick(pGroundBlockLoader,bx,=
by,dx,dy, rx,ry,rz, rvx,rvy,rvz) -- mainly for mousepicking
 /// see also  TerrainMultiTex_RayPick (terrain.h,terrain_multitex.cpp)
 static int	l_TerrainMultiTex_RayPick			(lua_State *L) { PROFILE =

-	cGroundBlockLoader* pGroundBlockLoader =3D cLuaBind<cGroundBlockLoader>::=
checkudata_alive(L,2);
-	int bx =3D luaL_checkint(L,3);
-	int by =3D luaL_checkint(L,4);
-	int dx =3D luaL_checkint(L,5);
-	int dy =3D luaL_checkint(L,6);
+	cGroundBlockLoader* pGroundBlockLoader =3D cLuaBind<cGroundBlockLoader>::=
checkudata_alive(L,1);
+	int bx =3D luaL_checkint(L,2);
+	int by =3D luaL_checkint(L,3);
+	int dx =3D luaL_checkint(L,4);
+	int dy =3D luaL_checkint(L,5);
 =

 	// don't use ++i or something here, the compiler might mix the order
-	Ogre::Vector3	vRayPos(luaL_checknumber(L, 7),luaL_checknumber(L, 8),luaL_=
checknumber(L, 9));
-	Ogre::Vector3	vRayDir(luaL_checknumber(L,10),luaL_checknumber(L,11),luaL_=
checknumber(L,12));
+	Ogre::Vector3	vRayPos(luaL_checknumber(L, 6),luaL_checknumber(L, 7),luaL_=
checknumber(L, 8));
+	Ogre::Vector3	vRayDir(luaL_checknumber(L, 9),luaL_checknumber(L,10),luaL_=
checknumber(L,11));
 	=

 	float fHitDist =3D 0;
 	int tx =3D 0,ty =3D 0;



From no-reply at zwischenwelt.org  Sat Jan 12 03:35:35 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 02:35:35 -0000
Subject: [Iris-commit] [IRIS] r1753 - in /trunk: data/base/main.material
 lua/lib.3d.dynamic.lua lua/lib.3d.mousepick.lua lua/lib.fallback.lua
 lua/lib.static.lua
Message-ID: <20080115170823.D8FBB1C18004@zwischenwelt.org>

Author: hagish
Date: Sat Jan 12 03:35:33 2008
New Revision: 1753

Log:
static dynamic mousepicking

Modified:
    trunk/data/base/main.material
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.mousepick.lua
    trunk/lua/lib.fallback.lua
    trunk/lua/lib.static.lua

Modified: trunk/data/base/main.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/base/main.material (original)
+++ trunk/data/base/main.material Sat Jan 12 03:35:33 2008
@@ -49,6 +49,27 @@
 			texture_unit arttex
 			{
 				texture stone512.dds
+				tex_address_mode clamp
+			}
+		}
+	}
+}
+
+material fallbackbox
+{
+	technique
+	{
+		pass
+		{
+			lighting on
+			ambient 1.0 1.0 1.0
+			diffuse 1.0 1.0 1.0
+			=

+			cull_hardware anticlockwise
+		=

+			texture_unit arttex
+			{
+				texture art_fallback.png
 				tex_address_mode clamp
 			}
 		}

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sat Jan 12 03:35:33 2008
@@ -32,6 +32,7 @@
 		local qw,qx,qy,qz
 		-- add dynamics
 		for k,dynamic in pairs(GetDynamicList()) do
+			-- print("DEBUG","ADD DYNAMIC",dynamic.meshname)
 			if (dynamic.meshname and DynamicIsInWorld(dynamic)) then
 				if (self:IsZLayerVisible(dynamic.zloc)) then
 						x,y,z =3D Renderer3D:UOPosToLocal (dynamic.xloc,dynamic.yloc,dynamic=
.zloc * 0.1) =

@@ -151,6 +152,8 @@
 		-- normal 1 part object
 		local meshname =3D (not gForceFallBackBillboards_Dynamics) and GetStatic=
MeshName(item.artid) -- ,item.hue)
 		item.meshname =3D meshname
+		item.meshname =3D meshname
+		-- print("DEBUG","meshname",item.meshname)
 		=

 		if gFastBatchDynamics and meshname and meshname ~=3D false then
 			-- trigger: burn all dynamics into the dynamic fastbatch
@@ -177,19 +180,13 @@
 =

 				-- fallback to billboard with original art
 				if (not IsArtBillboardFallBackSkipped(item.artid)) then
-					if gUseWhiteBoxAsFallBack then
-						-- use just a white box as fallback
-						SetFallBackBox(item.gfx)
-						printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed lo=
ading mesh for dynamic: artid=3D%i z_typename=3D%s -> box fallback\n",item.=
artid or -1,GetStaticTileTypeName(item.artid) or ""))
-					else
-						-- generate uoart billboard fallback
-						item.gfx.billboard =3D item.gfx:CreateChild()
-						item.xadd =3D item.xadd + 0.5
-						item.yadd =3D item.yadd + 0.5
-						item.zadd =3D item.zadd + 0.5
-						self:CreateArtBillBoard(item.gfx.billboard,iTranslatedTileTypeID,ite=
m.hue)
-						printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed lo=
ading mesh for dynamic: artid=3D%i z_typename=3D%s\n",item.artid or -1,GetS=
taticTileTypeName(item.artid) or ""))
-					end
+					-- generate uoart billboard fallback
+					item.gfx.billboard =3D item.gfx:CreateChild()
+					item.xadd =3D item.xadd + 0.5
+					item.yadd =3D item.yadd + 0.5
+					item.zadd =3D item.zadd + 0.5
+					self:CreateArtBillBoard(item.gfx.billboard,iTranslatedTileTypeID,item=
.hue)
+					printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed loa=
ding mesh for dynamic: artid=3D%i z_typename=3D%s\n",item.artid or -1,GetSt=
aticTileTypeName(item.artid) or ""))
 				end
 			end
 =


Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Sat Jan 12 03:35:33 2008
@@ -191,28 +191,25 @@
 	=

 	-- dynamics
 	for k,dynamic in pairs(GetDynamicList()) do
-		if (dynamic.gfx and DynamicIsInWorld(dynamic)) then
+		if (DynamicIsInWorld(dynamic)) then
 			-- WARNING copy & paste code
 			if (self:IsZLayerVisible(dynamic.zloc)) then
-				if (dynamic.gfx.billboard) then
+				if (dynamic.gfx and dynamic.gfx.billboard) then
 					-- fallback
 					local x,y,z =3D dynamic.gfx.billboard:GetDerivedPosition()
 					fHitDist =3D SphereRayPick(x,y,z,0.5,rx,ry,rz,rvx,rvy,rvz) -- 0.5 rad
 					bHit =3D (fHitDist ~=3D nil)
-				else
+				elseif ( dynamic.meshbuffer ) then
 					-- mesh mousepick
-					if ( dynamic.meshbuffer) then
 						local x,y,z =3D Renderer3D:UOPosToLocal (dynamic.xloc,dynamic.yloc,d=
ynamic.zloc * 0.1) =

 						local qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
 						=

-						print("DEBUG",x,y,z)
-						=

 						bHit,fHitDist =3D dynamic.meshbuffer:RayPick(rx,ry,rz,rvx,rvy,rvz,
 							x,y,z, qw,qx,qy,qz, -1,1,1)
-					else
-						bHit,fHitDist =3D dynamic.gfx:RayPick(rx,ry,rz,rvx,rvy,rvz)
-					end
-					=

+				elseif ( dynamic.gfx ) then
+					bHit,fHitDist =3D dynamic.gfx:RayPick(rx,ry,rz,rvx,rvy,rvz)
+				else
+					print("WARNING visible but no mousepicking possible on dynamic",dynam=
ic.artid)
 				end
 				=

 				if (bHit and ((not gMousePickFoundHit) or fHitDist < self.gMousePickFo=
undDist)) then

Modified: trunk/lua/lib.fallback.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.fallback.lua (original)
+++ trunk/lua/lib.fallback.lua Sat Jan 12 03:35:33 2008
@@ -111,13 +111,16 @@
 	return res
 end
 =

-function SetFallBackBox (gfx)
+function GetFallBackBoxMesh ()
 	if not gFallBackBoxMesh then
-		GfxSetBox(gfx,1,1,1,nil,nil,-1,0,0)
-		local mat =3D GetPlainTextureMat("art_fallback.png")
-		gfx:SetMaterial(mat)
+		local gfx =3D CreateRootGfx3D()
+
+		GfxSetBox(gfx,1,1,1,nil,nil,0,0,0)
+		gfx:SetMaterial("fallbackbox")
+		=

 		gFallBackBoxMesh =3D gfx:RenderableConvertToMesh()
+		gfx:Destroy()
 	end
 	=

-	gfx:SetMesh(gFallBackBoxMesh)
+	return gFallBackBoxMesh
 end

Modified: trunk/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.static.lua (original)
+++ trunk/lua/lib.static.lua Sat Jan 12 03:35:33 2008
@@ -157,6 +157,12 @@
 	else
 		printdebug("static","mesh already found in cache ",meshname, iHue)
 	end
+	=

+	-- gray box fallback?
+	if gUseWhiteBoxAsFallBack and not meshname then
+		meshname =3D GetFallBackBoxMesh()
+	end
+	=

 	return meshname
 end
 =




From no-reply at zwischenwelt.org  Sat Jan 12 04:03:34 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 03:03:34 -0000
Subject: [Iris-commit] [IRIS] r1754 - /trunk/lua/lib.3d.map.lua
Message-ID: <20080115170824.226361C1804E@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 12 04:03:34 2008
New Revision: 1754

Log:
blendout upper floors fix

Modified:
    trunk/lua/lib.3d.map.lua

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sat Jan 12 04:03:34 2008
@@ -15,11 +15,13 @@
 -- every block is equivalent to one MapBlock3D
 =

 function Renderer3D:ZToLayer(zloc)
-	return math.floor(zloc / Renderer3D.giBlendOutPlayerHeight)
+	--~ return math.floor(zloc / Renderer3D.giBlendOutPlayerHeight)
+	return math.floor(zloc)
 end
 =

 function Renderer3D:LayerToZ(zlayer)
-	return zlayer * Renderer3D.giBlendOutPlayerHeight
+	--~ return zlayer * Renderer3D.giBlendOutPlayerHeight
+	return zlayer
 end
 =

 function Renderer3D:UpdateMap ()
@@ -395,19 +397,27 @@
 function Renderer3D:BlendOutLayersAbovePlayer ()
 	local x,y,z =3D GetPlayerPos()
 	if (not z or not gStaticBlockLoader or not gGroundBlockLoader) then retur=
n end
-
+	=

+	--[[
+	osi =3D wenn dach min 18z h=C3=B6her als char, dann alles von zdach aufw=
=C3=A4rts ausblenden
+	atm blendet iris statics aus, die 10 =C3=BCber dem char liegen
+	man geht in eine halle die ne art tronsaal sein soll, und hat keine hohen=
 w=C3=A4nde, sondern ne sandkasten umrandung ^^
+	ich  hab f=C3=BCr iris h=C3=B6her gebaut als normal uo etagen vorsah, bei=
 osi war 20die h=C3=B6he f=C3=BCr ne wand, =

+	]]--
+	=

 	local playerheadpos =3D z + self.giBlendOutPlayerHeight
 =

 	local myLayer =3D nil
 	local playerIsInside =3D false
 	local bTerrainVisible =3D true
+	local zloc_roof =3D nil -- becomes the minimum of the statics above the p=
layer
 	=

 	-- only blend out if not in first person mode
 	if (not Renderer3D:IsFirstPersonCam()) then =

 		=

 		-- check ground
 		local iPlayerGroundTileType,iPlayerGroundZLoc =3D GetAbsTile(x,y) =

-		if (iPlayerGroundZLoc and iPlayerGroundZLoc > playerheadpos) then player=
IsInside =3D true bTerrainVisible =3D false end
+		if (iPlayerGroundZLoc and iPlayerGroundZLoc >=3D playerheadpos) then pla=
yerIsInside =3D true bTerrainVisible =3D false end
 		=

 		-- check statics
 		if (not playerIsInside) then
@@ -419,7 +429,10 @@
 			local iTileTypeID,iX,iY,iZ,iHue
 			for i =3D 0,iStaticCount-1 do
 				iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i) -- opera=
tes on the block that was last loaded using :Load()
-				if (iX =3D=3D iPX and iY =3D=3D iPY and iZ > playerheadpos) then playe=
rIsInside =3D true end
+				if (iX =3D=3D iPX and iY =3D=3D iPY and iZ >=3D playerheadpos) then =

+					playerIsInside =3D true =

+					if ((not zloc_roof) or (zloc_roof > iZ)) then zloc_roof =3D iZ end
+				end
 			end
 		end
 =

@@ -431,8 +444,9 @@
 					for k,v in pairs(multi.lparts) do
 =

 						local iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
-						if	iX =3D=3D x and iY =3D=3D y  and iZ > playerheadpos then
+						if	iX =3D=3D x and iY =3D=3D y  and iZ >=3D playerheadpos then
 							playerIsInside =3D true
+							if ((not zloc_roof) or (zloc_roof > iZ)) then zloc_roof =3D iZ end
 						end
 					end
 				end
@@ -443,15 +457,22 @@
 		if (not playerIsInside) then
 			for k,dynamic in pairs(GetDynamicList()) do
 				if (DynamicIsInWorld(dynamic)) then
-					if (x =3D=3D dynamic.xloc and y =3D=3D dynamic.yloc and dynamic.zloc =
> playerheadpos) then
+					if (x =3D=3D dynamic.xloc and y =3D=3D dynamic.yloc and dynamic.zloc =
>=3D playerheadpos) then
 						playerIsInside =3D true
+						local iZ =3D dynamic.zloc
+						if ((not zloc_roof) or (zloc_roof > iZ)) then zloc_roof =3D iZ end
 					end
 				end
 			end
 		end
 =

 		-- blend out layers above player head if inside
-		if (playerIsInside) then myLayer =3D playerheadpos end
+		--~ if (playerIsInside) then myLayer =3D zloc_roof or playerheadpos end
+		if (playerIsInside) then =

+			myLayer =3D playerheadpos =

+			if (zloc_roof) then myLayer =3D zloc_roof - 1 end
+		end
+		--~ print("blendout",playerIsInside,playerheadpos,zloc_roof)
 	end
 =

 	-- only update if changed



From no-reply at zwischenwelt.org  Sat Jan 12 04:08:45 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 03:08:45 -0000
Subject: [Iris-commit] [IRIS] r1757 - /trunk/lua/lib.3d.map.lua
Message-ID: <20080115170826.9FBA81C18078@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 12 04:08:45 2008
New Revision: 1757

Log:
blendout debug stuff removed

Modified:
    trunk/lua/lib.3d.map.lua

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sat Jan 12 04:08:45 2008
@@ -467,12 +467,10 @@
 		end
 =

 		-- blend out layers above player head if inside
-		--~ if (playerIsInside) then myLayer =3D zloc_roof or playerheadpos end
 		if (playerIsInside) then =

 			myLayer =3D playerheadpos =

 			if (zloc_roof) then myLayer =3D zloc_roof - 1 end
 		end
-		--~ print("blendout",playerIsInside,playerheadpos,zloc_roof)
 	end
 =

 	-- only update if changed



From no-reply at zwischenwelt.org  Sat Jan 12 04:05:36 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 03:05:36 -0000
Subject: [Iris-commit] [IRIS] r1755 - in /trunk/data: config.lua.dist
 models/models/alpha_tex_atlas.material
 models/models/alpha_tex_atlas_0_512.png models/models/tex_atlas.material
 models/models/tex_atlas_0_512.png
Message-ID: <20080115170824.C75B21C1817E@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 12 04:05:32 2008
New Revision: 1755

Log:
added lowres texture atlas, and config option gLowResTexAtlasNameMap to use=
 it

Added:
    trunk/data/models/models/alpha_tex_atlas_0_512.png   (with props)
    trunk/data/models/models/tex_atlas_0_512.png   (with props)
Modified:
    trunk/data/config.lua.dist
    trunk/data/models/models/alpha_tex_atlas.material
    trunk/data/models/models/tex_atlas.material

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Jan 12 04:05:32 2008
@@ -432,3 +432,6 @@
 --~ gModelPath_Mesh	=3D "models/models_texatlas/"
 --~ gModelPath_Tex	=3D "models/textures_texatlas/"
 gUseTexAtlas =3D true -- only used if fastbatch is active
+
+-- low resolution texture atlas
+-- gLowResTexAtlasNameMap =3D { ["alpha_tex_atlas_0"]=3D"alpha_tex_atlas_0=
_512", ["tex_atlas_0"]=3D"tex_atlas_0_512" }

Modified: trunk/data/models/models/alpha_tex_atlas.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/alpha_tex_atlas.material (original)
+++ trunk/data/models/models/alpha_tex_atlas.material Sat Jan 12 04:05:32 2=
008
@@ -11,3 +11,17 @@
 		}
 	} =

 }
+
+material alpha_tex_atlas_0_512 : tex_base_alpha =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture alpha_tex_atlas_0_512.png =

+			}	=

+		}
+	} =

+}

Modified: trunk/data/models/models/tex_atlas.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/tex_atlas.material (original)
+++ trunk/data/models/models/tex_atlas.material Sat Jan 12 04:05:32 2008
@@ -11,3 +11,17 @@
 		}
 	} =

 }
+material tex_atlas_0_512 : tex_base =

+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_atlas_0_512.png =

+			}	=

+		}
+	} =

+}
+



From no-reply at zwischenwelt.org  Sat Jan 12 04:07:48 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 03:07:48 -0000
Subject: [Iris-commit] [IRIS] r1756 -
	/trunk/data/models/models/remove_uoart.sh
Message-ID: <20080115170826.4E8571C1804C@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 12 04:07:48 2008
New Revision: 1756

Log:
added script for removing the uo_art meshes

Added:
    trunk/data/models/models/remove_uoart.sh



From no-reply at zwischenwelt.org  Sat Jan 12 04:34:38 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 03:34:38 -0000
Subject: [Iris-commit] [IRIS] r1758 - /trunk/lua/lib.walking2.lua
Message-ID: <20080115170827.1F8061C181A7@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 12 04:34:37 2008
New Revision: 1758

Log:
optimized walk code a bit, commented out debugprint calls to avoid expenesi=
ve string concat

Modified:
    trunk/lua/lib.walking2.lua

Modified: trunk/lua/lib.walking2.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.walking2.lua (original)
+++ trunk/lua/lib.walking2.lua Sat Jan 12 04:34:37 2008
@@ -4,6 +4,8 @@
 gDebugWalkingDetailed =3D true =

 =

 function printwalkdebug (...) if (gDebugWalkingDetailed) then printdebug("=
walking",unpack(arg)) end end =

+
+kHex02 =3D hex2num("0x02")
 =

 -- returns tiletype,zloc
 function GetAbsTile (xloc,yloc) =

@@ -72,7 +74,7 @@
 	local t =3D GetStaticTileType(artid)
 	if (t) then
 		if ( not(isBridge(t.miFlags)) and not(isImpassable(t.miFlags)) and not(i=
sSurface(t.miFlags)) ) then
-			printwalkdebug("----" .. t.msName .."  !impassable  !bridge  !surfacebl=
ocking")
+			--~ printwalkdebug("----" .. t.msName .."  !impassable  !bridge  !surfa=
ceblocking")
 		else
 			local iHeight =3D t.miHeight
 			if (isBridge(t.miFlags)) then iHeight =3D iHeight/2 + 0.5 end -- TODO :=
 2 is the right value, but playerpos is to low
@@ -80,29 +82,32 @@
 			if (flaglist[zloc] =3D=3D nil) then
 				flaglist[zloc] =3D { }
 			end
+			local myflaglist =3D flaglist[zloc]
 			=

-			flaglist[zloc].bSurface =3D flaglist[zloc].bSurface or isSurface(t.miFl=
ags)
-			flaglist[zloc].bBridge =3D flaglist[zloc].bBridge or isBridge (t.miFlag=
s)
+			myflaglist.bSurface =3D myflaglist.bSurface or isSurface(t.miFlags)
+			myflaglist.bBridge =3D myflaglist.bBridge or isBridge(t.miFlags)
 			=

 			if (iHeight > 0) then
-				flaglist[zloc].bImpassable =3D flaglist[zloc].bImpassable or isImpassa=
ble(t.miFlags)
+				myflaglist.bImpassable =3D myflaglist.bImpassable or isImpassable(t.mi=
Flags)
 				for j=3D1, iHeight-1, 1 do
 					if (flaglist[zloc + j] =3D=3D nil) then
 						flaglist[zloc + j] =3D { }
 					end
-					flaglist[zloc + j].bImpassable =3D flaglist[zloc + j].bImpassable or =
isImpassable(t.miFlags)
-					flaglist[zloc + j].bSurface =3D flaglist[zloc + j].bSurface or isSurf=
ace(t.miFlags)
-					flaglist[zloc + j].bBridge =3D flaglist[zloc + j].bBridge or isBridge=
 (t.miFlags) =

+					local myflaglist =3D flaglist[zloc + j]
+					myflaglist.bImpassable =3D myflaglist.bImpassable or isImpassable(t.m=
iFlags)
+					myflaglist.bSurface =3D myflaglist.bSurface or isSurface(t.miFlags)
+					myflaglist.bBridge =3D myflaglist.bBridge or isBridge (t.miFlags) =

 				end
 				=

 				if (flaglist[zloc + iHeight] =3D=3D nil) then
 					flaglist[zloc + iHeight] =3D { }
 				end
-				flaglist[zloc + iHeight].bSurface =3D flaglist[zloc + iHeight].bSurfac=
e or isSurface(t.miFlags)
-				flaglist[zloc + iHeight].bBridge =3D flaglist[zloc + iHeight].bBridge =
or isBridge(t.miFlags) =

+				local myflaglist =3D flaglist[zloc + iHeight]
+				myflaglist.bSurface =3D myflaglist.bSurface or isSurface(t.miFlags)
+				myflaglist.bBridge =3D myflaglist.bBridge or isBridge(t.miFlags) =

 			end
 			=

-			printwalkdebug("----" .. t.msName .."  z=3D" .. zloc .. "  height=3D" .=
. iHeight .. " bImpassable=3D" .. tostring(isImpassable(t.miFlags)) .. " bS=
urface=3D" .. tostring(isSurface(t.miFlags)) .. " isBridge=3D" .. tostring(=
isBridge(t.miFlags)))
+			--~ printwalkdebug("----" .. t.msName .."  z=3D" .. zloc .. "  height=
=3D" .. iHeight .. " bImpassable=3D" .. tostring(isImpassable(t.miFlags)) .=
. " bSurface=3D" .. tostring(isSurface(t.miFlags)) .. " isBridge=3D" .. tos=
tring(isBridge(t.miFlags)))
 		end
 	end
 end
@@ -110,13 +115,13 @@
 -- returns an array of flags (impassable, surface, maptile)
 -- array might contain empty entries (meaning on the specific z level is n=
either something blocking nor a surface/maptile)
 function GetWalkingBlockFlags(bx, by, tx, ty)
-	printwalkdebug("--GetWalkingBlockFlags() for bx=3D"..bx.."  by=3D"..by.."=
  tx=3D"..tx.."  ty=3D"..ty.."  ("..(bx*8 + tx).."/"..(by*8+ty)..")") =

+	--~ printwalkdebug("--GetWalkingBlockFlags() for bx=3D"..bx.."  by=3D"..b=
y.."  tx=3D"..tx.."  ty=3D"..ty.."  ("..(bx*8 + tx).."/"..(by*8+ty)..")") =

 	=

 	if ( not(gTileTypeLoader) ) then return {} end
 	local flaglist =3D { }
 	=

 	-- map
-	printwalkdebug("---Map")
+	--~ printwalkdebug("---Map")
 	=

 	local iMapTileType =3D gGroundBlockLoader:GetTile(bx,by,tx,ty)
 	local iMapTileZ =3D tonumber(AverageGroundHeight( bx, by, tx, ty))
@@ -126,17 +131,18 @@
 	local miFlags,miTexID,msName =3D gTileTypeLoader:GetGroundTileType(iTrans=
tile)
 	=

 	-- ignore NoDraw Tiles
-	if (iMapTileType ~=3D hex2num("0x02")) then
-		flaglist[iMapTileZ] =3D { }
-		flaglist[iMapTileZ].bSurface =3D true
-		flaglist[iMapTileZ].bImpassable =3D isImpassable(miFlags)
-		flaglist[iMapTileZ].bMaptile =3D true
-		printwalkdebug("----Map Name=3D" .. msName .."  Heigt=3D" .. iMapTileZ .=
."   bSurface=3Dtrue  bImpassable=3D" .. tostring(flaglist[iMapTileZ].bImpa=
ssable))
+	if (iMapTileType ~=3D kHex02) then
+		local myflaglist =3D { }
+		myflaglist.bSurface =3D true
+		myflaglist.bImpassable =3D isImpassable(miFlags)
+		myflaglist.bMaptile =3D true
+		flaglist[iMapTileZ] =3D myflaglist
+		--~ printwalkdebug("----Map Name=3D" .. msName .."  Heigt=3D" .. iMapTil=
eZ .."   bSurface=3Dtrue  bImpassable=3D" .. tostring(flaglist[iMapTileZ].b=
Impassable))
 	end
 	=

 	=

 	-- statics
-	printwalkdebug("---Statics")
+	--~ printwalkdebug("---Statics")
 	=

 	local iStaticCount
 	if (gStaticBlockLoader) then
@@ -151,7 +157,7 @@
 	for i =3D 0,iStaticCount-1 do
 		iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i)
 		if (iX =3D=3D tx and iY =3D=3D ty) then
-			printwalkdebug("----new Static ID=3D" .. iTileTypeID)
+			--~ printwalkdebug("----new Static ID=3D" .. iTileTypeID)
 			GetWalkingBlockFlagsHelper(iZ,iTileTypeID,flaglist)
 		end
 	end
@@ -161,7 +167,7 @@
 	local yloc=3Dby*8+ty
 	=

 	-- multis
-	printwalkdebug("---Multis")
+	--~ printwalkdebug("---Multis")
 	=

 	for k,v in pairs(gMultis) do
 		local multi =3D k
@@ -178,7 +184,7 @@
 	end
 	=

 	-- dynamics
-	printwalkdebug("---Dynamics")
+	--~ printwalkdebug("---Dynamics")
 	=

 	for k,dynamic in pairs(GetDynamicList()) do
 		if(DynamicIsInWorld(dynamic) and dynamic.artid) then
@@ -192,7 +198,7 @@
 				if (dynamic.lTile) then
 					for k,v in pairs(dynamic.lTile) do
 						if ((dynamic.xloc+v.x) =3D=3D xloc and (dynamic.yloc+v.y) =3D=3D ylo=
c) then
-							printwalkdebug("----new serverside multi tile ID=3D" .. v.artid)
+							--~ printwalkdebug("----new serverside multi tile ID=3D" .. v.artid)
 							GetWalkingBlockFlagsHelper(v.z,v.artid,flaglist)	-- todo flaglist
 						end
 					end
@@ -200,7 +206,7 @@
 				-- multi found, special collision handling
 					local id =3D dynamic.artid - gMulti_ID
 					local parts =3D gMultiLoader:CountMultiParts(id)
-					printwalkdebug("---Dynamics multi id=3D" .. id .. " parts=3D" .. part=
s)
+					--~ printwalkdebug("---Dynamics multi id=3D" .. id .. " parts=3D" .. =
parts)
 					for p =3D 0, parts-1 do
 						local blocknum,x,y,z,flags
 						blocknum,x,y,z,flags =3D gMultiLoader:GetMultiParts(id,p)
@@ -211,26 +217,26 @@
 						pzloc =3D dynamic.zloc + z
 	=

 						if (flags =3D=3D 1 and pxloc =3D=3D xloc and pyloc =3D=3D yloc) then
-							printwalkdebug("----new dynamic ID=3D" .. blocknum)
+							--~ printwalkdebug("----new dynamic ID=3D" .. blocknum)
 							GetWalkingBlockFlagsHelper(pzloc,blocknum,flaglist)
 						end						=

 					end
 				else
-					printwalkdebug("no Multi found")
+					--~ printwalkdebug("no Multi found")
 				end
 				]]--
 			else
 				--elseif(dynamic.artid < gMulti_ID + 100) then
 				-- no mulit just a normal tile
 				if (dynamic.xloc =3D=3D xloc and dynamic.yloc =3D=3D yloc) then
-					printwalkdebug("----new dynamic ID=3D" .. dynamic.artid)
+					--~ printwalkdebug("----new dynamic ID=3D" .. dynamic.artid)
 					GetWalkingBlockFlagsHelper(dynamic.zloc,dynamic.artid,flaglist)
 				end
 			end
 		end
 	end
 	=

-	printwalkdebug("End GetWalkingBlockFlags()")
+	--~ printwalkdebug("End GetWalkingBlockFlags()")
 	return flaglist
 end
 =

@@ -242,15 +248,16 @@
 	diagonalCheck =3D diagonalCheck or false =

 	height =3D height or 15
 	for i=3D1, height, 1 do
-		if (flaglist[zloc+i] ~=3D nil) then
+		local myflaglist =3D flaglist[zloc+i]
+		if (myflaglist ~=3D nil) then
 			if (diagonalCheck) then
-				if (flaglist[zloc+i].bImpassable
-					or (flaglist[zloc+i].bMaptile and (i > gMaxZ_Climb + 5)) =

-					or (flaglist[zloc+i].bSurface and (i > gMaxZ_Climb))
+				if (myflaglist.bImpassable
+					or (myflaglist.bMaptile and (i > gMaxZ_Climb + 5)) =

+					or (myflaglist.bSurface and (i > gMaxZ_Climb))
 				) then
 					return false =

 				end
-			elseif (flaglist[zloc+i].bImpassable or flaglist[zloc+i].bSurface) then =

+			elseif (myflaglist.bImpassable or myflaglist.bSurface) then =

 				return false
 			end
 		end
@@ -267,7 +274,7 @@
 function CheckAdjacentTiles(bx, by, tx, ty, iDir, iStartZ)
 	local bDiagonal
 	local diagonalFlagList1, diagonalFlagList2
-	printwalkdebug("------direction: "..iDir)
+	--~ printwalkdebug("------direction: "..iDir)
 	if (iDir =3D=3D 1) then --northeast (right)
 		bDiagonal =3D true
 		if (tx =3D=3D 0) then
@@ -326,13 +333,13 @@
 	end
 			=

 	if (bDiagonal) then
-		printwalkdebug("------walking diagonally")
+		--~ printwalkdebug("------walking diagonally")
 				=

 		if (CheckZSpace(diagonalFlagList1, iStartZ, true) and CheckZSpace(diagon=
alFlagList2, iStartZ, true)) then
-			printwalkdebug("-------no obstacles on adjacent coordinates")
+			--~ printwalkdebug("-------no obstacles on adjacent coordinates")
 			return true
 		else
-			printwalkdebug("-------adjacent tiles are not free to walk, blocking")
+			--~ printwalkdebug("-------adjacent tiles are not free to walk, blockin=
g")
 			return false
 		end
 	else
@@ -348,23 +355,23 @@
 function GetNearestGroundLevel (xloc,yloc,iStartZ,iDir)
 	local bx,by,tx,ty =3D math.floor(xloc/8),math.floor(yloc/8),math.mod(xloc=
,8),math.mod(yloc,8)
 	local Walking_Start =3D Client_GetTicks()
-	printwalkdebug("-------------------")
-	printwalkdebug("GetNearestGroundLevel()")
+	--~ printwalkdebug("-------------------")
+	--~ printwalkdebug("GetNearestGroundLevel()")
 	=

 	if ( (tx >=3D 8) or (ty >=3D 8) or (tx < 0) or (ty < 0)) then return fals=
e, 255 end
 	if (not gGroundBlockLoader) then return false, 255 end
 =

-	printwalkdebug("iStartZ=3D"..iStartZ)
+	--~ printwalkdebug("iStartZ=3D"..iStartZ)
 	=

 	local flaglist =3D GetWalkingBlockFlags(bx, by, tx, ty)
 	=

-	printwalkdebug("--------------------")
-	printwalkdebug("List output:")
-	for index, value in pairs(flaglist) do
-		printwalkdebug("z=3D" .. index .. "   bSurface=3D" .. tostring(flaglist[=
index].bSurface) .. "  bImpassable=3D" .. tostring(flaglist[index].bImpassa=
ble).. "  bBridge=3D" .. tostring(flaglist[index].bBridge))
-	end
-
-	printwalkdebug("--------------------")
+	--~ printwalkdebug("--------------------")
+	--~ printwalkdebug("List output:")
+	--~ for index, value in pairs(flaglist) do
+		--~ printwalkdebug("z=3D" .. index .. "   bSurface=3D" .. tostring(flagl=
ist[index].bSurface) .. "  bImpassable=3D" .. tostring(flaglist[index].bImp=
assable).. "  bBridge=3D" .. tostring(flaglist[index].bBridge))
+	--~ end
+
+	--~ printwalkdebug("--------------------")
 	=

 	=

 	-- find closest surface (z + 0, -1, +1, -2, +2 etc)
@@ -374,20 +381,21 @@
 	local iCur
 	for i=3D0, math.max((gMaxZ_Climb + 5), gMaxZ_Fall), 1 do
 		iCur =3D iStartZ + i
-		if (i ~=3D 0 and flaglist[iCur] ~=3D nil) then
-			printwalkdebug("-----iCur=3D" .. iCur)
-			if (i < gMaxZ_Climb or (i < (gMaxZ_Climb + 5) and (flaglist[iCur].bMapt=
ile or flaglist[iCur].bBridge))) then
-				if ((not flaglist[iCur].bImpassable) and flaglist[iCur].bSurface) then
-					printwalkdebug("------found Surface");
+		local myflaglist =3D flaglist[iCur] =

+		if (i ~=3D 0 and myflaglist ~=3D nil) then
+			--~ printwalkdebug("-----iCur=3D" .. iCur)
+			if (i < gMaxZ_Climb or (i < (gMaxZ_Climb + 5) and (myflaglist.bMaptile =
or myflaglist.bBridge))) then
+				if ((not myflaglist.bImpassable) and myflaglist.bSurface) then
+					--~ printwalkdebug("------found Surface");
 					if (CheckZSpace(flaglist, iCur)) then
-						printwalkdebug("------checkSpace successful")
+						--~ printwalkdebug("------checkSpace successful")
 						=

 						local bAdjacent =3D CheckAdjacentTiles(bx, by, tx, ty, iDir, iStartZ)
 						=

-						printwalkdebug("End GetNearestGroundLevel()")
-						printwalkdebug("----------------------------")
-						printwalkdebug()
-						printdebug("walking",sprintf( "Walking calculations took %d msec.\n"=
, Client_GetTicks() - Walking_Start ))
+						--~ printwalkdebug("End GetNearestGroundLevel()")
+						--~ printwalkdebug("----------------------------")
+						--~ printwalkdebug()
+						--~ printdebug("walking",sprintf( "Walking calculations took %d msec=
.\n", Client_GetTicks() - Walking_Start ))
 						if (bAdjacent) then
 							return true, iCur
 						else
@@ -401,19 +409,19 @@
 		=

 		iCur =3D iStartZ - i
 		if (flaglist[iCur] ~=3D nil) then
-			printwalkdebug("-----iCur=3D" .. iCur)
+			--~ printwalkdebug("-----iCur=3D" .. iCur)
 			if (i < gMaxZ_Fall) then
 				if ((not flaglist[iCur].bImpassable) and flaglist[iCur].bSurface) then
-					printwalkdebug("------found Surface");
+					--~ printwalkdebug("------found Surface");
 					if (CheckZSpace(flaglist, iCur)) then
-						printwalkdebug("------ checkSpace successful")
+						--~ printwalkdebug("------ checkSpace successful")
 						=

 						local bAdjacent =3D CheckAdjacentTiles(bx, by, tx, ty, iDir, iStartZ)
 						=

-						printwalkdebug("End GetNearestGroundLevel()")
-						printwalkdebug("----------------------------")
-						printwalkdebug()
-						printdebug("walking",sprintf( "Walking calculations took %d msec.\n"=
, Client_GetTicks() - Walking_Start ))
+						--~ printwalkdebug("End GetNearestGroundLevel()")
+						--~ printwalkdebug("----------------------------")
+						--~ printwalkdebug()
+						--~ printdebug("walking",sprintf( "Walking calculations took %d msec=
.\n", Client_GetTicks() - Walking_Start ))
 						if (bAdjacent) then
 							return true, iCur
 						else
@@ -426,10 +434,10 @@
 	end
 	=

 	-- if there was no space to walk through found, return false
-	printwalkdebug("End GetNearestGroundLevel()")
-	printwalkdebug("returning false")
-	printwalkdebug("----------------------------")
-	=

-	printdebug("walking",sprintf( "Walking calculations took %d msec.\n", Cli=
ent_GetTicks() - Walking_Start ))
+	--~ printwalkdebug("End GetNearestGroundLevel()")
+	--~ printwalkdebug("returning false")
+	--~ printwalkdebug("----------------------------")
+	=

+	--~ printdebug("walking",sprintf( "Walking calculations took %d msec.\n",=
 Client_GetTicks() - Walking_Start ))
 	return false, 255 =

 end



From no-reply at zwischenwelt.org  Sat Jan 12 04:51:51 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 03:51:51 -0000
Subject: [Iris-commit] [IRIS] r1760 - /trunk/lua/lib.tilefreewalk.lua
Message-ID: <20080115170828.089441C181B3@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 12 04:51:51 2008
New Revision: 1760

Log:
optimized freewalk a bit : uses less groundscans

Modified:
    trunk/lua/lib.tilefreewalk.lua

Modified: trunk/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.tilefreewalk.lua (original)
+++ trunk/lua/lib.tilefreewalk.lua Sat Jan 12 04:51:51 2008
@@ -530,11 +530,11 @@
 		local iNewZ =3D self:Impl_CalcWalkStep(xloc2,yloc2,zloc,iDir)
 		RegisterZ(ldx,ldy,iNewZ)
 		if (iNewZ) then iSelfZ =3D self:Impl_CalcWalkStep(xloc,yloc,zloc,DirWrap=
(iDir+4)) or iSelfZ end
-		if (iNewZ and (not DirisDiagonal(iDir))) then =

-			local iDirL,iDirR =3D DirWrap(iDir-2),DirWrap(iDir+2) =

-			RegisterZ(ldx+GetDirXLocal(iDirL),ldy+GetDirYLocal(iDirL),self:Impl_Cal=
cWalkStep(xloc2+GetDirX(iDirL),yloc2+GetDirY(iDirL),iNewZ,iDirL))
-			RegisterZ(ldx+GetDirXLocal(iDirR),ldy+GetDirYLocal(iDirR),self:Impl_Cal=
cWalkStep(xloc2+GetDirX(iDirR),yloc2+GetDirY(iDirR),iNewZ,iDirR))
-		end
+		--~ if (iNewZ and (not DirisDiagonal(iDir))) then =

+			--~ local iDirL,iDirR =3D DirWrap(iDir-2),DirWrap(iDir+2) =

+			--~ RegisterZ(ldx+GetDirXLocal(iDirL),ldy+GetDirYLocal(iDirL),self:Impl=
_CalcWalkStep(xloc2+GetDirX(iDirL),yloc2+GetDirY(iDirL),iNewZ,iDirL))
+			--~ RegisterZ(ldx+GetDirXLocal(iDirR),ldy+GetDirYLocal(iDirR),self:Impl=
_CalcWalkStep(xloc2+GetDirX(iDirR),yloc2+GetDirY(iDirR),iNewZ,iDirR))
+		--~ end
 	end
 	for iDir=3D1,7,2 do CheckDir(iDir) end -- check diagonals first
 	for iDir=3D0,7,2 do CheckDir(iDir) end



From no-reply at zwischenwelt.org  Sat Jan 12 12:07:29 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 11:07:29 -0000
Subject: [Iris-commit] [IRIS] r1762 - /rawdata/uo_art_models/
Message-ID: <20080115170829.7F5861C181B9@zwischenwelt.org>

Author: hagish
Date: Sat Jan 12 12:07:27 2008
New Revision: 1762

Log:
archive for old uo_art models

Added:
    rawdata/uo_art_models/



From no-reply at zwischenwelt.org  Sat Jan 12 05:38:12 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 04:38:12 -0000
Subject: [Iris-commit] [IRIS] r1761 - in /trunk: lua/lib.3d.mousepick.lua
 lua/lib.terrain.multitex.lua src/terrain_multitex.cpp
Message-ID: <20080115170829.758021C18078@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 12 05:38:12 2008
New Revision: 1761

Log:
multitex terrain mousepicking

Modified:
    trunk/lua/lib.3d.mousepick.lua
    trunk/lua/lib.terrain.multitex.lua
    trunk/src/terrain_multitex.cpp

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Sat Jan 12 05:38:12 2008
@@ -83,8 +83,40 @@
 	if (gEnableMultiTexTerrain) then
 		local bx,by,tx,ty
 		bHit,fHitDist,bx,by,tx,ty =3D MultiTexTerrain_RayPickAll(rx,ry,rz,rvx,rv=
y,rvz)
-		print("Renderer3D:MousePick_3D MultiTexTerrain_RayPick",bHit,fHitDist,bx=
,by,tx,ty)
+		--~ print("Renderer3D:MousePick_3D MultiTexTerrain_RayPick",bHit,fHitDis=
t,bx,by,tx,ty)
 		--- TODO  : calc vars... blockx etc , register mousehit....
+		=

+		local iBlockUO_X =3D bx -- chunk.miX * self.ROBMAP_CHUNK_SIZE
+		local iBlockUO_Y =3D by -- chunk.miY * self.ROBMAP_CHUNK_SIZE
+		=

+		if (bHit and ((not gMousePickFoundHit) or fHitDist < self.gMousePickFoun=
dDist)) then
+			self.gMousePickFoundDist =3D fHitDist
+			gMousePickFoundHit =3D {}
+			gMousePickFoundHit.hittype =3D kMousePickHitType_Terrain
+			gMousePickFoundHit.chunk =3D nil -- chunk ??
+			=

+			local x,y =3D Renderer3D:LocalToUOPos(rx + fHitDist * rvx, ry + fHitDis=
t * rvy)
+			x,y =3D math.floor(x),math.floor(y)
+			local iTileType,iZLoc =3D GetAbsTile(x,y) =

+			local bx =3D math.floor((x - iBlockUO_X)/8)
+			local by =3D math.floor((y - iBlockUO_Y)/8)
+			local origin_abs_x =3D self.giMapOriginX * self.ROBMAP_CHUNK_SIZE
+			local origin_abs_y =3D self.giMapOriginY * self.ROBMAP_CHUNK_SIZE
+			local originoffx =3D 8.0*(iBlockUO_X-origin_abs_x)
+			local originoffy =3D 8.0*(iBlockUO_Y-origin_abs_y)
+			=

+			gMousePickFoundHit.tiletype =3D iTileType
+			gMousePickFoundHit.minz =3D iZLoc*0.1 =

+			gMousePickFoundHit.maxz =3D iZLoc*0.1
+			gMousePickFoundHit.x =3D x
+			gMousePickFoundHit.y =3D y
+			gMousePickFoundHit.tx =3D math.mod(x,8)
+			gMousePickFoundHit.ty =3D math.mod(y,8)
+			gMousePickFoundHit.iBlockX =3D iBlockUO_X+bx
+			gMousePickFoundHit.iBlockY =3D iBlockUO_Y+by
+			gMousePickFoundHit.blockorigin_x =3D originoffx+bx*8
+			gMousePickFoundHit.blockorigin_y =3D originoffy+by*8
+		end
 	end
 	=

 	for chunky,row in pairs(self.gMapChunks) do

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Sat Jan 12 05:38:12 2008
@@ -166,7 +166,7 @@
 =

 -- returns bHit,fHitDist,bx,by,tx,ty
 function MultiTexTerrain_RayPickAll(rx,ry,rz,rvx,rvy,rvz)
-	if (true) then return end
+	--~ if (true) then return end
 	if (not gGroundBlockLoader) then return end
 	local d =3D kMultiTexTerrainChunkSize
 	local fHitDist =3D nil
@@ -175,8 +175,9 @@
 	for k,gfx in pairs(gMultiTexTerrain_GfxList) do =

 		local bhit,_hitdist,_tx,_ty =3D TerrainMultiTex_RayPick(gGroundBlockLoad=
er,gfx.bx,gfx.by,d,d, rx-gfx.x,ry-gfx.y,rz-gfx.z, rvx,rvy,rvz)
 		if (bhit) then
+			--~ print(" mousepick terrain ",gfx.bx,gfx.by,bhit,_hitdist,_tx,_ty)
 			if ((not fHitDist) or _hitdist < fHitDist) then
-				_hitdist =3D fHitDist
+				fHitDist =3D _hitdist
 				bx,by,tx,ty =3D gfx.bx,gfx.by,_tx,_ty
 			end
 		end

Modified: trunk/src/terrain_multitex.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/terrain_multitex.cpp (original)
+++ trunk/src/terrain_multitex.cpp Sat Jan 12 05:38:12 2008
@@ -206,6 +206,7 @@
 	=

 	/// don't call before WriteToVertexBuffer has been called at least once t=
o set up lookup tables
 	bool	RayPick		(cGroundBlockLoader* pGroundBlockLoader,const int iBlockX,c=
onst int iBlockY,const int iDX,const int iDY,const Ogre::Vector3& vRayPos,c=
onst Ogre::Vector3& vRayDir,float& pfHitDist,int& pTX,int& pTY) {
+		//~ printf("mulittex_terrain_raypick %p %d,%d,%d,%d\n",pGroundBlockLoade=
r,iBlockX,iBlockY,iDX,iDY);
 		=

 		//~ if (!Ogre::Ray(vRayPos,vRayDir).intersects(Ogre::Sphere(Ogre::Vector=
3::ZERO,mfBoundRad + 0.1)).first) return -1;
 		bool bNothingFoundYet =3D true;



From no-reply at zwischenwelt.org  Sat Jan 12 04:46:52 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 03:46:52 -0000
Subject: [Iris-commit] [IRIS] r1759 - /trunk/lua/lib.walking2.lua
Message-ID: <20080115170827.A22F91C181AD@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 12 04:46:51 2008
New Revision: 1759

Log:
walking optimized a bit, added cache

Modified:
    trunk/lua/lib.walking2.lua

Modified: trunk/lua/lib.walking2.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.walking2.lua (original)
+++ trunk/lua/lib.walking2.lua Sat Jan 12 04:46:51 2008
@@ -39,34 +39,14 @@
 end
 =

 function isBridge(flag)
-	local bIsBridge=3Dfalse
-	if ((TestBit(flag, kTileDataFlag_StairBack	)) or
-		(TestBit(flag, kTileDataFlag_StairRight	)) or
-		(TestBit(flag, kTileDataFlag_Bridge		)) ) then
-		bIsBridge=3Dtrue
-	end
-	return bIsBridge	=

-end
-
-function isSurface(flag)
-	local bIsSurface=3Dfalse
-
-	if (TestBit(flag, kTileDataFlag_Surface)) then
-		bIsSurface=3Dtrue
-	end
-
-	return bIsSurface
-end
-
-function isImpassable(flag)
-	local bIsImpassable=3Dfalse
-
-	if (TestBit(flag, kTileDataFlag_Impassable)) then
-		bIsImpassable=3Dtrue
-	end
-
-	return bIsImpassable
-end
+	return	(TestBit(flag, kTileDataFlag_StairBack	)) or
+			(TestBit(flag, kTileDataFlag_StairRight	)) or
+			(TestBit(flag, kTileDataFlag_Bridge		)) =

+end
+
+function isSurface(flag) return TestBit(flag, kTileDataFlag_Surface) end
+
+function isImpassable(flag) return TestBit(flag, kTileDataFlag_Impassable)=
 end
 =

 =

 -- a little helper for GetWalkingBlockFlags(...)
@@ -349,10 +329,27 @@
 =

 =

 =

+
+gWalkScanCache =3D {}
+gWalkScanCacheTime =3D 0
+
 -- Can walk the tile, the tile's height and if the tile's a stair
 -- (about 30 in int, or 3.0 in float (*0.1) is the height of a door)
 -- two values are returned: is walkable, new Z Level
 function GetNearestGroundLevel (xloc,yloc,iStartZ,iDir)
+	if (gMyTicks > gWalkScanCacheTime) then gWalkScanCacheTime =3D gMyTicks +=
 2000 gWalkScanCache =3D {} end
+	local cachename =3D sprintf("%d,%d,%d,%d",xloc,yloc,iStartZ,iDir)
+	local cache =3D gWalkScanCache[cachename]
+	if (not cache) then
+		local a,b =3D GetNearestGroundLevel_NoCache(xloc,yloc,iStartZ,iDir)
+		cache =3D {a,b}
+		gWalkScanCache[cachename] =3D cache
+	end
+	return unpack(cache)
+end
+
+function GetNearestGroundLevel_NoCache (xloc,yloc,iStartZ,iDir)
+	--~ print("GetNearestGroundLevel_NoCache",xloc,yloc,iStartZ,iDir)
 	local bx,by,tx,ty =3D math.floor(xloc/8),math.floor(yloc/8),math.mod(xloc=
,8),math.mod(yloc,8)
 	local Walking_Start =3D Client_GetTicks()
 	--~ printwalkdebug("-------------------")



From no-reply at zwischenwelt.org  Sun Jan 13 01:55:37 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 13 Jan 2008 00:55:37 -0000
Subject: [Iris-commit] [IRIS] r1770 - /trunk/data/config.lua.dist
Message-ID: <20080115170830.A48831C181A3@zwischenwelt.org>

Author: sience
Date: Sun Jan 13 01:55:37 2008
New Revision: 1770

Log:
-compass initial zoom value changed

Modified:
    trunk/data/config.lua.dist

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Jan 13 01:55:37 2008
@@ -79,7 +79,7 @@
 gCompassZoomFactor =3D 1.5
 gCompassSize =3D 150 -- in pixels on screen, set to 0 to disable
 giCompassDetailLimit =3D 12 -- in mapblocks shown
-gCompassVisibleRad =3D giCompassDetailLimit
+gCompassVisibleRad =3D giCompassDetailLimit *3
 -- todo : gMapImagePath_Small	=3D "tempmap_small.tga"
 -- todo : gMapImagePath_Big		=3D "tempmap_big.tga"
 =




From no-reply at zwischenwelt.org  Sat Jan 12 12:27:10 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 11:27:10 -0000
Subject: [Iris-commit] [IRIS] r1763 - /rawdata/uo_art_models/
Message-ID: <20080115170829.850CF1C181BB@zwischenwelt.org>

Author: hagish
Date: Sat Jan 12 12:27:09 2008
New Revision: 1763

Log:
ups

Removed:
    rawdata/uo_art_models/



From no-reply at zwischenwelt.org  Sun Jan 13 01:46:13 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 13 Jan 2008 00:46:13 -0000
Subject: [Iris-commit] [IRIS] r1769 - /trunk/data/skippedfallbacks.lua
Message-ID: <20080115170830.96AFA1C181B9@zwischenwelt.org>

Author: sience
Date: Sun Jan 13 01:46:13 2008
New Revision: 1769

Log:
-skippedfallback added

Modified:
    trunk/data/skippedfallbacks.lua

Modified: trunk/data/skippedfallbacks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/skippedfallbacks.lua (original)
+++ trunk/data/skippedfallbacks.lua Sun Jan 13 01:46:13 2008
@@ -420,3 +420,4 @@
 RegisterSkippedArtBillboardFallBack(5952) -- 0x1740 name=3Dfountain
 RegisterSkippedArtBillboardFallBack(5954) -- 0x1742 name=3Dfountain
 RegisterSkippedArtBillboardFallBack(2267) -- 0x08db name=3Dfireplace
+RegisterSkippedArtBillboardFallBack(3443) -- 0x0d73 name=3Dleaves



From no-reply at zwischenwelt.org  Sat Jan 12 13:04:53 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 12:04:53 -0000
Subject: [Iris-commit] [IRIS] r1765 - /rawdata/uo_art_models/
 /trunk/data/models/models/uo_art_models/
Message-ID: <20080115170829.A75BE1C181BF@zwischenwelt.org>

Author: hagish
Date: Sat Jan 12 13:04:52 2008
New Revision: 1765

Log:
uo art removed

Added:
    rawdata/uo_art_models/
      - copied from r1764, trunk/data/models/models/uo_art_models/
Removed:
    trunk/data/models/models/uo_art_models/



From no-reply at zwischenwelt.org  Sat Jan 12 13:40:42 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 12:40:42 -0000
Subject: [Iris-commit] [IRIS] r1766 - /trunk/bin/iris2.exe
Message-ID: <20080115170829.C74D21C181C0@zwischenwelt.org>

Author: sience
Date: Sat Jan 12 13:40:42 2008
New Revision: 1766

Log:
-new binary

Modified:
    trunk/bin/iris2.exe

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Sat Jan 12 16:00:13 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 15:00:13 -0000
Subject: [Iris-commit] [IRIS] r1767 - /trunk/data/config.lua.dist
Message-ID: <20080115170829.F1B581C18276@zwischenwelt.org>

Author: sience
Date: Sat Jan 12 16:00:12 2008
New Revision: 1767

Log:
-multitexture terrain set as standard terrainengine in config.lua.dist
-preload all meshes set as standard in config.lua.dist

Modified:
    trunk/data/config.lua.dist

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Jan 12 16:00:12 2008
@@ -237,9 +237,9 @@
 =

 gLogPackets =3D false
 =

--- preload all static meshes WARNING !!! this takes some minutes and can p=
roduce crashes
--- approx. 700MB RAM needed
-gPreloadStaticMesh =3D false
+-- preload all static meshes
+-- WARNING !!! this takes some seconds 25sec. first time and approx. 100MB=
 RAM needed
+gPreloadStaticMesh =3D true
 =

 gEnableFallBackBillboards_Statics =3D false -- incorrect fallbacks can be =
added to the skiplist using the fallbacktool (f11)
 gEnableFallBackBillboards_Dynamics =3D true
@@ -422,7 +422,7 @@
 	staticfilename	=3D "statics4.mul"
 }
 =

-gEnableMultiTexTerrain =3D false
+gEnableMultiTexTerrain =3D true
 gDisableMultiTexTerrainTransitions =3D false -- ugly, but faster
 gFastBatchStatics =3D false -- faster, but mousepicking and blend-out-uppe=
r-floors doesn't work yet
 gFastBatchDynamics =3D false



From no-reply at zwischenwelt.org  Sun Jan 13 13:56:00 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 13 Jan 2008 12:56:00 -0000
Subject: [Iris-commit] [IRIS] r1771 - in /trunk: SConstruct build_config.py
 build_support.py premakelinux.sh
Message-ID: <20080115170831.C77F51C18078@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan 13 13:56:00 2008
New Revision: 1771

Log:
removed scons config

Removed:
    trunk/SConstruct
    trunk/build_config.py
    trunk/build_support.py
Modified:
    trunk/premakelinux.sh

Modified: trunk/premakelinux.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/premakelinux.sh (original)
+++ trunk/premakelinux.sh Sun Jan 13 13:56:00 2008
@@ -1,3 +1,4 @@
 #!/bin/bash
 ./premake --target gnu && make
+#~ ./premake --target gnu && make CONFIG=3DRelease
 # tipp : try "make -j 2" : start 2 jobs in parallel, to avoid wait-for-io =
and use multi-cpu processors efficiently during compile



From no-reply at zwischenwelt.org  Sun Jan 13 22:28:59 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 13 Jan 2008 21:28:59 -0000
Subject: [Iris-commit] [IRIS] r1772 - in /trunk: bin/ data/
 data/terrain/materials/ data/terrain/programs/ data/terrain/textures/ lua/
 lua/filter/ vs8/
Message-ID: <20080115170832.35FF51C181BA@zwischenwelt.org>

Author: sience
Date: Sun Jan 13 22:28:57 2008
New Revision: 1772

Log:
-terrainshader removed. and moved to obsolete data
-new binary

Removed:
    trunk/data/terrain/materials/water.material
    trunk/data/terrain/programs/WaterFS_GLSL.frag
    trunk/data/terrain/programs/WaterFS_HLSL.frag
    trunk/data/terrain/programs/WaterVS_GLSL.vert
    trunk/data/terrain/programs/WaterVS_HLSL.vert
    trunk/data/terrain/programs/terrain.program
    trunk/data/terrain/programs/terrainBase_ps.glsl
    trunk/data/terrain/programs/terrainBase_ps.hlsl
    trunk/data/terrain/programs/terrainBase_vs.glsl
    trunk/data/terrain/programs/terrainBase_vs.hlsl
    trunk/data/terrain/programs/terrainBlend_ps.glsl
    trunk/data/terrain/programs/terrainBlend_ps.hlsl
    trunk/data/terrain/programs/water.program
    trunk/data/terrain/textures/Dirt_large_pattern_512.dds
    trunk/data/terrain/textures/Forest_large_pattern_512.dds
    trunk/data/terrain/textures/Grass_large_pattern_1024.dds
    trunk/data/terrain/textures/Sand_large_pattern_512.dds
    trunk/data/terrain/textures/Snow_large_pattern_512.dds
    trunk/data/terrain/textures/Void_large_pattern_512.dds
    trunk/data/terrain/textures/Water01.dds
    trunk/data/terrain/textures/Waves.dds
    trunk/data/terrain/textures/cobblestone_large_pattern_512.dds
    trunk/data/terrain/textures/jungle_large_pattern_512.dds
    trunk/data/terrain/textures/lightmap.dds
    trunk/data/terrain/textures/multitiletex_numbers.png
    trunk/data/terrain/textures/rock_large_pattern_512.dds
    trunk/data/terrain/textures/tex_blend_e_side.png
    trunk/data/terrain/textures/tex_blend_n_side.png
    trunk/data/terrain/textures/tex_blend_ne_corner_cross.png
    trunk/data/terrain/textures/tex_blend_ne_corner_in.png
    trunk/data/terrain/textures/tex_blend_ne_corner_out.png
    trunk/data/terrain/textures/tex_blend_nw_corner_cross.png
    trunk/data/terrain/textures/tex_blend_nw_corner_in.png
    trunk/data/terrain/textures/tex_blend_nw_corner_out.png
    trunk/data/terrain/textures/tex_blend_s_side.png
    trunk/data/terrain/textures/tex_blend_se_corner_cross.png
    trunk/data/terrain/textures/tex_blend_se_corner_in.png
    trunk/data/terrain/textures/tex_blend_se_corner_out.png
    trunk/data/terrain/textures/tex_blend_sw_corner_cross.png
    trunk/data/terrain/textures/tex_blend_sw_corner_in.png
    trunk/data/terrain/textures/tex_blend_sw_corner_out.png
    trunk/data/terrain/textures/tex_blend_w_side.png
Modified:
    trunk/bin/iris2.exe
    trunk/data/config.lua.dist
    trunk/data/terrain/materials/terrain.material
    trunk/lua/filter/filter.art.lua
    trunk/lua/lib.terrain.lua
    trunk/vs8/iris.sln

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Jan 13 22:28:57 2008
@@ -282,9 +282,6 @@
 	gMobileCastShadows =3D true
 end
 ]]--
-
--- activate Shader 2.0 for TerrainShader Engine
-gTerrainShader =3D false
 =

 -- activates Lightsources
 gLightsources =3D false
@@ -437,3 +434,6 @@
 -- gLowResTexAtlasNameMap =3D { ["alpha_tex_atlas_0"]=3D"alpha_tex_atlas_0=
_512", ["tex_atlas_0"]=3D"tex_atlas_0_512" }
 =

 gEnableCompassRadar =3D false -- the detailed compass is rendered using st=
encil buffers and seems to cause trouble with shadows
+
+-- removed: obsolete !!!!! (Shader 2.0 for TerrainShader Engine)
+if (gTerrainShader) then gEnableMultiTexTerrain=3Dtrue end

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Sun Jan 13 22:28:57 2008
@@ -1,162 +1,3 @@
-//###########################################
-// TEMPLATES
-//###########################################
-material terrain_base
-{
-	// Shader: hlsl & glsl
-	technique
-	{
-		pass
-		{
-			cull_hardware clockwise
-			cull_software none
-			depth_check on
-			=

-			vertex_program_ref terrainBase_vs
-			{
-				param_named materialDiffuse float3 1.0 1.0 1.0
-				param_named materialSpecular float4 0 0 0 35.0
-				param_named worldScale float 5
-			}
-			fragment_program_ref terrainBase_ps
-			{
-			}
-			texture_unit base
-			{
-                filtering anisotropic
-                max_anisotropy 8
-				texture multitiletex_numbers.png 2d
-				tex_address_mode wrap
-			}
-		}
-	}
-	// FIXED FUNCTION - Fallback technique
-	technique
-	{
-		pass
-		{
-			cull_hardware clockwise
-			cull_software none
-			depth_check on
-
-			texture_unit base
-			{
-				filtering linear linear linear
-				texture multitiletex_numbers.png
-				tex_address_mode wrap
-			}
-		}
-	}
-}
-
-material terrain_transition
-{
-	// Shader: hlsl & glsl
-	technique
-	{
-		pass base
-		{
-			cull_hardware clockwise
-			cull_software none
-			depth_check on
-			=

-			vertex_program_ref terrainBase_vs
-			{
-				param_named materialDiffuse float3 1.0 1.0 1.0
-				param_named materialSpecular float4 0 0 0 35.0
-				param_named worldScale float 5
-			}
-			fragment_program_ref terrainBase_ps
-			{
-			}
-			texture_unit firstbase
-			{ =

-                filtering anisotropic
-                max_anisotropy 8
-				texture multitiletex_numbers.png 2d
-				tex_address_mode wrap
-			}
-			=

-		}
-		pass blend
-		{		=

-			scene_blend alpha_blend
-
-			cull_hardware clockwise
-			cull_software none
-			depth_check on
-
-			vertex_program_ref terrainBase_vs
-			{
-				param_named materialDiffuse float3 1.0 1.0 1.0
-				param_named materialSpecular float4 0 0 0 35.0
-				param_named worldScale float 5
-			}
-			fragment_program_ref terrainBlend_ps
-			{
-			}
-			texture_unit secondbase
-			{
-				filtering anisotropic
-				max_anisotropy 8
-				texture multitiletex_numbers.png 2d
-				tex_address_mode wrap
-			}
-			texture_unit blend_mask
-			{
-				texture tex_blend_n_side.png 2d
-				tex_address_mode clamp
-			}
-		}
-	}
-	// FIXED FUNCTION - Fallback technique
-	technique
-	{
-		pass
-		{
-			cull_hardware clockwise
-			cull_software none
-			depth_check on
-
-			texture_unit firstbase
-			{
-				filtering linear linear linear
-				texture multitiletex_numbers.png
-				tex_address_mode wrap
-			}
-		}
-	}
-	// FIXED FUNCTION - Fallback technique 2
-	// currently does not work
-	technique
-	{
-		pass
-		{
-			cull_hardware clockwise
-			cull_software none
-			depth_check on
-
-			texture_unit firstbase
-			{
-				texture multitiletex_numbers.png
-				tex_address_mode wrap
-			}
-			texture_unit blend_mask
-			{
-				texture tex_blend_n_side.png     =

-				colour_op alpha_blend
-				tex_address_mode clamp
-			}
-			texture_unit secondbase
-			{
-				texture multitiletex_numbers.png
-				colour_op_ex blend_current_alpha src_texture src_current
-				tex_address_mode wrap
-			}
-		}
-	}
-}
-
 //###########################################
 // MULTITEXTURE TERRAIN MAT
 //###########################################
@@ -230,989 +71,3 @@
 		}
 	}
 }
-
-// colour_op_ex blend_diffuse_alpha  src_current src_texture
-// alpha_op_ex ....
-
-//###########################################
-// BASE TILES
-//###########################################
-//dirt road tiles
-material base_dirt : terrain_base
-{
-	set_texture_alias base Dirt_large_pattern_512.dds
-}
-//grass tiles - needs larger scaling
-material base_grass : terrain_base
-{
-	set_texture_alias base Grass_large_pattern_1024.dds
-}
-//rock tiles
-material base_rock : terrain_base
-{
-	set_texture_alias base rock_large_pattern_512.dds
-}
-//forest tiles
-material base_forest : terrain_base
-{
-	set_texture_alias base Forest_large_pattern_512.dds
-}
-//sand tiles
-material base_sand : terrain_base
-{
-	set_texture_alias base Sand_large_pattern_512.dds
-}
-//cobblestone tiles
-material base_cobblestone : terrain_base
-{
-	set_texture_alias base cobblestone_large_pattern_512.dds
-}
-//void
-material base_void : terrain_base
-{
-	set_texture_alias base Void_large_pattern_512.dds
-}
-//snow - needs larger scaling
-material base_snow : terrain_base
-{
-	set_texture_alias base Snow_large_pattern_512.dds
-}
-//jungle - needs larger scaling
-material base_jungle : terrain_base
-{
-	set_texture_alias base jungle_large_pattern_512.dds
-}
-//###########################################
-// TRANSITION TILES
-//###########################################
-//dirt - grass transition
-material transition_dirt_grass : terrain_transition
-{
-	set_texture_alias firstbase Dirt_large_pattern_512.dds
-	set_texture_alias secondbase Grass_large_pattern_1024.dds
-}
-
-//rock - grass transition
-material transition_rock_grass : terrain_transition
-{
-	set_texture_alias firstbase rock_large_pattern_512.dds
-	set_texture_alias secondbase Grass_large_pattern_1024.dds
-}
-
-//rock - Dirt transition
-material transition_rock_dirt : terrain_transition
-{
-	set_texture_alias firstbase rock_large_pattern_512.dds
-	set_texture_alias secondbase Dirt_large_pattern_512.dds
-}
-
-//dirt - forest transition
-material transition_dirt_forest : terrain_transition
-{
-	set_texture_alias firstbase Dirt_large_pattern_512.dds
-	set_texture_alias secondbase Forest_large_pattern_512.dds
-}
-
-//dirt - cobblestone transition
-material transition_dirt_cobblestone : terrain_transition
-{
-	set_texture_alias firstbase Dirt_large_pattern_512.dds
-	set_texture_alias secondbase cobblestone_large_pattern_512.dds
-}
-
-//forest - grass transition
-material transition_grass_forest : terrain_transition
-{
-	set_texture_alias firstbase Forest_large_pattern_512.dds
-	set_texture_alias secondbase Grass_large_pattern_1024.dds
-}
-//grass - jungle transition
-material transition_grass_jungle : terrain_transition
-{
-	set_texture_alias firstbase Grass_large_pattern_1024.dds
-	set_texture_alias secondbase jungle_large_pattern_512.dds
-}
-//grass - cobblestone transition
-material transition_grass_cobblestone : terrain_transition
-{
-	set_texture_alias firstbase Grass_large_pattern_1024.dds
-	set_texture_alias secondbase cobblestone_large_pattern_512.dds
-}
-
-
-// Base-Textures:
-//__________________________________________________________
-//dirt
-material tileid_113 : base_dirt
-{
-}
-material tileid_114 : base_dirt
-{
-}
-material tileid_115 : base_dirt
-{
-}
-material tileid_116 : base_dirt
-{
-}
-material tileid_117 : base_dirt
-{
-}
-material tileid_118 : base_dirt
-{
-}
-material tileid_119 : base_dirt
-{
-}
-material tileid_120 : base_dirt
-{
-}
-material tileid_16376 : base_dirt
-{
-}
-material tileid_889 : base_dirt
-{
-}
-material tileid_1911 : base_dirt
-{
-}
-material tileid_16377 : base_dirt
-{
-}
-material tileid_16378 : base_dirt
-{
-}
-material tileid_16379 : base_dirt
-{
-}
-//__________________________________________________________
-//grass
-material tileid_3 : base_grass
-{
-}
-material tileid_4 : base_grass
-{
-}
-material tileid_5 : base_grass
-{
-}
-material tileid_6 : base_grass
-{
-}
-material tileid_193 : base_grass
-{
-}
-material tileid_194 : base_grass
-{
-}
-material tileid_891 : base_grass
-{
-}
-material tileid_892 : base_grass
-{
-}
-material tileid_893 : base_grass
-{
-}
-material tileid_894 : base_grass
-{
-}
-//__________________________________________________________
-//Rock
-material tileid_544 : base_rock
-{
-}
-material tileid_545 : base_rock
-{
-}
-material tileid_546 : base_rock
-{
-}
-material tileid_547 : base_rock
-{
-}
-material tileid_548 : base_rock
-{
-}
-material tileid_549 : base_rock
-{
-}
-material tileid_550 : base_rock
-{
-}
-material tileid_551 : base_rock
-{
-}
-material tileid_552 : base_rock
-{
-}
-material tileid_553 : base_rock
-{
-}
-material tileid_554 : base_rock
-{
-}
-material tileid_555 : base_rock
-{
-}
-material tileid_556 : base_rock
-{
-}
-material tileid_557 : base_rock
-{
-}
-material tileid_558 : base_rock
-{
-}
-material tileid_559 : base_rock
-{
-}
-//__________________________________________________________
-//Forest
-material tileid_196 : base_forest
-{
-}
-material tileid_197 : base_forest
-{
-}
-material tileid_198 : base_forest
-{
-}
-material tileid_199 : base_forest
-{
-}
-material tileid_214 : base_forest
-{
-}
-material tileid_351 : base_forest
-{
-}
-//__________________________________________________________
-//Sand
-material tileid_22 : base_sand
-{
-}
-material tileid_23 : base_sand
-{
-}
-material tileid_24 : base_sand
-{
-}
-material tileid_25 : base_sand
-{
-}
-material tileid_26 : base_sand
-{
-}
-material tileid_27 : base_sand
-{
-}
-material tileid_28 : base_sand
-{
-}
-material tileid_441 : base_sand
-{
-}
-material tileid_442 : base_sand
-{
-}
-material tileid_443 : base_sand
-{
-}
-material tileid_444 : base_sand
-{
-}
-material tileid_445 : base_sand
-{
-}
-material tileid_446 : base_sand
-{
-}
-material tileid_447 : base_sand
-{
-}
-material tileid_448 : base_sand
-{
-}
-material tileid_449 : base_sand
-{
-}
-material tileid_450 : base_sand
-{
-}
-material tileid_451 : base_sand
-{
-}
-material tileid_452 : base_sand
-{
-}
-material tileid_453 : base_sand
-{
-}
-material tileid_454 : base_sand
-{
-}
-material tileid_455 : base_sand
-{
-}
-material tileid_456 : base_sand
-{
-}
-material tileid_457 : base_sand
-{
-}
-material tileid_458 : base_sand
-{
-}
-material tileid_459 : base_sand
-{
-}
-material tileid_460 : base_sand
-{
-}
-material tileid_461 : base_sand
-{
-}
-material tileid_462 : base_sand
-{
-}
-material tileid_463 : base_sand
-{
-}
-material tileid_464 : base_sand
-{
-}
-material tileid_465 : base_sand
-{
-}
-//__________________________________________________________
-//cobblestone
-material tileid_1001 : base_cobblestone
-{
-}
-material tileid_1002 : base_cobblestone
-{
-}
-material tileid_1003 : base_cobblestone
-{
-}
-material tileid_1004 : base_cobblestone
-{
-}
-//__________________________________________________________
-//void
-material tileid_506 : base_void
-{
-}
-material tileid_507 : base_void
-{
-}
-material tileid_508 : base_void
-{
-}
-material tileid_509 : base_void
-{
-}
-material tileid_510 : base_void
-{
-}
-material tileid_511 : base_void
-{
-}
-//__________________________________________________________
-//snow
-material tileid_282 : base_snow
-{
-}
-material tileid_283 : base_snow
-{
-}
-material tileid_284 : base_snow
-{
-}
-material tileid_285 : base_snow
-{
-}
-//impassable snow
-material tileid_377 : base_snow
-{
-}
-material tileid_378 : base_snow
-{
-}
-material tileid_379 : base_snow
-{
-}
-material tileid_380 : base_snow
-{
-}
-material tileid_381 : base_snow
-{
-}
-material tileid_382 : base_snow
-{
-}
-material tileid_383 : base_snow
-{
-}
-material tileid_384 : base_snow
-{
-}
-material tileid_385 : base_snow
-{
-}
-material tileid_386 : base_snow
-{
-}
-material tileid_387 : base_snow
-{
-}
-material tileid_388 : base_snow
-{
-}
-material tileid_389 : base_snow
-{
-}
-material tileid_390 : base_snow
-{
-}
-material tileid_391 : base_snow
-{
-}
-material tileid_392 : base_snow
-{
-}
-material tileid_393 : base_snow
-{
-}
-material tileid_394 : base_snow
-{
-}
-material tileid_1901 : base_snow
-{
-}
-material tileid_1906 : base_snow
-{
-}
-//__________________________________________________________
-//jungle
-material tileid_172 : base_jungle
-{
-}
-material tileid_173 : base_jungle
-{
-}
-material tileid_174 : base_jungle
-{
-}
-material tileid_175 : base_jungle
-{
-}
-// Transitions:
-//__________________________________________________________
-//dirt - grass transitions
-// NW corner is TileA
-material tileid_122 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_in.png
-}
-// SW corner is TileA
-material tileid_123 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_in.png
-}
-// NE corner is TileA
-material tileid_124 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_in.png
-}
-// SE corner is TileA
-material tileid_121 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_se_corner_in.png
-}
-// E TileA W TileB
-material tileid_135 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_e_side.png
-}
-//duplicate
-material tileid_136 : tileid_135
-{
-}
-// W TileA E TileB
-material tileid_137 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_w_side.png
-}
-//duplicate
-material tileid_138 : tileid_137
-{
-}
-// N TileA S TileB
-material tileid_139 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_s_side.png
-}
-//duplicate
-material tileid_140 : tileid_139
-{
-}
-// S TileA N TileB
-material tileid_133 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_n_side.png
-}
-//duplicate
-material tileid_134 : tileid_133
-{
-}
-// SE Corner is TileB
-material tileid_125 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_se_corner_out.png
-}
-// NE Corner is TileB
-material tileid_131 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_out.png
-}
-// NW Corner is TileB
-material tileid_126 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_out.png
-}
-// SW Corner is TileB
-material tileid_130 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_out.png
-}
-// CROSSED Transitions
-material tileid_365 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_cross.png
-}
-material tileid_368 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_cross.png
-}
-material tileid_366 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_cross.png
-}
-material tileid_367 : transition_dirt_grass
-{
-	set_texture_alias blend_mask tex_blend_se_corner_cross.png
-}
-
-//__________________________________________________________
-//rock - grass transitions
-material tileid_571 : transition_rock_grass
-{
-	set_texture_alias blend_mask tex_blend_n_side.png
-}
-material tileid_564 : transition_rock_grass
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_out.png
-}
-material tileid_566 : transition_rock_grass
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_in.png
-}
-material tileid_572 : transition_rock_grass
-{
-	set_texture_alias blend_mask tex_blend_w_side.png
-}
-material tileid_563 : transition_rock_grass
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_out.png
-}
-material tileid_565 : transition_rock_grass
-{
-	set_texture_alias blend_mask tex_blend_se_corner_in.png
-}
-material tileid_570 : transition_rock_grass
-{
-	set_texture_alias blend_mask tex_blend_e_side.png
-}
-material tileid_569 : transition_rock_grass
-{
-	set_texture_alias blend_mask tex_blend_s_side.png
-}
-material tileid_567 : transition_rock_grass
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_in.png
-}
-material tileid_561 : transition_rock_grass
-{
-	set_texture_alias blend_mask tex_blend_se_corner_out.png
-}
-material tileid_568 : transition_rock_grass
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_in.png
-}
-material tileid_562 : transition_rock_grass
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_out.png
-}
-//__________________________________________________________
-//rock - dirt transitions
-// W TileA E TileB
-material tileid_220 : transition_rock_dirt
-{
-	set_texture_alias blend_mask tex_blend_w_side.png
-}
-// N TileA S TileB
-material tileid_221 : transition_rock_dirt
-{
-	set_texture_alias blend_mask tex_blend_s_side.png
-}
-// E TileA W TileB
-material tileid_222 : transition_rock_dirt
-{
-	set_texture_alias blend_mask tex_blend_e_side.png
-}
-// S TileA N TileB
-material tileid_223 : transition_rock_dirt
-{
-	set_texture_alias blend_mask tex_blend_n_side.png
-}
-// NE Corner is TileB
-material tileid_224 : transition_rock_dirt
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_out.png
-}
-// SE Corner is TileB
-material tileid_225 : transition_rock_dirt
-{
-	set_texture_alias blend_mask tex_blend_se_corner_out.png
-}
-// NW corner is TileA
-material tileid_226 : transition_rock_dirt
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_out.png
-}
-// NW Corner is TileB
-material tileid_227 : transition_rock_dirt
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_out.png
-}
-// SE corner is TileA
-material tileid_228 : transition_rock_dirt
-{
-	set_texture_alias blend_mask tex_blend_se_corner_in.png
-}
-// SW corner is TileA
-material tileid_229 : transition_rock_dirt
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_in.png
-}
-// NW corner is TileA
-material tileid_230 : transition_rock_dirt
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_in.png
-}
-// NE corner is TileA
-material tileid_231 : tileid_228
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_in.png
-}
-
-//__________________________________________________________
-//dirt - forest transitions
-// SE corner is TileA
-material tileid_364 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_se_corner_in.png
-}
-// NW corner is TileA
-material tileid_363 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_in.png
-}
-// SW corner is TileA
-material tileid_361 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_in.png
-}
-// NE corner is TileA
-material tileid_362 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_in.png
-}
-
-// NW Corner is TileB
-material tileid_355 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_out.png
-}
-// S TileA N TileB
-material tileid_357 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_n_side.png
-}
-// N TileA S TileB
-material tileid_360 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_s_side.png
-}
-// SE Corner is TileB
-material tileid_356 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_se_corner_out.png
-}
-// NE Corner is TileB
-material tileid_354 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_out.png
-}
-// SW Corner is TileB
-material tileid_353 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_out.png
-}
-// E TileA W TileB
-material tileid_358 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_e_side.png
-}
-// W TileA E TileB
-material tileid_359 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_w_side.png
-}
-// CROSSED TILES
-material tileid_369 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_cross.png
-}
-material tileid_372 : transition_dirt_forest
-{
-	set_texture_alias blend_mask tex_blend_se_corner_cross.png
-}
-//__________________________________________________________
-//grass - forest transitions
-// N TileA S TileB
-material tileid_209 : transition_grass_forest
-{
-	set_texture_alias blend_mask tex_blend_s_side.png
-}
-material tileid_210 : tileid_209
-{
-}
-material tileid_211 : tileid_209
-{
-}
-// W TileA E TileB
-material tileid_206 : transition_grass_forest
-{
-	set_texture_alias blend_mask tex_blend_w_side.png
-}
-material tileid_207 : tileid_206
-{
-}
-material tileid_208 : tileid_206
-{
-}
-// E TileA W TileB
-material tileid_203 : transition_grass_forest
-{
-	set_texture_alias blend_mask tex_blend_e_side.png
-}
-material tileid_204 : tileid_203
-{
-}
-material tileid_205 : tileid_203
-{
-}
-material tileid_212 : transition_grass_forest
-{
-	set_texture_alias blend_mask tex_blend_se_corner_in.png
-}
-// NW corner is TileA
-material tileid_213 : transition_grass_forest
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_in.png
-}
-material tileid_216 : transition_grass_forest
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_out.png
-}
-material tileid_217 : transition_grass_forest
-{
-	set_texture_alias blend_mask tex_blend_se_corner_out.png
-}
-material tileid_219 : transition_grass_forest
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_out.png
-}
-material tileid_3244 : tileid_219
-{
-}
-material tileid_218 : transition_grass_forest
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_out.png
-}
-material tileid_202 : tileid_218
-{
-}
-material tileid_215 : transition_grass_forest
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_in.png
-}
-material tileid_200 : transition_grass_forest
-{
-	set_texture_alias blend_mask tex_blend_n_side.png
-}
-material tileid_201 :tileid_200
-{
-}
-//__________________________________________________________
-//dirt - cobblestone transitions
-material tileid_1014 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_se_corner_cross.png
-}
-material tileid_1017 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_se_corner_in.png
-}
-material tileid_1018 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_out.png
-}
-material tileid_1019 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_out.png
-}
-material tileid_1020 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_out.png
-}
-material tileid_1021 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_se_corner_out.png
-}
-material tileid_1022 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_w_side.png
-}
-material tileid_1023 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_s_side.png
-}
-material tileid_1024 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_e_side.png
-}
-material tileid_1025 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_n_side.png
-}
-material tileid_1026 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_in.png
-}
-material tileid_1027 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_in.png
-}
-material tileid_1028 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_in.png
-}
-material tileid_1029 : transition_dirt_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_se_corner_in.png
-}
-//__________________________________________________________
-//grass - jungle transitions
-material tileid_176 : transition_grass_jungle
-{
-	set_texture_alias blend_mask tex_blend_s_side.png
-}
-material tileid_179 : transition_grass_jungle
-{
-	set_texture_alias blend_mask tex_blend_e_side.png
-}
-material tileid_182 : transition_grass_jungle
-{
-	set_texture_alias blend_mask tex_blend_n_side.png
-}
-material tileid_185 : transition_grass_jungle
-{
-	set_texture_alias blend_mask tex_blend_w_side.png
-}
-material tileid_188 : transition_grass_jungle
-{
-	set_texture_alias blend_mask tex_blend_se_corner_out.png
-}
-material tileid_191 : transition_grass_jungle
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_out.png
-}
-material tileid_192 : transition_grass_jungle
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_in.png
-}
-material tileid_195 : transition_grass_jungle
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_in.png
-}
-//__________________________________________________________
-//grass - cobblestone transitions
-material tileid_1661 : transition_grass_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_n_side.png
-}
-material tileid_1662 : transition_grass_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_e_side.png
-}
-material tileid_1663 : transition_grass_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_w_side.png
-}
-material tileid_1664 : transition_grass_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_s_side.png
-}
-material tileid_1666 : transition_grass_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_se_corner_in.png
-}
-material tileid_1668 : transition_grass_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_sw_corner_in.png
-}
-material tileid_1669 : transition_grass_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_out.png
-}
-material tileid_1670 : transition_grass_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_in.png
-}
-material tileid_1671 : transition_grass_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_ne_corner_out.png
-}
-material tileid_1673 : transition_grass_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_nw_corner_cross.png
-}
-material tileid_1674 : transition_grass_cobblestone
-{
-	set_texture_alias blend_mask tex_blend_se_corner_cross.png
-}
-//###########################################
-//no material
-material NoMaterial : terrain_base
-{
-	technique =

-	{ =

-		pass
-		{		=

-		}
-	} =

-}

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Sun Jan 13 22:28:57 2008
@@ -45,14 +45,8 @@
 		((iTranslatedTileTypeID  >=3D 13422) and (iTranslatedTileTypeID <=3D 134=
45)) or
 		((iTranslatedTileTypeID  >=3D 13460) and (iTranslatedTileTypeID <=3D 134=
83)) or
 		((iTranslatedTileTypeID  >=3D 13496) and (iTranslatedTileTypeID <=3D 135=
14))) then
-		if (gTerrainShader) then
-			-- assosiate to different tile, because we have already a shader materi=
al for all static tiles
-			iTranslatedTileTypeID=3D19999
-			iHue=3D0						--do not hue shaded water
-		else
-			-- assosiate to one all static water to one tileid (we don't have all s=
tatic water tiles as meshes)
-			iTranslatedTileTypeID=3D6040
-		end
+		-- assosiate to one all static water to one tileid (we don't have all st=
atic water tiles as meshes)
+		iTranslatedTileTypeID=3D6040
 	end
 	return iTranslatedTileTypeID,iHue
 end

Modified: trunk/lua/lib.terrain.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.lua (original)
+++ trunk/lua/lib.terrain.lua Sun Jan 13 22:28:57 2008
@@ -16,11 +16,6 @@
 =

 	-- FILTER: Special Filters
 	iTranslatedTileTypeID =3D FilterMap(iTranslatedTileTypeID)
-
-	--temporary for testing material/shader use for tiles (mystiqq)
-	if (gTerrainShader and OgreMaterialNameKnown("tileid_" .. iTranslatedTile=
TypeID)) then  =

-		return "tileid_" .. iTranslatedTileTypeID
-	end
 =

 	local matname =3D gTerrainMaterialCache[iTileTypeID]
 	if ((not matname) and gTexMapLoader) then

Modified: trunk/vs8/iris.sln
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.sln (original)
+++ trunk/vs8/iris.sln Sun Jan 13 22:28:57 2008
@@ -11,15 +11,20 @@
 Global
 	GlobalSection(SolutionConfigurationPlatforms) =3D preSolution
 		Debug|Win32 =3D Debug|Win32
+		Release - boost-threads_enabled|Win32 =3D Release - boost-threads_enable=
d|Win32
 		Release|Win32 =3D Release|Win32
 	EndGlobalSection
 	GlobalSection(ProjectConfigurationPlatforms) =3D postSolution
 		{E2D2CF97-591B-450F-B5EA-21CB9B6A5DA5}.Debug|Win32.ActiveCfg =3D Debug|W=
in32
 		{E2D2CF97-591B-450F-B5EA-21CB9B6A5DA5}.Debug|Win32.Build.0 =3D Debug|Win=
32
+		{E2D2CF97-591B-450F-B5EA-21CB9B6A5DA5}.Release - boost-threads_enabled|W=
in32.ActiveCfg =3D Release|Win32
+		{E2D2CF97-591B-450F-B5EA-21CB9B6A5DA5}.Release - boost-threads_enabled|W=
in32.Build.0 =3D Release|Win32
 		{E2D2CF97-591B-450F-B5EA-21CB9B6A5DA5}.Release|Win32.ActiveCfg =3D Relea=
se|Win32
 		{E2D2CF97-591B-450F-B5EA-21CB9B6A5DA5}.Release|Win32.Build.0 =3D Release=
|Win32
 		{FF3B6490-D65F-7B41-982B-8D8339958224}.Debug|Win32.ActiveCfg =3D Debug|W=
in32
 		{FF3B6490-D65F-7B41-982B-8D8339958224}.Debug|Win32.Build.0 =3D Debug|Win=
32
+		{FF3B6490-D65F-7B41-982B-8D8339958224}.Release - boost-threads_enabled|W=
in32.ActiveCfg =3D Release|Win32
+		{FF3B6490-D65F-7B41-982B-8D8339958224}.Release - boost-threads_enabled|W=
in32.Build.0 =3D Release|Win32
 		{FF3B6490-D65F-7B41-982B-8D8339958224}.Release|Win32.ActiveCfg =3D Relea=
se|Win32
 		{FF3B6490-D65F-7B41-982B-8D8339958224}.Release|Win32.Build.0 =3D Release=
|Win32
 	EndGlobalSection



From no-reply at zwischenwelt.org  Sat Jan 12 19:13:06 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 12 Jan 2008 18:13:06 -0000
Subject: [Iris-commit] [IRIS] r1768 - in /trunk: data/config.lua.dist
	lua/lib.compass.lua
Message-ID: <20080115170830.38ED31C182B7@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 12 19:13:04 2008
New Revision: 1768

Log:
disabled detail compass by default, hopefully this should solve some shadow=
 issues

Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.compass.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Jan 12 19:13:04 2008
@@ -435,3 +435,5 @@
 =

 -- low resolution texture atlas
 -- gLowResTexAtlasNameMap =3D { ["alpha_tex_atlas_0"]=3D"alpha_tex_atlas_0=
_512", ["tex_atlas_0"]=3D"tex_atlas_0_512" }
+
+gEnableCompassRadar =3D false -- the detailed compass is rendered using st=
encil buffers and seems to cause trouble with shadows

Modified: trunk/lua/lib.compass.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.compass.lua (original)
+++ trunk/lua/lib.compass.lua Sat Jan 12 19:13:04 2008
@@ -17,7 +17,7 @@
 		gIrisCompassDialog.mapdot 				=3D gIrisCompassDialog.rootwidget:CreateCh=
ild()
 		gIrisCompassDialog.compassframe_static	=3D gIrisCompassDialog.rootwidget=
:CreateChild()
 		gIrisCompassDialog.compassframe_rot		=3D gIrisCompassDialog.rootwidget:C=
reateChild()
-		if (gGroundBlockLoader and gStaticBlockLoader and gRadarColorLoader) then
+		if (gGroundBlockLoader and gStaticBlockLoader and gRadarColorLoader and =
gEnableCompassRadar) then
 			gIrisCompassDialog.radar			=3D CreateRadar( gGroundBlockLoader, gStatic=
BlockLoader, gRadarColorLoader )
 		end
 		=

@@ -102,7 +102,7 @@
 	gCompassMapH =3D gGroundBlockLoader and gGroundBlockLoader:GetMapH() or 1
 	ZoomCompass(1.0)
 	=

-	if (gGroundBlockLoader and gStaticBlockLoader and gRadarColorLoader) then
+	if (gGroundBlockLoader and gStaticBlockLoader and gRadarColorLoader and g=
EnableCompassRadar) then
 		gIrisCompassDialog.radar:Destroy()
 		gIrisCompassDialog.radar =3D CreateRadar( gGroundBlockLoader, gStaticBlo=
ckLoader, gRadarColorLoader )
 	end
@@ -118,8 +118,8 @@
 	if (not gIrisCompassDialog) then return end
 	gCompassVisibleRad =3D gCompassVisibleRad * factor
 	--AddFadeLines("visrad=3D"..gCompassVisibleRad)
-	local bRoughCompass =3D gCompassVisibleRad > giCompassDetailLimit
-	if (not bRoughCompass) then gCompassVisibleRad =3D giCompassDetailLimit e=
nd
+	local bRoughCompass =3D (gCompassVisibleRad > giCompassDetailLimit) or (n=
ot gIrisCompassDialog.radar)
+	gCompassVisibleRad =3D max(gCompassVisibleRad,giCompassDetailLimit)
 	gIrisCompassDialog.compass.gfx:SetVisible( bRoughCompass )
 	gIrisCompassDialog.compass.gfx:SetUVRad(gCompassVisibleRad/gCompassMapW,
 											gCompassVisibleRad/gCompassMapH)
@@ -174,7 +174,7 @@
 			local rsin =3D halfwidth * math.sin(- ax + gfDeg2Rad*90)
 			local rcos =3D halfwidth * math.cos(- ax + gfDeg2Rad*90)
 			local mygfx =3D gIrisCompassDialog.compassframe_rot.gfx
-			mygfx:RenderableBegin(4,6,false,false,OT_TRIANGLE_LIST)
+			mygfx:RenderableBegin(4,6,true,false,OT_TRIANGLE_LIST)
 			mygfx:RenderableVertex((mx - rcos - rsin)/vw * 2.0 - 1.0,(my - rcos + r=
sin)/vh * (-2.0) + 1.0,z, 0,0)
 			mygfx:RenderableVertex((mx + rcos - rsin)/vw * 2.0 - 1.0,(my - rcos - r=
sin)/vh * (-2.0) + 1.0,z, 1,0)
 			mygfx:RenderableVertex((mx - rcos + rsin)/vw * 2.0 - 1.0,(my + rcos + r=
sin)/vh * (-2.0) + 1.0,z, 0,1)



From no-reply at zwischenwelt.org  Tue Jan 15 19:54:33 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 15 Jan 2008 18:54:33 -0000
Subject: [Iris-commit] [IRIS] r1773 - in /trunk: data/config.lua.dist
 lua/lib.loading.lua lua/lib.macrolist.lua lua/lib.terrain.multitex.lua
Message-ID: <20080115185433.61CD21C1804C@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Jan 15 19:54:32 2008
New Revision: 1773

Log:
added map-reload macro : MacroCmd_ReloadMap

Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.loading.lua
    trunk/lua/lib.macrolist.lua
    trunk/lua/lib.terrain.multitex.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Tue Jan 15 19:54:32 2008
@@ -48,7 +48,7 @@
 	gHudNamesFontSize	=3D 26
 end
 =

--- GUI Styles : sience,iris,ray  (see data\lua\gui\gui.styles.lua)
+-- GUI Styles : sience,iris,ray  (see lua\gui\gui.styles.lua)
 gGuiDefaultStyleSet =3D "sience"
 =

 -- loader types, FullFile is faster, but uses more ram, OnDemand is slower=
, but uses almost no ram

Modified: trunk/lua/lib.loading.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.loading.lua (original)
+++ trunk/lua/lib.loading.lua Tue Jan 15 19:54:32 2008
@@ -198,14 +198,16 @@
 end
 =

 -- destroys old items, and cleans up old static,ground loaders
-function UnloadOldMap ()
+function UnloadOldMap (bDoNotClearObjects)
 	if (not gMapLoaded) then return end
 	gMapLoaded =3D false
 	-- destroy all objects
-	DestroyAllObjects()
+	if (not bDoNotClearObjects) then DestroyAllObjects() end
 	-- destroy old ground and static loaders
 	if (gGroundBlockLoader) then gGroundBlockLoader:Destroy() gGroundBlockLoa=
der =3D nil end
 	if (gStaticBlockLoader) then gStaticBlockLoader:Destroy() gStaticBlockLoa=
der =3D nil end
+	MultiTexTerrain_UnloadAll()
+	Renderer3D:ClearMapCache()
 end
 =

 -- Loads Maps+Statics+Diff Files (only pre 6.0.0)

Modified: trunk/lua/lib.macrolist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.macrolist.lua (original)
+++ trunk/lua/lib.macrolist.lua Tue Jan 15 19:54:32 2008
@@ -94,6 +94,13 @@
 	ToggleCompass()
 	Client_TakeGridScreenshot(gMainWorkingDir.."screenshots/")
 	ToggleCompass()
+end
+
+function MacroCmd_ReloadMap		() 			=

+	if (not gInGameStarted) then return end
+	local mapindex =3D gMapIndex
+	UnloadOldMap(true) -- do not clear objects
+	LoadMap(gMapIndex)
 end
 =

 =


Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Tue Jan 15 19:54:32 2008
@@ -190,6 +190,13 @@
 end
 =

 =

+function MultiTexTerrain_UnloadAll ()
+	for k,gfx in pairs(gMultiTexTerrain_GfxList) do gfx:Destroy() end
+	gMultiTexTerrain_GfxList =3D {}
+	gMultiTexTerrain_BX =3D nil
+	gMultiTexTerrain_BY =3D nil
+end
+
 function MultiTexTerrainStep ()
 	if (not gEnableMultiTexTerrain) then return end
 	if (gMultiTexTerrain_NextStep > gMyTicks) then return end



From no-reply at zwischenwelt.org  Wed Jan 16 00:51:33 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 15 Jan 2008 23:51:33 -0000
Subject: [Iris-commit] [IRIS] r1774 - /trunk/lua/lib.debugmenu.lua
Message-ID: <20080115235135.360271C1804C@zwischenwelt.org>

Author: mystiq
Date: Wed Jan 16 00:51:32 2008
New Revision: 1774

Log:
Added menu for switching models(F7 key), full creature models table and com=
mented out ones that crash.

Modified:
    trunk/lua/lib.debugmenu.lua

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Wed Jan 16 00:51:32 2008
@@ -14,6 +14,9 @@
 gDebugMenuAnimIndex =3D -1 -- (-1) shows rest pos
 gDebugMenuAnimIndex =3D 0
 gDebugMenuModelIndex =3D 1
+gDebugMenuModel =3D { artid=3D400, content=3D{} }
+gDebugMenuModelName =3D ""
+gDebugMenuModelTable =3D {}
 gDebugMenuMainGfxPos =3D {-0.5,0.5,-0.15}
 =

 function RepairEquipIndex (arr) =

@@ -24,130 +27,379 @@
 	end
 end
 =

-gDebugTestMobiles =3D {
+--[[
+--player characters with equipment
+gDebugMenuModelTable =3D {
 	-- male
 	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
 	--female
 	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
-
-	{artid=3D hex2num("5") , content=3D{}},		--birds_eagle
-	{artid=3D hex2num("39") , content=3D{}},	--mongbats_mongbat
-	{artid=3D hex2num("105") , content=3D{}},	--dragons_wyrm_ancient
-
-	-- llamas_llama_pack - broken (crash) -> mapped to id: 220 (grannyfilter)
-	{artid=3D 292 , content=3D{}},
-	-- k=C3=A4fer - broken animation
-	{artid=3D hex2num("0xA9") , content=3D{}},
-	--791 broken horse
-	{artid=3D hex2num("0x317"), content=3D{}},
-
-	{artid=3D	hex2num("0xB1") , content=3D{}}, -- 177 broken
-	{artid=3D	hex2num("0x72") , content=3D{}}, -- 114 broken =

-	{artid=3D	hex2num("0x73") , content=3D{}},  -- 115 broken
-	{artid=3D	hex2num("0x75") , content=3D{}}, -- 117 broken
-
-	{artid=3D hex2num("0xD5") , content=3D{}}, =

-	{artid=3D	hex2num("0xF1") , content=3D{}}, =

-	{artid=3D	hex2num("0xF3") , content=3D{}}, =

-	{artid=3D	hex2num("0xCC") , content=3D{}}, -- 204, broken horse
-	{artid=3D	hex2num("0xC8") , content=3D{}}, -- 200 : standard horse
-	{artid=3D	hex2num("0xE2") , content=3D{}}, -- 226 broken
-	{artid=3D	hex2num("0xE4") , content=3D{}}, -- 228 broken
-	{artid=3D hex2num("0xFC"), content=3D{}},
-	{artid=3D	hex2num("0xDC") , content=3D{}}, =

-	{artid=3D	hex2num("0xD2") , content=3D{}}, =

-	{artid=3D	hex2num("0xDA") , content=3D{}}, =

-	{artid=3D	hex2num("0xDB") , content=3D{}}, =

-	{artid=3D	hex2num("0xD5") , content=3D{}}, =

-	{artid=3D	hex2num("0x90") , content=3D{}}, =

-	{artid=3D	hex2num("0x74") , content=3D{}},  -- 116 broken
-	{artid=3D	hex2num("0xB2") , content=3D{}},  -- 178 broken
-	{artid=3D	hex2num("0x84") , content=3D{}}, =

-	{artid=3D	hex2num("0xB3") , content=3D{}},  -- 179 broken
-	{artid=3D	hex2num("0xBB") , content=3D{}}, =

-	{artid=3D	hex2num("0xBC") , content=3D{}}, =

-	{artid=3D	hex2num("0x317") , content=3D{}}, -- brokenanim
-	{artid=3D	hex2num("0x31A") , content=3D{}}, -- brokenanim
-	{artid=3D	hex2num("0x31F") , content=3D{}}, -- brokenanim
-	{artid=3D	hex2num("0xBE") , content=3D{}},  -- 190 broken
-	{artid=3D hex2num("0x11C") , content=3D{}}, -- 284 anim broken, scale bro=
ken..
-	{artid=3D	hex2num("0xFB") , content=3D{}}, =

-
-	{artid=3D400,hue=3D33780, content=3D{[4]=3D{artid=3D5422,hue=3D1728,animi=
d=3D430},[26]=3D{artid=3D3701,hue=3D0,animid=3D422},[16]=3D{artid=3D8269,hu=
e=3D1147,animid=3D906},[27]=3D{artid=3D3701,hue=3D0,animid=3D422},[17]=3D{a=
rtid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,hue=3D1147,animid=
=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D{artid=3D3701,hue=
=3D0,animid=3D422},}},
-	{artid=3D400,hue=3D33780, content=3D{[26]=3D{artid=3D3701,hue=3D0,animid=
=3D422},[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},[27]=3D{artid=3D3701,=
hue=3D0,animid=3D422},[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D=
{artid=3D8252,hue=3D1147,animid=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=
=3D466},[21]=3D{artid=3D3701,hue=3D0,animid=3D422},}},
-	{artid=3D400,hue=3D33780, content=3D{[27]=3D{artid=3D3701,hue=3D0,animid=
=3D422},[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,=
hue=3D1147,animid=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D=
{artid=3D3701,hue=3D0,animid=3D422},}},
-	{artid=3D400,hue=3D33780, content=3D{[11]=3D{artid=3D8252,hue=3D1147,anim=
id=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D{artid=3D3701,h=
ue=3D0,animid=3D422},}},
-
-	{artid=3D400, content=3D{}},
-	{artid=3D400, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
-	{artid=3D401, content=3D{}},
-	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
-	{artid=3D014, content=3D{}},
-	{artid=3D778, content=3D{}},
-	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
-	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[4]=3D{artid=
=3D5137,animid=3D529},[6]=3D{artid=3D9797,animid=3D682},[7]=3D{artid=3D5140=
,animid=3D530},[19]=3D{artid=3D5136,animid=3D528},[16]=3D{artid=3D8256,anim=
id=3D800},[21]=3D{artid=3D3701,animid=3D422},[13]=3D{artid=3D5141,animid=3D=
527},[29]=3D{artid=3D3708,animid=3D0},[11]=3D{artid=3D8266,animid=3D903},}},
-	{artid=3D401, content=3D({{artid=3D3932,animid=3D631},{artid=3D7107,animi=
d=3D993},{artid=3D5137,animid=3D529},{artid=3D9797,animid=3D682},{artid=3D5=
140,animid=3D530},{artid=3D5136,animid=3D528},{artid=3D8256,animid=3D800},{=
artid=3D3701,animid=3D422},{artid=3D5141,animid=3D527},{artid=3D3708,animid=
=3D0},{artid=3D8266,animid=3D903},})},
-
-	{artid=3D400, content=3D({{artid=3D3519,animid=3D972},})},
-	{artid=3D400, content=3D({{artid=3D3519,animid=3D972},{artid=3D5901,animi=
d=3D479},{artid=3D5422,animid=3D430},{artid=3D5399,animid=3D434},{artid=3D5=
907,animid=3D404},{artid=3D3701,animid=3D422},{artid=3D8252,animid=3D701},}=
)},
-	{artid=3D987, content=3D({{artid=3D5182,animid=3D624},{artid=3D5903,animi=
d=3D480},{artid=3D5399,animid=3D434},{artid=3D5130,animid=3D565},{artid=3D5=
397,animid=3D468},{artid=3D3701,animid=3D422},{artid=3D7939,animid=3D469},}=
)},
-	{artid=3D401, content=3D({{artid=3D2594,animid=3D500},{artid=3D5899,animi=
d=3D477},{artid=3D7933,animid=3D435},{artid=3D5431,animid=3D455},{artid=3D5=
397,animid=3D468},{artid=3D5441,animid=3D490},{artid=3D8261,animid=3D710},{=
artid=3D3701,animid=3D422},})},
-	{artid=3D401, content=3D({{artid=3D2594,animid=3D500},{artid=3D5905,animi=
d=3D476},{artid=3D5399,animid=3D434},{artid=3D5431,animid=3D455},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8262,animid=3D712},}=
)},
-	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
-	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
-	{artid=3D400, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D8266,animid=3D903},{artid=3D3=
701,animid=3D422},})},
---[[
-	-- meshes only crash when using vertex-shader
-	{artid=3D040, content=3D{}},
-	{artid=3D	hex2num("0x76") , content=3D{}},
-	{artid=3D	hex2num("0x77") , content=3D{}}, =

-	{artid=3D	hex2num("0x78") , content=3D{}},
-	{artid=3D	hex2num("0x79") , content=3D{}}, =

-	{artid=3D	hex2num("0x3C") , content=3D{}}, =

-	{artid=3D	hex2num("0xC8") , content=3D{}}, =

-	{artid=3D hex2num("0x123") , content=3D{}},
-	{artid=3D199, content=3D{}},
-	{artid=3D225, content=3D{}}, -- timberwolf
-	{artid=3D256, content=3D{}},
-	{artid=3D	hex2num("0x319") , content=3D{}},
-	{artid=3D400,hue=3D33780, content=3D{
-		{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount},
-		[4]=3D{artid=3D5422,hue=3D1728,animid=3D430},[26]=3D{artid=3D3701,hue=3D=
0,animid=3D422},
-		[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},[27]=3D{artid=3D3701,hue=
=3D0,animid=3D422},
-		[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,hue=
=3D1147,animid=3D701},
-		[21]=3D{artid=3D3701,hue=3D0,animid=3D422},}},   =

-	{artid=3D401, content=3D({{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount=
},{artid=3D5899,animid=3D477},{artid=3D5422,animid=3D430},{artid=3D5399,ani=
mid=3D434},{artid=3D5435,animid=3D466},{artid=3D8251,animid=3D700},{artid=
=3D3701,animid=3D422},})},
-	{artid=3D400, content=3D({{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount=
},{artid=3D5899,animid=3D477},{artid=3D5422,animid=3D430},{artid=3D5399,ani=
mid=3D434},{artid=3D5435,animid=3D466},{artid=3D8251,animid=3D700},{artid=
=3D3701,animid=3D422},})},
-]]--
---[[
-	{artid=3D2011, content=3D{{animid=3D2002}}}, -- 02:feet 11:ulegs
-	{artid=3D1466, content=3D{}}, -- flimmer, need culling? (fixed)
-	{artid=3D1700, content=3D{}}, -- hair, texcoords or normals broken ? (fix=
ed)
-	{artid=3D500, content=3D{}}, -- lantern, texcoords broken ?! (fixed)
-	{artid=3D468, content=3D{}}, -- cape, texcoords broken ? culling? (fixed)
-	{artid=3D1468, content=3D{}}, -- cape, texcoords broken ? culling? (fixed)
-	{artid=3D490, content=3D{}}, -- sash, texcoords broken ? culling? (fixed)
-	{artid=3D1490, content=3D{}},  -- sash, texcoords broken ? culling? (fixe=
d)
-
-	{artid=3D1924, content=3D{{animid=3D3012}}},
-	{artid=3D3604, content=3D{{animid=3D3012}}},
-	{artid=3D1925, content=3D{{animid=3D3012}}},
-	{artid=3D3605, content=3D{{animid=3D3012}}},
-
-	{artid=3D3006, content=3D{}}, -- female lower legs, sience was having pro=
blem with them, 2 submeshes !
-	{artid=3D2013, content=3D{}},
-	{artid=3D2009, content=3D{}},
-	{artid=3D2012, content=3D{}},
-	{artid=3D3013, content=3D{}},
-	{artid=3D3009, content=3D{}},
-	{artid=3D3012, content=3D{}},
-	{artid=3D3009, content=3D{}},
-	{artid=3D3012, content=3D{}},
-	{artid=3D3009, content=3D{}},
-	{artid=3D3012, content=3D{}},
-	{artid=3D3009, content=3D{}},
-	{artid=3D3012, content=3D{}},
-]]--
+}
+--]]
+
+--creatures
+--used regular expression to make these "^(\d+)(.*?\s){8}(.*?)[\s]{0,}$" a=
nd replace with "{artid=3D$1 , content=3D{}}, \t--$3" in PSpad
+--removed duplicates by hand
+--commented ones crashes (no shaders used)
+gDebugMenuModelTable =3D {
+	{artid=3D187 , content=3D{}}, 	--ridgeback_ridgeback
+	{artid=3D193 , content=3D{}}, 	--ridgeback_ridgeback_ethereal
+	{artid=3D188 , content=3D{}}, 	--ridgeback_savage
+	{artid=3D787 , content=3D{}}, 	--ant_lion
+	{artid=3D157 , content=3D{}}, 	--arachnids_spider_black_widow
+	{artid=3D173 , content=3D{}}, 	--arachnids_spider_black_widow
+	{artid=3D11 , content=3D{}}, 	--arachnids_spider_dread
+	{artid=3D19 , content=3D{}}, 	--arachnids_spider_dread
+	{artid=3D20 , content=3D{}}, 	--arachnids_spider_frost
+	{artid=3D28 , content=3D{}}, 	--arachnids_spider_giant
+	{artid=3D779 , content=3D{}}, 	--bogling
+	{artid=3D780 , content=3D{}}, 	--bog_thing
+	{artid=3D232 , content=3D{}}, 	--bovines_bull_brown
+	{artid=3D233 , content=3D{}}, 	--bovines_bull_spotted
+	{artid=3D216 , content=3D{}}, 	--bovines_cow_brown
+	{artid=3D231 , content=3D{}}, 	--bovines_cow_spotted
+	{artid=3D211 , content=3D{}}, 	--bruins_bear_black
+	{artid=3D167 , content=3D{}}, 	--bruins_bear_brown
+	{artid=3D212 , content=3D{}}, 	--bruins_bear_grizzly
+	{artid=3D213 , content=3D{}}, 	--bruins_bear_polar
+	{artid=3D217 , content=3D{}}, 	--canines_dog_hound
+	{artid=3D97 , content=3D{}}, 	--canines_hell_hound
+	{artid=3D98 , content=3D{}}, 	--canines_hell_hound
+	{artid=3D225 , content=3D{}}, 	--canines_wolf_timber
+	{artid=3D99 , content=3D{}}, 	--canines_wolf_dark
+	{artid=3D23 , content=3D{}}, 	--canines_wolf_dire
+	{artid=3D25 , content=3D{}}, 	--canines_wolf_grey
+	{artid=3D27 , content=3D{}}, 	--canines_wolf_grey
+	{artid=3D100 , content=3D{}}, 	--canines_wolf_silver
+	{artid=3D34 , content=3D{}}, 	--canines_wolf_white
+	{artid=3D37 , content=3D{}}, 	--canines_wolf_white
+	{artid=3D101 , content=3D{}}, 	--centaurs_centaur
+	{artid=3D792 , content=3D{}}, 	--chaos_demon
+	{artid=3D786 , content=3D{}}, 	--chariot
+	{artid=3D756 , content=3D{}}, 	--clockwork_overseer
+	{artid=3D757 , content=3D{}}, 	--clockwork_minion
+	{artid=3D763 , content=3D{}}, 	--clockwork_minion
+	{artid=3D75 , content=3D{}}, 	--cyclops_cyclops
+	{artid=3D9 , content=3D{}}, 	--daemons_daemon
+	{artid=3D10 , content=3D{}}, 	--daemons_daemon
+	{artid=3D38 , content=3D{}}, 	--daemons_daemon_black_gate
+	{artid=3D40 , content=3D{}}, 	--daemons_daemon_elder
+	{artid=3D102 , content=3D{}}, 	--daemons_daemon_exodus
+	{artid=3D43 , content=3D{}}, 	--daemons_daemon_ice_fiend
+--	{artid=3D774 , content=3D{}}, 	--Dawn_Girl
+	{artid=3D237 , content=3D{}}, 	--deer_doe
+	{artid=3D234 , content=3D{}}, 	--deer_stag
+	{artid=3D151 , content=3D{}}, 	--dolphins_dolphin
+	{artid=3D103 , content=3D{}}, 	--dragons_dragon_asian
+	{artid=3D12 , content=3D{}}, 	--dragons_dragon_retro_grey
+	{artid=3D172 , content=3D{}}, 	--dragons_dragon_retro_red
+	{artid=3D59 , content=3D{}}, 	--dragons_dragon_retro_red
+	{artid=3D49 , content=3D{}}, 	--dragons_wyrm_retro_white
+	{artid=3D180 , content=3D{}}, 	--dragons_wyrm_retro_white
+	{artid=3D60 , content=3D{}}, 	--dragons_dragon_retro_grey
+	{artid=3D61 , content=3D{}}, 	--dragons_dragon_retro_red
+--#This is here so the skeletal and ethereal can map animations to it
+	{artid=3D105 , content=3D{}}, 	--dragons_wyrm_ancient
+
+	{artid=3D46 , content=3D{}}, 	--Mf_Dragon_Rust
+	{artid=3D106 , content=3D{}}, 	--dragons_wyrm_shadow
+	{artid=3D104 , content=3D{}}, 	--dragons_dragon_skeletal
+	{artid=3D62 , content=3D{}}, 	--dragons_wyvern
+	{artid=3D14 , content=3D{}}, 	--elementals_earth_elemental
+	{artid=3D107 , content=3D{}}, 	--elementals_agapite_elemental
+	{artid=3D108 , content=3D{}}, 	--elementals_bronze_elemental
+	{artid=3D109 , content=3D{}}, 	--elementals_copper_elemental
+	{artid=3D110 , content=3D{}}, 	--elementals_copper_dull_elemental
+	{artid=3D166 , content=3D{}}, 	--elementals_gold_elemental
+	{artid=3D111 , content=3D{}}, 	--elementals_iron_elemental
+	{artid=3D112 , content=3D{}}, 	--elementals_valorite_elemental
+	{artid=3D113 , content=3D{}}, 	--elementals_verite_elemental
+	{artid=3D158 , content=3D{}}, 	--elementals_acid_elemental
+	{artid=3D13 , content=3D{}}, 	--elementals_air_elemental
+	{artid=3D159 , content=3D{}}, 	--elementals_blood_elemental
+	{artid=3D160 , content=3D{}}, 	--elementals_blood_elemental
+	{artid=3D15 , content=3D{}}, 	--elementals_fire_elemental
+	{artid=3D161 , content=3D{}}, 	--elementals_ice_elemental
+	{artid=3D162 , content=3D{}}, 	--elementals_poison_elemental
+	{artid=3D163 , content=3D{}}, 	--elementals_snow_elemental
+	{artid=3D16 , content=3D{}}, 	--elementals_water_elemental
+	{artid=3D164 , content=3D{}}, 	--ethereals_energy_vortex
+	{artid=3D165 , content=3D{}}, 	--ethereals_wisp
+	{artid=3D58 , content=3D{}}, 	--ethereals_wisp
+	{artid=3D200 , content=3D{}}, 	--equines_horse_dappled_brown
+	{artid=3D190 , content=3D{}}, 	--equines_horse_firesteed
+	{artid=3D820 , content=3D{}}, 	--equines_horse_dappled_brown
+	{artid=3D291 , content=3D{}}, 	--equines_horse_dappled_brown_pack
+	{artid=3D226 , content=3D{}}, 	--equines_horse_dappled_grey
+	{artid=3D846 , content=3D{}}, 	--equines_horse_dappled_grey
+	{artid=3D204 , content=3D{}}, 	--equines_horse_dark_brown
+	{artid=3D824 , content=3D{}}, 	--equines_horse_dark_brown
+	{artid=3D228 , content=3D{}}, 	--equines_horse_tan
+	{artid=3D848 , content=3D{}}, 	--equines_horse_tan
+	{artid=3D114 , content=3D{}}, 	--equines_horse_dark_steed
+	{artid=3D115 , content=3D{}}, 	--equines_horse_ethereal
+	{artid=3D116 , content=3D{}}, 	--equines_horse_nightmare
+	{artid=3D177 , content=3D{}}, 	--equines_horse_nightmare
+	{artid=3D178 , content=3D{}}, 	--equines_horse_nightmare
+	{artid=3D179 , content=3D{}}, 	--equines_horse_nightmare
+	{artid=3D117 , content=3D{}}, 	--equines_horse_silver_steed
+	{artid=3D118 , content=3D{}}, 	--equines_horse_war_brittanian
+	{artid=3D119 , content=3D{}}, 	--equines_horse_war_mage_council
+	{artid=3D120 , content=3D{}}, 	--equines_horse_war_minax
+	{artid=3D121 , content=3D{}}, 	--equines_horse_war_shadowlord
+	{artid=3D122 , content=3D{}}, 	--equines_unicorn
+	{artid=3D192 , content=3D{}}, 	--equines_unicorn_ethereal
+	{artid=3D123 , content=3D{}}, 	--ethereal_warriors_male
+	{artid=3D175 , content=3D{}}, 	--ethereal_warriors_male
+	{artid=3D2 , content=3D{}}, 	--ettins_ettin
+	{artid=3D18 , content=3D{}}, 	--ettins_ettin
+	{artid=3D63 , content=3D{}}, 	--felines_cougar
+	{artid=3D64 , content=3D{}}, 	--felines_leopard_snow
+	{artid=3D65 , content=3D{}}, 	--felines_leopard_snow
+	{artid=3D214 , content=3D{}}, 	--felines_panther
+	{artid=3D127 , content=3D{}}, 	--felines_predator_hellcat
+	{artid=3D128 , content=3D{}}, 	--fey_race_pixie
+	{artid=3D176 , content=3D{}}, 	--fey_race_pixie
+	{artid=3D781 , content=3D{}}, 	--fire_ant_worker
+	{artid=3D782 , content=3D{}}, 	--fire_ant_warrior
+	{artid=3D783 , content=3D{}}, 	--fire_ant_queen
+	{artid=3D804 , content=3D{}}, 	--fire_ant_matriarch
+	{artid=3D805 , content=3D{}}, 	--black_ant_worker
+	{artid=3D806 , content=3D{}}, 	--black_ant_warrior
+	{artid=3D807 , content=3D{}}, 	--black_ant_queen
+	{artid=3D808 , content=3D{}}, 	--black_ant_matriarch
+	{artid=3D8 , content=3D{}}, 	--flails_corpser
+	{artid=3D47 , content=3D{}}, 	--flails_reaper
+	{artid=3D66 , content=3D{}}, 	--flails_swamp_tentacles
+	{artid=3D129 , content=3D{}}, 	--flails_swamp_tentacles
+	{artid=3D80 , content=3D{}}, 	--frogs_frog_giant
+	{artid=3D4 , content=3D{}}, 	--gargoyles_gargoyle
+	{artid=3D130 , content=3D{}}, 	--gargoyles_gargoyle_blistering
+	{artid=3D67 , content=3D{}}, 	--gargoyles_gargoyle_stone
+	{artid=3D753 , content=3D{}}, 	--gargoyles_gargoyle_slave
+	{artid=3D754 , content=3D{}}, 	--gargoyles_gargoyle_enforcer
+	{artid=3D755 , content=3D{}}, 	--gargoyles_gargoyle_guard
+	{artid=3D758 , content=3D{}}, 	--gargoyles_gargoyle_shopkeeper
+	{artid=3D22 , content=3D{}}, 	--gazers_gazer
+	{artid=3D68 , content=3D{}}, 	--gazers_gazer_elder
+	{artid=3D69 , content=3D{}}, 	--gazers_gazer_elder
+	{artid=3D131 , content=3D{}}, 	--genies_efreet
+	{artid=3D791 , content=3D{}}, 	--giant_beetle
+	{artid=3D195 , content=3D{}}, 	--giant_beetle_ethereal
+	{artid=3D752 , content=3D{}}, 	--golem_iron
+	{artid=3D29 , content=3D{}}, 	--gorillas_silverback
+	{artid=3D30 , content=3D{}}, 	--harpies_harpy
+	{artid=3D73 , content=3D{}}, 	--harpies_harpy_stone
+	{artid=3D31 , content=3D{}}, 	--headless_headless
+	{artid=3D776 , content=3D{}}, 	--horde_demon
+	{artid=3D795 , content=3D{}}, 	--horde_demon
+	{artid=3D796 , content=3D{}}, 	--horde_demon
+	{artid=3D74 , content=3D{}}, 	--imps_imp
+	{artid=3D168 , content=3D{}}, 	--imps_shadow_fiend
+	{artid=3D764 , content=3D{}}, 	--Juka_Warrior
+	{artid=3D765 , content=3D{}}, 	--Juka_Mage
+--	{artid=3D768 , content=3D{}}, 	--Juggernaut	seems that this doesnt even=
 exist?! nothing found with this id
+	{artid=3D132 , content=3D{}}, 	--kirin_kirin
+	{artid=3D191 , content=3D{}}, 	--kirin_kirin_ethereal
+	{artid=3D998 , content=3D{}}, 	--kirin_kirin
+	{artid=3D77 , content=3D{}}, 	--krakens_kraken
+	{artid=3D24 , content=3D{}}, 	--liche_liche_retro
+	{artid=3D78 , content=3D{}}, 	--liche_liche_lord_retro
+	{artid=3D79 , content=3D{}}, 	--liche_liche_lord_retro
+	{artid=3D82 , content=3D{}}, 	--liche_liche_lord_retro
+	{artid=3D33 , content=3D{}}, 	--lizard_race_lizardman
+	{artid=3D35 , content=3D{}}, 	--lizard_race_lizardman
+	{artid=3D36 , content=3D{}}, 	--lizard_race_lizardman
+	{artid=3D202 , content=3D{}}, 	--lizards_alligator_brown
+	{artid=3D133 , content=3D{}}, 	--lizards_alligator_small
+	{artid=3D134 , content=3D{}}, 	--lizards_komodo_dragon
+	{artid=3D206 , content=3D{}}, 	--lizards_lava_lizard
+	{artid=3D220 , content=3D{}}, 	--llamas_llama
+	{artid=3D828 , content=3D{}}, 	--llamas_llama
+	{artid=3D170 , content=3D{}}, 	--llamas_llama_ethereal
+	{artid=3D292 , content=3D{}}, 	--llamas_llama_pack
+	{artid=3D124 , content=3D{}}, 	--mages_evil_mage
+	{artid=3D125 , content=3D{}}, 	--mages_evil_mage_master
+	{artid=3D126 , content=3D{}}, 	--mages_evil_mage_master
+	{artid=3D770 , content=3D{}}, 	--Meer_Mage
+	{artid=3D771 , content=3D{}}, 	--Meer_Warrior
+	{artid=3D797 , content=3D{}}, 	--mf_dragon_fire
+	{artid=3D798 , content=3D{}}, 	--mf_dragon_rust
+	{artid=3D39 , content=3D{}}, 	--mongbats_mongbat
+	{artid=3D766 , content=3D{}}, 	--NPC_Kabur
+	{artid=3D767 , content=3D{}}, 	--NPC_Blackthorn_Cohort
+	{artid=3D769 , content=3D{}}, 	--NPC_Blackthorn
+	{artid=3D772 , content=3D{}}, 	--NPC_Adranath
+	{artid=3D773 , content=3D{}}, 	--NPC_Cpt_Dasha
+	{artid=3D1 , content=3D{}}, 	--ogres_ogre
+	{artid=3D83 , content=3D{}}, 	--ogres_ogre_lord
+	{artid=3D84 , content=3D{}}, 	--ogres_ogre_lord
+	{artid=3D135 , content=3D{}}, 	--ogres_ogre_lord_arctic
+	{artid=3D136 , content=3D{}}, 	--ophidians_ophidian_archmage
+	{artid=3D137 , content=3D{}}, 	--ophidians_ophidian_knight
+	{artid=3D85 , content=3D{}}, 	--ophidians_ophidian_mage
+	{artid=3D87 , content=3D{}}, 	--ophidians_ophidian_queen
+	{artid=3D86 , content=3D{}}, 	--ophidians_ophidian_warrior
+	{artid=3D17 , content=3D{}}, 	--orcs_orc
+	{artid=3D41 , content=3D{}}, 	--orcs_orc
+	{artid=3D7 , content=3D{}}, 	--orcs_orc_captain
+	{artid=3D138 , content=3D{}}, 	--orcs_orc_lord
+	{artid=3D139 , content=3D{}}, 	--orcs_orc_lord
+	{artid=3D140 , content=3D{}}, 	--orcs_orc_shaman
+	{artid=3D181 , content=3D{}}, 	--orcs_orc_scout
+	{artid=3D182 , content=3D{}}, 	--orcs_orc_bomber
+	{artid=3D189 , content=3D{}}, 	--orcs_orc_lord
+	{artid=3D210 , content=3D{}}, 	--ostards_ostard_desert
+	{artid=3D825 , content=3D{}}, 	--ostards_ostard_desert
+	{artid=3D218 , content=3D{}}, 	--ostards_ostard_forest
+	{artid=3D826 , content=3D{}}, 	--ostards_ostard_forest
+	{artid=3D219 , content=3D{}}, 	--ostards_ostard_frenzied
+	{artid=3D827 , content=3D{}}, 	--ostards_ostard_frenzied
+	{artid=3D171 , content=3D{}}, 	--ostards_ostard_ethereal
+	{artid=3D141 , content=3D{}}, 	--paladins_paladin
+	{artid=3D775 , content=3D{}}, 	--plague_beast
+	{artid=3D290 , content=3D{}}, 	--porcines_boar
+	{artid=3D203 , content=3D{}}, 	--porcines_pig
+	{artid=3D42 , content=3D{}}, 	--rat_race_ratman
+	{artid=3D44 , content=3D{}}, 	--rat_race_ratman
+	{artid=3D45 , content=3D{}}, 	--rat_race_ratman
+	{artid=3D142 , content=3D{}}, 	--rat_race_ratman
+	{artid=3D143 , content=3D{}}, 	--rat_race_shaman
+	{artid=3D215 , content=3D{}}, 	--rodents_rat_giant
+	{artid=3D839 , content=3D{}}, 	--ridgeback_ridgeback
+	{artid=3D840 , content=3D{}}, 	--ridgeback_giant
+	{artid=3D841 , content=3D{}}, 	--ridgeback_flame
+	{artid=3D842 , content=3D{}}, 	--ridgeback_hatchling
+	{artid=3D209 , content=3D{}}, 	--ruminants_goat_billy
+	{artid=3D88 , content=3D{}}, 	--ruminants_goat_mountain
+	{artid=3D207 , content=3D{}}, 	--ruminants_sheep
+	{artid=3D223 , content=3D{}}, 	--ruminants_sheep_shorn
+	{artid=3D790 , content=3D{}}, 	--sand_vortex
+	{artid=3D48 , content=3D{}}, 	--scorpions_giant
+	{artid=3D144 , content=3D{}}, 	--sea_horse_sea_horse
+	{artid=3D150 , content=3D{}}, 	--sea_serpents_sea_serpent
+	{artid=3D145 , content=3D{}}, 	--sea_serpents_sea_serpent
+	{artid=3D21 , content=3D{}}, 	--serpents_snake_giant
+	{artid=3D89 , content=3D{}}, 	--serpents_snake_giant_ice
+	{artid=3D90 , content=3D{}}, 	--serpents_snake_giant_lava
+	{artid=3D91 , content=3D{}}, 	--serpents_snake_giant_silver
+	{artid=3D92 , content=3D{}}, 	--serpents_snake_giant_silver
+	{artid=3D93 , content=3D{}}, 	--serpents_snake_giant_silver
+	{artid=3D146 , content=3D{}}, 	--shadowlords_shadowlord
+	{artid=3D793 , content=3D{}}, 	--skeletal_mount
+	{artid=3D50 , content=3D{}}, 	--skeletons_skeleton
+	{artid=3D56 , content=3D{}}, 	--skeletons_skeleton
+	{artid=3D57 , content=3D{}}, 	--skeletons_skeleton
+	{artid=3D147 , content=3D{}}, 	--skeletons_skeleton_knight
+	{artid=3D148 , content=3D{}}, 	--skeletons_skeleton_mage
+	{artid=3D51 , content=3D{}}, 	--slimes_slime
+	{artid=3D94 , content=3D{}}, 	--slimes_slime_frost
+	{artid=3D96 , content=3D{}}, 	--slimes_slime_frost
+	{artid=3D574 , content=3D{}}, 	--spirits_blade_spirit
+	{artid=3D26 , content=3D{}}, 	--spirits_ghost
+	{artid=3D149 , content=3D{}}, 	--succubi_succubus
+	{artid=3D174 , content=3D{}}, 	--succubi_succubus
+	{artid=3D794 , content=3D{}}, 	--swamp_dragon
+	{artid=3D194 , content=3D{}}, 	--swamp_dragon_ethereal
+	{artid=3D799 , content=3D{}}, 	--swamp_dragon_armor
+	{artid=3D778 , content=3D{}}, 	--swarm
+	{artid=3D152 , content=3D{}}, 	--terathan_terathan_avenger
+	{artid=3D71 , content=3D{}}, 	--terathan_terathan_drone
+	{artid=3D72 , content=3D{}}, 	--terathan_terathan_queen
+	{artid=3D70 , content=3D{}}, 	--terathan_terathan_warrior
+	{artid=3D76 , content=3D{}}, 	--titans_titan
+	{artid=3D53 , content=3D{}}, 	--trolls_troll
+	{artid=3D54 , content=3D{}}, 	--trolls_troll
+	{artid=3D55 , content=3D{}}, 	--trolls_troll_frost
+	{artid=3D153 , content=3D{}}, 	--walking_dead_ghoul
+	{artid=3D154 , content=3D{}}, 	--walking_dead_mummy
+	{artid=3D155 , content=3D{}}, 	--walking_dead_rotting_corpse
+	{artid=3D3 , content=3D{}}, 	--walking_dead_zombie
+	{artid=3D221 , content=3D{}}, 	--walrus_walrus_male
+	=

+--## Age of Shadows Stuff								=

+
+	{artid=3D300 , content=3D{}}, 	--crystal_elemental
+	{artid=3D301 , content=3D{}}, 	--treefellow
+	{artid=3D302 , content=3D{}}, 	--skittering_hopper
+	{artid=3D303 , content=3D{}}, 	--devourer
+	{artid=3D304 , content=3D{}}, 	--flesh_golem
+	{artid=3D305 , content=3D{}}, 	--gore_fiend
+	{artid=3D306 , content=3D{}}, 	--impaler
+	{artid=3D307 , content=3D{}}, 	--gibberling
+	{artid=3D308 , content=3D{}}, 	--bonedemon
+	{artid=3D309 , content=3D{}}, 	--patchskeleton
+	{artid=3D310 , content=3D{}}, 	--wailingbanshee
+--	{artid=3D311 , content=3D{}}, 	--shadow_knight
+	{artid=3D312 , content=3D{}}, 	--abysmal_horror
+	{artid=3D313 , content=3D{}}, 	--Darknight_Creeper
+	{artid=3D314 , content=3D{}}, 	--ravager
+	{artid=3D315 , content=3D{}}, 	--flesh_renderer
+	{artid=3D316 , content=3D{}}, 	--wander
+	{artid=3D317 , content=3D{}}, 	--vampire_bat
+	{artid=3D318 , content=3D{}}, 	--demon_knight
+	{artid=3D319 , content=3D{}}, 	--mound_of_maggots
+
+	{artid=3D777 , content=3D{}}, 	--doppleganger
+	{artid=3D784 , content=3D{}}, 	--arcane_demon
+	{artid=3D785 , content=3D{}}, 	--four_armed_demon
+	{artid=3D788 , content=3D{}}, 	--sphinx
+	{artid=3D789 , content=3D{}}, 	--quagmire
+	=

+--## Samurai Empire creatures								=

+	{artid=3D240 , content=3D{}}, 	--Kappa
+	{artid=3D241 , content=3D{}}, 	--Oni
+	{artid=3D242 , content=3D{}}, 	--Bimbobushi
+	{artid=3D243 , content=3D{}}, 	--Hai_Riyo
+	{artid=3D244 , content=3D{}}, 	--Rune_Beetle
+	{artid=3D245 , content=3D{}}, 	--Yomotsu_Warrior
+	{artid=3D246 , content=3D{}}, 	--Kitsun_Tsuki
+	{artid=3D247 , content=3D{}}, 	--Fan_Dancer
+	{artid=3D248 , content=3D{}}, 	--Wild_Guar
+	{artid=3D249 , content=3D{}}, 	--Yamandon
+	{artid=3D250 , content=3D{}}, 	--Tri_Wolf
+	{artid=3D251 , content=3D{}}, 	--Vampyric_Beast
+	{artid=3D252 , content=3D{}}, 	--Lady_of_the_Snow
+	{artid=3D253 , content=3D{}}, 	--Yomotsu_Priest
+	{artid=3D254 , content=3D{}}, 	--Crane
+	{artid=3D255 , content=3D{}}, 	--Yomotsu_Elder
+	{artid=3D169 , content=3D{}}, 	--Giant_Beetle_Fire
+	{artid=3D196 , content=3D{}}, 	--Denkou_Yajuu
+	{artid=3D199 , content=3D{}}, 	--Gouzen_Ha
+	=

+--## ep1 creatures
+
+	{artid=3D264 , content=3D{}}, 	--Changling
+--	{artid=3D257 , content=3D{}}, 	--DreadHorn
+	{artid=3D266 , content=3D{}}, 	--Dryad
+	{artid=3D265 , content=3D{}}, 	--Hydra
+	{artid=3D264 , content=3D{}}, 	--Changling
+	{artid=3D258 , content=3D{}}, 	--LadyMelisande
+	{artid=3D280 , content=3D{}}, 	--MinotaurArmored
+	{artid=3D281 , content=3D{}}, 	--LeatherMinotaur
+	{artid=3D263 , content=3D{}}, 	--Minotaur
+	{artid=3D259 , content=3D{}}, 	--MonstrousInterredGrizzle
+	{artid=3D272 , content=3D{}}, 	--MonstrousInterredGrizzle		=

+	{artid=3D256 , content=3D{}}, 	--Paroxysmus
+	{artid=3D271 , content=3D{}}, 	--Satyr
+	{artid=3D262 , content=3D{}}, 	--TormentedMinotaur
+	{artid=3D267 , content=3D{}}, 	--Troglodyte
+	{artid=3D261 , content=3D{}}, 	--Shimmering_Effusion
+	{artid=3D273 , content=3D{}}, 	--Fetid_Essence
+	{artid=3D276 , content=3D{}}, 	--Raptalon
+	{artid=3D277 , content=3D{}}, 	--CuShidhe
+	 										=

+	{artid=3D278 , content=3D{}}, 	--Squirrel
+	{artid=3D279 , content=3D{}}, 	--Ferret
+	{artid=3D282 , content=3D{}}, 	--Parrot
+	{artid=3D283 , content=3D{}}, 	--Crow
+	{artid=3D284 , content=3D{}}, 	--MondainSteed01
+	{artid=3D285 , content=3D{}}, 	--ReaperForm
+	=

+--#Time Lord
+
+	{artid=3D689 , content=3D{}}, 	--shadowlords_shadowlord
+	{artid=3D704 , content=3D{}} 	--shadowlords_shadowlord
 }
 =

 -- 0:none 1:normal 2:invert 3:sample 4:sample-invert		-- bonestart
@@ -162,7 +414,6 @@
 function AnimInvertMode () return 1,0 end
 =

 function DebugMenuShowModel ()
-	local index =3D gDebugMenuModelIndex
 	if (gDebugBodyGfx) then gDebugBodyGfx:Destroy() end
 	if (gDebugRootGfx) then gDebugRootGfx:Destroy() gDebugRootGfx =3D nil end
 	if (gDebugRootGfx2) then gDebugRootGfx2:Destroy() gDebugRootGfx =3D nil e=
nd
@@ -173,10 +424,10 @@
 	=

 	-- granny =

 	if (gCurDebugMode =3D=3D kDebugMode_Granny) then
-		local mobile =3D gDebugTestMobiles[index]
+		local mobile =3D gDebugMenuModel
 		if (not mobile) then return end
 		RepairEquipIndex(mobile.content)
-		AddFadeLines(sprintf("DebugMenuShowModel model=3D%04x(=3D%d) anim=3D%d[%=
s]",mobile.artid,mobile.artid,gDebugMenuAnimIndex,GetAnimName(mobile.artid,=
gDebugMenuAnimIndex) or ""))
+		AddFadeLines(sprintf("DebugMenuShowModel model=3D%04x(=3D%d) anim=3D%d[%=
s] %s",mobile.artid,mobile.artid,gDebugMenuAnimIndex,GetAnimName(mobile.art=
id,gDebugMenuAnimIndex) or "", gDebugMenuModelName or ""))
 =

 		gDebugBodyGfx =3D CreateBodyGfx(gDebugRootGfx)
 		gDebugBodyGfx:MarkForUpdate(mobile.artid,mobile.hue,mobile.content)
@@ -343,6 +594,10 @@
 	Bind("f6", function (state) if (not gActiveEditText) then if (state > 0) =
then =

 		if (gCurDebugMode =3D=3D kDebugMode_Static) then ShowDebugMenuArtList(0,=
kDebugMode_Static) end
 		end end end)
+	Bind("f7", function (state) if (not gActiveEditText) then if (state > 0) =
then =

+		ShowDebugMenuToolbox()
+		end end end)
+		=

 --[[	=

 	Bind("t", function (state) if (not gActiveEditText) then if (state > 0) t=
hen =

 		if (gCurDebugMode =3D=3D kDebugMode_Static) then
@@ -456,3 +711,167 @@
 =

 	guimaker.MakeTableDlg(rows,10,10,true,true,gGuiDefaultStyleSet,"window")
 end
+
+--debug tools window
+--notes: works, but crashes if index is out of table range (mystiqq)
+function ShowDebugMenuToolbox()
+	--return if the dialog is already open
+	if (gDebugMenuToolboxDialog ~=3D nil) then
+		return
+	end
+
+	local vw,vh =3D GetViewportSize()
+	local x,y =3D vw / 2, vh / 2
+
+	--for updating edit boxes on the fly, "binds" control name to global vari=
able. see UpdateEditText function
+	local textControls =3D function()
+			local tmp =3D {
+				cModelArtID =3D gDebugMenuModel.artid,
+				cModelIdx =3D gDebugMenuModelIndex,
+				cModelName =3D gDebugMenuModelName
+			}
+			return tmp
+		end
+	=

+	=

+	local rows =3D {
+		{
+			{type=3D"Label",	text=3D"            "},
+			{type=3D"Label",	text=3D""},
+			{type=3D"Label",	text=3D"      "},
+			{type=3D"Label",	text=3D""},
+			{type=3D"Label",	text=3D"      "},
+			{type=3D"Label",	text=3D"   Info               "},
+		},
+		{
+			{type=3D"Label",	text=3D"Art ID"},
+			{type=3D"Button",text=3D"-",onMouseDown=3Dfunction (widget)
+					--get the edit text field
+					local tmp =3D tonumber(widget.dialog.controls["cModelArtID"].plaintex=
t) - 1
+					local modeltable =3D {}
+					modeltable["artid"], modeltable["content"] =3D ((tmp ~=3D nil) and tm=
p or 0), {}
+					--load model (globals)
+					DebugMenuLoadModel(modeltable)
+					--update edit field(s)
+					UpdateEditText(widget, textControls())
+					--show/update the model
+					DebugMenuShowModel()
+				end
+			}, =

+			{type=3D"EditText",	w=3D40,h=3D16,text=3D"",controlname=3D"cModelArtID"=
},
+			{type=3D"Button",text=3D"+",onMouseDown=3Dfunction (widget)
+					--get the edit text field
+					local tmp =3D tonumber(widget.dialog.controls["cModelArtID"].plaintex=
t) + 1
+					local modeltable =3D {}
+					modeltable["artid"], modeltable["content"] =3D ((tmp ~=3D nil) and tm=
p or 0), {}
+					--load model (globals)
+					DebugMenuLoadModel(modeltable)
+					--update edit field(s)
+					UpdateEditText(widget, textControls())
+					--show/update the model
+					DebugMenuShowModel()
+				end
+			}, =

+			{type=3D"Button",text=3D"Set",onMouseDown=3Dfunction (widget)
+					--get the edit text field
+					local tmp =3D tonumber(widget.dialog.controls["cModelArtID"].plaintex=
t)
+					local modeltable =3D {}
+					modeltable["artid"], modeltable["content"] =3D ((tmp ~=3D nil) and tm=
p or 0), {}
+					--load model (globals)
+					DebugMenuLoadModel(modeltable)
+					--update edit field(s)
+					UpdateEditText(widget, textControls())
+					--show/update the model
+					DebugMenuShowModel()
+				end
+			},
+			{type=3D"EditText",	w=3D80,h=3D16,text=3D"",controlname=3D"cModelName"},
+		},
+		{
+			{type=3D"Label",	text=3D"Table Index"},
+			{type=3D"Button",text=3D"-",onMouseDown=3Dfunction (widget)
+					--get the edit text field
+					gDebugMenuModelIndex =3D tonumber(widget.dialog.controls["cModelIdx"]=
.plaintext) - 1
+					--load model (globals)
+					DebugMenuLoadModel(gDebugMenuModelTable[gDebugMenuModelIndex])
+					--update edit field(s)
+					UpdateEditText(widget, textControls())
+					--show/update the model
+					DebugMenuShowModel()
+				end
+			}, =

+			{type=3D"EditText",	w=3D40,h=3D16,text=3D"",controlname=3D"cModelIdx"},
+			{type=3D"Button",text=3D"+",onMouseDown=3Dfunction (widget)
+					--get the edit text field
+					gDebugMenuModelIndex =3D tonumber(widget.dialog.controls["cModelIdx"]=
.plaintext) + 1
+					--load model (globals)
+					DebugMenuLoadModel(gDebugMenuModelTable[gDebugMenuModelIndex])
+					--update edit field(s)
+					UpdateEditText(widget, textControls())
+					--show/update the model
+					DebugMenuShowModel()
+				end
+			}, =

+			{type=3D"Button",text=3D"Get",onMouseDown=3Dfunction (widget)
+					--get the edit text field
+					gDebugMenuModelIndex =3D tonumber(widget.dialog.controls["cModelIdx"]=
.plaintext)
+					--load model (globals)
+					DebugMenuLoadModel(gDebugMenuModelTable[gDebugMenuModelIndex])
+					--update edit field(s)
+					UpdateEditText(widget, textControls())
+					--show/update the model
+					DebugMenuShowModel()
+				end
+			},
+		},
+		{
+			{type=3D"Label",	text=3D""},	--separator
+		},
+		{
+			{type=3D"Button",text=3D"Close",onMouseDown=3Dfunction (widget)
+					--close the window
+					widget.dialog:Destroy()
+					--set the closed dialog to null
+					gDebugMenuToolboxDialog =3D nil
+				end
+			}, =

+		},
+	}	--end rows
+	=

+	=

+	=

+	gDebugMenuToolboxDialog =3D guimaker.MakeTableDlg(rows,x,y,true,true, gGu=
iDefaultStyleSet,"window")
+	--fill the edit text boxes
+	UpdateEditText(gDebugMenuToolboxDialog.rootwidget, textControls())
+	-- center the window
+	x =3D x - (gDebugMenuToolboxDialog.rootwidget.gfx:GetWidth() / 2)
+	y =3D y - (gDebugMenuToolboxDialog.rootwidget.gfx:GetHeight() / 2)
+	gDebugMenuToolboxDialog.rootwidget.gfx:SetPos(x,y)
+	gDebugMenuToolboxDialog.rootwidget:UpdateClip()
+end
+
+--load model table (artid, content), see gDebugMenuModelTable
+function DebugMenuLoadModel (model_table)
+	local modelinfo =3D GetGrannyModelInfo(model_table.artid)
+	--check whether the id is valid & model exists
+	if (not modelinfo) then =

+		print("DebugMenuLoadModel", "Invalid model", model_table.artid) =

+		return
+	end
+	gDebugMenuModel =3D {} --prevent referencing
+	--load model info to globals
+	gDebugMenuModel =3D model_table
+	gDebugMenuModelName =3D modelinfo.modelname
+end
+
+--Update edit text fields in 'widget' using table "controlname=3Dvalue,..."
+function UpdateEditText(widget,controls)
+	if (type(controls) ~=3D "table") then return end
+	local tmp
+	for key,value in pairs(controls) do
+		tmp =3D widget.dialog.controls[key]
+		tmp:SetText(value)
+		--print("Key:", key, "Value:", value)	--debug
+	end
+end
+



From no-reply at zwischenwelt.org  Wed Jan 16 15:21:43 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 16 Jan 2008 14:21:43 -0000
Subject: [Iris-commit] [IRIS] r1775 - /trunk/lua/lib.granny.lua
Message-ID: <20080116142143.CAA171C18724@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Jan 16 15:21:42 2008
New Revision: 1775

Log:
fix for models.txt parser : juggernauth

Modified:
    trunk/lua/lib.granny.lua

Modified: trunk/lua/lib.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.lua (original)
+++ trunk/lua/lib.granny.lua Wed Jan 16 15:21:42 2008
@@ -339,7 +339,7 @@
 	for line in io.lines(filepath) do
 		line =3D TrimNewLines(line)
 		if (string.sub(line,1,1) ~=3D "#") then
-			local tokens =3D strsplit("\t",line)
+			local tokens =3D strsplit("[\t ]+",line)
 			if (table.getn(tokens) >=3D table.getn(fieldnames)) then =

 				local info =3D {}
 				--print(line)



From no-reply at zwischenwelt.org  Wed Jan 16 15:28:40 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 16 Jan 2008 14:28:40 -0000
Subject: [Iris-commit] [IRIS] r1776 - /trunk/lua/lib.debugmenu.lua
Message-ID: <20080116142846.755331C1871C@zwischenwelt.org>

Author: mystiq
Date: Wed Jan 16 15:28:40 2008
New Revision: 1776

Log:
Juggernaut(768) model is now working. Added it back to the working creature=
s table.

Modified:
    trunk/lua/lib.debugmenu.lua

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Wed Jan 16 15:28:40 2008
@@ -198,7 +198,7 @@
 	{artid=3D168 , content=3D{}}, 	--imps_shadow_fiend
 	{artid=3D764 , content=3D{}}, 	--Juka_Warrior
 	{artid=3D765 , content=3D{}}, 	--Juka_Mage
---	{artid=3D768 , content=3D{}}, 	--Juggernaut	seems that this doesnt even=
 exist?! nothing found with this id
+	{artid=3D768 , content=3D{}}, 	--Juggernaut
 	{artid=3D132 , content=3D{}}, 	--kirin_kirin
 	{artid=3D191 , content=3D{}}, 	--kirin_kirin_ethereal
 	{artid=3D998 , content=3D{}}, 	--kirin_kirin



From no-reply at zwischenwelt.org  Wed Jan 16 20:10:12 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 16 Jan 2008 19:10:12 -0000
Subject: [Iris-commit] [IRIS] r1777 - in /trunk:
 data/models/textures/tex_267.png data/models/textures/tex_35.png
 data/models/textures/tex_568.png lua/filter/filter.granny.lua
 lua/lib.debugmenu.lua lua/lib.loading.lua lua/lib.mainmenu.lua
 lua/lib.static.lua
Message-ID: <20080116191012.BFC961C18724@zwischenwelt.org>

Author: sience
Date: Wed Jan 16 20:10:12 2008
New Revision: 1777

Log:
-some textures converted from 8bit to 24bit
-u_art loader and checks outcommentd

Modified:
    trunk/data/models/textures/tex_267.png
    trunk/data/models/textures/tex_35.png
    trunk/data/models/textures/tex_568.png
    trunk/lua/filter/filter.granny.lua
    trunk/lua/lib.debugmenu.lua
    trunk/lua/lib.loading.lua
    trunk/lua/lib.mainmenu.lua
    trunk/lua/lib.static.lua

Modified: trunk/data/models/textures/tex_267.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/textures/tex_35.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/textures/tex_568.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/filter/filter.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.granny.lua (original)
+++ trunk/lua/filter/filter.granny.lua Wed Jan 16 20:10:12 2008
@@ -1,4 +1,6 @@
 -- ID Mapping (ArtID to GrannyID)
+-- TODO: add individual Scaling for Grannys
+
 gGrannyFilter =3D {}
 =

 -- FILTER: Grannys

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Wed Jan 16 20:10:12 2008
@@ -13,10 +13,9 @@
 --gDebugMenuEnableAnim =3D true
 gDebugMenuAnimIndex =3D -1 -- (-1) shows rest pos
 gDebugMenuAnimIndex =3D 0
-gDebugMenuModelIndex =3D 1
-gDebugMenuModel =3D { artid=3D400, content=3D{} }
+gDebugMenuModelIndex =3D 1	-- start with first model in gDebugMenuModelTab=
le
 gDebugMenuModelName =3D ""
-gDebugMenuModelTable =3D {}
+
 gDebugMenuMainGfxPos =3D {-0.5,0.5,-0.15}
 =

 function RepairEquipIndex (arr) =

@@ -29,13 +28,130 @@
 =

 --[[
 --player characters with equipment
-gDebugMenuModelTable =3D {
+gDebugTestMobiles =3D {
 	-- male
 	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
 	--female
 	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
+
+	{artid=3D hex2num("5") , content=3D{}},		--birds_eagle
+	{artid=3D hex2num("39") , content=3D{}},	--mongbats_mongbat
+	{artid=3D hex2num("105") , content=3D{}},	--dragons_wyrm_ancient
+
+	-- llamas_llama_pack - broken (crash) -> mapped to id: 220 (grannyfilter)
+	{artid=3D 292 , content=3D{}},
+	-- k=C3=A4fer - broken animation
+	{artid=3D hex2num("0xA9") , content=3D{}},
+	--791 broken horse
+	{artid=3D hex2num("0x317"), content=3D{}},
+
+	{artid=3D	hex2num("0xB1") , content=3D{}}, -- 177 broken
+	{artid=3D	hex2num("0x72") , content=3D{}}, -- 114 broken =

+	{artid=3D	hex2num("0x73") , content=3D{}},  -- 115 broken
+	{artid=3D	hex2num("0x75") , content=3D{}}, -- 117 broken
+
+	{artid=3D hex2num("0xD5") , content=3D{}}, =

+	{artid=3D	hex2num("0xF1") , content=3D{}}, =

+	{artid=3D	hex2num("0xF3") , content=3D{}}, =

+	{artid=3D	hex2num("0xCC") , content=3D{}}, -- 204, broken horse
+	{artid=3D	hex2num("0xC8") , content=3D{}}, -- 200 : standard horse
+	{artid=3D	hex2num("0xE2") , content=3D{}}, -- 226 broken
+	{artid=3D	hex2num("0xE4") , content=3D{}}, -- 228 broken
+	{artid=3D hex2num("0xFC"), content=3D{}},
+	{artid=3D	hex2num("0xDC") , content=3D{}}, =

+	{artid=3D	hex2num("0xD2") , content=3D{}}, =

+	{artid=3D	hex2num("0xDA") , content=3D{}}, =

+	{artid=3D	hex2num("0xDB") , content=3D{}}, =

+	{artid=3D	hex2num("0xD5") , content=3D{}}, =

+	{artid=3D	hex2num("0x90") , content=3D{}}, =

+	{artid=3D	hex2num("0x74") , content=3D{}},  -- 116 broken
+	{artid=3D	hex2num("0xB2") , content=3D{}},  -- 178 broken
+	{artid=3D	hex2num("0x84") , content=3D{}}, =

+	{artid=3D	hex2num("0xB3") , content=3D{}},  -- 179 broken
+	{artid=3D	hex2num("0xBB") , content=3D{}}, =

+	{artid=3D	hex2num("0xBC") , content=3D{}}, =

+	{artid=3D	hex2num("0x317") , content=3D{}}, -- brokenanim
+	{artid=3D	hex2num("0x31A") , content=3D{}}, -- brokenanim
+	{artid=3D	hex2num("0x31F") , content=3D{}}, -- brokenanim
+	{artid=3D	hex2num("0xBE") , content=3D{}},  -- 190 broken
+	{artid=3D hex2num("0x11C") , content=3D{}}, -- 284 anim broken, scale bro=
ken..
+	{artid=3D	hex2num("0xFB") , content=3D{}}, =

+
+	{artid=3D400,hue=3D33780, content=3D{[4]=3D{artid=3D5422,hue=3D1728,animi=
d=3D430},[26]=3D{artid=3D3701,hue=3D0,animid=3D422},[16]=3D{artid=3D8269,hu=
e=3D1147,animid=3D906},[27]=3D{artid=3D3701,hue=3D0,animid=3D422},[17]=3D{a=
rtid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,hue=3D1147,animid=
=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D{artid=3D3701,hue=
=3D0,animid=3D422},}},
+	{artid=3D400,hue=3D33780, content=3D{[26]=3D{artid=3D3701,hue=3D0,animid=
=3D422},[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},[27]=3D{artid=3D3701,=
hue=3D0,animid=3D422},[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D=
{artid=3D8252,hue=3D1147,animid=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=
=3D466},[21]=3D{artid=3D3701,hue=3D0,animid=3D422},}},
+	{artid=3D400,hue=3D33780, content=3D{[27]=3D{artid=3D3701,hue=3D0,animid=
=3D422},[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,=
hue=3D1147,animid=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D=
{artid=3D3701,hue=3D0,animid=3D422},}},
+	{artid=3D400,hue=3D33780, content=3D{[11]=3D{artid=3D8252,hue=3D1147,anim=
id=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D{artid=3D3701,h=
ue=3D0,animid=3D422},}},
+
+	{artid=3D400, content=3D{}},
+	{artid=3D400, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
+	{artid=3D401, content=3D{}},
+	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
+	{artid=3D014, content=3D{}},
+	{artid=3D778, content=3D{}},
+	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
+	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[4]=3D{artid=
=3D5137,animid=3D529},[6]=3D{artid=3D9797,animid=3D682},[7]=3D{artid=3D5140=
,animid=3D530},[19]=3D{artid=3D5136,animid=3D528},[16]=3D{artid=3D8256,anim=
id=3D800},[21]=3D{artid=3D3701,animid=3D422},[13]=3D{artid=3D5141,animid=3D=
527},[29]=3D{artid=3D3708,animid=3D0},[11]=3D{artid=3D8266,animid=3D903},}},
+	{artid=3D401, content=3D({{artid=3D3932,animid=3D631},{artid=3D7107,animi=
d=3D993},{artid=3D5137,animid=3D529},{artid=3D9797,animid=3D682},{artid=3D5=
140,animid=3D530},{artid=3D5136,animid=3D528},{artid=3D8256,animid=3D800},{=
artid=3D3701,animid=3D422},{artid=3D5141,animid=3D527},{artid=3D3708,animid=
=3D0},{artid=3D8266,animid=3D903},})},
+
+	{artid=3D400, content=3D({{artid=3D3519,animid=3D972},})},
+	{artid=3D400, content=3D({{artid=3D3519,animid=3D972},{artid=3D5901,animi=
d=3D479},{artid=3D5422,animid=3D430},{artid=3D5399,animid=3D434},{artid=3D5=
907,animid=3D404},{artid=3D3701,animid=3D422},{artid=3D8252,animid=3D701},}=
)},
+	{artid=3D987, content=3D({{artid=3D5182,animid=3D624},{artid=3D5903,animi=
d=3D480},{artid=3D5399,animid=3D434},{artid=3D5130,animid=3D565},{artid=3D5=
397,animid=3D468},{artid=3D3701,animid=3D422},{artid=3D7939,animid=3D469},}=
)},
+	{artid=3D401, content=3D({{artid=3D2594,animid=3D500},{artid=3D5899,animi=
d=3D477},{artid=3D7933,animid=3D435},{artid=3D5431,animid=3D455},{artid=3D5=
397,animid=3D468},{artid=3D5441,animid=3D490},{artid=3D8261,animid=3D710},{=
artid=3D3701,animid=3D422},})},
+	{artid=3D401, content=3D({{artid=3D2594,animid=3D500},{artid=3D5905,animi=
d=3D476},{artid=3D5399,animid=3D434},{artid=3D5431,animid=3D455},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8262,animid=3D712},}=
)},
+	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
+	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
+	{artid=3D400, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D8266,animid=3D903},{artid=3D3=
701,animid=3D422},})},
+
+	-- meshes only crash when using vertex-shader
+	{artid=3D040, content=3D{}},
+	{artid=3D	hex2num("0x76") , content=3D{}},
+	{artid=3D	hex2num("0x77") , content=3D{}}, =

+	{artid=3D	hex2num("0x78") , content=3D{}},
+	{artid=3D	hex2num("0x79") , content=3D{}}, =

+	{artid=3D	hex2num("0x3C") , content=3D{}}, =

+	{artid=3D	hex2num("0xC8") , content=3D{}}, =

+	{artid=3D hex2num("0x123") , content=3D{}},
+	{artid=3D199, content=3D{}},
+	{artid=3D225, content=3D{}}, -- timberwolf
+	{artid=3D256, content=3D{}},
+	{artid=3D	hex2num("0x319") , content=3D{}},
+	{artid=3D400,hue=3D33780, content=3D{
+		{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount},
+		[4]=3D{artid=3D5422,hue=3D1728,animid=3D430},[26]=3D{artid=3D3701,hue=3D=
0,animid=3D422},
+		[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},[27]=3D{artid=3D3701,hue=
=3D0,animid=3D422},
+		[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,hue=
=3D1147,animid=3D701},
+		[21]=3D{artid=3D3701,hue=3D0,animid=3D422},}},   =

+	{artid=3D401, content=3D({{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount=
},{artid=3D5899,animid=3D477},{artid=3D5422,animid=3D430},{artid=3D5399,ani=
mid=3D434},{artid=3D5435,animid=3D466},{artid=3D8251,animid=3D700},{artid=
=3D3701,animid=3D422},})},
+	{artid=3D400, content=3D({{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount=
},{artid=3D5899,animid=3D477},{artid=3D5422,animid=3D430},{artid=3D5399,ani=
mid=3D434},{artid=3D5435,animid=3D466},{artid=3D8251,animid=3D700},{artid=
=3D3701,animid=3D422},})},
+
+	{artid=3D2011, content=3D{{animid=3D2002}}}, -- 02:feet 11:ulegs
+	{artid=3D1466, content=3D{}}, -- flimmer, need culling? (fixed)
+	{artid=3D1700, content=3D{}}, -- hair, texcoords or normals broken ? (fix=
ed)
+	{artid=3D500, content=3D{}}, -- lantern, texcoords broken ?! (fixed)
+	{artid=3D468, content=3D{}}, -- cape, texcoords broken ? culling? (fixed)
+	{artid=3D1468, content=3D{}}, -- cape, texcoords broken ? culling? (fixed)
+	{artid=3D490, content=3D{}}, -- sash, texcoords broken ? culling? (fixed)
+	{artid=3D1490, content=3D{}},  -- sash, texcoords broken ? culling? (fixe=
d)
+
+	{artid=3D1924, content=3D{{animid=3D3012}}},
+	{artid=3D3604, content=3D{{animid=3D3012}}},
+	{artid=3D1925, content=3D{{animid=3D3012}}},
+	{artid=3D3605, content=3D{{animid=3D3012}}},
+
+	{artid=3D3006, content=3D{}}, -- female lower legs, sience was having pro=
blem with them, 2 submeshes !
+	{artid=3D2013, content=3D{}},
+	{artid=3D2009, content=3D{}},
+	{artid=3D2012, content=3D{}},
+	{artid=3D3013, content=3D{}},
+	{artid=3D3009, content=3D{}},
+	{artid=3D3012, content=3D{}},
+	{artid=3D3009, content=3D{}},
+	{artid=3D3012, content=3D{}},
+	{artid=3D3009, content=3D{}},
+	{artid=3D3012, content=3D{}},
+	{artid=3D3009, content=3D{}},
+	{artid=3D3012, content=3D{}},
 }
---]]
+]]--
 =

 --creatures
 --used regular expression to make these "^(\d+)(.*?\s){8}(.*?)[\s]{0,}$" a=
nd replace with "{artid=3D$1 , content=3D{}}, \t--$3" in PSpad
@@ -222,7 +338,7 @@
 	{artid=3D125 , content=3D{}}, 	--mages_evil_mage_master
 	{artid=3D126 , content=3D{}}, 	--mages_evil_mage_master
 	{artid=3D770 , content=3D{}}, 	--Meer_Mage
-	{artid=3D771 , content=3D{}}, 	--Meer_Warrior
+--	{artid=3D771 , content=3D{}}, 	--Meer_Warrior
 	{artid=3D797 , content=3D{}}, 	--mf_dragon_fire
 	{artid=3D798 , content=3D{}}, 	--mf_dragon_rust
 	{artid=3D39 , content=3D{}}, 	--mongbats_mongbat
@@ -414,9 +530,11 @@
 function AnimInvertMode () return 1,0 end
 =

 function DebugMenuShowModel ()
+	local index =3D gDebugMenuModelIndex
+
 	if (gDebugBodyGfx) then gDebugBodyGfx:Destroy() end
 	if (gDebugRootGfx) then gDebugRootGfx:Destroy() gDebugRootGfx =3D nil end
-	if (gDebugRootGfx2) then gDebugRootGfx2:Destroy() gDebugRootGfx =3D nil e=
nd
+	if (gDebugRootGfx2) then gDebugRootGfx2:Destroy() gDebugRootGfx2 =3D nil =
end
 	gDebugRootGfx =3D CreateRootGfx3D()
 	gDebugRootGfx2 =3D CreateRootGfx3D()
 	=

@@ -424,7 +542,7 @@
 	=

 	-- granny =

 	if (gCurDebugMode =3D=3D kDebugMode_Granny) then
-		local mobile =3D gDebugMenuModel
+		local mobile =3D gDebugMenuModelTable[index]
 		if (not mobile) then return end
 		RepairEquipIndex(mobile.content)
 		AddFadeLines(sprintf("DebugMenuShowModel model=3D%04x(=3D%d) anim=3D%d[%=
s] %s",mobile.artid,mobile.artid,gDebugMenuAnimIndex,GetAnimName(mobile.art=
id,gDebugMenuAnimIndex) or "", gDebugMenuModelName or ""))
@@ -571,10 +689,12 @@
 		gDebugMenuAnimIndex =3D gDebugMenuAnimIndex + 1  DebugMenuShowModel()
 		end end end)
 		=

-	Bind("f1", function (state) if (not gActiveEditText) then if (state > 0) =
then =

+	Bind("f1", function (state) if (not gActiveEditText) then if (state > 0) =
then
+		--TODO: close ShowDebugMenuArtList(0,kDebugMode_Static)
 		gCurDebugMode =3D gCurDebugMode + 1
-		if (gCurDebugMode >=3D kDebugMode_Online) then gCurDebugMode =3D kDebugM=
ode_Granny end
-		gDebugMenuAnimIndex =3D 0 gDebugMenuModelIndex =3D 0 DebugMenuShowModel()
+		if (gCurDebugMode > kDebugMode_Static) then gCurDebugMode =3D kDebugMode=
_Granny end
+		gDebugMenuAnimIndex =3D 0 gDebugMenuModelIndex =3D 1
+		DebugMenuShowModel()
 		end end end)
 		=

 	Bind("f2", function (state) if (not gActiveEditText) then if (state > 0) =
then =

@@ -620,6 +740,8 @@
 			f:close()
 		end
 		end end end)
+	=

+	ShowDebugMenuToolbox()
 end
 =

 function StepDebugMenu ()
@@ -637,13 +759,11 @@
 -- iMaxW,iMaxH : can be nil for unlimited size
 function MakeUOArtImageForDialog (iTileTypeID, iHue, iMaxW, iMaxH) =

 	iHue =3D iHue or 0
-	local iTranslatedTileTypeID =3D SeasonalStaticTranslation(iTileTypeID, gS=
easonSetting)
 	-- we have to add 16384 for fallbacks
-	iTranslatedTileTypeID =3D iTranslatedTileTypeID + 16384
-
-	local matname =3D GetArtMat(iTranslatedTileTypeID,iHue)
+	iTileTypeID =3D iTileTypeID + 16384
+	local matname =3D GetArtMat(iTileTypeID,iHue)
 	local isotilew =3D 44 / math.sqrt(2)
-	local w,h =3D GetArtSize(iTranslatedTileTypeID,iHue)
+	local w,h =3D GetArtSize(iTileTypeID,iHue)
 	if (not w or w =3D=3D 0) then w =3D isotilew end
 	if (not h or h =3D=3D 0) then h =3D isotilew end
 	local tw,th =3D texsize(w),texsize(h)
@@ -654,6 +774,19 @@
 	local u1,v1,u2,v2 =3D offx/tw,offy/th,(offx+w)/tw,(offy+h)/th
 	matname =3D (string.len(matname) > 0) and matname or "BaseWhiteNoLighting"
 	return {type=3D"Img2",	w=3Dw,h=3Dh,matname=3Dmatname, u1=3Du1,v1=3Dv1,u2=
=3Du2,v2=3Dv2}
+end
+
+--TODO: add check for statics
+function checkGlobals(debugmenumodelindex)
+	if (debugmenumodelindex <=3D 1) then return 1 end
+
+	-- if in grannymode, check if index is out of array
+	if (gCurDebugMode =3D=3D kDebugMode_Granny) then
+		local maxmodelindex =3D table.getn(gDebugMenuModelTable)
+		if (gDebugMenuModelIndex >=3D maxmodelindex) then return maxmodelindex e=
nd
+	end
+
+	return debugmenumodelindex
 end
 =

 function ShowDebugMenuArtList (iStart, debugmode)
@@ -716,19 +849,24 @@
 --notes: works, but crashes if index is out of table range (mystiqq)
 function ShowDebugMenuToolbox()
 	--return if the dialog is already open
-	if (gDebugMenuToolboxDialog ~=3D nil) then
-		return
-	end
-
-	local vw,vh =3D GetViewportSize()
-	local x,y =3D vw / 2, vh / 2
+	if (gDebugMenuToolboxDialog) then return end
 =

 	--for updating edit boxes on the fly, "binds" control name to global vari=
able. see UpdateEditText function
 	local textControls =3D function()
+			local debugmodelartid =3D 1
+			local debugmodelname =3D ""
+			if (gCurDebugMode =3D=3D kDebugMode_Granny) then
+				debugmodelartid =3D gDebugMenuModelTable[gDebugMenuModelIndex].artid
+				local modelinfo =3D GetGrannyModelInfo(debugmodelartid)
+				debugmodelname =3D modelinfo.modelname
+			else
+				debugmodelname =3D GetStaticTileTypeName(gDebugMenuModelIndex) or "unk=
nown"
+				debugmodelartid =3D gDebugMenuModelIndex
+			end
 			local tmp =3D {
-				cModelArtID =3D gDebugMenuModel.artid,
-				cModelIdx =3D gDebugMenuModelIndex,
-				cModelName =3D gDebugMenuModelName
+				cModelArtID =3D debugmodelartid,
+				cModelIdx	=3D gDebugMenuModelIndex,
+				cModelName	=3D debugmodelname
 			}
 			return tmp
 		end
@@ -745,55 +883,18 @@
 		},
 		{
 			{type=3D"Label",	text=3D"Art ID"},
-			{type=3D"Button",text=3D"-",onMouseDown=3Dfunction (widget)
-					--get the edit text field
-					local tmp =3D tonumber(widget.dialog.controls["cModelArtID"].plaintex=
t) - 1
-					local modeltable =3D {}
-					modeltable["artid"], modeltable["content"] =3D ((tmp ~=3D nil) and tm=
p or 0), {}
-					--load model (globals)
-					DebugMenuLoadModel(modeltable)
-					--update edit field(s)
-					UpdateEditText(widget, textControls())
-					--show/update the model
-					DebugMenuShowModel()
-				end
-			}, =

+			{type=3D"Label",	text=3D""},
 			{type=3D"EditText",	w=3D40,h=3D16,text=3D"",controlname=3D"cModelArtID"=
},
-			{type=3D"Button",text=3D"+",onMouseDown=3Dfunction (widget)
-					--get the edit text field
-					local tmp =3D tonumber(widget.dialog.controls["cModelArtID"].plaintex=
t) + 1
-					local modeltable =3D {}
-					modeltable["artid"], modeltable["content"] =3D ((tmp ~=3D nil) and tm=
p or 0), {}
-					--load model (globals)
-					DebugMenuLoadModel(modeltable)
-					--update edit field(s)
-					UpdateEditText(widget, textControls())
-					--show/update the model
-					DebugMenuShowModel()
-				end
-			}, =

-			{type=3D"Button",text=3D"Set",onMouseDown=3Dfunction (widget)
-					--get the edit text field
-					local tmp =3D tonumber(widget.dialog.controls["cModelArtID"].plaintex=
t)
-					local modeltable =3D {}
-					modeltable["artid"], modeltable["content"] =3D ((tmp ~=3D nil) and tm=
p or 0), {}
-					--load model (globals)
-					DebugMenuLoadModel(modeltable)
-					--update edit field(s)
-					UpdateEditText(widget, textControls())
-					--show/update the model
-					DebugMenuShowModel()
-				end
-			},
-			{type=3D"EditText",	w=3D80,h=3D16,text=3D"",controlname=3D"cModelName"},
+			{type=3D"Label",	text=3D""},
+			{type=3D"Label",	text=3D""},
+			{type=3D"EditText",	w=3D100,h=3D16,text=3D"",controlname=3D"cModelName"=
},
 		},
 		{
 			{type=3D"Label",	text=3D"Table Index"},
 			{type=3D"Button",text=3D"-",onMouseDown=3Dfunction (widget)
 					--get the edit text field
-					gDebugMenuModelIndex =3D tonumber(widget.dialog.controls["cModelIdx"]=
.plaintext) - 1
-					--load model (globals)
-					DebugMenuLoadModel(gDebugMenuModelTable[gDebugMenuModelIndex])
+					gDebugMenuModelIndex=3DcheckGlobals( tonumber(widget.dialog.controls[=
"cModelIdx"].plaintext) - 1 )
+
 					--update edit field(s)
 					UpdateEditText(widget, textControls())
 					--show/update the model
@@ -803,9 +904,8 @@
 			{type=3D"EditText",	w=3D40,h=3D16,text=3D"",controlname=3D"cModelIdx"},
 			{type=3D"Button",text=3D"+",onMouseDown=3Dfunction (widget)
 					--get the edit text field
-					gDebugMenuModelIndex =3D tonumber(widget.dialog.controls["cModelIdx"]=
.plaintext) + 1
-					--load model (globals)
-					DebugMenuLoadModel(gDebugMenuModelTable[gDebugMenuModelIndex])
+					gDebugMenuModelIndex=3DcheckGlobals( tonumber(widget.dialog.controls[=
"cModelIdx"].plaintext) + 1 )
+
 					--update edit field(s)
 					UpdateEditText(widget, textControls())
 					--show/update the model
@@ -814,9 +914,8 @@
 			}, =

 			{type=3D"Button",text=3D"Get",onMouseDown=3Dfunction (widget)
 					--get the edit text field
-					gDebugMenuModelIndex =3D tonumber(widget.dialog.controls["cModelIdx"]=
.plaintext)
-					--load model (globals)
-					DebugMenuLoadModel(gDebugMenuModelTable[gDebugMenuModelIndex])
+					gDebugMenuModelIndex=3DcheckGlobals( tonumber(widget.dialog.controls[=
"cModelIdx"].plaintext) )
+
 					--update edit field(s)
 					UpdateEditText(widget, textControls())
 					--show/update the model
@@ -837,31 +936,18 @@
 			}, =

 		},
 	}	--end rows
-	=

-	=

-	=

-	gDebugMenuToolboxDialog =3D guimaker.MakeTableDlg(rows,x,y,true,true, gGu=
iDefaultStyleSet,"window")
+
+--	local vw,vh =3D GetViewportSize()
+--	local x,y =3D vw / 2, vh / 2
+
+	gDebugMenuToolboxDialog =3D guimaker.MakeTableDlg(rows,10,10,true,true, g=
GuiDefaultStyleSet,"window")
 	--fill the edit text boxes
 	UpdateEditText(gDebugMenuToolboxDialog.rootwidget, textControls())
 	-- center the window
-	x =3D x - (gDebugMenuToolboxDialog.rootwidget.gfx:GetWidth() / 2)
-	y =3D y - (gDebugMenuToolboxDialog.rootwidget.gfx:GetHeight() / 2)
-	gDebugMenuToolboxDialog.rootwidget.gfx:SetPos(x,y)
+--	x =3D x - (gDebugMenuToolboxDialog.rootwidget.gfx:GetWidth() / 2)
+--	y =3D y - (gDebugMenuToolboxDialog.rootwidget.gfx:GetHeight() / 2)
+--	gDebugMenuToolboxDialog.rootwidget.gfx:SetPos(10,10)
 	gDebugMenuToolboxDialog.rootwidget:UpdateClip()
-end
-
---load model table (artid, content), see gDebugMenuModelTable
-function DebugMenuLoadModel (model_table)
-	local modelinfo =3D GetGrannyModelInfo(model_table.artid)
-	--check whether the id is valid & model exists
-	if (not modelinfo) then =

-		print("DebugMenuLoadModel", "Invalid model", model_table.artid) =

-		return
-	end
-	gDebugMenuModel =3D {} --prevent referencing
-	--load model info to globals
-	gDebugMenuModel =3D model_table
-	gDebugMenuModelName =3D modelinfo.modelname
 end
 =

 --Update edit text fields in 'widget' using table "controlname=3Dvalue,..."

Modified: trunk/lua/lib.loading.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.loading.lua (original)
+++ trunk/lua/lib.loading.lua Wed Jan 16 20:10:12 2008
@@ -6,7 +6,7 @@
 gLoadingProfileLastAction =3D false
 =

 -- loader for uo-art materials
-gManualArtMaterialLoader =3D nil
+--gManualArtMaterialLoader =3D nil
 =

 -- store global uni font infos
 gUniFontHeight =3D {}
@@ -44,8 +44,8 @@
 		LoadingProfile("init ArtMapLoader")
 		gArtMapLoader =3D CreateArtMapLoader(gArtMapLoaderType,CorrectPath( Addf=
ilepath(gArtidxFile) ),CorrectPath( Addfilepath(gArtFile) ))
 =

-		LoadingProfile("init ManualArtMaterialLoader")
-		gManualArtMaterialLoader =3D CreateManualArtMaterialLoader("uo_art_%i","=
tex_base_alpha",gArtMapLoader,true,true,false)
+--		LoadingProfile("init ManualArtMaterialLoader")
+--		gManualArtMaterialLoader =3D CreateManualArtMaterialLoader("uo_art_%i"=
,"tex_base_alpha",gArtMapLoader,true,true,false)
 	end
 		=

 	if (gGumpLoaderType) then

Modified: trunk/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.lua (original)
+++ trunk/lua/lib.mainmenu.lua Wed Jan 16 20:10:12 2008
@@ -299,7 +299,6 @@
 			-- todo : reinit ogre here ? might loose already loaded textures =3D(
 		end	=

 		end } })
---	table.insert(rows,{ {type=3D"Button",text=3D"#debug",onLeftClick=3Dfunc=
tion () StopMainMenu() StartDebugMenu() end } })
 	table.insert(rows,{ {type=3D"Button",text=3D"#exit",onLeftClick=3Dfunctio=
n () Terminate() end } })
 =

 	MainMenuSetBackground_Sky()

Modified: trunk/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.static.lua (original)
+++ trunk/lua/lib.static.lua Wed Jan 16 20:10:12 2008
@@ -111,7 +111,7 @@
 				-- load Mesh here
 				if ( OgreMeshAvailable(meshname) ) then
 					printdebug("static","Meshloader:",iTranslatedTileTypeID,iHue,meshname)
-
+--[[
 					-- create unavailable uo_art material
 					if (gArtMapLoader and gManualArtMaterialLoader) then
 						local t =3D OgreLoadedMeshTextures(meshname)
@@ -124,6 +124,7 @@
 						-- set false, if no ui_art material can be created
 						printdebug("static",sprintf("mesh cannot be loaded -> temp. disabled=
 (false) meshname=3D%s iTranslatedTileTypeID=3D%d",meshname, iTranslatedTil=
eTypeID))
 					end
+]]--
 				else
 					meshname =3D false
 					printdebug("static","mesh cannot be loaded -> temp. disabled (false) =
",meshname, iTranslatedTileTypeID)



From no-reply at zwischenwelt.org  Wed Jan 16 20:54:28 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 16 Jan 2008 19:54:28 -0000
Subject: [Iris-commit] [IRIS] r1778 - in /trunk: data/config.lua.dist
	lua/lib.3d.cam.lua
Message-ID: <20080116195428.96DF21C1871C@zwischenwelt.org>

Author: mystiq
Date: Wed Jan 16 20:54:27 2008
New Revision: 1778

Log:
Added gUseConstantCameraRotation. Set false to rotate camera in the "normal=
" way.

Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.3d.cam.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Wed Jan 16 20:54:27 2008
@@ -9,7 +9,7 @@
 =

 -- Camera Rotation - Input stuff use: "mouse1", "mouse2" or "mouse3"
 gInput_CamMouseButton =3D GetNamedKey("mouse1")
-
+gUseConstantCameraRotation=3Dtrue			--mouse camera rotation
 -- todo : invert mouse, mouse sensitivity
 =

 -- your UO-Path (if not automatically detected)

Modified: trunk/lua/lib.3d.cam.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.cam.lua (original)
+++ trunk/lua/lib.3d.cam.lua Wed Jan 16 20:54:27 2008
@@ -153,9 +153,16 @@
 		local relx =3D ((iMouseX - self.gCamMoveWithMouse_OffX) / (vw))*2.0
 		local rely =3D ((iMouseY - self.gCamMoveWithMouse_OffY) / (vh))*2.0
 		if (self.gbInvertMouseY) then rely =3D 1 - rely end
-		=

-		self.gfCamAngH =3D self.gfCamAngH - relx*self.gfMouseSensitivity*self.gf=
SensitivityMod
-		self.gfCamAngV =3D self.gfCamAngV - rely*self.gfMouseSensitivity*self.gf=
SensitivityMod
+		local mspeed
+		--constant or non-constant rotation for cam
+		if (not gUseConstantCameraRotation) then
+			self.gCamMoveWithMouse_OffX,self.gCamMoveWithMouse_OffY =3D iMouseX,iMo=
useY
+			mspeed =3D self.gfMouseSensitivity
+		else
+			mspeed =3D self.gfMouseSensitivity*self.gfSensitivityMod
+		end
+		self.gfCamAngH =3D self.gfCamAngH - relx*mspeed
+		self.gfCamAngV =3D self.gfCamAngV - rely*mspeed
 		self.gbCamRotChanged =3D true
 		if (self.gCamMode =3D=3D self.kCamMode_Ego) then =

 			gTileFreeWalk:SetViewDir(-math.sin(self.gfCamAngH),math.cos(self.gfCamA=
ngH))



From no-reply at zwischenwelt.org  Wed Jan 16 23:42:52 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 16 Jan 2008 22:42:52 -0000
Subject: [Iris-commit] [IRIS] r1779 - /trunk/lua/lib.terrain.multitex.lua
Message-ID: <20080116224252.EE27D1C18724@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Jan 16 23:42:52 2008
New Revision: 1779

Log:
fixed terrain loader centering

Modified:
    trunk/lua/lib.terrain.multitex.lua

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Wed Jan 16 23:42:52 2008
@@ -205,8 +205,8 @@
 	=

 	local chunksize =3D kMultiTexTerrainChunkSize
 	local camx,camy,camz =3D gCurrentRenderer:GetLookAheadCamPos()
-	local bx =3D -math.floor((0.5 + gCurrentRenderer.giMapOriginX*gCurrentRen=
derer.ROBMAP_CHUNK_SIZE + camx/8)/chunksize) * chunksize
-	local by =3D  math.floor((0.5 + gCurrentRenderer.giMapOriginY*gCurrentRen=
derer.ROBMAP_CHUNK_SIZE + camy/8)/chunksize) * chunksize
+	local bx =3D -math.ceil(( gCurrentRenderer.giMapOriginX*gCurrentRenderer.=
ROBMAP_CHUNK_SIZE + camx/8)/chunksize) * chunksize
+	local by =3D  math.floor((gCurrentRenderer.giMapOriginY*gCurrentRenderer.=
ROBMAP_CHUNK_SIZE + camy/8)/chunksize) * chunksize
 	=

 	if (gMultiTexTerrain_BX =3D=3D bx and gMultiTexTerrain_BY =3D=3D by) then=
 return end
 	gMultiTexTerrain_BX =3D bx



From no-reply at zwischenwelt.org  Thu Jan 17 17:04:53 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 17 Jan 2008 16:04:53 -0000
Subject: [Iris-commit] [IRIS] r1780 - in /trunk:
 data/terrain/textures/water.jpg lua/filter/filter.art.lua
 lua/lib.3d.map.lua lua/lib.static.lua
Message-ID: <20080117160454.6C2B21524004@zwischenwelt.org>

Author: hagish
Date: Thu Jan 17 17:04:52 2008
New Revision: 1780

Log:
simple textured water added

Added:
    trunk/data/terrain/textures/water.jpg   (with props)
Modified:
    trunk/lua/filter/filter.art.lua
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.static.lua

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Thu Jan 17 17:04:52 2008
@@ -38,13 +38,19 @@
 	end
 	return nil
 end
+
+-- checks if the given tiletype is a water tile
+function FilterIsWater(iTileTypeID)
+	if (((iTileTypeID  >=3D  6038) and (iTileTypeID <=3D  6066)) or
+		((iTileTypeID  >=3D 13422) and (iTileTypeID <=3D 13445)) or
+		((iTileTypeID  >=3D 13460) and (iTileTypeID <=3D 13483)) or
+		((iTileTypeID  >=3D 13496) and (iTileTypeID <=3D 13514))) then return tr=
ue
+	else return false end
+end
 =

 -- FILTER: static water and map to extra material (one for shaders and one=
 for normal mode (because we dont have coastline models))
 function FilterStaticWater(iTranslatedTileTypeID,iHue)
-	if (((iTranslatedTileTypeID  >=3D  6038) and (iTranslatedTileTypeID <=3D =
 6066)) or
-		((iTranslatedTileTypeID  >=3D 13422) and (iTranslatedTileTypeID <=3D 134=
45)) or
-		((iTranslatedTileTypeID  >=3D 13460) and (iTranslatedTileTypeID <=3D 134=
83)) or
-		((iTranslatedTileTypeID  >=3D 13496) and (iTranslatedTileTypeID <=3D 135=
14))) then
+	if ( FilterIsWater(iTranslatedTileTypeID) ) then
 		-- assosiate to one all static water to one tileid (we don't have all st=
atic water tiles as meshes)
 		iTranslatedTileTypeID=3D6040
 	end

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Thu Jan 17 17:04:52 2008
@@ -171,6 +171,14 @@
 	-- entity.id =3D i
 	entity.iTileTypeID =3D iTileTypeID
 	entity.iHue =3D iHue
+	=

+	=

+	-- calculate water level
+	if FilterIsWater(iTileTypeID) then
+		local z =3D entity.zloc
+		chunk.mWaterStaticCountList[z] =3D chunk.mWaterStaticCountList[z] or 0
+		chunk.mWaterStaticCountList[z] =3D chunk.mWaterStaticCountList[z] + 1
+	end
 	=

 	local meshname =3D (not gForceFallBackBillboards_Statics) and GetStaticMe=
shName(iTileTypeID,entity.iHue)
 --[[
@@ -270,12 +278,16 @@
 function Renderer3D:CreateMapChunk (x,y)
 	if ((x < 0) or (y < 0)) then return end	-- we might also check the heighs=
t value !?
 	=

-
 	local chunk =3D {}
 	chunk.bIsDead =3D false
 	chunk.miX =3D x
 	chunk.miY =3D y
 	chunk.pStaticGeometryLayers =3D {}
+
+	-- water stats
+	chunk.mfWaterZLoc =3D 0		-- current water level
+	chunk.mbDisplayWater =3D false	-- show water?
+	chunk.mWaterStaticCountList =3D {}	-- zloc -> count list
 	=

 	-- start fastbatch
 	if (gFastBatchStatics) then
@@ -286,6 +298,22 @@
 	local iBlockUO_X =3D x * self.ROBMAP_CHUNK_SIZE
 	local iBlockUO_Y =3D y * self.ROBMAP_CHUNK_SIZE
 	=

+	-- check ground water level =

+	-- TODO put this into terrain code?
+	if (gGroundBlockLoader) then
+		for tx =3D 0,7 do
+			for ty =3D 0,7 do
+				local tiletype,z =3D gGroundBlockLoader:GetTile(iBlockUO_X,iBlockUO_Y,=
tx,ty)
+				=

+				-- TODO this definition depends on multitex terrain
+				if tiletype and gTerrain_MultiTexTypes.water and in_array(tiletype,gTe=
rrain_MultiTexTypes.water) then
+					chunk.mWaterStaticCountList[z] =3D chunk.mWaterStaticCountList[z] or 0
+					chunk.mWaterStaticCountList[z] =3D chunk.mWaterStaticCountList[z] + 1
+				end
+			end
+		end
+	end
+
 	-- load ground
 	if (gGroundBlockLoader and (not gEnableMultiTexTerrain)) then -- probably=
 needs gTexMapLoader
 --		local meshname =3D BuildTerrainEntity_Simple(gGroundBlockLoader,iBlock=
UO_X,iBlockUO_Y,self.ROBMAP_CHUNK_SIZE,self.ROBMAP_CHUNK_SIZE,false)
@@ -379,6 +407,45 @@
 		end
 	end
 	=

+	local mostz =3D nil
+	for k,v in pairs(chunk.mWaterStaticCountList) do
+		if mostz =3D=3D nil or chunk.mWaterStaticCountList[mostz] < v then
+			mostz =3D k
+		end
+	end
+	=

+	if mostz then
+		chunk.mfWaterZLoc =3D mostz
+		chunk.mbDisplayWater =3D true	-- show water?
+		-- print("DEBUG",chunk,"mostz",mostz)
+		=

+		-- create water
+		local gfx =3D CreateRootGfx3D()
+		local vc =3D 4
+		local ic =3D 6
+		local d =3D -8 * Renderer3D.ROBMAP_CHUNK_SIZE
+		gfx:SetSimpleRenderable()
+		gfx:RenderableBegin(vc,ic,false,false,OT_TRIANGLE_LIST)
+		gfx:RenderableVertex(0,0,0, 0,0,1, 0,0)
+		gfx:RenderableVertex(d,0,0 ,0,0,1, 1,0)
+		gfx:RenderableVertex(0,-d,0 ,0,0,1, 0,1)
+		gfx:RenderableVertex(d,-d,0, 0,0,1, 1,1)
+		gfx:RenderableIndex3(0,2,1)
+		gfx:RenderableIndex3(1,2,3)
+		gfx:RenderableEnd()
+		gfx:SetMaterial(GetPlainTextureMat("water.jpg"))
+		=

+		-- TODO
+		local x,y,z =3D self:UOPosToLocal(chunk.miX * self.ROBMAP_CHUNK_SIZE * 8=
, chunk.miY * self.ROBMAP_CHUNK_SIZE * 8, chunk.mfWaterZLoc * 0.1 + 0.1)
+
+		gfx:SetPosition(x, y, z)
+		=

+		chunk.mWaterGfx =3D gfx
+	else
+		chunk.mfWaterZLoc =3D 0		-- current water level
+		chunk.mbDisplayWater =3D false	-- show water?
+	end
+	=

 	return chunk
 end
 =

@@ -467,10 +534,12 @@
 		end
 =

 		-- blend out layers above player head if inside
+		--~ if (playerIsInside) then myLayer =3D zloc_roof or playerheadpos end
 		if (playerIsInside) then =

 			myLayer =3D playerheadpos =

 			if (zloc_roof) then myLayer =3D zloc_roof - 1 end
 		end
+		--~ print("blendout",playerIsInside,playerheadpos,zloc_roof)
 	end
 =

 	-- only update if changed
@@ -526,6 +595,7 @@
 	if (not chunk.bIsDead) then
 		--print("DestroyMapChunk",x,y)
 		chunk.bIsDead =3D true
+		if (chunk.mWaterGfx) then chunk.mWaterGfx:Destroy() chunk.mWaterGfx =3D =
nil end
 		if (chunk.fastbatch) then chunk.fastbatch:Destroy() end
 		if (chunk.pStaticGeometryTerrain) then chunk.pStaticGeometryTerrain:Dest=
roy() chunk.pStaticGeometryTerrain =3D nil end
 		if (chunk.terraingfx) then chunk.terraingfx:Destroy() chunk.terraingfx =
=3D nil end

Modified: trunk/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.static.lua (original)
+++ trunk/lua/lib.static.lua Thu Jan 17 17:04:52 2008
@@ -96,6 +96,7 @@
 	-- FILTER: static water
 	iTranslatedTileTypeID,iHue =3D FilterStaticWater(iTranslatedTileTypeID, i=
Hue)
 =

+
 	local meshname =3D nil
 =

 	meshname =3D gLegacyModelCache[iTranslatedTileTypeID.."_"..iHue]



From no-reply at zwischenwelt.org  Fri Jan 18 02:39:46 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 18 Jan 2008 01:39:46 -0000
Subject: [Iris-commit] [IRIS] r1781 - in /trunk: include/builder.h
	src/builder.cpp src/data_L.cpp
Message-ID: <20080118013946.D77611524004@zwischenwelt.org>

Author: ghoulsblade
Date: Fri Jan 18 02:39:44 2008
New Revision: 1781

Log:
started lua bind to add artmap to texatlas, not finished yet

Modified:
    trunk/include/builder.h
    trunk/src/builder.cpp
    trunk/src/data_L.cpp

Modified: trunk/include/builder.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/builder.h (original)
+++ trunk/include/builder.h Fri Jan 18 02:39:44 2008
@@ -74,6 +74,7 @@
 =

 bool	WriteTexMapToFile					(cTexMapLoader& oTexMapLoader,const char* szFil=
ePath,const int iID,cHueLoader* pHueLoader,const short iHue);
 bool	WriteArtMapToFile					(cArtMapLoader& oArtMapLoader,const char* szFil=
ePath,const int iID,cHueLoader* pHueLoader,const short iHue);
+bool	WriteArtMapToImage					(Ogre::Image& pDest,cArtMapLoader& oArtMapLoad=
er,const int iID,cHueLoader* pHueLoader,const short iHue);
 =

 bool	GenerateArtImage(Ogre::Image &image, cArtMapLoader& oArtMapLoader,con=
st int iID,const bool bPixelExact,const bool bInvertY,const bool bInvertX,c=
HueLoader* pHueLoader,const short iHue);
 =


Modified: trunk/src/builder.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/builder.cpp (original)
+++ trunk/src/builder.cpp Fri Jan 18 02:39:44 2008
@@ -358,6 +358,13 @@
 	=

 	return true;
 }
+
+bool	WriteArtMapToImage					(Ogre::Image& pDest,cArtMapLoader& oArtMapLoad=
er,const int iID,cHueLoader* pHueLoader,const short iHue) {
+	// TODO =

+	// pDest.loadDynamicImage((Ogre::uchar*)dst,b->getWidth(), b->getHeight()=
,1,myformat);
+	return false;
+}
+
 =

 bool	WriteTexMapToFile	(cTexMapLoader& oTexMapLoader,const char* szFilePat=
h,const int iID,cHueLoader* pHueLoader,const short iHue) { PROFILE
 	//~ printf("WriteTexMapToFile path=3D%s id=3D%d hueloader=3D0x%x hue=3D%d=
\n",szFilePath,iID,(int)pHueLoader,iHue);

Modified: trunk/src/data_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data_L.cpp (original)
+++ trunk/src/data_L.cpp Fri Jan 18 02:39:44 2008
@@ -6,6 +6,7 @@
 #include "builder.h"
 #include "lugre_bitmask.h"
 #include "lugre_sound.h"
+#include "lugre_texatlas.h"
 #include <string>
 #include <stdlib.h>
 #include <map>
@@ -572,6 +573,7 @@
 			REGISTER_METHOD(SearchCursorHotspot);
 			REGISTER_METHOD(GetCount);
 			REGISTER_METHOD(ExportToFile);
+			REGISTER_METHOD(AddToTexAtlas);
 			#undef REGISTER_METHOD
 		}
 =

@@ -617,7 +619,7 @@
 		}
 		=

 		/// for lua : bSuccess	ExportToFile (sFilePath,iArtMapID,pHueLoader=3Dni=
l,iHue=3D0)
-		/// exports the texmap to the filepath, e.g. myfile.png, returns true on=
 successs
+		/// exports the artmap to the filepath, e.g. myfile.png, returns true on=
 successs
 		static int	ExportToFile	(lua_State *L) { PROFILE =

 			std::string	sFilePath =3D luaL_checkstring(L,2);
 			int			iArtMapID =3D luaL_checkint(L,3);
@@ -627,6 +629,30 @@
 			if (!WriteArtMapToFile(*checkudata_alive(L),sFilePath.c_str(),iArtMapID=
,pHueLoader,iHue)) return 0;
 			lua_pushboolean(L,true); =

 			return 1; =

+		}
+		=

+		/// return true and texcoords (left,right,top,bottom) on success  (false=
 means error, no space left in atlas)
+		/// bSuccess,l,r,t,b	AddToTexAtlas (pTexAtlas,iArtMapID,pHueLoader=3Dnil=
,iHue=3D0,iBorderPixels=3D4)
+		/// loads the artmap into a cTexAtlas
+		static int	AddToTexAtlas	(lua_State *L) { PROFILE =

+			cTexAtlas*	pTexAtlas		=3D cLuaBind<cTexAtlas>::checkudata_alive(L,2);
+			int			iArtMapID		=3D luaL_checkint(L,3);
+			cHueLoader* pHueLoader		=3D (lua_gettop(L) >=3D 4 && !lua_isnil(L,4)) ?=
 cLuaBind<cHueLoader>::checkudata(L,4) : 0;
+			short 		iHue			=3D (lua_gettop(L) >=3D 5 && !lua_isnil(L,5)) ? luaL_che=
ckint(L,5) : 0;
+			int			iBorderPixels	=3D (lua_gettop(L) >=3D 6 && !lua_isnil(L,6)) ? lua=
L_checkint(L,6) : 4;
+			=

+			Ogre::Image img;
+			if (!WriteArtMapToImage(img,*checkudata_alive(L),iArtMapID,pHueLoader,i=
Hue)) return 0;
+			=

+			// add image
+			Ogre::Rectangle r;
+			if (!pTexAtlas->AddImage(img,r,iBorderPixels)) return 0;
+			lua_pushboolean(L,true);
+			lua_pushnumber(L,r.left);
+			lua_pushnumber(L,r.right);
+			lua_pushnumber(L,r.top);
+			lua_pushnumber(L,r.bottom);
+			return 5; =

 		}
 		=

 		/// int gArtMapLoader:GetCount() for lua



From no-reply at zwischenwelt.org  Fri Jan 18 12:33:52 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 18 Jan 2008 11:33:52 -0000
Subject: [Iris-commit] [IRIS] r1782 - /trunk/src/builder.cpp
Message-ID: <20080118113352.E73EA1C1872B@zwischenwelt.org>

Author: ghoulsblade
Date: Fri Jan 18 12:33:51 2008
New Revision: 1782

Log:
implemented WriteArtMapToImage

Modified:
    trunk/src/builder.cpp

Modified: trunk/src/builder.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/builder.cpp (original)
+++ trunk/src/builder.cpp Fri Jan 18 12:33:51 2008
@@ -331,38 +331,32 @@
 }
 =

 bool	WriteArtMapToFile	(cArtMapLoader& oArtMapLoader,const char* szFilePat=
h,const int iID,cHueLoader* pHueLoader,const short iHue) {
-	int iTexW, iTexH;
+	Ogre::Image img;
+	if (!WriteArtMapToImage(img,oArtMapLoader,iID,pHueLoader,iHue)) return fa=
lse;
+	img.save(szFilePath);
+	return true;
+}
+
+bool	WriteArtMapToImage					(Ogre::Image& pDest,cArtMapLoader& oArtMapLoad=
er,const int iID,cHueLoader* pHueLoader,const short iHue) {
+	int iImgW, iImgH;
 	bool bPixelExact =3D false; // setting this to true would lead to image s=
ize being increased until a multiple of 2 is reached
 	bool bInvertX =3D false;
 	bool bInvertY =3D false;
 	=

-	short *pImgRaw =3D GenerateArtRaw(oArtMapLoader, iID,bPixelExact, bInvert=
Y, bInvertX, pHueLoader, iHue, iTexW, iTexH);
-
-	if(pImgRaw =3D=3D 0){
-		printf("ERROR in WriteArtMapToFile, could not create art raw id=3D%i\n",=
iID);
+	short *pImgRaw =3D GenerateArtRaw(oArtMapLoader, iID,bPixelExact, bInvert=
Y, bInvertX, pHueLoader, iHue, iImgW, iImgH);
+
+	if (pImgRaw =3D=3D 0){
+		printf("ERROR in WriteArtMapToImage, could not create art raw id=3D%i\n"=
,iID);
 		return false;
 	}
 	=

-	=

-	uint32	*pBuf32 =3D new uint32[iTexW*iTexH];
-	ColorBuffer16To32(iTexW,iTexH,(uint16*)pImgRaw,(uint32*)pBuf32);
-	Ogre::DataStreamPtr imgstream(new Ogre::MemoryDataStream(pBuf32,iTexW*iTe=
xH*sizeof(uint32)));
-	=

-	Ogre::Image image;
-	image.loadRawData(imgstream, iTexW, iTexH, Ogre::PF_A8R8G8B8 ); // long :=
 PF_A8R8G8B8 short : PF_A1R5G5B5
-	image.save(szFilePath);
-	=

-	delete [] pBuf32;
-	=

+	// convert from 16 to 32 bits
+	uint32	*pBuf32 =3D new uint32[iImgW*iImgH];
+	ColorBuffer16To32(iImgW,iImgH,(uint16*)pImgRaw,(uint32*)pBuf32);
 	delete [] pImgRaw;
 	=

-	return true;
-}
-
-bool	WriteArtMapToImage					(Ogre::Image& pDest,cArtMapLoader& oArtMapLoad=
er,const int iID,cHueLoader* pHueLoader,const short iHue) {
-	// TODO =

-	// pDest.loadDynamicImage((Ogre::uchar*)dst,b->getWidth(), b->getHeight()=
,1,myformat);
-	return false;
+	pDest.loadDynamicImage((Ogre::uchar*)pBuf32,iImgW,iImgH,1,Ogre::PF_A8R8G8=
B8,true); // autoDelete pBuf32
+	return true;
 }
 =

 =




From no-reply at zwischenwelt.org  Fri Jan 18 13:04:27 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 18 Jan 2008 12:04:27 -0000
Subject: [Iris-commit] [IRIS] r1783 - /trunk/lua/main.lua
Message-ID: <20080118120427.31E791524004@zwischenwelt.org>

Author: ghoulsblade
Date: Fri Jan 18 13:04:26 2008
New Revision: 1783

Log:
texatlas test

Modified:
    trunk/lua/main.lua

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Fri Jan 18 13:04:26 2008
@@ -312,6 +312,24 @@
 =

 	InvokeExporters()
 	=

+	if (false) then -- texture-atlas test
+		local w =3D 1024
+		local iArtMapIDList =3D {65,129,321,449,513}
+		local sFilePath =3D "mytexatlas.png"
+		local sFileNameOrPath =3D "art_fallback.png"
+		local pTexAtlas =3D CreateTexAtlas(w,w)
+		for k,id in pairs(iArtMapIDList) do
+			local iArtMapID =3D hex2num("0x00004000") + id
+			local bSuccess,l,r,t,b =3D gArtMapLoader:AddToTexAtlas(pTexAtlas,iArtMa=
pID)
+		end
+		--~ local bSuccess,l,r,t,b =3D pTexAtlas:AddImageFromFile(sFileNameOrPat=
h)
+		--~ local bSuccess,l,r,t,b =3D pTexAtlas:AddImageFromTexture(sTexName)
+		--~ local sTexName =3D	pTexAtlas:MakeTexture()
+		pTexAtlas:SaveAsFile(sFilePath)
+		pTexAtlas:Destroy()
+		os.exit(0)
+	end
+	=

 	gCurrentRenderer:PreInit()
 =

 	MainMenuFinishedPreLoading()



From no-reply at zwischenwelt.org  Fri Jan 18 18:44:03 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 18 Jan 2008 17:44:03 -0000
Subject: [Iris-commit] [IRIS] r1784 - in /trunk:
 data/models/models/to_020000/mdl_019999.mesh lua/filter/filter.art.lua
 lua/lib.3d.dynamic.lua lua/lib.3d.map.lua lua/lib.static.lua
 lua/lib.terrain.lua lua/lib.terrain.multitex.lua lua/net/net.multi.lua
Message-ID: <20080118180006.7DC091C186F5@zwischenwelt.org>

Author: sience
Date: Fri Jan 18 18:44:03 2008
New Revision: 1784

Log:
-some improvement and codeclean with water

Removed:
    trunk/data/models/models/to_020000/mdl_019999.mesh
Modified:
    trunk/lua/filter/filter.art.lua
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.static.lua
    trunk/lua/lib.terrain.lua
    trunk/lua/lib.terrain.multitex.lua
    trunk/lua/net/net.multi.lua

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Fri Jan 18 18:44:03 2008
@@ -38,23 +38,17 @@
 	end
 	return nil
 end
-
--- checks if the given tiletype is a water tile
-function FilterIsWater(iTileTypeID)
-	if (((iTileTypeID  >=3D  6038) and (iTileTypeID <=3D  6066)) or
-		((iTileTypeID  >=3D 13422) and (iTileTypeID <=3D 13445)) or
-		((iTileTypeID  >=3D 13460) and (iTileTypeID <=3D 13483)) or
-		((iTileTypeID  >=3D 13496) and (iTileTypeID <=3D 13514))) then return tr=
ue
-	else return false end
-end
 =

--- FILTER: static water and map to extra material (one for shaders and one=
 for normal mode (because we dont have coastline models))
-function FilterStaticWater(iTranslatedTileTypeID,iHue)
-	if ( FilterIsWater(iTranslatedTileTypeID) ) then
-		-- assosiate to one all static water to one tileid (we don't have all st=
atic water tiles as meshes)
-		iTranslatedTileTypeID=3D6040
+-- checks if the given tiletype is a water tile
+function FilterIsStaticWater(iTileTypeID)
+	if (((iTileTypeID  >=3D  6038) and (iTileTypeID <=3D  6066)) or
+		((iTileTypeID  >=3D 13422) and (iTileTypeID <=3D 13445)) or
+		((iTileTypeID  >=3D 13460) and (iTileTypeID <=3D 13483)) or
+		((iTileTypeID  >=3D 13496) and (iTileTypeID <=3D 13514))) then
+		return true
+	else
+		return false
 	end
-	return iTranslatedTileTypeID,iHue
 end
 =

 --armoire - left

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Fri Jan 18 18:44:03 2008
@@ -75,7 +75,7 @@
 	-- Detect Multis
 	if item.artid >=3D gMulti_ID then
 		printdebug("multi","-----------------------------")
-		printdebug("create multi", sprintf("ARTID",item.artid,vardump(item)) )
+		printdebug("multi", sprintf("Multi detected with ARTID",item.artid,vardu=
mp(item)) )
 =

 		-- Serverside Multi Check (Custom Multi)
 		if (item.lTile) then
@@ -241,7 +241,7 @@
 function Renderer3D:DestroyDynamicGfx (dynamic)
 	-- remove multi entry
 	if (dynamic.multi) then
-		printdebug("destroy multi", sprintf("ARTID",dynamic.artid,vardump(dynami=
c)) )
+		printdebug("multi", sprintf("Multi destroyed with ARTID",dynamic.artid,v=
ardump(dynamic)) )
 		Renderer3D:RebuildChunkAtUOPos(dynamic.xloc,dynamic.yloc)
 		gMultis[dynamic.multi] =3D nil =

 	end

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Fri Jan 18 18:44:03 2008
@@ -145,10 +145,43 @@
 	self.gMapChunks =3D {}
 end
 =

+--[[
 --gobal tree params
 -- TODO: put them into an array
 Renderer3D.gTreeParameters =3D nil
 Renderer3D.gTreeStemParameters =3D nil
+function drawCaduneTree(iTileTypeID)
+	-- just to test the cadunetree generation code
+	if ((iTileTypeID =3D=3D 3296) or (iTileTypeID =3D=3D 3297)) then
+		if (not self.gTreeParameters) then
+			self.gTreeParameters =3D CreateCaduneTreeParameters()
+			self.gTreeStemParameters =3D CreateCaduneTreeStem(self.gTreeParameters)
+			self.gTreeStemParameters:Grow()
+		end
+
+		if (iTileTypeID =3D=3D 3296) then
+			print("generate tree")
+			entity.gfx =3D self.gTreeStemParameters:CreateGeometry()
+
+			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
+			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
+			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
+			entity.gfx:SetScale(0.4,0.4,0.5)
+			entity.gfx:SetNormaliseNormals(true)
+		end
+		if (iTileTypeID =3D=3D 3297) then
+			print("generate leaves")
+			entity.gfx =3D self.gTreeStemParameters:CreateLeaves()
+	=

+			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
+			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
+			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
+			entity.gfx:SetScale(0.4,0.4,0.5)
+			entity.gfx:SetNormaliseNormals(true)
+		end
+	end
+end
+]]--
 =

 -- handles the entity creation for CreateMapChunk and adds it to chunk.lSt=
aticEntities
 function Renderer3D:CreateMapChunkEntity (chunk,iTileTypeID,iXLoc,iYLoc,iZ=
Loc,iHue)
@@ -172,48 +205,17 @@
 	entity.iTileTypeID =3D iTileTypeID
 	entity.iHue =3D iHue
 	=

-	=

+	local staticwatertile =3D true
 	-- calculate water level
-	if FilterIsWater(iTileTypeID) then
+	if FilterIsStaticWater(iTileTypeID) then
 		local z =3D entity.zloc
 		chunk.mWaterStaticCountList[z] =3D chunk.mWaterStaticCountList[z] or 0
 		chunk.mWaterStaticCountList[z] =3D chunk.mWaterStaticCountList[z] + 1
-	end
-	=

-	local meshname =3D (not gForceFallBackBillboards_Statics) and GetStaticMe=
shName(iTileTypeID,entity.iHue)
---[[
---------------------------------------------------------------------------=
---------------------------------------------------
-	-- just to test the cadunetree generation code
-	if ((iTileTypeID =3D=3D 3296) or (iTileTypeID =3D=3D 3297)) then
-		if (not self.gTreeParameters) then
-			self.gTreeParameters =3D CreateCaduneTreeParameters()
-			self.gTreeStemParameters =3D CreateCaduneTreeStem(self.gTreeParameters)
-			self.gTreeStemParameters:Grow()
-		end
-
-		if (iTileTypeID =3D=3D 3296) then
-			print("generate tree")
-			entity.gfx =3D self.gTreeStemParameters:CreateGeometry()
-
-			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
-			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
-			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
-			entity.gfx:SetScale(0.4,0.4,0.5)
-			entity.gfx:SetNormaliseNormals(true)
-		end
-		if (iTileTypeID =3D=3D 3297) then
-			print("generate leaves")
-			entity.gfx =3D self.gTreeStemParameters:CreateLeaves()
-	=

-			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
-			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
-			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
-			entity.gfx:SetScale(0.4,0.4,0.5)
-			entity.gfx:SetNormaliseNormals(true)
-		end
-	elseif
---------------------------------------------------------------------------=
---------------------------------------------------
-]]--
+		staticwatertile =3D not gEnableMultiTexTerrain		--on multitexturing filt=
er static water
+	end
+
+	local meshname =3D (not gForceFallBackBillboards_Statics) and staticwater=
tile and GetStaticMeshName(iTileTypeID,entity.iHue)
+
 	-- create Mesh
 	if (meshname and meshname ~=3D false) then 	--and (not MeshIsPseudoBillBo=
ard(iTileTypeID))) then	--currently disabled
 		local qw,qx,qy,qz =3D GetStaticMeshOrientation(iTileTypeID)
@@ -314,7 +316,7 @@
 		end
 	end
 =

-	-- load ground
+	-- GROUNDMAP
 	if (gGroundBlockLoader and (not gEnableMultiTexTerrain)) then -- probably=
 needs gTexMapLoader
 --		local meshname =3D BuildTerrainEntity_Simple(gGroundBlockLoader,iBlock=
UO_X,iBlockUO_Y,self.ROBMAP_CHUNK_SIZE,self.ROBMAP_CHUNK_SIZE,false)
 		local meshname =3D BuildTerrainEntity_Shaded(gGroundBlockLoader,iBlockUO=
_X,iBlockUO_Y,self.ROBMAP_CHUNK_SIZE,self.ROBMAP_CHUNK_SIZE)
@@ -341,8 +343,8 @@
 	=

 	chunk.lStaticEntities =3D {}
 	=

-	-- load statics
-	if (gStaticBlockLoader) then -- probably needs gArtMapLoader
+	-- STATICS
+	if (gStaticBlockLoader) then
 		local iTileTypeID,iX,iY,iZ,iHue
 		local iStaticCount
 		local xloc,yloc
@@ -351,25 +353,20 @@
 			for y =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
 				gStaticBlockLoader:Load(iBlockUO_X+x,iBlockUO_Y+y)
 				iStaticCount =3D gStaticBlockLoader:Count() -- operates on the block t=
hat was last loaded using :Load()
-
-				--printdebug("static","iStaticCount=3D"..iStaticCount)
-				--printdebug("static","iBlockUO_X=3D"..iBlockUO_X.." iBlockUO_Y=3D"..i=
BlockUO_Y)
-				--printdebug("static","BlockX=3D"..x.." BlockY=3D"..y)
 =

 				for i =3D 0,iStaticCount-1 do
 					iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i) -- oper=
ates on the block that was last loaded using :Load()
 					=

 					xloc =3D (iBlockUO_X+x)*8 + iX
 					yloc =3D (iBlockUO_Y+y)*8 + iY
-					=

-					--print("DEBUG","STATIC",iTileTypeID,xloc,yloc,iZ,iHue)
+
 					self:CreateMapChunkEntity(chunk,iTileTypeID,xloc,yloc,iZ,iHue)
 				end =

 		end end
 	end
 	=

-	-- add multis as statics
-	if (gMultis) then -- probably needs gArtMapLoader
+	-- MULTIS (add multis as statics)
+	if (gMultis) then
 		local iTileTypeID,iX,iY,iZ,iHue
 		local UO_X,UO_Y
 		local multi
@@ -383,7 +380,7 @@
 					UO_Y =3D y * self.ROBMAP_CHUNK_SIZE * 8
 =

 					iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
-					--print("DEBUG","TILE",iTileTypeID,iX,iY,iZ,iHue,":",UO_X,UO_Y,self.R=
OBMAP_CHUNK_SIZE*8)
+
 					if	iX >=3D UO_X and iX < UO_X+self.ROBMAP_CHUNK_SIZE*8 and =

 						iY >=3D UO_Y and iY < UO_Y+self.ROBMAP_CHUNK_SIZE*8 then
 						=

@@ -395,7 +392,7 @@
 	end
 =

 	-- TODO : fish in water ? other gimiks ?
-	=

+
 	if (gFastBatchStatics) then
 		chunk.fastbatch:SetCastShadows(gStaticsCastShadows)
 		chunk.fastbatch:FastBatch_Build()
@@ -406,46 +403,49 @@
 			layerStaticGeom:Build()
 		end
 	end
-	=

-	local mostz =3D nil
-	for k,v in pairs(chunk.mWaterStaticCountList) do
-		if mostz =3D=3D nil or chunk.mWaterStaticCountList[mostz] < v then
-			mostz =3D k
-		end
-	end
-	=

-	if mostz then
-		chunk.mfWaterZLoc =3D mostz
-		chunk.mbDisplayWater =3D true	-- show water?
-		-- print("DEBUG",chunk,"mostz",mostz)
-		=

-		-- create water
-		local gfx =3D CreateRootGfx3D()
-		local vc =3D 4
-		local ic =3D 6
-		local d =3D -8 * Renderer3D.ROBMAP_CHUNK_SIZE
-		gfx:SetSimpleRenderable()
-		gfx:RenderableBegin(vc,ic,false,false,OT_TRIANGLE_LIST)
-		gfx:RenderableVertex(0,0,0, 0,0,1, 0,0)
-		gfx:RenderableVertex(d,0,0 ,0,0,1, 1,0)
-		gfx:RenderableVertex(0,-d,0 ,0,0,1, 0,1)
-		gfx:RenderableVertex(d,-d,0, 0,0,1, 1,1)
-		gfx:RenderableIndex3(0,2,1)
-		gfx:RenderableIndex3(1,2,3)
-		gfx:RenderableEnd()
-		gfx:SetMaterial(GetPlainTextureMat("water.jpg"))
-		=

-		-- TODO
-		local x,y,z =3D self:UOPosToLocal(chunk.miX * self.ROBMAP_CHUNK_SIZE * 8=
, chunk.miY * self.ROBMAP_CHUNK_SIZE * 8, chunk.mfWaterZLoc * 0.1 + 0.1)
-
-		gfx:SetPosition(x, y, z)
-		=

-		chunk.mWaterGfx =3D gfx
-	else
-		chunk.mfWaterZLoc =3D 0		-- current water level
-		chunk.mbDisplayWater =3D false	-- show water?
-	end
-	=

+
+	-- WATER
+	if (gEnableMultiTexTerrain) then
+		local mostz =3D nil
+		for k,v in pairs(chunk.mWaterStaticCountList) do
+			if mostz =3D=3D nil or chunk.mWaterStaticCountList[mostz] < v then
+				mostz =3D k
+			end
+		end
+	=

+		if mostz then
+			chunk.mfWaterZLoc =3D mostz
+			chunk.mbDisplayWater =3D true	-- show water?
+			-- print("DEBUG",chunk,"mostz",mostz)
+			=

+			-- create water
+			local gfx =3D CreateRootGfx3D()
+			local vc =3D 4
+			local ic =3D 6
+			local d =3D -8 * Renderer3D.ROBMAP_CHUNK_SIZE
+			gfx:SetSimpleRenderable()
+			gfx:RenderableBegin(vc,ic,false,false,OT_TRIANGLE_LIST)
+			gfx:RenderableVertex(0,0,0, 0,0,1, 0,0)
+			gfx:RenderableVertex(d,0,0 ,0,0,1, 1,0)
+			gfx:RenderableVertex(0,-d,0 ,0,0,1, 0,1)
+			gfx:RenderableVertex(d,-d,0, 0,0,1, 1,1)
+			gfx:RenderableIndex3(0,2,1)
+			gfx:RenderableIndex3(1,2,3)
+			gfx:RenderableEnd()
+			gfx:SetMaterial(GetPlainTextureMat("water.jpg"))
+			=

+			-- TODO
+			local x,y,z =3D self:UOPosToLocal(chunk.miX * self.ROBMAP_CHUNK_SIZE * =
8, chunk.miY * self.ROBMAP_CHUNK_SIZE * 8, chunk.mfWaterZLoc * 0.1 + 0.1)
+	=

+			gfx:SetPosition(x, y, z)
+			=

+			chunk.mWaterGfx =3D gfx
+		else
+			chunk.mfWaterZLoc =3D 0		-- current water level
+			chunk.mbDisplayWater =3D false	-- show water?
+		end
+	end
+
 	return chunk
 end
 =


Modified: trunk/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.static.lua (original)
+++ trunk/lua/lib.static.lua Fri Jan 18 18:44:03 2008
@@ -93,9 +93,6 @@
 	local iTranslatedTileTypeID =3D SeasonalStaticTranslation(iTileTypeID, gS=
easonSetting)
 	-- FILTER: map Mesh to other Mesh
 	iTranslatedTileTypeID =3D FilterMesh(iTranslatedTileTypeID)
-	-- FILTER: static water
-	iTranslatedTileTypeID,iHue =3D FilterStaticWater(iTranslatedTileTypeID, i=
Hue)
-
 =

 	local meshname =3D nil
 =

@@ -143,9 +140,8 @@
 		-- TODO: CLONEMESH & HUEMESH both have a very huge load and should use E=
ntities for Material Hueing !!!!!!!!!!!!!
 		-- Hue this Model | TODO: Partitial Hue is currently skipped
 		if (gHueLoader and meshname) then
-			-- don't use iTranslatedTileTypeID here, because of waterhack
-			if (TestBit(GetStaticTileTypeFlags(iTileTypeID) or 0,kTileDataFlag_Part=
ial_Hue) ) then
-				printdebug("static","parthuedmodel=3D",iTileTypeID)
+			if (TestBit(GetStaticTileTypeFlags(iTranslatedTileTypeID) or 0,kTileDat=
aFlag_Partial_Hue) ) then
+				printdebug("static","parthuedmodel=3D",iTranslatedTileTypeID)
 			elseif ( (iHue>0) and (iHue<gMaxHueValue) ) then
 				local clonemeshname=3DCloneMesh(meshname)
 				HueMesh(clonemeshname,gHueLoader,iHue)

Modified: trunk/lua/lib.terrain.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.lua (original)
+++ trunk/lua/lib.terrain.lua Fri Jan 18 18:44:03 2008
@@ -15,7 +15,7 @@
 	local iTranslatedTileTypeID=3DSeasonalMapTranslation(iTileTypeID, gSeason=
Setting)
 =

 	-- FILTER: Special Filters
-	iTranslatedTileTypeID =3D FilterMap(iTranslatedTileTypeID)
+--	iTranslatedTileTypeID =3D FilterMap(iTranslatedTileTypeID)
 =

 	local matname =3D gTerrainMaterialCache[iTileTypeID]
 	if ((not matname) and gTexMapLoader) then

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Fri Jan 18 18:44:03 2008
@@ -19,7 +19,7 @@
 gTerrain_MultiTexTypes.snow			=3D {268,269,270,271,276,277,278,279,282,283=
,284,285,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,39=
3,394,901,902,903,904,905,906,907,908,913,914,915,916,925,926,927,928,929,9=
30,931,932,937,938,939,940,1471,1472,1473,1474,1475,1476,1477,1478,1479,148=
0,1481,1482,1483,1484,1485,1486,1487,1488,1489,1490,1491,1492,1493,1494,150=
3,1504,1505,1506,1861,1862,1863,1864,1873,1874,1875,1876,1877,1878,1879,188=
0,1885,1886,1887,1888,1901,1902,1903,1904,1905,1906,1907}
 gTerrain_MultiTexTypes.void			=3D {506,507,508,509,510,511}
 =

-gTerrain_MultiTexTypes.water		=3D {168,169,170,171,310,311}
+gTerrain_MultiTexTypes.water		=3D {168,169,170,171,310,311} --,100,94,91,9=
9,87,82,79,149,131}
 =

 --[[
 gTerrain_MultiTexTypes.cave			=3D {581,582,583,584,585,586,587,588,589,590=
,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,60=
9,610,611,612,613,614,615,616,617,618,619,620,621,700,701,702,703,704,705,7=
06,707,708,709,710,711,712,713,714,715,1595,1596,1597,1598}

Modified: trunk/lua/net/net.multi.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.multi.lua (original)
+++ trunk/lua/net/net.multi.lua Fri Jan 18 18:44:03 2008
@@ -257,7 +257,7 @@
 			end
 		end
 	else
-		-- skip an uncompessed CustomHouse packet
+		-- skip an other compession method CustomHouse packets
 		input:PopRaw(bufferlen-1)
 	end
 =




From no-reply at zwischenwelt.org  Fri Jan 18 19:21:40 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 18 Jan 2008 18:21:40 -0000
Subject: [Iris-commit] [IRIS] r1785 - in /trunk: lua/main.lua src/data_L.cpp
Message-ID: <20080118182140.7707B1C1872C@zwischenwelt.org>

Author: ghoulsblade
Date: Fri Jan 18 19:21:37 2008
New Revision: 1785

Log:
adjusted artmaploader binding to image binding (for texatlas) and updated t=
estcode in main.lua

Modified:
    trunk/lua/main.lua
    trunk/src/data_L.cpp

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Fri Jan 18 19:21:37 2008
@@ -318,15 +318,18 @@
 		local sFilePath =3D "mytexatlas.png"
 		local sFileNameOrPath =3D "art_fallback.png"
 		local pTexAtlas =3D CreateTexAtlas(w,w)
+		local img =3D CreateImage()
 		for k,id in pairs(iArtMapIDList) do
 			local iArtMapID =3D hex2num("0x00004000") + id
-			local bSuccess,l,r,t,b =3D gArtMapLoader:AddToTexAtlas(pTexAtlas,iArtMa=
pID)
-		end
-		--~ local bSuccess,l,r,t,b =3D pTexAtlas:AddImageFromFile(sFileNameOrPat=
h)
-		--~ local bSuccess,l,r,t,b =3D pTexAtlas:AddImageFromTexture(sTexName)
+			if (gArtMapLoader:ExportToImage(img,iArtMapID)) then
+				local bSuccess,l,r,t,b =3D pTexAtlas:AddImage(img)
+			end
+		end
 		--~ local sTexName =3D	pTexAtlas:MakeTexture()
-		pTexAtlas:SaveAsFile(sFilePath)
+		pTexAtlas:MakeImage(img)
+		img:SaveAsFile(sFilePath)
 		pTexAtlas:Destroy()
+		img:Destroy()
 		os.exit(0)
 	end
 	=


Modified: trunk/src/data_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data_L.cpp (original)
+++ trunk/src/data_L.cpp Fri Jan 18 19:21:37 2008
@@ -6,7 +6,7 @@
 #include "builder.h"
 #include "lugre_bitmask.h"
 #include "lugre_sound.h"
-#include "lugre_texatlas.h"
+#include "lugre_image.h"
 #include <string>
 #include <stdlib.h>
 #include <map>
@@ -573,7 +573,7 @@
 			REGISTER_METHOD(SearchCursorHotspot);
 			REGISTER_METHOD(GetCount);
 			REGISTER_METHOD(ExportToFile);
-			REGISTER_METHOD(AddToTexAtlas);
+			REGISTER_METHOD(ExportToImage);
 			#undef REGISTER_METHOD
 		}
 =

@@ -631,28 +631,18 @@
 			return 1; =

 		}
 		=

-		/// return true and texcoords (left,right,top,bottom) on success  (false=
 means error, no space left in atlas)
-		/// bSuccess,l,r,t,b	AddToTexAtlas (pTexAtlas,iArtMapID,pHueLoader=3Dnil=
,iHue=3D0,iBorderPixels=3D4)
-		/// loads the artmap into a cTexAtlas
-		static int	AddToTexAtlas	(lua_State *L) { PROFILE =

-			cTexAtlas*	pTexAtlas		=3D cLuaBind<cTexAtlas>::checkudata_alive(L,2);
+		/// return true on success
+		/// loads the artmap into a Ogre::Image (lua wrapper : cImage)
+		/// bSuccess	ExportToImage	(pImage,iArtMapID,pHueLoader=3Dnil,iHue=3D0)
+		static int		ExportToImage	(lua_State *L) { PROFILE =

+			cImage*		pImage			=3D cLuaBind<cImage>::checkudata_alive(L,2);
 			int			iArtMapID		=3D luaL_checkint(L,3);
 			cHueLoader* pHueLoader		=3D (lua_gettop(L) >=3D 4 && !lua_isnil(L,4)) ?=
 cLuaBind<cHueLoader>::checkudata(L,4) : 0;
 			short 		iHue			=3D (lua_gettop(L) >=3D 5 && !lua_isnil(L,5)) ? luaL_che=
ckint(L,5) : 0;
-			int			iBorderPixels	=3D (lua_gettop(L) >=3D 6 && !lua_isnil(L,6)) ? lua=
L_checkint(L,6) : 4;
-			=

-			Ogre::Image img;
-			if (!WriteArtMapToImage(img,*checkudata_alive(L),iArtMapID,pHueLoader,i=
Hue)) return 0;
-			=

-			// add image
-			Ogre::Rectangle r;
-			if (!pTexAtlas->AddImage(img,r,iBorderPixels)) return 0;
+			=

+			if (!WriteArtMapToImage(pImage->mImage,*checkudata_alive(L),iArtMapID,p=
HueLoader,iHue)) return 0;
 			lua_pushboolean(L,true);
-			lua_pushnumber(L,r.left);
-			lua_pushnumber(L,r.right);
-			lua_pushnumber(L,r.top);
-			lua_pushnumber(L,r.bottom);
-			return 5; =

+			return 1; =

 		}
 		=

 		/// int gArtMapLoader:GetCount() for lua



From no-reply at zwischenwelt.org  Sat Jan 19 15:34:32 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 14:34:32 -0000
Subject: [Iris-commit] [IRIS] r1786 - in /trunk: data/tmp/
 lua/lib.compass.lua lua/lib.loading.lua lua/main.lua
Message-ID: <20080119143435.33E2E1C186F7@zwischenwelt.org>

Author: hagish
Date: Sat Jan 19 15:34:32 2008
New Revision: 1786

Log:
md5 check for compass texture, every map has its own compass

Added:
    trunk/data/tmp/
Modified:
    trunk/lua/lib.compass.lua
    trunk/lua/lib.loading.lua
    trunk/lua/main.lua

Modified: trunk/lua/lib.compass.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.compass.lua (original)
+++ trunk/lua/lib.compass.lua Sat Jan 19 15:34:32 2008
@@ -90,12 +90,42 @@
 =

 =

 =

-
+--[[
+	local name				=3D gMaps[index].name
+	local mapheight			=3D gMaps[index].mapheight
+	local mapfilename		=3D gMaps[index].mapfilename
+	local staidxfilename	=3D gMaps[index].staidxfilename
+	local staticfilename	=3D gMaps[index].staticfilename
+]]--
 function SetCompassMapIndex	(iMapIndex) =

 	if (gDisableCompass) then return end
 	InitCompassIfNeeded()
 	if (not gIrisCompassDialog) then return end
-	gIrisCompassDialog.compass.gfx:SetMaterial("tempmap_"..iMapIndex.."_small=
")
+
+	-- generate map file md5s
+	local md5 =3D MD5FromFileList({
+			CorrectPath( Addfilepath(gMaps[iMapIndex].mapfilename) ),
+			CorrectPath( Addfilepath(gMaps[iMapIndex].staidxfilename) ),
+			CorrectPath( Addfilepath(gMaps[iMapIndex].staticfilename) ),
+		})
+	=

+	=

+	gMapImagePath_Small	=3D datapath.."tmp/compass_"..md5.."_small_s.tga"
+
+	local mapfile_exists =3D file_exists(gMapImagePath_Small)
+	if (mapfile_exists) then
+		print(gMapImagePath_Small.." exists")
+	elseif (gGroundBlockLoader and gStaticBlockLoader and gRadarColorLoaderTy=
pe) then
+		if (not gRadarColorLoader) then
+			gRadarColorLoader =3D CreateRadarColorLoader(gRadarColorLoaderType,Corr=
ectPath( Addfilepath(gRadarcolFile) ))
+		end
+
+		gGroundBlockLoader:WriteMapImageToFile(gRadarColorLoader,gStaticBlockLoa=
der,gMapImagePath_Small,false)
+	end
+	=

+	local mat =3D CloneMaterial("tempmapbase")
+	SetTexture(mat,gMapImagePath_Small)
+	gIrisCompassDialog.compass.gfx:SetMaterial(mat)
 	=

 	-- init zoom
 	gCompassMapW =3D gGroundBlockLoader and gGroundBlockLoader:GetMapW() or 1

Modified: trunk/lua/lib.loading.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.loading.lua (original)
+++ trunk/lua/lib.loading.lua Sat Jan 19 15:34:32 2008
@@ -273,20 +273,6 @@
 		end
 	end
 =

-	gMapImagePath_Small	=3D datapath.."base/tempmap_"..index.."_small_s.tga"
-	local mapfile_exists =3D file_exists(gMapImagePath_Small)
-	if (mapfile_exists) then
-		print(gMapImagePath_Small.." exists")
-	elseif (gGroundBlockLoader and gStaticBlockLoader and gRadarColorLoaderTy=
pe) then
-		if (not gInitialMapLoaded) then LoadingProfile("init RadarColorLoader") =
end
-		if (not gRadarColorLoader) then
-			gRadarColorLoader =3D CreateRadarColorLoader(gRadarColorLoaderType,Corr=
ectPath( Addfilepath(gRadarcolFile) ))
-		end
-
-		if (not gInitialMapLoaded) then LoadingProfile("generating "..gMapImageP=
ath_Small) end
-		gGroundBlockLoader:WriteMapImageToFile(gRadarColorLoader,gStaticBlockLoa=
der,gMapImagePath_Small,false)
-	end
-	=

 	-- update renderer
 	gCurrentRenderer:SetMapEnvironment()
 	SetCompassMapIndex(index)

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Jan 19 15:34:32 2008
@@ -158,6 +158,7 @@
 	--~ OgreAddResLoc(gMainWorkingDir.."/."						,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."."							,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."base"						,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."tmp"							,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."base/ui"						,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."base/font"					,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."skybox/materials"			,"FileSystem","General")



From no-reply at zwischenwelt.org  Sat Jan 19 16:51:27 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 15:51:27 -0000
Subject: [Iris-commit] [IRIS] r1788 - /trunk/data/models/textures/shrink.sh
Message-ID: <20080119160003.2AF831C1872A@zwischenwelt.org>

Author: sience
Date: Sat Jan 19 16:51:26 2008
New Revision: 1788

Log:
-obsolete

Removed:
    trunk/data/models/textures/shrink.sh



From no-reply at zwischenwelt.org  Sat Jan 19 16:34:47 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 15:34:47 -0000
Subject: [Iris-commit] [IRIS] r1787 - in /trunk: bin/iris2.exe
 lua/filter/filter.granny.lua vs8/iris.vcproj
Message-ID: <20080119160003.209D01C18733@zwischenwelt.org>

Author: sience
Date: Sat Jan 19 16:34:47 2008
New Revision: 1787

Log:
-a bog thing is filtered now (too big)
-new win32 binary
-updated project setting

Modified:
    trunk/bin/iris2.exe
    trunk/lua/filter/filter.granny.lua
    trunk/vs8/iris.vcproj

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/filter/filter.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.granny.lua (original)
+++ trunk/lua/filter/filter.granny.lua Sat Jan 19 16:34:47 2008
@@ -29,6 +29,7 @@
 gGrannyFilter[778]	=3D{grannyid=3D16}
 gGrannyFilter[292]	=3D{grannyid=3D220}
 gGrannyFilter[970]	=3D{grannyid=3D402}
+gGrannyFilter[780]	=3D{grannyid=3D779}	-- a bog thing (too big scale)
 --gGrannyFilter[220]	=3D{meshname=3D"Lich.mesh"}
 --gGrannyFilter[5]	=3D{grannyid=3D220}				--birds_eagle
 --gGrannyFilter[39]	=3D{grannyid=3D220}				--mongbats_mongbat

Modified: trunk/vs8/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.vcproj (original)
+++ trunk/vs8/iris.vcproj Sat Jan 19 16:34:47 2008
@@ -125,8 +125,8 @@
 				OmitFramePointers=3D"true"
 				EnableFiberSafeOptimizations=3D"false"
 				WholeProgramOptimization=3D"true"
-				AdditionalIncludeDirectories=3D"&quot;$(INCLUDE)&quot;;&quot;$(OGRE_HO=
ME)\include\&quot;;&quot;$(OGRE_HOME)\include\OIS\&quot;;..\include\;..\inc=
lude\zlib;..\include\fmodx;&quot;..\lugre\lib\lua-5.0.3\include\&quot;;..\l=
ugre\lib\cadune_tree\include;..\lugre\include;&quot;c:\Programme\Microsoft =
Platform SDK\Include\&quot;"
-				PreprocessorDefinitions=3D"WIN32;USE_FMOD;USE_LUGRE_LIB_CADUNE_TREE;MA=
IN_WORKING_DIR=3D\&quot;../\&quot;"
+				AdditionalIncludeDirectories=3D"&quot;$(INCLUDE)&quot;;&quot;$(OGRE_HO=
ME)\include\&quot;;&quot;$(OGRE_HOME)\include\OIS\&quot;;..\include\;..\inc=
lude\zlib;..\include\fmodx;&quot;..\lugre\lib\lua-5.0.3\include\&quot;;..\l=
ugre\lib\cadune_tree\include;..\lugre\include;..\lugre\lib\md5\include;&quo=
t;c:\Programme\Microsoft Platform SDK\Include\&quot;"
+				PreprocessorDefinitions=3D"WIN32;USE_FMOD;USE_LUGRE_LIB_CADUNE_TREE;MA=
IN_WORKING_DIR=3D\&quot;../\&quot;;USE_LUGRE_LIB_MD5"
 				GeneratePreprocessedFile=3D"0"
 				RuntimeLibrary=3D"0"
 				EnableEnhancedInstructionSet=3D"1"
@@ -407,6 +407,10 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\include\lugre_image.h"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\include\lugre_input.h"
 					>
 				</File>
@@ -427,6 +431,10 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\include\lugre_md5.h"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\include\lugre_meshbuffer.h"
 					>
 				</File>
@@ -496,6 +504,10 @@
 				</File>
 				<File
 					RelativePath=3D"..\lugre\include\lugre_sound.h"
+					>
+				</File>
+				<File
+					RelativePath=3D"..\lugre\include\lugre_texatlas.h"
 					>
 				</File>
 				<File
@@ -595,6 +607,10 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\src\lugre_image_L.cpp"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\src\lugre_input.cpp"
 					>
 				</File>
@@ -615,6 +631,10 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\src\lugre_md5_L.cpp"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\src\lugre_meshbuffer.cpp"
 					>
 				</File>
@@ -704,6 +724,14 @@
 				</File>
 				<File
 					RelativePath=3D"..\lugre\src\lugre_sound_L.cpp"
+					>
+				</File>
+				<File
+					RelativePath=3D"..\lugre\src\lugre_texatlas.cpp"
+					>
+				</File>
+				<File
+					RelativePath=3D"..\lugre\src\lugre_texatlas_L.cpp"
 					>
 				</File>
 				<File
@@ -876,6 +904,18 @@
 				</File>
 			</Filter>
 		</Filter>
+		<Filter
+			Name=3D"md5"
+			>
+			<File
+				RelativePath=3D"..\lugre\lib\md5\src\md5.c"
+				>
+			</File>
+			<File
+				RelativePath=3D"..\lugre\lib\md5\include\md5.h"
+				>
+			</File>
+		</Filter>
 	</Files>
 	<Globals>
 	</Globals>



From no-reply at zwischenwelt.org  Sat Jan 19 18:48:38 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 17:48:38 -0000
Subject: [Iris-commit] [IRIS] r1789 - in /trunk: data/models/atlas/
	data/models/models/ lua/
Message-ID: <20080119174843.342CE1C186F7@zwischenwelt.org>

Author: hagish
Date: Sat Jan 19 18:48:37 2008
New Revision: 1789

Log:
improved texture atlas

Added:
    trunk/data/models/atlas/
    trunk/data/models/atlas/tex_atlas_2048_128.lua
    trunk/data/models/atlas/tex_atlas_2048_128.material
    trunk/data/models/atlas/tex_atlas_2048_1280.png   (with props)
    trunk/data/models/atlas/tex_atlas_4096_4096.lua
    trunk/data/models/atlas/tex_atlas_4096_4096.material
    trunk/data/models/atlas/tex_atlas_4096_40960.png   (with props)
    trunk/data/models/atlas/tex_atlas_512_32.lua
    trunk/data/models/atlas/tex_atlas_512_32.material
    trunk/data/models/atlas/tex_atlas_512_320.png   (with props)
    trunk/data/models/atlas/tex_atlas_512_321.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_2048_128.lua
    trunk/data/models/atlas/tex_atlas_alpha_2048_128.material
    trunk/data/models/atlas/tex_atlas_alpha_2048_1280.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_4096_4096.lua
    trunk/data/models/atlas/tex_atlas_alpha_4096_4096.material
    trunk/data/models/atlas/tex_atlas_alpha_4096_40960.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_512_32.lua
    trunk/data/models/atlas/tex_atlas_alpha_512_32.material
    trunk/data/models/atlas/tex_atlas_alpha_512_320.png   (with props)
    trunk/data/models/models/texture_list.php
Removed:
    trunk/data/models/models/alpha_tex_atlas.material
    trunk/data/models/models/alpha_tex_atlas_0.png
    trunk/data/models/models/alpha_tex_atlas_0_512.png
    trunk/data/models/models/alpha_tex_atlas_map.lua
    trunk/data/models/models/tex_atlas.material
    trunk/data/models/models/tex_atlas_0.png
    trunk/data/models/models/tex_atlas_0_512.png
    trunk/data/models/models/tex_atlas_map.lua
Modified:
    trunk/data/models/models/generate_all.sh
    trunk/data/models/models/generate_tex_atlas.php
    trunk/lua/main.lua

Modified: trunk/data/models/models/generate_all.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_all.sh (original)
+++ trunk/data/models/models/generate_all.sh Sat Jan 19 18:48:37 2008
@@ -1,14 +1,26 @@
 #!/bin/bash
 =

+rm -f ../atlas/tex_atlas_*
+
+php texture_list.php > xml.txt
+
+# ###################################################
+ATLASSIZE=3D512
+TEXSIZE=3D32
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_${ATLASSI=
ZE}_${TEXSIZE} tex_base
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_${A=
TLASSIZE}_${TEXSIZE} tex_base_alpha alpha
+# ###################################################
 ATLASSIZE=3D2048
 TEXSIZE=3D128
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_${ATLASSI=
ZE}_${TEXSIZE} tex_base
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_${A=
TLASSIZE}_${TEXSIZE} tex_base_alpha alpha
+# ###################################################
+ATLASSIZE=3D4096
+TEXSIZE=3D4096
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_${ATLASSI=
ZE}_${TEXSIZE} tex_base
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_${A=
TLASSIZE}_${TEXSIZE} tex_base_alpha alpha
+# ###################################################
 =

-rm -f tex_atlas*
-rm -f alpha_tex_atlas*
-find -name \*.mesh -exec ./toxml.sh {} \;
-find -name \*.mesh.xml | sort > xml.txt
-php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE
-php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE alpha
-#find -name \*.mesh -exec ./tomesh.sh {} \;
-find -name \*.xml -exec rm {} \;
+mv tex_atlas_* ../atlas
+
 rm xml.txt

Modified: trunk/data/models/models/generate_tex_atlas.php
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_tex_atlas.php (original)
+++ trunk/data/models/models/generate_tex_atlas.php Sat Jan 19 18:48:37 2008
@@ -96,6 +96,24 @@
 		$w =3D imagesx($im);
 		$h =3D imagesy($im);
 		=

+		// edge bleed fix
+		if($b > 0){
+			// top line
+			imagecopyresized($im, $src, $px+$b, $py+$b-$b, 0, 0, $tw, $b, $ow, 1);
+			// bottom line
+			imagecopyresized($im, $src, $px+$b, $py+$b+$th, 0, $oh-1, $tw, $b, $ow,=
 1);
+			// left line
+			imagecopyresized($im, $src, $px+$b-$b, $py+$b, 0, 0, $b, $th, 1, $oh);
+			// right line
+			imagecopyresized($im, $src, $px+$b+$tw, $py+$b, $ow-1, 0, $b, $th, 1, $=
oh);
+
+			// edges
+			imagecopyresized($im, $src, $px+0, $py+0, 				0, 0, 			$b, $b, 1, 1);
+			imagecopyresized($im, $src, $px+$tw+$b, $py+0, 			$ow-1, 0, 		$b, $b, 1=
, 1);
+			imagecopyresized($im, $src, $px+0, $py+$th+$b, 			0, $oh-1, 		$b, $b, 1=
, 1);
+			imagecopyresized($im, $src, $px+$tw+$b, $py+$th+$b, 	$ow-1, $oh-1, 	$b,=
 $b, 1, 1);
+		}
+		=

 		imagecopyresampled($im, $src, $px+$b, $py+$b, 0,0, $tw, $th, $ow, $oh);
 		//imagecopy($im, $src, $px+$b, $py+$b, 0, 0, $tw, $th);
 		=

@@ -192,13 +210,19 @@
 $filelist =3D $argv[1];
 $atlassize =3D $argv[2];
 $texsize =3D $argv[3];
-$doalpha =3D $argv[4];
-
-if(empty($filelist) || empty($atlassize) || empty($texsize) || !is_numeric=
($atlassize) || !is_numeric($texsize)){
-	echo "1. parameter need to be a filelist like xml.txt\n";
+$atlasbasename =3D $argv[4];
+$atlasbasematerial =3D $argv[5];
+$doalpha =3D $argv[6];
+
+if(empty($filelist) || empty($atlasbasename) || empty($atlasbasematerial) =
|| empty($texsize) || =

+	empty($atlassize) || !is_numeric($atlassize) || !is_numeric($texsize)){
+	=

+	echo "1. parameter need to be a filelist like xml.txt containing MATERIAL=
NAME TEXTUREFILE each line\n";
 	echo "2. parameter need to be texture atlas size in pixel, like 1024 for =
1024x1024\n";
 	echo "3. parameter need to be texture part max size in pixel, like 128 fo=
r 128x128>\n";
-	echo "4. parameter can be alpha if you want alpha mode\n";
+	echo "4. parameter need to be the atlasname\n";
+	echo "5. parameter need to be the base material name\n";
+	echo "6. parameter can be alpha if you want alpha mode\n";
 	exit(1);
 }
 =

@@ -213,6 +237,8 @@
 echo "alpha: ".($doalpha?"true":"false")."\n";
 echo "atlas size: $atlassize x $atlassize\n";
 echo "tex max size: $texsize x $texsize\n";
+echo "atlasbasename: $atlasbasename\n";
+echo "atlasbasematerial: $atlasbasematerial\n";
 =

 // oki lets rock
 =

@@ -227,63 +253,54 @@
 foreach($argv as $f){
 	$f =3D trim($f);
 	=

-	$l =3D file($f);
-	$s =3D implode("",$l);
-
-	$materials =3D GetMaterials($l);
-	=

-	foreach($materials as $mat){
-		if(strpos($mat,"uo_art_") !=3D=3D false)continue;
-		if(strpos($mat,"tex_atlas_") !=3D=3D false)continue;
-	=

-		/*list($minu,$minv,$maxu,$maxv) =3D GetUVBorders($l,$mat);
-		=

-		$minu =3D max(0,$minu);
-		$minv =3D max(0,$minv);
-		$maxu =3D min(1,$maxu);
-		$maxv =3D min(1,$maxv);
-
-		echo "file=3D$f\tmaterial: $mat\tuv: $minu,$minv,$maxu,$maxv\n";
-		if($minu >=3D 0 && $maxu <=3D 1 && $minv >=3D 0 && $maxv <=3D 1){
-		*/
-		echo "file=3D$f\tmaterial: $mat\n";
-		=

-			if(!array_key_exists($mat,$lTex)){
-				$file =3D "../textures/$mat.png";
-				// original file size
-				list($ox,$oy) =3D GetMaterialSize($file);
-				// shrinked file size
-				list($x,$y) =3D ShrinkToMax($ox,$oy);
-				if(empty($x) || empty($y))continue;
-				=

-				if($doalpha){
-					if(!ImageHasAlpha($file))continue;
-				} else {
-					if(ImageHasAlpha($file))continue;
-				}
-				=

-				$lTex[$mat] =3D array("count"=3D>1,"file"=3D>"$file","mat"=3D>"$mat","=
x"=3D>$x,"y"=3D>$y,"ox"=3D>$ox,"oy"=3D>$oy,"meshs"=3D>array($f));
+	list($mat,$image) =3D preg_split("/[\s,]+/",$f,2);
+	=

+	echo "mat=3D$mat image=3D$image\n";
+	=

+	/*list($minu,$minv,$maxu,$maxv) =3D GetUVBorders($l,$mat);
+	=

+	$minu =3D max(0,$minu);
+	$minv =3D max(0,$minv);
+	$maxu =3D min(1,$maxu);
+	$maxv =3D min(1,$maxv);
+
+	echo "file=3D$f\tmaterial: $mat\tuv: $minu,$minv,$maxu,$maxv\n";
+	if($minu >=3D 0 && $maxu <=3D 1 && $minv >=3D 0 && $maxv <=3D 1){
+	*/
+	echo "file=3D$f\tmaterial: $mat\n";
+	=

+		if(!array_key_exists($mat,$lTex)){
+			$file =3D $image;
+			// original file size
+			list($ox,$oy) =3D GetMaterialSize($file);
+			// shrinked file size
+			list($x,$y) =3D ShrinkToMax($ox,$oy);
+			if(empty($x) || empty($y))continue;
+			=

+			if($doalpha){
+				if(!ImageHasAlpha($file))continue;
 			} else {
-				$lTex[$mat]["count"]++;
-				if(!in_array($f,$lTex[$mat]["meshs"]))$lTex[$mat]["meshs"][] =3D $f;
+				if(ImageHasAlpha($file))continue;
 			}
 			=

-			$m =3D $lTex[$mat];
-			$x =3D $m["x"];
-			$y =3D $m["y"];
-			$count =3D $m["count"];
-			$file =3D $m["file"];
-			=

-			echo "\tREMAPABLE -> $mat $x x $y px $count times\n";
-			=

-			$ar =3D $y;
-			if(empty($lSize[$ar])){
-				$lSize[$ar] =3D array($mat);
-			} else if(!in_array($mat,$lSize[$ar])) {
-				$lSize[$ar][] =3D $mat;
-			}
-		//}
-	}
+			$lTex[$mat] =3D array("file"=3D>"$file","mat"=3D>"$mat","x"=3D>$x,"y"=
=3D>$y,"ox"=3D>$ox,"oy"=3D>$oy);
+		}
+		=

+		$m =3D $lTex[$mat];
+		$x =3D $m["x"];
+		$y =3D $m["y"];
+		$count =3D $m["count"];
+		$file =3D $m["file"];
+		=

+		echo "\tREMAPABLE -> $mat $x x $y px $count times\n";
+		=

+		$ar =3D $y;
+		if(empty($lSize[$ar])){
+			$lSize[$ar] =3D array($mat);
+		} else if(!in_array($mat,$lSize[$ar])) {
+			$lSize[$ar][] =3D $mat;
+		}
+	//}
 =

 }
 =

@@ -293,18 +310,14 @@
 =

 $number =3D 0;
 =

-if($doalpha){
-	$atlasname =3D "alpha_tex_atlas_$number";
-} else {
-	$atlasname =3D "tex_atlas_$number";
-}
+$atlasname =3D $atlasbasename.$number;
 =

 $im =3D CreateBlankImage($w, $h);
 =

 // current position
 $px =3D 0;
 $py =3D 0;
-$ph =3D 0;
+$ph =3D -2*$b;
 =

 while(sizeof($lSize) > 0){
 	// still some textures remaining
@@ -350,11 +363,7 @@
 		=

 		++$number;
 =

-		if($doalpha){
-			$atlasname =3D "alpha_tex_atlas_$number";
-		} else {		=

-			$atlasname =3D "tex_atlas_$number";
-		}
+		$atlasname =3D $atlasbasename.$number;
 =

 		$im =3D CreateBlankImage($w, $h);
 		=

@@ -370,13 +379,6 @@
 	=

 	if($right > 0 && $bottom > 0){
 		$gTextureAtlasMap[] =3D array($mat, $atlasname, $left,$top,$right,$botto=
m);
-		=

-		/*
-		// remap meshes
-		foreach($tex["meshs"] as $mesh){
-			RemapUV($mesh,$left,$top,$right,$bottom,$tw,$th,$w,$h,$atlasname,$mat);
-		}
-		*/
 	}
 =

 	// next on x
@@ -401,37 +403,17 @@
 imagedestroy($im);
 =

 // generate material script
-if($doalpha){
-
-	$f =3D fopen("alpha_tex_atlas.material","w");
-	for($i=3D0;$i<=3D$number;++$i){
-		$name =3D "alpha_tex_atlas_$i";
-		$base =3D "tex_base_alpha";
-		$img =3D "alpha_tex_atlas_$i.png";
-		=

-		fwrite($f,"material $name : $base \n{ \n	technique \n	{ \n		pass\n		{		\=
n			texture_unit \n			{ \n				texture $img \n			}	\n		}\n	} \n}\n");
-	}
-	fclose($f);
-
-} else {
-
-	$f =3D fopen("tex_atlas.material","w");
-	for($i=3D0;$i<=3D$number;++$i){
-		$name =3D "tex_atlas_$i";
-		$base =3D "tex_base";
-		$img =3D "tex_atlas_$i.png";
-		=

-		fwrite($f,"material $name : $base \n{ \n	technique \n	{ \n		pass\n		{		\=
n			texture_unit \n			{ \n				texture $img \n			}	\n		}\n	} \n}\n");
-	}
-	fclose($f);
-
-}
-
-if($doalpha){
-	$atlasmapname =3D "alpha_tex_atlas_map.lua";
-} else {		=

-	$atlasmapname =3D "tex_atlas_map.lua";
-}
+$f =3D fopen("$atlasbasename.material","w");
+for($i=3D0;$i<=3D$number;++$i){
+	$name =3D $atlasbasename.$i;
+	$base =3D $atlasbasematerial;
+	$img =3D $atlasbasename.$i.".png";
+	=

+	fwrite($f,"material $name : $base \n{ \n	technique \n	{ \n		pass\n		{		\n=
			texture_unit \n			{ \n				texture $img \n			}	\n		}\n	} \n}\n");
+}
+fclose($f);
+
+$atlasmapname =3D $atlasbasename.".lua";
 =

 $f =3D fopen($atlasmapname, "w");
 foreach($gTextureAtlasMap as $x){

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Jan 19 18:48:37 2008
@@ -174,6 +174,7 @@
 	for i=3D1,20 do OgreAddResLoc(mydatapath..gModelPath_Mesh..sprintf("to_%0=
3d000",i)	,"FileSystem","General") end
 	OgreAddResLoc(mydatapath..gModelPath_Tex				,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."models/programs"				,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."models/atlas"				,"FileSystem","General")
 	--~ OgreAddResLoc(mydatapath.."models/models"				,"FileSystem","General")
 	OgreAddResLoc(mydatapath..gModelPath_Mesh				,"FileSystem","General")
 =

@@ -301,8 +302,22 @@
 	LoadBasicData()
 	=

 	-- load texture atlas mappings
-	dofile(datapath .. "models/models/alpha_tex_atlas_map.lua")
-	dofile(datapath .. "models/models/tex_atlas_map.lua")
+	-- high, med, low
+	-- TODO move to config or automatic best choosing
+	local atlasres =3D "med"	=

+	if atlasres =3D=3D "high" then
+		---- high res
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_4096_4096.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_4096_4096.lua")
+	elseif atlasres =3D=3D "med" then
+		---- med res
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_2048_128.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_2048_128.lua")
+	else
+		---- low res
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_512_32.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_512_32.lua")
+	end
 	=

 	-- show loading screen
 	SetLoadingBackground()



From no-reply at zwischenwelt.org  Sat Jan 19 20:41:44 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 19:41:44 -0000
Subject: [Iris-commit] [IRIS] r1792 - in /trunk: data/config.lua.dist
	lua/main.lua
Message-ID: <20080119200006.283361C18736@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 19 20:41:43 2008
New Revision: 1792

Log:
ultra low atlas config added

Modified:
    trunk/data/config.lua.dist
    trunk/lua/main.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Jan 19 20:41:43 2008
@@ -437,3 +437,5 @@
 =

 -- removed: obsolete !!!!! (Shader 2.0 for TerrainShader Engine)
 if (gTerrainShader) then gEnableMultiTexTerrain=3Dtrue end
+
+gAtlasRes =3D "med" -- "high", "med", "low", "ultralow"

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Jan 19 20:41:43 2008
@@ -304,19 +304,23 @@
 	-- load texture atlas mappings
 	-- high, med, low
 	-- TODO move to config or automatic best choosing
-	local atlasres =3D "med"	=

-	if atlasres =3D=3D "high" then
+	if gAtlasRes =3D=3D "high" then
 		---- high res
 		dofile(datapath .. "models/atlas/tex_atlas_alpha_4096_4096.lua")
 		dofile(datapath .. "models/atlas/tex_atlas_4096_4096.lua")
-	elseif atlasres =3D=3D "med" then
+	elseif gAtlasRes =3D=3D "med" then
 		---- med res
 		dofile(datapath .. "models/atlas/tex_atlas_alpha_2048_128.lua")
 		dofile(datapath .. "models/atlas/tex_atlas_2048_128.lua")
-	else
+	elseif gAtlasRes =3D=3D "low" then
 		---- low res
 		dofile(datapath .. "models/atlas/tex_atlas_alpha_512_32.lua")
 		dofile(datapath .. "models/atlas/tex_atlas_512_32.lua")
+	else
+		print("ULTRA LOW TEXATLAS")
+		---- ultralow res
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_256_8.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_256_8.lua")
 	end
 	=

 	-- show loading screen



From no-reply at zwischenwelt.org  Sat Jan 19 20:38:23 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 19:38:23 -0000
Subject: [Iris-commit] [IRIS] r1791 - in /trunk/data/models/atlas:
 tex_atlas_256_8.lua tex_atlas_256_8.material tex_atlas_256_80.png
 tex_atlas_alpha_256_8.lua tex_atlas_alpha_256_8.material
 tex_atlas_alpha_256_80.png
Message-ID: <20080119200005.F41F41C18734@zwischenwelt.org>

Author: hagish
Date: Sat Jan 19 20:38:22 2008
New Revision: 1791

Log:
ultra low atlas

Added:
    trunk/data/models/atlas/tex_atlas_256_8.lua
    trunk/data/models/atlas/tex_atlas_256_8.material
    trunk/data/models/atlas/tex_atlas_256_80.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_256_8.lua
    trunk/data/models/atlas/tex_atlas_alpha_256_8.material
    trunk/data/models/atlas/tex_atlas_alpha_256_80.png   (with props)



From no-reply at zwischenwelt.org  Sat Jan 19 20:14:24 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 19:14:24 -0000
Subject: [Iris-commit] [IRIS] r1790 - in /trunk:
 data/terrain/materials/terrain.material lua/lib.3d.map.lua
 lua/lib.compass.lua lua/lib.loading.lua lua/lib.terrain.multitex.lua
 lua/main.lua
Message-ID: <20080119200005.EADAF1C180EC@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 19 20:14:23 2008
New Revision: 1790

Log:
ugly terrain set to png instead of dds (crashed on my gfx card) , removed s=
ome obsolete multitex terrain code, little profiler util

Modified:
    trunk/data/terrain/materials/terrain.material
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.compass.lua
    trunk/lua/lib.loading.lua
    trunk/lua/lib.terrain.multitex.lua
    trunk/lua/main.lua

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Sat Jan 19 20:14:23 2008
@@ -15,7 +15,8 @@
 			{
 				// draws ground and applies diffuse lighting
 				// texture terrain_tex_atlas_1024.dds
-				texture terrain_tex_atlas_256.dds
+				// texture terrain_tex_atlas_256.dds
+				texture terrain_tex_atlas_256.png
 				tex_coord_set	0
 				colour_op_ex	modulate src_texture src_diffuse
 			}

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sat Jan 19 20:14:23 2008
@@ -317,26 +317,30 @@
 	end
 =

 	-- GROUNDMAP
-	if (gGroundBlockLoader and (not gEnableMultiTexTerrain)) then -- probably=
 needs gTexMapLoader
---		local meshname =3D BuildTerrainEntity_Simple(gGroundBlockLoader,iBlock=
UO_X,iBlockUO_Y,self.ROBMAP_CHUNK_SIZE,self.ROBMAP_CHUNK_SIZE,false)
-		local meshname =3D BuildTerrainEntity_Shaded(gGroundBlockLoader,iBlockUO=
_X,iBlockUO_Y,self.ROBMAP_CHUNK_SIZE,self.ROBMAP_CHUNK_SIZE)
-		if (meshname) then
-			chunk.sTerrainMeshName =3D meshname
-			local x,y,z =3D self:UOPosToLocal(iBlockUO_X*8,iBlockUO_Y*8,0)
-			if (gbUseStaticGeometryForTerrain) then
-				-- use static geometry
-				chunk.pTerrainEntity =3D CreateMeshEntity(meshname)	=

-				chunk.pStaticGeometryTerrain =3D CreateStaticGeometry()
-				chunk.pStaticGeometryTerrain:AddEntity(chunk.pTerrainEntity,x,y,0)
-				chunk.pStaticGeometryTerrain:Build()
-				chunk.pStaticGeometryTerrain:SetVisible(self.gbBlendOutTerrainVisible)
-			else
-				-- use scenenode
-				chunk.terraingfx =3D CreateRootGfx3D()
-				chunk.terraingfx:SetMesh(meshname)
-				chunk.terraingfx:SetPosition(x,y,0)
-				chunk.terraingfx:SetCastShadows(gTerrainCastShadows)
-				chunk.terraingfx:SetVisible(self.gbBlendOutTerrainVisible)
+	if (gGroundBlockLoader) then -- probably needs gTexMapLoader
+		if (gEnableMultiTexTerrain) then
+			chunk.terrain_multitex_gfx =3D MakeMultiTexTerrainGfx(iBlockUO_X,iBlock=
UO_Y) =

+		else -- old terrain code
+			--local meshname =3D BuildTerrainEntity_Simple(gGroundBlockLoader,iBloc=
kUO_X,iBlockUO_Y,self.ROBMAP_CHUNK_SIZE,self.ROBMAP_CHUNK_SIZE,false)
+			local meshname =3D BuildTerrainEntity_Shaded(gGroundBlockLoader,iBlockU=
O_X,iBlockUO_Y,self.ROBMAP_CHUNK_SIZE,self.ROBMAP_CHUNK_SIZE)
+			if (meshname) then
+				chunk.sTerrainMeshName =3D meshname
+				local x,y,z =3D self:UOPosToLocal(iBlockUO_X*8,iBlockUO_Y*8,0)
+				if (gbUseStaticGeometryForTerrain) then
+					-- use static geometry
+					chunk.pTerrainEntity =3D CreateMeshEntity(meshname)	=

+					chunk.pStaticGeometryTerrain =3D CreateStaticGeometry()
+					chunk.pStaticGeometryTerrain:AddEntity(chunk.pTerrainEntity,x,y,0)
+					chunk.pStaticGeometryTerrain:Build()
+					chunk.pStaticGeometryTerrain:SetVisible(self.gbBlendOutTerrainVisible)
+				else
+					-- use scenenode
+					chunk.terraingfx =3D CreateRootGfx3D()
+					chunk.terraingfx:SetMesh(meshname)
+					chunk.terraingfx:SetPosition(x,y,0)
+					chunk.terraingfx:SetCastShadows(gTerrainCastShadows)
+					chunk.terraingfx:SetVisible(self.gbBlendOutTerrainVisible)
+				end
 			end
 		end
 	end
@@ -599,6 +603,7 @@
 		if (chunk.fastbatch) then chunk.fastbatch:Destroy() end
 		if (chunk.pStaticGeometryTerrain) then chunk.pStaticGeometryTerrain:Dest=
roy() chunk.pStaticGeometryTerrain =3D nil end
 		if (chunk.terraingfx) then chunk.terraingfx:Destroy() chunk.terraingfx =
=3D nil end
+		if (chunk.terrain_multitex_gfx) then chunk.terrain_multitex_gfx:Destroy(=
) chunk.terrain_multitex_gfx =3D nil end
 		if (chunk.pTerrainEntity) then chunk.pTerrainEntity:Destroy() chunk.pTer=
rainEntity =3D nil end
 		for k,v in pairs(chunk.lStaticEntities) do
 			if (v.lightname) then Client_RemoveLight(v.lightname) v.lightname =3D n=
il end

Modified: trunk/lua/lib.compass.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.compass.lua (original)
+++ trunk/lua/lib.compass.lua Sat Jan 19 20:14:23 2008
@@ -99,10 +99,15 @@
 ]]--
 function SetCompassMapIndex	(iMapIndex) =

 	if (gDisableCompass) then return end
+	=

+	local profile =3D MakeProfiler("compass")
+	profile:StartSection("init")
+	=

 	InitCompassIfNeeded()
 	if (not gIrisCompassDialog) then return end
 =

 	-- generate map file md5s
+	profile:StartSection("md5")
 	local md5 =3D MD5FromFileList({
 			CorrectPath( Addfilepath(gMaps[iMapIndex].mapfilename) ),
 			CorrectPath( Addfilepath(gMaps[iMapIndex].staidxfilename) ),
@@ -120,25 +125,32 @@
 			gRadarColorLoader =3D CreateRadarColorLoader(gRadarColorLoaderType,Corr=
ectPath( Addfilepath(gRadarcolFile) ))
 		end
 =

+		profile:StartSection("write")
 		gGroundBlockLoader:WriteMapImageToFile(gRadarColorLoader,gStaticBlockLoa=
der,gMapImagePath_Small,false)
 	end
 	=

+	profile:StartSection("material")
 	local mat =3D CloneMaterial("tempmapbase")
 	SetTexture(mat,gMapImagePath_Small)
 	gIrisCompassDialog.compass.gfx:SetMaterial(mat)
 	=

 	-- init zoom
+	profile:StartSection("zoom")
 	gCompassMapW =3D gGroundBlockLoader and gGroundBlockLoader:GetMapW() or 1
 	gCompassMapH =3D gGroundBlockLoader and gGroundBlockLoader:GetMapH() or 1
 	ZoomCompass(1.0)
 	=

 	if (gGroundBlockLoader and gStaticBlockLoader and gRadarColorLoader and g=
EnableCompassRadar) then
+		profile:StartSection("radar")
 		gIrisCompassDialog.radar:Destroy()
 		gIrisCompassDialog.radar =3D CreateRadar( gGroundBlockLoader, gStaticBlo=
ckLoader, gRadarColorLoader )
 	end
 	=

 	-- to set geometry correctly
+	profile:StartSection("updategeom")
 	UpdateCompass()
+	=

+	profile:Finish()
 end
 =

 -- factor > 1 increases sight radius

Modified: trunk/lua/lib.loading.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.loading.lua (original)
+++ trunk/lua/lib.loading.lua Sat Jan 19 20:14:23 2008
@@ -30,6 +30,8 @@
 	gLoadingProfileLastAction =3D sCurAction
 	gLoadingProfileLastTime =3D Client_GetTicks() -- take out time required b=
y Client_RenderOneFrame
 end
+
+
 =

 -- load basic data before login
 function LoadBasicData ()	=

@@ -206,7 +208,6 @@
 	-- destroy old ground and static loaders
 	if (gGroundBlockLoader) then gGroundBlockLoader:Destroy() gGroundBlockLoa=
der =3D nil end
 	if (gStaticBlockLoader) then gStaticBlockLoader:Destroy() gStaticBlockLoa=
der =3D nil end
-	MultiTexTerrain_UnloadAll()
 	Renderer3D:ClearMapCache()
 end
 =

@@ -214,7 +215,11 @@
 function LoadMap (index)
 	gMapLoaded =3D true
 	gMapIndex =3D index
-
+	=

+	=

+	local profile =3D MakeProfiler("mapload")
+
+	profile:StartSection("clearcache")
 	gCurrentRenderer:ClearMapCache()
 	print("gMapIndex",gMapIndex)
 =

@@ -234,6 +239,7 @@
 =

 	if (gGroundBlockLoaderType) then
 		if (not gInitialMapLoaded) then LoadingProfile("init GroundblockLoader")=
 end
+		profile:StartSection("ground")
 		=

 		print("Loading Map id "..index)
 		print("Loading Map name "..name)
@@ -254,6 +260,7 @@
 		=

 	if (gStaticBlockLoaderType) then
 		if (not gInitialMapLoaded) then LoadingProfile("init StaticBlockLoader")=
 end
+		profile:StartSection("static")
 		=

 		print("Loading Static static idx "..staidxfilename)
 		print("Loading Static static "..staticfilename)
@@ -274,6 +281,11 @@
 	end
 =

 	-- update renderer
+	profile:StartSection("mapenv")
 	gCurrentRenderer:SetMapEnvironment()
+	=

+	profile:StartSection("compass")
 	SetCompassMapIndex(index)
-end
+	=

+	profile:Finish()
+end

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Sat Jan 19 20:14:23 2008
@@ -190,51 +190,18 @@
 end
 =

 =

-function MultiTexTerrain_UnloadAll ()
-	for k,gfx in pairs(gMultiTexTerrain_GfxList) do gfx:Destroy() end
-	gMultiTexTerrain_GfxList =3D {}
-	gMultiTexTerrain_BX =3D nil
-	gMultiTexTerrain_BY =3D nil
-end
-
-function MultiTexTerrainStep ()
-	if (not gEnableMultiTexTerrain) then return end
-	if (gMultiTexTerrain_NextStep > gMyTicks) then return end
-	if (not gGroundBlockLoader) then return end
-	gMultiTexTerrain_NextStep =3D gMyTicks + kMultiTexTerrain_StepInterval
-	=

-	local chunksize =3D kMultiTexTerrainChunkSize
-	local camx,camy,camz =3D gCurrentRenderer:GetLookAheadCamPos()
-	local bx =3D -math.ceil(( gCurrentRenderer.giMapOriginX*gCurrentRenderer.=
ROBMAP_CHUNK_SIZE + camx/8)/chunksize) * chunksize
-	local by =3D  math.floor((gCurrentRenderer.giMapOriginY*gCurrentRenderer.=
ROBMAP_CHUNK_SIZE + camy/8)/chunksize) * chunksize
-	=

-	if (gMultiTexTerrain_BX =3D=3D bx and gMultiTexTerrain_BY =3D=3D by) then=
 return end
-	gMultiTexTerrain_BX =3D bx
-	gMultiTexTerrain_BY =3D by
-	local r =3D math.floor(1 + gSightRange * 1.5)
-	for k,gfx in pairs(gMultiTexTerrain_GfxList) do =

-		if (math.abs(gfx.bx - bx) > r or math.abs(gfx.by - by) > r) then
-			gfx:Destroy() =

-			gMultiTexTerrain_GfxList[k] =3D nil
-		end
-	end
-	for dy =3D -r,r,chunksize do
-	for dx =3D -r,r,chunksize do
-		local name =3D (bx+dx).."_"..(by+dy)
-		if (not gMultiTexTerrain_GfxList[name]) then =

-			local gfx =3D CreateRootGfx3D()
-			gfx.bx =3D bx+dx
-			gfx.by =3D by+dy
-			local x,y,z =3D gCurrentRenderer:UOPosToLocal((bx+dx)*8,(by+dy)*8,0)
-			gfx.x =3D x
-			gfx.y =3D y
-			gfx.z =3D z
-			gfx:SetPosition(x,y,z)
-			Gfx3D_SetMultiTexTerrain(gfx,gGroundBlockLoader,bx+dx,by+dy,chunksize,c=
hunksize)
-			gfx:SetMaterial(MultiTexTerrainGetMat())
-			gfx:SetCastShadows(gTerrainCastShadows)
-			gMultiTexTerrain_GfxList[name] =3D gfx
-		end
-	end
-	end
-end
+
+function MakeMultiTexTerrainGfx(bx,by) =

+	local gfx =3D CreateRootGfx3D()
+	gfx.bx =3D bx
+	gfx.by =3D by
+	local x,y,z =3D gCurrentRenderer:UOPosToLocal(bx*8,by*8,0)
+	gfx.x =3D x
+	gfx.y =3D y
+	gfx.z =3D z
+	gfx:SetPosition(x,y,z)
+	Gfx3D_SetMultiTexTerrain(gfx,gGroundBlockLoader,bx,by,kMultiTexTerrainChu=
nkSize,kMultiTexTerrainChunkSize)
+	gfx:SetMaterial(MultiTexTerrainGetMat())
+	gfx:SetCastShadows(gTerrainCastShadows)
+	return gfx
+end

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Jan 19 20:14:23 2008
@@ -338,7 +338,10 @@
 		for k,id in pairs(iArtMapIDList) do
 			local iArtMapID =3D hex2num("0x00004000") + id
 			if (gArtMapLoader:ExportToImage(img,iArtMapID)) then
-				local bSuccess,l,r,t,b =3D pTexAtlas:AddImage(img)
+				local b =3D 4
+				local img2 =3D ImageScale(img,64-b-b,64-b-b)
+				local bSuccess,l,r,t,b =3D pTexAtlas:AddImage(img2)
+				img2:Destroy()
 			end
 		end
 		--~ local sTexName =3D	pTexAtlas:MakeTexture()
@@ -467,7 +470,6 @@
 	GUIStep() -- generate mouse_enter, mouse_leave events (might adjust curso=
r -> before CursorStep)
 	ToolTipStep() -- needs mouse_enter, should be after GUIStep
 	CursorStep()
-	MultiTexTerrainStep()
 =

 	NotifyListener("EveryFrame")
 	=




From no-reply at zwischenwelt.org  Sat Jan 19 21:32:38 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 20:32:38 -0000
Subject: [Iris-commit] [IRIS] r1793 - in /trunk: bin/iris2.exe
 data/config.lua.dist data/terrain/materials/terrain.material lua/main.lua
Message-ID: <20080119203238.AE3201C186F7@zwischenwelt.org>

Author: sience
Date: Sat Jan 19 21:32:38 2008
New Revision: 1793

Log:
-new binary
-some changes

Modified:
    trunk/bin/iris2.exe
    trunk/data/config.lua.dist
    trunk/data/terrain/materials/terrain.material
    trunk/lua/main.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Jan 19 21:32:38 2008
@@ -430,12 +430,6 @@
 --~ gModelPath_Tex	=3D "models/textures_texatlas/"
 gUseTexAtlas =3D true -- only used if fastbatch is active
 =

--- low resolution texture atlas
--- gLowResTexAtlasNameMap =3D { ["alpha_tex_atlas_0"]=3D"alpha_tex_atlas_0=
_512", ["tex_atlas_0"]=3D"tex_atlas_0_512" }
-
 gEnableCompassRadar =3D false -- the detailed compass is rendered using st=
encil buffers and seems to cause trouble with shadows
 =

--- removed: obsolete !!!!! (Shader 2.0 for TerrainShader Engine)
-if (gTerrainShader) then gEnableMultiTexTerrain=3Dtrue end
-
 gAtlasRes =3D "med" -- "high", "med", "low", "ultralow"

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Sat Jan 19 21:32:38 2008
@@ -72,3 +72,9 @@
 		}
 	}
 }
+
+// Deep Shadow Mapping Tests
+material terrain_multitex_mat_xx : Ogre/DepthShadowmap/BasicTemplateMateri=
al
+{
+	set_texture_alias MainTexture terrain_tex_atlas_1024.dds
+}

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Jan 19 21:32:38 2008
@@ -283,13 +283,19 @@
 	-- set global shadow settings
 	if (gShadowTechnique ~=3D "none") then
 		OgreShadowTechnique(gShadowTechnique)
+		OgreSetShadowFarDistance(gSightRange*18.0)
+
 		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique =
=3D=3D "texture_additive")) then
 			OgreSetShadowTextureSize(2048)
 			OgreSetShadowTextureSelfShadow(false)
-			--OgreSetShadowTextureCasterMaterial(matname)
-			--OgreSetShadowTextureReceiverMaterial(matname)
-			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --only for accuracy
-			OgreSetShadowFarDistance(gSightRange*18.0)
+		end
+
+		if (gShadowTechnique =3D=3D "texture_additive_integrated") then
+			OgreSetShadowCasterRenderBackFaces(false)
+			OgreSetShadowTextureCasterMaterial("Ogre/DepthShadowmap/Caster/Float")
+			--OgreSetShadowTextureReceiverMaterial("Ogre/DepthShadowmap/BasicTempla=
teMaterial")
+			OgreSetShadowTextureSettings(2048, 3, PF_FLOAT32_R)
+			OgreSetShadowTextureSelfShadow(false)
 		end
 	end
 =




From no-reply at zwischenwelt.org  Sat Jan 19 21:55:34 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 20:55:34 -0000
Subject: [Iris-commit] [IRIS] r1794 - /trunk/data/config.lua.dist
Message-ID: <20080119205535.49B601C186F7@zwischenwelt.org>

Author: sience
Date: Sat Jan 19 21:55:34 2008
New Revision: 1794

Log:
-Fastbatch is Enabled, Shadow is Enabled, Lightsources are Enabled, gSightR=
ange =3D 3

Modified:
    trunk/data/config.lua.dist

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Jan 19 21:55:34 2008
@@ -71,7 +71,7 @@
 gUniFontLoaderType					=3D "FullFile" -- currently only FullFile available
 =

 -- sightrange is in blocks (8x8 tiles), larger values let you see further,=
 but will result in lower fps
-gSightRange	=3D 2
+gSightRange	=3D 3
 =

 -- 0 Trammel, 1 Felucca, 2 Ilshenar, 3 Malas, 4 Tokuno
 gMapIndex =3D 0
@@ -79,7 +79,7 @@
 gCompassZoomFactor =3D 1.5
 gCompassSize =3D 150 -- in pixels on screen, set to 0 to disable
 giCompassDetailLimit =3D 12 -- in mapblocks shown
-gCompassVisibleRad =3D giCompassDetailLimit *3
+gCompassVisibleRad =3D giCompassDetailLimit * 4
 -- todo : gMapImagePath_Small	=3D "tempmap_small.tga"
 -- todo : gMapImagePath_Big		=3D "tempmap_big.tga"
 =

@@ -271,20 +271,18 @@
 gDynamicsCastShadows =3D false
 gMobileCastShadows =3D false
 =

---[[
 -- sample shadow setting
-gEnableShadows =3D false
+gEnableShadows =3D true
 if (gEnableShadows) then
-	gShadowTechnique =3D "stencil_modulative"
+	gShadowTechnique =3D "texture_additive"
 	gTerrainCastShadows =3D false
 	gStaticsCastShadows =3D true
 	gDynamicsCastShadows =3D true
 	gMobileCastShadows =3D true
 end
-]]--
 =

 -- activates Lightsources
-gLightsources =3D false
+gLightsources =3D true
 =

 -- activates Particle Effects
 gParticleEffectSystem =3D true
@@ -421,7 +419,9 @@
 =

 gEnableMultiTexTerrain =3D true
 gDisableMultiTexTerrainTransitions =3D false -- ugly, but faster
-gFastBatchStatics =3D false -- faster, but mousepicking and blend-out-uppe=
r-floors doesn't work yet
+
+-- Fastbatching of Statics/Dynamics (no hueing)
+gFastBatchStatics =3D true
 gFastBatchDynamics =3D false
 =

 gModelPath_Mesh	=3D "models/models/" -- overrideable for texture-atlas exp=
eriments



From no-reply at zwischenwelt.org  Sat Jan 19 22:34:14 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 21:34:14 -0000
Subject: [Iris-commit] [IRIS] r1795 - in /trunk/data/custom/models:
 to_001000/ to_002000/ to_003000/ to_004000/ to_005000/ to_006000/
 to_007000/ to_008000/ to_009000/ to_010000/ to_011000/ to_012000/
 to_013000/ to_014000/ to_015000/ to_016000/ to_017000/ to_018000/
 to_019000/ to_020000/
Message-ID: <20080119213417.350751C186F7@zwischenwelt.org>

Author: hagish
Date: Sat Jan 19 22:34:14 2008
New Revision: 1795

Log:
removed number subdirs from custom models

Removed:
    trunk/data/custom/models/to_001000/
    trunk/data/custom/models/to_002000/
    trunk/data/custom/models/to_003000/
    trunk/data/custom/models/to_004000/
    trunk/data/custom/models/to_005000/
    trunk/data/custom/models/to_006000/
    trunk/data/custom/models/to_007000/
    trunk/data/custom/models/to_008000/
    trunk/data/custom/models/to_009000/
    trunk/data/custom/models/to_010000/
    trunk/data/custom/models/to_011000/
    trunk/data/custom/models/to_012000/
    trunk/data/custom/models/to_013000/
    trunk/data/custom/models/to_014000/
    trunk/data/custom/models/to_015000/
    trunk/data/custom/models/to_016000/
    trunk/data/custom/models/to_017000/
    trunk/data/custom/models/to_018000/
    trunk/data/custom/models/to_019000/
    trunk/data/custom/models/to_020000/



From no-reply at zwischenwelt.org  Sat Jan 19 23:03:27 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 22:03:27 -0000
Subject: [Iris-commit] [IRIS] r1796 - in /trunk/lua: lib.3d.dynamic.lua
 lib.3d.mousepick.lua lib.terrain.multitex.lua lib.walking2.lua
Message-ID: <20080119220327.BA8341C186F7@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 19 23:03:27 2008
New Revision: 1796

Log:
fixed terrain mousepick

Modified:
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.mousepick.lua
    trunk/lua/lib.terrain.multitex.lua
    trunk/lua/lib.walking2.lua

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sat Jan 19 23:03:27 2008
@@ -15,6 +15,7 @@
 end
 =

 function Renderer3D:CheckForFastBatchDynamicsUpdate ()
+	if (gTestHideDynamics) then return end =

 	if Renderer3D.gFastBatchDynamicsUpdateNeeded and =

 		(not Renderer3D.gFastBatchDynamicsUpdateNext or Renderer3D.gFastBatchDyn=
amicsUpdateNext < gMyTicks) then
 =

@@ -66,6 +67,7 @@
 -- TODO: Multis & Serversidemultis don't recognize kTileDataFlag_LightSour=
ce yet
 function Renderer3D:CreateDynamicGfx( item )
 	assert(not item.gfx)
+	if (gTestHideDynamics) then return end
 =

 	-- FILTER: get correction
 	item.xadd =3D FilterPositionX(item.artid) or 0

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Sat Jan 19 23:03:27 2008
@@ -79,45 +79,6 @@
 	local y,row,x,chunk,k,v
 	local bHit,fHitDist
 	=

-	-- terrain : new ... TODO
-	if (gEnableMultiTexTerrain) then
-		local bx,by,tx,ty
-		bHit,fHitDist,bx,by,tx,ty =3D MultiTexTerrain_RayPickAll(rx,ry,rz,rvx,rv=
y,rvz)
-		--~ print("Renderer3D:MousePick_3D MultiTexTerrain_RayPick",bHit,fHitDis=
t,bx,by,tx,ty)
-		--- TODO  : calc vars... blockx etc , register mousehit....
-		=

-		local iBlockUO_X =3D bx -- chunk.miX * self.ROBMAP_CHUNK_SIZE
-		local iBlockUO_Y =3D by -- chunk.miY * self.ROBMAP_CHUNK_SIZE
-		=

-		if (bHit and ((not gMousePickFoundHit) or fHitDist < self.gMousePickFoun=
dDist)) then
-			self.gMousePickFoundDist =3D fHitDist
-			gMousePickFoundHit =3D {}
-			gMousePickFoundHit.hittype =3D kMousePickHitType_Terrain
-			gMousePickFoundHit.chunk =3D nil -- chunk ??
-			=

-			local x,y =3D Renderer3D:LocalToUOPos(rx + fHitDist * rvx, ry + fHitDis=
t * rvy)
-			x,y =3D math.floor(x),math.floor(y)
-			local iTileType,iZLoc =3D GetAbsTile(x,y) =

-			local bx =3D math.floor((x - iBlockUO_X)/8)
-			local by =3D math.floor((y - iBlockUO_Y)/8)
-			local origin_abs_x =3D self.giMapOriginX * self.ROBMAP_CHUNK_SIZE
-			local origin_abs_y =3D self.giMapOriginY * self.ROBMAP_CHUNK_SIZE
-			local originoffx =3D 8.0*(iBlockUO_X-origin_abs_x)
-			local originoffy =3D 8.0*(iBlockUO_Y-origin_abs_y)
-			=

-			gMousePickFoundHit.tiletype =3D iTileType
-			gMousePickFoundHit.minz =3D iZLoc*0.1 =

-			gMousePickFoundHit.maxz =3D iZLoc*0.1
-			gMousePickFoundHit.x =3D x
-			gMousePickFoundHit.y =3D y
-			gMousePickFoundHit.tx =3D math.mod(x,8)
-			gMousePickFoundHit.ty =3D math.mod(y,8)
-			gMousePickFoundHit.iBlockX =3D iBlockUO_X+bx
-			gMousePickFoundHit.iBlockY =3D iBlockUO_Y+by
-			gMousePickFoundHit.blockorigin_x =3D originoffx+bx*8
-			gMousePickFoundHit.blockorigin_y =3D originoffy+by*8
-		end
-	end
 	=

 	for chunky,row in pairs(self.gMapChunks) do
 		for chunkx,chunk in pairs(row) do
@@ -152,15 +113,27 @@
 					end
 				end
 =

-				-- terrain : old
+				-- terrain
 				if (gGroundBlockLoader and self.gbBlendOutTerrainVisible) then
 					local iBlockUO_X =3D chunk.miX * self.ROBMAP_CHUNK_SIZE
 					local iBlockUO_Y =3D chunk.miY * self.ROBMAP_CHUNK_SIZE
-					if (chunk.pStaticGeometryTerrain) then
+													=

+					if (chunk.pStaticGeometryTerrain) then -- old terrain : static-geom
 						local x,y =3D self:UOPosToLocal(iBlockUO_X*8,iBlockUO_Y*8)
 						bHit,fHitDist =3D chunk.pTerrainEntity:RayPick(rx,ry,rz,rvx,rvy,rvz,=
x,y,0)
+					elseif (chunk.terrain_multitex_gfx) then -- new terrain multitex
+						local gfx =3D chunk.terrain_multitex_gfx
+						local d =3D kMultiTexTerrainChunkSize
+						local bx,by =3D gfx.bx,gfx.by
+						local tx,ty
+
+						bHit,fHitDist,tx,ty =3D TerrainMultiTex_RayPick(gGroundBlockLoader,g=
fx.bx,gfx.by,d,d, rx-gfx.x,ry-gfx.y,rz-gfx.z, rvx,rvy,rvz)
+						if (bHit) then
+							if (tx >=3D 8) then bx =3D bx + 1   tx =3D tx - 8 end
+							if (ty >=3D 8) then by =3D by + 1   ty =3D ty - 8 end
+						end
 					else
-						if (chunk.terraingfx) then
+						if (chunk.terraingfx) then -- old terrain : meshentities
 							bHit,fHitDist =3D chunk.terraingfx:RayPick(rx,ry,rz,rvx,rvy,rvz)
 						else
 							bHit =3D false
@@ -195,7 +168,7 @@
 						gMousePickFoundHit.blockorigin_x =3D originoffx+bx*8
 						gMousePickFoundHit.blockorigin_y =3D originoffy+by*8
 					end
-						=

+					=

 					--[[
 					-- OBSOLETED CODE ! don't use this, hasn't been adjusted to xmirror f=
ix
 					local iBlockUO_X =3D chunk.miX * self.ROBMAP_CHUNK_SIZE

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Sat Jan 19 23:03:27 2008
@@ -164,31 +164,6 @@
 end
 =

 =

--- returns bHit,fHitDist,bx,by,tx,ty
-function MultiTexTerrain_RayPickAll(rx,ry,rz,rvx,rvy,rvz)
-	--~ if (true) then return end
-	if (not gGroundBlockLoader) then return end
-	local d =3D kMultiTexTerrainChunkSize
-	local fHitDist =3D nil
-	local bx,by,tx,ty
-
-	for k,gfx in pairs(gMultiTexTerrain_GfxList) do =

-		local bhit,_hitdist,_tx,_ty =3D TerrainMultiTex_RayPick(gGroundBlockLoad=
er,gfx.bx,gfx.by,d,d, rx-gfx.x,ry-gfx.y,rz-gfx.z, rvx,rvy,rvz)
-		if (bhit) then
-			--~ print(" mousepick terrain ",gfx.bx,gfx.by,bhit,_hitdist,_tx,_ty)
-			if ((not fHitDist) or _hitdist < fHitDist) then
-				fHitDist =3D _hitdist
-				bx,by,tx,ty =3D gfx.bx,gfx.by,_tx,_ty
-			end
-		end
-	end
-	if (fHitDist) then
-		if (tx >=3D 8) then bx =3D bx + 1   tx =3D tx - 8 end
-		if (ty >=3D 8) then by =3D by + 1   ty =3D ty - 8 end
-		return true,fHitDist,bx,by,tx,ty
-	end
-end
-
 =

 =

 function MakeMultiTexTerrainGfx(bx,by) =


Modified: trunk/lua/lib.walking2.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.walking2.lua (original)
+++ trunk/lua/lib.walking2.lua Sat Jan 19 23:03:27 2008
@@ -149,6 +149,7 @@
 	-- multis
 	--~ printwalkdebug("---Multis")
 	=

+	if (not gTestIgnoreMultisInWalk) then
 	for k,v in pairs(gMultis) do
 		local multi =3D k
 		=

@@ -162,10 +163,12 @@
 			end
 		end
 	end
+	end
 	=

 	-- dynamics
 	--~ printwalkdebug("---Dynamics")
 	=

+	if (not gTestIgnoreDynamicInWalk) then
 	for k,dynamic in pairs(GetDynamicList()) do
 		if(DynamicIsInWorld(dynamic) and dynamic.artid) then
 =

@@ -216,6 +219,8 @@
 		end
 	end
 	=

+	end
+	=

 	--~ printwalkdebug("End GetWalkingBlockFlags()")
 	return flaglist
 end



From no-reply at zwischenwelt.org  Sat Jan 19 23:31:27 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 22:31:27 -0000
Subject: [Iris-commit] [IRIS] r1797 - /trunk/lua/obj/obj.dynamic.lua
Message-ID: <20080119223131.F16ED1C1872A@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 19 23:31:26 2008
New Revision: 1797

Log:
container-item fix

Modified:
    trunk/lua/obj/obj.dynamic.lua

Modified: trunk/lua/obj/obj.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.dynamic.lua (original)
+++ trunk/lua/obj/obj.dynamic.lua Sat Jan 19 23:31:26 2008
@@ -182,7 +182,7 @@
 =

 -- updates widgets automatically through old,new:UpdateContent() message
 function gDynamicPrototype:SetContainer	(newcontainer_or_serial)
-	local newcontainer =3D GetContainer(newcontainer_or_serial)
+	local newcontainer =3D GetOrCreateContainer(newcontainer_or_serial)
 	if (self.container =3D=3D newcontainer) then return end
 	if (self.container) then self.container:RemoveContentObject(self) end -- =
remove from old
 	if (newcontainer) then newcontainer:AddContentObject(self) end -- add to =
new (sets self.container)



From no-reply at zwischenwelt.org  Sat Jan 19 23:32:43 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 22:32:43 -0000
Subject: [Iris-commit] [IRIS] r1798 - /trunk/lua/obj/obj.container.lua
Message-ID: <20080119223243.5C8671C1872A@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 19 23:32:42 2008
New Revision: 1798

Log:
container-item fix

Modified:
    trunk/lua/obj/obj.container.lua

Modified: trunk/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.container.lua (original)
+++ trunk/lua/obj/obj.container.lua Sat Jan 19 23:32:42 2008
@@ -135,6 +135,7 @@
 =

 -- creates if necessary
 function GetOrCreateContainer (serial) =

+	if (serial =3D=3D 0 or (not serial)) then return end =

 	local container =3D GetContainer(serial)
 	if (not container) then =

 		-- container didn't exist yet, create from scratch



From no-reply at zwischenwelt.org  Sun Jan 20 00:13:57 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 23:13:57 -0000
Subject: [Iris-commit] [IRIS] r1800 - in /rawdata/sd_pd: tex_grass.png
	topf.blend
Message-ID: <20080120000012.ED2E81C181A9@zwischenwelt.org>

Author: hagish
Date: Sun Jan 20 00:13:56 2008
New Revision: 1800

Log:
some new models

Added:
    rawdata/sd_pd/tex_grass.png   (with props)
Modified:
    rawdata/sd_pd/topf.blend

Modified: rawdata/sd_pd/topf.blend
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Sun Jan 20 00:12:26 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 23:12:26 -0000
Subject: [Iris-commit] [IRIS] r1799 - in /trunk: README lua/lib.static.lua
Message-ID: <20080120000012.C07281C180EC@zwischenwelt.org>

Author: sience
Date: Sun Jan 20 00:12:25 2008
New Revision: 1799

Log:
-README konverted to DOS Linebreaks
-some comments removed

Modified:
    trunk/README
    trunk/lua/lib.static.lua

Modified: trunk/README
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/README (original)
+++ trunk/README Sun Jan 20 00:12:25 2008
@@ -1,164 +1,163 @@
-Iris2, Copyright (C) 2006 - 2007 Iris Team
-__________________________________________
-
-Iris2 is a 3D/2D game client for Online Role Playing Game "Ultima Online" =
(tm)
-using the Ogre 3D-Engine.
-
-Iris Installation (Step 1-4):
-1. You need a legal copy of Ultima Online to use Iris2.
-   Supported Ultima Online expansions:
-	- Age of Shadows
-	- Samurai Empire and Gold Trial  (SE =3D=3D Gold)
-	- Mondain's Legacy
-	- or later.
-
-2. Install and run Ultima Online and patch it to the newest Version.
-
-3. Run Iris2_Setup.exe
-
-4. Install Visual Studio 8 Sp1 redistributional (done during Setup)
-
-5. Run the Iris2 updater.exe
-
-=3D=3D Iris on Linux =3D=3D
-
-for linux install see the file named INSTALL =

-
-=3D=3D How to get Ultima Online data =3D=3D
-
-Get Ultima Online Mondain's Legacy :
-http://www.uo.com/uoml/downloads.shtml
-
-Or Ultima Online Gold Trial :
-http://www.gamespot.com/promos/ultimaonline/index.html
-http://www.fileplanet.com/150525/150000/fileinfo/Ultima-Online-Gold-15-day=
-Trial
-
-INSTALL SEE
-http://iris2.de/index.php/InstallationManual		(English)
-http://iris2.de/index.php/Installations_Anleitung	(deutsch)
-
-=3D=3D controls =3D=3D
-arrow keys for moving the player
-u : walk to targetted position
-
-n	: toggle compass
-,&. : zoom compass
-
-mousebutton middle : rotate camera
-mousebutton left+right : rotate camera
-mousewheel up	: zoom camera
-mousewheel down : zoom camera
-
-return	: activate or send chatline
-space	: run to and attack selected mobile
-q	: select neares mobile
-e	: select next mobile
-tab : toggle warmode
-l	: hold to show iris logo
-r	: say "vendor buy" (opens buymenus of nearby traders on most servers)
-c	: toggle cam mode (freefly,ego,3rdperson)
-x,z : zoom camera
-t	: toggle Stats
-k	: toggle Skills
-j	: toggle journal
-b	: toggle backpack
-p	: toggle paperdoll
-y	: toogle renderer 2D/3D
-v	: take a screenshot, saved to screenshots/iris*.jpg , where * is timesta=
mp
-g	: repeat last chatline
-h	: repeat last doubleclick
-
-shift-click : simulates doubleclick (temporary, helpful for low framerates)
-
-f6 : in offline mode : teleport to position under mouse
-f10 : show dev tool
-f11 : fallbacktool : developer tool used for removing static-part-fallback=
s (billboards) for which a model exists (important for combos)
-f12 : take highresscreenshot
-
-freefly cam mode :
--hold left mouse button to look around
--use w,a,s,d,r,f to move cam
-
-to set macros and edit keybinds, edit data/mymacros.lua
-
-=3D=3D command line switches (mainly for debug) =3D=3D
--c 								: shows console window under win32
--g path/to/grannyfile.grn		: prints granny dump
--gb path/to/grannyfile.grn		: prints granny bone info
--so 							: start in offline mode
--jt 							: journal-test (in mainmenu)
--mt 							: macrolist-test (in mainmenu)
-
-=3D=3D=3D debug mode =3D=3D=3D
-a : show first model and anim =

-
-f : param1 -=3D 1 (one model back)
-g : param1 +=3D 1 (one model ffw)
-j : param2 -=3D 1 (one anim back)
-k : param2 +=3D 1 (one anim ffw)
-
-f1 : switch to Granny debug mode
-f2 : param1 -=3D 64
-f3 : param1 +=3D 64
-f4 : param1 -=3D 4096
-f5 : param1 +=3D 4096
-f6 : open art-overview
-
-=3D=3D=3D=3D granny debug mode =3D=3D=3D=3D
-
-param1 : modelid
-param2 : animid
-
-=3D=3D=3D=3D static debug mode =3D=3D=3D=3D
-
-param1 : modelid
-param2 : hueid
-t : svn rm GetModelPath(gDebugMenuModelIndex)  BE CAREFUL WITH THAT; must =
be activated in code
-b : note current model in debugstatic.txt
-holding shift while changing param1 makes skips all meshes with MORE than =
6 triangles and empty meshes =

-	(this is for searching and destroying billboard-like models)
-	(careful with big changes to param1, will be slow, skipping tries to load=
 all meshes in between)
-
-=3D=3D=3D 2d-Renderer and data =3D=3D=3D
-the 2DRenderer is only available as compiled .luac file, =

-it is a optional closed source plugin that is not statically linked, =

-if you don't want it, you can delete the .luac file.
-(note : it will probably be opensourced soon)
-
-there is currently no license for the models and textures in the data dir,
-they have been created by the iris1 team for use with the iris project.
-We are in the progress of replacing them with new art that will be made av=
ailable =

-under a creative commons license like by-nc-sa or something similar.
-
-=3D=3D=3D svn-ignore =3D=3D=3D
-to filter out uninteresting files under linux call "svn propset svn:ignore=
 -F svnignore . include/ src/"
-
-to compile under win you probably need the servicepack 1 for visual studio
-
-=3D=3D=3D code documentation =3D=3D=3D
-doxygen syntax has been used, might be interesting to generate documentati=
on from the sourcecode
-
-http://www.zwischenwelt.org/~hagish/irisdocs/doc/html/
-
-=3D=3D developer =3D=3D
-Florian Fischer (SiENcE) =

-Robert Noll (Ghoulsblade) =

-Sebastian Dorda (hagish)
-R=C3=BCdiger Pakmor (Varan)
-
-=3D=3D=3D other projects of the iris-ogre-developers =3D=3D=3D
-http://schattenkind.net/		- Our mainsite (a Game developer association)
-http://www.iris2.de/			- Iris Website
-http://sfz.sourceforge.net/		- Stressfree Zone (space game)
-http://lugre.sourceforge.net	- Lugre	(middelware for Ogre3D, Lua, Fmod, Op=
enAL, ODE, Boost)
-
-=3D=3D=3D license =3D=3D=3D
-see COPYING for license of our code
-
-further take a look here:
-FMOD Sound System, copyright =C2=A9 Firelight Technologies Pty, Ltd., 1994=
-2007.
-http://www.fmod.org/index.php/sales
-
-Ogre3D see: README.ogre
-
-TinyXML see: README.tinyxml
+Iris2, Copyright (C) 2006 - 2007 Iris Team
+__________________________________________
+
+Iris2 is a 3D/2D game client for Online Role Playing Game "Ultima Online" =
(tm)
+using the Ogre 3D-Engine.
+
+Iris Installation (Step 1-4):
+1. You need a legal copy of Ultima Online to use Iris2.
+   Supported Ultima Online expansions:
+	- Age of Shadows
+	- Samurai Empire and Gold Trial  (SE =3D=3D Gold)
+	- Mondain's Legacy
+	- or later.
+
+2. Install and run Ultima Online and patch it to the newest Version.
+
+3. Run Iris2_Setup.exe
+
+4. Install Visual Studio 8 Sp1 redistributional (done during Setup)
+
+5. Run the Iris2 updater.exe
+
+=3D=3D Iris on Linux =3D=3D
+
+for linux install see the file named INSTALL =

+
+=3D=3D How to get Ultima Online data =3D=3D
+
+Get Ultima Online Mondain's Legacy :
+http://www.download.com/Ultima-Online-Mondain-s-Legacy-client/3000-7541_4-=
10432238.html
+http://games.mirrors.tds.net/pub/ea-games/uo/uoml_setup.exe
+http://www.fileplanet.com/156570/150000/fileinfo/Ultima-Online:-Mondain%5C=
's-Legacy-Client
+
+
+INSTALL SEE
+http://iris2.de/index.php/InstallationManual		(English)
+http://iris2.de/index.php/Installations_Anleitung	(deutsch)
+
+=3D=3D controls =3D=3D
+arrow keys for moving the player
+u : walk to targetted position
+
+n	: toggle compass
+,&. : zoom compass
+
+mousebutton middle : rotate camera
+mousebutton left+right : rotate camera
+mousewheel up	: zoom camera
+mousewheel down : zoom camera
+
+return	: activate or send chatline
+space	: run to and attack selected mobile
+q	: select neares mobile
+e	: select next mobile
+tab : toggle warmode
+l	: hold to show iris logo
+r	: say "vendor buy" (opens buymenus of nearby traders on most servers)
+c	: toggle cam mode (freefly,ego,3rdperson)
+x,z : zoom camera
+t	: toggle Stats
+k	: toggle Skills
+j	: toggle journal
+b	: toggle backpack
+p	: toggle paperdoll
+y	: toogle renderer 2D/3D
+v	: take a screenshot, saved to screenshots/iris*.jpg , where * is timesta=
mp
+g	: repeat last chatline
+h	: repeat last doubleclick
+
+shift-click : simulates doubleclick (temporary, helpful for low framerates)
+
+f6 : in offline mode : teleport to position under mouse
+f10 : show dev tool
+f11 : fallbacktool : developer tool used for removing static-part-fallback=
s (billboards) for which a model exists (important for combos)
+f12 : take highresscreenshot
+
+freefly cam mode :
+-hold left mouse button to look around
+-use w,a,s,d,r,f to move cam
+
+to set macros and edit keybinds, edit data/mymacros.lua
+
+=3D=3D command line switches (mainly for debug) =3D=3D
+-c 								: shows console window under win32
+-g path/to/grannyfile.grn		: prints granny dump
+-gb path/to/grannyfile.grn		: prints granny bone info
+-so 							: start in offline mode
+-jt 							: journal-test (in mainmenu)
+-mt 							: macrolist-test (in mainmenu)
+
+=3D=3D=3D debug mode =3D=3D=3D
+a : show first model and anim =

+
+f : param1 -=3D 1 (one model back)
+g : param1 +=3D 1 (one model ffw)
+j : param2 -=3D 1 (one anim back)
+k : param2 +=3D 1 (one anim ffw)
+
+f1 : switch to Granny debug mode
+f2 : param1 -=3D 64
+f3 : param1 +=3D 64
+f4 : param1 -=3D 4096
+f5 : param1 +=3D 4096
+f6 : open art-overview
+
+=3D=3D=3D=3D granny debug mode =3D=3D=3D=3D
+
+param1 : modelid
+param2 : animid
+
+=3D=3D=3D=3D static debug mode =3D=3D=3D=3D
+
+param1 : modelid
+param2 : hueid
+t : svn rm GetModelPath(gDebugMenuModelIndex)  BE CAREFUL WITH THAT; must =
be activated in code
+b : note current model in debugstatic.txt
+holding shift while changing param1 makes skips all meshes with MORE than =
6 triangles and empty meshes =

+	(this is for searching and destroying billboard-like models)
+	(careful with big changes to param1, will be slow, skipping tries to load=
 all meshes in between)
+
+=3D=3D=3D 2d-Renderer and data =3D=3D=3D
+the 2DRenderer is only available as compiled .luac file, =

+it is a optional closed source plugin that is not statically linked, =

+if you don't want it, you can delete the .luac file.
+(note : it will probably be opensourced soon)
+
+there is currently no license for the models and textures in the data dir,
+they have been created by the iris1 team for use with the iris project.
+We are in the progress of replacing them with new art that will be made av=
ailable =

+under a creative commons license like by-nc-sa or something similar.
+
+=3D=3D=3D svn-ignore =3D=3D=3D
+to filter out uninteresting files under linux call "svn propset svn:ignore=
 -F svnignore . include/ src/"
+
+to compile under win you probably need the servicepack 1 for visual studio
+
+=3D=3D=3D code documentation =3D=3D=3D
+doxygen syntax has been used, might be interesting to generate documentati=
on from the sourcecode
+
+http://www.zwischenwelt.org/~hagish/irisdocs/doc/html/
+
+=3D=3D developer =3D=3D
+Florian Fischer (SiENcE) =

+Robert Noll (Ghoulsblade) =

+Sebastian Dorda (hagish)
+R=C3=BCdiger Pakmor (Varan)
+
+=3D=3D=3D other projects of the iris-ogre-developers =3D=3D=3D
+http://schattenkind.net/		- Our mainsite (a Game developer association)
+http://www.iris2.de/			- Iris Website
+http://sfz.sourceforge.net/		- Stressfree Zone (space game)
+http://lugre.sourceforge.net	- Lugre	(middelware for Ogre3D, Lua, Fmod, Op=
enAL, ODE, Boost)
+
+=3D=3D=3D license =3D=3D=3D
+see COPYING for license of our code
+
+further take a look here:
+FMOD Sound System, copyright =C2=A9 Firelight Technologies Pty, Ltd., 1994=
-2007.
+http://www.fmod.org/index.php/sales
+
+Ogre3D see: README.ogre
+
+TinyXML see: README.tinyxml

Modified: trunk/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.static.lua (original)
+++ trunk/lua/lib.static.lua Sun Jan 20 00:12:25 2008
@@ -1,56 +1,5 @@
 -- used by lib.map.lua
 -- handles static models (walls, trees...)
-
---[[
--- currently not used by function MeshIsPseudoBillBoard
-gHasModelOnlyOneUoArtCache =3D {}
-function HasModelOnlyOneUoArt_Cached (iTileTypeID)
-	local res =3D gHasModelOnlyOneUoArtCache[iTileTypeID]
-	if (res ~=3D nil) then return res end
-	res =3D HasModelOnlyOneUoArt(iTileTypeID)
-	gHasModelOnlyOneUoArtCache[iTileTypeID] =3D res
-	return res
-end
-
--- currently not used : calculates, if a *.mesh is a simple billboard
-function MeshIsPseudoBillBoard (iTranslatedTileTypeID) =

-	local i =3D iTranslatedTileTypeID
-	local meshname =3D GetStaticMeshName(i)
-	return CountMeshTriangles(meshname) < 4 and HasModelOnlyOneUoArt_Cached(i=
) -- hagish
-	--return CountMeshTriangles(meshname) <=3D 2 and HasModelOnlyOneUoArt_Cac=
hed(i) -- ghouly
-end
-
--- returns true if the model has only one different material that is a uoa=
rt
-function HasModelOnlyOneUoArt (iTileTypeID)
-	local uoarts =3D {}
-
-	local path =3D GetModelPath(iTileTypeID)
-	local t =3D OgreMeshTextures(path) -- datapath.."models/models/mesh/"..me=
shname)
-	for k,v in pairs(t) do =

-		if gManualArtMaterialLoader:IsMatching(v) then =

-			-- uo art found
-			-- mark material as found
-			--print("found uoart",v)
-			uoarts[v] =3D 1
-		else
-			-- non uo art
-			return false
-		end
-	end
-	=

-	local count =3D 0
-	-- count number of different uo arts
-	for k,v in pairs(uoarts) do
-		count =3D count + 1
-	end
-	=

-	if count <=3D 1 then =

-		return true =

-	else =

-		return false =

-	end
-end
-]]--
 =

 -- returns the model name with the given id
 -- TODO handle custom stuff?
@@ -109,20 +58,6 @@
 				-- load Mesh here
 				if ( OgreMeshAvailable(meshname) ) then
 					printdebug("static","Meshloader:",iTranslatedTileTypeID,iHue,meshname)
---[[
-					-- create unavailable uo_art material
-					if (gArtMapLoader and gManualArtMaterialLoader) then
-						local t =3D OgreLoadedMeshTextures(meshname)
-						for k,v in pairs(t) do
-							printdebug("static","Meshloader : texture found",v)
-							gManualArtMaterialLoader:CreateMatchingIfUnavailable(v)
-						end
-					else
-						meshname =3D false
-						-- set false, if no ui_art material can be created
-						printdebug("static",sprintf("mesh cannot be loaded -> temp. disabled=
 (false) meshname=3D%s iTranslatedTileTypeID=3D%d",meshname, iTranslatedTil=
eTypeID))
-					end
-]]--
 				else
 					meshname =3D false
 					printdebug("static","mesh cannot be loaded -> temp. disabled (false) =
",meshname, iTranslatedTileTypeID)



From no-reply at zwischenwelt.org  Sun Jan 20 00:25:56 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 23:25:56 -0000
Subject: [Iris-commit] [IRIS] r1801 - in /trunk: data/models/atlas/
	data/models/models/ lua/
Message-ID: <20080120000013.1DD331C181B1@zwischenwelt.org>

Author: hagish
Date: Sun Jan 20 00:25:56 2008
New Revision: 1801

Log:
rename GetStaticMeshName to GetMeshName

Added:
    trunk/data/models/atlas/tex_atlas_2048_2048.lua
    trunk/data/models/atlas/tex_atlas_2048_2048.material
    trunk/data/models/atlas/tex_atlas_2048_20480.png   (with props)
    trunk/data/models/atlas/tex_atlas_2048_20481.png   (with props)
    trunk/data/models/atlas/tex_atlas_2048_20482.png   (with props)
    trunk/data/models/atlas/tex_atlas_2048_64.lua
    trunk/data/models/atlas/tex_atlas_2048_64.material
    trunk/data/models/atlas/tex_atlas_2048_640.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_2048_2048.lua
    trunk/data/models/atlas/tex_atlas_alpha_2048_2048.material
    trunk/data/models/atlas/tex_atlas_alpha_2048_20480.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_2048_20481.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_2048_64.lua
    trunk/data/models/atlas/tex_atlas_alpha_2048_64.material
    trunk/data/models/atlas/tex_atlas_alpha_2048_640.png   (with props)
Removed:
    trunk/data/models/atlas/tex_atlas_2048_128.lua
    trunk/data/models/atlas/tex_atlas_2048_128.material
    trunk/data/models/atlas/tex_atlas_2048_1280.png
    trunk/data/models/atlas/tex_atlas_4096_4096.lua
    trunk/data/models/atlas/tex_atlas_4096_4096.material
    trunk/data/models/atlas/tex_atlas_4096_40960.png
    trunk/data/models/atlas/tex_atlas_alpha_2048_128.lua
    trunk/data/models/atlas/tex_atlas_alpha_2048_128.material
    trunk/data/models/atlas/tex_atlas_alpha_2048_1280.png
    trunk/data/models/atlas/tex_atlas_alpha_4096_4096.lua
    trunk/data/models/atlas/tex_atlas_alpha_4096_4096.material
    trunk/data/models/atlas/tex_atlas_alpha_4096_40960.png
Modified:
    trunk/data/models/models/generate_all.sh
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.3d.renderer.lua
    trunk/lua/lib.debugmenu.lua
    trunk/lua/lib.mainmenu.lua
    trunk/lua/lib.test.lua
    trunk/lua/main.lua

Modified: trunk/data/models/models/generate_all.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_all.sh (original)
+++ trunk/data/models/models/generate_all.sh Sun Jan 20 00:25:56 2008
@@ -11,12 +11,17 @@
 php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_${A=
TLASSIZE}_${TEXSIZE} tex_base_alpha alpha
 # ###################################################
 ATLASSIZE=3D2048
-TEXSIZE=3D128
+TEXSIZE=3D64
 php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_${ATLASSI=
ZE}_${TEXSIZE} tex_base
 php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_${A=
TLASSIZE}_${TEXSIZE} tex_base_alpha alpha
 # ###################################################
-ATLASSIZE=3D4096
-TEXSIZE=3D4096
+ATLASSIZE=3D2048
+TEXSIZE=3D2048
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_${ATLASSI=
ZE}_${TEXSIZE} tex_base
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_${A=
TLASSIZE}_${TEXSIZE} tex_base_alpha alpha
+# ###################################################
+ATLASSIZE=3D256
+TEXSIZE=3D8
 php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_${ATLASSI=
ZE}_${TEXSIZE} tex_base
 php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_${A=
TLASSIZE}_${TEXSIZE} tex_base_alpha alpha
 # ###################################################

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sun Jan 20 00:25:56 2008
@@ -152,7 +152,7 @@
 		end
 	else
 		-- normal 1 part object
-		local meshname =3D (not gForceFallBackBillboards_Dynamics) and GetStatic=
MeshName(item.artid) -- ,item.hue)
+		local meshname =3D (not gForceFallBackBillboards_Dynamics) and GetMeshNa=
me(item.artid) -- ,item.hue)
 		item.meshname =3D meshname
 		item.meshname =3D meshname
 		-- print("DEBUG","meshname",item.meshname)

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sun Jan 20 00:25:56 2008
@@ -214,7 +214,7 @@
 		staticwatertile =3D not gEnableMultiTexTerrain		--on multitexturing filt=
er static water
 	end
 =

-	local meshname =3D (not gForceFallBackBillboards_Statics) and staticwater=
tile and GetStaticMeshName(iTileTypeID,entity.iHue)
+	local meshname =3D (not gForceFallBackBillboards_Statics) and staticwater=
tile and GetMeshName(iTileTypeID,entity.iHue)
 =

 	-- create Mesh
 	if (meshname and meshname ~=3D false) then 	--and (not MeshIsPseudoBillBo=
ard(iTileTypeID))) then	--currently disabled

Modified: trunk/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.renderer.lua (original)
+++ trunk/lua/lib.3d.renderer.lua Sun Jan 20 00:25:56 2008
@@ -205,7 +205,7 @@
 =

 -- Hued Effect : to display Meshes as instant Effects
 function Renderer3D:AddHuedEffect( effect, relx, rely, relz )
-	local meshname =3D GetStaticMeshName(effect.itemid,effect.hue)
+	local meshname =3D GetMeshName(effect.itemid,effect.hue)
 	if (meshname and meshname ~=3D false) then
 		effect.gfx =3D CreateRootGfx3D()
 		effect.gfx:SetMesh(meshname)

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Sun Jan 20 00:25:56 2008
@@ -567,7 +567,7 @@
 		local iTileType =3D gDebugMenuModelIndex
 		local iHue =3D gDebugMenuAnimIndex
 		local info =3D GetStaticTileType(iTileType)
-		local meshname =3D GetStaticMeshName(iTileType,iHue)
+		local meshname =3D GetMeshName(iTileType,iHue)
 		local tricount =3D meshname and CountMeshTriangles(meshname) or 0
 		AddFadeLines(sprintf("static %04x(=3D%d) hue=3D%d tricount=3D%d %s",iTil=
eType,iTileType,iHue,tricount,GetStaticTileTypeName(iTileType) or ""))
 		if (meshname and meshname ~=3D false) then
@@ -602,10 +602,10 @@
 			local tries =3D 400
 			local add =3D (delta > 0) and 1 or -1
 			newval =3D newval + add
-			local meshname =3D GetStaticMeshName(newval,0)
+			local meshname =3D GetMeshName(newval,0)
 			while (tries > 0 and ((not meshname) or (CountMeshTriangles(meshname) >=
 6))) do
 				newval =3D newval + add
-				meshname =3D GetStaticMeshName(newval,0)
+				meshname =3D GetMeshName(newval,0)
 				tries =3D tries - 1
 			end =

 		end
@@ -616,6 +616,13 @@
 end
 =

 function StartDebugMenu ()
+	-- parse command line args
+	if gCommandLineSwitches["-artid"] then
+		local id =3D gCommandLineArguments[gCommandLineSwitches["-artid"]+1]
+		gCurDebugMode =3D kDebugMode_Static
+		gDebugMenuModelIndex =3D id
+	end
+
 	--CrashSegFault() -- testing =3DD
 	gStartInDebugMode =3D true
 	gDebugMenuRunning =3D true

Modified: trunk/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.lua (original)
+++ trunk/lua/lib.mainmenu.lua Sun Jan 20 00:25:56 2008
@@ -278,6 +278,7 @@
 	if (gCommandLineSwitches["-jt"]) then ToggleJournal() return end -- journ=
altest
 	if (gCommandLineSwitches["-mt"]) then ToggleMacroList() return end -- mac=
rolist-test
 	if (gCommandLineSwitches["-so"]) then StartOfflineMode() return end -- st=
art in offline mode
+	if (gCommandLineSwitches["-sd"]) then StartDebugMenu() return end -- star=
t in debug mode
 =

 	-- start menu sound
 	SoundPlayMusicById(8)

Modified: trunk/lua/lib.test.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.test.lua (original)
+++ trunk/lua/lib.test.lua Sun Jan 20 00:25:56 2008
@@ -121,7 +121,7 @@
 		--polycount =3D gLegacyModelAndTextureLoader:GetMeshPolyCount(obj.typeid)
 =

 --		print("obj.typeid: "..obj.typeid)
---		local meshname =3D GetStaticMeshName(obj.typeid,0)
+--		local meshname =3D GetMeshName(obj.typeid,0)
 --		if (meshname and meshname ~=3D false) then polycount =3D CountMeshTria=
ngles(meshname) end
 		if (polycount < 1) then =

 			print(obj.amount,sprintf("0x%04x",obj.typeid),obj.typeid,obj.typeobj.ms=
Name,polycount)

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sun Jan 20 00:25:56 2008
@@ -175,6 +175,7 @@
 	OgreAddResLoc(mydatapath..gModelPath_Tex				,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."models/programs"				,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."models/atlas"				,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."models/"						,"FileSystem","General")
 	--~ OgreAddResLoc(mydatapath.."models/models"				,"FileSystem","General")
 	OgreAddResLoc(mydatapath..gModelPath_Mesh				,"FileSystem","General")
 =

@@ -182,6 +183,7 @@
 	OgreAddResLoc(mydatapath.."custom/materials"			,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."custom/meta"					,"FileSystem","General")
 	for i=3D1,20 do OgreAddResLoc(mydatapath..sprintf("custom/models/to_%03d0=
00",i)	,"FileSystem","General") end
+	OgreAddResLoc(mydatapath.."custom/models"				,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."custom/programs"				,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."custom/textures"				,"FileSystem","General")
 =

@@ -283,19 +285,13 @@
 	-- set global shadow settings
 	if (gShadowTechnique ~=3D "none") then
 		OgreShadowTechnique(gShadowTechnique)
-		OgreSetShadowFarDistance(gSightRange*18.0)
-
 		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique =
=3D=3D "texture_additive")) then
 			OgreSetShadowTextureSize(2048)
 			OgreSetShadowTextureSelfShadow(false)
-		end
-
-		if (gShadowTechnique =3D=3D "texture_additive_integrated") then
-			OgreSetShadowCasterRenderBackFaces(false)
-			OgreSetShadowTextureCasterMaterial("Ogre/DepthShadowmap/Caster/Float")
-			--OgreSetShadowTextureReceiverMaterial("Ogre/DepthShadowmap/BasicTempla=
teMaterial")
-			OgreSetShadowTextureSettings(2048, 3, PF_FLOAT32_R)
-			OgreSetShadowTextureSelfShadow(false)
+			--OgreSetShadowTextureCasterMaterial(matname)
+			--OgreSetShadowTextureReceiverMaterial(matname)
+			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --only for accuracy
+			OgreSetShadowFarDistance(gSightRange*18.0)
 		end
 	end
 =

@@ -312,12 +308,12 @@
 	-- TODO move to config or automatic best choosing
 	if gAtlasRes =3D=3D "high" then
 		---- high res
-		dofile(datapath .. "models/atlas/tex_atlas_alpha_4096_4096.lua")
-		dofile(datapath .. "models/atlas/tex_atlas_4096_4096.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_2048_2048.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_2048_2048.lua")
 	elseif gAtlasRes =3D=3D "med" then
 		---- med res
-		dofile(datapath .. "models/atlas/tex_atlas_alpha_2048_128.lua")
-		dofile(datapath .. "models/atlas/tex_atlas_2048_128.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_2048_64.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_2048_64.lua")
 	elseif gAtlasRes =3D=3D "low" then
 		---- low res
 		dofile(datapath .. "models/atlas/tex_atlas_alpha_512_32.lua")



From no-reply at zwischenwelt.org  Sun Jan 20 00:26:26 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Jan 2008 23:26:26 -0000
Subject: [Iris-commit] [IRIS] r1802 - /trunk/README
Message-ID: <20080120000013.1F6BC1C181B5@zwischenwelt.org>

Author: hagish
Date: Sun Jan 20 00:26:25 2008
New Revision: 1802

Log:
updated readme

Modified:
    trunk/README

Modified: trunk/README
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/README (original)
+++ trunk/README Sun Jan 20 00:26:25 2008
@@ -87,6 +87,8 @@
 -so 							: start in offline mode
 -jt 							: journal-test (in mainmenu)
 -mt 							: macrolist-test (in mainmenu)
+-sd								: start in debug mode
+-sd -artid ARTID_INT			: start in debug mode and show the given artid (art=
id is given as int number not hex!!!!)
 =

 =3D=3D=3D debug mode =3D=3D=3D
 a : show first model and anim =




From no-reply at zwischenwelt.org  Sun Jan 20 01:02:11 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 00:02:11 -0000
Subject: [Iris-commit] [IRIS] r1803 - /trunk/lua/lib.static.lua
Message-ID: <20080120000212.1540E1C181A3@zwischenwelt.org>

Author: hagish
Date: Sun Jan 20 01:02:08 2008
New Revision: 1803

Log:
forgot to rename

Modified:
    trunk/lua/lib.static.lua

Modified: trunk/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.static.lua (original)
+++ trunk/lua/lib.static.lua Sun Jan 20 01:02:08 2008
@@ -16,7 +16,7 @@
 	local base =3D id - math.mod(id,1000) + 1000
 	local relpath  =3D sprintf("models/to_%06d/",base)
 =

-	local custompath =3D datapath.."custom/"..relpath..GetModelName(id)
+	local custompath =3D datapath.."custom/"..GetModelName(id)
 	if file_exists(custompath) then
 		gCustomModelCache[id] =3D custompath
 		return custompath
@@ -35,7 +35,7 @@
 -- generates or retrieves meshname for static model
 -- TODO : not flexible enough, what if model should be skipped, or multipl=
e models set ? or model depending on surrounding ?
 gLegacyModelCache =3D {}
-function GetStaticMeshName (iTileTypeID,iHue)
+function GetMeshName (iTileTypeID,iHue)
 	-- hue default value is 0
 	iHue =3D tonumber(iHue) or 0
 	--1st: Seasonal Translation
@@ -109,6 +109,6 @@
 -- TODO: Wrong !!! hueing must be taken from statics instead of tiledata
 function PreloadAllStaticMesh()
 	for i =3D 0,16085 do
-		GetStaticMeshName(i)
+		GetMeshName(i)
 	end
 end



From no-reply at zwischenwelt.org  Sun Jan 20 02:11:06 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 01:11:06 -0000
Subject: [Iris-commit] [IRIS] r1804 - in /trunk: lua/lib.bodygfx.lua
 lua/lib.granny.lua lua/lib.uoids.lua twohandnotes.txt
Message-ID: <20080120011107.3E71C1C1872A@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan 20 02:11:05 2008
New Revision: 1804

Log:
fixed shield and twohanded weapon hand-position

Added:
    trunk/twohandnotes.txt
Modified:
    trunk/lua/lib.bodygfx.lua
    trunk/lua/lib.granny.lua
    trunk/lua/lib.uoids.lua

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Sun Jan 20 02:11:05 2008
@@ -230,19 +230,9 @@
 					local hue =3D item.hue or 0
 					table.insert(modelidarr,{hue=3Dhue,modelid=3Dmodelid})
 					=

-					--local bShieldHand=3Dfalse
-					-- check for shields (if wearable -> take quality as layer) (stupid)
-					--if (TestBit(tiledata.miFlags,kTileDataFlag_Wearable)) then
-						--print("QualityLayer=3D"..tiledata.miQuality.." "..tiledata.msName)
-					--	bShieldHand=3Dtrue
-					--end
-					=

-					local bDoubleHanded =3D (layer =3D=3D kLayer_TwoHanded) and TestBit(t=
iledata.miFlags,kTileDataFlag_Weapon)
-					if (layer =3D=3D kLayer_OneHanded or bDoubleHanded) then =

-						iPrimaryHandItem =3D {hue=3Dhue,modelid=3Dmodelid}
-					elseif (layer =3D=3D kLayer_TwoHanded) then =

-						iSecondaryHandItem =3D {hue=3Dhue,modelid=3Dmodelid} =

-					end
+					local hand =3D GetGrannyHand(modelid)
+					if (hand =3D=3D 1) then iPrimaryHandItem	=3D {hue=3Dhue,modelid=3Dmod=
elid} end
+					if (hand =3D=3D 2) then iSecondaryHandItem	=3D {hue=3Dhue,modelid=3Dm=
odelid} end
 				end -- TODO : tiledata.miHue
 			end
 		end
@@ -286,6 +276,7 @@
 =

 -- creates childnodes of parentgfx and adds inserts them into the partsarr=
 table
 function CreateBodyGfxPartsFromModelIDArray (bodyid,parentgfx,partsarr,mod=
elidarr,iPrimaryHandItem,iSecondaryHandItem)
+	print("CreateBodyGfxPartsFromModelIDArray",iPrimaryHandItem,iPrimaryHandI=
tem and iPrimaryHandItem.modelid,iSecondaryHandItem,iSecondaryHandItem and =
iSecondaryHandItem.modelid)
 	if (not gGrannyLoaderType) then return end
 	local override_meshname =3D GrannyMeshOverride(bodyid)
 	local skeleton_name
@@ -454,13 +445,26 @@
 	end
 end
 =

+-- 1 for primary, 2 for secondary, 0 otherwise
+function GetGrannyHand (modelid)
+	local modelinfo =3D GetGrannyModelInfo(modelid)
+	return modelinfo and modelinfo.hand or 0
+end
+
 function gBodyGfxPrototype:CalcStateAnim	()
 	local bodyid =3D self:GetBodyID()
 	=

 	-- detect animation modifiers : staff, mount=3Dhorse, combat, run
 	local mount		=3D self:GetEquipmentAtLayer(kLayer_Mount)
-	local twohand	=3D self:GetEquipmentAtLayer(kLayer_TwoHanded) -- staff
-	local bHasStaff =3D twohand and TestBit(GetStaticTileTypeFlags(twohand.ar=
tid) or 0,kTileDataFlag_Weapon)
+	=

+	local twohand	=3D self:GetEquipmentAtLayer(kLayer_TwoHanded) -- staff or =
shield/staff...
+	local bHasStaff =3D false
+	if (twohand) then
+		local tiledata =3D GetStaticTileType(twohand.artid or 0)
+		local modelid =3D twohand.animid or (tiledata and tiledata.miAnimID)
+		if (GetGrannyHand(modelid) =3D=3D 2) then bHasStaff =3D true end
+	end
+	=

 	=

 	local bIdle	=3D (not self.bTurning) and (not self.bMoving)
 	local bRun	=3D (not bIdle) and (self.bRunFlag and self.bMoving)
@@ -468,4 +472,3 @@
 	=

 	return BodyGfxGetStateAnimID(bodyid,bWalk,bRun,bIdle,mount,self.bWarMode,=
bHasStaff)
 end
-

Modified: trunk/lua/lib.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.lua (original)
+++ trunk/lua/lib.granny.lua Sun Jan 20 02:11:05 2008
@@ -335,7 +335,7 @@
 =

 function LoadGrannyModelInfo (filepath) =

 	local grannymodelinfo =3D {}
-	local fieldnames =3D {"bodyid","typeid","animid","defhue","unused","scale=
x","scaley","scalez","modelname"}
+	local fieldnames =3D {"bodyid","typeid","animid","defhue","hand","scalex"=
,"scaley","scalez","modelname"}
 	for line in io.lines(filepath) do
 		line =3D TrimNewLines(line)
 		if (string.sub(line,1,1) ~=3D "#") then
@@ -364,7 +364,7 @@
 						print("  ",vardump(info))
 					end
 				end
-				if ((not oldinfo) or info.unused <=3D oldinfo.unused) then
+				if ((not oldinfo) or info.hand <=3D oldinfo.hand) then
 					grannymodelinfo[info.bodyid] =3D info =

 				end
 			end

Modified: trunk/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoids.lua (original)
+++ trunk/lua/lib.uoids.lua Sun Jan 20 02:11:05 2008
@@ -108,7 +108,7 @@
 =

 -- Tiledata Flags
 kTileDataFlag_Background		=3D hex2num("0x00000001")
-kTileDataFlag_Weapon			=3D hex2num("0x00000002")
+kTileDataFlag_Weapon			=3D hex2num("0x00000002") -- set for weapons AND sh=
ields (7035)
 kTileDataFlag_Transparent		=3D hex2num("0x00000004")
 kTileDataFlag_Translucent		=3D hex2num("0x00000008")
 kTileDataFlag_Wall				=3D hex2num("0x00000010")



From no-reply at zwischenwelt.org  Sun Jan 20 02:46:20 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 01:46:20 -0000
Subject: [Iris-commit] [IRIS] r1805 - in /trunk: data/models/atlas/
 data/models/materials/ data/models/models/ data/models/models/to_003000/
 data/models/models/to_004000/ data/models/textures/ lua/ lua/filter/
Message-ID: <20080120014620.4918F1C1872A@zwischenwelt.org>

Author: hagish
Date: Sun Jan 20 02:46:19 2008
New Revision: 1805

Log:
new models and new atlas

Added:
    trunk/data/models/atlas/tex_atlas_alpha_high.lua
    trunk/data/models/atlas/tex_atlas_alpha_high.material
    trunk/data/models/atlas/tex_atlas_alpha_high0.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_high1.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_high10.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_high2.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_high3.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_high4.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_high5.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_high6.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_high7.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_high8.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_high9.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_low.lua
    trunk/data/models/atlas/tex_atlas_alpha_low.material
    trunk/data/models/atlas/tex_atlas_alpha_low0.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_med.lua
    trunk/data/models/atlas/tex_atlas_alpha_med.material
    trunk/data/models/atlas/tex_atlas_alpha_med0.png   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_ultralow.lua
    trunk/data/models/atlas/tex_atlas_alpha_ultralow.material
    trunk/data/models/atlas/tex_atlas_alpha_ultralow0.png   (with props)
    trunk/data/models/atlas/tex_atlas_high.lua
    trunk/data/models/atlas/tex_atlas_high.material
    trunk/data/models/atlas/tex_atlas_high0.png   (with props)
    trunk/data/models/atlas/tex_atlas_high1.png   (with props)
    trunk/data/models/atlas/tex_atlas_high10.png   (with props)
    trunk/data/models/atlas/tex_atlas_high11.png   (with props)
    trunk/data/models/atlas/tex_atlas_high12.png   (with props)
    trunk/data/models/atlas/tex_atlas_high13.png   (with props)
    trunk/data/models/atlas/tex_atlas_high14.png   (with props)
    trunk/data/models/atlas/tex_atlas_high15.png   (with props)
    trunk/data/models/atlas/tex_atlas_high2.png   (with props)
    trunk/data/models/atlas/tex_atlas_high3.png   (with props)
    trunk/data/models/atlas/tex_atlas_high4.png   (with props)
    trunk/data/models/atlas/tex_atlas_high5.png   (with props)
    trunk/data/models/atlas/tex_atlas_high6.png   (with props)
    trunk/data/models/atlas/tex_atlas_high7.png   (with props)
    trunk/data/models/atlas/tex_atlas_high8.png   (with props)
    trunk/data/models/atlas/tex_atlas_high9.png   (with props)
    trunk/data/models/atlas/tex_atlas_low.lua
    trunk/data/models/atlas/tex_atlas_low.material
    trunk/data/models/atlas/tex_atlas_low0.png   (with props)
    trunk/data/models/atlas/tex_atlas_low1.png   (with props)
    trunk/data/models/atlas/tex_atlas_med.lua
    trunk/data/models/atlas/tex_atlas_med.material
    trunk/data/models/atlas/tex_atlas_med0.png   (with props)
    trunk/data/models/atlas/tex_atlas_med1.png   (with props)
    trunk/data/models/atlas/tex_atlas_ultralow.lua
    trunk/data/models/atlas/tex_atlas_ultralow.material
    trunk/data/models/atlas/tex_atlas_ultralow0.png   (with props)
    trunk/data/models/models/to_003000/mdl_002174.mesh   (with props)
    trunk/data/models/models/to_004000/mdl_003253.mesh   (with props)
    trunk/data/models/models/to_004000/mdl_003274.mesh   (with props)
    trunk/data/models/textures/tex_grass.png   (with props)
    trunk/data/models/textures/tex_mushroom.png   (with props)
Removed:
    trunk/data/models/atlas/tex_atlas_2048_2048.lua
    trunk/data/models/atlas/tex_atlas_2048_2048.material
    trunk/data/models/atlas/tex_atlas_2048_20480.png
    trunk/data/models/atlas/tex_atlas_2048_20481.png
    trunk/data/models/atlas/tex_atlas_2048_20482.png
    trunk/data/models/atlas/tex_atlas_2048_64.lua
    trunk/data/models/atlas/tex_atlas_2048_64.material
    trunk/data/models/atlas/tex_atlas_2048_640.png
    trunk/data/models/atlas/tex_atlas_256_8.lua
    trunk/data/models/atlas/tex_atlas_256_8.material
    trunk/data/models/atlas/tex_atlas_256_80.png
    trunk/data/models/atlas/tex_atlas_512_32.lua
    trunk/data/models/atlas/tex_atlas_512_32.material
    trunk/data/models/atlas/tex_atlas_512_320.png
    trunk/data/models/atlas/tex_atlas_512_321.png
    trunk/data/models/atlas/tex_atlas_alpha_2048_2048.lua
    trunk/data/models/atlas/tex_atlas_alpha_2048_2048.material
    trunk/data/models/atlas/tex_atlas_alpha_2048_20480.png
    trunk/data/models/atlas/tex_atlas_alpha_2048_20481.png
    trunk/data/models/atlas/tex_atlas_alpha_2048_64.lua
    trunk/data/models/atlas/tex_atlas_alpha_2048_64.material
    trunk/data/models/atlas/tex_atlas_alpha_2048_640.png
    trunk/data/models/atlas/tex_atlas_alpha_256_8.lua
    trunk/data/models/atlas/tex_atlas_alpha_256_8.material
    trunk/data/models/atlas/tex_atlas_alpha_256_80.png
    trunk/data/models/atlas/tex_atlas_alpha_512_32.lua
    trunk/data/models/atlas/tex_atlas_alpha_512_32.material
    trunk/data/models/atlas/tex_atlas_alpha_512_320.png
Modified:
    trunk/data/models/materials/textures.material
    trunk/data/models/models/generate_all.sh
    trunk/lua/filter/filter.art.lua
    trunk/lua/lib.static.lua
    trunk/lua/main.lua

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Sun Jan 20 02:46:19 2008
@@ -8200,3 +8200,31 @@
 		}
 	} =

 }
+
+material tex_grass : tex_base_alpha
+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_grass.png =

+			}	=

+		}
+	} =

+}
+
+material tex_mushroom : tex_base
+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_mushroom.png =

+			}	=

+		}
+	} =

+}

Modified: trunk/data/models/models/generate_all.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_all.sh (original)
+++ trunk/data/models/models/generate_all.sh Sun Jan 20 02:46:19 2008
@@ -5,25 +5,25 @@
 php texture_list.php > xml.txt
 =

 # ###################################################
+ATLASSIZE=3D256
+TEXSIZE=3D8
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_ultralow =
tex_base
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_ult=
ralow tex_base_alpha alpha
+# ###################################################
 ATLASSIZE=3D512
 TEXSIZE=3D32
-php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_${ATLASSI=
ZE}_${TEXSIZE} tex_base
-php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_${A=
TLASSIZE}_${TEXSIZE} tex_base_alpha alpha
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_low tex_b=
ase
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_low=
 tex_base_alpha alpha
 # ###################################################
-ATLASSIZE=3D2048
+ATLASSIZE=3D1024
 TEXSIZE=3D64
-php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_${ATLASSI=
ZE}_${TEXSIZE} tex_base
-php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_${A=
TLASSIZE}_${TEXSIZE} tex_base_alpha alpha
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_med tex_b=
ase
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_med=
 tex_base_alpha alpha
 # ###################################################
-ATLASSIZE=3D2048
-TEXSIZE=3D2048
-php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_${ATLASSI=
ZE}_${TEXSIZE} tex_base
-php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_${A=
TLASSIZE}_${TEXSIZE} tex_base_alpha alpha
-# ###################################################
-ATLASSIZE=3D256
-TEXSIZE=3D8
-php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_${ATLASSI=
ZE}_${TEXSIZE} tex_base
-php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_${A=
TLASSIZE}_${TEXSIZE} tex_base_alpha alpha
+ATLASSIZE=3D1024
+TEXSIZE=3D1024
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_high tex_=
base
+php generate_tex_atlas.php xml.txt $ATLASSIZE $TEXSIZE tex_atlas_alpha_hig=
h tex_base_alpha alpha
 # ###################################################
 =

 mv tex_atlas_* ../atlas

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Sun Jan 20 02:46:19 2008
@@ -90,3 +90,32 @@
 gArtFilter[4653]=3D{maptoid=3D4650}
 gArtFilter[4654]=3D{maptoid=3D4650}
 gArtFilter[4655]=3D{maptoid=3D4650}
+
+--grass
+-- map to 0xcb5 / 3253
+gArtFilter[hex2num("0xcac")]=3D{maptoid=3D3253}
+gArtFilter[hex2num("0xcad")]=3D{maptoid=3D3253}
+gArtFilter[hex2num("0xcae")]=3D{maptoid=3D3253}
+gArtFilter[hex2num("0xcaf")]=3D{maptoid=3D3253}
+gArtFilter[hex2num("0xcb0")]=3D{maptoid=3D3253}
+gArtFilter[hex2num("0xcb1")]=3D{maptoid=3D3253}
+gArtFilter[hex2num("0xcb2")]=3D{maptoid=3D3253}
+gArtFilter[hex2num("0xcb3")]=3D{maptoid=3D3253}
+gArtFilter[hex2num("0xcb4")]=3D{maptoid=3D3253}
+gArtFilter[hex2num("0xcb6")]=3D{maptoid=3D3253}
+
+-- barks
+-- map to 3274
+gArtFilter[3275]=3D{maptoid=3D3274}
+gArtFilter[3276]=3D{maptoid=3D3274}
+gArtFilter[3277]=3D{maptoid=3D3274}
+gArtFilter[3280]=3D{maptoid=3D3274}
+gArtFilter[3283]=3D{maptoid=3D3274}
+gArtFilter[3290]=3D{maptoid=3D3274}
+gArtFilter[3299]=3D{maptoid=3D3274}
+gArtFilter[3296]=3D{maptoid=3D3274}
+
+-- mushrooms
+gArtFilter[3352]=3D{maptoid=3D3351}
+gArtFilter[3353]=3D{maptoid=3D3351}
+gArtFilter[3349]=3D{maptoid=3D3350}

Modified: trunk/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.static.lua (original)
+++ trunk/lua/lib.static.lua Sun Jan 20 02:46:19 2008
@@ -16,7 +16,7 @@
 	local base =3D id - math.mod(id,1000) + 1000
 	local relpath  =3D sprintf("models/to_%06d/",base)
 =

-	local custompath =3D datapath.."custom/"..GetModelName(id)
+	local custompath =3D datapath.."custom/models/"..GetModelName(id)
 	if file_exists(custompath) then
 		gCustomModelCache[id] =3D custompath
 		return custompath

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sun Jan 20 02:46:19 2008
@@ -182,7 +182,6 @@
 	--~ # custom models
 	OgreAddResLoc(mydatapath.."custom/materials"			,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."custom/meta"					,"FileSystem","General")
-	for i=3D1,20 do OgreAddResLoc(mydatapath..sprintf("custom/models/to_%03d0=
00",i)	,"FileSystem","General") end
 	OgreAddResLoc(mydatapath.."custom/models"				,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."custom/programs"				,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."custom/textures"				,"FileSystem","General")
@@ -308,21 +307,20 @@
 	-- TODO move to config or automatic best choosing
 	if gAtlasRes =3D=3D "high" then
 		---- high res
-		dofile(datapath .. "models/atlas/tex_atlas_alpha_2048_2048.lua")
-		dofile(datapath .. "models/atlas/tex_atlas_2048_2048.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_high.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_high.lua")
 	elseif gAtlasRes =3D=3D "med" then
 		---- med res
-		dofile(datapath .. "models/atlas/tex_atlas_alpha_2048_64.lua")
-		dofile(datapath .. "models/atlas/tex_atlas_2048_64.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_med.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_med.lua")
 	elseif gAtlasRes =3D=3D "low" then
 		---- low res
-		dofile(datapath .. "models/atlas/tex_atlas_alpha_512_32.lua")
-		dofile(datapath .. "models/atlas/tex_atlas_512_32.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_low.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_low.lua")
 	else
-		print("ULTRA LOW TEXATLAS")
 		---- ultralow res
-		dofile(datapath .. "models/atlas/tex_atlas_alpha_256_8.lua")
-		dofile(datapath .. "models/atlas/tex_atlas_256_8.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_ultralow.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_ultralow.lua")
 	end
 	=

 	-- show loading screen



From no-reply at zwischenwelt.org  Sun Jan 20 03:32:03 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 02:32:03 -0000
Subject: [Iris-commit] [IRIS] r1808 - in
 /trunk/data/models/models/to_004000: mdl_003350.mesh mdl_003351.mesh
Message-ID: <20080120030023.C24141C1872B@zwischenwelt.org>

Author: hagish
Date: Sun Jan 20 03:32:01 2008
New Revision: 1808

Log:
forgot to add models

Added:
    trunk/data/models/models/to_004000/mdl_003350.mesh   (with props)
    trunk/data/models/models/to_004000/mdl_003351.mesh   (with props)



From no-reply at zwischenwelt.org  Sun Jan 20 03:22:23 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 02:22:23 -0000
Subject: [Iris-commit] [IRIS] r1806 - /trunk/lua/filter/filter.map.lua
Message-ID: <20080120030023.7F28F1C1872B@zwischenwelt.org>

Author: sience
Date: Sun Jan 20 03:22:22 2008
New Revision: 1806

Log:
-FilterIsMapWater added

Modified:
    trunk/lua/filter/filter.map.lua

Modified: trunk/lua/filter/filter.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.map.lua (original)
+++ trunk/lua/filter/filter.map.lua Sun Jan 20 03:22:22 2008
@@ -10,6 +10,17 @@
 	return iTranslatedTileTypeID
 end
 =

+-- checks if the given tiletype is a water tile
+function FilterIsMapWater(iTileTypeID)
+	if (((iTileTypeID >=3D 76) and (iTileTypeID <=3D 112)) or
+		((iTileTypeID >=3D 168) and (iTileTypeID <=3D 171)) or
+		((iTileTypeID >=3D 310) and (iTileTypeID <=3D 311)))
+		return true
+	else
+		return false
+	end
+end
+
 --[[
 -- FILTER: Watermaptiles
 gMapFilter[168] =3D {tileid=3D0}
@@ -18,7 +29,6 @@
 gMapFilter[171] =3D {tileid=3D0}
 gMapFilter[310] =3D {tileid=3D0}
 gMapFilter[311] =3D {tileid=3D0}
-]]--
 =

 -- FILTER: Groundmaptiles
 gMapFilter[76] =3D {tileid=3D168}
@@ -58,3 +68,4 @@
 gMapFilter[110] =3D {tileid=3D168}
 gMapFilter[111] =3D {tileid=3D168}
 gMapFilter[112] =3D {tileid=3D168}
+]]--



From no-reply at zwischenwelt.org  Sun Jan 20 03:23:08 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 02:23:08 -0000
Subject: [Iris-commit] [IRIS] r1807 - /trunk/lua/filter/filter.map.lua
Message-ID: <20080120030023.A3A341C180EC@zwischenwelt.org>

Author: sience
Date: Sun Jan 20 03:23:08 2008
New Revision: 1807

Log:
-fix

Modified:
    trunk/lua/filter/filter.map.lua

Modified: trunk/lua/filter/filter.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.map.lua (original)
+++ trunk/lua/filter/filter.map.lua Sun Jan 20 03:23:08 2008
@@ -14,7 +14,7 @@
 function FilterIsMapWater(iTileTypeID)
 	if (((iTileTypeID >=3D 76) and (iTileTypeID <=3D 112)) or
 		((iTileTypeID >=3D 168) and (iTileTypeID <=3D 171)) or
-		((iTileTypeID >=3D 310) and (iTileTypeID <=3D 311)))
+		((iTileTypeID >=3D 310) and (iTileTypeID <=3D 311))) then
 		return true
 	else
 		return false



From no-reply at zwischenwelt.org  Sun Jan 20 04:20:29 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 03:20:29 -0000
Subject: [Iris-commit] [IRIS] r1809 - in /trunk/lua: lib.walking3.lua
	obj/obj.container.lua
Message-ID: <20080120032030.0A6A01C1872A@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan 20 04:20:29 2008
New Revision: 1809

Log:
local var fix, worked a bit on walk3

Modified:
    trunk/lua/lib.walking3.lua
    trunk/lua/obj/obj.container.lua

Modified: trunk/lua/lib.walking3.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.walking3.lua (original)
+++ trunk/lua/lib.walking3.lua Sun Jan 20 04:20:29 2008
@@ -12,6 +12,29 @@
 =

 kHex_4000 =3D hex2num("0x4000")
 kHex_3FFF =3D hex2num("0x3FFF")
+
+kTileFlag =3D {}
+kTileFlag.Wet			=3D kTileDataFlag_Wet
+kTileFlag.Impassable	=3D kTileDataFlag_Impassable
+kTileFlag.Surface		=3D kTileDataFlag_Surface
+kTileFlag.Door			=3D kTileDataFlag_Door
+
+kTileFlag.kImpassableSurface =3D kTileFlag.Impassable + kTileFlag.Surface
+
+kTileData =3D {}
+kTileData.ItemTable =3D {}
+kTileData.LandTable =3D {}
+-- kTileData.ItemTable[BitwiseAND(check.ID,kHex_3FFF)]  .Flags  .Height  .=
CalcHeight  .Bridge
+--~ kTileData.LandTable[BitwiseAND(landTile.ID,kHex_3FFF)]  .Flags
+-- m.CanSwim
+--~ public int CalcHeight : if ( (m_Flags & TileFlag.Bridge) !=3D 0 ) and =
math.floor(m_Height / 2) or m_Height;   RunUO1/src/TileData.cs:153:
+
+
+kPersonHeight				=3D 16
+kStepHeight					=3D 2
+kAlwaysIgnoreDoors			=3D false
+kIgnoreMovableImpassables	=3D false
+
 =

 function ApplyDir (dir,posx,posy) =

 	dir =3D DirWrap(BitwiseAND(dir,7)) -- warp and remove run bit
@@ -32,7 +55,7 @@
 	local xRight	, yRight	=3D xStart,yStart
 	local xLeft		, yLeft		=3D xStart,yStart
 =

-	local checkDiagonals =3D DirisDiagonal(d)
+	local checkDiagonals =3D DirisDiagonal(d) -- see lib.protocol.lua:56:
 =

 	xForward,yForward	=3D ApplyDir( d, xForward,yForward )
 	xLeft,yLeft			=3D ApplyDir( d - 1, xLeft,yLeft )
@@ -48,10 +71,10 @@
 	local itemsRight	=3D {}
 	local items
 =

-	local ignoreMovableImpassables =3D m_IgnoreMovableImpassables -- bool
-	local reqFlags =3D ImpassableSurface -- TileFlag
-
-	if ( m.CanSwim ) then reqFlags =3D BitwiseOR(reqFlags,TileFlag.Wet) end
+	local ignoreMovableImpassables =3D kIgnoreMovableImpassables -- bool
+	local reqFlags =3D kImpassableSurface -- TileFlag
+
+	if ( m.CanSwim ) then reqFlags =3D BitwiseOR(reqFlags,kTileFlag.Wet) end
 =

 	if ( checkDiagonals ) then
 		local sectorStart	=3D map.GetSector( xStart, yStart ) -- Sector
@@ -157,26 +180,12 @@
 end
 =

 =

---[[
-		private const int PersonHeight =3D 16
-		private const int StepHeight =3D 2
-
-		private const TileFlag ImpassableSurface =3D TileFlag.Impassable | TileF=
lag.Surface
-
-		private static bool m_AlwaysIgnoreDoors
-		private static bool m_IgnoreMovableImpassables
-
-		public static bool AlwaysIgnoreDoors{ get{ return m_AlwaysIgnoreDoors } =
set{ m_AlwaysIgnoreDoors =3D value } }
-		public static bool IgnoreMovableImpassables{ get{ return m_IgnoreMovable=
Impassables } set{ m_IgnoreMovableImpassables =3D value } }
-]]--
-
-
-		--~ private bool IsOk( bool ignoreDoors, int ourZ, int ourTop, Tile[] ti=
les, ArrayList items )
+--~ private bool IsOk( bool ignoreDoors, int ourZ, int ourTop, Tile[] tile=
s, ArrayList items )
 function IsOk(  ignoreDoors,  ourZ, ourTop, tiles, items )
 	for i,check in pairs(tiles) do -- Tile
-		local itemData =3D TileData.ItemTable[BitwiseAND(check.ID,kHex_3FFF)] --=
 ItemData
-
-		if ( BitwiseAND(itemData.Flags,ImpassableSurface) ~=3D 0 ) -- Impassable=
 or Surface
+		local itemData =3D kTileData.ItemTable[BitwiseAND(check.ID,kHex_3FFF)] -=
- ItemData
+
+		if ( BitwiseAND(itemData.Flags,kImpassableSurface) ~=3D 0 ) -- Impassabl=
e or Surface
 		then
 			local checkZ =3D check.Z -- int
 			local checkTop =3D checkZ + itemData.CalcHeight -- int
@@ -189,12 +198,12 @@
 =

 	for i,item in pairs(items) do -- Item
 		local itemID =3D BitwiseAND(item.ItemID,kHex_3FFF) -- int
-		local itemData =3D TileData.ItemTable[itemID] -- ItemData
+		local itemData =3D kTileData.ItemTable[itemID] -- ItemData
 		local flags =3D itemData.Flags -- TileFlag
 =

-		if ( BitwiseAND(flags,ImpassableSurface) ~=3D 0 ) -- Impassable or Surfa=
ce
-		then
-			if ( ignoreDoors and (BitwiseAND(flags,TileFlag.Door) ~=3D 0 or =

+		if ( BitwiseAND(flags,kImpassableSurface) ~=3D 0 ) -- Impassable or Surf=
ace
+		then
+			if ( ignoreDoors and (BitwiseAND(flags,kTileFlag.Door) ~=3D 0 or =

 				itemID =3D=3D hex2num("0x692") or =

 				itemID =3D=3D hex2num("0x846") or =

 				itemID =3D=3D hex2num("0x873") or =

@@ -212,20 +221,21 @@
 	return true
 end
 =

+
 --~ private bool Check( Map map, Mobile m, ArrayList items, int x, int y, =
int startTop, int startZ, bool canSwim, bool cantWalk, out int newZ )
 -- returns bla,newZ
 function Check(  map,  m,  items,  x,  y,  startTop,  startZ,  canSwim,  c=
antWalk )
-	newZ =3D 0
+	local newZ =3D 0
 =

 	local tiles =3D map.Tiles.GetStaticTiles( x, y, true ) -- Tile[]
 	local landTile =3D map.Tiles.GetLandTile( x, y ) -- Tile
 =

-	local landBlocks =3D BitwiseAND(TileData.LandTable[BitwiseAND(landTile.ID=
,kHex_3FFF)].Flags,TileFlag.Impassable) ~=3D 0 -- bool
+	local landBlocks =3D BitwiseAND(kTileData.LandTable[BitwiseAND(landTile.I=
D,kHex_3FFF)].Flags,kTileFlag.Impassable) ~=3D 0 -- bool
 	local considerLand =3D not landTile.Ignored -- bool
 =

-	if ( landBlocks and canSwim and BitwiseAND(TileData.LandTable[BitwiseAND(=
landTile.ID,kHex_3FFF)].Flags,TileFlag.Wet) ~=3D 0 ) then
+	if ( landBlocks and canSwim and BitwiseAND(kTileData.LandTable[BitwiseAND=
(landTile.ID,kHex_3FFF)].Flags,kTileFlag.Wet) ~=3D 0 ) then
 		landBlocks =3D false
-	elseif ( cantWalk and BitwiseAND(TileData.LandTable[BitwiseAND(landTile.I=
D,kHex_3FFF)].Flags,TileFlag.Wet) =3D=3D 0 ) then
+	elseif ( cantWalk and BitwiseAND(kTileData.LandTable[BitwiseAND(landTile.=
ID,kHex_3FFF)].Flags,kTileFlag.Wet) =3D=3D 0 ) then
 		landBlocks =3D true
 	end
 =

@@ -233,59 +243,63 @@
 	local landCenter =3D 0, =

 	local landTop =3D 0
 =

-	map.GetAverageZ( x, y, ref landZ, ref landCenter, ref landTop )
+	local landZ,landCenter,landTop =3D map.GetAverageZ( x, y)
 =

 	local moveIsOk =3D false
 =

-	local stepTop =3D startTop + StepHeight
-	local checkTop =3D startZ + PersonHeight
-
-	local ignoreDoors =3D ( m_AlwaysIgnoreDoors or (not m.Alive) or m.Body.Bo=
dyID =3D=3D hex2num("0x3DB") or m.IsDeadBondedPet )
+	local stepTop =3D startTop + kStepHeight
+	local checkTop =3D startZ + kPersonHeight
+
+	local ignoreDoors =3D ( kAlwaysIgnoreDoors or (not m.Alive) or m.Body.Bod=
yID =3D=3D hex2num("0x3DB") or m.IsDeadBondedPet )
 =

 	for i,tile in pairs(tiles) do -- Tile
-		local itemData =3D TileData.ItemTable[BitwiseAND(tile.ID,kHex_3FFF)] -- =
ItemData
+		local itemData =3D kTileData.ItemTable[BitwiseAND(tile.ID,kHex_3FFF)] --=
 ItemData
 		local flags =3D itemData.Flags -- TileFlag
 =

-		if ( BitwiseAND(flags,ImpassableSurface) =3D=3D TileFlag.Surface or (can=
Swim and BitwiseAND(flags , TileFlag.Wet) ~=3D 0) ) -- Surface and (not Imp=
assable)
-		then
-			if ( cantWalk and BitwiseAND(flags , TileFlag.Wet) =3D=3D 0 )
-				continue
-
-			local itemZ =3D tile.Z
-			local itemTop =3D itemZ
-			local ourZ =3D itemZ + itemData.CalcHeight
-			local ourTop =3D ourZ + PersonHeight
-			local testTop =3D checkTop
-
-			if ( moveIsOk )
-			then
-				local cmp =3D Math.Abs( ourZ - m.Z ) - Math.Abs( newZ - m.Z )
-
-				if ( cmp > 0 or (cmp =3D=3D 0 and ourZ > newZ) )
-					continue
-			end
-
-			if ( ourZ + PersonHeight > testTop ) then testTop =3D ourZ + PersonHeig=
ht end
-
-			if ( not itemData.Bridge ) then itemTop +=3D itemData.Height end
-
-			if ( stepTop >=3D itemTop )
-			then
-				local landCheck =3D itemZ
-
-				if ( itemData.Height >=3D StepHeight ) then
-					landCheck +=3D StepHeight
-				else
-					landCheck +=3D itemData.Height
-				end
-
-				if ( considerLand and landCheck < landCenter and landCenter > ourZ and=
 testTop > landZ ) then
-					--continue
-				else
-					if ( IsOk( ignoreDoors, ourZ, testTop, tiles, items ) )
+		if ( BitwiseAND(flags,kImpassableSurface) =3D=3D kTileFlag.Surface or (c=
anSwim and BitwiseAND(flags , kTileFlag.Wet) ~=3D 0) ) -- Surface and (not =
Impassable)
+		then
+			if ( cantWalk and BitwiseAND(flags , kTileFlag.Wet) =3D=3D 0 ) then
+				--continue
+			else
+
+				local itemZ =3D tile.Z
+				local itemTop =3D itemZ
+				local ourZ =3D itemZ + itemData.CalcHeight
+				local ourTop =3D ourZ + kPersonHeight
+				local testTop =3D checkTop
+
+				local bMyContinue =3D false
+				if ( moveIsOk )
+				then
+					local cmp =3D Math.Abs( ourZ - m.Z ) - Math.Abs( newZ - m.Z )
+
+					if ( cmp > 0 or (cmp =3D=3D 0 and ourZ > newZ) ) then bMyContinue =3D=
 true end
+				end
+
+				if (not bMyContinue) then
+					if ( ourZ + kPersonHeight > testTop ) then testTop =3D ourZ + kPerson=
Height end
+
+					if ( not itemData.Bridge ) then itemTop =3D itemTop + itemData.Height=
 end
+
+					if ( stepTop >=3D itemTop )
 					then
-						newZ =3D ourZ
-						moveIsOk =3D true
+						local landCheck =3D itemZ
+
+						if ( itemData.Height >=3D kStepHeight ) then
+							landCheck =3D landCheck + kStepHeight
+						else
+							landCheck =3D landCheck + itemData.Height
+						end
+
+						if ( considerLand and landCheck < landCenter and landCenter > ourZ a=
nd testTop > landZ ) then
+							--continue
+						else
+							if ( IsOk( ignoreDoors, ourZ, testTop, tiles, items ) )
+							then
+								newZ =3D ourZ
+								moveIsOk =3D true
+							end
+						end
 					end
 				end
 			end
@@ -293,49 +307,54 @@
 	end
 =

 	for i,item in pairs(items) do  -- Item
-		local itemData =3D item.ItemData --TileData.ItemTable[BitwiseAND(item.It=
emID , kHex_3FFF)] ItemData
+		local itemData =3D item.ItemData --kTileData.ItemTable[BitwiseAND(item.I=
temID , kHex_3FFF)] ItemData
 		local flags =3D itemData.Flags -- TileFlag
 =

-		if ( BitwiseAND(flags , ImpassableSurface) =3D=3D TileFlag.Surface or (m=
.CanSwim and BitwiseAND(flags , TileFlag.Wet) ~=3D 0) ) -- Surface and (not=
 Impassable)
-		then
-			if ( cantWalk and BitwiseAND(flags , TileFlag.Wet) =3D=3D 0 )
-				continue
-
-			local itemZ =3D item.Z
-			local itemTop =3D itemZ
-			local ourZ =3D itemZ + itemData.CalcHeight
-			local ourTop =3D ourZ + PersonHeight
-			local testTop =3D checkTop
-
-			if ( moveIsOk )
-			then
-				local cmp =3D Math.Abs( ourZ - m.Z ) - Math.Abs( newZ - m.Z )
-
-				if ( cmp > 0 or (cmp =3D=3D 0 and ourZ > newZ) )
-					continue
-			end
-
-			if ( ourZ + PersonHeight > testTop ) then testTop =3D ourZ + PersonHeig=
ht end
-
-			if ( not itemData.Bridge ) then itemTop +=3D itemData.Height end
-
-			if ( stepTop >=3D itemTop )
-			then
-				local landCheck =3D itemZ
-
-				if ( itemData.Height >=3D StepHeight ) then
-					landCheck +=3D StepHeight
-				else
-					landCheck +=3D itemData.Height
-				end
-
-				if ( considerLand and landCheck < landCenter and landCenter > ourZ and=
 testTop > landZ ) then
-					--continue
-				else
-					if ( IsOk( ignoreDoors, ourZ, testTop, tiles, items ) )
+		if ( BitwiseAND(flags , kImpassableSurface) =3D=3D kTileFlag.Surface or =
(m.CanSwim and BitwiseAND(flags , kTileFlag.Wet) ~=3D 0) ) -- Surface and (=
not Impassable)
+		then
+			if ( cantWalk and BitwiseAND(flags , kTileFlag.Wet) =3D=3D 0 ) then
+				--~ continue
+			else
+
+				local itemZ =3D item.Z
+				local itemTop =3D itemZ
+				local ourZ =3D itemZ + itemData.CalcHeight
+				local ourTop =3D ourZ + kPersonHeight
+				local testTop =3D checkTop
+
+				local bMyContinue =3D false
+				=

+				if ( moveIsOk )
+				then
+					local cmp =3D Math.Abs( ourZ - m.Z ) - Math.Abs( newZ - m.Z )
+
+					if ( cmp > 0 or (cmp =3D=3D 0 and ourZ > newZ) ) then bMyContinue =3D=
 true end
+				end
+
+				if (not bMyContinue) then
+					if ( ourZ + kPersonHeight > testTop ) then testTop =3D ourZ + kPerson=
Height end
+
+					if ( not itemData.Bridge ) then itemTop =3D itemTop + itemData.Height=
 end
+
+					if ( stepTop >=3D itemTop )
 					then
-						newZ =3D ourZ
-						moveIsOk =3D true
+						local landCheck =3D itemZ
+
+						if ( itemData.Height >=3D kStepHeight ) then
+							landCheck =3D landCheck + kStepHeight
+						else
+							landCheck =3D landCheck + itemData.Height
+						end
+
+						if ( considerLand and landCheck < landCenter and landCenter > ourZ a=
nd testTop > landZ ) then
+							--continue
+						else
+							if ( IsOk( ignoreDoors, ourZ, testTop, tiles, items ) )
+							then
+								newZ =3D ourZ
+								moveIsOk =3D true
+							end
+						end
 					end
 				end
 			end
@@ -345,16 +364,16 @@
 	if ( considerLand and (not landBlocks) and stepTop >=3D landZ )
 	then
 		local ourZ =3D landCenter
-		local ourTop =3D ourZ + PersonHeight
+		local ourTop =3D ourZ + kPersonHeight
 		local testTop =3D checkTop
 =

-		if ( ourZ + PersonHeight > testTop ) then testTop =3D ourZ + PersonHeigh=
t end
+		if ( ourZ + kPersonHeight > testTop ) then testTop =3D ourZ + kPersonHei=
ght end
 =

 		local shouldCheck =3D true
 =

 		if ( moveIsOk )
 		then
-			int cmp =3D Math.Abs( ourZ - m.Z ) - Math.Abs( newZ - m.Z )
+			local cmp =3D Math.Abs( ourZ - m.Z ) - Math.Abs( newZ - m.Z ) -- int
 =

 			if ( cmp > 0 or (cmp =3D=3D 0 and ourZ > newZ) ) then shouldCheck =3D f=
alse end
 		end
@@ -366,7 +385,7 @@
 		end
 	end
 =

-	return moveIsOk
+	return moveIsOk,newZ
 end
 =

 --~ private void GetStartZ( Mobile m, Map map, Point3D loc, ArrayList item=
List, out int zLow, out int zTop )
@@ -380,15 +399,15 @@
 	local landZ =3D 0
 	local landCenter =3D 0
 	local landTop =3D 0
-	local landBlocks =3D BitwiseAND(TileData.LandTable[BitwiseAND(landTile.ID=
 , kHex_3FFF)].Flags , TileFlag.Impassable) ~=3D 0
-
-	if ( landBlocks and m.CanSwim and BitwiseAND(TileData.LandTable[BitwiseAN=
D(landTile.ID , kHex_3FFF)].Flags , TileFlag.Wet) ~=3D 0 ) then
+	local landBlocks =3D BitwiseAND(kTileData.LandTable[BitwiseAND(landTile.I=
D , kHex_3FFF)].Flags , kTileFlag.Impassable) ~=3D 0
+
+	if ( landBlocks and m.CanSwim and BitwiseAND(kTileData.LandTable[BitwiseA=
ND(landTile.ID , kHex_3FFF)].Flags , kTileFlag.Wet) ~=3D 0 ) then
 		landBlocks =3D false
-	elseif ( m.CantWalk and BitwiseAND(TileData.LandTable[BitwiseAND(landTile=
.ID , kHex_3FFF)].Flags , TileFlag.Wet) =3D=3D 0 ) then
+	elseif ( m.CantWalk and BitwiseAND(kTileData.LandTable[BitwiseAND(landTil=
e.ID , kHex_3FFF)].Flags , kTileFlag.Wet) =3D=3D 0 ) then
 		landBlocks =3D true
 	end
 =

-	map.GetAverageZ( xCheck, yCheck, ref landZ, ref landCenter, ref landTop )
+	landZ,landCenter,landTop =3D map.GetAverageZ( xCheck, yCheck)
 =

 	local considerLand =3D not landTile.Ignored
 =

@@ -408,13 +427,13 @@
 	local staticTiles =3D map.Tiles.GetStaticTiles( xCheck, yCheck, true ) --=
 Tile[]
 =

 	for i,tile in pairs(staticTiles) do -- Tile
-		local id =3D TileData.ItemTable[BitwiseAND(tile.ID , kHex_3FFF)] -- Item=
Data
+		local id =3D kTileData.ItemTable[BitwiseAND(tile.ID , kHex_3FFF)] -- Ite=
mData
 =

 		local calcTop =3D (tile.Z + id.CalcHeight)
 =

-		if ( ((not isSet) or calcTop >=3D zCenter) and ( BitwiseAND(id.Flags , T=
ileFlag.Surface) ~=3D 0 or ( m.CanSwim and BitwiseAND(id.Flags,TileFlag.Wet=
) ~=3D 0 ) ) and loc.Z >=3D calcTop )
-		then
-			if ( m.CantWalk and BitwiseAND(id.Flags , TileFlag.Wet) =3D=3D 0 ) then
+		if ( ((not isSet) or calcTop >=3D zCenter) and ( BitwiseAND(id.Flags , k=
TileFlag.Surface) ~=3D 0 or ( m.CanSwim and BitwiseAND(id.Flags,kTileFlag.W=
et) ~=3D 0 ) ) and loc.Z >=3D calcTop )
+		then
+			if ( m.CantWalk and BitwiseAND(id.Flags , kTileFlag.Wet) =3D=3D 0 ) then
 				--continue
 			else
 				zLow =3D tile.Z
@@ -435,11 +454,11 @@
 		local calcTop =3D item.Z + id.CalcHeight
 =

 		if (	((not isSet) or calcTop >=3D zCenter) and =

-				(	BitwiseAND(id.Flags , TileFlag.Surface) ~=3D 0 or =

-					( m.CanSwim and BitwiseAND(id.Flags,TileFlag.Wet) ~=3D 0 ) ) and =

+				(	BitwiseAND(id.Flags , kTileFlag.Surface) ~=3D 0 or =

+					( m.CanSwim and BitwiseAND(id.Flags,kTileFlag.Wet) ~=3D 0 ) ) and =

 				loc.Z >=3D calcTop )
 		then
-			if ( m.CantWalk and BitwiseAND(id.Flags , TileFlag.Wet) =3D=3D 0 ) then
+			if ( m.CantWalk and BitwiseAND(id.Flags , kTileFlag.Wet) =3D=3D 0 ) then
 				--continue
 			else =

 				zLow =3D item.Z

Modified: trunk/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.container.lua (original)
+++ trunk/lua/obj/obj.container.lua Sun Jan 20 04:20:29 2008
@@ -139,7 +139,7 @@
 	local container =3D GetContainer(serial)
 	if (not container) then =

 		-- container didn't exist yet, create from scratch
-		dynamicdata =3D {} =

+		local dynamicdata =3D {} =

 		dynamicdata.serial =3D serial
 		container =3D CreateOrUpdateDynamic(dynamicdata)
 	end



From no-reply at zwischenwelt.org  Sun Jan 20 12:55:42 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 11:55:42 -0000
Subject: [Iris-commit] [IRIS] r1810 - in /trunk: README lua/lib.3d.map.lua
	lua/lib.mainmenu.lua
Message-ID: <20080120115542.4BF151524004@zwischenwelt.org>

Author: hagish
Date: Sun Jan 20 12:55:40 2008
New Revision: 1810

Log:
select shard profile from commandline

Modified:
    trunk/README
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.mainmenu.lua

Modified: trunk/README
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/README (original)
+++ trunk/README Sun Jan 20 12:55:40 2008
@@ -89,6 +89,7 @@
 -mt 							: macrolist-test (in mainmenu)
 -sd								: start in debug mode
 -sd -artid ARTID_INT			: start in debug mode and show the given artid (art=
id is given as int number not hex!!!!)
+-co GSHARDNAME					: connect to GSHARDNAME (only possible if shard profile=
 has a username and password) =

 =

 =3D=3D=3D debug mode =3D=3D=3D
 a : show first model and anim =


Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sun Jan 20 12:55:40 2008
@@ -209,8 +209,11 @@
 	-- calculate water level
 	if FilterIsStaticWater(iTileTypeID) then
 		local z =3D entity.zloc
-		chunk.mWaterStaticCountList[z] =3D chunk.mWaterStaticCountList[z] or 0
-		chunk.mWaterStaticCountList[z] =3D chunk.mWaterStaticCountList[z] + 1
+		local tx,ty =3D entity.xloc - entity.iBlockX, entity.yloc - entity.iBloc=
kY
+		=

+		chunk.mWaterZMap[tx.."_"..ty] =3D chunk.mWaterZMap[tx.."_"..ty] or z
+		chunk.mWaterZMap[tx.."_"..ty] =3D math.max(chunk.mWaterZMap[tx.."_"..ty]=
, z)
+		=

 		staticwatertile =3D not gEnableMultiTexTerrain		--on multitexturing filt=
er static water
 	end
 =

@@ -287,9 +290,7 @@
 	chunk.pStaticGeometryLayers =3D {}
 =

 	-- water stats
-	chunk.mfWaterZLoc =3D 0		-- current water level
-	chunk.mbDisplayWater =3D false	-- show water?
-	chunk.mWaterStaticCountList =3D {}	-- zloc -> count list
+	chunk.mWaterZMap =3D {}		-- local z height [x.."_"..y]
 	=

 	-- start fastbatch
 	if (gFastBatchStatics) then
@@ -300,17 +301,18 @@
 	local iBlockUO_X =3D x * self.ROBMAP_CHUNK_SIZE
 	local iBlockUO_Y =3D y * self.ROBMAP_CHUNK_SIZE
 	=

+	local tiles =3D self.ROBMAP_CHUNK_SIZE * 8
+	=

 	-- check ground water level =

 	-- TODO put this into terrain code?
 	if (gGroundBlockLoader) then
-		for tx =3D 0,7 do
-			for ty =3D 0,7 do
+		for tx =3D 0,tiles-1 do
+			for ty =3D 0,tiles-1 do
 				local tiletype,z =3D gGroundBlockLoader:GetTile(iBlockUO_X,iBlockUO_Y,=
tx,ty)
 				=

-				-- TODO this definition depends on multitex terrain
-				if tiletype and gTerrain_MultiTexTypes.water and in_array(tiletype,gTe=
rrain_MultiTexTypes.water) then
-					chunk.mWaterStaticCountList[z] =3D chunk.mWaterStaticCountList[z] or 0
-					chunk.mWaterStaticCountList[z] =3D chunk.mWaterStaticCountList[z] + 1
+				if tiletype and FilterIsMapWater(tiletype) then
+					chunk.mWaterZMap[tx.."_"..ty] =3D chunk.mWaterZMap[tx.."_"..ty] or z
+					chunk.mWaterZMap[tx.."_"..ty] =3D math.max(chunk.mWaterZMap[tx.."_"..=
ty], z)
 				end
 			end
 		end
@@ -409,45 +411,51 @@
 	end
 =

 	-- WATER
-	if (gEnableMultiTexTerrain) then
-		local mostz =3D nil
-		for k,v in pairs(chunk.mWaterStaticCountList) do
-			if mostz =3D=3D nil or chunk.mWaterStaticCountList[mostz] < v then
-				mostz =3D k
-			end
-		end
-	=

-		if mostz then
-			chunk.mfWaterZLoc =3D mostz
-			chunk.mbDisplayWater =3D true	-- show water?
-			-- print("DEBUG",chunk,"mostz",mostz)
+	local count =3D countarr(chunk.mWaterZMap)
+	=

+	if (gEnableMultiTexTerrain and count and count > 0) then
+	=

+		local tiles =3D self.ROBMAP_CHUNK_SIZE * 8
+		=

+		-- print("DEBUG",chunk,"mostz",mostz)
+		=

+		-- create water
+		local gfx =3D CreateRootGfx3D()
+		local vc =3D 4 * count
+		local ic =3D 6 * count
+		=

+		gfx:SetSimpleRenderable()
+		=

+		gfx:RenderableBegin(vc,ic,false,false,OT_TRIANGLE_LIST)
+		=

+		print("DEBUG","bla",count,vc,ic)
+		local index =3D 0
+		for k,v in pairs(chunk.mWaterZMap) do
+			local x,y =3D unpack(strsplit("_",k))
+			local z =3D chunk.mWaterZMap[x.."_"..y] * 0.1
+
+			print("DEBUG","water",x,y,z,k,v)
+
+			gfx:RenderableVertex(-x,y,z, 0,0,1, x/tiles, y/tiles)
+			gfx:RenderableVertex(-x-1,y,z, 0,0,1, (x+1)/tiles, y/tiles)
+			gfx:RenderableVertex(-x,y+1,z, 0,0,1, x/tiles, (y+1)/tiles)
+			gfx:RenderableVertex(-x-1,y+1,z, 0,0,1, (x+1)/tiles, (y+1)/tiles)
 			=

-			-- create water
-			local gfx =3D CreateRootGfx3D()
-			local vc =3D 4
-			local ic =3D 6
-			local d =3D -8 * Renderer3D.ROBMAP_CHUNK_SIZE
-			gfx:SetSimpleRenderable()
-			gfx:RenderableBegin(vc,ic,false,false,OT_TRIANGLE_LIST)
-			gfx:RenderableVertex(0,0,0, 0,0,1, 0,0)
-			gfx:RenderableVertex(d,0,0 ,0,0,1, 1,0)
-			gfx:RenderableVertex(0,-d,0 ,0,0,1, 0,1)
-			gfx:RenderableVertex(d,-d,0, 0,0,1, 1,1)
-			gfx:RenderableIndex3(0,2,1)
-			gfx:RenderableIndex3(1,2,3)
-			gfx:RenderableEnd()
-			gfx:SetMaterial(GetPlainTextureMat("water.jpg"))
+			gfx:RenderableIndex3(index+0, index+2, index+1)
+			gfx:RenderableIndex3(index+1, index+2, index+3)
 			=

-			-- TODO
-			local x,y,z =3D self:UOPosToLocal(chunk.miX * self.ROBMAP_CHUNK_SIZE * =
8, chunk.miY * self.ROBMAP_CHUNK_SIZE * 8, chunk.mfWaterZLoc * 0.1 + 0.1)
-	=

-			gfx:SetPosition(x, y, z)
-			=

-			chunk.mWaterGfx =3D gfx
-		else
-			chunk.mfWaterZLoc =3D 0		-- current water level
-			chunk.mbDisplayWater =3D false	-- show water?
-		end
+			index =3D index + 4
+		end
+
+		gfx:RenderableEnd()
+
+		gfx:SetMaterial(GetPlainTextureMat("water.jpg"))
+		=

+		local x,y,z =3D self:UOPosToLocal(chunk.miX * self.ROBMAP_CHUNK_SIZE * 8=
, chunk.miY * self.ROBMAP_CHUNK_SIZE * 8, 0.1)
+
+		gfx:SetPosition(x, y, z)
+		=

+		chunk.mWaterGfx =3D gfx
 	end
 =

 	return chunk

Modified: trunk/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.lua (original)
+++ trunk/lua/lib.mainmenu.lua Sun Jan 20 12:55:40 2008
@@ -279,6 +279,15 @@
 	if (gCommandLineSwitches["-mt"]) then ToggleMacroList() return end -- mac=
rolist-test
 	if (gCommandLineSwitches["-so"]) then StartOfflineMode() return end -- st=
art in offline mode
 	if (gCommandLineSwitches["-sd"]) then StartDebugMenu() return end -- star=
t in debug mode
+	if (gCommandLineSwitches["-co"]) then =

+		local name =3D gCommandLineArguments[gCommandLineSwitches["-co"]+1]
+		if name and gShardList[name] and =

+			gShardList[name].gLoginname and gShardList[name].gPassword then
+				local shard =3D gShardList[name]
+				MainMenuConnectToShard(shard,name,shard.gLoginname,shard.gPassword)
+				return
+		end
+	end -- connect to shard
 =

 	-- start menu sound
 	SoundPlayMusicById(8)



From no-reply at zwischenwelt.org  Sun Jan 20 13:22:48 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 12:22:48 -0000
Subject: [Iris-commit] [IRIS] r1811 - /trunk/lua/lib.walking3.lua
Message-ID: <20080120122248.89A4E1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan 20 13:22:47 2008
New Revision: 1811

Log:
worked a bit on lib.walk3.lua

Modified:
    trunk/lua/lib.walking3.lua

Modified: trunk/lua/lib.walking3.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.walking3.lua (original)
+++ trunk/lua/lib.walking3.lua Sun Jan 20 13:22:47 2008
@@ -24,10 +24,17 @@
 kTileData =3D {}
 kTileData.ItemTable =3D {}
 kTileData.LandTable =3D {}
--- kTileData.ItemTable[BitwiseAND(check.ID,kHex_3FFF)]  .Flags  .Height  .=
CalcHeight  .Bridge
+-- kTileData.ItemTable[BitwiseAND(check.ID,kHex_3FFF)]  itemData.Flags  .H=
eight  .CalcHeight  .Bridge
 --~ kTileData.LandTable[BitwiseAND(landTile.ID,kHex_3FFF)]  .Flags
--- m.CanSwim
+-- m.CanSwim m.CantWalk  m.CantWalk  m.Alive) or m.Body.BodyID =3D=3D hex2=
num("0x3DB") or m.IsDeadBondedPet m.Z    m.IsDeadBondedPet
+-- item.ItemData.Impassable  item.ItemData.Flags
+-- item.Movable item.Z =

+-- item.AtWorldPoint( xStart, yStart ) and item.ItemID =

 --~ public int CalcHeight : if ( (m_Flags & TileFlag.Bridge) !=3D 0 ) and =
math.floor(m_Height / 2) or m_Height;   RunUO1/src/TileData.cs:153:
+-- Tile  ( check.ID check.Z )
+--~ local tiles =3D map.Tiles.GetStaticTiles( x, y, true ) -- Tile[]
+--~ local landTile =3D map.Tiles.GetLandTile( x, y ) -- Tile    landTile.I=
D       local considerLand =3D not landTile.Ignored
+--~ landZ,landCenter,landTop =3D map.GetAverageZ( xCheck, yCheck)
 =

 =

 kPersonHeight				=3D 16
@@ -182,7 +189,7 @@
 =

 --~ private bool IsOk( bool ignoreDoors, int ourZ, int ourTop, Tile[] tile=
s, ArrayList items )
 function IsOk(  ignoreDoors,  ourZ, ourTop, tiles, items )
-	for i,check in pairs(tiles) do -- Tile
+	for i,check in pairs(tiles) do -- Tile  ( check.ID check.Z )
 		local itemData =3D kTileData.ItemTable[BitwiseAND(check.ID,kHex_3FFF)] -=
- ItemData
 =

 		if ( BitwiseAND(itemData.Flags,kImpassableSurface) ~=3D 0 ) -- Impassabl=
e or Surface
@@ -271,7 +278,7 @@
 				local bMyContinue =3D false
 				if ( moveIsOk )
 				then
-					local cmp =3D Math.Abs( ourZ - m.Z ) - Math.Abs( newZ - m.Z )
+					local cmp =3D math.abs( ourZ - m.Z ) - math.abs( newZ - m.Z )
 =

 					if ( cmp > 0 or (cmp =3D=3D 0 and ourZ > newZ) ) then bMyContinue =3D=
 true end
 				end
@@ -326,7 +333,7 @@
 				=

 				if ( moveIsOk )
 				then
-					local cmp =3D Math.Abs( ourZ - m.Z ) - Math.Abs( newZ - m.Z )
+					local cmp =3D math.abs( ourZ - m.Z ) - math.abs( newZ - m.Z )
 =

 					if ( cmp > 0 or (cmp =3D=3D 0 and ourZ > newZ) ) then bMyContinue =3D=
 true end
 				end
@@ -373,7 +380,7 @@
 =

 		if ( moveIsOk )
 		then
-			local cmp =3D Math.Abs( ourZ - m.Z ) - Math.Abs( newZ - m.Z ) -- int
+			local cmp =3D math.abs( ourZ - m.Z ) - math.abs( newZ - m.Z ) -- int
 =

 			if ( cmp > 0 or (cmp =3D=3D 0 and ourZ > newZ) ) then shouldCheck =3D f=
alse end
 		end



From no-reply at zwischenwelt.org  Sun Jan 20 14:14:57 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 13:14:57 -0000
Subject: [Iris-commit] [IRIS] r1812 - in /trunk:
 data/models/materials/textures.material lua/lib.3d.map.lua
Message-ID: <20080120131458.9206B1524004@zwischenwelt.org>

Author: sience
Date: Sun Jan 20 14:14:57 2008
New Revision: 1812

Log:
-fastbatch hueing integrated
-atlas_base material added

Modified:
    trunk/data/models/materials/textures.material
    trunk/lua/lib.3d.map.lua

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Sun Jan 20 14:14:57 2008
@@ -6,7 +6,7 @@
 material tex_base
 {
 	receive_shadows off
-	// FIXED FUNCTION
+
 	technique
 	{
 		pass
@@ -21,8 +21,9 @@
 			cull_hardware none
 			cull_software none
 			=

-			texture_unit
+			texture_unit MainTexture
 			{
+				texture_alias MainTexture
 				filtering anisotropic =

 				max_anisotropy 8
 				texture checker.png
@@ -33,6 +34,34 @@
 =

 // MESH BASE ALPHA MATERIAL TEMPLATE
 material tex_base_alpha : tex_base
+{
+	technique
+	{
+		pass
+		{
+			scene_blend alpha_blend
+			alpha_rejection greater_equal 200
+		}
+	}
+}
+
+// MESH BASE MATERIAL TEMPLATE
+material atlas_base : tex_base
+{
+	technique
+	{
+		pass
+		{
+			texture_unit MainTexture
+			{
+				colour_op modulate
+			}
+		}
+	}
+}
+
+// MESH BASE ALPHA MATERIAL TEMPLATE
+material atlas_base_alpha : atlas_base
 {
 	technique
 	{

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sun Jan 20 14:14:57 2008
@@ -217,10 +217,10 @@
 		staticwatertile =3D not gEnableMultiTexTerrain		--on multitexturing filt=
er static water
 	end
 =

-	local meshname =3D (not gForceFallBackBillboards_Statics) and staticwater=
tile and GetMeshName(iTileTypeID,entity.iHue)
+	local meshname =3D (not gForceFallBackBillboards_Statics) and staticwater=
tile and GetMeshName(iTileTypeID, (gFastBatchStatics and 0) or entity.iHue)
 =

 	-- create Mesh
-	if (meshname and meshname ~=3D false) then 	--and (not MeshIsPseudoBillBo=
ard(iTileTypeID))) then	--currently disabled
+	if (meshname and meshname ~=3D false) then
 		local qw,qx,qy,qz =3D GetStaticMeshOrientation(iTileTypeID)
 		local sx,sy,sz =3D -1,1,1 -- scale
 		entity.qw =3D qw
@@ -235,7 +235,11 @@
 			entity.meshbuffer =3D GetMeshBuffer(meshname) -- for mousepicking
 			TexAtlas_AdjustMeshBufferIfNeeded(meshname,entity.meshbuffer)
 			if (not self.giBlendOutCurZ) or entity.zloc <=3D self.giBlendOutCurZ th=
en
-				chunk.fastbatch:FastBatch_AddMesh(meshname,entity.x,entity.y,entity.z,=
 qw,qx,qy,qz, sx,sy,sz)
+				local r,g,b,a =3D 1,1,1,1
+			    if (gHueLoader and entity.iHue > 0) then
+			     r,g,b =3D gHueLoader:GetColor(entity.iHue - 1,31) -- get first col=
or
+			    end
+				chunk.fastbatch:FastBatch_AddMesh(meshname,entity.x,entity.y,entity.z,=
 qw,qx,qy,qz, sx,sy,sz, r,g,b,a )
 			end
 			-- todo : pos,rot,scale,col_rgba : hue
 		else



From no-reply at zwischenwelt.org  Sun Jan 20 14:17:45 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 13:17:45 -0000
Subject: [Iris-commit] [IRIS] r1813 - /trunk/lua/main.lua
Message-ID: <20080120131745.18E9F1524004@zwischenwelt.org>

Author: sience
Date: Sun Jan 20 14:17:44 2008
New Revision: 1813

Log:
-shadow options added

Modified:
    trunk/lua/main.lua

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sun Jan 20 14:17:44 2008
@@ -281,18 +281,27 @@
 	CollectOgreResLocs()
 	SetCursorBaseOffset(0,0)
 =

-	-- set global shadow settings
-	if (gShadowTechnique ~=3D "none") then
-		OgreShadowTechnique(gShadowTechnique)
-		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique =
=3D=3D "texture_additive")) then
-			OgreSetShadowTextureSize(2048)
+ 	if (gShadowTechnique ~=3D "none") then
+ 		OgreShadowTechnique(gShadowTechnique)
+		OgreSetShadowFarDistance(gSightRange*18.0)
+
+ 		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique=
 =3D=3D "texture_additive")) then
+ 			OgreSetShadowTextureSize(2048)
+ 			OgreSetShadowTextureSelfShadow(false)
+		end
+
+		if (gShadowTechnique =3D=3D "texture_additive_integrated") then
+			OgreSetShadowCasterRenderBackFaces(false)
+			OgreSetShadowTextureCasterMaterial("Ogre/DepthShadowmap/Caster/Float")
+			--OgreSetShadowTextureReceiverMaterial("Ogre/DepthShadowmap/BasicTempla=
teMaterial")
+			OgreSetShadowTextureSettings(2048, 3, PF_FLOAT32_R)
 			OgreSetShadowTextureSelfShadow(false)
 			--OgreSetShadowTextureCasterMaterial(matname)
 			--OgreSetShadowTextureReceiverMaterial(matname)
 			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --only for accuracy
 			OgreSetShadowFarDistance(gSightRange*18.0)
-		end
-	end
+ 		end
+ 	end
 =

 	-- maybe we should check here if in offline or online mode!?
 	InitNet()



From no-reply at zwischenwelt.org  Sun Jan 20 14:27:19 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 13:27:19 -0000
Subject: [Iris-commit] [IRIS] r1815 - /trunk/lua/lib.walking2.lua
Message-ID: <20080120132719.F1D341524004@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan 20 14:27:19 2008
New Revision: 1815

Log:
optimized walkcode for multis

Modified:
    trunk/lua/lib.walking2.lua

Modified: trunk/lua/lib.walking2.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.walking2.lua (original)
+++ trunk/lua/lib.walking2.lua Sun Jan 20 14:27:19 2008
@@ -5,6 +5,23 @@
 =

 function printwalkdebug (...) if (gDebugWalkingDetailed) then printdebug("=
walking",unpack(arg)) end end =

 =

+		=

+function GetMultiPartsAtPos(multi,xloc,yloc) =

+	local mycache =3D multi.cache
+	if (not mycache) then
+		mycache =3D {}
+		multi.cache =3D mycache
+		for k,v in pairs(multi.lparts or {}) do
+			local iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
+			local myarr =3D mycache[iX..","..iY]
+			if (not myarr) then myarr =3D {}   mycache[iX..","..iY] =3D myarr end
+			table.insert(myarr,{iZ=3DiZ,iTileTypeID=3DiTileTypeID,iHue=3DiHue})
+		end
+	end
+	return mycache[xloc..","..yloc] or {}
+end
+		=

+		=

 kHex02 =3D hex2num("0x02")
 =

 -- returns tiletype,zloc
@@ -53,41 +70,38 @@
 function GetWalkingBlockFlagsHelper(zloc,artid,flaglist)
 	local t =3D GetStaticTileType(artid)
 	if (t) then
-		if ( not(isBridge(t.miFlags)) and not(isImpassable(t.miFlags)) and not(i=
sSurface(t.miFlags)) ) then
+		local t_isBridge		=3D isBridge(t.miFlags)
+		local t_isImpassable	=3D isImpassable(t.miFlags)
+		local t_isSurface		=3D isSurface(t.miFlags)
+		if ( not(t_isBridge) and not(t_isImpassable) and not(t_isSurface) ) then
 			--~ printwalkdebug("----" .. t.msName .."  !impassable  !bridge  !surfa=
ceblocking")
 		else
 			local iHeight =3D t.miHeight
-			if (isBridge(t.miFlags)) then iHeight =3D iHeight/2 + 0.5 end -- TODO :=
 2 is the right value, but playerpos is to low
+			if (t_isBridge) then iHeight =3D iHeight/2 + 0.5 end -- TODO : 2 is the=
 right value, but playerpos is to low
 			=

-			if (flaglist[zloc] =3D=3D nil) then
-				flaglist[zloc] =3D { }
-			end
 			local myflaglist =3D flaglist[zloc]
+			if (myflaglist =3D=3D nil) then myflaglist =3D { } flaglist[zloc] =3D m=
yflaglist end
 			=

-			myflaglist.bSurface =3D myflaglist.bSurface or isSurface(t.miFlags)
-			myflaglist.bBridge =3D myflaglist.bBridge or isBridge(t.miFlags)
+			if (t_isSurface	) then myflaglist.bSurface =3D true end
+			if (t_isBridge	) then myflaglist.bBridge =3D true end
 			=

 			if (iHeight > 0) then
-				myflaglist.bImpassable =3D myflaglist.bImpassable or isImpassable(t.mi=
Flags)
+				if (t_isImpassable) then myflaglist.bImpassable =3D true end
 				for j=3D1, iHeight-1, 1 do
-					if (flaglist[zloc + j] =3D=3D nil) then
-						flaglist[zloc + j] =3D { }
-					end
 					local myflaglist =3D flaglist[zloc + j]
-					myflaglist.bImpassable =3D myflaglist.bImpassable or isImpassable(t.m=
iFlags)
-					myflaglist.bSurface =3D myflaglist.bSurface or isSurface(t.miFlags)
-					myflaglist.bBridge =3D myflaglist.bBridge or isBridge (t.miFlags) =

+					if (myflaglist =3D=3D nil) then myflaglist =3D { } flaglist[zloc + j]=
 =3D myflaglist end
+					if (t_isImpassable	) then myflaglist.bImpassable =3D true end
+					if (t_isSurface		) then myflaglist.bSurface =3D true end
+					if (t_isBridge		) then myflaglist.bBridge =3D true end
 				end
 				=

-				if (flaglist[zloc + iHeight] =3D=3D nil) then
-					flaglist[zloc + iHeight] =3D { }
-				end
 				local myflaglist =3D flaglist[zloc + iHeight]
-				myflaglist.bSurface =3D myflaglist.bSurface or isSurface(t.miFlags)
-				myflaglist.bBridge =3D myflaglist.bBridge or isBridge(t.miFlags) =

+				if (myflaglist =3D=3D nil) then myflaglist =3D { } flaglist[zloc + iHe=
ight] =3D myflaglist end
+				if (t_isSurface	) then myflaglist.bSurface =3D true end
+				if (t_isBridge	) then myflaglist.bBridge =3D true end
 			end
 			=

-			--~ printwalkdebug("----" .. t.msName .."  z=3D" .. zloc .. "  height=
=3D" .. iHeight .. " bImpassable=3D" .. tostring(isImpassable(t.miFlags)) .=
. " bSurface=3D" .. tostring(isSurface(t.miFlags)) .. " isBridge=3D" .. tos=
tring(isBridge(t.miFlags)))
+			--~ printwalkdebug("----" .. t.msName .."  z=3D" .. zloc .. "  height=
=3D" .. iHeight .. " bImpassable=3D" .. tostring(t_isImpassable) .. " bSurf=
ace=3D" .. tostring(isSurface(t.miFlags)) .. " isBridge=3D" .. tostring(isB=
ridge(t.miFlags)))
 		end
 	end
 end
@@ -150,17 +164,9 @@
 	--~ printwalkdebug("---Multis")
 	=

 	if (not gTestIgnoreMultisInWalk) then
-	for k,v in pairs(gMultis) do
-		local multi =3D k
-		=

-		if multi.lparts then
-			for k,v in pairs(multi.lparts) do
-
-				local iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
-				if	iX =3D=3D xloc and iY =3D=3D yloc  then
-					GetWalkingBlockFlagsHelper(iZ,iTileTypeID,flaglist)
-				end
-			end
+	for multi,v in pairs(gMultis) do
+		for k,item in pairs(GetMultiPartsAtPos(multi,xloc,yloc)) do
+			GetWalkingBlockFlagsHelper(item.iZ,item.iTileTypeID,flaglist)
 		end
 	end
 	end



From no-reply at zwischenwelt.org  Sun Jan 20 15:24:08 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 14:24:08 -0000
Subject: [Iris-commit] [IRIS] r1816 - in /trunk: data/base/main.material
 data/config.lua.dist data/models/materials/textures.material
 data/terrain/materials/terrain.material lua/lib.3d.map.lua
Message-ID: <20080120142408.DF2BD1524004@zwischenwelt.org>

Author: sience
Date: Sun Jan 20 15:24:08 2008
New Revision: 1816

Log:
-some shadow & water issues

Modified:
    trunk/data/base/main.material
    trunk/data/config.lua.dist
    trunk/data/models/materials/textures.material
    trunk/data/terrain/materials/terrain.material
    trunk/lua/lib.3d.map.lua

Modified: trunk/data/base/main.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/base/main.material (original)
+++ trunk/data/base/main.material Sun Jan 20 15:24:08 2008
@@ -429,7 +429,6 @@
 			{
 				texture stone512.dds
 				tex_address_mode clamp
-				// filtering none
 			}
 		}
 	}
@@ -454,36 +453,12 @@
 	{
 		pass
 		{
-			//depth_write on
-			//depth_check off
-			lighting off
-			cull_hardware none
-			cull_software none
-			=

-			ambient 1.0 1.0 1.0
-			diffuse 1.0 1.0 1.0
-		}
-	}
-}
-
-material water
-{
-	technique
-	{
-		pass
-		{
-			ambient 1 1 1 1
-			specular 0 0 0 1
-			=

-			lighting off
-			cull_hardware none
-			cull_software none
-			=

-			texture_unit
-			{
-				texture water.jpg
-				tex_address_mode clamp
-			}
-		}
-	}
-}
+			lighting off
+			cull_hardware none
+			cull_software none
+			=

+			ambient 1.0 1.0 1.0
+			diffuse 1.0 1.0 1.0
+		}
+	}
+}

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Jan 20 15:24:08 2008
@@ -239,7 +239,7 @@
 =

 -- preload all static meshes
 -- WARNING !!! this takes some seconds 25sec. first time and approx. 100MB=
 RAM needed
-gPreloadStaticMesh =3D true
+gPreloadStaticMesh =3D false
 =

 gEnableFallBackBillboards_Statics =3D false -- incorrect fallbacks can be =
added to the skiplist using the fallbacktool (f11)
 gEnableFallBackBillboards_Dynamics =3D true
@@ -265,21 +265,11 @@
 =

 -- shadow settings
 --"none", "stencil_modulative", "stencil_additive", "texture_modulative", =
"texture_additive", "texture_additive_integrated", "texture_modulative_inte=
grated"
-gShadowTechnique =3D "none"
+gShadowTechnique =3D "texture_additive"
 gTerrainCastShadows =3D false
-gStaticsCastShadows =3D false
-gDynamicsCastShadows =3D false
-gMobileCastShadows =3D false
-
--- sample shadow setting
-gEnableShadows =3D true
-if (gEnableShadows) then
-	gShadowTechnique =3D "texture_additive"
-	gTerrainCastShadows =3D false
-	gStaticsCastShadows =3D true
-	gDynamicsCastShadows =3D true
-	gMobileCastShadows =3D true
-end
+gStaticsCastShadows =3D true
+gDynamicsCastShadows =3D true
+gMobileCastShadows =3D true
 =

 -- activates Lightsources
 gLightsources =3D true

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Sun Jan 20 15:24:08 2008
@@ -23,7 +23,6 @@
 			=

 			texture_unit MainTexture
 			{
-				texture_alias MainTexture
 				filtering anisotropic =

 				max_anisotropy 8
 				texture checker.png
@@ -52,10 +51,8 @@
 	{
 		pass
 		{
-			texture_unit MainTexture
-			{
-				colour_op modulate
-			}
+			ambient vertexcolour
+			diffuse vertexcolour
 		}
 	}
 }

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Sun Jan 20 15:24:08 2008
@@ -78,3 +78,21 @@
 {
 	set_texture_alias MainTexture terrain_tex_atlas_1024.dds
 }
+
+material water
+{
+	technique
+	{
+		pass
+		{
+			ambient 1.0 1.0 1.0 1.0
+			specular 0 0 0 1.0
+
+			texture_unit
+			{
+				texture water.jpg
+				tex_address_mode clamp
+			}
+		}
+	}
+}

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sun Jan 20 15:24:08 2008
@@ -237,12 +237,13 @@
 			TexAtlas_AdjustMeshBufferIfNeeded(meshname,entity.meshbuffer)
 			if (not self.giBlendOutCurZ) or entity.zloc <=3D self.giBlendOutCurZ th=
en
 				local r,g,b,a =3D 1,1,1,1
-			    if (gHueLoader and entity.iHue > 0) then
-			     r,g,b =3D gHueLoader:GetColor(entity.iHue - 1,31) -- get first col=
or
-			    end
+				--TODO: Hueing currently doesn't work with fastbatch, see als atlas_ba=
se material in textures.material
+				if (gHueLoader and entity.iHue > 0) then
+					r,g,b =3D gHueLoader:GetColor(entity.iHue - 1,31) -- get first color
+				end
+
 				chunk.fastbatch:FastBatch_AddMesh(meshname,entity.x,entity.y,entity.z,=
 qw,qx,qy,qz, sx,sy,sz, r,g,b,a )
 			end
-			-- todo : pos,rot,scale,col_rgba : hue
 		else
 			entity.staticentity =3D CreateMeshEntity(meshname)
 			local myLayer =3D Renderer3D:ZToLayer(entity.zloc)
@@ -473,6 +474,7 @@
 		gfx:RenderableEnd()
 =

 		gfx:SetMaterial("water")
+		gfx:SetCastShadows(false)
 		=

 		local x,y,z =3D self:UOPosToLocal(chunk.miX * self.ROBMAP_CHUNK_SIZE * 8=
, chunk.miY * self.ROBMAP_CHUNK_SIZE * 8, 0.1)
 =




From no-reply at zwischenwelt.org  Sun Jan 20 15:43:17 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 14:43:17 -0000
Subject: [Iris-commit] [IRIS] r1817 -
	/trunk/data/terrain/materials/terrain.material
Message-ID: <20080120144321.5AF141524004@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan 20 15:43:16 2008
New Revision: 1817

Log:
small water animation using texcoords

Modified:
    trunk/data/terrain/materials/terrain.material

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Sun Jan 20 15:43:16 2008
@@ -91,7 +91,13 @@
 			texture_unit
 			{
 				texture water.jpg
-				tex_address_mode clamp
+				tex_address_mode wrap
+				=

+				// animate using texcoords
+				// wave_xform <xform_type> <wave_type> <base> <frequency> <phase> <amp=
litude>
+				wave_xform scroll_x sine 1.0 0.1 0.0 0.1
+				wave_xform scroll_y sine 1.0 0.1 0.1 0.1
+				//scroll_anim 0.2 0.1
 			}
 		}
 	}



From no-reply at zwischenwelt.org  Sun Jan 20 16:07:12 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 15:07:12 -0000
Subject: [Iris-commit] [IRIS] r1818 - in /trunk: data/config.lua.dist
 data/models/materials/textures.material lua/lib.3d.dynamic.lua
 lua/lib.3d.map.lua lua/main.lua
Message-ID: <20080120150715.291481524004@zwischenwelt.org>

Author: sience
Date: Sun Jan 20 16:07:10 2008
New Revision: 1818

Log:
-fastbatch dynamic hueing works now
-fastbatch dynamic activated

Modified:
    trunk/data/config.lua.dist
    trunk/data/models/materials/textures.material
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.map.lua
    trunk/lua/main.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Jan 20 16:07:10 2008
@@ -412,7 +412,7 @@
 =

 -- Fastbatching of Statics/Dynamics (no hueing)
 gFastBatchStatics =3D true
-gFastBatchDynamics =3D false
+gFastBatchDynamics =3D true
 =

 gModelPath_Mesh	=3D "models/models/" -- overrideable for texture-atlas exp=
eriments
 gModelPath_Tex	=3D "models/textures/"
@@ -422,4 +422,4 @@
 =

 gEnableCompassRadar =3D false -- the detailed compass is rendered using st=
encil buffers and seems to cause trouble with shadows
 =

-gAtlasRes =3D "med" -- "high", "med", "low", "ultralow"
+gAtlasRes =3D "med" --"med", "low", "ultralow", "none"	(none stands for: u=
se highest single textures)

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Sun Jan 20 16:07:10 2008
@@ -20,6 +20,9 @@
 			//cull_software front
 			cull_hardware none
 			cull_software none
+
+			ambient vertexcolour
+			diffuse vertexcolour
 			=

 			texture_unit MainTexture
 			{
@@ -47,27 +50,11 @@
 // MESH BASE MATERIAL TEMPLATE
 material atlas_base : tex_base
 {
-	technique
-	{
-		pass
-		{
-			ambient vertexcolour
-			diffuse vertexcolour
-		}
-	}
 }
 =

 // MESH BASE ALPHA MATERIAL TEMPLATE
-material atlas_base_alpha : atlas_base
+material atlas_base_alpha : tex_base_alpha
 {
-	technique
-	{
-		pass
-		{
-			scene_blend alpha_blend
-			alpha_rejection greater_equal 200
-		}
-	}
 }
 =

 // --------------- THIS IS THE END OF BASE MATERIALS ----------------------

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sun Jan 20 16:07:10 2008
@@ -38,7 +38,13 @@
 				if (self:IsZLayerVisible(dynamic.zloc)) then
 						x,y,z =3D Renderer3D:UOPosToLocal (dynamic.xloc,dynamic.yloc,dynamic=
.zloc * 0.1) =

 						qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
-						Renderer3D.gFastBatchDynamics:FastBatch_AddMesh(dynamic.meshname, x,=
y,z, qw,qx,qy,qz, -1,1,1)
+
+						local r,g,b,a =3D 1,1,1,1
+						if (gHueLoader and dynamic.hue > 0) then
+							r,g,b =3D gHueLoader:GetColor(dynamic.hue - 1,31) -- get first color
+						end
+
+						Renderer3D.gFastBatchDynamics:FastBatch_AddMesh(dynamic.meshname, x,=
y,z, qw,qx,qy,qz, -1,1,1, r,g,b,a)
 				end
 			end
 		end

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sun Jan 20 16:07:10 2008
@@ -236,13 +236,13 @@
 			entity.meshbuffer =3D GetMeshBuffer(meshname) -- for mousepicking
 			TexAtlas_AdjustMeshBufferIfNeeded(meshname,entity.meshbuffer)
 			if (not self.giBlendOutCurZ) or entity.zloc <=3D self.giBlendOutCurZ th=
en
+
 				local r,g,b,a =3D 1,1,1,1
-				--TODO: Hueing currently doesn't work with fastbatch, see als atlas_ba=
se material in textures.material
 				if (gHueLoader and entity.iHue > 0) then
 					r,g,b =3D gHueLoader:GetColor(entity.iHue - 1,31) -- get first color
 				end
 =

-				chunk.fastbatch:FastBatch_AddMesh(meshname,entity.x,entity.y,entity.z,=
 qw,qx,qy,qz, sx,sy,sz, r,g,b,a )
+				chunk.fastbatch:FastBatch_AddMesh(meshname,entity.x,entity.y,entity.z,=
 qw,qx,qy,qz, sx,sy,sz, r,g,b,a)
 			end
 		else
 			entity.staticentity =3D CreateMeshEntity(meshname)

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sun Jan 20 16:07:10 2008
@@ -314,11 +314,7 @@
 	-- load texture atlas mappings
 	-- high, med, low
 	-- TODO move to config or automatic best choosing
-	if gAtlasRes =3D=3D "high" then
-		---- high res
-		-- dofile(datapath .. "models/atlas/tex_atlas_alpha_high.lua")
-		-- dofile(datapath .. "models/atlas/tex_atlas_high.lua")
-	elseif gAtlasRes =3D=3D "med" then
+	if gAtlasRes =3D=3D "med" then
 		---- med res
 		dofile(datapath .. "models/atlas/tex_atlas_alpha_med.lua")
 		dofile(datapath .. "models/atlas/tex_atlas_med.lua")
@@ -326,7 +322,7 @@
 		---- low res
 		dofile(datapath .. "models/atlas/tex_atlas_alpha_low.lua")
 		dofile(datapath .. "models/atlas/tex_atlas_low.lua")
-	else
+	elseif gAtlasRes =3D=3D "ultralow" then
 		---- ultralow res
 		dofile(datapath .. "models/atlas/tex_atlas_alpha_ultralow.lua")
 		dofile(datapath .. "models/atlas/tex_atlas_ultralow.lua")



From no-reply at zwischenwelt.org  Sun Jan 20 18:01:04 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 17:01:04 -0000
Subject: [Iris-commit] [IRIS] r1819 - in /trunk/lua: lib.3d.mousepick.lua
 lib.uoids.lua net/net.aoscommand.lua
Message-ID: <20080120170105.5532D1524004@zwischenwelt.org>

Author: sience
Date: Sun Jan 20 18:00:59 2008
New Revision: 1819

Log:
-mouspick improved (multis ignored, wrong here)
-AOSSendCommand debugmessage fixed

Modified:
    trunk/lua/lib.3d.mousepick.lua
    trunk/lua/lib.uoids.lua
    trunk/lua/net/net.aoscommand.lua

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Sun Jan 20 18:00:59 2008
@@ -196,7 +196,8 @@
 	=

 	-- dynamics
 	for k,dynamic in pairs(GetDynamicList()) do
-		if (DynamicIsInWorld(dynamic)) then
+		-- if Dynamic is in World (not Container) and if it's not an Multis
+		if (DynamicIsInWorld(dynamic) and (dynamic.artid < gMulti_ID)) then
 			-- WARNING copy & paste code
 			if (self:IsZLayerVisible(dynamic.zloc)) then
 				if (dynamic.gfx and dynamic.gfx.billboard) then
@@ -215,6 +216,8 @@
 					bHit,fHitDist =3D dynamic.gfx:RayPick(rx,ry,rz,rvx,rvy,rvz)
 				else
 					print("WARNING visible but no mousepicking possible on dynamic",dynam=
ic.artid)
+					local name =3D GetStaticTileTypeName(dynamic.artid)
+					print(name or "can't find Tiletypename for this ArtID (shure it's no =
multi or it's in tiledata.mul?)")
 				end
 				=

 				if (bHit and ((not gMousePickFoundHit) or fHitDist < self.gMousePickFo=
undDist)) then

Modified: trunk/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoids.lua (original)
+++ trunk/lua/lib.uoids.lua Sun Jan 20 18:00:59 2008
@@ -8,6 +8,9 @@
 =

 gMaxHueValue =3D 2999 -- hues.mul has only 2999 values
 gMaxArtValue =3D hex2num("0xbfff")
+
+-- from this artid are starting Multis
+gMulti_ID =3D hex2num("0x4000")
 =

 kMobileGhostArtIDs =3D {402,403,607,608,970}
 =

@@ -102,10 +105,6 @@
 gLayerTypeName =3D {}
 for k,v in pairs(gLayerType) do gLayerTypeName[v] =3D k end -- make names =
available as global constants
 	=

--- multi stuff
-gMulti_ID =3D hex2num("0x4000")
-	=

-
 -- Tiledata Flags
 kTileDataFlag_Background		=3D hex2num("0x00000001")
 kTileDataFlag_Weapon			=3D hex2num("0x00000002") -- set for weapons AND sh=
ields (7035)

Modified: trunk/lua/net/net.aoscommand.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.aoscommand.lua (original)
+++ trunk/lua/net/net.aoscommand.lua Sun Jan 20 18:00:59 2008
@@ -52,7 +52,8 @@
 --D7 0F00 00000001 0019 00000000 05 0A
 --Send Quest, Guild Button req. to Server -> Server returns a Serverside G=
ump
 function Send_AOSCommand(subcmd,mobile_serial,weaponability)
-	--print("NET: Send_AOSCommand: "..subcmd.." Player_Serial=3D"..player_ser=
ial)
+	local weaponabilitytype =3D weaponability or 0
+	=

 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_AOS_Command)
 =

@@ -71,10 +72,10 @@
 		out:PushNetUint32(mobile_serial)
 		out:PushNetUint16(subcmd)
 		out:PushNetUint32(0)
-		out:PushNetUint8(weaponability)
+		out:PushNetUint8(weaponabilitytype)
 		out:PushNetUint8(hex2num("0x0A"))
 	end
 =

 	out:SendPacket()
-	printdebug("mobile",sprintf("NET: kPacket_AOS_Command: mobile_serial=3D0x=
%08x ability=3D%d\n",mobile_serial,weaponability))
+	printdebug("mobile",sprintf("NET: kPacket_AOS_Command: mobile_serial=3D0x=
%08x ability=3D%d\n",mobile_serial,weaponabilitytype))
 end



From no-reply at zwischenwelt.org  Sun Jan 20 19:12:37 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 18:12:37 -0000
Subject: [Iris-commit] [IRIS] r1820 - in /trunk: data/config.lua.dist
	lua/lib.compass.lua
Message-ID: <20080120181238.90D161524004@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan 20 19:12:34 2008
New Revision: 1820

Log:
added option to skip md5 check : gSkipCompassMD5Check =3D true

Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.compass.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Jan 20 19:12:34 2008
@@ -423,3 +423,5 @@
 gEnableCompassRadar =3D false -- the detailed compass is rendered using st=
encil buffers and seems to cause trouble with shadows
 =

 gAtlasRes =3D "med" --"med", "low", "ultralow", "none"	(none stands for: u=
se highest single textures)
+
+gSkipCompassMD5Check =3D false

Modified: trunk/lua/lib.compass.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.compass.lua (original)
+++ trunk/lua/lib.compass.lua Sun Jan 20 19:12:34 2008
@@ -108,7 +108,7 @@
 =

 	-- generate map file md5s
 	profile:StartSection("md5")
-	local md5 =3D MD5FromFileList({
+	local md5 =3D gSkipCompassMD5Check and "md5skipped" or MD5FromFileList({
 			CorrectPath( Addfilepath(gMaps[iMapIndex].mapfilename) ),
 			CorrectPath( Addfilepath(gMaps[iMapIndex].staidxfilename) ),
 			CorrectPath( Addfilepath(gMaps[iMapIndex].staticfilename) ),
@@ -121,6 +121,7 @@
 	if (mapfile_exists) then
 		print(gMapImagePath_Small.." exists")
 	elseif (gGroundBlockLoader and gStaticBlockLoader and gRadarColorLoaderTy=
pe) then
+		profile:StartSection("radarcol")
 		if (not gRadarColorLoader) then
 			gRadarColorLoader =3D CreateRadarColorLoader(gRadarColorLoaderType,Corr=
ectPath( Addfilepath(gRadarcolFile) ))
 		end



From no-reply at zwischenwelt.org  Sun Jan 20 19:38:26 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 18:38:26 -0000
Subject: [Iris-commit] [IRIS] r1821 - in /trunk: data/config.lua.dist
	lua/lib.compass.lua
Message-ID: <20080120183829.2D91B1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan 20 19:38:24 2008
New Revision: 1821

Log:
replaced md5 skip option by a quick option that checks only filepaths, not =
file contents, off by default, but useful for debug

Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.compass.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Jan 20 19:38:24 2008
@@ -424,4 +424,4 @@
 =

 gAtlasRes =3D "med" --"med", "low", "ultralow", "none"	(none stands for: u=
se highest single textures)
 =

-gSkipCompassMD5Check =3D false
+gQuickCompassMD5Check =3D false -- if true : only checks file-paths instea=
d of file contents, WARNING : doesn't detect updates

Modified: trunk/lua/lib.compass.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.compass.lua (original)
+++ trunk/lua/lib.compass.lua Sun Jan 20 19:38:24 2008
@@ -108,11 +108,13 @@
 =

 	-- generate map file md5s
 	profile:StartSection("md5")
-	local md5 =3D gSkipCompassMD5Check and "md5skipped" or MD5FromFileList({
-			CorrectPath( Addfilepath(gMaps[iMapIndex].mapfilename) ),
-			CorrectPath( Addfilepath(gMaps[iMapIndex].staidxfilename) ),
-			CorrectPath( Addfilepath(gMaps[iMapIndex].staticfilename) ),
-		})
+	local mymap =3D gMaps[iMapIndex]
+	local md5 =3D gQuickCompassMD5Check and MD5FromString(mymap.mapfilename .=
. mymap.staidxfilename .. mymap.staticfilename) or =

+			MD5FromFileList({
+				CorrectPath( Addfilepath(gMaps[iMapIndex].mapfilename) ),
+				CorrectPath( Addfilepath(gMaps[iMapIndex].staidxfilename) ),
+				CorrectPath( Addfilepath(gMaps[iMapIndex].staticfilename) ),
+			})
 	=

 	=

 	gMapImagePath_Small	=3D datapath.."tmp/compass_"..md5.."_small_s.tga"



From no-reply at zwischenwelt.org  Sun Jan 20 19:54:10 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 18:54:10 -0000
Subject: [Iris-commit] [IRIS] r1822 - in /trunk: ./ bin/ data/ doc/
Message-ID: <20080120185411.107F91524004@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan 20 19:54:09 2008
New Revision: 1822

Log:
added a few things to svn ignore

Modified:
    trunk/   (props changed)
    trunk/bin/   (props changed)
    trunk/data/   (props changed)
    trunk/doc/   (props changed)



From no-reply at zwischenwelt.org  Sun Jan 20 22:33:28 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 21:33:28 -0000
Subject: [Iris-commit] [IRIS] r1823 - in /trunk/lua: lib.3d.mobile.lua
	lib.mainmenu.lua
Message-ID: <20080120220013.5D96E1524009@zwischenwelt.org>

Author: ghoulsblade
Date: Sun Jan 20 22:33:27 2008
New Revision: 1823

Log:
profiling options

Modified:
    trunk/lua/lib.3d.mobile.lua
    trunk/lua/lib.mainmenu.lua

Modified: trunk/lua/lib.3d.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mobile.lua (original)
+++ trunk/lua/lib.3d.mobile.lua Sun Jan 20 22:33:27 2008
@@ -3,6 +3,7 @@
 =

 -- called from obj.mobile.lua
 function UpdateMobileModel (mobile)
+	if (gTestNoMobileGfxNodes) then return end
 	if (not mobile.bodygfx) then mobile.bodygfx =3D CreateBodyGfx() end
 	mobile.bodygfx:MarkForUpdate(mobile.artid,mobile.hue,GetMobileEquipmentLi=
st(mobile))
 	=

@@ -20,6 +21,7 @@
 end
 =

 function Renderer3D:UpdateMobile( mobile )
+	if (gTestNoMobileGfxNodes) then return end
 	if (not self.gbActive) then return end
 	=

 	if (IsPlayerMobile(mobile)) then
@@ -223,6 +225,8 @@
 end
 =

 function Renderer3D:UpdateMobilePos (mobile,x,y,z,qw,qx,qy,qz)
+	if (gTestNoMobileGfxNodes) then return end
+	=

 	-- set position and orientation
 	if (mobile.bodygfx and mobile.bodygfx.modelgfx) then
 		mobile.bodygfx.modelgfx:SetPosition(x-0.5, y+0.5, z)
@@ -347,6 +351,7 @@
 =

 -- called every frame from mainloop
 function Renderer3D:MobileAnimStep ()
+	if (gTestNoMobileGfxNodes) then return end
 	if (not self.gbActive) then return end
 	if (not gAnimInfoLists) then return end
 	for k,mobile in pairs(GetMobileList()) do Renderer3D:StepMobile(mobile) e=
nd

Modified: trunk/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.lua (original)
+++ trunk/lua/lib.mainmenu.lua Sun Jan 20 22:33:27 2008
@@ -275,6 +275,7 @@
 end
 =

 function StartMainMenu ()
+	if (gTestNoMainMenu) then return end
 	if (gCommandLineSwitches["-jt"]) then ToggleJournal() return end -- journ=
altest
 	if (gCommandLineSwitches["-mt"]) then ToggleMacroList() return end -- mac=
rolist-test
 	if (gCommandLineSwitches["-so"]) then StartOfflineMode() return end -- st=
art in offline mode



From no-reply at zwischenwelt.org  Sun Jan 20 23:37:44 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Jan 2008 22:37:44 -0000
Subject: [Iris-commit] [IRIS] r1824 - in /trunk: data/config.lua.dist
 data/profiles/ data/profiles/gfx_high.lua data/profiles/gfx_low.lua
 data/profiles/gfx_med.lua data/profiles/gfx_ultralow.lua lua/lib.3d.map.lua
 lua/lib.terrain.multitex.lua
Message-ID: <20080120223745.CBD781524004@zwischenwelt.org>

Author: sience
Date: Sun Jan 20 23:37:43 2008
New Revision: 1824

Log:
-no terrainshadows needed (always false)
-gfx profiles added (no working yet)

Added:
    trunk/data/profiles/
    trunk/data/profiles/gfx_high.lua
    trunk/data/profiles/gfx_low.lua
    trunk/data/profiles/gfx_med.lua
    trunk/data/profiles/gfx_ultralow.lua
Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.terrain.multitex.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sun Jan 20 23:37:43 2008
@@ -266,7 +266,6 @@
 -- shadow settings
 --"none", "stencil_modulative", "stencil_additive", "texture_modulative", =
"texture_additive", "texture_additive_integrated", "texture_modulative_inte=
grated"
 gShadowTechnique =3D "texture_additive"
-gTerrainCastShadows =3D false
 gStaticsCastShadows =3D true
 gDynamicsCastShadows =3D true
 gMobileCastShadows =3D true

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sun Jan 20 23:37:43 2008
@@ -364,7 +364,7 @@
 					chunk.terraingfx =3D CreateRootGfx3D()
 					chunk.terraingfx:SetMesh(meshname)
 					chunk.terraingfx:SetPosition(x,y,0)
-					chunk.terraingfx:SetCastShadows(gTerrainCastShadows)
+					chunk.terraingfx:SetCastShadows(false)
 					chunk.terraingfx:SetVisible(self.gbBlendOutTerrainVisible)
 				end
 			end

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Sun Jan 20 23:37:43 2008
@@ -177,6 +177,6 @@
 	gfx:SetPosition(x,y,z)
 	Gfx3D_SetMultiTexTerrain(gfx,gGroundBlockLoader,bx,by,kMultiTexTerrainChu=
nkSize,kMultiTexTerrainChunkSize)
 	gfx:SetMaterial(MultiTexTerrainGetMat())
-	gfx:SetCastShadows(gTerrainCastShadows)
+	gfx:SetCastShadows(false)
 	return gfx
 end



From no-reply at zwischenwelt.org  Mon Jan 21 15:29:13 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 21 Jan 2008 14:29:13 -0000
Subject: [Iris-commit] [IRIS] r1825 - /trunk/installdeps.ubuntu.sh
Message-ID: <20080121142913.DB82C1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Jan 21 15:29:13 2008
New Revision: 1825

Log:
fixed installdeps.ubuntu.sh : added lua

Modified:
    trunk/installdeps.ubuntu.sh

Modified: trunk/installdeps.ubuntu.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/installdeps.ubuntu.sh (original)
+++ trunk/installdeps.ubuntu.sh Mon Jan 21 15:29:13 2008
@@ -1,4 +1,4 @@
 #!/bin/bash
-DEPS=3D"libalut-dev libopenal-dev libvorbisfile3 libvorbis-dev libogg-dev =
libboost-dev libboost-thread-dev libogre14 libogre-dev libois-dev g++ gcc"
+DEPS=3D"liblua50-dev liblualib50-dev libalut-dev libopenal-dev libvorbisfi=
le3 libvorbis-dev libogg-dev libboost-dev libboost-thread-dev libogre14 lib=
ogre-dev libois-dev g++ gcc"
 echo apt-get install $DEPS
 sudo apt-get install $DEPS



From no-reply at zwischenwelt.org  Mon Jan 21 15:31:04 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 21 Jan 2008 14:31:04 -0000
Subject: [Iris-commit] [IRIS] r1826 - in /trunk/lua: lib.gui.iris.lua
	lib.mousepick.lua
Message-ID: <20080121143104.73BB31C18739@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Jan 21 15:31:04 2008
New Revision: 1826

Log:
profiling options

Modified:
    trunk/lua/lib.gui.iris.lua
    trunk/lua/lib.mousepick.lua

Modified: trunk/lua/lib.gui.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gui.iris.lua (original)
+++ trunk/lua/lib.gui.iris.lua Mon Jan 21 15:31:04 2008
@@ -55,6 +55,7 @@
 end
 =

 function gui.StartLoading() =

+	if (gTestNoIrisLogo) then return end
 	-- iris logo
 	gDialog_IrisLogo =3D guimaker.MyCreateDialog()
 	local widget =3D guimaker.MakePlane(gDialog_IrisLogo,"irislogo",-128,-128=
,256,256)

Modified: trunk/lua/lib.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mousepick.lua (original)
+++ trunk/lua/lib.mousepick.lua Mon Jan 21 15:31:04 2008
@@ -47,6 +47,7 @@
 -- currently sent on mousedown
 -- TODO : maybe only send on mouseup if no dragdrop took place ?
 function IrisSingleClick ()
+	if (gTestNoClick) then return end
 	if (IsTargetModeActive()) then =

 		CompleteTargetMode() -- see net/net.cursor.lua
 	else



From no-reply at zwischenwelt.org  Mon Jan 21 18:29:33 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 21 Jan 2008 17:29:33 -0000
Subject: [Iris-commit] [IRIS] r1827 - /trunk/lua/lib.tilefreewalk.lua
Message-ID: <20080121172933.441C51524004@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Jan 21 18:29:32 2008
New Revision: 1827

Log:
changed character model for offline mode : now mount + armor,shield and mace

Modified:
    trunk/lua/lib.tilefreewalk.lua

Modified: trunk/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.tilefreewalk.lua (original)
+++ trunk/lua/lib.tilefreewalk.lua Mon Jan 21 18:29:32 2008
@@ -6,16 +6,24 @@
 gTileFreeWalk =3D {}
 =

 kFreeWalkMouseSlowArea =3D 70
-
+ =

 kTileFreeTestMobile =3D {artid=3D400,hue=3D33780, content=3D{
---		{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount},
-		[4]=3D{artid=3D5422,hue=3D1728,animid=3D430},
-		[26]=3D{artid=3D3701,hue=3D0,animid=3D422},
-		[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},
-		[27]=3D{artid=3D3701,hue=3D0,animid=3D422},
-		[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},
-		[11]=3D{artid=3D8252,hue=3D1147,animid=3D701},
-		[21]=3D{artid=3D3701,hue=3D0,animid=3D422}
+		{artid=3D3932,animid=3D631},{artid=3D7028},
+		{artid=3D5137,animid=3D529},{artid=3D9797,animid=3D682},
+		{artid=3D5140,animid=3D530},{artid=3D5136,animid=3D528},
+		{artid=3D8256,animid=3D800},{artid=3D3701,animid=3D422},
+		{artid=3D5141,animid=3D527},{artid=3D3708,animid=3D0},
+		{artid=3D8266,animid=3D903},
+		{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount},
+		=

+		=

+		--~ [4]=3D{artid=3D5422,hue=3D1728,animid=3D430}, -- trousers
+		--~ [26]=3D{artid=3D3701,hue=3D0,animid=3D422},
+		--~ [16]=3D{artid=3D8269,hue=3D1147,animid=3D906},
+		--~ [27]=3D{artid=3D3701,hue=3D0,animid=3D422},
+		--~ [17]=3D{artid=3D8059,hue=3D0,animid=3D913},  -- shirt
+		--~ [11]=3D{artid=3D8252,hue=3D1147,animid=3D701},
+		--~ [21]=3D{artid=3D3701,hue=3D0,animid=3D422}
 		}} =

 		=

 gTileFreePlayerRad =3D 0.2 -- radius of player/human



From no-reply at zwischenwelt.org  Mon Jan 21 20:10:58 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 21 Jan 2008 19:10:58 -0000
Subject: [Iris-commit] [IRIS] r1828 - in /trunk: ./ bin/ data/
	data/profiles/ doc/notes/
Message-ID: <20080121191058.B269C1524004@zwischenwelt.org>

Author: sience
Date: Mon Jan 21 20:10:57 2008
New Revision: 1828

Log:
-notes moved to data/doc/notes
-Win32 binary updated
-gfx-profiles updated

Added:
    trunk/doc/notes/
    trunk/doc/notes/old_mobileanim_notest.txt
    trunk/doc/notes/old_walk_notes.txt
    trunk/doc/notes/twohandnotes.txt
Removed:
    trunk/data/old_mobileanim_notest.txt
    trunk/data/old_walk_notes.txt
    trunk/twohandnotes.txt
Modified:
    trunk/bin/iris2.exe
    trunk/data/profiles/gfx_low.lua
    trunk/data/profiles/gfx_ultralow.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/profiles/gfx_low.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/profiles/gfx_low.lua (original)
+++ trunk/data/profiles/gfx_low.lua Mon Jan 21 20:10:57 2008
@@ -18,3 +18,5 @@
 gSightRange	=3D 2
 gParticleEffectSystem =3D true
 gLightsources =3D false
+
+gGroundBlockLoaderType     =3D "OnDemand"

Modified: trunk/data/profiles/gfx_ultralow.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/profiles/gfx_ultralow.lua (original)
+++ trunk/data/profiles/gfx_ultralow.lua Mon Jan 21 20:10:57 2008
@@ -23,3 +23,5 @@
 gEnableFallBackBillboards_Dynamics =3D false
 gForceFallBackBillboards_Statics =3D false
 gForceFallBackBillboards_Dynamics =3D false
+
+gGroundBlockLoaderType     =3D "OnDemand"



From no-reply at zwischenwelt.org  Mon Jan 21 20:18:31 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 21 Jan 2008 19:18:31 -0000
Subject: [Iris-commit] [IRIS] r1829 - /trunk/lua/lib.mainmenu.lua
Message-ID: <20080121191832.54B5B1C1868C@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Jan 21 20:18:30 2008
New Revision: 1829

Log:
commandline switch for testing meshloader

Modified:
    trunk/lua/lib.mainmenu.lua

Modified: trunk/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.lua (original)
+++ trunk/lua/lib.mainmenu.lua Mon Jan 21 20:18:30 2008
@@ -274,8 +274,23 @@
 	UnBindArr({"u","q","e","tab","r","t","k","j","b","p","g","h","y"})
 end
 =

+function StartMeshLoaderTest ()
+	if (gDialog_IrisLogo) then gDialog_IrisLogo:SetVisible(false) end
+	local mymeshbuffer =3D LoadMeshBufferFromFile("../data/models/models/to_0=
02000/mdl_001909.mesh") -- load directly
+	--~ local mymeshbuffer =3D GetMeshBuffer("../data/models/models/to_002000=
/mdl_001909.mesh") -- load to vram and read back to ram
+	local fastbatch =3D CreateRootGfx3D()
+	fastbatch:SetFastBatch()
+	local x,y,z =3D 0,2,40-0.5 -- +x=3Dright,+y=3Ddepth,+z :top (camz=3D40)
+	local qw,qx,qy,qz =3D 1,0,0,0
+	local sx,sy,sz =3D 1,1,1
+	local r,g,b,a =3D 1,1,1,1
+	fastbatch:FastBatch_AddMeshBuffer(mymeshbuffer, x,y,z, qw,qx,qy,qz, sx,sy=
,sz, r,g,b,a)
+	fastbatch:FastBatch_Build()
+end
+
 function StartMainMenu ()
 	if (gTestNoMainMenu) then return end
+	if (gCommandLineSwitches["-meshload"]) then StartMeshLoaderTest() end -- =
journaltest
 	if (gCommandLineSwitches["-jt"]) then ToggleJournal() return end -- journ=
altest
 	if (gCommandLineSwitches["-mt"]) then ToggleMacroList() return end -- mac=
rolist-test
 	if (gCommandLineSwitches["-so"]) then StartOfflineMode() return end -- st=
art in offline mode



From no-reply at zwischenwelt.org  Mon Jan 21 20:35:41 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 21 Jan 2008 19:35:41 -0000
Subject: [Iris-commit] [IRIS] r1830 - /trunk/lua/lib.3d.map.lua
Message-ID: <20080121193542.1783D1524004@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Jan 21 20:35:40 2008
New Revision: 1830

Log:
blendout height set back to playerhead because of problems with triangular =
roofs

Modified:
    trunk/lua/lib.3d.map.lua

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Mon Jan 21 20:35:40 2008
@@ -574,7 +574,7 @@
 		--~ if (playerIsInside) then myLayer =3D zloc_roof or playerheadpos end
 		if (playerIsInside) then =

 			myLayer =3D playerheadpos =

-			if (zloc_roof) then myLayer =3D zloc_roof - 1 end
+			--~ if (zloc_roof) then myLayer =3D zloc_roof - 1 end
 		end
 		--~ print("blendout",playerIsInside,playerheadpos,zloc_roof)
 	end



From no-reply at zwischenwelt.org  Mon Jan 21 23:57:02 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 21 Jan 2008 22:57:02 -0000
Subject: [Iris-commit] [IRIS] r1831 - in /trunk/lua: lib.bodygfx.lua
 lib.buff.lua main.lua net/net.buff.lua
Message-ID: <20080121225705.B1CD71C18739@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Jan 21 23:56:54 2008
New Revision: 1831

Log:
simple buff display working

Modified:
    trunk/lua/lib.bodygfx.lua
    trunk/lua/lib.buff.lua
    trunk/lua/main.lua
    trunk/lua/net/net.buff.lua

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Mon Jan 21 23:56:54 2008
@@ -276,7 +276,7 @@
 =

 -- creates childnodes of parentgfx and adds inserts them into the partsarr=
 table
 function CreateBodyGfxPartsFromModelIDArray (bodyid,parentgfx,partsarr,mod=
elidarr,iPrimaryHandItem,iSecondaryHandItem)
-	print("CreateBodyGfxPartsFromModelIDArray",iPrimaryHandItem,iPrimaryHandI=
tem and iPrimaryHandItem.modelid,iSecondaryHandItem,iSecondaryHandItem and =
iSecondaryHandItem.modelid)
+	--~ print("CreateBodyGfxPartsFromModelIDArray",iPrimaryHandItem,iPrimaryH=
andItem and iPrimaryHandItem.modelid,iSecondaryHandItem,iSecondaryHandItem =
and iSecondaryHandItem.modelid)
 	if (not gGrannyLoaderType) then return end
 	local override_meshname =3D GrannyMeshOverride(bodyid)
 	local skeleton_name

Modified: trunk/lua/lib.buff.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.buff.lua (original)
+++ trunk/lua/lib.buff.lua Mon Jan 21 23:56:54 2008
@@ -6,51 +6,146 @@
 Notes: =

 This is a submitted packet, information here is yet to be verified. Use at=
 own risk. =

 =

+gumpid 0x756 and following : buff-bar gumps
+unknown : 0x7555(snakes),0x7556(man,justice-spell?),0x7564(run),0x753A(?)
+
 List of current Icon Names:
-//1001: Dismount =

-//1002: Disarm =

-//1005: Nightsight =

-//1006: Death Strike =

-//1007: Evil Omen =

-//1008: ? GumpID 0x7556 =

-//1009: ? GumpID 0x753A =

-//1010: Divine Fury =

-//1011: Enemy Of One =

-//1012: Stealth =

-//1013: Active Meditation =

-//1014: Blood Oath caster =

-//1015: Blood Oath curse =

-//1016: Corpse Skin =

-//1017: Mindrot =

-//1018: Pain Spike =

-//1019: Strangle =

-//1020: Gift of Renewal =

-//1021: Attune Weapon =

-//1022: Thunderstorm =

-//1023: Essence of Wind =

-//1024: Ethereal Voyage =

-//1025: Gift Of Life =

-//1026: Arcane Empowerment =

-//1027: Mortal Strike =

-//1028: Reactive Armor =

-//1029: Protection =

-//1030: Arch Protection =

-//1031: Magic Reflection =

-//1032: Incognito =

-//1033: Disguised =

-//1034: Animal Form =

-//1035: Polymorph =

-//1036: Invisibility =

-//1037: Paralyze =

-//1038: Poison =

-//1039: Bleed =

-//1040: Clumsy =

-//1041: Feeble Mind =

-//1042: Weaken =

-//1043: Curse =

-//1044: Mass Curse =

-//1045: Agility =

-//1046: Cunning =

-//1047: Strength =

-//1048: Bless
 ]]--
+
+gBuffIcons =3D {}
+gBuffIcons[1001] =3D { iGumpID=3Dhex2num("0x754c"), name=3D"Dismount"					}
+gBuffIcons[1002] =3D { iGumpID=3Dhex2num("0x754a"), name=3D"Disarm"					}
+gBuffIcons[1005] =3D { iGumpID=3Dhex2num("0x755e"), name=3D"Nightsight"			=
	}
+gBuffIcons[1006] =3D { iGumpID=3Dhex2num("0x7549"), name=3D"Death Strike"	=
			}
+gBuffIcons[1007] =3D { iGumpID=3Dhex2num("0x7551"), name=3D"Evil Omen"				}
+gBuffIcons[1008] =3D { iGumpID=3Dhex2num("0x7556"), name=3D"?"						}
+gBuffIcons[1009] =3D { iGumpID=3Dhex2num("0x753A"), name=3D"?"						}
+gBuffIcons[1010] =3D { iGumpID=3Dhex2num("0x754d"), name=3D"Divine Fury"		=
		}
+gBuffIcons[1011] =3D { iGumpID=3Dhex2num("0x754e"), name=3D"Enemy Of One"	=
			}
+gBuffIcons[1012] =3D { iGumpID=3Dhex2num("0x7565"), name=3D"Stealth"					}
+gBuffIcons[1013] =3D { iGumpID=3Dhex2num("0x753b"), name=3D"Active Meditat=
ion"		}
+gBuffIcons[1014] =3D { iGumpID=3Dhex2num("0x7543"), name=3D"Blood Oath cas=
ter"		}
+gBuffIcons[1015] =3D { iGumpID=3Dhex2num("0x7544"), name=3D"Blood Oath cur=
se"			}
+gBuffIcons[1016] =3D { iGumpID=3Dhex2num("0x7546"), name=3D"Corpse Skin"		=
		}
+gBuffIcons[1017] =3D { iGumpID=3Dhex2num("0x755c"), name=3D"Mindrot"					}
+gBuffIcons[1018] =3D { iGumpID=3Dhex2num("0x755f"), name=3D"Pain Spike"			=
	}
+gBuffIcons[1019] =3D { iGumpID=3Dhex2num("0x7566"), name=3D"Strangle"					}
+gBuffIcons[1020] =3D { iGumpID=3Dhex2num("0x7554"), name=3D"Gift of Renewa=
l"			}
+gBuffIcons[1021] =3D { iGumpID=3Dhex2num("0x7540"), name=3D"Attune Weapon"=
			}
+gBuffIcons[1022] =3D { iGumpID=3Dhex2num("0x7568"), name=3D"Thunderstorm"	=
			}
+gBuffIcons[1023] =3D { iGumpID=3Dhex2num("0x754f"), name=3D"Essence of Win=
d"			}
+gBuffIcons[1024] =3D { iGumpID=3Dhex2num("0x7550"), name=3D"Ethereal Voyag=
e"			}
+gBuffIcons[1025] =3D { iGumpID=3Dhex2num("0x7553"), name=3D"Gift Of Life"	=
			}
+gBuffIcons[1026] =3D { iGumpID=3Dhex2num("0x753e"), name=3D"Arcane Empower=
ment"		}
+gBuffIcons[1027] =3D { iGumpID=3Dhex2num("0x755d"), name=3D"Mortal Strike"=
			}
+gBuffIcons[1028] =3D { iGumpID=3Dhex2num("0x7563"), name=3D"Reactive Armor=
"			}
+gBuffIcons[1029] =3D { iGumpID=3Dhex2num("0x7562"), name=3D"Protection"			=
	}
+gBuffIcons[1030] =3D { iGumpID=3Dhex2num("0x753f"), name=3D"Arch Protectio=
n"			}
+gBuffIcons[1031] =3D { iGumpID=3Dhex2num("0x7559"), name=3D"Magic Reflecti=
on"			}
+gBuffIcons[1032] =3D { iGumpID=3Dhex2num("0x7557"), name=3D"Incognito"				}
+gBuffIcons[1033] =3D { iGumpID=3Dhex2num("0x754b"), name=3D"Disguised"				}
+gBuffIcons[1034] =3D { iGumpID=3Dhex2num("0x753d"), name=3D"Animal Form"		=
		}
+gBuffIcons[1035] =3D { iGumpID=3Dhex2num("0x7561"), name=3D"Polymorph" 			=
	}
+gBuffIcons[1036] =3D { iGumpID=3Dhex2num("0x7558"), name=3D"Invisibility"	=
			}
+gBuffIcons[1037] =3D { iGumpID=3Dhex2num("0x755b"), name=3D"Paralyze"					}
+gBuffIcons[1038] =3D { iGumpID=3Dhex2num("0x7560"), name=3D"Poison"					}
+gBuffIcons[1039] =3D { iGumpID=3Dhex2num("0x7541"), name=3D"Bleed"					}
+gBuffIcons[1040] =3D { iGumpID=3Dhex2num("0x7545"), name=3D"Clumsy"					}
+gBuffIcons[1041] =3D { iGumpID=3Dhex2num("0x7552"), name=3D"Feeble Mind"		=
		}
+gBuffIcons[1042] =3D { iGumpID=3Dhex2num("0x7569"), name=3D"Weaken"					}
+gBuffIcons[1043] =3D { iGumpID=3Dhex2num("0x7548"), name=3D"Curse"					}
+gBuffIcons[1044] =3D { iGumpID=3Dhex2num("0x755a"), name=3D"Mass Curse"			=
	}
+gBuffIcons[1045] =3D { iGumpID=3Dhex2num("0x753c"), name=3D"Agility"					}
+gBuffIcons[1046] =3D { iGumpID=3Dhex2num("0x7547"), name=3D"Cunning"					}
+gBuffIcons[1047] =3D { iGumpID=3Dhex2num("0x7567"), name=3D"Strength"					}
+gBuffIcons[1048] =3D { iGumpID=3Dhex2num("0x7542"), name=3D"Bless"					}
+
+kUnknownBuffGumpID =3D hex2num("0x7555") -- (snakes)
+
+kBuffStartX =3D 0
+kBuffStartY =3D 64
+
+gBuffDialog =3D nil
+gBuffWidgetList =3D {}
+gBuffs =3D {}
+
+function SetBuffActive (buffid,bIsActive) =

+	print("SetBuffActive",buffid,bIsActive)
+	gBuffs[buffid] =3D bIsActive
+end
+
+-- returns widget,w,h
+function MakeBuffIconWidget (parent,iGumpID,x,y)
+	--~ iArtID =3D iArtID --  + hex2num("0x4000")
+	local hueid =3D 0
+	--~ local mat =3D GetArtMat(iArtID,hueid)
+	local mat =3D GetGumpMat(iGumpID,hueid)
+	if ((not mat) or mat =3D=3D "") then
+		print("WARNING ! MakeBuffIconWidget : material load failed for iGumpID=
=3D", iGumpID)
+		mat =3D "hudUnknown"
+	end
+	--~ local w,h =3D GetArtSize(iArtID,hueid)
+	local w,h =3D GetGumpSize(iGumpID,hueid)
+	local widget =3D guimaker.MakePlane(parent,mat,x,y,w,h)
+	local tw,th =3D texsize(w),texsize(h)
+	widget.gfx:SetUV(0,0,w/tw,h/th)
+	widget.mbIgnoreMouseOver =3D true
+	return widget,w,h
+end
+
+function Buffs_RebuildList() =

+	-- init dialog if needed
+	if (not gBuffDialog) then =

+		--~ BuffTestExportGumps() =

+		gBuffDialog =3D guimaker.MyCreateDialog() =

+	end
+	for k,widget in pairs(gBuffWidgetList) do widget:Destroy() end gBuffWidge=
tList =3D {}
+	=

+	local x =3D kBuffStartX
+	local y =3D kBuffStartY
+	for buffid,bActive in pairs(gBuffs) do
+		if (bActive) then =

+			local buff =3D gBuffIcons[buffid]
+			local widget,w,h =3D MakeBuffIconWidget(gBuffDialog,buff and buff.iGump=
ID or kUnknownBuffGumpID,x,y)
+			if (widget) then =

+				x =3D x + w
+				table.insert(gBuffWidgetList,widget)
+			end
+		end
+	end
+end
+
+-- add : argumentsmode_end=3D0,argumentsmode_start=3D0,argumentsmode_start=
if=3D0,buff_duration=3D0,clilocid1=3D1075655,clilocid2=3D1075656,icon_buffi=
d1=3D1012,icon_buffid2=3D1012,icon_show1=3D1,icon_show2=3D1,player_serial=
=3D72273,temp1=3D0,temp2=3D0,temp3=3D0,temp4=3D0,temp5=3D0,
+-- del : icon_buffid1=3D1012,icon_show1=3D0,player_serial=3D72273,temp1=3D=
0,
+function HandleBuffInfo (buffinfo)
+	SetBuffActive(buffinfo.icon_buffid1,buffinfo.icon_show1 =3D=3D 1)
+	Buffs_RebuildList()
+end
+
+
+--[[
+-- debug
+function BuffTestExportGumps ()
+	for iGumpID =3D hex2num("0x7500"),hex2num("0x75ff") do
+		ExportGumpMatTexture(iGumpID,sprintf("../old/mygumps/0x%04x.png",iGumpID=
))
+	end
+end
+
+function ExportGumpMatTexture (iGumpID,sFilePath)
+	ExportMatTexture(GetGumpMat(iGumpID,0),sFilePath)
+end
+
+function ExportMatTexture (sMatName,sFilePath)
+	if ((not sMatName) or sMatName =3D=3D "") then return end
+	local sTexName =3D GetTexture(sMatName)
+	print("ExportMatTexture",sMatName,sTexName,sFilePath)
+	--~ local texname		GetTexture	(sMatName,iTech=3D0,iPass=3D0,iTextureUnit=
=3D0)
+	local img =3D LoadImageFromTexture(sTexName)
+	img:SaveAsFile(sFilePath)
+	img:Destroy()
+end
+]]--
+--~ function TestBuff (buffid,bState) HandleBuffInfo({icon_buffid1=3Dbuffi=
d,icon_show1=3D(bState and 1 or 0)})  end
+--~ RegisterListener("keydown",	function (key) TestBuff(1012,true)  TestBu=
ff(1014,true) end)
+--~ RegisterListener("keyup",	function (key) TestBuff(1012,false) TestBuff=
(1014,false) end)
+

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Mon Jan 21 23:56:54 2008
@@ -94,6 +94,7 @@
 dofile(libpath .. "lib.tilefreewalk.lua")
 dofile(libpath .. "lib.oldwalk.lua")
 dofile(libpath .. "lib.bugreport.lua")
+dofile(libpath .. "lib.buff.lua")
 =

 dofile(libpath .. "gui/gui.main.lua")
 dofile(libpath .. "obj/obj.main.lua")

Modified: trunk/lua/net/net.buff.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.buff.lua (original)
+++ trunk/lua/net/net.buff.lua Mon Jan 21 23:56:54 2008
@@ -115,12 +115,12 @@
 	print("spell buff packet received !!!!!!!!!!",packetsize)
 	buffinfos.player_serial	=3D input:PopNetUint32()
 =

-	buffinfos.icon_artid1		=3D input:PopNetUint16()
+	buffinfos.icon_buffid1		=3D input:PopNetUint16()
 	buffinfos.icon_show1		=3D input:PopNetUint16() -- runuo : 0x1 //Type 0 fo=
r removal. 1 for add 2 for Data
 	buffinfos.temp1			=3D input:PopNetUint32()
 =

 	if (packetsize > 15) then
-		buffinfos.icon_artid2		=3D input:PopNetUint16() -- same as above
+		buffinfos.icon_buffid2		=3D input:PopNetUint16() -- same as above
 		buffinfos.icon_show2		=3D input:PopNetUint16() -- runuo : 0x1 //Type 0 f=
or removal. 1 for add 2 for Data, same as above
 		buffinfos.temp2			=3D input:PopNetUint32()
 	=

@@ -156,6 +156,7 @@
 	end
 	=

 	print(vardump2(buffinfos))
+	HandleBuffInfo(buffinfos)
 end
 =

 --[[
@@ -167,8 +168,8 @@
 buff_duration=3D0
 clilocid1=3D1075655   gClilocLoader:Get(text_messagenum)
 clilocid2=3D1075656   gClilocLoader:Get(text_messagenum)
-icon_artid1=3D1012
-icon_artid2=3D1012
+icon_buffid1=3D1012
+icon_buffid2=3D1012
 icon_show1=3D1
 icon_show2=3D1
 player_serial=3D141163



From no-reply at zwischenwelt.org  Tue Jan 22 03:59:13 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 02:59:13 -0000
Subject: [Iris-commit] [IRIS] r1832 - in /trunk: data/config.lua.dist
	lua/lib.gui.iris.lua
Message-ID: <20080122025913.C25E91C186FC@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Jan 22 03:59:11 2008
New Revision: 1832

Log:
option to disable bottomline text, mainly for screenshots

Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.gui.iris.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Tue Jan 22 03:59:11 2008
@@ -424,3 +424,5 @@
 gAtlasRes =3D "med" --"med", "low", "ultralow", "none"	(none stands for: u=
se highest single textures)
 =

 gQuickCompassMD5Check =3D false -- if true : only checks file-paths instea=
d of file contents, WARNING : doesn't detect updates
+
+gDisableBottomLine =3D false -- the debug display at the bottom of the scr=
een

Modified: trunk/lua/lib.gui.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gui.iris.lua (original)
+++ trunk/lua/lib.gui.iris.lua Tue Jan 22 03:59:11 2008
@@ -28,7 +28,7 @@
 end
 =

 -- text-line at the bottom of screen (readonly, used for mousepicking debu=
g text and for info during loading)
-function Client_SetBottomLine (text) SetBottomLine(text) end -- from lugre
+function Client_SetBottomLine (text) if (not gDisableBottomLine) then SetB=
ottomLine(text) end end -- from lugre
 =

 gMemStats_NextUpdate =3D 0
 function DisplayMemoryUsage (memoryusage)



From no-reply at zwischenwelt.org  Tue Jan 22 13:34:56 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 12:34:56 -0000
Subject: [Iris-commit] [IRIS] r1833 - /trunk/lua/lib.3d.map.lua
Message-ID: <20080122123456.5C0CD1C186F0@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Jan 22 13:34:55 2008
New Revision: 1833

Log:
tolerance for blendout-height-change

Modified:
    trunk/lua/lib.3d.map.lua

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Tue Jan 22 13:34:55 2008
@@ -578,6 +578,11 @@
 		end
 		--~ print("blendout",playerIsInside,playerheadpos,zloc_roof)
 	end
+	=

+	-- a bit of tolerance to avoid rebatching all the time for uneven floors
+	if (self.giBlendOutCurZ and myLayer and math.abs(self.giBlendOutCurZ-myLa=
yer) <=3D 2) then
+		myLayer =3D self.giBlendOutCurZ =

+	end
 =

 	-- only update if changed
 	if (self.giBlendOutCurZ ~=3D myLayer or self.gbBlendOutTerrainVisible ~=
=3D bTerrainVisible) then



From no-reply at zwischenwelt.org  Tue Jan 22 19:18:09 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 18:18:09 -0000
Subject: [Iris-commit] [IRIS] r1834 - /trunk/data/terrain/programs/
Message-ID: <20080122181809.5D6051C186F0@zwischenwelt.org>

Author: sience
Date: Tue Jan 22 19:18:07 2008
New Revision: 1834

Log:
-some obsolete path removed

Removed:
    trunk/data/terrain/programs/



From no-reply at zwischenwelt.org  Tue Jan 22 19:18:36 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 18:18:36 -0000
Subject: [Iris-commit] [IRIS] r1835 - /trunk/data/models/programs/
Message-ID: <20080122181836.4DD351C186F0@zwischenwelt.org>

Author: sience
Date: Tue Jan 22 19:18:33 2008
New Revision: 1835

Log:
-some obsolete path removed 2

Removed:
    trunk/data/models/programs/



From no-reply at zwischenwelt.org  Tue Jan 22 19:18:52 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 18:18:52 -0000
Subject: [Iris-commit] [IRIS] r1836 - in /trunk/data/custom: meta/ programs/
Message-ID: <20080122181853.4FDD41C186F0@zwischenwelt.org>

Author: sience
Date: Tue Jan 22 19:18:52 2008
New Revision: 1836

Log:
-some obsolete path removed 3

Removed:
    trunk/data/custom/meta/
    trunk/data/custom/programs/



From no-reply at zwischenwelt.org  Tue Jan 22 20:03:39 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 19:03:39 -0000
Subject: [Iris-commit] [IRIS] r1837 - in /trunk: data/config.lua.dist
 lua/lib.3d.map.lua lua/lib.buff.lua
Message-ID: <20080122190339.7991B1C186F0@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Jan 22 20:03:39 2008
New Revision: 1837

Log:
option to disable water for testing : gDisableWater

Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.buff.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Tue Jan 22 20:03:39 2008
@@ -426,3 +426,5 @@
 gQuickCompassMD5Check =3D false -- if true : only checks file-paths instea=
d of file contents, WARNING : doesn't detect updates
 =

 gDisableBottomLine =3D false -- the debug display at the bottom of the scr=
een
+
+gDisableWater =3D false -- for debugging

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Tue Jan 22 20:03:39 2008
@@ -128,7 +128,7 @@
 	local bDidLoad =3D false
 	if (not self.gMapChunks[y]) then self.gMapChunks[y] =3D {} end
 	if ((not self.gMapChunks[y][x]) or self.gMapChunks[y][x].bIsDead) then
-		--print("LoadMapChunk",x,y)
+		--~ print("LoadMapChunk "..x..","..y)
 		self.gMapChunks[y][x] =3D self:CreateMapChunk(x,y)
 		bDidLoad =3D true
 	end
@@ -205,9 +205,9 @@
 	entity.iTileTypeID =3D iTileTypeID
 	entity.iHue =3D iHue
 	=

-	local staticwatertile =3D true
+	local staticwatertile =3D true -- true if not water ?
 	-- add level
-	if FilterIsStaticWater(iTileTypeID) then
+	if (not gDisableWater) and FilterIsStaticWater(iTileTypeID) then
 		local z =3D entity.zloc
 		local bx =3D chunk.miX * self.ROBMAP_CHUNK_SIZE * 8
 		local by =3D chunk.miY * self.ROBMAP_CHUNK_SIZE * 8
@@ -296,24 +296,26 @@
 	chunk.pStaticGeometryLayers =3D {}
 =

 	-- water stats
-	chunk.mWaterZMap =3D {}		-- local z height [x.."_"..y]
-	chunk.SetWaterZWithoutBorder =3D function(self, tx, ty, z)
-		if (tx >=3D 0 and ty >=3D 0 and tx < Renderer3D.ROBMAP_CHUNK_SIZE * 8 an=
d ty < Renderer3D.ROBMAP_CHUNK_SIZE * 8) then
-			self.mWaterZMap[tx.."_"..ty] =3D math.max(self.mWaterZMap[tx.."_"..ty] =
or z, z)
-		end
-	end
-	chunk.SetWaterZ =3D function(self, tx, ty, z)
-		self:SetWaterZWithoutBorder(tx,ty,z)
-		-- set border of 1 tile
-		self:SetWaterZWithoutBorder(tx+1,ty+0,z)
-		self:SetWaterZWithoutBorder(tx-1,ty+0,z)
-		self:SetWaterZWithoutBorder(tx+0,ty+1,z)
-		self:SetWaterZWithoutBorder(tx+0,ty-1,z)
-		=

-		self:SetWaterZWithoutBorder(tx+1,ty+1,z)
-		self:SetWaterZWithoutBorder(tx-1,ty-1,z)
-		self:SetWaterZWithoutBorder(tx+1,ty-1,z)
-		self:SetWaterZWithoutBorder(tx-1,ty+1,z)
+	if (not gDisableWater) then
+		chunk.mWaterZMap =3D {}		-- local z height [x.."_"..y]
+		chunk.SetWaterZWithoutBorder =3D function(self, tx, ty, z)
+			if (tx >=3D 0 and ty >=3D 0 and tx < Renderer3D.ROBMAP_CHUNK_SIZE * 8 a=
nd ty < Renderer3D.ROBMAP_CHUNK_SIZE * 8) then
+				self.mWaterZMap[tx.."_"..ty] =3D math.max(self.mWaterZMap[tx.."_"..ty]=
 or z, z)
+			end
+		end
+		chunk.SetWaterZ =3D function(self, tx, ty, z)
+			self:SetWaterZWithoutBorder(tx,ty,z)
+			-- set border of 1 tile
+			self:SetWaterZWithoutBorder(tx+1,ty+0,z)
+			self:SetWaterZWithoutBorder(tx-1,ty+0,z)
+			self:SetWaterZWithoutBorder(tx+0,ty+1,z)
+			self:SetWaterZWithoutBorder(tx+0,ty-1,z)
+			=

+			self:SetWaterZWithoutBorder(tx+1,ty+1,z)
+			self:SetWaterZWithoutBorder(tx-1,ty-1,z)
+			self:SetWaterZWithoutBorder(tx+1,ty-1,z)
+			self:SetWaterZWithoutBorder(tx-1,ty+1,z)
+		end
 	end
 	=

 	-- start fastbatch
@@ -325,16 +327,19 @@
 	local iBlockUO_X =3D x * self.ROBMAP_CHUNK_SIZE
 	local iBlockUO_Y =3D y * self.ROBMAP_CHUNK_SIZE
 	=

-	if (gGroundBlockLoader) then
-		for bx =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
-			for by =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
-				for lx =3D 0,7 do
-					for ly =3D 0,7 do
-						local tiletype,z =3D gGroundBlockLoader:GetTile(iBlockUO_X+bx,iBlock=
UO_Y+by,lx,ly)
-						local tx,ty =3D lx + (bx*8), ly + (by*8)
-						=

-						if tiletype and FilterIsMapWater(tiletype) then
-							chunk:SetWaterZ(tx,ty,z)
+	-- water analysis
+	if (not gDisableWater) then
+		if (gGroundBlockLoader) then
+			for bx =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
+				for by =3D 0,self.ROBMAP_CHUNK_SIZE-1 do
+					for lx =3D 0,7 do
+						for ly =3D 0,7 do
+							local tiletype,z =3D gGroundBlockLoader:GetTile(iBlockUO_X+bx,iBloc=
kUO_Y+by,lx,ly)
+							local tx,ty =3D lx + (bx*8), ly + (by*8)
+							=

+							if tiletype and FilterIsMapWater(tiletype) then
+								chunk:SetWaterZ(tx,ty,z)
+							end
 						end
 					end
 				end
@@ -435,52 +440,54 @@
 	end
 =

 	-- WATER
-	local count =3D countarr(chunk.mWaterZMap)
-	=

-	if (gEnableMultiTexTerrain and count and count > 0) then
-	=

-		local tiles =3D self.ROBMAP_CHUNK_SIZE * 8
-		=

-		-- print("DEBUG",chunk,"mostz",mostz)
-		=

-		-- create water
-		local gfx =3D CreateRootGfx3D()
-		local vc =3D 4 * count
-		local ic =3D 6 * count
-		=

-		gfx:SetSimpleRenderable()
-		=

-		gfx:RenderableBegin(vc,ic,false,false,OT_TRIANGLE_LIST)
-		=

-		-- print("DEBUG","WATERSTART",count,vc,ic)
-		local index =3D 0
-		for k,v in pairs(chunk.mWaterZMap) do
-			local x,y =3D unpack(strsplit("_",k))
-			local z =3D chunk.mWaterZMap[x.."_"..y] * 0.1
-
-			-- print("DEBUG","water tile",x,y,z,k,v)
-
-			gfx:RenderableVertex(-x,y,z, 0,0,1, x/tiles, y/tiles)
-			gfx:RenderableVertex(-x-1,y,z, 0,0,1, (x+1)/tiles, y/tiles)
-			gfx:RenderableVertex(-x,y+1,z, 0,0,1, x/tiles, (y+1)/tiles)
-			gfx:RenderableVertex(-x-1,y+1,z, 0,0,1, (x+1)/tiles, (y+1)/tiles)
-			=

-			gfx:RenderableIndex3(index+0, index+2, index+1)
-			gfx:RenderableIndex3(index+1, index+2, index+3)
-			=

-			index =3D index + 4
-		end
-
-		gfx:RenderableEnd()
-
-		gfx:SetMaterial("water")
-		gfx:SetCastShadows(false)
-		=

-		local x,y,z =3D self:UOPosToLocal(chunk.miX * self.ROBMAP_CHUNK_SIZE * 8=
, chunk.miY * self.ROBMAP_CHUNK_SIZE * 8, 0.1)
-
-		gfx:SetPosition(x, y, z)
-		=

-		chunk.mWaterGfx =3D gfx
+	if (not gDisableWater) then
+		local count =3D countarr(chunk.mWaterZMap) -- might be slow
+		=

+		if (gEnableMultiTexTerrain and count and count > 0) then
+		=

+			local tiles =3D self.ROBMAP_CHUNK_SIZE * 8
+			=

+			-- print("DEBUG",chunk,"mostz",mostz)
+			=

+			-- create water
+			local gfx =3D CreateRootGfx3D()
+			local vc =3D 4 * count
+			local ic =3D 6 * count
+			=

+			gfx:SetSimpleRenderable()
+			=

+			gfx:RenderableBegin(vc,ic,false,false,OT_TRIANGLE_LIST)
+			=

+			-- print("DEBUG","WATERSTART",count,vc,ic)
+			local index =3D 0
+			for k,v in pairs(chunk.mWaterZMap) do
+				local x,y =3D unpack(strsplit("_",k))
+				local z =3D chunk.mWaterZMap[x.."_"..y] * 0.1
+
+				-- print("DEBUG","water tile",x,y,z,k,v)
+
+				gfx:RenderableVertex(-x,y,z, 0,0,1, x/tiles, y/tiles)
+				gfx:RenderableVertex(-x-1,y,z, 0,0,1, (x+1)/tiles, y/tiles)
+				gfx:RenderableVertex(-x,y+1,z, 0,0,1, x/tiles, (y+1)/tiles)
+				gfx:RenderableVertex(-x-1,y+1,z, 0,0,1, (x+1)/tiles, (y+1)/tiles)
+				=

+				gfx:RenderableIndex3(index+0, index+2, index+1)
+				gfx:RenderableIndex3(index+1, index+2, index+3)
+				=

+				index =3D index + 4
+			end
+
+			gfx:RenderableEnd()
+
+			gfx:SetMaterial("water")
+			gfx:SetCastShadows(false)
+			=

+			local x,y,z =3D self:UOPosToLocal(chunk.miX * self.ROBMAP_CHUNK_SIZE * =
8, chunk.miY * self.ROBMAP_CHUNK_SIZE * 8, 0.1)
+
+			gfx:SetPosition(x, y, z)
+			=

+			chunk.mWaterGfx =3D gfx
+		end
 	end
 =

 	return chunk

Modified: trunk/lua/lib.buff.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.buff.lua (original)
+++ trunk/lua/lib.buff.lua Tue Jan 22 20:03:39 2008
@@ -5,6 +5,11 @@
 =

 Notes: =

 This is a submitted packet, information here is yet to be verified. Use at=
 own risk. =

+
+buff icon holder: 0x757F or 0x7580 or 0x7581 or 0x7582 =

+buff icon holder button: 0x7583,0x7584,0x7585,0x7586
+guild button  - 0x57B2, 0x57B3, 0x57B4
+quests button - 0x57B5, 0x57B6, 0x57B7
 =

 gumpid 0x756 and following : buff-bar gumps
 unknown : 0x7555(snakes),0x7556(man,justice-spell?),0x7564(run),0x753A(?)



From no-reply at zwischenwelt.org  Tue Jan 22 20:48:39 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 19:48:39 -0000
Subject: [Iris-commit] [IRIS] r1838 - /rawdata/sd_pd/topf.blend
Message-ID: <20080122194839.3C3C31C186F0@zwischenwelt.org>

Author: hagish
Date: Tue Jan 22 20:48:38 2008
New Revision: 1838

Log:
update blender file

Modified:
    rawdata/sd_pd/topf.blend

Modified: rawdata/sd_pd/topf.blend
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Tue Jan 22 21:42:33 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 20:42:33 -0000
Subject: [Iris-commit] [IRIS] r1839 - in /trunk/data: models/atlas/
 models/misc/ profiles/ terrain/materials/
Message-ID: <20080122210007.2C2341C186F0@zwischenwelt.org>

Author: sience
Date: Tue Jan 22 21:42:33 2008
New Revision: 1839

Log:
-medium tex-atlase converted to DDS (saved 20mb vram)
-materials updated
-gfx_high.lua updated
-comments removed

Added:
    trunk/data/models/atlas/tex_atlas_alpha_med0.dds   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_med1.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med0.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med1.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med2.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med3.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med4.dds   (with props)
    trunk/data/models/misc/
    trunk/data/models/misc/models_alpha_textures_dds_profile.dpf
Modified:
    trunk/data/models/atlas/tex_atlas_alpha_med.material
    trunk/data/models/atlas/tex_atlas_med.material
    trunk/data/profiles/gfx_high.lua
    trunk/data/terrain/materials/terrain.material

Modified: trunk/data/models/atlas/tex_atlas_alpha_med.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_alpha_med.material (original)
+++ trunk/data/models/atlas/tex_atlas_alpha_med.material Tue Jan 22 21:42:3=
3 2008
@@ -6,7 +6,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_alpha_med0.png =

+				texture tex_atlas_alpha_med0.dds =

 			}	=

 		}
 	} =

@@ -19,7 +19,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_alpha_med1.png =

+				texture tex_atlas_alpha_med1.dds =

 			}	=

 		}
 	} =


Modified: trunk/data/models/atlas/tex_atlas_med.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_med.material (original)
+++ trunk/data/models/atlas/tex_atlas_med.material Tue Jan 22 21:42:33 2008
@@ -6,7 +6,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med0.png =

+				texture tex_atlas_med0.dds =

 			}	=

 		}
 	} =

@@ -19,7 +19,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med1.png =

+				texture tex_atlas_med1.dds =

 			}	=

 		}
 	} =

@@ -32,7 +32,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med2.png =

+				texture tex_atlas_med2.dds =

 			}	=

 		}
 	} =

@@ -45,7 +45,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med3.png =

+				texture tex_atlas_med3.dds =

 			}	=

 		}
 	} =

@@ -58,7 +58,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med4.png =

+				texture tex_atlas_med4.dds =

 			}	=

 		}
 	} =


Modified: trunk/data/profiles/gfx_high.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/profiles/gfx_high.lua (original)
+++ trunk/data/profiles/gfx_high.lua Tue Jan 22 21:42:33 2008
@@ -2,6 +2,8 @@
 gFastBatchDynamics =3D true
 =

 gAtlasRes =3D "none"
+gFastBatchStatics =3D false
+gFastBatchDynamics =3D false
 =

 gUseDistanceFog =3D true
 =


Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Tue Jan 22 21:42:33 2008
@@ -14,8 +14,6 @@
 			texture_unit
 			{
 				// draws ground and applies diffuse lighting
-				// texture terrain_tex_atlas_1024.dds
-				// texture terrain_tex_atlas_256.dds
 				texture terrain_tex_atlas_256.png
 				tex_coord_set	0
 				colour_op_ex	modulate src_texture src_diffuse



From no-reply at zwischenwelt.org  Tue Jan 22 22:47:58 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 21:47:58 -0000
Subject: [Iris-commit] [IRIS] r1840 - in /trunk:
 data/models/models/to_003000/mdl_002237.mesh
 data/models/models/to_003000/mdl_002238.mesh
 data/models/models/to_003000/mdl_002240.mesh lua/filter/filter.art.lua
 lua/lib.debugmenu.lua
Message-ID: <20080122214759.5710E1C186F0@zwischenwelt.org>

Author: hagish
Date: Tue Jan 22 22:47:58 2008
New Revision: 1840

Log:
added some models

Added:
    trunk/data/models/models/to_003000/mdl_002237.mesh   (with props)
    trunk/data/models/models/to_003000/mdl_002238.mesh   (with props)
    trunk/data/models/models/to_003000/mdl_002240.mesh   (with props)
Modified:
    trunk/lua/filter/filter.art.lua
    trunk/lua/lib.debugmenu.lua

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Tue Jan 22 22:47:58 2008
@@ -69,6 +69,11 @@
 --closed
 gArtFilter[2643]=3D{maptoid=3D2639,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
 =

+
+gArtFilter[2236]=3D{maptoid=3D2237,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D0,zadd=3D0}
+gArtFilter[2239]=3D{maptoid=3D2238,rotation=3D"x:0,y:0,z:-90",xadd=3D0,yad=
d=3D0,zadd=3D0}
+
+
 --Groundtiles (static)
 --dirt
 gArtFilter[12789]=3D{maptoid=3D12788}

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Tue Jan 22 22:47:58 2008
@@ -568,6 +568,8 @@
 		local iHue =3D gDebugMenuAnimIndex
 		local info =3D GetStaticTileType(iTileType)
 		local meshname =3D GetMeshName(iTileType,iHue)
+		if gDebugLastMeshName then ReloadMesh(gDebugLastMeshName) end
+		gDebugLastMeshName =3D meshname
 		local tricount =3D meshname and CountMeshTriangles(meshname) or 0
 		AddFadeLines(sprintf("static %04x(=3D%d) hue=3D%d tricount=3D%d %s",iTil=
eType,iTileType,iHue,tricount,GetStaticTileTypeName(iTileType) or ""))
 		if (meshname and meshname ~=3D false) then



From no-reply at zwischenwelt.org  Tue Jan 22 22:48:41 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 21:48:41 -0000
Subject: [Iris-commit] [IRIS] r1841 - in /rawdata/sd_pd: items.blend
	topf.blend
Message-ID: <20080122214841.39D7E1C186DA@zwischenwelt.org>

Author: hagish
Date: Tue Jan 22 22:48:40 2008
New Revision: 1841

Log:
item blend file update

Added:
    rawdata/sd_pd/items.blend
      - copied, changed from r1838, rawdata/sd_pd/topf.blend
Removed:
    rawdata/sd_pd/topf.blend



From no-reply at zwischenwelt.org  Wed Jan 23 00:27:08 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 23:27:08 -0000
Subject: [Iris-commit] [IRIS] r1842 - in /trunk/data/models/atlas:
 tex_atlas_alpha_med.material tex_atlas_alpha_med0.dds
 tex_atlas_alpha_med1.dds tex_atlas_med.material tex_atlas_med0.dds
 tex_atlas_med1.dds tex_atlas_med2.dds tex_atlas_med3.dds tex_atlas_med4.dds
Message-ID: <20080123000021.8DBE31C1873D@zwischenwelt.org>

Author: sience
Date: Wed Jan 23 00:27:06 2008
New Revision: 1842

Log:
-dds removed. opengl has some problem with dds using alpha channels.

Removed:
    trunk/data/models/atlas/tex_atlas_alpha_med0.dds
    trunk/data/models/atlas/tex_atlas_alpha_med1.dds
    trunk/data/models/atlas/tex_atlas_med0.dds
    trunk/data/models/atlas/tex_atlas_med1.dds
    trunk/data/models/atlas/tex_atlas_med2.dds
    trunk/data/models/atlas/tex_atlas_med3.dds
    trunk/data/models/atlas/tex_atlas_med4.dds
Modified:
    trunk/data/models/atlas/tex_atlas_alpha_med.material
    trunk/data/models/atlas/tex_atlas_med.material

Modified: trunk/data/models/atlas/tex_atlas_alpha_med.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_alpha_med.material (original)
+++ trunk/data/models/atlas/tex_atlas_alpha_med.material Wed Jan 23 00:27:0=
6 2008
@@ -6,7 +6,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_alpha_med0.dds =

+				texture tex_atlas_alpha_med0.png =

 			}	=

 		}
 	} =

@@ -19,7 +19,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_alpha_med1.dds =

+				texture tex_atlas_alpha_med1.png =

 			}	=

 		}
 	} =


Modified: trunk/data/models/atlas/tex_atlas_med.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_med.material (original)
+++ trunk/data/models/atlas/tex_atlas_med.material Wed Jan 23 00:27:06 2008
@@ -6,7 +6,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med0.dds =

+				texture tex_atlas_med0.png =

 			}	=

 		}
 	} =

@@ -19,7 +19,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med1.dds =

+				texture tex_atlas_med1.png =

 			}	=

 		}
 	} =

@@ -32,7 +32,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med2.dds =

+				texture tex_atlas_med2.png =

 			}	=

 		}
 	} =

@@ -45,7 +45,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med3.dds =

+				texture tex_atlas_med3.png =

 			}	=

 		}
 	} =

@@ -58,7 +58,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med4.dds =

+				texture tex_atlas_med4.png =

 			}	=

 		}
 	} =




From no-reply at zwischenwelt.org  Wed Jan 23 00:29:05 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 23:29:05 -0000
Subject: [Iris-commit] [IRIS] r1843 - in /trunk: data/models/materials/
 data/models/models/to_004000/ data/models/textures/ lua/filter/
Message-ID: <20080123000021.A28E11C18740@zwischenwelt.org>

Author: hagish
Date: Wed Jan 23 00:29:05 2008
New Revision: 1843

Log:
mushroom mania

Added:
    trunk/data/models/models/to_004000/mdl_003340.mesh   (with props)
    trunk/data/models/models/to_004000/mdl_003341.mesh   (with props)
    trunk/data/models/models/to_004000/mdl_003342.mesh   (with props)
    trunk/data/models/models/to_004000/mdl_003346.mesh   (with props)
    trunk/data/models/models/to_004000/mdl_003347.mesh   (with props)
    trunk/data/models/models/to_004000/mdl_003348.mesh   (with props)
    trunk/data/models/textures/tex_mushroom2.png   (with props)
Modified:
    trunk/data/models/materials/textures.material
    trunk/lua/filter/filter.art.lua

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Wed Jan 23 00:29:05 2008
@@ -8241,3 +8241,17 @@
 		}
 	} =

 }
+
+material tex_mushroom2 : tex_base
+{ =

+	technique =

+	{ =

+		pass
+		{		=

+			texture_unit =

+			{ =

+				texture tex_mushroom2.png =

+			}	=

+		}
+	} =

+}

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Wed Jan 23 00:29:05 2008
@@ -73,6 +73,10 @@
 gArtFilter[2236]=3D{maptoid=3D2237,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D0,zadd=3D0}
 gArtFilter[2239]=3D{maptoid=3D2238,rotation=3D"x:0,y:0,z:-90",xadd=3D0,yad=
d=3D0,zadd=3D0}
 =

+gArtFilter[3343]=3D{maptoid=3D3340,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
+gArtFilter[3344]=3D{maptoid=3D3342,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
+gArtFilter[3345]=3D{maptoid=3D3341,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
+
 =

 --Groundtiles (static)
 --dirt



From no-reply at zwischenwelt.org  Wed Jan 23 00:48:37 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 22 Jan 2008 23:48:37 -0000
Subject: [Iris-commit] [IRIS] r1844 - in /trunk/data/models:
 models/to_004000/mdl_003253.mesh textures/tex_grass.png
Message-ID: <20080123000021.D60381C18742@zwischenwelt.org>

Author: hagish
Date: Wed Jan 23 00:48:36 2008
New Revision: 1844

Log:
improved grass model

Modified:
    trunk/data/models/models/to_004000/mdl_003253.mesh
    trunk/data/models/textures/tex_grass.png

Modified: trunk/data/models/models/to_004000/mdl_003253.mesh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/textures/tex_grass.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Wed Jan 23 18:18:32 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 23 Jan 2008 17:18:32 -0000
Subject: [Iris-commit] [IRIS] r1845 - in /trunk: data/config.lua.dist
 data/terrain/materials/terrain.material lua/lib.3d.map.lua
 lua/lib.terrain.multitex.lua
Message-ID: <20080123180005.5B9101C1873A@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Jan 23 18:18:32 2008
New Revision: 1845

Log:
experimental terrain LOD : set to try :  gEnableLowDetailTerrainFarSight =
=3D true =


Modified:
    trunk/data/config.lua.dist
    trunk/data/terrain/materials/terrain.material
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.terrain.multitex.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Wed Jan 23 18:18:32 2008
@@ -428,3 +428,5 @@
 gDisableBottomLine =3D false -- the debug display at the bottom of the scr=
een
 =

 gDisableWater =3D false -- for debugging
+
+gEnableLowDetailTerrainFarSight =3D false -- additional lower quality terr=
ain in the distance

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Wed Jan 23 18:18:32 2008
@@ -1,6 +1,23 @@
 //###########################################
 // MULTITEXTURE TERRAIN MAT
 //###########################################
+
+// simple material without transitions
+material terrain_multitex_far
+{
+	receive_shadows off
+	technique
+	{
+		pass
+		{
+			texture_unit
+			{
+				texture terrain_tex_atlas_256.png
+				tex_coord_set	0
+			}
+		}
+	}
+}
 =

 // simple material without transitions
 material terrain_multitex_simple_mat

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Wed Jan 23 18:18:32 2008
@@ -9,6 +9,7 @@
 Renderer3D.gbBlendOutTerrainVisible =3D true
 Renderer3D.gMapUpdateInterval =3D 100 -- update the map not every frame, d=
ecrease for fly-videos
 Renderer3D.gMaxMapBlocksLoadedPerUpdate =3D 1 -- increase for fly-videos
+Renderer3D.gLowDetailTerrainNeedsRebuild =3D true
 =

 -- the whole map cache consists of (ROBMAP_RECENTER_DIST*2)*(ROBMAP_RECENT=
ER_DIST*2)  chunks
 -- every chunk consists of ROBMAP_CHUNK_SIZE*ROBMAP_CHUNK_SIZE blocks
@@ -64,6 +65,86 @@
 	end
 end
 =

+-- returns tiletype,z        posx,posy in absolute tilecoords
+function GetGroundAtAbsPos (posx,posy)
+	local bx,by =3D math.floor(posx/8),math.floor(posy/8)
+	return gGroundBlockLoader:GetTile(bx,by,posx-8*bx,posy-8*by)
+end
+
+-- param is the area where normal mapblocks are loaded
+function Renderer3D:RebuildLowDetailTerrain (minx,maxx,miny,maxy)
+	if (not Renderer3D.gLowDetailTerrainNeedsRebuild) then return end
+	self.gLowDetailTerrainNeedsRebuild =3D false
+	if (gLowDetailTerrain) then gLowDetailTerrain:Destroy() gLowDetailTerrain=
 =3D nil end
+	if (not gGroundBlockLoader) then return end
+	if (not gEnableLowDetailTerrainFarSight) then return end
+	if (gKeyPressed[key_lshift]) then return end
+	--~ if (true) then return end
+	=

+	-- the border around the input area in which lowlevel chunks should be
+	local b =3D 2
+	=

+	-- count chunks that need lowlevel display (for allocating renderable)
+	local lowlist =3D {}
+	for y=3Dminy-b,maxy+b do
+	for x=3Dminx-b,maxx+b do
+		if (not self:IsMapChunkLoaded(x,y)) then table.insert(lowlist,{x=3Dx,y=
=3Dy}) end
+	end
+	end
+	=

+	-- allocate renderable from lowcount
+	gLowDetailTerrain =3D CreateRootGfx3D()
+	gLowDetailTerrain:SetSimpleRenderable()
+	local gfx =3D gLowDetailTerrain
+	local cs =3D self.ROBMAP_CHUNK_SIZE
+	local polycount =3D (2*2) * (cs * cs) * table.getn(lowlist) -- each lowli=
st entry is one chunk, each chunk is cx*cx mapblocks, we use 2*2 polys for =
each
+	local vc =3D 4 * polycount
+	local ic =3D 6 * polycount
+	gfx:RenderableBegin(vc,ic,false,false,OT_TRIANGLE_LIST)
+	=

+	-- generate geometry
+	local vertexnum =3D 0
+	for k,low in pairs(lowlist) do
+		local bx0 =3D low.x * cs
+		local by0 =3D low.y * cs
+		for bx =3D bx0,bx0 + cs-1 do -- iBlockUO_X
+		for by =3D by0,by0 + cs-1 do
+			for px=3D0,1 do
+			for py=3D0,1 do
+				local x =3D 8*bx+4*px
+				local y =3D 8*by+4*py
+				local tiletype00,z00 =3D GetGroundAtAbsPos(x+0,y+0)
+				local tiletype01,z01 =3D GetGroundAtAbsPos(x+0,y+4)
+				local tiletype10,z10 =3D GetGroundAtAbsPos(x+4,y+0)
+				local tiletype11,z11 =3D GetGroundAtAbsPos(x+4,y+4)
+				=

+				local u0,v0,w,h =3D MultiTexGetTexCoordsForTiletype(tiletype00)
+				if (not u0) then u0,v0,w,h =3D 0,0,1/16,1/16 end
+				local u1,v1 =3D u0+w*4,v0+h*4
+				gfx:RenderableVertex(-x  ,y  ,z00*0.1, 0,0,1, u0,v0)
+				gfx:RenderableVertex(-x-4,y  ,z10*0.1, 0,0,1, u1,v0)
+				gfx:RenderableVertex(-x  ,y+4,z01*0.1, 0,0,1, u0,v1)
+				gfx:RenderableVertex(-x-4,y+4,z11*0.1, 0,0,1, u1,v1)
+				=

+				gfx:RenderableIndex3(vertexnum+0, vertexnum+2, vertexnum+1)
+				gfx:RenderableIndex3(vertexnum+1, vertexnum+2, vertexnum+3)
+				=

+				vertexnum =3D vertexnum + 4
+			end
+			end
+		end
+		end
+	end
+	=

+	-- finish renderable
+	gfx:RenderableEnd()
+	gfx:SetMaterial("terrain_multitex_far")
+	gfx:SetCastShadows(false)
+	local x,y,z =3D self:UOPosToLocal(0,0,0)
+	gfx:SetPosition(x, y, z)
+end
+
+
 -- these coordinates are in absolute map-blocks, all others are in chunks
 function Renderer3D:UpdateMapCache (iMidX,iMidY,iRad)
 		local minx =3D math.floor((iMidX-iRad) / self.ROBMAP_CHUNK_SIZE)
@@ -105,6 +186,8 @@
 				end
 			end
 		end
+		=

+		self:RebuildLowDetailTerrain(minx,maxx,miny,maxy)
 end
 =

 -- rebuild chunk at uo pos
@@ -133,6 +216,13 @@
 		bDidLoad =3D true
 	end
 	return bDidLoad
+end
+
+function Renderer3D:IsMapChunkLoaded (x,y)
+	if (not self.gMapChunks[y]) then return false end
+	local chunk =3D self.gMapChunks[y][x]
+	if ((not chunk) or chunk.bIsDead) then return false end
+	return true
 end
 =

 function Renderer3D:ClearMapCache ()
@@ -289,6 +379,8 @@
 function Renderer3D:CreateMapChunk (x,y)
 	if ((x < 0) or (y < 0)) then return end	-- we might also check the heighs=
t value !?
 	=

+	self.gLowDetailTerrainNeedsRebuild =3D true
+		=

 	local chunk =3D {}
 	chunk.bIsDead =3D false
 	chunk.miX =3D x
@@ -642,6 +734,7 @@
 function Renderer3D:DestroyMapChunk (x,y,chunk)
 	chunk.mbRebuild =3D nil
 	if (not chunk.bIsDead) then
+		self.gLowDetailTerrainNeedsRebuild =3D true
 		--print("DestroyMapChunk",x,y)
 		chunk.bIsDead =3D true
 		if (chunk.mWaterGfx) then chunk.mWaterGfx:Destroy() chunk.mWaterGfx =3D =
nil end

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Wed Jan 23 18:18:32 2008
@@ -50,6 +50,18 @@
 gMultiTexTerrain_GfxList =3D {}
 kMultiTexTerrainChunkSize =3D 2
 =

+gMultiTexTerrainTypeTexCoords =3D {} -- key:multitex-index,value=3D{u0,v0,=
w,h}
+gMultiTexTerrainTypeLookup =3D {} -- key:uoid,value:multitex-index
+
+-- returns u0,v0,w,h
+function MultiTexGetTexCoordsForTiletype (uoid)
+	local mtindex =3D gMultiTexTerrainTypeLookup[uoid]
+	if (not mtindex) then return end
+	local coords =3D gMultiTexTerrainTypeTexCoords[mtindex]
+	if (not coords) then return end
+	return unpack(coords)
+end
+
 function MultiTexTerrainInit ()
 	if (not gEnableMultiTexTerrain) then return end
 	=

@@ -62,21 +74,22 @@
 	-- TexCoordSet 0 : ground
 	--~ TerrainMultiTex_AddTexCoordSet(0, 0*e,0*e,f,f)
 	--~ TerrainMultiTex_AddTexCoordSet(0, 1*e,0*e,f,f)
-	local mylookup =3D {}
 	for k1,name in pairs(gMultiTextureAtlasList_Span) do =

 		local myid =3D k1 - 1
 		local x =3D math.mod(myid,4)
 		local y =3D math.floor(myid / 4)
-		for k2,uoid in pairs(gTerrain_MultiTexTypes[name]) do mylookup[uoid] =3D=
 myid end
+		for k2,uoid in pairs(gTerrain_MultiTexTypes[name]) do gMultiTexTerrainTy=
peLookup[uoid] =3D myid end
 		=

-		TerrainMultiTex_AddTexCoordSet(0, x*e+b,y*e+b,(e-b-b)/4,(e-b-b)/4)
+		local u0,v0,w,h =3D x*e+b,y*e+b,(e-b-b)/4,(e-b-b)/4
+		gMultiTexTerrainTypeTexCoords[myid] =3D {u0,v0,w,h}
+		TerrainMultiTex_AddTexCoordSet(0,u0,v0,w,h)
 	end
 	for uoid=3D0,hex2num("0x4000") do =

-		if (not mylookup[uoid]) then mylookup[uoid] =3D 1 end -- dirt
+		if (not gMultiTexTerrainTypeLookup[uoid]) then gMultiTexTerrainTypeLooku=
p[uoid] =3D 1 end -- dirt
 	end	=

 	=

-	for k2,uoid in pairs(gTerrain_MultiTexTypes.water) do mylookup[uoid] =3D =
-1 end -- skip water tiles
-	TerrainMultiTex_SetGroundMaterialTypeLookUp(mylookup) =

+	for k2,uoid in pairs(gTerrain_MultiTexTypes.water) do gMultiTexTerrainTyp=
eLookup[uoid] =3D -1 end -- skip water tiles
+	TerrainMultiTex_SetGroundMaterialTypeLookUp(gMultiTexTerrainTypeLookup) =

 	=

 	-- TexCoordSet 1 : main mask
 	if (true) then



From no-reply at zwischenwelt.org  Wed Jan 23 19:32:36 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 23 Jan 2008 18:32:36 -0000
Subject: [Iris-commit] [IRIS] r1846 - in /trunk/data/models: atlas/
	materials/ meta/
Message-ID: <20080123183238.74A791C18739@zwischenwelt.org>

Author: sience
Date: Wed Jan 23 19:32:36 2008
New Revision: 1846

Log:
-dds textures added again without mipmaps (because of OpenGL error with Tex=
ture-Atlas)

Added:
    trunk/data/models/atlas/tex_atlas_alpha_med0.dds   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_med1.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med0.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med1.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med2.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med3.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med4.dds   (with props)
Removed:
    trunk/data/models/meta/
Modified:
    trunk/data/models/atlas/tex_atlas_alpha_med.material
    trunk/data/models/atlas/tex_atlas_med.material
    trunk/data/models/materials/textures.material

Modified: trunk/data/models/atlas/tex_atlas_alpha_med.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_alpha_med.material (original)
+++ trunk/data/models/atlas/tex_atlas_alpha_med.material Wed Jan 23 19:32:3=
6 2008
@@ -6,7 +6,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_alpha_med0.png =

+				texture tex_atlas_alpha_med0.dds =

 			}	=

 		}
 	} =

@@ -19,7 +19,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_alpha_med1.png =

+				texture tex_atlas_alpha_med1.dds =

 			}	=

 		}
 	} =


Modified: trunk/data/models/atlas/tex_atlas_med.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_med.material (original)
+++ trunk/data/models/atlas/tex_atlas_med.material Wed Jan 23 19:32:36 2008
@@ -6,7 +6,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med0.png =

+				texture tex_atlas_med0.dds =

 			}	=

 		}
 	} =

@@ -19,7 +19,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med1.png =

+				texture tex_atlas_med1.dds =

 			}	=

 		}
 	} =

@@ -32,7 +32,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med2.png =

+				texture tex_atlas_med2.dds =

 			}	=

 		}
 	} =

@@ -45,7 +45,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med3.png =

+				texture tex_atlas_med3.dds =

 			}	=

 		}
 	} =

@@ -58,7 +58,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med4.png =

+				texture tex_atlas_med4.dds =

 			}	=

 		}
 	} =


Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Wed Jan 23 19:32:36 2008
@@ -41,7 +41,7 @@
 	{
 		pass
 		{
-			scene_blend alpha_blend
+//			scene_blend alpha_blend
 			alpha_rejection greater_equal 200
 		}
 	}



From no-reply at zwischenwelt.org  Wed Jan 23 19:50:20 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 23 Jan 2008 18:50:20 -0000
Subject: [Iris-commit] [IRIS] r1847 - in /trunk: bin/ data/
 data/grannys/materials/ data/grannys/programs/ lua/ vs8/
Message-ID: <20080123185022.3AF7A1C18739@zwischenwelt.org>

Author: sience
Date: Wed Jan 23 19:50:19 2008
New Revision: 1847

Log:
-fps in top stats are now visible
-lights disabled  by default
-terrainshadow option added again
-skin shader bugfixed
-debugmode grannys added
-boat ID's added
-shadow setup optimized
-project updated
-new win32 binary

Modified:
    trunk/bin/iris2.exe
    trunk/data/config.lua.dist
    trunk/data/grannys/materials/grannybase.material
    trunk/data/grannys/programs/skinningTwoWeightsVp.glsl
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.debugmenu.lua
    trunk/lua/lib.gui.iris.lua
    trunk/lua/lib.terrain.multitex.lua
    trunk/lua/lib.uoids.lua
    trunk/lua/main.lua
    trunk/vs8/iris.vcproj

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Wed Jan 23 19:50:19 2008
@@ -266,12 +266,13 @@
 -- shadow settings
 --"none", "stencil_modulative", "stencil_additive", "texture_modulative", =
"texture_additive", "texture_additive_integrated", "texture_modulative_inte=
grated"
 gShadowTechnique =3D "texture_additive"
+gTerrainCastShadows =3D false
 gStaticsCastShadows =3D true
 gDynamicsCastShadows =3D true
 gMobileCastShadows =3D true
 =

 -- activates Lightsources
-gLightsources =3D true
+gLightsources =3D false
 =

 -- activates Particle Effects
 gParticleEffectSystem =3D true

Modified: trunk/data/grannys/materials/grannybase.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/grannys/materials/grannybase.material (original)
+++ trunk/data/grannys/materials/grannybase.material Wed Jan 23 19:50:19 20=
08
@@ -45,11 +45,10 @@
 =

 		pass
 		{
-			cull_hardware none
-			cull_software none
+//			cull_hardware none
+//			cull_software none
 			scene_blend alpha_blend
-			alpha_rejection greater_equal 255
-
+			alpha_rejection greater_equal 50
 			texture_unit
 			{
 				texture stone512.dds

Modified: trunk/data/grannys/programs/skinningTwoWeightsVp.glsl
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/grannys/programs/skinningTwoWeightsVp.glsl (original)
+++ trunk/data/grannys/programs/skinningTwoWeightsVp.glsl Wed Jan 23 19:50:=
19 2008
@@ -10,6 +10,7 @@
 uniform mat4 viewProjectionMatrix;
 uniform vec4 lightPos[2];
 uniform vec4 lightDiffuseColour[2];
+uniform vec4 ambient;
 =

 void main()
 {
@@ -46,7 +47,8 @@
 	vec3 lightDir1 =3D normalize(lightPos[1].xyz -  (blendPos.xyz * lightPos[=
1].w));
 		=

 	gl_FrontSecondaryColor =3D vec4(0);
-	gl_FrontColor =3D vec4(0.5, 0.5, 0.5, 1.0) =

+	//vec4(0.5, 0.5, 0.5, 1.0)
+	gl_FrontColor =3D ambient =

 		+ clamp(dot(lightDir0, blendNorm), 0.0, 1.0) * lightDiffuseColour[0]
 		+ clamp(dot(lightDir1, blendNorm), 0.0, 1.0) * lightDiffuseColour[1];
 =


Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Wed Jan 23 19:50:19 2008
@@ -461,7 +461,7 @@
 					chunk.terraingfx =3D CreateRootGfx3D()
 					chunk.terraingfx:SetMesh(meshname)
 					chunk.terraingfx:SetPosition(x,y,0)
-					chunk.terraingfx:SetCastShadows(false)
+					chunk.terraingfx:SetCastShadows(gTerrainCastShadows)
 					chunk.terraingfx:SetVisible(self.gbBlendOutTerrainVisible)
 				end
 			end

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Wed Jan 23 19:50:19 2008
@@ -29,127 +29,7 @@
 --[[
 --player characters with equipment
 gDebugTestMobiles =3D {
-	-- male
-	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
-	--female
-	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
-
-	{artid=3D hex2num("5") , content=3D{}},		--birds_eagle
-	{artid=3D hex2num("39") , content=3D{}},	--mongbats_mongbat
-	{artid=3D hex2num("105") , content=3D{}},	--dragons_wyrm_ancient
-
-	-- llamas_llama_pack - broken (crash) -> mapped to id: 220 (grannyfilter)
-	{artid=3D 292 , content=3D{}},
-	-- k=C3=A4fer - broken animation
-	{artid=3D hex2num("0xA9") , content=3D{}},
-	--791 broken horse
-	{artid=3D hex2num("0x317"), content=3D{}},
-
-	{artid=3D	hex2num("0xB1") , content=3D{}}, -- 177 broken
-	{artid=3D	hex2num("0x72") , content=3D{}}, -- 114 broken =

-	{artid=3D	hex2num("0x73") , content=3D{}},  -- 115 broken
-	{artid=3D	hex2num("0x75") , content=3D{}}, -- 117 broken
-
-	{artid=3D hex2num("0xD5") , content=3D{}}, =

-	{artid=3D	hex2num("0xF1") , content=3D{}}, =

-	{artid=3D	hex2num("0xF3") , content=3D{}}, =

-	{artid=3D	hex2num("0xCC") , content=3D{}}, -- 204, broken horse
-	{artid=3D	hex2num("0xC8") , content=3D{}}, -- 200 : standard horse
-	{artid=3D	hex2num("0xE2") , content=3D{}}, -- 226 broken
-	{artid=3D	hex2num("0xE4") , content=3D{}}, -- 228 broken
-	{artid=3D hex2num("0xFC"), content=3D{}},
-	{artid=3D	hex2num("0xDC") , content=3D{}}, =

-	{artid=3D	hex2num("0xD2") , content=3D{}}, =

-	{artid=3D	hex2num("0xDA") , content=3D{}}, =

-	{artid=3D	hex2num("0xDB") , content=3D{}}, =

-	{artid=3D	hex2num("0xD5") , content=3D{}}, =

-	{artid=3D	hex2num("0x90") , content=3D{}}, =

-	{artid=3D	hex2num("0x74") , content=3D{}},  -- 116 broken
-	{artid=3D	hex2num("0xB2") , content=3D{}},  -- 178 broken
-	{artid=3D	hex2num("0x84") , content=3D{}}, =

-	{artid=3D	hex2num("0xB3") , content=3D{}},  -- 179 broken
-	{artid=3D	hex2num("0xBB") , content=3D{}}, =

-	{artid=3D	hex2num("0xBC") , content=3D{}}, =

-	{artid=3D	hex2num("0x317") , content=3D{}}, -- brokenanim
-	{artid=3D	hex2num("0x31A") , content=3D{}}, -- brokenanim
-	{artid=3D	hex2num("0x31F") , content=3D{}}, -- brokenanim
-	{artid=3D	hex2num("0xBE") , content=3D{}},  -- 190 broken
-	{artid=3D hex2num("0x11C") , content=3D{}}, -- 284 anim broken, scale bro=
ken..
-	{artid=3D	hex2num("0xFB") , content=3D{}}, =

-
-	{artid=3D400,hue=3D33780, content=3D{[4]=3D{artid=3D5422,hue=3D1728,animi=
d=3D430},[26]=3D{artid=3D3701,hue=3D0,animid=3D422},[16]=3D{artid=3D8269,hu=
e=3D1147,animid=3D906},[27]=3D{artid=3D3701,hue=3D0,animid=3D422},[17]=3D{a=
rtid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,hue=3D1147,animid=
=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D{artid=3D3701,hue=
=3D0,animid=3D422},}},
-	{artid=3D400,hue=3D33780, content=3D{[26]=3D{artid=3D3701,hue=3D0,animid=
=3D422},[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},[27]=3D{artid=3D3701,=
hue=3D0,animid=3D422},[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D=
{artid=3D8252,hue=3D1147,animid=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=
=3D466},[21]=3D{artid=3D3701,hue=3D0,animid=3D422},}},
-	{artid=3D400,hue=3D33780, content=3D{[27]=3D{artid=3D3701,hue=3D0,animid=
=3D422},[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,=
hue=3D1147,animid=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D=
{artid=3D3701,hue=3D0,animid=3D422},}},
-	{artid=3D400,hue=3D33780, content=3D{[11]=3D{artid=3D8252,hue=3D1147,anim=
id=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D{artid=3D3701,h=
ue=3D0,animid=3D422},}},
-
-	{artid=3D400, content=3D{}},
-	{artid=3D400, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
-	{artid=3D401, content=3D{}},
-	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
-	{artid=3D014, content=3D{}},
-	{artid=3D778, content=3D{}},
-	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
-	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[4]=3D{artid=
=3D5137,animid=3D529},[6]=3D{artid=3D9797,animid=3D682},[7]=3D{artid=3D5140=
,animid=3D530},[19]=3D{artid=3D5136,animid=3D528},[16]=3D{artid=3D8256,anim=
id=3D800},[21]=3D{artid=3D3701,animid=3D422},[13]=3D{artid=3D5141,animid=3D=
527},[29]=3D{artid=3D3708,animid=3D0},[11]=3D{artid=3D8266,animid=3D903},}},
-	{artid=3D401, content=3D({{artid=3D3932,animid=3D631},{artid=3D7107,animi=
d=3D993},{artid=3D5137,animid=3D529},{artid=3D9797,animid=3D682},{artid=3D5=
140,animid=3D530},{artid=3D5136,animid=3D528},{artid=3D8256,animid=3D800},{=
artid=3D3701,animid=3D422},{artid=3D5141,animid=3D527},{artid=3D3708,animid=
=3D0},{artid=3D8266,animid=3D903},})},
-
-	{artid=3D400, content=3D({{artid=3D3519,animid=3D972},})},
-	{artid=3D400, content=3D({{artid=3D3519,animid=3D972},{artid=3D5901,animi=
d=3D479},{artid=3D5422,animid=3D430},{artid=3D5399,animid=3D434},{artid=3D5=
907,animid=3D404},{artid=3D3701,animid=3D422},{artid=3D8252,animid=3D701},}=
)},
-	{artid=3D987, content=3D({{artid=3D5182,animid=3D624},{artid=3D5903,animi=
d=3D480},{artid=3D5399,animid=3D434},{artid=3D5130,animid=3D565},{artid=3D5=
397,animid=3D468},{artid=3D3701,animid=3D422},{artid=3D7939,animid=3D469},}=
)},
-	{artid=3D401, content=3D({{artid=3D2594,animid=3D500},{artid=3D5899,animi=
d=3D477},{artid=3D7933,animid=3D435},{artid=3D5431,animid=3D455},{artid=3D5=
397,animid=3D468},{artid=3D5441,animid=3D490},{artid=3D8261,animid=3D710},{=
artid=3D3701,animid=3D422},})},
-	{artid=3D401, content=3D({{artid=3D2594,animid=3D500},{artid=3D5905,animi=
d=3D476},{artid=3D5399,animid=3D434},{artid=3D5431,animid=3D455},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8262,animid=3D712},}=
)},
-	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
-	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
-	{artid=3D400, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D8266,animid=3D903},{artid=3D3=
701,animid=3D422},})},
-
-	-- meshes only crash when using vertex-shader
-	{artid=3D040, content=3D{}},
-	{artid=3D	hex2num("0x76") , content=3D{}},
-	{artid=3D	hex2num("0x77") , content=3D{}}, =

-	{artid=3D	hex2num("0x78") , content=3D{}},
-	{artid=3D	hex2num("0x79") , content=3D{}}, =

-	{artid=3D	hex2num("0x3C") , content=3D{}}, =

-	{artid=3D	hex2num("0xC8") , content=3D{}}, =

-	{artid=3D hex2num("0x123") , content=3D{}},
-	{artid=3D199, content=3D{}},
-	{artid=3D225, content=3D{}}, -- timberwolf
-	{artid=3D256, content=3D{}},
-	{artid=3D	hex2num("0x319") , content=3D{}},
-	{artid=3D400,hue=3D33780, content=3D{
-		{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount},
-		[4]=3D{artid=3D5422,hue=3D1728,animid=3D430},[26]=3D{artid=3D3701,hue=3D=
0,animid=3D422},
-		[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},[27]=3D{artid=3D3701,hue=
=3D0,animid=3D422},
-		[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,hue=
=3D1147,animid=3D701},
-		[21]=3D{artid=3D3701,hue=3D0,animid=3D422},}},   =

-	{artid=3D401, content=3D({{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount=
},{artid=3D5899,animid=3D477},{artid=3D5422,animid=3D430},{artid=3D5399,ani=
mid=3D434},{artid=3D5435,animid=3D466},{artid=3D8251,animid=3D700},{artid=
=3D3701,animid=3D422},})},
-	{artid=3D400, content=3D({{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount=
},{artid=3D5899,animid=3D477},{artid=3D5422,animid=3D430},{artid=3D5399,ani=
mid=3D434},{artid=3D5435,animid=3D466},{artid=3D8251,animid=3D700},{artid=
=3D3701,animid=3D422},})},
-
-	{artid=3D2011, content=3D{{animid=3D2002}}}, -- 02:feet 11:ulegs
-	{artid=3D1466, content=3D{}}, -- flimmer, need culling? (fixed)
-	{artid=3D1700, content=3D{}}, -- hair, texcoords or normals broken ? (fix=
ed)
-	{artid=3D500, content=3D{}}, -- lantern, texcoords broken ?! (fixed)
-	{artid=3D468, content=3D{}}, -- cape, texcoords broken ? culling? (fixed)
-	{artid=3D1468, content=3D{}}, -- cape, texcoords broken ? culling? (fixed)
-	{artid=3D490, content=3D{}}, -- sash, texcoords broken ? culling? (fixed)
-	{artid=3D1490, content=3D{}},  -- sash, texcoords broken ? culling? (fixe=
d)
-
-	{artid=3D1924, content=3D{{animid=3D3012}}},
-	{artid=3D3604, content=3D{{animid=3D3012}}},
-	{artid=3D1925, content=3D{{animid=3D3012}}},
-	{artid=3D3605, content=3D{{animid=3D3012}}},
-
-	{artid=3D3006, content=3D{}}, -- female lower legs, sience was having pro=
blem with them, 2 submeshes !
-	{artid=3D2013, content=3D{}},
-	{artid=3D2009, content=3D{}},
-	{artid=3D2012, content=3D{}},
-	{artid=3D3013, content=3D{}},
-	{artid=3D3009, content=3D{}},
-	{artid=3D3012, content=3D{}},
-	{artid=3D3009, content=3D{}},
-	{artid=3D3012, content=3D{}},
-	{artid=3D3009, content=3D{}},
-	{artid=3D3012, content=3D{}},
-	{artid=3D3009, content=3D{}},
-	{artid=3D3012, content=3D{}},
+
 }
 ]]--
 =

@@ -158,6 +38,13 @@
 --removed duplicates by hand
 --commented ones crashes (no shaders used)
 gDebugMenuModelTable =3D {
+	--female
+	{artid=3D401, content=3D{}},
+	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
+	-- male
+	{artid=3D400, content=3D{}},
+	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
+
 	{artid=3D187 , content=3D{}}, 	--ridgeback_ridgeback
 	{artid=3D193 , content=3D{}}, 	--ridgeback_ridgeback_ethereal
 	{artid=3D188 , content=3D{}}, 	--ridgeback_savage
@@ -516,6 +403,127 @@
 =

 	{artid=3D689 , content=3D{}}, 	--shadowlords_shadowlord
 	{artid=3D704 , content=3D{}} 	--shadowlords_shadowlord
+--[[
+--------------------------------------------------------------------------
+--				custom assigned Models (only for testing)
+--------------------------------------------------------------------------
+	{artid=3D hex2num("5") , content=3D{}},		--birds_eagle
+	{artid=3D hex2num("39") , content=3D{}},	--mongbats_mongbat
+	{artid=3D hex2num("105") , content=3D{}},	--dragons_wyrm_ancient
+
+	-- llamas_llama_pack - broken (crash) -> mapped to id: 220 (grannyfilter)
+	{artid=3D 292 , content=3D{}},
+	-- k=C3=A4fer - broken animation
+	{artid=3D hex2num("0xA9") , content=3D{}},
+	--791 broken horse
+	{artid=3D hex2num("0x317"), content=3D{}},
+
+	{artid=3D	hex2num("0xB1") , content=3D{}}, -- 177 broken
+	{artid=3D	hex2num("0x72") , content=3D{}}, -- 114 broken =

+	{artid=3D	hex2num("0x73") , content=3D{}},  -- 115 broken
+	{artid=3D	hex2num("0x75") , content=3D{}}, -- 117 broken
+
+	{artid=3D hex2num("0xD5") , content=3D{}}, =

+	{artid=3D	hex2num("0xF1") , content=3D{}}, =

+	{artid=3D	hex2num("0xF3") , content=3D{}}, =

+	{artid=3D	hex2num("0xCC") , content=3D{}}, -- 204, broken horse
+	{artid=3D	hex2num("0xC8") , content=3D{}}, -- 200 : standard horse
+	{artid=3D	hex2num("0xE2") , content=3D{}}, -- 226 broken
+	{artid=3D	hex2num("0xE4") , content=3D{}}, -- 228 broken
+	{artid=3D hex2num("0xFC"), content=3D{}},
+	{artid=3D	hex2num("0xDC") , content=3D{}}, =

+	{artid=3D	hex2num("0xD2") , content=3D{}}, =

+	{artid=3D	hex2num("0xDA") , content=3D{}}, =

+	{artid=3D	hex2num("0xDB") , content=3D{}}, =

+	{artid=3D	hex2num("0xD5") , content=3D{}}, =

+	{artid=3D	hex2num("0x90") , content=3D{}}, =

+	{artid=3D	hex2num("0x74") , content=3D{}},  -- 116 broken
+	{artid=3D	hex2num("0xB2") , content=3D{}},  -- 178 broken
+	{artid=3D	hex2num("0x84") , content=3D{}}, =

+	{artid=3D	hex2num("0xB3") , content=3D{}},  -- 179 broken
+	{artid=3D	hex2num("0xBB") , content=3D{}}, =

+	{artid=3D	hex2num("0xBC") , content=3D{}}, =

+	{artid=3D	hex2num("0x317") , content=3D{}}, -- brokenanim
+	{artid=3D	hex2num("0x31A") , content=3D{}}, -- brokenanim
+	{artid=3D	hex2num("0x31F") , content=3D{}}, -- brokenanim
+	{artid=3D	hex2num("0xBE") , content=3D{}},  -- 190 broken
+	{artid=3D hex2num("0x11C") , content=3D{}}, -- 284 anim broken, scale bro=
ken..
+	{artid=3D	hex2num("0xFB") , content=3D{}}, =

+
+	{artid=3D400,hue=3D33780, content=3D{[4]=3D{artid=3D5422,hue=3D1728,animi=
d=3D430},[26]=3D{artid=3D3701,hue=3D0,animid=3D422},[16]=3D{artid=3D8269,hu=
e=3D1147,animid=3D906},[27]=3D{artid=3D3701,hue=3D0,animid=3D422},[17]=3D{a=
rtid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,hue=3D1147,animid=
=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D{artid=3D3701,hue=
=3D0,animid=3D422},}},
+	{artid=3D400,hue=3D33780, content=3D{[26]=3D{artid=3D3701,hue=3D0,animid=
=3D422},[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},[27]=3D{artid=3D3701,=
hue=3D0,animid=3D422},[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D=
{artid=3D8252,hue=3D1147,animid=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=
=3D466},[21]=3D{artid=3D3701,hue=3D0,animid=3D422},}},
+	{artid=3D400,hue=3D33780, content=3D{[27]=3D{artid=3D3701,hue=3D0,animid=
=3D422},[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,=
hue=3D1147,animid=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D=
{artid=3D3701,hue=3D0,animid=3D422},}},
+	{artid=3D400,hue=3D33780, content=3D{[11]=3D{artid=3D8252,hue=3D1147,anim=
id=3D701},[12]=3D{artid=3D5435,hue=3D0,animid=3D466},[21]=3D{artid=3D3701,h=
ue=3D0,animid=3D422},}},
+
+	{artid=3D400, content=3D{}},
+	{artid=3D400, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
+	{artid=3D401, content=3D{}},
+	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
+	{artid=3D014, content=3D{}},
+	{artid=3D778, content=3D{}},
+	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[2]=3D{artid=
=3D7107,animid=3D993},[4]=3D{artid=3D5137,animid=3D529},[6]=3D{artid=3D9797=
,animid=3D682},[7]=3D{artid=3D5140,animid=3D530},[19]=3D{artid=3D5136,animi=
d=3D528},[16]=3D{artid=3D8256,animid=3D800},[21]=3D{artid=3D3701,animid=3D4=
22},[13]=3D{artid=3D5141,animid=3D527},[29]=3D{artid=3D3708,animid=3D0},[11=
]=3D{artid=3D8266,animid=3D903},}},
+	{artid=3D401, content=3D{[1]=3D{artid=3D3932,animid=3D631},[4]=3D{artid=
=3D5137,animid=3D529},[6]=3D{artid=3D9797,animid=3D682},[7]=3D{artid=3D5140=
,animid=3D530},[19]=3D{artid=3D5136,animid=3D528},[16]=3D{artid=3D8256,anim=
id=3D800},[21]=3D{artid=3D3701,animid=3D422},[13]=3D{artid=3D5141,animid=3D=
527},[29]=3D{artid=3D3708,animid=3D0},[11]=3D{artid=3D8266,animid=3D903},}},
+	{artid=3D401, content=3D({{artid=3D3932,animid=3D631},{artid=3D7107,animi=
d=3D993},{artid=3D5137,animid=3D529},{artid=3D9797,animid=3D682},{artid=3D5=
140,animid=3D530},{artid=3D5136,animid=3D528},{artid=3D8256,animid=3D800},{=
artid=3D3701,animid=3D422},{artid=3D5141,animid=3D527},{artid=3D3708,animid=
=3D0},{artid=3D8266,animid=3D903},})},
+
+	{artid=3D400, content=3D({{artid=3D3519,animid=3D972},})},
+	{artid=3D400, content=3D({{artid=3D3519,animid=3D972},{artid=3D5901,animi=
d=3D479},{artid=3D5422,animid=3D430},{artid=3D5399,animid=3D434},{artid=3D5=
907,animid=3D404},{artid=3D3701,animid=3D422},{artid=3D8252,animid=3D701},}=
)},
+	{artid=3D987, content=3D({{artid=3D5182,animid=3D624},{artid=3D5903,animi=
d=3D480},{artid=3D5399,animid=3D434},{artid=3D5130,animid=3D565},{artid=3D5=
397,animid=3D468},{artid=3D3701,animid=3D422},{artid=3D7939,animid=3D469},}=
)},
+	{artid=3D401, content=3D({{artid=3D2594,animid=3D500},{artid=3D5899,animi=
d=3D477},{artid=3D7933,animid=3D435},{artid=3D5431,animid=3D455},{artid=3D5=
397,animid=3D468},{artid=3D5441,animid=3D490},{artid=3D8261,animid=3D710},{=
artid=3D3701,animid=3D422},})},
+	{artid=3D401, content=3D({{artid=3D2594,animid=3D500},{artid=3D5905,animi=
d=3D476},{artid=3D5399,animid=3D434},{artid=3D5431,animid=3D455},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8262,animid=3D712},}=
)},
+	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
+	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
+	{artid=3D400, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D8266,animid=3D903},{artid=3D3=
701,animid=3D422},})},
+
+	-- meshes only crash when using vertex-shader
+	{artid=3D040, content=3D{}},
+	{artid=3D	hex2num("0x76") , content=3D{}},
+	{artid=3D	hex2num("0x77") , content=3D{}}, =

+	{artid=3D	hex2num("0x78") , content=3D{}},
+	{artid=3D	hex2num("0x79") , content=3D{}}, =

+	{artid=3D	hex2num("0x3C") , content=3D{}}, =

+	{artid=3D	hex2num("0xC8") , content=3D{}}, =

+	{artid=3D hex2num("0x123") , content=3D{}},
+	{artid=3D199, content=3D{}},
+	{artid=3D225, content=3D{}}, -- timberwolf
+	{artid=3D256, content=3D{}},
+	{artid=3D	hex2num("0x319") , content=3D{}},
+	{artid=3D400,hue=3D33780, content=3D{
+		{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount},
+		[4]=3D{artid=3D5422,hue=3D1728,animid=3D430},[26]=3D{artid=3D3701,hue=3D=
0,animid=3D422},
+		[16]=3D{artid=3D8269,hue=3D1147,animid=3D906},[27]=3D{artid=3D3701,hue=
=3D0,animid=3D422},
+		[17]=3D{artid=3D8059,hue=3D1652,animid=3D913},[11]=3D{artid=3D8252,hue=
=3D1147,animid=3D701},
+		[21]=3D{artid=3D3701,hue=3D0,animid=3D422},}},   =

+	{artid=3D401, content=3D({{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount=
},{artid=3D5899,animid=3D477},{artid=3D5422,animid=3D430},{artid=3D5399,ani=
mid=3D434},{artid=3D5435,animid=3D466},{artid=3D8251,animid=3D700},{artid=
=3D3701,animid=3D422},})},
+	{artid=3D400, content=3D({{artid=3Dhex2num("0x3EA2"),layer=3DkLayer_Mount=
},{artid=3D5899,animid=3D477},{artid=3D5422,animid=3D430},{artid=3D5399,ani=
mid=3D434},{artid=3D5435,animid=3D466},{artid=3D8251,animid=3D700},{artid=
=3D3701,animid=3D422},})},
+
+	{artid=3D2011, content=3D{{animid=3D2002}}}, -- 02:feet 11:ulegs
+	{artid=3D1466, content=3D{}}, -- flimmer, need culling? (fixed)
+	{artid=3D1700, content=3D{}}, -- hair, texcoords or normals broken ? (fix=
ed)
+	{artid=3D500, content=3D{}}, -- lantern, texcoords broken ?! (fixed)
+	{artid=3D468, content=3D{}}, -- cape, texcoords broken ? culling? (fixed)
+	{artid=3D1468, content=3D{}}, -- cape, texcoords broken ? culling? (fixed)
+	{artid=3D490, content=3D{}}, -- sash, texcoords broken ? culling? (fixed)
+	{artid=3D1490, content=3D{}},  -- sash, texcoords broken ? culling? (fixe=
d)
+
+	{artid=3D1924, content=3D{{animid=3D3012}}},
+	{artid=3D3604, content=3D{{animid=3D3012}}},
+	{artid=3D1925, content=3D{{animid=3D3012}}},
+	{artid=3D3605, content=3D{{animid=3D3012}}},
+
+	{artid=3D3006, content=3D{}}, -- female lower legs, sience was having pro=
blem with them, 2 submeshes !
+	{artid=3D2013, content=3D{}},
+	{artid=3D2009, content=3D{}},
+	{artid=3D2012, content=3D{}},
+	{artid=3D3013, content=3D{}},
+	{artid=3D3009, content=3D{}},
+	{artid=3D3012, content=3D{}},
+	{artid=3D3009, content=3D{}},
+	{artid=3D3012, content=3D{}},
+	{artid=3D3009, content=3D{}},
+	{artid=3D3012, content=3D{}},
+	{artid=3D3009, content=3D{}},
+	{artid=3D3012, content=3D{}},
+]]--
 }
 =

 -- 0:none 1:normal 2:invert 3:sample 4:sample-invert		-- bonestart

Modified: trunk/lua/lib.gui.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gui.iris.lua (original)
+++ trunk/lua/lib.gui.iris.lua Wed Jan 23 19:50:19 2008
@@ -36,7 +36,7 @@
 	if (gMyTicks > gMemStats_NextUpdate) then
 		gMemStats_NextUpdate =3D gMyTicks + 1000
 		local mem_dyn, mem_tresh =3D gcinfo()
-		local text =3D sprintf("%5.1ffps %0.1fmb %dt %db OGRE %0.fmb / %0.1fmb L=
UA",OgreAvgFPS(),memoryusage / 1024 / 1024, OgreTriangleCount(), OgreBatchC=
ount(), mem_dyn / 1024, mem_tresh / 1024)
+		local text =3D sprintf("%5.1ffps %0.1fmb %dt %db OGRE | %0.fmb/%0.1fmb L=
UA",OgreAvgFPS(),memoryusage / 1024 / 1024, OgreTriangleCount(), OgreBatchC=
ount(), mem_dyn / 1024, mem_tresh / 1024)
 		if (not gMemoryUsageField) then
 			local vw,vh =3D GetViewportSize()
 			local w,h =3D 0,12
@@ -50,7 +50,7 @@
 			gMemoryUsageField.text.gfx:SetText(text)
 		end
 		local tw,th =3D gMemoryUsageField.text.gfx:GetTextBounds()
-		gMemoryUsageField.text.gfx:SetPos(-tw,0)
+		gMemoryUsageField.text.gfx:SetPos(-tw+90,0)
 	end
 end
 =


Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Wed Jan 23 19:50:19 2008
@@ -190,6 +190,6 @@
 	gfx:SetPosition(x,y,z)
 	Gfx3D_SetMultiTexTerrain(gfx,gGroundBlockLoader,bx,by,kMultiTexTerrainChu=
nkSize,kMultiTexTerrainChunkSize)
 	gfx:SetMaterial(MultiTexTerrainGetMat())
-	gfx:SetCastShadows(false)
+	gfx:SetCastShadows(gTerrainCastShadows)
 	return gfx
 end

Modified: trunk/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoids.lua (original)
+++ trunk/lua/lib.uoids.lua Wed Jan 23 19:50:19 2008
@@ -69,6 +69,38 @@
 gTextAllianceChat		=3D hex2num("0x0E")
 gTextCommandPrompts		=3D hex2num("0x0F")
 gTextEncodedCmd			=3D hex2num("0xC0")
+
+gBoats =3D {}
+--Small boat
+gBoats[hex2num("0x4000")] =3D 16093	--Small Boat Facing North
+gBoats[hex2num("0x4001")] =3D 15962	--Small Boat Facing East
+gBoats[hex2num("0x4002")] =3D 16098	--Small Boat Facing South
+gBoats[hex2num("0x4003")] =3D 15980	--Small Boat Facing West
+--Small Dragon Boat
+gBoats[hex2num("0x4004")] =3D 16093	--Small Dragon Boat Facing North
+gBoats[hex2num("0x4005")] =3D 15962	--Small Dragon Boat Facing East
+gBoats[hex2num("0x4006")] =3D 16098	--Small Dragon Boat Facing South
+gBoats[hex2num("0x4007")] =3D 15980	--Small Dragon Boat Facing West
+--Medium Boat
+gBoats[hex2num("0x4008")] =3D 16093	--Medium Boat Facing North
+gBoats[hex2num("0x4009")] =3D 15962	--Medium Boat Facing East
+gBoats[hex2num("0x400A")] =3D 16098	--Medium Boat Facing South
+gBoats[hex2num("0x400B")] =3D 15980	--Medium Boat Facing West
+--Median Dragon Dragon Boat
+gBoats[hex2num("0x400C")] =3D 16093	--Medium Dragon Boat Facing North
+gBoats[hex2num("0x400D")] =3D 15962	--Medium Dragon Boat Facing East
+gBoats[hex2num("0x400E")] =3D 16098	--Medium Dragon Boat Facing South
+gBoats[hex2num("0x400F")] =3D 15980	--Medium Dragon Boat Facing West
+--Large Boat
+gBoats[hex2num("0x4010")] =3D 16093	--Long Boat Facing North
+gBoats[hex2num("0x4011")] =3D 15962	--Long Boat Facing East
+gBoats[hex2num("0x4012")] =3D 16098	--Long Boat Facing South
+gBoats[hex2num("0x4013")] =3D 15980	--Long Boat Facing West
+--Large Dragon Boat
+gBoats[hex2num("0x4014")] =3D 16093	--Long Dragon Boat Facing North
+gBoats[hex2num("0x4015")] =3D 15962	--Long Dragon Boat Facing East
+gBoats[hex2num("0x4016")] =3D 16098	--Long Dragon Boat Facing South
+gBoats[hex2num("0x4017")] =3D 15980	--Long Dragon Boat Facing West
 =

 -- Paperdoll Layer
 gLayerType =3D {}

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Wed Jan 23 19:50:19 2008
@@ -287,20 +287,20 @@
 		OgreSetShadowFarDistance(gSightRange*18.0)
 =

  		if ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechnique=
 =3D=3D "texture_additive")) then
- 			OgreSetShadowTextureSize(2048)
- 			OgreSetShadowTextureSelfShadow(false)
+ 			OgreSetShadowTextureSelfShadow(false)		--fixed function self shadowing=
 only work on OpenGL
+			OgreSetShadowCasterRenderBackFaces(false)
+			OgreSetShadowTextureSize(2048)
 		end
 =

 		if (gShadowTechnique =3D=3D "texture_additive_integrated") then
+			OgreSetShadowTextureSelfShadow(true)
 			OgreSetShadowCasterRenderBackFaces(false)
 			OgreSetShadowTextureCasterMaterial("Ogre/DepthShadowmap/Caster/Float")
-			--OgreSetShadowTextureReceiverMaterial("Ogre/DepthShadowmap/BasicTempla=
teMaterial")
-			OgreSetShadowTextureSettings(2048, 3, PF_FLOAT32_R)
-			OgreSetShadowTextureSelfShadow(false)
-			--OgreSetShadowTextureCasterMaterial(matname)
-			--OgreSetShadowTextureReceiverMaterial(matname)
-			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R) --only for accuracy
-			OgreSetShadowFarDistance(gSightRange*18.0)
+			OgreSetShadowTextureReceiverMaterial("Ogre/DepthShadowmap/BasicTemplate=
Material")
+			OgreSetShadowTextureSize(2048)
+			--OgreSetShadowTextureCount(3)
+			--OgreSetShadowTextureSettings(2048, 3, PF_FLOAT32_R)
+			--OgreSetShadowTexturePixelFormat(PF_FLOAT32_R)
  		end
  	end
 =


Modified: trunk/vs8/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.vcproj (original)
+++ trunk/vs8/iris.vcproj Wed Jan 23 19:50:19 2008
@@ -371,6 +371,10 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\include\lugre_caelum.h"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\include\lugre_camera.h"
 					>
 				</File>
@@ -439,6 +443,10 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\include\lugre_meshloader.h"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\include\lugre_meshshape.h"
 					>
 				</File>
@@ -456,6 +464,10 @@
 				</File>
 				<File
 					RelativePath=3D"..\lugre\include\lugre_ogrewrapper.h"
+					>
+				</File>
+				<File
+					RelativePath=3D"..\lugre\include\lugre_paged_geometry.h"
 					>
 				</File>
 				<File
@@ -563,6 +575,10 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\src\lugre_caelum_L.cpp"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\src\lugre_camera_L.cpp"
 					>
 				</File>
@@ -643,6 +659,10 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\src\lugre_meshloader.cpp"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\src\lugre_meshshape.cpp"
 					>
 				</File>
@@ -667,6 +687,10 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\src\lugre_paged_geometry_L.cpp"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\src\lugre_profile.cpp"
 					>
 				</File>
@@ -727,6 +751,14 @@
 					>
 				</File>
 				<File
+					RelativePath=3D"..\lugre\src\lugre_sound_openal.cpp"
+					>
+				</File>
+				<File
+					RelativePath=3D"..\lugre\src\lugre_sound_openal2.cpp"
+					>
+				</File>
+				<File
 					RelativePath=3D"..\lugre\src\lugre_texatlas.cpp"
 					>
 				</File>
@@ -765,156 +797,84 @@
 				<File
 					RelativePath=3D"..\lugre\src\tinystr.cpp"
 					>
-					<FileConfiguration
-						Name=3D"Debug|Win32"
-						>
-						<Tool
-							Name=3D"VCCLCompilerTool"
-							ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
-							XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
-						/>
-					</FileConfiguration>
-					<FileConfiguration
-						Name=3D"Release|Win32"
-						>
-						<Tool
-							Name=3D"VCCLCompilerTool"
-							ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
-							XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
-						/>
-					</FileConfiguration>
 				</File>
 				<File
 					RelativePath=3D"..\lugre\src\tinyxml.cpp"
 					>
-					<FileConfiguration
-						Name=3D"Debug|Win32"
-						>
-						<Tool
-							Name=3D"VCCLCompilerTool"
-							ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
-							XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
-						/>
-					</FileConfiguration>
-					<FileConfiguration
-						Name=3D"Release|Win32"
-						>
-						<Tool
-							Name=3D"VCCLCompilerTool"
-							ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
-							XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
-						/>
-					</FileConfiguration>
 				</File>
 				<File
 					RelativePath=3D"..\lugre\src\tinyxmlerror.cpp"
 					>
-					<FileConfiguration
-						Name=3D"Debug|Win32"
-						>
-						<Tool
-							Name=3D"VCCLCompilerTool"
-							ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
-							XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
-						/>
-					</FileConfiguration>
-					<FileConfiguration
-						Name=3D"Release|Win32"
-						>
-						<Tool
-							Name=3D"VCCLCompilerTool"
-							ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
-							XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
-						/>
-					</FileConfiguration>
 				</File>
 				<File
 					RelativePath=3D"..\lugre\src\tinyxmlparser.cpp"
-					>
-					<FileConfiguration
-						Name=3D"Debug|Win32"
-						>
-						<Tool
-							Name=3D"VCCLCompilerTool"
-							ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
-							XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
-						/>
-					</FileConfiguration>
-					<FileConfiguration
-						Name=3D"Release|Win32"
-						>
-						<Tool
-							Name=3D"VCCLCompilerTool"
-							ObjectFile=3D"$(IntDir)\$(InputName)1.obj"
-							XMLDocumentationFileName=3D"$(IntDir)\$(InputName)1.xdc"
-						/>
-					</FileConfiguration>
-				</File>
-			</Filter>
-		</Filter>
-		<Filter
-			Name=3D"candune_tree"
-			>
-			<Filter
-				Name=3D"src"
-				>
-				<File
-					RelativePath=3D"..\lugre\lib\cadune_tree\src\CTParameters.cpp"
-					>
-				</File>
-				<File
-					RelativePath=3D"..\lugre\lib\cadune_tree\src\CTSection.cpp"
-					>
-				</File>
-				<File
-					RelativePath=3D"..\lugre\lib\cadune_tree\src\CTSerializer.cpp"
-					>
-				</File>
-				<File
-					RelativePath=3D"..\lugre\lib\cadune_tree\src\CTStem.cpp"
 					>
 				</File>
 			</Filter>
 			<Filter
-				Name=3D"include"
-				>
-				<File
-					RelativePath=3D"..\lugre\lib\cadune_tree\include\CaduneTree.h"
-					>
-				</File>
-				<File
-					RelativePath=3D"..\lugre\lib\cadune_tree\include\CTParameters.h"
-					>
-				</File>
-				<File
-					RelativePath=3D"..\lugre\lib\cadune_tree\include\CTPrerequisites.h"
-					>
-				</File>
-				<File
-					RelativePath=3D"..\lugre\lib\cadune_tree\include\CTSection.h"
-					>
-				</File>
-				<File
-					RelativePath=3D"..\lugre\lib\cadune_tree\include\CTSerializer.h"
-					>
-				</File>
-				<File
-					RelativePath=3D"..\lugre\lib\cadune_tree\include\CTStem.h"
+				Name=3D"md5"
+				>
+				<File
+					RelativePath=3D"..\lugre\lib\md5\src\md5.c"
+					>
+				</File>
+				<File
+					RelativePath=3D"..\lugre\lib\md5\include\md5.h"
 					>
 				</File>
 			</Filter>
-		</Filter>
-		<Filter
-			Name=3D"md5"
-			>
-			<File
-				RelativePath=3D"..\lugre\lib\md5\src\md5.c"
-				>
-			</File>
-			<File
-				RelativePath=3D"..\lugre\lib\md5\include\md5.h"
-				>
-			</File>
+			<Filter
+				Name=3D"candune_tree"
+				>
+				<Filter
+					Name=3D"src"
+					>
+					<File
+						RelativePath=3D"..\lugre\lib\cadune_tree\src\CTParameters.cpp"
+						>
+					</File>
+					<File
+						RelativePath=3D"..\lugre\lib\cadune_tree\src\CTSection.cpp"
+						>
+					</File>
+					<File
+						RelativePath=3D"..\lugre\lib\cadune_tree\src\CTSerializer.cpp"
+						>
+					</File>
+					<File
+						RelativePath=3D"..\lugre\lib\cadune_tree\src\CTStem.cpp"
+						>
+					</File>
+				</Filter>
+				<Filter
+					Name=3D"include"
+					>
+					<File
+						RelativePath=3D"..\lugre\lib\cadune_tree\include\CaduneTree.h"
+						>
+					</File>
+					<File
+						RelativePath=3D"..\lugre\lib\cadune_tree\include\CTParameters.h"
+						>
+					</File>
+					<File
+						RelativePath=3D"..\lugre\lib\cadune_tree\include\CTPrerequisites.h"
+						>
+					</File>
+					<File
+						RelativePath=3D"..\lugre\lib\cadune_tree\include\CTSection.h"
+						>
+					</File>
+					<File
+						RelativePath=3D"..\lugre\lib\cadune_tree\include\CTSerializer.h"
+						>
+					</File>
+					<File
+						RelativePath=3D"..\lugre\lib\cadune_tree\include\CTStem.h"
+						>
+					</File>
+				</Filter>
+			</Filter>
 		</Filter>
 	</Files>
 	<Globals>



From no-reply at zwischenwelt.org  Wed Jan 23 20:21:12 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 23 Jan 2008 19:21:12 -0000
Subject: [Iris-commit] [IRIS] r1848 - in /trunk/lua: lib.3d.map.lua
	lib.terrain.multitex.lua
Message-ID: <20080123200005.B99EE1C1873A@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Jan 23 20:21:11 2008
New Revision: 1848

Log:
bugfix : terrain LOD

Modified:
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.terrain.multitex.lua

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Wed Jan 23 20:21:11 2008
@@ -119,12 +119,13 @@
 				local tiletype11,z11 =3D GetGroundAtAbsPos(x+4,y+4)
 				=

 				local u0,v0,w,h =3D MultiTexGetTexCoordsForTiletype(tiletype00)
-				if (not u0) then u0,v0,w,h =3D 0,0,1/16,1/16 end
+				local e =3D 4/512
+				if (not u0) then u0,v0,w,h =3D e,e,1/16-e,1/16-e end
 				local u1,v1 =3D u0+w*4,v0+h*4
-				gfx:RenderableVertex(-x  ,y  ,z00*0.1, 0,0,1, u0,v0)
-				gfx:RenderableVertex(-x-4,y  ,z10*0.1, 0,0,1, u1,v0)
-				gfx:RenderableVertex(-x  ,y+4,z01*0.1, 0,0,1, u0,v1)
-				gfx:RenderableVertex(-x-4,y+4,z11*0.1, 0,0,1, u1,v1)
+				gfx:RenderableVertex(-x  ,y  ,(z00 or 0)*0.1, 0,0,1, u0,v0)
+				gfx:RenderableVertex(-x-4,y  ,(z10 or 0)*0.1, 0,0,1, u1,v0)
+				gfx:RenderableVertex(-x  ,y+4,(z01 or 0)*0.1, 0,0,1, u0,v1)
+				gfx:RenderableVertex(-x-4,y+4,(z11 or 0)*0.1, 0,0,1, u1,v1)
 				=

 				gfx:RenderableIndex3(vertexnum+0, vertexnum+2, vertexnum+1)
 				gfx:RenderableIndex3(vertexnum+1, vertexnum+2, vertexnum+3)

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Wed Jan 23 20:21:11 2008
@@ -55,6 +55,7 @@
 =

 -- returns u0,v0,w,h
 function MultiTexGetTexCoordsForTiletype (uoid)
+	if (not uoid) then return end
 	local mtindex =3D gMultiTexTerrainTypeLookup[uoid]
 	if (not mtindex) then return end
 	local coords =3D gMultiTexTerrainTypeTexCoords[mtindex]



From no-reply at zwischenwelt.org  Wed Jan 23 21:06:23 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 23 Jan 2008 20:06:23 -0000
Subject: [Iris-commit] [IRIS] r1849 - in /trunk: data/config.lua.dist
	lua/lib.3d.map.lua
Message-ID: <20080123200624.386A51C18739@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Jan 23 21:06:23 2008
New Revision: 1849

Log:
terrain farsight range config

Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.3d.map.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Wed Jan 23 21:06:23 2008
@@ -431,3 +431,4 @@
 gDisableWater =3D false -- for debugging
 =

 gEnableLowDetailTerrainFarSight =3D false -- additional lower quality terr=
ain in the distance
+gEnableLowDetailTerrainFarSightRangeAdd =3D 2

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Wed Jan 23 21:06:23 2008
@@ -82,7 +82,7 @@
 	--~ if (true) then return end
 	=

 	-- the border around the input area in which lowlevel chunks should be
-	local b =3D 2
+	local b =3D gEnableLowDetailTerrainFarSightRangeAdd
 	=

 	-- count chunks that need lowlevel display (for allocating renderable)
 	local lowlist =3D {}



From no-reply at zwischenwelt.org  Wed Jan 23 21:13:52 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 23 Jan 2008 20:13:52 -0000
Subject: [Iris-commit] [IRIS] r1850 - /trunk/lua/lib.3d.map.lua
Message-ID: <20080123201352.89BDF1C186D8@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Jan 23 21:13:52 2008
New Revision: 1850

Log:
removed farterrain debug key

Modified:
    trunk/lua/lib.3d.map.lua

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Wed Jan 23 21:13:52 2008
@@ -78,7 +78,7 @@
 	if (gLowDetailTerrain) then gLowDetailTerrain:Destroy() gLowDetailTerrain=
 =3D nil end
 	if (not gGroundBlockLoader) then return end
 	if (not gEnableLowDetailTerrainFarSight) then return end
-	if (gKeyPressed[key_lshift]) then return end
+	--~ if (gKeyPressed[key_lshift]) then return end
 	--~ if (true) then return end
 	=

 	-- the border around the input area in which lowlevel chunks should be



From no-reply at zwischenwelt.org  Fri Jan 25 17:29:18 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 25 Jan 2008 16:29:18 -0000
Subject: [Iris-commit] [IRIS] r1852 - in /trunk: bin/iris2.exe
 data/models/atlas/tex_atlas_alpha_med0.dds
 data/models/atlas/tex_atlas_alpha_med1.dds lua/filter/filter.art.lua
 lua/lib.3d.dynamic.lua lua/lib.3d.map.lua lua/main.lua
Message-ID: <20080125162918.A50E11C186B9@zwischenwelt.org>

Author: sience
Date: Fri Jan 25 17:29:17 2008
New Revision: 1852

Log:
-missing treeBarks added to filter.art.lua
-tex_atlas_alpha_med*.dds has now mipmaps (no problems with opengl)
-billboard shadows disabled
-new binary

Modified:
    trunk/bin/iris2.exe
    trunk/data/models/atlas/tex_atlas_alpha_med0.dds
    trunk/data/models/atlas/tex_atlas_alpha_med1.dds
    trunk/lua/filter/filter.art.lua
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.map.lua
    trunk/lua/main.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/atlas/tex_atlas_alpha_med0.dds
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/atlas/tex_atlas_alpha_med1.dds
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Fri Jan 25 17:29:17 2008
@@ -123,6 +123,21 @@
 gArtFilter[3290]=3D{maptoid=3D3274}
 gArtFilter[3299]=3D{maptoid=3D3274}
 gArtFilter[3296]=3D{maptoid=3D3274}
+-- barks new
+gArtFilter[3302]=3D{maptoid=3D3274}
+gArtFilter[3476]=3D{maptoid=3D3274}
+gArtFilter[3484]=3D{maptoid=3D3274}
+gArtFilter[3496]=3D{maptoid=3D3274}
+gArtFilter[3492]=3D{maptoid=3D3274}
+gArtFilter[3488]=3D{maptoid=3D3274}
+gArtFilter[3480]=3D{maptoid=3D3274}
+gArtFilter[3329]=3D{maptoid=3D3274}
+gArtFilter[3326]=3D{maptoid=3D3274}
+gArtFilter[3323]=3D{maptoid=3D3274}
+gArtFilter[3320]=3D{maptoid=3D3274}
+-- cedar tree
+gArtFilter[3288]=3D{maptoid=3D3286,xadd=3D0.8,yadd=3D-0.7,zadd=3D0}
+
 =

 -- mushrooms
 gArtFilter[3352]=3D{maptoid=3D3351}

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Fri Jan 25 17:29:17 2008
@@ -230,6 +230,7 @@
 	if (not h or h =3D=3D 0) then h =3D isotilew end
 	gfx:SetSimpleRenderable()
 	gfx:SetMaterial(matname)
+	gfx:SetCastShadows(false)
 	gfx:SetForceRotCam(GetMainCam())
 	gfx:RenderableBegin(4,6,false,false,OT_TRIANGLE_LIST)
 	gfx:RenderableVertex( 0.5*w / isotilew,-0.5					,0, 1*w/texsize(w),h/texs=
ize(h))

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Fri Jan 25 17:29:17 2008
@@ -311,6 +311,9 @@
 =

 	local meshname =3D (not gForceFallBackBillboards_Statics) and staticwater=
tile and GetMeshName(iTileTypeID, (gFastBatchStatics and 0) or entity.iHue)
 =

+	-- build Edgelist for Stencil Shadows
+	if (meshname and gBuildStencilShadowEdgeList) then print("edges generated=
") MeshBuildEdgeList(meshname) end
+
 	-- create Mesh
 	if (meshname and meshname ~=3D false) then
 		local qw,qx,qy,qz =3D GetStaticMeshOrientation(iTileTypeID)

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Fri Jan 25 17:29:17 2008
@@ -254,30 +254,35 @@
 	end
 end
 =

+gBuildStencilShadowEdgeList =3D false
 function SetupShadows()
 	if ((gShadowTechnique =3D=3D "stencil_modulative") or (gShadowTechnique =
=3D=3D "stencil_additive")) then
 		OgreShadowTechnique(gShadowTechnique)
 		OgreSetShadowFarDistance(gSightRange*18.0)
-
+		gBuildStencilShadowEdgeList=3Dtrue
 	elseif ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechniq=
ue =3D=3D "texture_additive")) then
-		OgreShadowTechnique(gShadowTechnique)
 		OgreSetShadowFarDistance(gSightRange*18.0)
 =

---		OgreSetShadowTextureCasterMaterial("Ogre/DepthShadowmap/Caster/Float")=
		--only include when using DepthShadowShaders
+--		OgreSetShadowTexturePixelFormat(PF_FLOAT32_R)
+--		if ( OgreRenderSystemIsOpenGL() ) then OgreSetShadowTexturePixelFormat=
(PF_FLOAT16_R) end
+--		OgreSetShadowTextureCasterMaterial("Ogre/DepthShadowmap/Caster/Float")
+--		OgreSetShadowTextureReceiverMaterial("Ogre/DepthShadowmap/BasicTemplat=
eMaterial")
+
 		OgreSetShadowTextureSelfShadow(true)		-- disable this or write in materi=
al "receive_shadows off"
 		OgreSetShadowCasterRenderBackFaces(false)
 		OgreSetShadowTextureSize(2048)
 		--OgreSetShadowTextureCount(3)
 =

+		OgreShadowTechnique(gShadowTechnique)
 	elseif ((gShadowTechnique =3D=3D "texture_additive_integrated") or (gShad=
owTechnique =3D=3D "texture_modulative_integrated")) then
- 		OgreShadowTechnique(gShadowTechnique)
 		OgreSetShadowFarDistance(gSightRange*18.0)
 =

-		OgreSetShadowTexturePixelFormat(PF_FLOAT32_R)
+--		OgreSetShadowTexturePixelFormat(PF_FLOAT32_R)
 		OgreSetShadowTextureCasterMaterial("Ogre/DepthShadowmap/Caster/Float")
 		OgreSetShadowTextureSelfShadow(true)		-- disable this or write in tex_ba=
se "receive_shadows off"
 		OgreSetShadowCasterRenderBackFaces(false)
 		OgreSetShadowTextureSize(2048)
+ 		OgreShadowTechnique(gShadowTechnique)
 		--OgreSetShadowTextureCount(3)
 	end
 end



From no-reply at zwischenwelt.org  Fri Jan 25 19:07:59 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 25 Jan 2008 18:07:59 -0000
Subject: [Iris-commit] [IRIS] r1853 - in /trunk/lua:
	filter/filter.granny.lua main.lua
Message-ID: <20080125180800.20E6B1C1873A@zwischenwelt.org>

Author: sience
Date: Fri Jan 25 19:07:58 2008
New Revision: 1853

Log:
-shadowsetup later initialized
-shadow knight mapped to other granny (because of seg fault)

Modified:
    trunk/lua/filter/filter.granny.lua
    trunk/lua/main.lua

Modified: trunk/lua/filter/filter.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.granny.lua (original)
+++ trunk/lua/filter/filter.granny.lua Fri Jan 25 19:07:58 2008
@@ -30,6 +30,7 @@
 gGrannyFilter[292]	=3D{grannyid=3D220}
 gGrannyFilter[970]	=3D{grannyid=3D402}
 gGrannyFilter[780]	=3D{grannyid=3D779}	-- a bog thing (too big scale)
+gGrannyFilter[311]	=3D{grannyid=3D310}	-- seg fault when loading (first on=
 uodemise/trantor)
 --gGrannyFilter[220]	=3D{meshname=3D"Lich.mesh"}
 --gGrannyFilter[5]	=3D{grannyid=3D220}				--birds_eagle
 --gGrannyFilter[39]	=3D{grannyid=3D220}				--mongbats_mongbat

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Fri Jan 25 19:07:58 2008
@@ -381,9 +381,6 @@
 	=

 	MultiTexTerrainInit()
 	=

-	-- Initialize Shadowsystem
-	SetupShadows()
-
 	-- set fadelines font
 	gFadeLinesFont =3D gFontNameDefault
 	gFadeLineTextH =3D gFontChatSize
@@ -442,7 +439,10 @@
 	print("##################################")
 	print("######      START INGAME     #####")
 	print("##################################")
-	=

+
+	-- Initialize Shadowsystem
+	SetupShadows()
+
 	ExecuteMapChangeIfNeeded()
 =

 	gCurrentRenderer:BlendOutLayersAbovePlayer()



From no-reply at zwischenwelt.org  Fri Jan 25 23:19:12 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 25 Jan 2008 22:19:12 -0000
Subject: [Iris-commit] [IRIS] r1854 -
	/trunk/data/models/materials/textures.material
Message-ID: <20080125221913.07F3F1C186B9@zwischenwelt.org>

Author: sience
Date: Fri Jan 25 23:19:12 2008
New Revision: 1854

Log:
-grass waves now (but not in the wind ;)

Modified:
    trunk/data/models/materials/textures.material

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Fri Jan 25 23:19:12 2008
@@ -8223,10 +8223,13 @@
 	technique =

 	{ =

 		pass Decal
-		{		=

-			texture_unit DecalTexture
-			{ =

-				texture tex_grass.png =

+		{
+			lighting off
+
+			texture_unit DecalTexture
+			{ =

+				texture tex_grass.png
+				wave_xform scale_x sine 1.0 0.2 0.0 1.0
 			}	=

 		}
 	} =




From no-reply at zwischenwelt.org  Sat Jan 26 00:35:18 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 25 Jan 2008 23:35:18 -0000
Subject: [Iris-commit] [IRIS] r1855 - in /trunk/lua: lib.3d.cam.lua
	lib.3d.map.lua
Message-ID: <20080125233518.7B7DC1C1873A@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 26 00:35:17 2008
New Revision: 1855

Log:
cam zoomlimit and slight farterrain optimization

Modified:
    trunk/lua/lib.3d.cam.lua
    trunk/lua/lib.3d.map.lua

Modified: trunk/lua/lib.3d.cam.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.cam.lua (original)
+++ trunk/lua/lib.3d.cam.lua Sat Jan 26 00:35:17 2008
@@ -87,6 +87,10 @@
 	local base =3D 1.5
 	if (add > 0) then factor =3D base end
 	if (add < 0) then factor =3D 1.0 / base end
+	=

+	gMinZoom =3D gMinZoom or 1
+	gMaxZoom =3D gMaxZoom or 80
+	local factor =3D math.max(gMinZoom,math.min(gMaxZoom,self.gThirdPersonDis=
t * factor)) / self.gThirdPersonDist =

 	self.gThirdPersonDist =3D self.gThirdPersonDist * factor
 	self.gCamLookAheadDist =3D self.gCamLookAheadDist * factor
 	self.gbCamRotChanged =3D true

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sat Jan 26 00:35:17 2008
@@ -76,7 +76,7 @@
 	if (not gEnableLowDetailTerrainFarSight) then return end
 	if (not Renderer3D.gLowDetailTerrainNeedsRebuild) then return end
 	self.gLowDetailTerrainNeedsRebuild =3D false
-	if (gLowDetailTerrain) then gLowDetailTerrain:Destroy() gLowDetailTerrain=
 =3D nil end
+	--~ if (gLowDetailTerrain) then gLowDetailTerrain:Destroy() gLowDetailTer=
rain =3D nil end
 	if (not gGroundBlockLoader) then return end
 	--~ if (gKeyPressed[key_lshift]) then return end
 	--~ if (true) then return end
@@ -93,8 +93,12 @@
 	end
 	=

 	-- allocate renderable from lowcount
-	gLowDetailTerrain =3D CreateRootGfx3D()
-	gLowDetailTerrain:SetSimpleRenderable()
+	local bGfxInit =3D false
+	if (not gLowDetailTerrain) then
+		gLowDetailTerrain =3D CreateRootGfx3D()
+		gLowDetailTerrain:SetSimpleRenderable()
+		bGfxInit =3D true
+	end
 	local gfx =3D gLowDetailTerrain
 	local cs =3D self.ROBMAP_CHUNK_SIZE
 	local polycount =3D (2*2) * (cs * cs) * table.getn(lowlist) -- each lowli=
st entry is one chunk, each chunk is cx*cx mapblocks, we use 2*2 polys for =
each
@@ -139,10 +143,12 @@
 	=

 	-- finish renderable
 	gfx:RenderableEnd()
-	gfx:SetMaterial("terrain_multitex_far")
-	gfx:SetCastShadows(false)
-	local x,y,z =3D self:UOPosToLocal(0,0,0)
-	gfx:SetPosition(x, y, z)
+	--~ if (bGfxInit) then
+		gfx:SetMaterial("terrain_multitex_far")
+		gfx:SetCastShadows(false)
+		local x,y,z =3D self:UOPosToLocal(0,0,0)
+		gfx:SetPosition(x, y, z)
+	--~ end
 end
 =

 =




From no-reply at zwischenwelt.org  Sat Jan 26 03:29:19 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 26 Jan 2008 02:29:19 -0000
Subject: [Iris-commit] [IRIS] r1856 - in /trunk/lua: lib.3d.dynamic.lua
 lib.3d.map.lua lib.mainmenu.lua
Message-ID: <20080126030025.46B391C1868C@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 26 03:29:18 2008
New Revision: 1856

Log:
fastbatch blendout uses new feature now, dynamic blendout works as well

Modified:
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.mainmenu.lua

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sat Jan 26 03:29:18 2008
@@ -12,6 +12,12 @@
 -- helperfunction for CreateDynamicGfx. Please use always for function call
 function Renderer3D:AddDynamicItem( item )
 	self:CreateDynamicGfx(item)
+end
+
+-- for fastbatch
+function Renderer3D:UpdateDynamicDisplayRange ()
+	if (not self.gFastBatchDynamics) then return end
+	self.gFastBatchDynamics:FastBatch_SetDisplayRange(self:BlendoutGetVisible=
Range())
 end
 =

 function Renderer3D:CheckForFastBatchDynamicsUpdate ()
@@ -35,17 +41,16 @@
 		for k,dynamic in pairs(GetDynamicList()) do
 			-- print("DEBUG","ADD DYNAMIC",dynamic.meshname)
 			if (dynamic.meshname and DynamicIsInWorld(dynamic)) then
-				if (self:IsZLayerVisible(dynamic.zloc)) then
-						x,y,z =3D Renderer3D:UOPosToLocal (dynamic.xloc,dynamic.yloc,dynamic=
.zloc * 0.1) =

-						qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
-
-						local r,g,b,a =3D 1,1,1,1
-						if (gHueLoader and dynamic.hue > 0) then
-							r,g,b =3D gHueLoader:GetColor(dynamic.hue - 1,31) -- get first color
-						end
-
-						Renderer3D.gFastBatchDynamics:FastBatch_AddMesh(dynamic.meshname, x,=
y,z, qw,qx,qy,qz, -1,1,1, r,g,b,a)
-				end
+				x,y,z =3D Renderer3D:UOPosToLocal(dynamic.xloc,dynamic.yloc,dynamic.zl=
oc * 0.1) =

+				qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
+
+				local r,g,b,a =3D 1,1,1,1
+				if (gHueLoader and dynamic.hue > 0) then
+					r,g,b =3D gHueLoader:GetColor(dynamic.hue - 1,31) -- get first color
+				end
+
+				local orderval =3D dynamic.zloc -- used for blendout later (fastbatch =
feature)
+				Renderer3D.gFastBatchDynamics:FastBatch_AddMeshBuffer(GetMeshBuffer(dy=
namic.meshname), orderval, x,y,z, qw,qx,qy,qz, -1,1,1, r,g,b,a)
 			end
 		end
 =

@@ -53,6 +58,7 @@
 		Renderer3D.gFastBatchDynamics:FastBatch_Build()
 =

 		Renderer3D.gFastBatchDynamicsUpdateNext =3D gMyTicks + Renderer3D.gFastB=
atchDynamicsUpdateNextTimout
+		self:UpdateDynamicDisplayRange()
 	end
 end
 =


Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sat Jan 26 03:29:18 2008
@@ -333,17 +333,15 @@
 		entity.sz =3D sz
 =

 		if (gFastBatchStatics) then
+			local r,g,b,a =3D 1,1,1,1
+			if (gHueLoader and entity.iHue > 0) then
+				r,g,b =3D gHueLoader:GetColor(entity.iHue - 1,31) -- get first color
+			end
+
 			entity.meshbuffer =3D GetMeshBuffer(meshname) -- for mousepicking
 			TexAtlas_AdjustMeshBufferIfNeeded(meshname,entity.meshbuffer)
-			if (not self.giBlendOutCurZ) or entity.zloc <=3D self.giBlendOutCurZ th=
en
-
-				local r,g,b,a =3D 1,1,1,1
-				if (gHueLoader and entity.iHue > 0) then
-					r,g,b =3D gHueLoader:GetColor(entity.iHue - 1,31) -- get first color
-				end
-
-				chunk.fastbatch:FastBatch_AddMesh(meshname,entity.x,entity.y,entity.z,=
 qw,qx,qy,qz, sx,sy,sz, r,g,b,a)
-			end
+			local orderval =3D entity.zloc -- used for blendout later (fastbatch fe=
ature)
+			chunk.fastbatch:FastBatch_AddMeshBuffer(entity.meshbuffer, orderval ,en=
tity.x,entity.y,entity.z, qw,qx,qy,qz, sx,sy,sz, r,g,b,a)
 		else
 			entity.staticentity =3D CreateMeshEntity(meshname)
 			local myLayer =3D Renderer3D:ZToLayer(entity.zloc)
@@ -533,6 +531,7 @@
 	if (gFastBatchStatics) then
 		chunk.fastbatch:SetCastShadows(gStaticsCastShadows)
 		chunk.fastbatch:FastBatch_Build()
+		chunk.fastbatch:FastBatch_SetDisplayRange(self:BlendoutGetVisibleRange())
 	else
 		for layerZ,layerStaticGeom in pairs(chunk.pStaticGeometryLayers) do =

 			layerStaticGeom:SetCastShadows(gStaticsCastShadows)
@@ -606,6 +605,13 @@
 	end
 end
 =

+-- returns fMinZ,fMaxZ
+function Renderer3D:BlendoutGetVisibleRange ()
+	local fMinZ =3D -1000
+	local fMaxZ =3D (self.giBlendOutCurZ or 1000) -- inclusive
+	return fMinZ,fMaxZ
+end
+
 -- TODO: blend out mounts
 function Renderer3D:BlendOutLayersAbovePlayer ()
 	local x,y,z =3D GetPlayerPos()
@@ -718,7 +724,8 @@
 					-- update fast batch
 					if gFastBatchStatics then
 						-- invalidate map chunk and trigger rebuild
-						chunk.mbRebuild =3D true
+						--~ chunk.mbRebuild =3D true
+						chunk.fastbatch:FastBatch_SetDisplayRange(self:BlendoutGetVisibleRan=
ge())
 					end
 					=

 					-- update terrain
@@ -731,9 +738,11 @@
 			end
 		end
 		=

-		-- update dynamics
+		-- update dynamics =

 		for k,dynamic in pairs(GetDynamicList()) do if (DynamicIsInWorld(dynamic=
)) then self:UpdateDynamicVisibility(dynamic) end end
-
+		=

+		self:UpdateDynamicDisplayRange()
+		=

 		-- update mobiles
 		for k,mobile in pairs(GetMobileList()) do self:UpdateMobileVisibility(mo=
bile) end
 	end

Modified: trunk/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.lua (original)
+++ trunk/lua/lib.mainmenu.lua Sat Jan 26 03:29:18 2008
@@ -284,7 +284,8 @@
 	local qw,qx,qy,qz =3D 1,0,0,0
 	local sx,sy,sz =3D 1,1,1
 	local r,g,b,a =3D 1,1,1,1
-	fastbatch:FastBatch_AddMeshBuffer(mymeshbuffer, x,y,z, qw,qx,qy,qz, sx,sy=
,sz, r,g,b,a)
+	local orderval =3D 0 -- not used here
+	fastbatch:FastBatch_AddMeshBuffer(mymeshbuffer, orderval, x,y,z, qw,qx,qy=
,qz, sx,sy,sz, r,g,b,a)
 	fastbatch:FastBatch_Build()
 end
 =




From no-reply at zwischenwelt.org  Sat Jan 26 03:40:23 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 26 Jan 2008 02:40:23 -0000
Subject: [Iris-commit] [IRIS] r1857 - /trunk/lua/lib.3d.map.lua
Message-ID: <20080126030025.EE7B51C186B9@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 26 03:40:22 2008
New Revision: 1857

Log:
blendout tolerance removed, not needed with new fastbatch speedup

Modified:
    trunk/lua/lib.3d.map.lua

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sat Jan 26 03:40:22 2008
@@ -694,10 +694,8 @@
 		--~ print("blendout",playerIsInside,playerheadpos,zloc_roof)
 	end
 	=

-	-- a bit of tolerance to avoid rebatching all the time for uneven floors
-	if (self.giBlendOutCurZ and myLayer and math.abs(self.giBlendOutCurZ-myLa=
yer) <=3D 2) then
-		myLayer =3D self.giBlendOutCurZ =

-	end
+	-- a bit of tolerance to avoid rebatching all the time for uneven floors =
... not needed anymore with fastbatch blendout
+	--~ if (self.giBlendOutCurZ and myLayer and math.abs(self.giBlendOutCurZ-=
myLayer) <=3D 2) then myLayer =3D self.giBlendOutCurZ end
 =

 	-- only update if changed
 	if (self.giBlendOutCurZ ~=3D myLayer or self.gbBlendOutTerrainVisible ~=
=3D bTerrainVisible) then



From no-reply at zwischenwelt.org  Sat Jan 26 04:21:40 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 26 Jan 2008 03:21:40 -0000
Subject: [Iris-commit] [IRIS] r1858 - /trunk/lua/lib.3d.cam.lua
Message-ID: <20080126032140.49DC81C1868C@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 26 04:21:39 2008
New Revision: 1858

Log:
cam ground collision

Modified:
    trunk/lua/lib.3d.cam.lua

Modified: trunk/lua/lib.3d.cam.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.cam.lua (original)
+++ trunk/lua/lib.3d.cam.lua Sat Jan 26 04:21:39 2008
@@ -124,6 +124,7 @@
 	=

 	if (Renderer3D.gbNeedCorrectAspectRatio) then self:CorrectAspectRatio() e=
nd
 	=

+	local cam =3D GetMainCam()
 	local iMouseX,iMouseY =3D GetMousePos()
 	local vw,vh =3D GetViewportSize()
 	local fPhysStepTime =3D Client_GetPhysStepTime()
@@ -135,17 +136,17 @@
 		local hispeed =3D 50*speed
 		if (self.gCamKeyDown.Slow) 		then speed =3D speed * 0.2 end
 		if (self.gCamKeyDown.Fast) 		then speed =3D speed * 10 end
-		if (self.gCamKeyDown.Right)		then GetMainCam():Move(Quaternion.ApplyToVe=
ctor( speed,0,0,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)) e=
nd
-		if (self.gCamKeyDown.Left)		then GetMainCam():Move(Quaternion.ApplyToVec=
tor(-speed,0,0,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)) end
-		if (self.gCamKeyDown.Back)		then GetMainCam():Move(Quaternion.ApplyToVec=
tor(0,0, speed,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)) end
-		if (self.gCamKeyDown.Forward)	then GetMainCam():Move(Quaternion.ApplyToV=
ector(0,0,-speed,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)) =
end
-		if (self.gCamKeyDown.Up)		then GetMainCam():Move(Quaternion.ApplyToVecto=
r(0, speed,0,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)) end
-		if (self.gCamKeyDown.Down)		then GetMainCam():Move(Quaternion.ApplyToVec=
tor(0,-speed,0,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)) end
+		if (self.gCamKeyDown.Right)		then cam:Move(Quaternion.ApplyToVector( spe=
ed,0,0,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)) end
+		if (self.gCamKeyDown.Left)		then cam:Move(Quaternion.ApplyToVector(-spee=
d,0,0,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)) end
+		if (self.gCamKeyDown.Back)		then cam:Move(Quaternion.ApplyToVector(0,0, =
speed,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)) end
+		if (self.gCamKeyDown.Forward)	then cam:Move(Quaternion.ApplyToVector(0,0=
,-speed,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)) end
+		if (self.gCamKeyDown.Up)		then cam:Move(Quaternion.ApplyToVector(0, spee=
d,0,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)) end
+		if (self.gCamKeyDown.Down)		then cam:Move(Quaternion.ApplyToVector(0,-sp=
eed,0,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)) end
 			=

-		-- TODO : highspeed move : if (cInput::bKeys[cInput::kkey_l])	GetMainCam=
():Move( hispeed,0,0);
-		-- TODO : highspeed move : if (cInput::bKeys[cInput::kkey_j])	GetMainCam=
():Move(-hispeed,0,0);
-		-- TODO : highspeed move : if (cInput::bKeys[cInput::kkey_i])	GetMainCam=
():Move(0, hispeed,0);
-		-- TODO : highspeed move : if (cInput::bKeys[cInput::kkey_k])	GetMainCam=
():Move(0,-hispeed,0);
+		-- TODO : highspeed move : if (cInput::bKeys[cInput::kkey_l])	cam:Move( =
hispeed,0,0);
+		-- TODO : highspeed move : if (cInput::bKeys[cInput::kkey_j])	cam:Move(-=
hispeed,0,0);
+		-- TODO : highspeed move : if (cInput::bKeys[cInput::kkey_i])	cam:Move(0=
, hispeed,0);
+		-- TODO : highspeed move : if (cInput::bKeys[cInput::kkey_k])	cam:Move(0=
,-hispeed,0);
 	end
 	=

 	=

@@ -178,7 +179,7 @@
 		-- ego view, cam in player, turning with him
 		local x,y,z =3D gTileFreeWalk:GetExactLocalPos()
 		if (x) then =

-			GetMainCam():SetPos(x,y,z + (PlayerHasMount() and kFirstPersonZAdd_Moun=
t or kFirstPersonZAdd_NoMount))
+			cam:SetPos(x,y,z + (PlayerHasMount() and kFirstPersonZAdd_Mount or kFir=
stPersonZAdd_NoMount))
 			--~ local curdir =3D GetPlayerDir()
 			local dx,dy =3D gTileFreeWalk:GetViewDir()
 			--~ local qw,qx,qy,qz =3D gTileFreeWalk:GetOrientation()
@@ -195,15 +196,10 @@
 		if (self.gfCamAngV < -self.gfMaxCamAngVDelta) then self.gfCamAngV =3D -s=
elf.gfMaxCamAngVDelta end
 		if (self.gfCamAngV >  self.gfMaxCamAngVDelta) then self.gfCamAngV =3D  s=
elf.gfMaxCamAngVDelta end
 		=

-		local w1,x1,y1,z1 =3D Quaternion.fromAngleAxis(gfDeg2Rad * 90.0,1,0,0)	=

-		local w2,x2,y2,z2 =3D Quaternion.fromAngleAxis(self.gfCamAngH,0,1,0)	=

-		local w3,x3,y3,z3 =3D Quaternion.fromAngleAxis(self.gfCamAngV,1,0,0)
-		local w4,x4,y4,z4 =3D Quaternion.Mul(w1,x1,y1,z1, w2,x2,y2,z2)
-		=

-		self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ =3D Quaternion.M=
ul(w4,x4,y4,z4, w3,x3,y3,z3)
-		GetMainCam():SetRot(self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamR=
otZ)
-		self.gCamLookAheadX,self.gCamLookAheadY =3D Quaternion.ApplyToVector( 0,=
0,-self.gCamLookAheadDist,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gC=
amRotZ)	=

-	end
+		self:CamApplyAngHV()
+	end
+	=

+	local cam_zoff_3rdperson =3D 1.0
 	=

 	-- cam movement dependant on cam rot
 	if (self.gCamMode =3D=3D self.kCamMode_Third) then
@@ -211,9 +207,47 @@
 		local x,y,z =3D gTileFreeWalk:GetExactLocalPos()
 		if (x) then =

 			local ax,ay,az =3D Quaternion.ApplyToVector( 0,0,self.gThirdPersonDist,=
self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ)
-			GetMainCam():SetPos(ax+x,ay+y,az+z + 1.0)
-		end
-	end
+			cam:SetPos(ax+x,ay+y,az+z + cam_zoff_3rdperson)
+		end
+	end
+	=

+	-- keep cam above ground
+	local bKeepCamAboveGround =3D true
+	if (bKeepCamAboveGround) then =

+		local x,y,z =3D cam:GetPos()
+		local xloc,yloc =3D Renderer3D:LocalToUOPos(x,y,z)
+		local tiletype,ground_zloc =3D GetGroundAtAbsPos(xloc,yloc)
+		if (ground_zloc) then
+			local cam_minz =3D ground_zloc*0.1 + 0.3
+			if (z <=3D cam_minz) then =

+				cam:SetPos(x,y,cam_minz) =

+				if (self.gCamMode =3D=3D self.kCamMode_Third) then =

+					local lx,ly,lz =3D gTileFreeWalk:GetExactLocalPos()
+					if (lz) then
+						--~ local dx =3D hypot(x - lx,y - ly)
+						local dx =3D self.gThirdPersonDist
+						local dy =3D z - (lz + cam_zoff_3rdperson)
+						--~ print("3rdperson:",self.gfCamAngV,math.atan2(dy,dx),math.atan2(d=
x,dy),math.atan2(dy,dx) - math.pi*0.5,math.atan2(dx,dy) - math.pi*0.5)
+						self.gfCamAngV =3D math.atan2(dx,dy) - math.pi*0.5
+						self:CamApplyAngHV()
+						--~ > print(math.atan2(0,1)) 0
+						--~ > print(math.atan2(1,0)) 1.5707963267949
+					end
+				end
+			end
+		end
+	end
+end
+
+function Renderer3D:CamApplyAngHV()
+	local w1,x1,y1,z1 =3D Quaternion.fromAngleAxis(gfDeg2Rad * 90.0,1,0,0)	=

+	local w2,x2,y2,z2 =3D Quaternion.fromAngleAxis(self.gfCamAngH,0,1,0)	=

+	local w3,x3,y3,z3 =3D Quaternion.fromAngleAxis(self.gfCamAngV,1,0,0)
+	local w4,x4,y4,z4 =3D Quaternion.Mul(w1,x1,y1,z1, w2,x2,y2,z2)
+	=

+	self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRotZ =3D Quaternion.Mu=
l(w4,x4,y4,z4, w3,x3,y3,z3)
+	GetMainCam():SetRot(self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCamRo=
tZ)
+	self.gCamLookAheadX,self.gCamLookAheadY =3D Quaternion.ApplyToVector( 0,0=
,-self.gCamLookAheadDist,self.gCamRotW,self.gCamRotX,self.gCamRotY,self.gCa=
mRotZ)
 end
 =

 -- can return floating point block position



From no-reply at zwischenwelt.org  Sat Jan 26 10:40:32 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 26 Jan 2008 09:40:32 -0000
Subject: [Iris-commit] [IRIS] r1859 - in /trunk: bin/iris2.exe
	lua/lib.3d.cam.lua
Message-ID: <20080126094032.9AE3F1C18738@zwischenwelt.org>

Author: sience
Date: Sat Jan 26 10:40:31 2008
New Revision: 1859

Log:
-new binary
-limits the standardzoom a bit

Modified:
    trunk/bin/iris2.exe
    trunk/lua/lib.3d.cam.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/lib.3d.cam.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.cam.lua (original)
+++ trunk/lua/lib.3d.cam.lua Sat Jan 26 10:40:31 2008
@@ -88,8 +88,8 @@
 	if (add > 0) then factor =3D base end
 	if (add < 0) then factor =3D 1.0 / base end
 	=

-	gMinZoom =3D gMinZoom or 1
-	gMaxZoom =3D gMaxZoom or 80
+	gMinZoom =3D gMinZoom or 3
+	gMaxZoom =3D gMaxZoom or 30
 	local factor =3D math.max(gMinZoom,math.min(gMaxZoom,self.gThirdPersonDis=
t * factor)) / self.gThirdPersonDist =

 	self.gThirdPersonDist =3D self.gThirdPersonDist * factor
 	self.gCamLookAheadDist =3D self.gCamLookAheadDist * factor



From no-reply at zwischenwelt.org  Sat Jan 26 13:55:34 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 26 Jan 2008 12:55:34 -0000
Subject: [Iris-commit] [IRIS] r1860 - in /trunk/lua: lib.3d.cam.lua
	lib.tilefreewalk.lua
Message-ID: <20080126125535.192FD1C18738@zwischenwelt.org>

Author: sience
Date: Sat Jan 26 13:55:31 2008
New Revision: 1860

Log:
-cam ground check limited to third person
-debugterraingrid casts no shadows anymore

Modified:
    trunk/lua/lib.3d.cam.lua
    trunk/lua/lib.tilefreewalk.lua

Modified: trunk/lua/lib.3d.cam.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.cam.lua (original)
+++ trunk/lua/lib.3d.cam.lua Sat Jan 26 13:55:31 2008
@@ -213,7 +213,7 @@
 	=

 	-- keep cam above ground
 	local bKeepCamAboveGround =3D true
-	if (bKeepCamAboveGround) then =

+	if (bKeepCamAboveGround and not(gStartInDebugMode) and (self.gCamMode =3D=
=3D self.kCamMode_Third)) then =

 		local x,y,z =3D cam:GetPos()
 		local xloc,yloc =3D Renderer3D:LocalToUOPos(x,y,z)
 		local tiletype,ground_zloc =3D GetGroundAtAbsPos(xloc,yloc)

Modified: trunk/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.tilefreewalk.lua (original)
+++ trunk/lua/lib.tilefreewalk.lua Sat Jan 26 13:55:31 2008
@@ -38,6 +38,7 @@
 	local gfx =3D CreateRootGfx3D()
 	gDebugTerrainGridGfx =3D gfx
 	gfx:SetSimpleRenderable()
+	gfx:SetCastShadows(false)
 	=

 	rx =3D rx + 0.5
 	ry =3D ry + 0.5



From no-reply at zwischenwelt.org  Sat Jan 26 14:38:56 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 26 Jan 2008 13:38:56 -0000
Subject: [Iris-commit] [IRIS] r1861 - /trunk/src/grannyogreloader.cpp
Message-ID: <20080126133857.E266A1C18731@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Jan 26 14:38:54 2008
New Revision: 1861

Log:
better search for bone by name without throwing+catching exceptions

Modified:
    trunk/src/grannyogreloader.cpp

Modified: trunk/src/grannyogreloader.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/grannyogreloader.cpp (original)
+++ trunk/src/grannyogreloader.cpp Sat Jan 26 14:38:54 2008
@@ -3,6 +3,7 @@
 #include "grannyloader_i2.h"
 #include "grannyogreloader.h"
 #include "lugre_fifo.h"
+#include "lugre_ogrewrapper.h"
 #undef min
 #undef max
 #include <Ogre.h>
@@ -80,11 +81,8 @@
 		=

 		// retrieves bone from skeleton (search by name)
 		std::string sName =3D mpGrannyLoader->GetBoneName(iBoneID);
-		Ogre::Bone* pBone =3D 0;
-		try {
-			if (sName.size() > 0) pBone =3D mpSkeleton->getBone(sName);
-		} catch (Ogre::Exception& e) {}
-			=

+		Ogre::Bone* pBone =3D cOgreWrapper::SearchBoneByName(*mpSkeleton,sName.c=
_str());
+		=

 		// get ogre bone handle/index
 		int res =3D pBone ? pBone->getHandle() : -1;
 		//printf("  WeightBoneIndex2OgreBoneHandle(%2d[%2d]) =3D %2d [%s]\n",iWe=
ightBoneIndex,iBoneID,res,sName.c_str());
@@ -442,10 +440,7 @@
 		}
 		=

 		// check if bone already exists
-		Ogre::Bone* pBone =3D 0;
-		try {
-			pBone =3D mpSkeleton->getBone(sName);
-		} catch (Ogre::Exception& e) {}
+		Ogre::Bone* pBone =3D cOgreWrapper::SearchBoneByName(*mpSkeleton,sName.c=
_str());
 		if (pBone) return pBone;
 		=

 		// create bone



From no-reply at zwischenwelt.org  Sat Jan 26 15:53:00 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 26 Jan 2008 14:53:00 -0000
Subject: [Iris-commit] [IRIS] r1862 - in /trunk: bin/iris2.exe
 data/config.lua.dist data/grannys/materials/grannybase.material
 lua/lib.granny.lua
Message-ID: <20080126150002.BC8B41C18738@zwischenwelt.org>

Author: sience
Date: Sat Jan 26 15:52:59 2008
New Revision: 1862

Log:
-skin shader added, to activate turn (gUseHumanSkinShader=3Dtrue , has prob=
lems with mounts)
-new win32 binary

Modified:
    trunk/bin/iris2.exe
    trunk/data/config.lua.dist
    trunk/data/grannys/materials/grannybase.material
    trunk/lua/lib.granny.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Jan 26 15:52:59 2008
@@ -432,3 +432,5 @@
 =

 gEnableLowDetailTerrainFarSight =3D false -- additional lower quality terr=
ain in the distance
 gEnableLowDetailTerrainFarSightRangeAdd =3D 2
+
+gUseHumanSkinShader =3D false

Modified: trunk/data/grannys/materials/grannybase.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/grannys/materials/grannybase.material (original)
+++ trunk/data/grannys/materials/grannybase.material Sat Jan 26 15:52:59 20=
08
@@ -8,36 +8,59 @@
 {
 	receive_shadows off
 =

+	// FIXED FUNCTION - Fallback technique
+	// Software blending technique
+	technique Plain
+	{
+		scheme Plain
+
+		pass
+		{
+			scene_blend alpha_blend
+			alpha_rejection greater_equal 50
+			texture_unit
+			{
+				texture stone512.dds
+			}
+		}
+	}
+}
+
+material grannybase_human
+{
+	receive_shadows off
+
 	// Shader: CG & GLSL
 	// Hardware skinning technique
-//	technique Shader
-//	{
-//		scheme Shader
+	technique Shader
+	{
+		scheme Shader
 =

-//		pass
-//		{
-//			cull_hardware none
-//			cull_software none
-			//scene_blend alpha_blend
-//			alpha_rejection greater_equal 255
+		pass
+		{
+			cull_hardware none
+			cull_software none
+			=

+			scene_blend alpha_blend
+			alpha_rejection greater_equal 50
 =

-//			vertex_program_ref Ogre/HardwareSkinningTwoWeights
-//			{
-//			}
+			vertex_program_ref Ogre/HardwareSkinningTwoWeights
+			{
+			}
 			// alternate shadow caster program
-//			shadow_caster_vertex_program_ref Ogre/HardwareSkinningTwoWeightsShado=
wCaster
-//			{
-//				param_named_auto worldMatrix3x4Array world_matrix_array_3x4
-//				param_named_auto viewProjectionMatrix viewproj_matrix
-//				param_named_auto ambient ambient_light_colour
-//			}
+			shadow_caster_vertex_program_ref Ogre/HardwareSkinningTwoWeightsShadowC=
aster
+			{
+				param_named_auto worldMatrix3x4Array world_matrix_array_3x4
+				param_named_auto viewProjectionMatrix viewproj_matrix
+				param_named_auto ambient ambient_light_colour
+			}
 =

-//			texture_unit
-//			{
-//				texture stone512.dds
-//			}
-//		}
-//	}
+			texture_unit
+			{
+				texture stone512.dds
+			}
+		}
+	}
 =

 	// FIXED FUNCTION - Fallback technique
 	// Software blending technique
@@ -47,8 +70,6 @@
 =

 		pass
 		{
-//			cull_hardware none
-//			cull_software none
 			scene_blend alpha_blend
 			alpha_rejection greater_equal 50
 			texture_unit

Modified: trunk/lua/lib.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.lua (original)
+++ trunk/lua/lib.granny.lua Sat Jan 26 15:52:59 2008
@@ -210,7 +210,14 @@
 		local texturepath =3D CorrectGrannyPath("Maps/"..texname)
 		local texturemaskpath =3D CorrectGrannyPath("Maps/"..texmaskname)
 		-- texturepath will usually be an absolute path such as "/cavern/uostuff=
/uo/Models/Maps/UT256_Armor_Ring_V2.tga"
-		matname =3D CloneMaterial("grannybase")
+
+		--use skinshader for characters male/female, all other stuff uses granny=
base plain
+		if (IsBodyIDHuman(modelid) and gUseHumanSkinShader) then
+			matname =3D CloneMaterial("grannybase_human")
+		else
+			matname =3D CloneMaterial("grannybase")
+		end
+
 		if (gGrannyUseCompleteHuePalette) then
 			SetTexture(matname,CreateGrannyHuedTexture(GrannyTextureHook(texturepat=
h),GrannyTextureHook(texturemaskpath),gHueLoader,hue))
 		else



From no-reply at zwischenwelt.org  Wed Jan 30 23:17:22 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 30 Jan 2008 22:17:22 -0000
Subject: [Iris-commit] [IRIS] r1863 - in /trunk: data/config.lua.dist
 data/profiles/gfx_high.lua data/profiles/gfx_low.lua
 data/profiles/gfx_med.lua data/profiles/gfx_ultralow.lua
 lua/lib.loading.lua lua/main.lua
Message-ID: <20080130221725.9E16F1C1807A@zwischenwelt.org>

Author: sience
Date: Wed Jan 30 23:17:15 2008
New Revision: 1863

Log:
-some reorganizsation with config & gfx-profiles
-config is now initialized with graphicprofile MEDIUM
-no copy from config.lua.dist anymore

Modified:
    trunk/data/config.lua.dist
    trunk/data/profiles/gfx_high.lua
    trunk/data/profiles/gfx_low.lua
    trunk/data/profiles/gfx_med.lua
    trunk/data/profiles/gfx_ultralow.lua
    trunk/lua/lib.loading.lua
    trunk/lua/main.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Wed Jan 30 23:17:15 2008
@@ -4,13 +4,14 @@
 =

 kGuiToolTipWait =3D 100
 =

--- Client Identification String
-gClientVersion =3D "6.0.1.6"  -- try other version for example "4.0.11c5"
+-- Client Identification String (try other version for example "4.0.11c5")
+gClientVersion =3D "6.0.1.6"
 =

 -- Camera Rotation - Input stuff use: "mouse1", "mouse2" or "mouse3"
 gInput_CamMouseButton =3D GetNamedKey("mouse1")
-gUseConstantCameraRotation=3Dtrue			--mouse camera rotation
--- todo : invert mouse, mouse sensitivity
+
+--mouse camera rotation
+gUseConstantCameraRotation=3Dtrue
 =

 -- your UO-Path (if not automatically detected)
 -- gUOPath =3D "/some/where/uo/"  -- example for linux
@@ -71,7 +72,7 @@
 gUniFontLoaderType					=3D "FullFile" -- currently only FullFile available
 =

 -- sightrange is in blocks (8x8 tiles), larger values let you see further,=
 but will result in lower fps
-gSightRange	=3D 3
+gSightRange	=3D 4
 =

 -- 0 Trammel, 1 Felucca, 2 Ilshenar, 3 Malas, 4 Tokuno
 gMapIndex =3D 0
@@ -98,7 +99,6 @@
 -- Ambient Light
 gAmbientLight =3D {r=3D0.4,g=3D0.4,b=3D0.4}
 =

-
 -- Soundeffects & Music
 -- gUseSoundSystem =3D "openal"
 gUseSoundSystem =3D "fmod"
@@ -106,10 +106,14 @@
 gUseMusic =3D true
 =

 gCurrentRenderer =3D Renderer3D	-- Renderer2D
-gbUseStaticGeometryForTerrain =3D false -- setting this to true might spee=
d up rendering but causes lags on mapblock-loading
-
-Renderer3D.gMapUpdateInterval =3D 40 -- update the map not every frame, de=
crease for free-flight-videos
-Renderer3D.gMaxMapBlocksLoadedPerUpdate =3D 1 -- increase for free-flight-=
videos
+
+-- setting this to true might speed up rendering but causes lags on mapblo=
ck-loading
+gbUseStaticGeometryForTerrain =3D false
+
+-- update the map not every frame, decrease for free-flight-videos
+Renderer3D.gMapUpdateInterval =3D 40
+-- increase for free-flight-videos
+Renderer3D.gMaxMapBlocksLoadedPerUpdate =3D 1
 =

 -- Server Emulator Configuration
 --------------------------------
@@ -241,11 +245,14 @@
 -- WARNING !!! this takes some seconds 25sec. first time and approx. 100MB=
 RAM needed
 gPreloadStaticMesh =3D false
 =

-gEnableFallBackBillboards_Statics =3D false -- incorrect fallbacks can be =
added to the skiplist using the fallbacktool (f11)
+-- incorrect fallbacks can be added to the skiplist using the fallbacktool=
 (f11)
+gEnableFallBackBillboards_Statics =3D false
 gEnableFallBackBillboards_Dynamics =3D true
 gForceFallBackBillboards_Statics =3D false
 gForceFallBackBillboards_Dynamics =3D false
-gUseWhiteBoxAsFallBack =3D false	-- use boxes not uo art billboards as fal=
lbacks
+
+-- use boxes not uo art billboards as fallbacks
+gUseWhiteBoxAsFallBack =3D false
 =

 -- timeout of the text shown over the mobiles head in ms
 gHeadTextTimeout =3D 2 * 1000
@@ -260,8 +267,10 @@
 gFadeLineTime =3D 10 * 1000 -- msec, 1000=3D1sec
 =

 gbUseExactGrannyMousepicking =3D true
+
+-- use simple hueing to save vram by default
 gEnableGrannyMaterials =3D true
-gGrannyUseCompleteHuePalette =3D false -- use simple hueing to save vram b=
y default
+gGrannyUseCompleteHuePalette =3D false
 =

 -- shadow settings
 --"none", "stencil_modulative", "stencil_additive", "texture_modulative", =
"texture_additive", "texture_additive_integrated", "texture_modulative_inte=
grated"
@@ -287,8 +296,8 @@
 =

 gShowTileFreeDebug =3D false
 =

--- Language
--- gLanguage =3D "DEU"		-- used for client localization
+-- used for client localization
+gLanguage =3D "ENU"
 =

 ------------------------------ UO Files --------------------------
 gHuesFile		=3D "hues.mul"
@@ -408,29 +417,34 @@
 }
 =

 gEnableMultiTexTerrain =3D true
-gDisableMultiTexTerrainTransitions =3D false -- ugly, but faster
+-- ugly, but faster
+gDisableMultiTexTerrainTransitions =3D false
 =

 -- Fastbatching of Statics/Dynamics (no hueing)
 gFastBatchStatics =3D true
 gFastBatchDynamics =3D true
 =

-gModelPath_Mesh	=3D "models/models/" -- overrideable for texture-atlas exp=
eriments
-gModelPath_Tex	=3D "models/textures/"
---~ gModelPath_Mesh	=3D "models/models_texatlas/"
---~ gModelPath_Tex	=3D "models/textures_texatlas/"
-gUseTexAtlas =3D true -- only used if fastbatch is active
-
-gEnableCompassRadar =3D false -- the detailed compass is rendered using st=
encil buffers and seems to cause trouble with shadows
-
-gAtlasRes =3D "med" --"med", "low", "ultralow", "none"	(none stands for: u=
se highest single textures)
-
-gQuickCompassMD5Check =3D false -- if true : only checks file-paths instea=
d of file contents, WARNING : doesn't detect updates
-
-gDisableBottomLine =3D false -- the debug display at the bottom of the scr=
een
-
-gDisableWater =3D false -- for debugging
-
-gEnableLowDetailTerrainFarSight =3D false -- additional lower quality terr=
ain in the distance
+-- the detailed compass is rendered using stencil buffers and seems to cau=
se trouble with shadows
+gEnableCompassRadar =3D false
+
+--"med", "low", "ultralow", "none"	(none stands for: use highest single te=
xtures)
+gAtlasRes =3D "med"
+
+-- if true : only checks file-paths instead of file contents, WARNING : do=
esn't detect updates
+gQuickCompassMD5Check =3D false
+
+-- the debug display at the bottom of the screen
+gDisableBottomLine =3D false
+
+-- for debugging
+gDisableWater =3D false
+
+-- additional lower quality terrain in the distance
+gEnableLowDetailTerrainFarSight =3D false
 gEnableLowDetailTerrainFarSightRangeAdd =3D 2
 =

+-- shaderbased characterrendering (beta)
 gUseHumanSkinShader =3D false
+
+-- "ultralow", "low", "med", "high", "ultrahigh"
+gGraphicProfile =3D "med"

Modified: trunk/data/profiles/gfx_high.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/profiles/gfx_high.lua (original)
+++ trunk/data/profiles/gfx_high.lua Wed Jan 30 23:17:15 2008
@@ -1,24 +1,11 @@
-gFastBatchStatics =3D true
-gFastBatchDynamics =3D true
-
 gAtlasRes =3D "none"
-gFastBatchStatics =3D false
-gFastBatchDynamics =3D false
-
-gUseDistanceFog =3D true
-
-gEnableMultiTexTerrain =3D true
-gDisableMultiTexTerrainTransitions =3D false
 =

 gShadowTechnique =3D "texture_additive"
 gStaticsCastShadows =3D true
 gDynamicsCastShadows =3D true
 gMobileCastShadows =3D true
 =

-gEnableGrannyMaterials =3D true
-
 gSightRange	=3D 4
-gParticleEffectSystem =3D true
 gLightsources =3D true
 =

 gPreloadStaticMesh =3D true

Modified: trunk/data/profiles/gfx_low.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/profiles/gfx_low.lua (original)
+++ trunk/data/profiles/gfx_low.lua Wed Jan 30 23:17:15 2008
@@ -1,11 +1,7 @@
-gFastBatchStatics =3D true
-gFastBatchDynamics =3D true
-
 gAtlasRes =3D "low"
 =

 gUseDistanceFog =3D false
 =

-gEnableMultiTexTerrain =3D true
 gDisableMultiTexTerrainTransitions =3D true
 =

 gShadowTechnique =3D "none"
@@ -13,10 +9,6 @@
 gDynamicsCastShadows =3D false
 gMobileCastShadows =3D false
 =

-gEnableGrannyMaterials =3D true
-
 gSightRange	=3D 2
-gParticleEffectSystem =3D true
-gLightsources =3D false
 =

 gGroundBlockLoaderType     =3D "OnDemand"

Modified: trunk/data/profiles/gfx_med.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/profiles/gfx_med.lua (original)
+++ trunk/data/profiles/gfx_med.lua Wed Jan 30 23:17:15 2008
@@ -1,20 +1,8 @@
-gFastBatchStatics =3D true
-gFastBatchDynamics =3D true
-
 gAtlasRes =3D "med"
 =

-gUseDistanceFog =3D true
+gShadowTechnique =3D "texture_additive"
+gStaticsCastShadows =3D true
+gDynamicsCastShadows =3D true
+gMobileCastShadows =3D true
 =

-gEnableMultiTexTerrain =3D true
-gDisableMultiTexTerrainTransitions =3D false
-
-gShadowTechnique =3D "none"
-gStaticsCastShadows =3D false
-gDynamicsCastShadows =3D false
-gMobileCastShadows =3D false
-
-gEnableGrannyMaterials =3D true
-
-gSightRange	=3D 3
-gParticleEffectSystem =3D true
-gLightsources =3D true
+gSightRange	=3D 4

Modified: trunk/data/profiles/gfx_ultralow.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/profiles/gfx_ultralow.lua (original)
+++ trunk/data/profiles/gfx_ultralow.lua Wed Jan 30 23:17:15 2008
@@ -1,11 +1,9 @@
-gFastBatchStatics =3D true
-gFastBatchDynamics =3D true
+gAtlasRes =3D "ultralow"
 =

-gAtlasRes =3D "ultralow"
+gDisableWater =3D true
 =

 gUseDistanceFog =3D false
 =

-gEnableMultiTexTerrain =3D true
 gDisableMultiTexTerrainTransitions =3D true
 =

 gShadowTechnique =3D "none"
@@ -19,9 +17,6 @@
 gParticleEffectSystem =3D false
 gLightsources =3D false
 =

-gEnableFallBackBillboards_Statics =3D false
 gEnableFallBackBillboards_Dynamics =3D false
-gForceFallBackBillboards_Statics =3D false
-gForceFallBackBillboards_Dynamics =3D false
 =

 gGroundBlockLoaderType     =3D "OnDemand"

Modified: trunk/lua/lib.loading.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.loading.lua (original)
+++ trunk/lua/lib.loading.lua Wed Jan 30 23:17:15 2008
@@ -53,6 +53,28 @@
 	if (gGumpLoaderType) then
 		LoadingProfile("init GumpLoader")
 		gGumpLoader =3D CreateGumpLoader(gGumpLoaderType,CorrectPath( Addfilepat=
h(gGumpidxFile) ),CorrectPath( Addfilepath(gGumpFile) ))
+	end
+end
+
+function LoadTexAtlas ()
+	-- load texture atlas mappings
+	-- high, med, low
+	-- TODO move to config or automatic best choosing
+	if gAtlasRes =3D=3D "med" then
+		---- med res
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_med.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_med.lua")
+		gUseTexAtlas =3D true		-- Lugre setting, only used if fastbatch is active
+	elseif gAtlasRes =3D=3D "low" then
+		---- low res
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_low.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_low.lua")
+		gUseTexAtlas =3D true		-- Lugre setting, only used if fastbatch is active
+	elseif gAtlasRes =3D=3D "ultralow" then
+		---- ultralow res
+		dofile(datapath .. "models/atlas/tex_atlas_alpha_ultralow.lua")
+		dofile(datapath .. "models/atlas/tex_atlas_ultralow.lua")
+		gUseTexAtlas =3D true		-- Lugre setting, only used if fastbatch is active
 	end
 end
 =


Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Wed Jan 30 23:17:15 2008
@@ -117,11 +117,15 @@
 	local fp =3D io.open(gConfigPath,"w")
 	fp:write("-- this is your local config file, here you can override the de=
fault options\n")
 	fp:write("-- gUOPath =3D \"C:\\\\stuff\\\\iris\\\\uo\\\\\" -- enter the p=
ath to your uo data dir here\n")
-	for line in io.lines(gConfigPathFallback) do =

-		if (not string.find(line,"DO NOT EDIT THIS FILE DIRECTLY")) then =

-			fp:write(line.."\n") =

-		end =

-	end
+	fp:write("\n")
+	fp:write("-- \"ultralow\", \"low\", \"med\", \"high\", \"ultrahigh\"\n")
+	fp:write("gGraphicProfile =3D \"med\"\n")
+	fp:write("\n")
+--	for line in io.lines(gConfigPathFallback) do =

+--		if (not string.find(line,"DO NOT EDIT THIS FILE DIRECTLY")) then =

+--			fp:write(line.."\n") =

+--		end =

+--	end
 	fp:close()
 end
 =

@@ -146,6 +150,21 @@
 	end
 	fp:close()
 end
+
+--###############################
+--###      GRAPHIC-CONFIG     ###
+--###############################
+if (gGraphicProfile) then
+	local graphicprofile=3Ddatapath.."profiles/gfx_"..gGraphicProfile..".lua"
+	if (file_exists(graphicprofile)) then
+		-- execute local graphicprofile
+		dofile(graphicprofile)
+		print("Setting Graphicprofile: "..graphicprofile)
+	else
+		print("Setting Graphicprofile failed: "..graphicprofile)
+	end
+end
+
 =

 --###############################
 --##  OGRE RESOURCE LOCATIONS  ##
@@ -179,13 +198,11 @@
 	--~ # distributet models
 	OgreAddResLoc(mydatapath.."models/materials"			,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."models/meta"					,"FileSystem","General")
-	for i=3D1,20 do OgreAddResLoc(mydatapath..gModelPath_Mesh..sprintf("to_%0=
3d000",i)	,"FileSystem","General") end
-	OgreAddResLoc(mydatapath..gModelPath_Tex				,"FileSystem","General")
+	for i=3D1,20 do OgreAddResLoc(mydatapath.."models/models/"..sprintf("to_%=
03d000",i)	,"FileSystem","General") end
+	OgreAddResLoc(mydatapath.."models/textures/"			,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."models/programs"				,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."models/atlas"				,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."models/"						,"FileSystem","General")
-	--~ OgreAddResLoc(mydatapath.."models/models"				,"FileSystem","General")
-	OgreAddResLoc(mydatapath..gModelPath_Mesh				,"FileSystem","General")
 =

 	--~ # new Terrain Shaderengine
 	OgreAddResLoc(mydatapath.."terrain/materials"			,"FileSystem","General")
@@ -323,22 +340,7 @@
 =

 	LoadBasicData()
 	=

-	-- load texture atlas mappings
-	-- high, med, low
-	-- TODO move to config or automatic best choosing
-	if gAtlasRes =3D=3D "med" then
-		---- med res
-		dofile(datapath .. "models/atlas/tex_atlas_alpha_med.lua")
-		dofile(datapath .. "models/atlas/tex_atlas_med.lua")
-	elseif gAtlasRes =3D=3D "low" then
-		---- low res
-		dofile(datapath .. "models/atlas/tex_atlas_alpha_low.lua")
-		dofile(datapath .. "models/atlas/tex_atlas_low.lua")
-	elseif gAtlasRes =3D=3D "ultralow" then
-		---- ultralow res
-		dofile(datapath .. "models/atlas/tex_atlas_alpha_ultralow.lua")
-		dofile(datapath .. "models/atlas/tex_atlas_ultralow.lua")
-	end
+	LoadTexAtlas()
 	=

 	-- show loading screen
 	SetLoadingBackground()
@@ -349,6 +351,7 @@
 =

 	InvokeExporters()
 	=

+	------------------------------------------ obsolete, just for testing ---=
--------------------------------
 	if (false) then -- texture-atlas test
 		local w =3D 1024
 		local iArtMapIDList =3D {65,129,321,449,513}
@@ -372,6 +375,7 @@
 		img:Destroy()
 		os.exit(0)
 	end
+	-------------------------------------------------------------------------=
---------------------------------
 	=

 	gCurrentRenderer:PreInit()
 =

@@ -391,6 +395,7 @@
 =

 	-- mainloop
 	while (Client_IsAlive()) do =

+		------------------------------------------ obsolete, just for testing --=
---------------------------------
 		--[[	=

 		if gGrass and gStaticLoader then =

 			gGrass:Update() =

@@ -428,7 +433,8 @@
 			]]--
 		end
 		]]--
-		=

+		------------------------------------------------------------------------=
----------------------------------
+	=

 		MainStep() =

 	end
 end



From no-reply at zwischenwelt.org  Thu Jan 31 21:35:50 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 31 Jan 2008 20:35:50 -0000
Subject: [Iris-commit] [IRIS] r1864 - in /trunk: data/ data/base/hotbar/
	lua/ lua/filter/ lua/gui/
Message-ID: <20080131203550.4B1A01C1844D@zwischenwelt.org>

Author: sience
Date: Thu Jan 31 21:35:48 2008
New Revision: 1864

Log:
-hotbar gui image added (CTRL+B)

Added:
    trunk/data/base/hotbar/
    trunk/data/base/hotbar/gorspellbar05up0.png   (with props)
    trunk/data/base/hotbar/hotbar.material
    trunk/lua/gui/gui.hotbar.lua
Modified:
    trunk/data/mymacros.lua.dist
    trunk/lua/filter/filter.granny.lua
    trunk/lua/gui/gui.journal.lua
    trunk/lua/gui/gui.main.lua
    trunk/lua/lib.3d.mobile.lua
    trunk/lua/lib.gui.iris.lua
    trunk/lua/lib.macrolist.lua
    trunk/lua/main.lua

Modified: trunk/data/mymacros.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/mymacros.lua.dist (original)
+++ trunk/data/mymacros.lua.dist Thu Jan 31 21:35:48 2008
@@ -33,6 +33,7 @@
 -- SetMacro("ctrl+h",	function() MacroCmd_Spell("Heal") end)
 -- SetMacro("ctrl+a",	function() MacroCmd_Skill("Anatomy") end)
 =

+SetMacro("ctrl+b",		function() MacroCmd_Open("Hotbar") end)
 SetMacro("l",			function() MacroCmd_Open("Logo") end)
 SetMacro("n",			function() MacroCmd_Open("Compass") end)
 SetMacro("tab",			function() MacroCmd_ToggleWarmode() end)
@@ -40,7 +41,7 @@
 SetMacro("point",		function() MacroCmd_ZoomCompass(1/1.5) end)
 SetMacro("f10",			function() MacroCmd_ShowDevTool() end)
 SetMacro("f11",			function() MacroCmd_ShowFallBackTool() end)
-SetMacro("shift+f12",			function() MacroCmd_GridScreenshot() end)
+SetMacro("shift+f12",	function() MacroCmd_GridScreenshot() end)
 SetMacro("f12",			function() FadeLineToggleShowAll() end)
 SetMacro("v",			function() MacroCmd_Screenshot() end)
 SetMacro("x",			function() MacroCmd_CamChangeZoom( 1) end)

Modified: trunk/lua/filter/filter.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.granny.lua (original)
+++ trunk/lua/filter/filter.granny.lua Thu Jan 31 21:35:48 2008
@@ -34,4 +34,4 @@
 --gGrannyFilter[220]	=3D{meshname=3D"Lich.mesh"}
 --gGrannyFilter[5]	=3D{grannyid=3D220}				--birds_eagle
 --gGrannyFilter[39]	=3D{grannyid=3D220}				--mongbats_mongbat
---gGrannyFilter[105]	=3D{grannyid=3D220}				--dragons_wyrm_ancient
+--gGrannyFilter[105]	=3D{grannyid=3D220}				--dragons_wyrm_ancient

Modified: trunk/lua/gui/gui.journal.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.journal.lua (original)
+++ trunk/lua/gui/gui.journal.lua Thu Jan 31 21:35:48 2008
@@ -335,4 +335,4 @@
             widget.mbIgnoreMouseOver =3D false
     end
     =

-end
+end

Modified: trunk/lua/gui/gui.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.main.lua (original)
+++ trunk/lua/gui/gui.main.lua Thu Jan 31 21:35:48 2008
@@ -6,3 +6,4 @@
 dofile(libpath .. "gui/gui.quit.lua")
 dofile(libpath .. "gui/gui.status.lua")
 dofile(libpath .. "gui/gui.styles.lua")
+dofile(libpath .. "gui/gui.hotbar.lua")

Modified: trunk/lua/lib.3d.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mobile.lua (original)
+++ trunk/lua/lib.3d.mobile.lua Thu Jan 31 21:35:48 2008
@@ -140,7 +140,6 @@
 		mobile.selection =3D CreateRootGfx3D()
 		mobile.selection:SetSimpleRenderable()
 		mobile.selection:SetMaterial("aura_base")
-
 		mobile.selection:RenderableBegin(4,6,false,false,OT_TRIANGLE_LIST)
 		mobile.selection:RenderableVertex(-e,-e,0, nx,ny,nz, 0,0, r,g,b,a)
 		mobile.selection:RenderableVertex( e,-e,0, nx,ny,nz, 1,0, r,g,b,a)

Modified: trunk/lua/lib.gui.iris.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.gui.iris.lua (original)
+++ trunk/lua/lib.gui.iris.lua Thu Jan 31 21:35:48 2008
@@ -66,6 +66,7 @@
 -- called every frame
 function gui.Step ()
 	UpdateCompass()
+	UpdateHotbar()
 	DisplayMemoryUsage(OgreMemoryUsage("all"))
 end
 =


Modified: trunk/lua/lib.macrolist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.macrolist.lua (original)
+++ trunk/lua/lib.macrolist.lua Thu Jan 31 21:35:48 2008
@@ -15,7 +15,8 @@
 gMacroOpenCommands.Backpack			=3D function()	TogglePlayerBackpack()		end
 gMacroOpenCommands.Paperdoll		=3D function()	TogglePlayerPaperdoll()		end
 gMacroOpenCommands.Compass			=3D function()	ToggleCompass()				end
-gMacroOpenCommands.Logo				=3D function()	ToggleLogo() end
+gMacroOpenCommands.Logo				=3D function()	ToggleLogo()				end
+gMacroOpenCommands.Hotbar			=3D function()	ToggleHotbar ()				end
 =

 gMacroItemSlots =3D {}
 gMacroReadMobileStats =3D {}

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Thu Jan 31 21:35:48 2008
@@ -181,6 +181,7 @@
 	OgreAddResLoc(mydatapath.."tmp"							,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."base/ui"						,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."base/font"					,"FileSystem","General")
+	OgreAddResLoc(mydatapath.."base/hotbar"					,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."skybox/materials"			,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."skybox/textures"				,"FileSystem","General")
 	OgreAddResLoc(mydatapath.."particles/materials"			,"FileSystem","General")



From no-reply at zwischenwelt.org  Thu Jan 31 22:14:31 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 31 Jan 2008 21:14:31 -0000
Subject: [Iris-commit] [IRIS] r1865 - /trunk/data/profiles/gfx_ultrahigh.lua
Message-ID: <20080131220008.3D4511C18124@zwischenwelt.org>

Author: sience
Date: Thu Jan 31 22:14:30 2008
New Revision: 1865

Log:
-ultrahigh gfx-profile added

Added:
    trunk/data/profiles/gfx_ultrahigh.lua



From no-reply at zwischenwelt.org  Thu Jan 31 22:58:14 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 31 Jan 2008 21:58:14 -0000
Subject: [Iris-commit] [IRIS] r1866 - in /trunk/data/profiles: gfx_high.lua
	gfx_ultrahigh.lua
Message-ID: <20080131220008.454251C181BB@zwischenwelt.org>

Author: sience
Date: Thu Jan 31 22:58:14 2008
New Revision: 1866

Log:
-lights disabled

Modified:
    trunk/data/profiles/gfx_high.lua
    trunk/data/profiles/gfx_ultrahigh.lua

Modified: trunk/data/profiles/gfx_high.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/profiles/gfx_high.lua (original)
+++ trunk/data/profiles/gfx_high.lua Thu Jan 31 22:58:14 2008
@@ -5,7 +5,6 @@
 gDynamicsCastShadows =3D true
 gMobileCastShadows =3D true
 =

-gSightRange	=3D 4
-gLightsources =3D true
+gSightRange	=3D 5
 =

 gPreloadStaticMesh =3D true

Modified: trunk/data/profiles/gfx_ultrahigh.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/profiles/gfx_ultrahigh.lua (original)
+++ trunk/data/profiles/gfx_ultrahigh.lua Thu Jan 31 22:58:14 2008
@@ -11,8 +11,6 @@
 gEnableLowDetailTerrainFarSight =3D true
 gEnableLowDetailTerrainFarSightRangeAdd =3D 4
 =

-gLightsources =3D true
-
 gPreloadStaticMesh =3D true
 =

 gArtMapLoaderType	=3D "FullFile"



From no-reply at zwischenwelt.org  Thu Jan 31 23:58:09 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 31 Jan 2008 22:58:09 -0000
Subject: [Iris-commit] [IRIS] r1867 - in /trunk/lua: lib.3d.renderer.lua
	main.lua
Message-ID: <20080131225810.6AB131C181B7@zwischenwelt.org>

Author: sience
Date: Thu Jan 31 23:58:09 2008
New Revision: 1867

Log:
-setup shadowsystem is moved to Init 3DRenderer

Modified:
    trunk/lua/lib.3d.renderer.lua
    trunk/lua/main.lua

Modified: trunk/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.renderer.lua (original)
+++ trunk/lua/lib.3d.renderer.lua Thu Jan 31 23:58:09 2008
@@ -56,6 +56,47 @@
 	=

 	if (gUseDistanceFog) then
 		Client_SetFog(3, gFogcolorred/255, gFogcolorgreen/255, gFogcolorblue/255=
, 1.0, 0, 10*gSightRange, 10*gSightRange+gFogValue)
+	end
+end
+
+gBuildStencilShadowEdgeList =3D false
+function Renderer3D:SetupShadows()
+	local shadowfardist=3D5*gSightRange+gFogValue
+
+	if ((gShadowTechnique =3D=3D "stencil_modulative") or (gShadowTechnique =
=3D=3D "stencil_additive")) then
+		----- currently doesn't work with Fastbatch
+		--OgreShadowTechnique(gShadowTechnique)
+		--OgreSetShadowFarDistance(shadowfardist)
+		--gBuildStencilShadowEdgeList=3Dtrue
+	elseif ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechniq=
ue =3D=3D "texture_additive")) then
+		OgreSetShadowFarDistance(shadowfardist)
+		OgreSetShadowTextureFadeStart(0.6)
+		OgreSetShadowTextureFadeEnd(0.9)
+
+--		OgreSetShadowTexturePixelFormat(PF_FLOAT32_R)
+--		if ( OgreRenderSystemIsOpenGL() ) then OgreSetShadowTexturePixelFormat=
(PF_FLOAT16_R) end
+--		OgreSetShadowTextureCasterMaterial("Ogre/DepthShadowmap/Caster/Float")
+--		OgreSetShadowTextureReceiverMaterial("Ogre/DepthShadowmap/BasicTemplat=
eMaterial")
+
+		OgreSetShadowTextureSelfShadow(true)		-- disable this or write in materi=
al "receive_shadows off"
+		OgreSetShadowCasterRenderBackFaces(false)
+		OgreSetShadowTextureSize(2048)
+		OgreSetShadowTextureCount(3)
+
+		OgreShadowTechnique(gShadowTechnique)
+	elseif ((gShadowTechnique =3D=3D "texture_additive_integrated") or (gShad=
owTechnique =3D=3D "texture_modulative_integrated")) then
+		OgreSetShadowFarDistance(shadowfardist)
+		OgreSetShadowTextureFadeStart(0.5)
+		OgreSetShadowTextureFadeEnd(0.9)
+
+--		OgreSetShadowTexturePixelFormat(PF_FLOAT32_R)
+		OgreSetShadowTextureCasterMaterial("Ogre/DepthShadowmap/Caster/Float")
+		OgreSetShadowTextureSelfShadow(true)		-- disable this or write in tex_ba=
se "receive_shadows off"
+		OgreSetShadowCasterRenderBackFaces(false)
+		OgreSetShadowTextureSize(2048)
+		--OgreSetShadowTextureCount(3)
+
+ 		OgreShadowTechnique(gShadowTechnique)
 	end
 end
 =

@@ -110,6 +151,9 @@
 	self.gbCamRotChanged =3D true
 	for k,dynamic in pairs(GetDynamicList()) do if (DynamicIsInWorld(dynamic)=
) then self:AddDynamicItem(dynamic) end end
 	for k,mobile in pairs(GetMobileList()) do self:CreateMobileGfx(mobile) end
+	=

+	-- Initialize Shadowsystem
+	self:SetupShadows()
 end
 =

 function Renderer3D:DeInit()

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Thu Jan 31 23:58:09 2008
@@ -272,39 +272,6 @@
 	end
 end
 =

-gBuildStencilShadowEdgeList =3D false
-function SetupShadows()
-	if ((gShadowTechnique =3D=3D "stencil_modulative") or (gShadowTechnique =
=3D=3D "stencil_additive")) then
-		OgreShadowTechnique(gShadowTechnique)
-		OgreSetShadowFarDistance(gSightRange*18.0)
-		gBuildStencilShadowEdgeList=3Dtrue
-	elseif ((gShadowTechnique =3D=3D "texture_modulative") or (gShadowTechniq=
ue =3D=3D "texture_additive")) then
-		OgreSetShadowFarDistance(gSightRange*18.0)
-
---		OgreSetShadowTexturePixelFormat(PF_FLOAT32_R)
---		if ( OgreRenderSystemIsOpenGL() ) then OgreSetShadowTexturePixelFormat=
(PF_FLOAT16_R) end
---		OgreSetShadowTextureCasterMaterial("Ogre/DepthShadowmap/Caster/Float")
---		OgreSetShadowTextureReceiverMaterial("Ogre/DepthShadowmap/BasicTemplat=
eMaterial")
-
-		OgreSetShadowTextureSelfShadow(true)		-- disable this or write in materi=
al "receive_shadows off"
-		OgreSetShadowCasterRenderBackFaces(false)
-		OgreSetShadowTextureSize(2048)
-		--OgreSetShadowTextureCount(3)
-
-		OgreShadowTechnique(gShadowTechnique)
-	elseif ((gShadowTechnique =3D=3D "texture_additive_integrated") or (gShad=
owTechnique =3D=3D "texture_modulative_integrated")) then
-		OgreSetShadowFarDistance(gSightRange*18.0)
-
---		OgreSetShadowTexturePixelFormat(PF_FLOAT32_R)
-		OgreSetShadowTextureCasterMaterial("Ogre/DepthShadowmap/Caster/Float")
-		OgreSetShadowTextureSelfShadow(true)		-- disable this or write in tex_ba=
se "receive_shadows off"
-		OgreSetShadowCasterRenderBackFaces(false)
-		OgreSetShadowTextureSize(2048)
- 		OgreShadowTechnique(gShadowTechnique)
-		--OgreSetShadowTextureCount(3)
-	end
-end
-
 --- main function, when it returns, the program ends
 function Main ()	=

 	local luaversion =3D string.sub(_VERSION, 5, 7)
@@ -341,6 +308,7 @@
 =

 	LoadBasicData()
 	=

+	-- only for 3DRenderer
 	LoadTexAtlas()
 	=

 	-- show loading screen
@@ -353,6 +321,7 @@
 	InvokeExporters()
 	=

 	------------------------------------------ obsolete, just for testing ---=
--------------------------------
+	--[[
 	if (false) then -- texture-atlas test
 		local w =3D 1024
 		local iArtMapIDList =3D {65,129,321,449,513}
@@ -376,6 +345,7 @@
 		img:Destroy()
 		os.exit(0)
 	end
+	]]--
 	-------------------------------------------------------------------------=
---------------------------------
 	=

 	gCurrentRenderer:PreInit()
@@ -447,9 +417,6 @@
 	print("######      START INGAME     #####")
 	print("##################################")
 =

-	-- Initialize Shadowsystem
-	SetupShadows()
-
 	ExecuteMapChangeIfNeeded()
 =

 	gCurrentRenderer:BlendOutLayersAbovePlayer()



