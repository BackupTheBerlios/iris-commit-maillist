From no-reply at zwischenwelt.org  Thu Apr  3 00:21:23 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 02 Apr 2008 22:21:23 -0000
Subject: [Iris-commit] [IRIS] r2014 - in /trunk:
 data/models/materials/textures.material lua/lib.static.lua
Message-ID: <20080402230009.0B6AA1C18781@zwischenwelt.org>

Author: sience
Date: Thu Apr  3 00:21:22 2008
New Revision: 2014

Log:
-GetMeshName hue coloring removed (it's done via material system)
-grass lightning on

Modified:
    trunk/data/models/materials/textures.material
    trunk/lua/lib.static.lua

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Thu Apr  3 00:21:22 2008
@@ -8190,7 +8190,7 @@
 	{ =

 		pass =

 		{
-			lighting off
+//			lighting off
 =

 			texture_unit =

 			{ =


Modified: trunk/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.static.lua (original)
+++ trunk/lua/lib.static.lua Thu Apr  3 00:21:22 2008
@@ -36,62 +36,38 @@
 -- TODO : not flexible enough, what if model should be skipped, or multipl=
e models set ? or model depending on surrounding ?
 -- TODO: remove hueing from her, not needed for fastbatch here
 gLegacyModelCache =3D {}
-function GetMeshName (iTileTypeID, iHue)
-	-- hue default value is 0
-	iHue =3D tonumber(iHue) or 0
+function GetMeshName (iTileTypeID)
 	--1st: Seasonal Translation
 	local iTranslatedTileTypeID =3D SeasonalStaticTranslation(iTileTypeID, gS=
easonSetting)
 	-- FILTER: map Mesh to other Mesh
 	iTranslatedTileTypeID =3D FilterMesh(iTranslatedTileTypeID)
 =

 	local meshname =3D nil
-
-	meshname =3D gLegacyModelCache[iTranslatedTileTypeID.."_"..iHue]
-
+	meshname =3D gLegacyModelCache[iTranslatedTileTypeID]
 	if (meshname =3D=3D nil) then
-		-- check if unhued mesh is already available
-		meshname =3D gLegacyModelCache[iTranslatedTileTypeID.."_".."0"]
+		-- check if mesh is already in Cache
+		meshname =3D gLegacyModelCache[iTranslatedTileTypeID]
 =

 		if (meshname =3D=3D nil) then
 			local modellocation =3D GetModelPath(iTranslatedTileTypeID)
+
 			if ( modellocation ~=3D nil ) then
+
 				meshname =3D GetModelName(iTranslatedTileTypeID)
 				-- load Mesh here
 				if ( OgreMeshAvailable(meshname) ) then
-					printdebug("static","Meshloader:",iTranslatedTileTypeID,iHue,meshname)
+					printdebug("static","Meshloader:",iTranslatedTileTypeID,meshname)
 				else
 					meshname =3D false
 					printdebug("static","mesh cannot be loaded -> temp. disabled (false) =
",meshname, iTranslatedTileTypeID)
 				end
+
 			else
 				meshname =3D false
 				printdebug("static","mesh not available -> temp. disabled (false) ",me=
shname, iTranslatedTileTypeID)
 			end
-			=

-			gLegacyModelCache[iTranslatedTileTypeID.."_".."0"] =3D meshname
-		else
-			printdebug("static","mesh already found in cache ",meshname, iHue)
+			gLegacyModelCache[iTranslatedTileTypeID] =3D meshname
 		end
---[[
-		-- not needed for fastbatch ( it's managed in CreateMapChunkEntity )
-		-- TODO: CLONEMESH & HUEMESH both have a very huge load and should use E=
ntities for Material Hueing !!!!!!!!!!!!!
-		-- Hue this Model | TODO: Partitial Hue is currently skipped
-		if (gHueLoader and meshname) then
-			if (TestBit(GetStaticTileTypeFlags(iTranslatedTileTypeID) or 0,kTileDat=
aFlag_Partial_Hue) ) then
-				printdebug("static","parthuedmodel=3D",iTranslatedTileTypeID)
-			elseif ( (iHue>0) and (iHue<gMaxHueValue) ) then
-				local clonemeshname=3DCloneMesh(meshname)
-				HueMesh(clonemeshname,gHueLoader,iHue)
-				printdebug("static",sprintf("mesh=3D%s hued=3D%d",meshname,iHue) )
-
-				-- cache also hued meshname
-				gLegacyModelCache[iTranslatedTileTypeID.."_"..iHue] =3D clonemeshname
-				return clonemeshname
-			end
-		end
-]]--
-	else
-		printdebug("static","mesh already found in cache ",meshname, iHue)
 	end
 	=

 	-- dump missing models as images



From no-reply at zwischenwelt.org  Thu Apr  3 19:37:56 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 03 Apr 2008 17:37:56 -0000
Subject: [Iris-commit] [IRIS] r2015 - in /trunk: data/models/materials/
 data/models/models/ data/models/models/to_004000/ data/models/textures/
 lua/ lua/filter/
Message-ID: <20080403173801.BE6EC1C1872C@zwischenwelt.org>

Author: sience
Date: Thu Apr  3 19:37:55 2008
New Revision: 2015

Log:
-palm 3d model added
-some textures converted and renamed
-caduntree generation updated

Added:
    trunk/data/models/models/to_004000/mdl_003221.mesh   (with props)
    trunk/data/models/textures/tex_armoire_2637.png   (with props)
    trunk/data/models/textures/tex_armoire_2639.png   (with props)
    trunk/data/models/textures/tex_cedars_firneedle.png   (with props)
    trunk/data/models/textures/tex_palmbark.png   (with props)
    trunk/data/models/textures/tex_palmcrown.png   (with props)
    trunk/data/models/textures/tex_palmleaf.png   (with props)
Removed:
    trunk/data/models/textures/armoire_2637.png
    trunk/data/models/textures/armoire_2639.png
    trunk/data/models/textures/firneedle_texture.dds
Modified:
    trunk/data/models/materials/textures.material
    trunk/data/models/models/textures_skipped_in_atlas.txt
    trunk/lua/filter/filter.art.lua
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.3d.renderer.lua

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Thu Apr  3 19:37:55 2008
@@ -8107,7 +8107,7 @@
 		{
 			texture_unit =

 			{
-				texture armoire_2637.png
+				texture tex_armoire_2637.png
 			}
 		}
 	}
@@ -8121,7 +8121,7 @@
 		{
 			texture_unit =

 			{
-				texture armoire_2639.png
+				texture tex_armoire_2639.png
 			}
 		}
 	}
@@ -8190,7 +8190,9 @@
 	{ =

 		pass =

 		{
-//			lighting off
+//			ambient 0.5 0.2 0.2
+//			diffuse 1 0 0
+//			specular 1 0.8 0.8 15
 =

 			texture_unit =

 			{ =

@@ -8407,8 +8409,59 @@
 =

 			texture_unit
 			{
-				texture firneedle_texture.dds
+				texture tex_cedars_firneedle.png
 			}
 		}
 	}
 }
+
+material palm01_bark : tex_base
+{
+	technique
+	{
+		pass
+		{
+			texture_unit
+			{
+				tex_address_mode wrap
+				texture tex_palmbark.png
+			}
+		}
+
+	}
+}
+
+material palm01_crown : tex_base_alpha
+{
+	technique
+	{
+		pass
+		{
+			alpha_rejection greater_equal 128
+
+			texture_unit
+			{
+				tex_address_mode wrap
+				texture tex_palmcrown.png
+			}
+		}
+
+	}
+}
+
+material palm01_leaf : tex_base_alpha
+{
+	technique
+	{
+		pass
+		{
+			alpha_rejection greater_equal 128
+
+			texture_unit
+			{
+				tex_address_mode wrap
+				texture tex_palmleaf.png
+			}
+		}
+	}
+}

Modified: trunk/data/models/models/textures_skipped_in_atlas.txt
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/textures_skipped_in_atlas.txt (original)
+++ trunk/data/models/models/textures_skipped_in_atlas.txt Thu Apr  3 19:37=
:55 2008
@@ -1,2 +1,3 @@
 tex_grass
 tex_fernleaf
+tex_cedars_firneedle

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Thu Apr  3 19:37:55 2008
@@ -139,6 +139,8 @@
 gArtFilter[3290]=3D{maptoid=3D3274}
 gArtFilter[3299]=3D{maptoid=3D3274}
 gArtFilter[3296]=3D{maptoid=3D3274}
+--gArtFilter[3297]=3D{skip=3Dtrue}	--leaves for 3296, just for testing cad=
untree
+
 -- barks new
 gArtFilter[3302]=3D{maptoid=3D3274}
 gArtFilter[3476]=3D{maptoid=3D3274}
@@ -160,6 +162,9 @@
 gArtFilter[3352]=3D{maptoid=3D3351}
 gArtFilter[3353]=3D{maptoid=3D3351}
 gArtFilter[3349]=3D{maptoid=3D3350}
+
+-- palm
+gArtFilter[3222]=3D{maptoid=3D3221}
 =

 --Rest
 -- houseparts

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Thu Apr  3 19:37:55 2008
@@ -293,8 +293,7 @@
 		staticwatertile =3D not gEnableMultiTexTerrain		--on multitexturing filt=
er static water
 	end
 =

-	-- has to be called before GetMeshName because of Art-Filters
-	--if (true) then self:GenerateCaduneTree(entity) return end
+	--Renderer3D:GenerateCaduneTree(entity)
 =

 	local meshname =3D (not gForceFallBackBillboards_Statics) and staticwater=
tile and GetMeshName(iTileTypeID, (gFastBatchStatics and 0) or entity.iHue)
 =


Modified: trunk/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.renderer.lua (original)
+++ trunk/lua/lib.3d.renderer.lua Thu Apr  3 19:37:55 2008
@@ -552,40 +552,34 @@
 -- TODO: put them into an array
 Renderer3D.gTreeParameters =3D nil
 Renderer3D.gTreeStemParameters =3D nil
-function Renderer3D:GenerateCaduneTree(entity,iTileTypeID)
+function Renderer3D:GenerateCaduneTree(entity)
 	local iTileTypeID =3D entity.iTileTypeID
 	-- just to test the cadunetree generation code
-	if ((iTileTypeID =3D=3D 3296) or (iTileTypeID =3D=3D 3297)) then
-		print(iTileTypeID)
-		if (not self.gTreeParameters) then
-			self.gTreeParameters =3D CreateCaduneTreeParameters()
-			self.gTreeStemParameters =3D CreateCaduneTreeStem(self.gTreeParameters)
-			self.gTreeStemParameters:Grow()
-		end
-
-		if (iTileTypeID =3D=3D 3296) then
-			print("generate tree")
-			entity.gfx =3D self.gTreeStemParameters:CreateGeometry()
-
-			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
-			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
-			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
-			entity.gfx:SetScale(0.4,0.4,0.5)
-			entity.gfx:SetNormaliseNormals(true)
-			print("export tree bark")
-			--ExportMesh(entity.gfx ,"tree_"..iTileTypeID..".mesh")
-			--entity.gfx:Destroy()
-			--entity.gfx =3D nil
-		end
-		if (iTileTypeID =3D=3D 3297) then
-			print("generate leaves")
-			entity.gfx =3D self.gTreeStemParameters:CreateLeaves()
-	=

-			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.y=
loc+0.5,entity.zloc*0.1)
-			entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
-			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
-			entity.gfx:SetScale(0.4,0.4,0.5)
-			entity.gfx:SetNormaliseNormals(true)
-		end
-	end
-end
+	if (not self.gTreeParameters) then
+		self.gTreeParameters =3D CreateCaduneTreeParameters()
+		self.gTreeStemParameters =3D CreateCaduneTreeStem(self.gTreeParameters)
+		self.gTreeStemParameters:Grow()
+	end
+	if (iTileTypeID =3D=3D 3296) then
+		print("generate tree")
+		entity.gfx =3D self.gTreeStemParameters:CreateGeometry()
+		entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.yl=
oc+0.5,entity.zloc*0.1)
+		entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
+		entity.gfx:SetPosition(entity.x,entity.y,entity.z)
+		entity.gfx:SetScale(0.4,0.4,0.5)
+		entity.gfx:SetNormaliseNormals(true)
+		--print("export tree bark")
+		--ExportMesh(entity.gfx ,"tree_"..iTileTypeID..".mesh")
+		--entity.gfx:Destroy()
+		--entity.gfx =3D nil
+	end
+	if (iTileTypeID =3D=3D 3297) then
+		print("generate leaves")
+		entity.gfx =3D self.gTreeStemParameters:CreateLeaves()
+		entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+1,entity.yl=
oc+0.5,entity.zloc*0.1)
+		entity.gfx:SetOrientation( QuaternionFromString("x:90,y:0,z:0") )
+		entity.gfx:SetPosition(entity.x,entity.y,entity.z)
+		entity.gfx:SetScale(0.4,0.4,0.5)
+		entity.gfx:SetNormaliseNormals(true)
+	end
+end



From no-reply at zwischenwelt.org  Fri Apr  4 02:32:00 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 04 Apr 2008 00:32:00 -0000
Subject: [Iris-commit] [IRIS] r2016 - in /trunk/data/models/atlas:
	convertalltodds.sh todds.sh
Message-ID: <20080404010009.DFA661C181B7@zwischenwelt.org>

Author: hagish
Date: Fri Apr  4 02:31:59 2008
New Revision: 2016

Log:
dds converter

Added:
    trunk/data/models/atlas/convertalltodds.sh   (with props)
    trunk/data/models/atlas/todds.sh   (with props)



From no-reply at zwischenwelt.org  Fri Apr  4 13:02:12 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 04 Apr 2008 11:02:12 -0000
Subject: [Iris-commit] [IRIS] r2017 - in /trunk/data/models/atlas:
	convertalltodds.sh todds.sh
Message-ID: <20080404110212.D523D1C1875B@zwischenwelt.org>

Author: hagish
Date: Fri Apr  4 13:02:10 2008
New Revision: 2017

Log:
to dds script update

Modified:
    trunk/data/models/atlas/convertalltodds.sh
    trunk/data/models/atlas/todds.sh

Modified: trunk/data/models/atlas/convertalltodds.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/convertalltodds.sh (original)
+++ trunk/data/models/atlas/convertalltodds.sh Fri Apr  4 13:02:10 2008
@@ -1,10 +1,41 @@
 #!/bin/bash
+
+strpos() {
+    str=3D${1/$2*/}
+    return `expr length $str`
+}
+#strpos $string $string2
+#echo $?
 =

 for X in *.png =

 do
     SRC=3D$X
     DST=3D`echo "$X" | sed -e 's/png/dds/g'`
-    rm "$DST"
-    ./todds.sh "$SRC" "$DST"
+    strpos "$SRC" "alpha"
+	POS=3D$?
+	LEN=3D${#SRC}
+	rm "$DST"
+	=

+	# Compression format (0 =3D None, 1 =3D BC1/DXT1, 2 =3D BC2/DXT3, 3 =3D B=
C3/DXT5, 4 =3D BC3n/DXT5n, 5 =3D BC4/ATI1N, 6 =3D BC5/ATI2N, 7 =3D Alpha Ex=
ponent (DXT5), 8 =3D YCoCg (DXT5), 9 =3D YCoCg scaled (DXT5))
+	#COMPRESSION=3D$3
+	# How to save the image (0 =3D selected layer, 1 =3D cube map, 2 =3D volu=
me map
+	#SAVETYPE=3D$4
+	# Custom pixel format (0 =3D default, 1 =3D R5G6B5, 2 =3D RGBA4, 3 =3D RG=
B5A1, 4 =3D RGB10A2)
+	#FORMAT=3D$5
+	# Color selection algorithm used in DXT compression (0 =3D default, 1 =3D=
 distance, 2 =3D luminance, 3 =3D inset bounding box)
+	#COLORTYPE=3D$6
+	# Work on dithered color blocks when doing color selection for DXT compre=
ssion
+	#DITHER=3D$7
+
+	#./todds.sh src dst COMPRESSION SAVETYPE FORMAT COLORTYPE DITHER
+	=

+	if [ $POS -eq $LEN ]
+	then
+		echo "ALPHA"
+		./todds.sh "$SRC" "$DST" 3 0 0 0 0
+	else
+		echo "NOALPHA"
+		./todds.sh "$SRC" "$DST" 1 0 0 0 0
+	fi
 done
 =


Modified: trunk/data/models/atlas/todds.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/todds.sh (original)
+++ trunk/data/models/atlas/todds.sh Fri Apr  4 13:02:10 2008
@@ -3,5 +3,15 @@
 SRC=3D$1
 DST=3D$2
 =

-gimp -i -b "(file-dds-save 1 (car (gimp-file-load 1 \"$SRC\" \"$SRC\")) (c=
ar (gimp-file-load 1 \"$SRC\" \"$SRC\")) \"$DST\" \"$DST\" 1 1 0 0 -1) (gim=
p-quit 0)"
+# Compression format (0 =3D None, 1 =3D BC1/DXT1, 2 =3D BC2/DXT3, 3 =3D BC=
3/DXT5, 4 =3D BC3n/DXT5n, 5 =3D BC4/ATI1N, 6 =3D BC5/ATI2N, 7 =3D Alpha Exp=
onent (DXT5), 8 =3D YCoCg (DXT5), 9 =3D YCoCg scaled (DXT5))
+COMPRESSION=3D$3
+# How to save the image (0 =3D selected layer, 1 =3D cube map, 2 =3D volum=
e map
+SAVETYPE=3D$4
+# Custom pixel format (0 =3D default, 1 =3D R5G6B5, 2 =3D RGBA4, 3 =3D RGB=
5A1, 4 =3D RGB10A2)
+FORMAT=3D$5
+# Color selection algorithm used in DXT compression (0 =3D default, 1 =3D =
distance, 2 =3D luminance, 3 =3D inset bounding box)
+COLORTYPE=3D$6
+# Work on dithered color blocks when doing color selection for DXT compres=
sion
+DITHER=3D$7
 =

+gimp -i -b "(file-dds-save 1 (car (gimp-file-load 1 \"$SRC\" \"$SRC\")) (c=
ar (gimp-file-load 1 \"$SRC\" \"$SRC\")) \"$DST\" \"$DST\" $COMPRESSION 1 $=
SAVETYPE $FORMAT -1 $COLORTYPE $DITHER) (gimp-quit 0)"



From no-reply at zwischenwelt.org  Fri Apr  4 13:24:45 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 04 Apr 2008 11:24:45 -0000
Subject: [Iris-commit] [IRIS] r2018 - in /trunk/data/models: atlas/ models/
Message-ID: <20080404112448.241A21C18751@zwischenwelt.org>

Author: hagish
Date: Fri Apr  4 13:24:43 2008
New Revision: 2018

Log:
atlas update

Added:
    trunk/data/models/atlas/tex_atlas_alpha_low0.dds   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_med0.dds   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_med1.dds   (with props)
    trunk/data/models/atlas/tex_atlas_alpha_ultralow0.dds   (with props)
    trunk/data/models/atlas/tex_atlas_low0.dds   (with props)
    trunk/data/models/atlas/tex_atlas_low1.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med0.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med1.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med2.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med3.dds   (with props)
    trunk/data/models/atlas/tex_atlas_med4.dds   (with props)
    trunk/data/models/atlas/tex_atlas_ultralow0.dds   (with props)
Modified:
    trunk/data/models/atlas/convertalltodds.sh
    trunk/data/models/atlas/tex_atlas_alpha_low.lua
    trunk/data/models/atlas/tex_atlas_alpha_low0.png
    trunk/data/models/atlas/tex_atlas_alpha_med.lua
    trunk/data/models/atlas/tex_atlas_alpha_med.material
    trunk/data/models/atlas/tex_atlas_alpha_med0.png
    trunk/data/models/atlas/tex_atlas_alpha_med1.png
    trunk/data/models/atlas/tex_atlas_alpha_ultralow.lua
    trunk/data/models/atlas/tex_atlas_alpha_ultralow0.png
    trunk/data/models/atlas/tex_atlas_low.lua
    trunk/data/models/atlas/tex_atlas_low1.png
    trunk/data/models/atlas/tex_atlas_med.lua
    trunk/data/models/atlas/tex_atlas_med.material
    trunk/data/models/atlas/tex_atlas_med2.png
    trunk/data/models/atlas/tex_atlas_med3.png
    trunk/data/models/atlas/tex_atlas_med4.png
    trunk/data/models/atlas/tex_atlas_ultralow.lua
    trunk/data/models/atlas/tex_atlas_ultralow0.png
    trunk/data/models/models/generate_all.sh
    trunk/data/models/models/textures_skipped_in_atlas.txt

Modified: trunk/data/models/atlas/convertalltodds.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/convertalltodds.sh (original)
+++ trunk/data/models/atlas/convertalltodds.sh Fri Apr  4 13:24:43 2008
@@ -7,6 +7,8 @@
 #strpos $string $string2
 #echo $?
 =

+rm *.dds
+
 for X in *.png =

 do
     SRC=3D$X
@@ -14,7 +16,6 @@
     strpos "$SRC" "alpha"
 	POS=3D$?
 	LEN=3D${#SRC}
-	rm "$DST"
 	=

 	# Compression format (0 =3D None, 1 =3D BC1/DXT1, 2 =3D BC2/DXT3, 3 =3D B=
C3/DXT5, 4 =3D BC3n/DXT5n, 5 =3D BC4/ATI1N, 6 =3D BC5/ATI2N, 7 =3D Alpha Ex=
ponent (DXT5), 8 =3D YCoCg (DXT5), 9 =3D YCoCg scaled (DXT5))
 	#COMPRESSION=3D$3

Modified: trunk/data/models/atlas/tex_atlas_alpha_low.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_alpha_low.lua (original)
+++ trunk/data/models/atlas/tex_atlas_alpha_low.lua Fri Apr  4 13:24:43 2008
@@ -88,57 +88,59 @@
 TexAtlas_RegisterMatTransform('tex_283', 'tex_atlas_alpha_low0', 0.8320312=
5,0.28515625,0.86328125,0.34765625)
 TexAtlas_RegisterMatTransform('tex_65', 'tex_atlas_alpha_low0', 0.87109375=
,0.28515625,0.90234375,0.34765625)
 TexAtlas_RegisterMatTransform('tex_5', 'tex_atlas_alpha_low0', 0.91015625,=
0.28515625,0.94140625,0.34765625)
-TexAtlas_RegisterMatTransform('tex_454', 'tex_atlas_alpha_low0', 0.0039062=
5,0.35546875,0.06640625,0.41796875)
-TexAtlas_RegisterMatTransform('tex_292', 'tex_atlas_alpha_low0', 0.0742187=
5,0.35546875,0.10546875,0.41796875)
-TexAtlas_RegisterMatTransform('tex_497', 'tex_atlas_alpha_low0', 0.1132812=
5,0.35546875,0.14453125,0.41796875)
-TexAtlas_RegisterMatTransform('tex_501', 'tex_atlas_alpha_low0', 0.1523437=
5,0.35546875,0.18359375,0.41796875)
-TexAtlas_RegisterMatTransform('tex_544', 'tex_atlas_alpha_low0', 0.1914062=
5,0.35546875,0.25390625,0.41796875)
-TexAtlas_RegisterMatTransform('tex_382', 'tex_atlas_alpha_low0', 0.2617187=
5,0.35546875,0.32421875,0.41796875)
-TexAtlas_RegisterMatTransform('tex_428', 'tex_atlas_alpha_low0', 0.3320312=
5,0.35546875,0.36328125,0.41796875)
-TexAtlas_RegisterMatTransform('tex_83', 'tex_atlas_alpha_low0', 0.37109375=
,0.35546875,0.40234375,0.41796875)
-TexAtlas_RegisterMatTransform('tex_116', 'tex_atlas_alpha_low0', 0.4101562=
5,0.35546875,0.44140625,0.41796875)
-TexAtlas_RegisterMatTransform('tex_553', 'tex_atlas_alpha_low0', 0.4492187=
5,0.35546875,0.51171875,0.41796875)
-TexAtlas_RegisterMatTransform('tex_437', 'tex_atlas_alpha_low0', 0.5195312=
5,0.35546875,0.58203125,0.41796875)
-TexAtlas_RegisterMatTransform('tex_356', 'tex_atlas_alpha_low0', 0.5898437=
5,0.35546875,0.65234375,0.41796875)
-TexAtlas_RegisterMatTransform('tex_527', 'tex_atlas_alpha_low0', 0.6601562=
5,0.35546875,0.72265625,0.41796875)
-TexAtlas_RegisterMatTransform('tex_446', 'tex_atlas_alpha_low0', 0.7304687=
5,0.35546875,0.79296875,0.41796875)
-TexAtlas_RegisterMatTransform('tex_365', 'tex_atlas_alpha_low0', 0.8007812=
5,0.35546875,0.86328125,0.41796875)
-TexAtlas_RegisterMatTransform('tex_490', 'tex_atlas_alpha_low0', 0.8710937=
5,0.35546875,0.88671875,0.41796875)
-TexAtlas_RegisterMatTransform('tex_455', 'tex_atlas_alpha_low0', 0.8945312=
5,0.35546875,0.95703125,0.41796875)
-TexAtlas_RegisterMatTransform('tex_293', 'tex_atlas_alpha_low0', 0.9648437=
5,0.35546875,0.99609375,0.41796875)
-TexAtlas_RegisterMatTransform('tex_498', 'tex_atlas_alpha_low0', 0.0039062=
5,0.42578125,0.03515625,0.48828125)
-TexAtlas_RegisterMatTransform('tex_75', 'tex_atlas_alpha_low0', 0.04296875=
,0.42578125,0.07421875,0.48828125)
-TexAtlas_RegisterMatTransform('tex_502', 'tex_atlas_alpha_low0', 0.0820312=
5,0.42578125,0.11328125,0.48828125)
-TexAtlas_RegisterMatTransform('tex_383', 'tex_atlas_alpha_low0', 0.1210937=
5,0.42578125,0.18359375,0.48828125)
-TexAtlas_RegisterMatTransform('tex_429', 'tex_atlas_alpha_low0', 0.1914062=
5,0.42578125,0.22265625,0.48828125)
-TexAtlas_RegisterMatTransform('tex_84', 'tex_atlas_alpha_low0', 0.23046875=
,0.42578125,0.26171875,0.48828125)
-TexAtlas_RegisterMatTransform('tex_49', 'tex_atlas_alpha_low0', 0.26953125=
,0.42578125,0.30078125,0.48828125)
-TexAtlas_RegisterMatTransform('tex_430', 'tex_atlas_alpha_low0', 0.3085937=
5,0.42578125,0.33984375,0.48828125)
-TexAtlas_RegisterMatTransform('tex_117', 'tex_atlas_alpha_low0', 0.3476562=
5,0.42578125,0.41015625,0.48828125)
-TexAtlas_RegisterMatTransform('tex_554', 'tex_atlas_alpha_low0', 0.4179687=
5,0.42578125,0.48046875,0.48828125)
-TexAtlas_RegisterMatTransform('tex_438', 'tex_atlas_alpha_low0', 0.4882812=
5,0.42578125,0.55078125,0.48828125)
-TexAtlas_RegisterMatTransform('tex_357', 'tex_atlas_alpha_low0', 0.5585937=
5,0.42578125,0.62109375,0.48828125)
-TexAtlas_RegisterMatTransform('tex_93', 'tex_atlas_alpha_low0', 0.62890625=
,0.42578125,0.66015625,0.48828125)
-TexAtlas_RegisterMatTransform('tex_520', 'tex_atlas_alpha_low0', 0.6679687=
5,0.42578125,0.73046875,0.48828125)
-TexAtlas_RegisterMatTransform('tex_528', 'tex_atlas_alpha_low0', 0.7382812=
5,0.42578125,0.80078125,0.48828125)
-TexAtlas_RegisterMatTransform('tex_447', 'tex_atlas_alpha_low0', 0.8085937=
5,0.42578125,0.87109375,0.48828125)
-TexAtlas_RegisterMatTransform('tex_285', 'tex_atlas_alpha_low0', 0.8789062=
5,0.42578125,0.94140625,0.48828125)
-TexAtlas_RegisterMatTransform('tex_67', 'tex_atlas_alpha_low0', 0.94921875=
,0.42578125,0.98046875,0.48828125)
-TexAtlas_RegisterMatTransform('tex_294', 'tex_atlas_alpha_low0', 0.0039062=
5,0.49609375,0.03515625,0.55859375)
-TexAtlas_RegisterMatTransform('tex_499', 'tex_atlas_alpha_low0', 0.0429687=
5,0.49609375,0.07421875,0.55859375)
-TexAtlas_RegisterMatTransform('tex_76', 'tex_atlas_alpha_low0', 0.08203125=
,0.49609375,0.11328125,0.55859375)
-TexAtlas_RegisterMatTransform('tex_503', 'tex_atlas_alpha_low0', 0.1210937=
5,0.49609375,0.15234375,0.55859375)
-TexAtlas_RegisterMatTransform('tex_384', 'tex_atlas_alpha_low0', 0.1601562=
5,0.49609375,0.22265625,0.55859375)
-TexAtlas_RegisterMatTransform('tex_85', 'tex_atlas_alpha_low0', 0.23046875=
,0.49609375,0.26171875,0.55859375)
-TexAtlas_RegisterMatTransform('tex_431', 'tex_atlas_alpha_low0', 0.2695312=
5,0.49609375,0.30078125,0.55859375)
-TexAtlas_RegisterMatTransform('tex_439', 'tex_atlas_alpha_low0', 0.3085937=
5,0.49609375,0.37109375,0.55859375)
-TexAtlas_RegisterMatTransform('tex_358', 'tex_atlas_alpha_low0', 0.3789062=
5,0.49609375,0.44140625,0.55859375)
-TexAtlas_RegisterMatTransform('tex_94', 'tex_atlas_alpha_low0', 0.44921875=
,0.49609375,0.48046875,0.55859375)
-TexAtlas_RegisterMatTransform('tex_59', 'tex_atlas_alpha_low0', 0.48828125=
,0.49609375,0.51953125,0.55859375)
-TexAtlas_RegisterMatTransform('tex_521', 'tex_atlas_alpha_low0', 0.5273437=
5,0.49609375,0.58984375,0.55859375)
-TexAtlas_RegisterMatTransform('tex_2481', 'tex_atlas_alpha_low0', 0.597656=
25,0.49609375,0.66015625,0.55859375)
-TexAtlas_RegisterMatTransform('tex_flowers', 'tex_atlas_alpha_low0', 0.667=
96875,0.49609375,0.73046875,0.55859375)
-TexAtlas_RegisterMatTransform('tex_gravestone_big', 'tex_atlas_alpha_low0'=
, 0.73828125,0.49609375,0.80078125,0.55859375)
+TexAtlas_RegisterMatTransform('tex_palmleaf', 'tex_atlas_alpha_low0', 0.00=
390625,0.35546875,0.06640625,0.41796875)
+TexAtlas_RegisterMatTransform('tex_454', 'tex_atlas_alpha_low0', 0.0742187=
5,0.35546875,0.13671875,0.41796875)
+TexAtlas_RegisterMatTransform('tex_292', 'tex_atlas_alpha_low0', 0.1445312=
5,0.35546875,0.17578125,0.41796875)
+TexAtlas_RegisterMatTransform('tex_497', 'tex_atlas_alpha_low0', 0.1835937=
5,0.35546875,0.21484375,0.41796875)
+TexAtlas_RegisterMatTransform('tex_501', 'tex_atlas_alpha_low0', 0.2226562=
5,0.35546875,0.25390625,0.41796875)
+TexAtlas_RegisterMatTransform('tex_544', 'tex_atlas_alpha_low0', 0.2617187=
5,0.35546875,0.32421875,0.41796875)
+TexAtlas_RegisterMatTransform('tex_382', 'tex_atlas_alpha_low0', 0.3320312=
5,0.35546875,0.39453125,0.41796875)
+TexAtlas_RegisterMatTransform('tex_428', 'tex_atlas_alpha_low0', 0.4023437=
5,0.35546875,0.43359375,0.41796875)
+TexAtlas_RegisterMatTransform('tex_83', 'tex_atlas_alpha_low0', 0.44140625=
,0.35546875,0.47265625,0.41796875)
+TexAtlas_RegisterMatTransform('tex_116', 'tex_atlas_alpha_low0', 0.4804687=
5,0.35546875,0.51171875,0.41796875)
+TexAtlas_RegisterMatTransform('tex_553', 'tex_atlas_alpha_low0', 0.5195312=
5,0.35546875,0.58203125,0.41796875)
+TexAtlas_RegisterMatTransform('tex_437', 'tex_atlas_alpha_low0', 0.5898437=
5,0.35546875,0.65234375,0.41796875)
+TexAtlas_RegisterMatTransform('tex_356', 'tex_atlas_alpha_low0', 0.6601562=
5,0.35546875,0.72265625,0.41796875)
+TexAtlas_RegisterMatTransform('tex_527', 'tex_atlas_alpha_low0', 0.7304687=
5,0.35546875,0.79296875,0.41796875)
+TexAtlas_RegisterMatTransform('tex_446', 'tex_atlas_alpha_low0', 0.8007812=
5,0.35546875,0.86328125,0.41796875)
+TexAtlas_RegisterMatTransform('tex_365', 'tex_atlas_alpha_low0', 0.8710937=
5,0.35546875,0.93359375,0.41796875)
+TexAtlas_RegisterMatTransform('tex_490', 'tex_atlas_alpha_low0', 0.9414062=
5,0.35546875,0.95703125,0.41796875)
+TexAtlas_RegisterMatTransform('tex_455', 'tex_atlas_alpha_low0', 0.0039062=
5,0.42578125,0.06640625,0.48828125)
+TexAtlas_RegisterMatTransform('tex_293', 'tex_atlas_alpha_low0', 0.0742187=
5,0.42578125,0.10546875,0.48828125)
+TexAtlas_RegisterMatTransform('tex_498', 'tex_atlas_alpha_low0', 0.1132812=
5,0.42578125,0.14453125,0.48828125)
+TexAtlas_RegisterMatTransform('tex_75', 'tex_atlas_alpha_low0', 0.15234375=
,0.42578125,0.18359375,0.48828125)
+TexAtlas_RegisterMatTransform('tex_502', 'tex_atlas_alpha_low0', 0.1914062=
5,0.42578125,0.22265625,0.48828125)
+TexAtlas_RegisterMatTransform('tex_383', 'tex_atlas_alpha_low0', 0.2304687=
5,0.42578125,0.29296875,0.48828125)
+TexAtlas_RegisterMatTransform('tex_429', 'tex_atlas_alpha_low0', 0.3007812=
5,0.42578125,0.33203125,0.48828125)
+TexAtlas_RegisterMatTransform('tex_84', 'tex_atlas_alpha_low0', 0.33984375=
,0.42578125,0.37109375,0.48828125)
+TexAtlas_RegisterMatTransform('tex_49', 'tex_atlas_alpha_low0', 0.37890625=
,0.42578125,0.41015625,0.48828125)
+TexAtlas_RegisterMatTransform('tex_430', 'tex_atlas_alpha_low0', 0.4179687=
5,0.42578125,0.44921875,0.48828125)
+TexAtlas_RegisterMatTransform('tex_117', 'tex_atlas_alpha_low0', 0.4570312=
5,0.42578125,0.51953125,0.48828125)
+TexAtlas_RegisterMatTransform('tex_554', 'tex_atlas_alpha_low0', 0.5273437=
5,0.42578125,0.58984375,0.48828125)
+TexAtlas_RegisterMatTransform('tex_438', 'tex_atlas_alpha_low0', 0.5976562=
5,0.42578125,0.66015625,0.48828125)
+TexAtlas_RegisterMatTransform('tex_357', 'tex_atlas_alpha_low0', 0.6679687=
5,0.42578125,0.73046875,0.48828125)
+TexAtlas_RegisterMatTransform('tex_93', 'tex_atlas_alpha_low0', 0.73828125=
,0.42578125,0.76953125,0.48828125)
+TexAtlas_RegisterMatTransform('tex_520', 'tex_atlas_alpha_low0', 0.7773437=
5,0.42578125,0.83984375,0.48828125)
+TexAtlas_RegisterMatTransform('tex_528', 'tex_atlas_alpha_low0', 0.8476562=
5,0.42578125,0.91015625,0.48828125)
+TexAtlas_RegisterMatTransform('tex_447', 'tex_atlas_alpha_low0', 0.9179687=
5,0.42578125,0.98046875,0.48828125)
+TexAtlas_RegisterMatTransform('tex_285', 'tex_atlas_alpha_low0', 0.0039062=
5,0.49609375,0.06640625,0.55859375)
+TexAtlas_RegisterMatTransform('tex_67', 'tex_atlas_alpha_low0', 0.07421875=
,0.49609375,0.10546875,0.55859375)
+TexAtlas_RegisterMatTransform('tex_294', 'tex_atlas_alpha_low0', 0.1132812=
5,0.49609375,0.14453125,0.55859375)
+TexAtlas_RegisterMatTransform('tex_499', 'tex_atlas_alpha_low0', 0.1523437=
5,0.49609375,0.18359375,0.55859375)
+TexAtlas_RegisterMatTransform('tex_76', 'tex_atlas_alpha_low0', 0.19140625=
,0.49609375,0.22265625,0.55859375)
+TexAtlas_RegisterMatTransform('tex_503', 'tex_atlas_alpha_low0', 0.2304687=
5,0.49609375,0.26171875,0.55859375)
+TexAtlas_RegisterMatTransform('tex_384', 'tex_atlas_alpha_low0', 0.2695312=
5,0.49609375,0.33203125,0.55859375)
+TexAtlas_RegisterMatTransform('tex_85', 'tex_atlas_alpha_low0', 0.33984375=
,0.49609375,0.37109375,0.55859375)
+TexAtlas_RegisterMatTransform('tex_431', 'tex_atlas_alpha_low0', 0.3789062=
5,0.49609375,0.41015625,0.55859375)
+TexAtlas_RegisterMatTransform('tex_439', 'tex_atlas_alpha_low0', 0.4179687=
5,0.49609375,0.48046875,0.55859375)
+TexAtlas_RegisterMatTransform('tex_358', 'tex_atlas_alpha_low0', 0.4882812=
5,0.49609375,0.55078125,0.55859375)
+TexAtlas_RegisterMatTransform('tex_94', 'tex_atlas_alpha_low0', 0.55859375=
,0.49609375,0.58984375,0.55859375)
+TexAtlas_RegisterMatTransform('tex_59', 'tex_atlas_alpha_low0', 0.59765625=
,0.49609375,0.62890625,0.55859375)
+TexAtlas_RegisterMatTransform('tex_521', 'tex_atlas_alpha_low0', 0.6367187=
5,0.49609375,0.69921875,0.55859375)
+TexAtlas_RegisterMatTransform('tex_2481', 'tex_atlas_alpha_low0', 0.707031=
25,0.49609375,0.76953125,0.55859375)
+TexAtlas_RegisterMatTransform('tex_flowers', 'tex_atlas_alpha_low0', 0.777=
34375,0.49609375,0.83984375,0.55859375)
+TexAtlas_RegisterMatTransform('tex_gravestone_big', 'tex_atlas_alpha_low0'=
, 0.84765625,0.49609375,0.91015625,0.55859375)
+TexAtlas_RegisterMatTransform('tex_palmcrown', 'tex_atlas_alpha_low0', 0.9=
1796875,0.49609375,0.98046875,0.55859375)
 TexAtlas_RegisterMatTransform('tex_163', 'tex_atlas_alpha_low0', 0.0039062=
5,0.56640625,0.06640625,0.59765625)
 TexAtlas_RegisterMatTransform('tex_172', 'tex_atlas_alpha_low0', 0.0742187=
5,0.56640625,0.13671875,0.59765625)
 TexAtlas_RegisterMatTransform('tex_155', 'tex_atlas_alpha_low0', 0.1445312=
5,0.56640625,0.20703125,0.59765625)

Modified: trunk/data/models/atlas/tex_atlas_alpha_low0.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/atlas/tex_atlas_alpha_med.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_alpha_med.lua (original)
+++ trunk/data/models/atlas/tex_atlas_alpha_med.lua Fri Apr  4 13:24:43 2008
@@ -67,48 +67,50 @@
 TexAtlas_RegisterMatTransform('tex_283', 'tex_atlas_alpha_med0', 0.0683593=
75,0.775390625,0.130859375,0.900390625)
 TexAtlas_RegisterMatTransform('tex_65', 'tex_atlas_alpha_med0', 0.13476562=
5,0.775390625,0.197265625,0.900390625)
 TexAtlas_RegisterMatTransform('tex_5', 'tex_atlas_alpha_med0', 0.201171875=
,0.775390625,0.263671875,0.900390625)
-TexAtlas_RegisterMatTransform('tex_454', 'tex_atlas_alpha_med0', 0.2675781=
25,0.775390625,0.392578125,0.900390625)
-TexAtlas_RegisterMatTransform('tex_292', 'tex_atlas_alpha_med0', 0.3964843=
75,0.775390625,0.458984375,0.900390625)
-TexAtlas_RegisterMatTransform('tex_497', 'tex_atlas_alpha_med0', 0.4628906=
25,0.775390625,0.525390625,0.900390625)
-TexAtlas_RegisterMatTransform('tex_501', 'tex_atlas_alpha_med0', 0.5292968=
75,0.775390625,0.591796875,0.900390625)
-TexAtlas_RegisterMatTransform('tex_382', 'tex_atlas_alpha_med0', 0.5957031=
25,0.775390625,0.720703125,0.900390625)
-TexAtlas_RegisterMatTransform('tex_428', 'tex_atlas_alpha_med0', 0.7246093=
75,0.775390625,0.787109375,0.900390625)
-TexAtlas_RegisterMatTransform('tex_83', 'tex_atlas_alpha_med0', 0.79101562=
5,0.775390625,0.853515625,0.900390625)
-TexAtlas_RegisterMatTransform('tex_116', 'tex_atlas_alpha_med0', 0.8574218=
75,0.775390625,0.919921875,0.900390625)
-TexAtlas_RegisterMatTransform('tex_553', 'tex_atlas_alpha_med1', 0.0019531=
25,0.005859375,0.126953125,0.130859375)
-TexAtlas_RegisterMatTransform('tex_437', 'tex_atlas_alpha_med1', 0.1308593=
75,0.005859375,0.255859375,0.130859375)
-TexAtlas_RegisterMatTransform('tex_527', 'tex_atlas_alpha_med1', 0.2597656=
25,0.005859375,0.384765625,0.130859375)
-TexAtlas_RegisterMatTransform('tex_455', 'tex_atlas_alpha_med1', 0.3886718=
75,0.005859375,0.513671875,0.130859375)
-TexAtlas_RegisterMatTransform('tex_293', 'tex_atlas_alpha_med1', 0.5175781=
25,0.005859375,0.580078125,0.130859375)
-TexAtlas_RegisterMatTransform('tex_498', 'tex_atlas_alpha_med1', 0.5839843=
75,0.005859375,0.646484375,0.130859375)
-TexAtlas_RegisterMatTransform('tex_75', 'tex_atlas_alpha_med1', 0.65039062=
5,0.005859375,0.712890625,0.130859375)
-TexAtlas_RegisterMatTransform('tex_383', 'tex_atlas_alpha_med1', 0.7167968=
75,0.005859375,0.841796875,0.130859375)
-TexAtlas_RegisterMatTransform('tex_429', 'tex_atlas_alpha_med1', 0.8457031=
25,0.005859375,0.908203125,0.130859375)
-TexAtlas_RegisterMatTransform('tex_84', 'tex_atlas_alpha_med1', 0.91210937=
5,0.005859375,0.974609375,0.130859375)
-TexAtlas_RegisterMatTransform('tex_49', 'tex_atlas_alpha_med1', 0.00195312=
5,0.134765625,0.064453125,0.259765625)
-TexAtlas_RegisterMatTransform('tex_430', 'tex_atlas_alpha_med1', 0.0683593=
75,0.134765625,0.130859375,0.259765625)
-TexAtlas_RegisterMatTransform('tex_117', 'tex_atlas_alpha_med1', 0.1347656=
25,0.134765625,0.259765625,0.259765625)
-TexAtlas_RegisterMatTransform('tex_554', 'tex_atlas_alpha_med1', 0.2636718=
75,0.134765625,0.388671875,0.259765625)
-TexAtlas_RegisterMatTransform('tex_438', 'tex_atlas_alpha_med1', 0.3925781=
25,0.134765625,0.517578125,0.259765625)
-TexAtlas_RegisterMatTransform('tex_93', 'tex_atlas_alpha_med1', 0.52148437=
5,0.134765625,0.583984375,0.259765625)
-TexAtlas_RegisterMatTransform('tex_520', 'tex_atlas_alpha_med1', 0.5878906=
25,0.134765625,0.712890625,0.259765625)
-TexAtlas_RegisterMatTransform('tex_528', 'tex_atlas_alpha_med1', 0.7167968=
75,0.134765625,0.841796875,0.259765625)
-TexAtlas_RegisterMatTransform('tex_447', 'tex_atlas_alpha_med1', 0.8457031=
25,0.134765625,0.970703125,0.259765625)
-TexAtlas_RegisterMatTransform('tex_285', 'tex_atlas_alpha_med1', 0.0019531=
25,0.263671875,0.126953125,0.388671875)
-TexAtlas_RegisterMatTransform('tex_67', 'tex_atlas_alpha_med1', 0.13085937=
5,0.263671875,0.193359375,0.388671875)
-TexAtlas_RegisterMatTransform('tex_294', 'tex_atlas_alpha_med1', 0.1972656=
25,0.263671875,0.259765625,0.388671875)
-TexAtlas_RegisterMatTransform('tex_499', 'tex_atlas_alpha_med1', 0.2636718=
75,0.263671875,0.326171875,0.388671875)
-TexAtlas_RegisterMatTransform('tex_76', 'tex_atlas_alpha_med1', 0.33007812=
5,0.263671875,0.392578125,0.388671875)
-TexAtlas_RegisterMatTransform('tex_384', 'tex_atlas_alpha_med1', 0.3964843=
75,0.263671875,0.521484375,0.388671875)
-TexAtlas_RegisterMatTransform('tex_85', 'tex_atlas_alpha_med1', 0.52539062=
5,0.263671875,0.587890625,0.388671875)
-TexAtlas_RegisterMatTransform('tex_431', 'tex_atlas_alpha_med1', 0.5917968=
75,0.263671875,0.654296875,0.388671875)
-TexAtlas_RegisterMatTransform('tex_439', 'tex_atlas_alpha_med1', 0.6582031=
25,0.263671875,0.783203125,0.388671875)
-TexAtlas_RegisterMatTransform('tex_94', 'tex_atlas_alpha_med1', 0.78710937=
5,0.263671875,0.849609375,0.388671875)
-TexAtlas_RegisterMatTransform('tex_59', 'tex_atlas_alpha_med1', 0.85351562=
5,0.263671875,0.916015625,0.388671875)
-TexAtlas_RegisterMatTransform('tex_521', 'tex_atlas_alpha_med1', 0.0019531=
25,0.392578125,0.126953125,0.517578125)
-TexAtlas_RegisterMatTransform('tex_2481', 'tex_atlas_alpha_med1', 0.130859=
375,0.392578125,0.255859375,0.517578125)
-TexAtlas_RegisterMatTransform('tex_flowers', 'tex_atlas_alpha_med1', 0.259=
765625,0.392578125,0.384765625,0.517578125)
-TexAtlas_RegisterMatTransform('tex_gravestone_big', 'tex_atlas_alpha_med1'=
, 0.388671875,0.392578125,0.513671875,0.517578125)
+TexAtlas_RegisterMatTransform('tex_palmleaf', 'tex_atlas_alpha_med0', 0.26=
7578125,0.775390625,0.392578125,0.900390625)
+TexAtlas_RegisterMatTransform('tex_454', 'tex_atlas_alpha_med0', 0.3964843=
75,0.775390625,0.521484375,0.900390625)
+TexAtlas_RegisterMatTransform('tex_292', 'tex_atlas_alpha_med0', 0.5253906=
25,0.775390625,0.587890625,0.900390625)
+TexAtlas_RegisterMatTransform('tex_497', 'tex_atlas_alpha_med0', 0.5917968=
75,0.775390625,0.654296875,0.900390625)
+TexAtlas_RegisterMatTransform('tex_501', 'tex_atlas_alpha_med0', 0.6582031=
25,0.775390625,0.720703125,0.900390625)
+TexAtlas_RegisterMatTransform('tex_382', 'tex_atlas_alpha_med0', 0.7246093=
75,0.775390625,0.849609375,0.900390625)
+TexAtlas_RegisterMatTransform('tex_428', 'tex_atlas_alpha_med0', 0.8535156=
25,0.775390625,0.916015625,0.900390625)
+TexAtlas_RegisterMatTransform('tex_83', 'tex_atlas_alpha_med0', 0.91992187=
5,0.775390625,0.982421875,0.900390625)
+TexAtlas_RegisterMatTransform('tex_116', 'tex_atlas_alpha_med1', 0.0019531=
25,0.005859375,0.064453125,0.130859375)
+TexAtlas_RegisterMatTransform('tex_553', 'tex_atlas_alpha_med1', 0.0683593=
75,0.005859375,0.193359375,0.130859375)
+TexAtlas_RegisterMatTransform('tex_437', 'tex_atlas_alpha_med1', 0.1972656=
25,0.005859375,0.322265625,0.130859375)
+TexAtlas_RegisterMatTransform('tex_527', 'tex_atlas_alpha_med1', 0.3261718=
75,0.005859375,0.451171875,0.130859375)
+TexAtlas_RegisterMatTransform('tex_455', 'tex_atlas_alpha_med1', 0.4550781=
25,0.005859375,0.580078125,0.130859375)
+TexAtlas_RegisterMatTransform('tex_293', 'tex_atlas_alpha_med1', 0.5839843=
75,0.005859375,0.646484375,0.130859375)
+TexAtlas_RegisterMatTransform('tex_498', 'tex_atlas_alpha_med1', 0.6503906=
25,0.005859375,0.712890625,0.130859375)
+TexAtlas_RegisterMatTransform('tex_75', 'tex_atlas_alpha_med1', 0.71679687=
5,0.005859375,0.779296875,0.130859375)
+TexAtlas_RegisterMatTransform('tex_383', 'tex_atlas_alpha_med1', 0.7832031=
25,0.005859375,0.908203125,0.130859375)
+TexAtlas_RegisterMatTransform('tex_429', 'tex_atlas_alpha_med1', 0.9121093=
75,0.005859375,0.974609375,0.130859375)
+TexAtlas_RegisterMatTransform('tex_84', 'tex_atlas_alpha_med1', 0.00195312=
5,0.134765625,0.064453125,0.259765625)
+TexAtlas_RegisterMatTransform('tex_49', 'tex_atlas_alpha_med1', 0.06835937=
5,0.134765625,0.130859375,0.259765625)
+TexAtlas_RegisterMatTransform('tex_430', 'tex_atlas_alpha_med1', 0.1347656=
25,0.134765625,0.197265625,0.259765625)
+TexAtlas_RegisterMatTransform('tex_117', 'tex_atlas_alpha_med1', 0.2011718=
75,0.134765625,0.326171875,0.259765625)
+TexAtlas_RegisterMatTransform('tex_554', 'tex_atlas_alpha_med1', 0.3300781=
25,0.134765625,0.455078125,0.259765625)
+TexAtlas_RegisterMatTransform('tex_438', 'tex_atlas_alpha_med1', 0.4589843=
75,0.134765625,0.583984375,0.259765625)
+TexAtlas_RegisterMatTransform('tex_93', 'tex_atlas_alpha_med1', 0.58789062=
5,0.134765625,0.650390625,0.259765625)
+TexAtlas_RegisterMatTransform('tex_520', 'tex_atlas_alpha_med1', 0.6542968=
75,0.134765625,0.779296875,0.259765625)
+TexAtlas_RegisterMatTransform('tex_528', 'tex_atlas_alpha_med1', 0.7832031=
25,0.134765625,0.908203125,0.259765625)
+TexAtlas_RegisterMatTransform('tex_447', 'tex_atlas_alpha_med1', 0.0019531=
25,0.263671875,0.126953125,0.388671875)
+TexAtlas_RegisterMatTransform('tex_285', 'tex_atlas_alpha_med1', 0.1308593=
75,0.263671875,0.255859375,0.388671875)
+TexAtlas_RegisterMatTransform('tex_67', 'tex_atlas_alpha_med1', 0.25976562=
5,0.263671875,0.322265625,0.388671875)
+TexAtlas_RegisterMatTransform('tex_294', 'tex_atlas_alpha_med1', 0.3261718=
75,0.263671875,0.388671875,0.388671875)
+TexAtlas_RegisterMatTransform('tex_499', 'tex_atlas_alpha_med1', 0.3925781=
25,0.263671875,0.455078125,0.388671875)
+TexAtlas_RegisterMatTransform('tex_76', 'tex_atlas_alpha_med1', 0.45898437=
5,0.263671875,0.521484375,0.388671875)
+TexAtlas_RegisterMatTransform('tex_384', 'tex_atlas_alpha_med1', 0.5253906=
25,0.263671875,0.650390625,0.388671875)
+TexAtlas_RegisterMatTransform('tex_85', 'tex_atlas_alpha_med1', 0.65429687=
5,0.263671875,0.716796875,0.388671875)
+TexAtlas_RegisterMatTransform('tex_431', 'tex_atlas_alpha_med1', 0.7207031=
25,0.263671875,0.783203125,0.388671875)
+TexAtlas_RegisterMatTransform('tex_439', 'tex_atlas_alpha_med1', 0.7871093=
75,0.263671875,0.912109375,0.388671875)
+TexAtlas_RegisterMatTransform('tex_94', 'tex_atlas_alpha_med1', 0.91601562=
5,0.263671875,0.978515625,0.388671875)
+TexAtlas_RegisterMatTransform('tex_59', 'tex_atlas_alpha_med1', 0.00195312=
5,0.392578125,0.064453125,0.517578125)
+TexAtlas_RegisterMatTransform('tex_521', 'tex_atlas_alpha_med1', 0.0683593=
75,0.392578125,0.193359375,0.517578125)
+TexAtlas_RegisterMatTransform('tex_2481', 'tex_atlas_alpha_med1', 0.197265=
625,0.392578125,0.322265625,0.517578125)
+TexAtlas_RegisterMatTransform('tex_flowers', 'tex_atlas_alpha_med1', 0.326=
171875,0.392578125,0.451171875,0.517578125)
+TexAtlas_RegisterMatTransform('tex_gravestone_big', 'tex_atlas_alpha_med1'=
, 0.455078125,0.392578125,0.580078125,0.517578125)
+TexAtlas_RegisterMatTransform('tex_palmcrown', 'tex_atlas_alpha_med1', 0.5=
83984375,0.392578125,0.708984375,0.517578125)
 TexAtlas_RegisterMatTransform('tex_163', 'tex_atlas_alpha_med1', 0.0019531=
25,0.521484375,0.126953125,0.583984375)
 TexAtlas_RegisterMatTransform('tex_531', 'tex_atlas_alpha_med1', 0.1308593=
75,0.521484375,0.193359375,0.583984375)
 TexAtlas_RegisterMatTransform('tex_172', 'tex_atlas_alpha_med1', 0.1972656=
25,0.521484375,0.322265625,0.583984375)

Modified: trunk/data/models/atlas/tex_atlas_alpha_med.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_alpha_med.material (original)
+++ trunk/data/models/atlas/tex_atlas_alpha_med.material Fri Apr  4 13:24:4=
3 2008
@@ -6,7 +6,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_alpha_med0.png =

+				texture tex_atlas_alpha_med0.dds =

 			}	=

 		}
 	} =

@@ -19,7 +19,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_alpha_med1.png =

+				texture tex_atlas_alpha_med1.dds =

 			}	=

 		}
 	} =


Modified: trunk/data/models/atlas/tex_atlas_alpha_med0.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/atlas/tex_atlas_alpha_med1.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/atlas/tex_atlas_alpha_ultralow.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_alpha_ultralow.lua (original)
+++ trunk/data/models/atlas/tex_atlas_alpha_ultralow.lua Fri Apr  4 13:24:4=
3 2008
@@ -88,57 +88,59 @@
 TexAtlas_RegisterMatTransform('tex_283', 'tex_atlas_alpha_ultralow0', 0.44=
53125,0.1484375,0.4609375,0.1796875)
 TexAtlas_RegisterMatTransform('tex_65', 'tex_atlas_alpha_ultralow0', 0.476=
5625,0.1484375,0.4921875,0.1796875)
 TexAtlas_RegisterMatTransform('tex_5', 'tex_atlas_alpha_ultralow0', 0.5078=
125,0.1484375,0.5234375,0.1796875)
-TexAtlas_RegisterMatTransform('tex_454', 'tex_atlas_alpha_ultralow0', 0.53=
90625,0.1484375,0.5703125,0.1796875)
-TexAtlas_RegisterMatTransform('tex_292', 'tex_atlas_alpha_ultralow0', 0.58=
59375,0.1484375,0.6015625,0.1796875)
-TexAtlas_RegisterMatTransform('tex_497', 'tex_atlas_alpha_ultralow0', 0.61=
71875,0.1484375,0.6328125,0.1796875)
-TexAtlas_RegisterMatTransform('tex_501', 'tex_atlas_alpha_ultralow0', 0.64=
84375,0.1484375,0.6640625,0.1796875)
-TexAtlas_RegisterMatTransform('tex_544', 'tex_atlas_alpha_ultralow0', 0.67=
96875,0.1484375,0.7109375,0.1796875)
-TexAtlas_RegisterMatTransform('tex_382', 'tex_atlas_alpha_ultralow0', 0.72=
65625,0.1484375,0.7578125,0.1796875)
-TexAtlas_RegisterMatTransform('tex_428', 'tex_atlas_alpha_ultralow0', 0.77=
34375,0.1484375,0.7890625,0.1796875)
-TexAtlas_RegisterMatTransform('tex_83', 'tex_atlas_alpha_ultralow0', 0.804=
6875,0.1484375,0.8203125,0.1796875)
-TexAtlas_RegisterMatTransform('tex_116', 'tex_atlas_alpha_ultralow0', 0.83=
59375,0.1484375,0.8515625,0.1796875)
-TexAtlas_RegisterMatTransform('tex_553', 'tex_atlas_alpha_ultralow0', 0.86=
71875,0.1484375,0.8984375,0.1796875)
-TexAtlas_RegisterMatTransform('tex_437', 'tex_atlas_alpha_ultralow0', 0.91=
40625,0.1484375,0.9453125,0.1796875)
-TexAtlas_RegisterMatTransform('tex_356', 'tex_atlas_alpha_ultralow0', 0.96=
09375,0.1484375,0.9921875,0.1796875)
-TexAtlas_RegisterMatTransform('tex_527', 'tex_atlas_alpha_ultralow0', 0.00=
78125,0.1953125,0.0390625,0.2265625)
-TexAtlas_RegisterMatTransform('tex_446', 'tex_atlas_alpha_ultralow0', 0.05=
46875,0.1953125,0.0859375,0.2265625)
-TexAtlas_RegisterMatTransform('tex_365', 'tex_atlas_alpha_ultralow0', 0.10=
15625,0.1953125,0.1328125,0.2265625)
-TexAtlas_RegisterMatTransform('tex_490', 'tex_atlas_alpha_ultralow0', 0.14=
84375,0.1953125,0.15625,0.2265625)
-TexAtlas_RegisterMatTransform('tex_455', 'tex_atlas_alpha_ultralow0', 0.17=
1875,0.1953125,0.203125,0.2265625)
-TexAtlas_RegisterMatTransform('tex_293', 'tex_atlas_alpha_ultralow0', 0.21=
875,0.1953125,0.234375,0.2265625)
-TexAtlas_RegisterMatTransform('tex_498', 'tex_atlas_alpha_ultralow0', 0.25=
,0.1953125,0.265625,0.2265625)
-TexAtlas_RegisterMatTransform('tex_75', 'tex_atlas_alpha_ultralow0', 0.281=
25,0.1953125,0.296875,0.2265625)
-TexAtlas_RegisterMatTransform('tex_502', 'tex_atlas_alpha_ultralow0', 0.31=
25,0.1953125,0.328125,0.2265625)
-TexAtlas_RegisterMatTransform('tex_383', 'tex_atlas_alpha_ultralow0', 0.34=
375,0.1953125,0.375,0.2265625)
-TexAtlas_RegisterMatTransform('tex_429', 'tex_atlas_alpha_ultralow0', 0.39=
0625,0.1953125,0.40625,0.2265625)
-TexAtlas_RegisterMatTransform('tex_84', 'tex_atlas_alpha_ultralow0', 0.421=
875,0.1953125,0.4375,0.2265625)
-TexAtlas_RegisterMatTransform('tex_49', 'tex_atlas_alpha_ultralow0', 0.453=
125,0.1953125,0.46875,0.2265625)
-TexAtlas_RegisterMatTransform('tex_430', 'tex_atlas_alpha_ultralow0', 0.48=
4375,0.1953125,0.5,0.2265625)
-TexAtlas_RegisterMatTransform('tex_117', 'tex_atlas_alpha_ultralow0', 0.51=
5625,0.1953125,0.546875,0.2265625)
-TexAtlas_RegisterMatTransform('tex_554', 'tex_atlas_alpha_ultralow0', 0.56=
25,0.1953125,0.59375,0.2265625)
-TexAtlas_RegisterMatTransform('tex_438', 'tex_atlas_alpha_ultralow0', 0.60=
9375,0.1953125,0.640625,0.2265625)
-TexAtlas_RegisterMatTransform('tex_357', 'tex_atlas_alpha_ultralow0', 0.65=
625,0.1953125,0.6875,0.2265625)
-TexAtlas_RegisterMatTransform('tex_93', 'tex_atlas_alpha_ultralow0', 0.703=
125,0.1953125,0.71875,0.2265625)
-TexAtlas_RegisterMatTransform('tex_520', 'tex_atlas_alpha_ultralow0', 0.73=
4375,0.1953125,0.765625,0.2265625)
-TexAtlas_RegisterMatTransform('tex_528', 'tex_atlas_alpha_ultralow0', 0.78=
125,0.1953125,0.8125,0.2265625)
-TexAtlas_RegisterMatTransform('tex_447', 'tex_atlas_alpha_ultralow0', 0.82=
8125,0.1953125,0.859375,0.2265625)
-TexAtlas_RegisterMatTransform('tex_285', 'tex_atlas_alpha_ultralow0', 0.87=
5,0.1953125,0.90625,0.2265625)
-TexAtlas_RegisterMatTransform('tex_67', 'tex_atlas_alpha_ultralow0', 0.921=
875,0.1953125,0.9375,0.2265625)
-TexAtlas_RegisterMatTransform('tex_294', 'tex_atlas_alpha_ultralow0', 0.95=
3125,0.1953125,0.96875,0.2265625)
-TexAtlas_RegisterMatTransform('tex_499', 'tex_atlas_alpha_ultralow0', 0.00=
78125,0.2421875,0.0234375,0.2734375)
-TexAtlas_RegisterMatTransform('tex_76', 'tex_atlas_alpha_ultralow0', 0.039=
0625,0.2421875,0.0546875,0.2734375)
-TexAtlas_RegisterMatTransform('tex_503', 'tex_atlas_alpha_ultralow0', 0.07=
03125,0.2421875,0.0859375,0.2734375)
-TexAtlas_RegisterMatTransform('tex_384', 'tex_atlas_alpha_ultralow0', 0.10=
15625,0.2421875,0.1328125,0.2734375)
-TexAtlas_RegisterMatTransform('tex_85', 'tex_atlas_alpha_ultralow0', 0.148=
4375,0.2421875,0.1640625,0.2734375)
-TexAtlas_RegisterMatTransform('tex_431', 'tex_atlas_alpha_ultralow0', 0.17=
96875,0.2421875,0.1953125,0.2734375)
-TexAtlas_RegisterMatTransform('tex_439', 'tex_atlas_alpha_ultralow0', 0.21=
09375,0.2421875,0.2421875,0.2734375)
-TexAtlas_RegisterMatTransform('tex_358', 'tex_atlas_alpha_ultralow0', 0.25=
78125,0.2421875,0.2890625,0.2734375)
-TexAtlas_RegisterMatTransform('tex_94', 'tex_atlas_alpha_ultralow0', 0.304=
6875,0.2421875,0.3203125,0.2734375)
-TexAtlas_RegisterMatTransform('tex_59', 'tex_atlas_alpha_ultralow0', 0.335=
9375,0.2421875,0.3515625,0.2734375)
-TexAtlas_RegisterMatTransform('tex_521', 'tex_atlas_alpha_ultralow0', 0.36=
71875,0.2421875,0.3984375,0.2734375)
-TexAtlas_RegisterMatTransform('tex_2481', 'tex_atlas_alpha_ultralow0', 0.4=
140625,0.2421875,0.4453125,0.2734375)
-TexAtlas_RegisterMatTransform('tex_flowers', 'tex_atlas_alpha_ultralow0', =
0.4609375,0.2421875,0.4921875,0.2734375)
-TexAtlas_RegisterMatTransform('tex_gravestone_big', 'tex_atlas_alpha_ultra=
low0', 0.5078125,0.2421875,0.5390625,0.2734375)
+TexAtlas_RegisterMatTransform('tex_palmleaf', 'tex_atlas_alpha_ultralow0',=
 0.5390625,0.1484375,0.5703125,0.1796875)
+TexAtlas_RegisterMatTransform('tex_454', 'tex_atlas_alpha_ultralow0', 0.58=
59375,0.1484375,0.6171875,0.1796875)
+TexAtlas_RegisterMatTransform('tex_292', 'tex_atlas_alpha_ultralow0', 0.63=
28125,0.1484375,0.6484375,0.1796875)
+TexAtlas_RegisterMatTransform('tex_497', 'tex_atlas_alpha_ultralow0', 0.66=
40625,0.1484375,0.6796875,0.1796875)
+TexAtlas_RegisterMatTransform('tex_501', 'tex_atlas_alpha_ultralow0', 0.69=
53125,0.1484375,0.7109375,0.1796875)
+TexAtlas_RegisterMatTransform('tex_544', 'tex_atlas_alpha_ultralow0', 0.72=
65625,0.1484375,0.7578125,0.1796875)
+TexAtlas_RegisterMatTransform('tex_382', 'tex_atlas_alpha_ultralow0', 0.77=
34375,0.1484375,0.8046875,0.1796875)
+TexAtlas_RegisterMatTransform('tex_428', 'tex_atlas_alpha_ultralow0', 0.82=
03125,0.1484375,0.8359375,0.1796875)
+TexAtlas_RegisterMatTransform('tex_83', 'tex_atlas_alpha_ultralow0', 0.851=
5625,0.1484375,0.8671875,0.1796875)
+TexAtlas_RegisterMatTransform('tex_116', 'tex_atlas_alpha_ultralow0', 0.88=
28125,0.1484375,0.8984375,0.1796875)
+TexAtlas_RegisterMatTransform('tex_553', 'tex_atlas_alpha_ultralow0', 0.91=
40625,0.1484375,0.9453125,0.1796875)
+TexAtlas_RegisterMatTransform('tex_437', 'tex_atlas_alpha_ultralow0', 0.96=
09375,0.1484375,0.9921875,0.1796875)
+TexAtlas_RegisterMatTransform('tex_356', 'tex_atlas_alpha_ultralow0', 0.00=
78125,0.1953125,0.0390625,0.2265625)
+TexAtlas_RegisterMatTransform('tex_527', 'tex_atlas_alpha_ultralow0', 0.05=
46875,0.1953125,0.0859375,0.2265625)
+TexAtlas_RegisterMatTransform('tex_446', 'tex_atlas_alpha_ultralow0', 0.10=
15625,0.1953125,0.1328125,0.2265625)
+TexAtlas_RegisterMatTransform('tex_365', 'tex_atlas_alpha_ultralow0', 0.14=
84375,0.1953125,0.1796875,0.2265625)
+TexAtlas_RegisterMatTransform('tex_490', 'tex_atlas_alpha_ultralow0', 0.19=
53125,0.1953125,0.203125,0.2265625)
+TexAtlas_RegisterMatTransform('tex_455', 'tex_atlas_alpha_ultralow0', 0.21=
875,0.1953125,0.25,0.2265625)
+TexAtlas_RegisterMatTransform('tex_293', 'tex_atlas_alpha_ultralow0', 0.26=
5625,0.1953125,0.28125,0.2265625)
+TexAtlas_RegisterMatTransform('tex_498', 'tex_atlas_alpha_ultralow0', 0.29=
6875,0.1953125,0.3125,0.2265625)
+TexAtlas_RegisterMatTransform('tex_75', 'tex_atlas_alpha_ultralow0', 0.328=
125,0.1953125,0.34375,0.2265625)
+TexAtlas_RegisterMatTransform('tex_502', 'tex_atlas_alpha_ultralow0', 0.35=
9375,0.1953125,0.375,0.2265625)
+TexAtlas_RegisterMatTransform('tex_383', 'tex_atlas_alpha_ultralow0', 0.39=
0625,0.1953125,0.421875,0.2265625)
+TexAtlas_RegisterMatTransform('tex_429', 'tex_atlas_alpha_ultralow0', 0.43=
75,0.1953125,0.453125,0.2265625)
+TexAtlas_RegisterMatTransform('tex_84', 'tex_atlas_alpha_ultralow0', 0.468=
75,0.1953125,0.484375,0.2265625)
+TexAtlas_RegisterMatTransform('tex_49', 'tex_atlas_alpha_ultralow0', 0.5,0=
.1953125,0.515625,0.2265625)
+TexAtlas_RegisterMatTransform('tex_430', 'tex_atlas_alpha_ultralow0', 0.53=
125,0.1953125,0.546875,0.2265625)
+TexAtlas_RegisterMatTransform('tex_117', 'tex_atlas_alpha_ultralow0', 0.56=
25,0.1953125,0.59375,0.2265625)
+TexAtlas_RegisterMatTransform('tex_554', 'tex_atlas_alpha_ultralow0', 0.60=
9375,0.1953125,0.640625,0.2265625)
+TexAtlas_RegisterMatTransform('tex_438', 'tex_atlas_alpha_ultralow0', 0.65=
625,0.1953125,0.6875,0.2265625)
+TexAtlas_RegisterMatTransform('tex_357', 'tex_atlas_alpha_ultralow0', 0.70=
3125,0.1953125,0.734375,0.2265625)
+TexAtlas_RegisterMatTransform('tex_93', 'tex_atlas_alpha_ultralow0', 0.75,=
0.1953125,0.765625,0.2265625)
+TexAtlas_RegisterMatTransform('tex_520', 'tex_atlas_alpha_ultralow0', 0.78=
125,0.1953125,0.8125,0.2265625)
+TexAtlas_RegisterMatTransform('tex_528', 'tex_atlas_alpha_ultralow0', 0.82=
8125,0.1953125,0.859375,0.2265625)
+TexAtlas_RegisterMatTransform('tex_447', 'tex_atlas_alpha_ultralow0', 0.87=
5,0.1953125,0.90625,0.2265625)
+TexAtlas_RegisterMatTransform('tex_285', 'tex_atlas_alpha_ultralow0', 0.92=
1875,0.1953125,0.953125,0.2265625)
+TexAtlas_RegisterMatTransform('tex_67', 'tex_atlas_alpha_ultralow0', 0.968=
75,0.1953125,0.984375,0.2265625)
+TexAtlas_RegisterMatTransform('tex_294', 'tex_atlas_alpha_ultralow0', 0.00=
78125,0.2421875,0.0234375,0.2734375)
+TexAtlas_RegisterMatTransform('tex_499', 'tex_atlas_alpha_ultralow0', 0.03=
90625,0.2421875,0.0546875,0.2734375)
+TexAtlas_RegisterMatTransform('tex_76', 'tex_atlas_alpha_ultralow0', 0.070=
3125,0.2421875,0.0859375,0.2734375)
+TexAtlas_RegisterMatTransform('tex_503', 'tex_atlas_alpha_ultralow0', 0.10=
15625,0.2421875,0.1171875,0.2734375)
+TexAtlas_RegisterMatTransform('tex_384', 'tex_atlas_alpha_ultralow0', 0.13=
28125,0.2421875,0.1640625,0.2734375)
+TexAtlas_RegisterMatTransform('tex_85', 'tex_atlas_alpha_ultralow0', 0.179=
6875,0.2421875,0.1953125,0.2734375)
+TexAtlas_RegisterMatTransform('tex_431', 'tex_atlas_alpha_ultralow0', 0.21=
09375,0.2421875,0.2265625,0.2734375)
+TexAtlas_RegisterMatTransform('tex_439', 'tex_atlas_alpha_ultralow0', 0.24=
21875,0.2421875,0.2734375,0.2734375)
+TexAtlas_RegisterMatTransform('tex_358', 'tex_atlas_alpha_ultralow0', 0.28=
90625,0.2421875,0.3203125,0.2734375)
+TexAtlas_RegisterMatTransform('tex_94', 'tex_atlas_alpha_ultralow0', 0.335=
9375,0.2421875,0.3515625,0.2734375)
+TexAtlas_RegisterMatTransform('tex_59', 'tex_atlas_alpha_ultralow0', 0.367=
1875,0.2421875,0.3828125,0.2734375)
+TexAtlas_RegisterMatTransform('tex_521', 'tex_atlas_alpha_ultralow0', 0.39=
84375,0.2421875,0.4296875,0.2734375)
+TexAtlas_RegisterMatTransform('tex_2481', 'tex_atlas_alpha_ultralow0', 0.4=
453125,0.2421875,0.4765625,0.2734375)
+TexAtlas_RegisterMatTransform('tex_flowers', 'tex_atlas_alpha_ultralow0', =
0.4921875,0.2421875,0.5234375,0.2734375)
+TexAtlas_RegisterMatTransform('tex_gravestone_big', 'tex_atlas_alpha_ultra=
low0', 0.5390625,0.2421875,0.5703125,0.2734375)
+TexAtlas_RegisterMatTransform('tex_palmcrown', 'tex_atlas_alpha_ultralow0'=
, 0.5859375,0.2421875,0.6171875,0.2734375)
 TexAtlas_RegisterMatTransform('tex_163', 'tex_atlas_alpha_ultralow0', 0.00=
78125,0.2890625,0.0390625,0.3046875)
 TexAtlas_RegisterMatTransform('tex_172', 'tex_atlas_alpha_ultralow0', 0.05=
46875,0.2890625,0.0859375,0.3046875)
 TexAtlas_RegisterMatTransform('tex_155', 'tex_atlas_alpha_ultralow0', 0.10=
15625,0.2890625,0.1328125,0.3046875)

Modified: trunk/data/models/atlas/tex_atlas_alpha_ultralow0.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/atlas/tex_atlas_low.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_low.lua (original)
+++ trunk/data/models/atlas/tex_atlas_low.lua Fri Apr  4 13:24:43 2008
@@ -298,59 +298,62 @@
 TexAtlas_RegisterMatTransform('tex_482', 'tex_atlas_low1', 0.87109375,0.29=
296875,0.93359375,0.35546875)
 TexAtlas_RegisterMatTransform('tex_366', 'tex_atlas_low1', 0.00390625,0.36=
328125,0.06640625,0.42578125)
 TexAtlas_RegisterMatTransform('tex_24', 'tex_atlas_low1', 0.07421875,0.363=
28125,0.10546875,0.42578125)
-TexAtlas_RegisterMatTransform('tex_7', 'tex_atlas_low1', 0.11328125,0.3632=
8125,0.17578125,0.42578125)
-TexAtlas_RegisterMatTransform('tex_413', 'tex_atlas_low1', 0.18359375,0.36=
328125,0.24609375,0.42578125)
-TexAtlas_RegisterMatTransform('tex_332', 'tex_atlas_low1', 0.25390625,0.36=
328125,0.31640625,0.42578125)
-TexAtlas_RegisterMatTransform('tex_216', 'tex_atlas_low1', 0.32421875,0.36=
328125,0.38671875,0.42578125)
-TexAtlas_RegisterMatTransform('tex_491', 'tex_atlas_low1', 0.39453125,0.36=
328125,0.45703125,0.42578125)
-TexAtlas_RegisterMatTransform('tex_537', 'tex_atlas_low1', 0.46484375,0.36=
328125,0.52734375,0.42578125)
-TexAtlas_RegisterMatTransform('tex_456', 'tex_atlas_low1', 0.53515625,0.36=
328125,0.59765625,0.42578125)
-TexAtlas_RegisterMatTransform('tex_375', 'tex_atlas_low1', 0.60546875,0.36=
328125,0.63671875,0.42578125)
-TexAtlas_RegisterMatTransform('tex_178', 'tex_atlas_low1', 0.64453125,0.36=
328125,0.67578125,0.42578125)
-TexAtlas_RegisterMatTransform('tex_259', 'tex_atlas_low1', 0.68359375,0.36=
328125,0.74609375,0.42578125)
-TexAtlas_RegisterMatTransform('tex_33', 'tex_atlas_low1', 0.75390625,0.363=
28125,0.81640625,0.42578125)
-TexAtlas_RegisterMatTransform('tex_101', 'tex_atlas_low1', 0.82421875,0.36=
328125,0.83984375,0.42578125)
-TexAtlas_RegisterMatTransform('tex_422', 'tex_atlas_low1', 0.84765625,0.36=
328125,0.91015625,0.42578125)
-TexAtlas_RegisterMatTransform('tex_341', 'tex_atlas_low1', 0.91796875,0.36=
328125,0.98046875,0.42578125)
-TexAtlas_RegisterMatTransform('tex_260', 'tex_atlas_low1', 0.00390625,0.43=
359375,0.06640625,0.49609375)
-TexAtlas_RegisterMatTransform('tex_225', 'tex_atlas_low1', 0.07421875,0.43=
359375,0.13671875,0.49609375)
-TexAtlas_RegisterMatTransform('tex_306', 'tex_atlas_low1', 0.14453125,0.43=
359375,0.20703125,0.49609375)
-TexAtlas_RegisterMatTransform('tex_109', 'tex_atlas_low1', 0.21484375,0.43=
359375,0.24609375,0.49609375)
-TexAtlas_RegisterMatTransform('tex_546', 'tex_atlas_low1', 0.25390625,0.43=
359375,0.31640625,0.49609375)
-TexAtlas_RegisterMatTransform('tex_465', 'tex_atlas_low1', 0.32421875,0.43=
359375,0.38671875,0.49609375)
-TexAtlas_RegisterMatTransform('tex_349', 'tex_atlas_low1', 0.39453125,0.43=
359375,0.45703125,0.49609375)
-TexAtlas_RegisterMatTransform('tex_187', 'tex_atlas_low1', 0.46484375,0.43=
359375,0.52734375,0.49609375)
-TexAtlas_RegisterMatTransform('tex_268', 'tex_atlas_low1', 0.53515625,0.43=
359375,0.59765625,0.49609375)
-TexAtlas_RegisterMatTransform('tex_42', 'tex_atlas_low1', 0.60546875,0.433=
59375,0.63671875,0.49609375)
-TexAtlas_RegisterMatTransform('tex_512', 'tex_atlas_low1', 0.64453125,0.43=
359375,0.70703125,0.49609375)
-TexAtlas_RegisterMatTransform('tex_350', 'tex_atlas_low1', 0.71484375,0.43=
359375,0.77734375,0.49609375)
-TexAtlas_RegisterMatTransform('tex_234', 'tex_atlas_low1', 0.78515625,0.43=
359375,0.84765625,0.49609375)
-TexAtlas_RegisterMatTransform('tex_315', 'tex_atlas_low1', 0.85546875,0.43=
359375,0.91796875,0.49609375)
-TexAtlas_RegisterMatTransform('tex_118', 'tex_atlas_low1', 0.92578125,0.43=
359375,0.98828125,0.49609375)
-TexAtlas_RegisterMatTransform('tex_555', 'tex_atlas_low1', 0.00390625,0.50=
390625,0.06640625,0.56640625)
-TexAtlas_RegisterMatTransform('tex_474', 'tex_atlas_low1', 0.07421875,0.50=
390625,0.13671875,0.56640625)
-TexAtlas_RegisterMatTransform('tex_393', 'tex_atlas_low1', 0.14453125,0.50=
390625,0.20703125,0.56640625)
-TexAtlas_RegisterMatTransform('tex_196', 'tex_atlas_low1', 0.21484375,0.50=
390625,0.27734375,0.56640625)
-TexAtlas_RegisterMatTransform('tex_277', 'tex_atlas_low1', 0.28515625,0.50=
390625,0.34765625,0.56640625)
-TexAtlas_RegisterMatTransform('tex_51', 'tex_atlas_low1', 0.35546875,0.503=
90625,0.38671875,0.56640625)
-TexAtlas_RegisterMatTransform('tex_16', 'tex_atlas_low1', 0.39453125,0.503=
90625,0.45703125,0.56640625)
-TexAtlas_RegisterMatTransform('tex_200', 'tex_atlas_low1', 0.46484375,0.50=
390625,0.52734375,0.56640625)
-TexAtlas_RegisterMatTransform('tex_mud', 'tex_atlas_low1', 0.53515625,0.50=
390625,0.59765625,0.56640625)
-TexAtlas_RegisterMatTransform('tex_405', 'tex_atlas_low1', 0.60546875,0.50=
390625,0.66796875,0.56640625)
-TexAtlas_RegisterMatTransform('tex_243', 'tex_atlas_low1', 0.67578125,0.50=
390625,0.73828125,0.56640625)
-TexAtlas_RegisterMatTransform('tex_324', 'tex_atlas_low1', 0.74609375,0.50=
390625,0.80859375,0.56640625)
-TexAtlas_RegisterMatTransform('tex_208', 'tex_atlas_low1', 0.81640625,0.50=
390625,0.87890625,0.56640625)
-TexAtlas_RegisterMatTransform('tex_5351', 'tex_atlas_low1', 0.88671875,0.5=
0390625,0.94921875,0.56640625)
-TexAtlas_RegisterMatTransform('tex_5634', 'tex_atlas_low1', 0.00390625,0.5=
7421875,0.06640625,0.63671875)
-TexAtlas_RegisterMatTransform('tex_mushroom', 'tex_atlas_low1', 0.07421875=
,0.57421875,0.13671875,0.63671875)
-TexAtlas_RegisterMatTransform('tex_mushroom2', 'tex_atlas_low1', 0.1445312=
5,0.57421875,0.20703125,0.63671875)
-TexAtlas_RegisterMatTransform('tex_slidingdoor', 'tex_atlas_low1', 0.21484=
375,0.57421875,0.27734375,0.63671875)
-TexAtlas_RegisterMatTransform('tex_lantern', 'tex_atlas_low1', 0.28515625,=
0.57421875,0.34765625,0.63671875)
-TexAtlas_RegisterMatTransform('tex_stoneplate', 'tex_atlas_low1', 0.355468=
75,0.57421875,0.41796875,0.63671875)
-TexAtlas_RegisterMatTransform('tex_rune1', 'tex_atlas_low1', 0.42578125,0.=
57421875,0.48828125,0.63671875)
-TexAtlas_RegisterMatTransform('tex_marblewall', 'tex_atlas_low1', 0.496093=
75,0.57421875,0.55859375,0.63671875)
-TexAtlas_RegisterMatTransform('tex_sattel', 'tex_atlas_low1', 0.56640625,0=
.57421875,0.62890625,0.63671875)
-TexAtlas_RegisterMatTransform('tex_portrait', 'tex_atlas_low1', 0.63671875=
,0.57421875,0.69921875,0.63671875)
+TexAtlas_RegisterMatTransform('tex_palmbark', 'tex_atlas_low1', 0.11328125=
,0.36328125,0.17578125,0.42578125)
+TexAtlas_RegisterMatTransform('tex_7', 'tex_atlas_low1', 0.18359375,0.3632=
8125,0.24609375,0.42578125)
+TexAtlas_RegisterMatTransform('tex_413', 'tex_atlas_low1', 0.25390625,0.36=
328125,0.31640625,0.42578125)
+TexAtlas_RegisterMatTransform('tex_332', 'tex_atlas_low1', 0.32421875,0.36=
328125,0.38671875,0.42578125)
+TexAtlas_RegisterMatTransform('tex_216', 'tex_atlas_low1', 0.39453125,0.36=
328125,0.45703125,0.42578125)
+TexAtlas_RegisterMatTransform('tex_491', 'tex_atlas_low1', 0.46484375,0.36=
328125,0.52734375,0.42578125)
+TexAtlas_RegisterMatTransform('tex_537', 'tex_atlas_low1', 0.53515625,0.36=
328125,0.59765625,0.42578125)
+TexAtlas_RegisterMatTransform('tex_456', 'tex_atlas_low1', 0.60546875,0.36=
328125,0.66796875,0.42578125)
+TexAtlas_RegisterMatTransform('tex_375', 'tex_atlas_low1', 0.67578125,0.36=
328125,0.70703125,0.42578125)
+TexAtlas_RegisterMatTransform('tex_178', 'tex_atlas_low1', 0.71484375,0.36=
328125,0.74609375,0.42578125)
+TexAtlas_RegisterMatTransform('tex_259', 'tex_atlas_low1', 0.75390625,0.36=
328125,0.81640625,0.42578125)
+TexAtlas_RegisterMatTransform('tex_33', 'tex_atlas_low1', 0.82421875,0.363=
28125,0.88671875,0.42578125)
+TexAtlas_RegisterMatTransform('tex_101', 'tex_atlas_low1', 0.89453125,0.36=
328125,0.91015625,0.42578125)
+TexAtlas_RegisterMatTransform('tex_422', 'tex_atlas_low1', 0.91796875,0.36=
328125,0.98046875,0.42578125)
+TexAtlas_RegisterMatTransform('tex_341', 'tex_atlas_low1', 0.00390625,0.43=
359375,0.06640625,0.49609375)
+TexAtlas_RegisterMatTransform('tex_260', 'tex_atlas_low1', 0.07421875,0.43=
359375,0.13671875,0.49609375)
+TexAtlas_RegisterMatTransform('tex_225', 'tex_atlas_low1', 0.14453125,0.43=
359375,0.20703125,0.49609375)
+TexAtlas_RegisterMatTransform('tex_306', 'tex_atlas_low1', 0.21484375,0.43=
359375,0.27734375,0.49609375)
+TexAtlas_RegisterMatTransform('tex_109', 'tex_atlas_low1', 0.28515625,0.43=
359375,0.31640625,0.49609375)
+TexAtlas_RegisterMatTransform('tex_546', 'tex_atlas_low1', 0.32421875,0.43=
359375,0.38671875,0.49609375)
+TexAtlas_RegisterMatTransform('tex_465', 'tex_atlas_low1', 0.39453125,0.43=
359375,0.45703125,0.49609375)
+TexAtlas_RegisterMatTransform('tex_349', 'tex_atlas_low1', 0.46484375,0.43=
359375,0.52734375,0.49609375)
+TexAtlas_RegisterMatTransform('tex_187', 'tex_atlas_low1', 0.53515625,0.43=
359375,0.59765625,0.49609375)
+TexAtlas_RegisterMatTransform('tex_268', 'tex_atlas_low1', 0.60546875,0.43=
359375,0.66796875,0.49609375)
+TexAtlas_RegisterMatTransform('tex_42', 'tex_atlas_low1', 0.67578125,0.433=
59375,0.70703125,0.49609375)
+TexAtlas_RegisterMatTransform('tex_512', 'tex_atlas_low1', 0.71484375,0.43=
359375,0.77734375,0.49609375)
+TexAtlas_RegisterMatTransform('tex_350', 'tex_atlas_low1', 0.78515625,0.43=
359375,0.84765625,0.49609375)
+TexAtlas_RegisterMatTransform('tex_234', 'tex_atlas_low1', 0.85546875,0.43=
359375,0.91796875,0.49609375)
+TexAtlas_RegisterMatTransform('tex_315', 'tex_atlas_low1', 0.92578125,0.43=
359375,0.98828125,0.49609375)
+TexAtlas_RegisterMatTransform('tex_118', 'tex_atlas_low1', 0.00390625,0.50=
390625,0.06640625,0.56640625)
+TexAtlas_RegisterMatTransform('tex_555', 'tex_atlas_low1', 0.07421875,0.50=
390625,0.13671875,0.56640625)
+TexAtlas_RegisterMatTransform('tex_474', 'tex_atlas_low1', 0.14453125,0.50=
390625,0.20703125,0.56640625)
+TexAtlas_RegisterMatTransform('tex_393', 'tex_atlas_low1', 0.21484375,0.50=
390625,0.27734375,0.56640625)
+TexAtlas_RegisterMatTransform('tex_196', 'tex_atlas_low1', 0.28515625,0.50=
390625,0.34765625,0.56640625)
+TexAtlas_RegisterMatTransform('tex_277', 'tex_atlas_low1', 0.35546875,0.50=
390625,0.41796875,0.56640625)
+TexAtlas_RegisterMatTransform('tex_51', 'tex_atlas_low1', 0.42578125,0.503=
90625,0.45703125,0.56640625)
+TexAtlas_RegisterMatTransform('tex_16', 'tex_atlas_low1', 0.46484375,0.503=
90625,0.52734375,0.56640625)
+TexAtlas_RegisterMatTransform('tex_200', 'tex_atlas_low1', 0.53515625,0.50=
390625,0.59765625,0.56640625)
+TexAtlas_RegisterMatTransform('tex_mud', 'tex_atlas_low1', 0.60546875,0.50=
390625,0.66796875,0.56640625)
+TexAtlas_RegisterMatTransform('tex_405', 'tex_atlas_low1', 0.67578125,0.50=
390625,0.73828125,0.56640625)
+TexAtlas_RegisterMatTransform('tex_243', 'tex_atlas_low1', 0.74609375,0.50=
390625,0.80859375,0.56640625)
+TexAtlas_RegisterMatTransform('tex_324', 'tex_atlas_low1', 0.81640625,0.50=
390625,0.87890625,0.56640625)
+TexAtlas_RegisterMatTransform('tex_208', 'tex_atlas_low1', 0.88671875,0.50=
390625,0.94921875,0.56640625)
+TexAtlas_RegisterMatTransform('tex_5351', 'tex_atlas_low1', 0.00390625,0.5=
7421875,0.06640625,0.63671875)
+TexAtlas_RegisterMatTransform('tex_5634', 'tex_atlas_low1', 0.07421875,0.5=
7421875,0.13671875,0.63671875)
+TexAtlas_RegisterMatTransform('tex_mushroom', 'tex_atlas_low1', 0.14453125=
,0.57421875,0.20703125,0.63671875)
+TexAtlas_RegisterMatTransform('tex_mushroom2', 'tex_atlas_low1', 0.2148437=
5,0.57421875,0.27734375,0.63671875)
+TexAtlas_RegisterMatTransform('tex_slidingdoor', 'tex_atlas_low1', 0.28515=
625,0.57421875,0.34765625,0.63671875)
+TexAtlas_RegisterMatTransform('tex_lantern', 'tex_atlas_low1', 0.35546875,=
0.57421875,0.41796875,0.63671875)
+TexAtlas_RegisterMatTransform('tex_stoneplate', 'tex_atlas_low1', 0.425781=
25,0.57421875,0.48828125,0.63671875)
+TexAtlas_RegisterMatTransform('tex_rune1', 'tex_atlas_low1', 0.49609375,0.=
57421875,0.55859375,0.63671875)
+TexAtlas_RegisterMatTransform('tex_marblewall', 'tex_atlas_low1', 0.566406=
25,0.57421875,0.62890625,0.63671875)
+TexAtlas_RegisterMatTransform('tex_sattel', 'tex_atlas_low1', 0.63671875,0=
.57421875,0.69921875,0.63671875)
+TexAtlas_RegisterMatTransform('tex_portrait', 'tex_atlas_low1', 0.70703125=
,0.57421875,0.76953125,0.63671875)
+TexAtlas_RegisterMatTransform('tex_armoire_2637', 'tex_atlas_low1', 0.7773=
4375,0.57421875,0.83984375,0.63671875)
+TexAtlas_RegisterMatTransform('tex_armoire_2639', 'tex_atlas_low1', 0.8476=
5625,0.57421875,0.91015625,0.63671875)
 TexAtlas_RegisterMatTransform('tex_483', 'tex_atlas_low1', 0.00390625,0.64=
453125,0.06640625,0.67578125)
 TexAtlas_RegisterMatTransform('tex_564', 'tex_atlas_low1', 0.07421875,0.64=
453125,0.13671875,0.67578125)
 TexAtlas_RegisterMatTransform('tex_286', 'tex_atlas_low1', 0.14453125,0.64=
453125,0.20703125,0.67578125)
@@ -391,26 +394,25 @@
 TexAtlas_RegisterMatTransform('tex_133', 'tex_atlas_low1', 0.63671875,0.72=
265625,0.69921875,0.75390625)
 TexAtlas_RegisterMatTransform('tex_142', 'tex_atlas_low1', 0.70703125,0.72=
265625,0.76953125,0.75390625)
 TexAtlas_RegisterMatTransform('tex_159', 'tex_atlas_low1', 0.77734375,0.72=
265625,0.83984375,0.75390625)
-TexAtlas_RegisterMatTransform('tex_403', 'tex_atlas_low1', 0.84765625,0.72=
265625,0.91015625,0.75390625)
-TexAtlas_RegisterMatTransform('tex_125', 'tex_atlas_low1', 0.91796875,0.72=
265625,0.98046875,0.75390625)
-TexAtlas_RegisterMatTransform('tex_168', 'tex_atlas_low1', 0.00390625,0.76=
171875,0.06640625,0.79296875)
-TexAtlas_RegisterMatTransform('tex_23', 'tex_atlas_low1', 0.07421875,0.761=
71875,0.13671875,0.79296875)
-TexAtlas_RegisterMatTransform('tex_250', 'tex_atlas_low1', 0.14453125,0.76=
171875,0.20703125,0.79296875)
-TexAtlas_RegisterMatTransform('tex_134', 'tex_atlas_low1', 0.21484375,0.76=
171875,0.27734375,0.79296875)
-TexAtlas_RegisterMatTransform('tex_571', 'tex_atlas_low1', 0.28515625,0.76=
171875,0.34765625,0.79296875)
-TexAtlas_RegisterMatTransform('tex_143', 'tex_atlas_low1', 0.35546875,0.76=
171875,0.41796875,0.79296875)
-TexAtlas_RegisterMatTransform('tex_152', 'tex_atlas_low1', 0.42578125,0.76=
171875,0.48828125,0.79296875)
-TexAtlas_RegisterMatTransform('tex_161', 'tex_atlas_low1', 0.49609375,0.76=
171875,0.55859375,0.79296875)
-TexAtlas_RegisterMatTransform('tex_126', 'tex_atlas_low1', 0.56640625,0.76=
171875,0.62890625,0.79296875)
-TexAtlas_RegisterMatTransform('tex_169', 'tex_atlas_low1', 0.63671875,0.76=
171875,0.69921875,0.79296875)
-TexAtlas_RegisterMatTransform('tex_170', 'tex_atlas_low1', 0.70703125,0.76=
171875,0.76953125,0.79296875)
-TexAtlas_RegisterMatTransform('tex_251', 'tex_atlas_low1', 0.77734375,0.76=
171875,0.83984375,0.79296875)
-TexAtlas_RegisterMatTransform('tex_135', 'tex_atlas_low1', 0.84765625,0.76=
171875,0.91015625,0.79296875)
-TexAtlas_RegisterMatTransform('tex_572', 'tex_atlas_low1', 0.91796875,0.76=
171875,0.98046875,0.79296875)
-TexAtlas_RegisterMatTransform('tex_144', 'tex_atlas_low1', 0.00390625,0.80=
078125,0.06640625,0.83203125)
-TexAtlas_RegisterMatTransform('tex_110', 'tex_atlas_low1', 0.07421875,0.80=
078125,0.13671875,0.83203125)
-TexAtlas_RegisterMatTransform('tex_162', 'tex_atlas_low1', 0.14453125,0.80=
078125,0.20703125,0.83203125)
-TexAtlas_RegisterMatTransform('tex_127', 'tex_atlas_low1', 0.21484375,0.80=
078125,0.27734375,0.83203125)
+TexAtlas_RegisterMatTransform('tex_125', 'tex_atlas_low1', 0.84765625,0.72=
265625,0.91015625,0.75390625)
+TexAtlas_RegisterMatTransform('tex_168', 'tex_atlas_low1', 0.91796875,0.72=
265625,0.98046875,0.75390625)
+TexAtlas_RegisterMatTransform('tex_23', 'tex_atlas_low1', 0.00390625,0.761=
71875,0.06640625,0.79296875)
+TexAtlas_RegisterMatTransform('tex_250', 'tex_atlas_low1', 0.07421875,0.76=
171875,0.13671875,0.79296875)
+TexAtlas_RegisterMatTransform('tex_134', 'tex_atlas_low1', 0.14453125,0.76=
171875,0.20703125,0.79296875)
+TexAtlas_RegisterMatTransform('tex_571', 'tex_atlas_low1', 0.21484375,0.76=
171875,0.27734375,0.79296875)
+TexAtlas_RegisterMatTransform('tex_143', 'tex_atlas_low1', 0.28515625,0.76=
171875,0.34765625,0.79296875)
+TexAtlas_RegisterMatTransform('tex_152', 'tex_atlas_low1', 0.35546875,0.76=
171875,0.41796875,0.79296875)
+TexAtlas_RegisterMatTransform('tex_161', 'tex_atlas_low1', 0.42578125,0.76=
171875,0.48828125,0.79296875)
+TexAtlas_RegisterMatTransform('tex_126', 'tex_atlas_low1', 0.49609375,0.76=
171875,0.55859375,0.79296875)
+TexAtlas_RegisterMatTransform('tex_169', 'tex_atlas_low1', 0.56640625,0.76=
171875,0.62890625,0.79296875)
+TexAtlas_RegisterMatTransform('tex_170', 'tex_atlas_low1', 0.63671875,0.76=
171875,0.69921875,0.79296875)
+TexAtlas_RegisterMatTransform('tex_251', 'tex_atlas_low1', 0.70703125,0.76=
171875,0.76953125,0.79296875)
+TexAtlas_RegisterMatTransform('tex_135', 'tex_atlas_low1', 0.77734375,0.76=
171875,0.83984375,0.79296875)
+TexAtlas_RegisterMatTransform('tex_572', 'tex_atlas_low1', 0.84765625,0.76=
171875,0.91015625,0.79296875)
+TexAtlas_RegisterMatTransform('tex_144', 'tex_atlas_low1', 0.91796875,0.76=
171875,0.98046875,0.79296875)
+TexAtlas_RegisterMatTransform('tex_110', 'tex_atlas_low1', 0.00390625,0.80=
078125,0.06640625,0.83203125)
+TexAtlas_RegisterMatTransform('tex_162', 'tex_atlas_low1', 0.07421875,0.80=
078125,0.13671875,0.83203125)
+TexAtlas_RegisterMatTransform('tex_127', 'tex_atlas_low1', 0.14453125,0.80=
078125,0.20703125,0.83203125)
 TexAtlas_RegisterMatTransform('tex_174', 'tex_atlas_low1', 0.00390625,0.83=
984375,0.06640625,0.85546875)
 TexAtlas_RegisterMatTransform('tex_247', 'tex_atlas_low1', 0.07421875,0.83=
984375,0.13671875,0.85546875)
 TexAtlas_RegisterMatTransform('tex_21', 'tex_atlas_low1', 0.14453125,0.839=
84375,0.20703125,0.85546875)

Modified: trunk/data/models/atlas/tex_atlas_low1.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/atlas/tex_atlas_med.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_med.lua (original)
+++ trunk/data/models/atlas/tex_atlas_med.lua Fri Apr  4 13:24:43 2008
@@ -153,38 +153,41 @@
 TexAtlas_RegisterMatTransform('tex_404', 'tex_atlas_med2', 0.001953125,0.2=
63671875,0.126953125,0.388671875)
 TexAtlas_RegisterMatTransform('tex_482', 'tex_atlas_med2', 0.130859375,0.2=
63671875,0.255859375,0.388671875)
 TexAtlas_RegisterMatTransform('tex_24', 'tex_atlas_med2', 0.259765625,0.26=
3671875,0.322265625,0.388671875)
-TexAtlas_RegisterMatTransform('tex_7', 'tex_atlas_med2', 0.326171875,0.263=
671875,0.451171875,0.388671875)
-TexAtlas_RegisterMatTransform('tex_413', 'tex_atlas_med2', 0.455078125,0.2=
63671875,0.580078125,0.388671875)
-TexAtlas_RegisterMatTransform('tex_537', 'tex_atlas_med2', 0.583984375,0.2=
63671875,0.708984375,0.388671875)
-TexAtlas_RegisterMatTransform('tex_456', 'tex_atlas_med2', 0.712890625,0.2=
63671875,0.837890625,0.388671875)
-TexAtlas_RegisterMatTransform('tex_375', 'tex_atlas_med2', 0.841796875,0.2=
63671875,0.904296875,0.388671875)
-TexAtlas_RegisterMatTransform('tex_178', 'tex_atlas_med2', 0.908203125,0.2=
63671875,0.970703125,0.388671875)
-TexAtlas_RegisterMatTransform('tex_101', 'tex_atlas_med2', 0.001953125,0.3=
92578125,0.033203125,0.517578125)
-TexAtlas_RegisterMatTransform('tex_422', 'tex_atlas_med2', 0.037109375,0.3=
92578125,0.162109375,0.517578125)
-TexAtlas_RegisterMatTransform('tex_341', 'tex_atlas_med2', 0.166015625,0.3=
92578125,0.291015625,0.517578125)
-TexAtlas_RegisterMatTransform('tex_109', 'tex_atlas_med2', 0.294921875,0.3=
92578125,0.357421875,0.517578125)
-TexAtlas_RegisterMatTransform('tex_546', 'tex_atlas_med2', 0.361328125,0.3=
92578125,0.486328125,0.517578125)
-TexAtlas_RegisterMatTransform('tex_349', 'tex_atlas_med2', 0.490234375,0.3=
92578125,0.615234375,0.517578125)
-TexAtlas_RegisterMatTransform('tex_268', 'tex_atlas_med2', 0.619140625,0.3=
92578125,0.744140625,0.517578125)
-TexAtlas_RegisterMatTransform('tex_42', 'tex_atlas_med2', 0.748046875,0.39=
2578125,0.810546875,0.517578125)
-TexAtlas_RegisterMatTransform('tex_512', 'tex_atlas_med2', 0.814453125,0.3=
92578125,0.939453125,0.517578125)
-TexAtlas_RegisterMatTransform('tex_350', 'tex_atlas_med2', 0.001953125,0.5=
21484375,0.126953125,0.646484375)
-TexAtlas_RegisterMatTransform('tex_118', 'tex_atlas_med2', 0.130859375,0.5=
21484375,0.255859375,0.646484375)
-TexAtlas_RegisterMatTransform('tex_277', 'tex_atlas_med2', 0.259765625,0.5=
21484375,0.384765625,0.646484375)
-TexAtlas_RegisterMatTransform('tex_51', 'tex_atlas_med2', 0.388671875,0.52=
1484375,0.451171875,0.646484375)
-TexAtlas_RegisterMatTransform('tex_16', 'tex_atlas_med2', 0.455078125,0.52=
1484375,0.580078125,0.646484375)
-TexAtlas_RegisterMatTransform('tex_mud', 'tex_atlas_med2', 0.583984375,0.5=
21484375,0.708984375,0.646484375)
-TexAtlas_RegisterMatTransform('tex_405', 'tex_atlas_med2', 0.712890625,0.5=
21484375,0.837890625,0.646484375)
-TexAtlas_RegisterMatTransform('tex_5351', 'tex_atlas_med2', 0.841796875,0.=
521484375,0.966796875,0.646484375)
-TexAtlas_RegisterMatTransform('tex_5634', 'tex_atlas_med2', 0.001953125,0.=
650390625,0.126953125,0.775390625)
-TexAtlas_RegisterMatTransform('tex_mushroom', 'tex_atlas_med2', 0.13085937=
5,0.650390625,0.255859375,0.775390625)
-TexAtlas_RegisterMatTransform('tex_mushroom2', 'tex_atlas_med2', 0.2597656=
25,0.650390625,0.384765625,0.775390625)
-TexAtlas_RegisterMatTransform('tex_slidingdoor', 'tex_atlas_med2', 0.38867=
1875,0.650390625,0.513671875,0.775390625)
-TexAtlas_RegisterMatTransform('tex_lantern', 'tex_atlas_med2', 0.517578125=
,0.650390625,0.642578125,0.775390625)
-TexAtlas_RegisterMatTransform('tex_stoneplate', 'tex_atlas_med2', 0.646484=
375,0.650390625,0.771484375,0.775390625)
-TexAtlas_RegisterMatTransform('tex_marblewall', 'tex_atlas_med2', 0.775390=
625,0.650390625,0.900390625,0.775390625)
-TexAtlas_RegisterMatTransform('tex_sattel', 'tex_atlas_med2', 0.001953125,=
0.779296875,0.126953125,0.904296875)
-TexAtlas_RegisterMatTransform('tex_portrait', 'tex_atlas_med2', 0.13085937=
5,0.779296875,0.255859375,0.904296875)
+TexAtlas_RegisterMatTransform('tex_palmbark', 'tex_atlas_med2', 0.32617187=
5,0.263671875,0.451171875,0.388671875)
+TexAtlas_RegisterMatTransform('tex_7', 'tex_atlas_med2', 0.455078125,0.263=
671875,0.580078125,0.388671875)
+TexAtlas_RegisterMatTransform('tex_413', 'tex_atlas_med2', 0.583984375,0.2=
63671875,0.708984375,0.388671875)
+TexAtlas_RegisterMatTransform('tex_537', 'tex_atlas_med2', 0.712890625,0.2=
63671875,0.837890625,0.388671875)
+TexAtlas_RegisterMatTransform('tex_456', 'tex_atlas_med2', 0.841796875,0.2=
63671875,0.966796875,0.388671875)
+TexAtlas_RegisterMatTransform('tex_375', 'tex_atlas_med2', 0.001953125,0.3=
92578125,0.064453125,0.517578125)
+TexAtlas_RegisterMatTransform('tex_178', 'tex_atlas_med2', 0.068359375,0.3=
92578125,0.130859375,0.517578125)
+TexAtlas_RegisterMatTransform('tex_101', 'tex_atlas_med2', 0.134765625,0.3=
92578125,0.166015625,0.517578125)
+TexAtlas_RegisterMatTransform('tex_422', 'tex_atlas_med2', 0.169921875,0.3=
92578125,0.294921875,0.517578125)
+TexAtlas_RegisterMatTransform('tex_341', 'tex_atlas_med2', 0.298828125,0.3=
92578125,0.423828125,0.517578125)
+TexAtlas_RegisterMatTransform('tex_109', 'tex_atlas_med2', 0.427734375,0.3=
92578125,0.490234375,0.517578125)
+TexAtlas_RegisterMatTransform('tex_546', 'tex_atlas_med2', 0.494140625,0.3=
92578125,0.619140625,0.517578125)
+TexAtlas_RegisterMatTransform('tex_349', 'tex_atlas_med2', 0.623046875,0.3=
92578125,0.748046875,0.517578125)
+TexAtlas_RegisterMatTransform('tex_268', 'tex_atlas_med2', 0.751953125,0.3=
92578125,0.876953125,0.517578125)
+TexAtlas_RegisterMatTransform('tex_42', 'tex_atlas_med2', 0.880859375,0.39=
2578125,0.943359375,0.517578125)
+TexAtlas_RegisterMatTransform('tex_512', 'tex_atlas_med2', 0.001953125,0.5=
21484375,0.126953125,0.646484375)
+TexAtlas_RegisterMatTransform('tex_350', 'tex_atlas_med2', 0.130859375,0.5=
21484375,0.255859375,0.646484375)
+TexAtlas_RegisterMatTransform('tex_118', 'tex_atlas_med2', 0.259765625,0.5=
21484375,0.384765625,0.646484375)
+TexAtlas_RegisterMatTransform('tex_277', 'tex_atlas_med2', 0.388671875,0.5=
21484375,0.513671875,0.646484375)
+TexAtlas_RegisterMatTransform('tex_51', 'tex_atlas_med2', 0.517578125,0.52=
1484375,0.580078125,0.646484375)
+TexAtlas_RegisterMatTransform('tex_16', 'tex_atlas_med2', 0.583984375,0.52=
1484375,0.708984375,0.646484375)
+TexAtlas_RegisterMatTransform('tex_mud', 'tex_atlas_med2', 0.712890625,0.5=
21484375,0.837890625,0.646484375)
+TexAtlas_RegisterMatTransform('tex_405', 'tex_atlas_med2', 0.841796875,0.5=
21484375,0.966796875,0.646484375)
+TexAtlas_RegisterMatTransform('tex_5351', 'tex_atlas_med2', 0.001953125,0.=
650390625,0.126953125,0.775390625)
+TexAtlas_RegisterMatTransform('tex_5634', 'tex_atlas_med2', 0.130859375,0.=
650390625,0.255859375,0.775390625)
+TexAtlas_RegisterMatTransform('tex_mushroom', 'tex_atlas_med2', 0.25976562=
5,0.650390625,0.384765625,0.775390625)
+TexAtlas_RegisterMatTransform('tex_mushroom2', 'tex_atlas_med2', 0.3886718=
75,0.650390625,0.513671875,0.775390625)
+TexAtlas_RegisterMatTransform('tex_slidingdoor', 'tex_atlas_med2', 0.51757=
8125,0.650390625,0.642578125,0.775390625)
+TexAtlas_RegisterMatTransform('tex_lantern', 'tex_atlas_med2', 0.646484375=
,0.650390625,0.771484375,0.775390625)
+TexAtlas_RegisterMatTransform('tex_stoneplate', 'tex_atlas_med2', 0.775390=
625,0.650390625,0.900390625,0.775390625)
+TexAtlas_RegisterMatTransform('tex_marblewall', 'tex_atlas_med2', 0.001953=
125,0.779296875,0.126953125,0.904296875)
+TexAtlas_RegisterMatTransform('tex_sattel', 'tex_atlas_med2', 0.130859375,=
0.779296875,0.255859375,0.904296875)
+TexAtlas_RegisterMatTransform('tex_portrait', 'tex_atlas_med2', 0.25976562=
5,0.779296875,0.384765625,0.904296875)
+TexAtlas_RegisterMatTransform('tex_armoire_2637', 'tex_atlas_med2', 0.3886=
71875,0.779296875,0.513671875,0.904296875)
+TexAtlas_RegisterMatTransform('tex_armoire_2639', 'tex_atlas_med2', 0.5175=
78125,0.779296875,0.642578125,0.904296875)
 TexAtlas_RegisterMatTransform('tex_483', 'tex_atlas_med2', 0.001953125,0.9=
08203125,0.126953125,0.970703125)
 TexAtlas_RegisterMatTransform('tex_564', 'tex_atlas_med2', 0.130859375,0.9=
08203125,0.255859375,0.970703125)
 TexAtlas_RegisterMatTransform('tex_367', 'tex_atlas_med2', 0.259765625,0.9=
08203125,0.322265625,0.970703125)
@@ -333,62 +336,61 @@
 TexAtlas_RegisterMatTransform('tex_194', 'tex_atlas_med3', 0.201171875,0.7=
36328125,0.263671875,0.798828125)
 TexAtlas_RegisterMatTransform('tex_159', 'tex_atlas_med3', 0.267578125,0.7=
36328125,0.392578125,0.798828125)
 TexAtlas_RegisterMatTransform('tex_399', 'tex_atlas_med3', 0.396484375,0.7=
36328125,0.458984375,0.798828125)
-TexAtlas_RegisterMatTransform('tex_403', 'tex_atlas_med3', 0.462890625,0.7=
36328125,0.587890625,0.798828125)
-TexAtlas_RegisterMatTransform('tex_241', 'tex_atlas_med3', 0.591796875,0.7=
36328125,0.654296875,0.798828125)
-TexAtlas_RegisterMatTransform('tex_322', 'tex_atlas_med3', 0.658203125,0.7=
36328125,0.720703125,0.798828125)
-TexAtlas_RegisterMatTransform('tex_206', 'tex_atlas_med3', 0.724609375,0.7=
36328125,0.787109375,0.798828125)
-TexAtlas_RegisterMatTransform('tex_125', 'tex_atlas_med3', 0.791015625,0.7=
36328125,0.916015625,0.798828125)
-TexAtlas_RegisterMatTransform('tex_168', 'tex_atlas_med3', 0.001953125,0.8=
02734375,0.126953125,0.865234375)
-TexAtlas_RegisterMatTransform('tex_23', 'tex_atlas_med3', 0.130859375,0.80=
2734375,0.255859375,0.865234375)
-TexAtlas_RegisterMatTransform('tex_331', 'tex_atlas_med3', 0.259765625,0.8=
02734375,0.322265625,0.865234375)
-TexAtlas_RegisterMatTransform('tex_134', 'tex_atlas_med3', 0.326171875,0.8=
02734375,0.451171875,0.865234375)
-TexAtlas_RegisterMatTransform('tex_215', 'tex_atlas_med3', 0.455078125,0.8=
02734375,0.517578125,0.865234375)
-TexAtlas_RegisterMatTransform('tex_571', 'tex_atlas_med3', 0.521484375,0.8=
02734375,0.646484375,0.865234375)
-TexAtlas_RegisterMatTransform('tex_339', 'tex_atlas_med3', 0.650390625,0.8=
02734375,0.712890625,0.865234375)
-TexAtlas_RegisterMatTransform('tex_258', 'tex_atlas_med3', 0.716796875,0.8=
02734375,0.779296875,0.865234375)
-TexAtlas_RegisterMatTransform('tex_340', 'tex_atlas_med3', 0.783203125,0.8=
02734375,0.845703125,0.865234375)
-TexAtlas_RegisterMatTransform('tex_143', 'tex_atlas_med3', 0.849609375,0.8=
02734375,0.974609375,0.865234375)
-TexAtlas_RegisterMatTransform('tex_224', 'tex_atlas_med3', 0.001953125,0.8=
69140625,0.064453125,0.931640625)
-TexAtlas_RegisterMatTransform('tex_305', 'tex_atlas_med3', 0.068359375,0.8=
69140625,0.130859375,0.931640625)
-TexAtlas_RegisterMatTransform('tex_464', 'tex_atlas_med3', 0.134765625,0.8=
69140625,0.197265625,0.931640625)
-TexAtlas_RegisterMatTransform('tex_186', 'tex_atlas_med3', 0.201171875,0.8=
69140625,0.263671875,0.931640625)
-TexAtlas_RegisterMatTransform('tex_152', 'tex_atlas_med3', 0.267578125,0.8=
69140625,0.392578125,0.931640625)
-TexAtlas_RegisterMatTransform('tex_233', 'tex_atlas_med3', 0.396484375,0.8=
69140625,0.458984375,0.931640625)
-TexAtlas_RegisterMatTransform('tex_314', 'tex_atlas_med3', 0.462890625,0.8=
69140625,0.525390625,0.931640625)
-TexAtlas_RegisterMatTransform('tex_195', 'tex_atlas_med3', 0.529296875,0.8=
69140625,0.591796875,0.931640625)
-TexAtlas_RegisterMatTransform('tex_161', 'tex_atlas_med3', 0.595703125,0.8=
69140625,0.720703125,0.931640625)
-TexAtlas_RegisterMatTransform('tex_242', 'tex_atlas_med3', 0.724609375,0.8=
69140625,0.787109375,0.931640625)
-TexAtlas_RegisterMatTransform('tex_323', 'tex_atlas_med3', 0.791015625,0.8=
69140625,0.853515625,0.931640625)
-TexAtlas_RegisterMatTransform('tex_207', 'tex_atlas_med3', 0.857421875,0.8=
69140625,0.919921875,0.931640625)
-TexAtlas_RegisterMatTransform('tex_126', 'tex_atlas_med3', 0.001953125,0.9=
35546875,0.126953125,0.998046875)
-TexAtlas_RegisterMatTransform('tex_366', 'tex_atlas_med3', 0.130859375,0.9=
35546875,0.193359375,0.998046875)
-TexAtlas_RegisterMatTransform('tex_169', 'tex_atlas_med3', 0.197265625,0.9=
35546875,0.322265625,0.998046875)
-TexAtlas_RegisterMatTransform('tex_332', 'tex_atlas_med3', 0.326171875,0.9=
35546875,0.388671875,0.998046875)
-TexAtlas_RegisterMatTransform('tex_170', 'tex_atlas_med3', 0.392578125,0.9=
35546875,0.517578125,0.998046875)
-TexAtlas_RegisterMatTransform('tex_251', 'tex_atlas_med3', 0.521484375,0.9=
35546875,0.646484375,0.998046875)
-TexAtlas_RegisterMatTransform('tex_135', 'tex_atlas_med3', 0.650390625,0.9=
35546875,0.775390625,0.998046875)
-TexAtlas_RegisterMatTransform('tex_216', 'tex_atlas_med3', 0.779296875,0.9=
35546875,0.841796875,0.998046875)
-TexAtlas_RegisterMatTransform('tex_572', 'tex_atlas_med3', 0.845703125,0.9=
35546875,0.970703125,0.998046875)
-TexAtlas_RegisterMatTransform('tex_259', 'tex_atlas_med4', 0.001953125,0.0=
05859375,0.064453125,0.068359375)
-TexAtlas_RegisterMatTransform('tex_33', 'tex_atlas_med4', 0.068359375,0.00=
5859375,0.130859375,0.068359375)
-TexAtlas_RegisterMatTransform('tex_260', 'tex_atlas_med4', 0.134765625,0.0=
05859375,0.197265625,0.068359375)
-TexAtlas_RegisterMatTransform('tex_144', 'tex_atlas_med4', 0.201171875,0.0=
05859375,0.326171875,0.068359375)
-TexAtlas_RegisterMatTransform('tex_225', 'tex_atlas_med4', 0.330078125,0.0=
05859375,0.392578125,0.068359375)
-TexAtlas_RegisterMatTransform('tex_306', 'tex_atlas_med4', 0.396484375,0.0=
05859375,0.458984375,0.068359375)
-TexAtlas_RegisterMatTransform('tex_465', 'tex_atlas_med4', 0.462890625,0.0=
05859375,0.525390625,0.068359375)
-TexAtlas_RegisterMatTransform('tex_187', 'tex_atlas_med4', 0.529296875,0.0=
05859375,0.591796875,0.068359375)
-TexAtlas_RegisterMatTransform('tex_110', 'tex_atlas_med4', 0.595703125,0.0=
05859375,0.720703125,0.068359375)
-TexAtlas_RegisterMatTransform('tex_234', 'tex_atlas_med4', 0.724609375,0.0=
05859375,0.787109375,0.068359375)
-TexAtlas_RegisterMatTransform('tex_315', 'tex_atlas_med4', 0.791015625,0.0=
05859375,0.853515625,0.068359375)
-TexAtlas_RegisterMatTransform('tex_555', 'tex_atlas_med4', 0.857421875,0.0=
05859375,0.919921875,0.068359375)
-TexAtlas_RegisterMatTransform('tex_474', 'tex_atlas_med4', 0.923828125,0.0=
05859375,0.986328125,0.068359375)
-TexAtlas_RegisterMatTransform('tex_196', 'tex_atlas_med4', 0.001953125,0.0=
72265625,0.064453125,0.134765625)
-TexAtlas_RegisterMatTransform('tex_200', 'tex_atlas_med4', 0.068359375,0.0=
72265625,0.130859375,0.134765625)
-TexAtlas_RegisterMatTransform('tex_162', 'tex_atlas_med4', 0.134765625,0.0=
72265625,0.259765625,0.134765625)
-TexAtlas_RegisterMatTransform('tex_243', 'tex_atlas_med4', 0.263671875,0.0=
72265625,0.326171875,0.134765625)
-TexAtlas_RegisterMatTransform('tex_324', 'tex_atlas_med4', 0.330078125,0.0=
72265625,0.392578125,0.134765625)
-TexAtlas_RegisterMatTransform('tex_208', 'tex_atlas_med4', 0.396484375,0.0=
72265625,0.458984375,0.134765625)
-TexAtlas_RegisterMatTransform('tex_127', 'tex_atlas_med4', 0.462890625,0.0=
72265625,0.587890625,0.134765625)
+TexAtlas_RegisterMatTransform('tex_241', 'tex_atlas_med3', 0.462890625,0.7=
36328125,0.525390625,0.798828125)
+TexAtlas_RegisterMatTransform('tex_322', 'tex_atlas_med3', 0.529296875,0.7=
36328125,0.591796875,0.798828125)
+TexAtlas_RegisterMatTransform('tex_206', 'tex_atlas_med3', 0.595703125,0.7=
36328125,0.658203125,0.798828125)
+TexAtlas_RegisterMatTransform('tex_125', 'tex_atlas_med3', 0.662109375,0.7=
36328125,0.787109375,0.798828125)
+TexAtlas_RegisterMatTransform('tex_168', 'tex_atlas_med3', 0.791015625,0.7=
36328125,0.916015625,0.798828125)
+TexAtlas_RegisterMatTransform('tex_23', 'tex_atlas_med3', 0.001953125,0.80=
2734375,0.126953125,0.865234375)
+TexAtlas_RegisterMatTransform('tex_331', 'tex_atlas_med3', 0.130859375,0.8=
02734375,0.193359375,0.865234375)
+TexAtlas_RegisterMatTransform('tex_134', 'tex_atlas_med3', 0.197265625,0.8=
02734375,0.322265625,0.865234375)
+TexAtlas_RegisterMatTransform('tex_215', 'tex_atlas_med3', 0.326171875,0.8=
02734375,0.388671875,0.865234375)
+TexAtlas_RegisterMatTransform('tex_571', 'tex_atlas_med3', 0.392578125,0.8=
02734375,0.517578125,0.865234375)
+TexAtlas_RegisterMatTransform('tex_339', 'tex_atlas_med3', 0.521484375,0.8=
02734375,0.583984375,0.865234375)
+TexAtlas_RegisterMatTransform('tex_258', 'tex_atlas_med3', 0.587890625,0.8=
02734375,0.650390625,0.865234375)
+TexAtlas_RegisterMatTransform('tex_340', 'tex_atlas_med3', 0.654296875,0.8=
02734375,0.716796875,0.865234375)
+TexAtlas_RegisterMatTransform('tex_143', 'tex_atlas_med3', 0.720703125,0.8=
02734375,0.845703125,0.865234375)
+TexAtlas_RegisterMatTransform('tex_224', 'tex_atlas_med3', 0.849609375,0.8=
02734375,0.912109375,0.865234375)
+TexAtlas_RegisterMatTransform('tex_305', 'tex_atlas_med3', 0.916015625,0.8=
02734375,0.978515625,0.865234375)
+TexAtlas_RegisterMatTransform('tex_464', 'tex_atlas_med3', 0.001953125,0.8=
69140625,0.064453125,0.931640625)
+TexAtlas_RegisterMatTransform('tex_186', 'tex_atlas_med3', 0.068359375,0.8=
69140625,0.130859375,0.931640625)
+TexAtlas_RegisterMatTransform('tex_152', 'tex_atlas_med3', 0.134765625,0.8=
69140625,0.259765625,0.931640625)
+TexAtlas_RegisterMatTransform('tex_233', 'tex_atlas_med3', 0.263671875,0.8=
69140625,0.326171875,0.931640625)
+TexAtlas_RegisterMatTransform('tex_314', 'tex_atlas_med3', 0.330078125,0.8=
69140625,0.392578125,0.931640625)
+TexAtlas_RegisterMatTransform('tex_195', 'tex_atlas_med3', 0.396484375,0.8=
69140625,0.458984375,0.931640625)
+TexAtlas_RegisterMatTransform('tex_161', 'tex_atlas_med3', 0.462890625,0.8=
69140625,0.587890625,0.931640625)
+TexAtlas_RegisterMatTransform('tex_242', 'tex_atlas_med3', 0.591796875,0.8=
69140625,0.654296875,0.931640625)
+TexAtlas_RegisterMatTransform('tex_323', 'tex_atlas_med3', 0.658203125,0.8=
69140625,0.720703125,0.931640625)
+TexAtlas_RegisterMatTransform('tex_207', 'tex_atlas_med3', 0.724609375,0.8=
69140625,0.787109375,0.931640625)
+TexAtlas_RegisterMatTransform('tex_126', 'tex_atlas_med3', 0.791015625,0.8=
69140625,0.916015625,0.931640625)
+TexAtlas_RegisterMatTransform('tex_366', 'tex_atlas_med3', 0.919921875,0.8=
69140625,0.982421875,0.931640625)
+TexAtlas_RegisterMatTransform('tex_169', 'tex_atlas_med3', 0.001953125,0.9=
35546875,0.126953125,0.998046875)
+TexAtlas_RegisterMatTransform('tex_332', 'tex_atlas_med3', 0.130859375,0.9=
35546875,0.193359375,0.998046875)
+TexAtlas_RegisterMatTransform('tex_170', 'tex_atlas_med3', 0.197265625,0.9=
35546875,0.322265625,0.998046875)
+TexAtlas_RegisterMatTransform('tex_251', 'tex_atlas_med3', 0.326171875,0.9=
35546875,0.451171875,0.998046875)
+TexAtlas_RegisterMatTransform('tex_135', 'tex_atlas_med3', 0.455078125,0.9=
35546875,0.580078125,0.998046875)
+TexAtlas_RegisterMatTransform('tex_216', 'tex_atlas_med3', 0.583984375,0.9=
35546875,0.646484375,0.998046875)
+TexAtlas_RegisterMatTransform('tex_572', 'tex_atlas_med3', 0.650390625,0.9=
35546875,0.775390625,0.998046875)
+TexAtlas_RegisterMatTransform('tex_259', 'tex_atlas_med3', 0.779296875,0.9=
35546875,0.841796875,0.998046875)
+TexAtlas_RegisterMatTransform('tex_33', 'tex_atlas_med3', 0.845703125,0.93=
5546875,0.908203125,0.998046875)
+TexAtlas_RegisterMatTransform('tex_260', 'tex_atlas_med3', 0.912109375,0.9=
35546875,0.974609375,0.998046875)
+TexAtlas_RegisterMatTransform('tex_144', 'tex_atlas_med4', 0.001953125,0.0=
05859375,0.126953125,0.068359375)
+TexAtlas_RegisterMatTransform('tex_225', 'tex_atlas_med4', 0.130859375,0.0=
05859375,0.193359375,0.068359375)
+TexAtlas_RegisterMatTransform('tex_306', 'tex_atlas_med4', 0.197265625,0.0=
05859375,0.259765625,0.068359375)
+TexAtlas_RegisterMatTransform('tex_465', 'tex_atlas_med4', 0.263671875,0.0=
05859375,0.326171875,0.068359375)
+TexAtlas_RegisterMatTransform('tex_187', 'tex_atlas_med4', 0.330078125,0.0=
05859375,0.392578125,0.068359375)
+TexAtlas_RegisterMatTransform('tex_110', 'tex_atlas_med4', 0.396484375,0.0=
05859375,0.521484375,0.068359375)
+TexAtlas_RegisterMatTransform('tex_234', 'tex_atlas_med4', 0.525390625,0.0=
05859375,0.587890625,0.068359375)
+TexAtlas_RegisterMatTransform('tex_315', 'tex_atlas_med4', 0.591796875,0.0=
05859375,0.654296875,0.068359375)
+TexAtlas_RegisterMatTransform('tex_555', 'tex_atlas_med4', 0.658203125,0.0=
05859375,0.720703125,0.068359375)
+TexAtlas_RegisterMatTransform('tex_474', 'tex_atlas_med4', 0.724609375,0.0=
05859375,0.787109375,0.068359375)
+TexAtlas_RegisterMatTransform('tex_196', 'tex_atlas_med4', 0.791015625,0.0=
05859375,0.853515625,0.068359375)
+TexAtlas_RegisterMatTransform('tex_200', 'tex_atlas_med4', 0.857421875,0.0=
05859375,0.919921875,0.068359375)
+TexAtlas_RegisterMatTransform('tex_162', 'tex_atlas_med4', 0.001953125,0.0=
72265625,0.126953125,0.134765625)
+TexAtlas_RegisterMatTransform('tex_243', 'tex_atlas_med4', 0.130859375,0.0=
72265625,0.193359375,0.134765625)
+TexAtlas_RegisterMatTransform('tex_324', 'tex_atlas_med4', 0.197265625,0.0=
72265625,0.259765625,0.134765625)
+TexAtlas_RegisterMatTransform('tex_208', 'tex_atlas_med4', 0.263671875,0.0=
72265625,0.326171875,0.134765625)
+TexAtlas_RegisterMatTransform('tex_127', 'tex_atlas_med4', 0.330078125,0.0=
72265625,0.455078125,0.134765625)
 TexAtlas_RegisterMatTransform('tex_25', 'tex_atlas_med4', 0.001953125,0.13=
8671875,0.064453125,0.169921875)
 TexAtlas_RegisterMatTransform('tex_492', 'tex_atlas_med4', 0.068359375,0.1=
38671875,0.099609375,0.169921875)
 TexAtlas_RegisterMatTransform('tex_394', 'tex_atlas_med4', 0.103515625,0.1=
38671875,0.134765625,0.169921875)

Modified: trunk/data/models/atlas/tex_atlas_med.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_med.material (original)
+++ trunk/data/models/atlas/tex_atlas_med.material Fri Apr  4 13:24:43 2008
@@ -6,7 +6,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med0.png =

+				texture tex_atlas_med0.dds =

 			}	=

 		}
 	} =

@@ -19,7 +19,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med1.png =

+				texture tex_atlas_med1.dds =

 			}	=

 		}
 	} =

@@ -32,7 +32,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med2.png =

+				texture tex_atlas_med2.dds =

 			}	=

 		}
 	} =

@@ -45,7 +45,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med3.png =

+				texture tex_atlas_med3.dds =

 			}	=

 		}
 	} =

@@ -58,7 +58,7 @@
 		{		=

 			texture_unit =

 			{ =

-				texture tex_atlas_med4.png =

+				texture tex_atlas_med4.dds =

 			}	=

 		}
 	} =


Modified: trunk/data/models/atlas/tex_atlas_med2.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/atlas/tex_atlas_med3.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/atlas/tex_atlas_med4.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/atlas/tex_atlas_ultralow.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/atlas/tex_atlas_ultralow.lua (original)
+++ trunk/data/models/atlas/tex_atlas_ultralow.lua Fri Apr  4 13:24:43 2008
@@ -298,59 +298,62 @@
 TexAtlas_RegisterMatTransform('tex_482', 'tex_atlas_ultralow0', 0.91796875=
,0.5703125,0.94921875,0.6015625)
 TexAtlas_RegisterMatTransform('tex_366', 'tex_atlas_ultralow0', 0.0078125,=
0.6171875,0.0390625,0.6484375)
 TexAtlas_RegisterMatTransform('tex_24', 'tex_atlas_ultralow0', 0.0546875,0=
.6171875,0.0703125,0.6484375)
-TexAtlas_RegisterMatTransform('tex_7', 'tex_atlas_ultralow0', 0.0859375,0.=
6171875,0.1171875,0.6484375)
-TexAtlas_RegisterMatTransform('tex_413', 'tex_atlas_ultralow0', 0.1328125,=
0.6171875,0.1640625,0.6484375)
-TexAtlas_RegisterMatTransform('tex_332', 'tex_atlas_ultralow0', 0.1796875,=
0.6171875,0.2109375,0.6484375)
-TexAtlas_RegisterMatTransform('tex_216', 'tex_atlas_ultralow0', 0.2265625,=
0.6171875,0.2578125,0.6484375)
-TexAtlas_RegisterMatTransform('tex_491', 'tex_atlas_ultralow0', 0.2734375,=
0.6171875,0.3046875,0.6484375)
-TexAtlas_RegisterMatTransform('tex_537', 'tex_atlas_ultralow0', 0.3203125,=
0.6171875,0.3515625,0.6484375)
-TexAtlas_RegisterMatTransform('tex_456', 'tex_atlas_ultralow0', 0.3671875,=
0.6171875,0.3984375,0.6484375)
-TexAtlas_RegisterMatTransform('tex_375', 'tex_atlas_ultralow0', 0.4140625,=
0.6171875,0.4296875,0.6484375)
-TexAtlas_RegisterMatTransform('tex_178', 'tex_atlas_ultralow0', 0.4453125,=
0.6171875,0.4609375,0.6484375)
-TexAtlas_RegisterMatTransform('tex_259', 'tex_atlas_ultralow0', 0.4765625,=
0.6171875,0.5078125,0.6484375)
-TexAtlas_RegisterMatTransform('tex_33', 'tex_atlas_ultralow0', 0.5234375,0=
.6171875,0.5546875,0.6484375)
-TexAtlas_RegisterMatTransform('tex_101', 'tex_atlas_ultralow0', 0.5703125,=
0.6171875,0.578125,0.6484375)
-TexAtlas_RegisterMatTransform('tex_422', 'tex_atlas_ultralow0', 0.59375,0.=
6171875,0.625,0.6484375)
-TexAtlas_RegisterMatTransform('tex_341', 'tex_atlas_ultralow0', 0.640625,0=
.6171875,0.671875,0.6484375)
-TexAtlas_RegisterMatTransform('tex_260', 'tex_atlas_ultralow0', 0.6875,0.6=
171875,0.71875,0.6484375)
-TexAtlas_RegisterMatTransform('tex_225', 'tex_atlas_ultralow0', 0.734375,0=
.6171875,0.765625,0.6484375)
-TexAtlas_RegisterMatTransform('tex_306', 'tex_atlas_ultralow0', 0.78125,0.=
6171875,0.8125,0.6484375)
-TexAtlas_RegisterMatTransform('tex_109', 'tex_atlas_ultralow0', 0.828125,0=
.6171875,0.84375,0.6484375)
-TexAtlas_RegisterMatTransform('tex_546', 'tex_atlas_ultralow0', 0.859375,0=
.6171875,0.890625,0.6484375)
-TexAtlas_RegisterMatTransform('tex_465', 'tex_atlas_ultralow0', 0.90625,0.=
6171875,0.9375,0.6484375)
-TexAtlas_RegisterMatTransform('tex_349', 'tex_atlas_ultralow0', 0.953125,0=
.6171875,0.984375,0.6484375)
-TexAtlas_RegisterMatTransform('tex_187', 'tex_atlas_ultralow0', 0.0078125,=
0.6640625,0.0390625,0.6953125)
-TexAtlas_RegisterMatTransform('tex_268', 'tex_atlas_ultralow0', 0.0546875,=
0.6640625,0.0859375,0.6953125)
-TexAtlas_RegisterMatTransform('tex_42', 'tex_atlas_ultralow0', 0.1015625,0=
.6640625,0.1171875,0.6953125)
-TexAtlas_RegisterMatTransform('tex_512', 'tex_atlas_ultralow0', 0.1328125,=
0.6640625,0.1640625,0.6953125)
-TexAtlas_RegisterMatTransform('tex_350', 'tex_atlas_ultralow0', 0.1796875,=
0.6640625,0.2109375,0.6953125)
-TexAtlas_RegisterMatTransform('tex_234', 'tex_atlas_ultralow0', 0.2265625,=
0.6640625,0.2578125,0.6953125)
-TexAtlas_RegisterMatTransform('tex_315', 'tex_atlas_ultralow0', 0.2734375,=
0.6640625,0.3046875,0.6953125)
-TexAtlas_RegisterMatTransform('tex_118', 'tex_atlas_ultralow0', 0.3203125,=
0.6640625,0.3515625,0.6953125)
-TexAtlas_RegisterMatTransform('tex_555', 'tex_atlas_ultralow0', 0.3671875,=
0.6640625,0.3984375,0.6953125)
-TexAtlas_RegisterMatTransform('tex_474', 'tex_atlas_ultralow0', 0.4140625,=
0.6640625,0.4453125,0.6953125)
-TexAtlas_RegisterMatTransform('tex_393', 'tex_atlas_ultralow0', 0.4609375,=
0.6640625,0.4921875,0.6953125)
-TexAtlas_RegisterMatTransform('tex_196', 'tex_atlas_ultralow0', 0.5078125,=
0.6640625,0.5390625,0.6953125)
-TexAtlas_RegisterMatTransform('tex_277', 'tex_atlas_ultralow0', 0.5546875,=
0.6640625,0.5859375,0.6953125)
-TexAtlas_RegisterMatTransform('tex_51', 'tex_atlas_ultralow0', 0.6015625,0=
.6640625,0.6171875,0.6953125)
-TexAtlas_RegisterMatTransform('tex_16', 'tex_atlas_ultralow0', 0.6328125,0=
.6640625,0.6640625,0.6953125)
-TexAtlas_RegisterMatTransform('tex_200', 'tex_atlas_ultralow0', 0.6796875,=
0.6640625,0.7109375,0.6953125)
-TexAtlas_RegisterMatTransform('tex_mud', 'tex_atlas_ultralow0', 0.7265625,=
0.6640625,0.7578125,0.6953125)
-TexAtlas_RegisterMatTransform('tex_405', 'tex_atlas_ultralow0', 0.7734375,=
0.6640625,0.8046875,0.6953125)
-TexAtlas_RegisterMatTransform('tex_243', 'tex_atlas_ultralow0', 0.8203125,=
0.6640625,0.8515625,0.6953125)
-TexAtlas_RegisterMatTransform('tex_324', 'tex_atlas_ultralow0', 0.8671875,=
0.6640625,0.8984375,0.6953125)
-TexAtlas_RegisterMatTransform('tex_208', 'tex_atlas_ultralow0', 0.9140625,=
0.6640625,0.9453125,0.6953125)
-TexAtlas_RegisterMatTransform('tex_5351', 'tex_atlas_ultralow0', 0.9609375=
,0.6640625,0.9921875,0.6953125)
-TexAtlas_RegisterMatTransform('tex_5634', 'tex_atlas_ultralow0', 0.0078125=
,0.7109375,0.0390625,0.7421875)
-TexAtlas_RegisterMatTransform('tex_mushroom', 'tex_atlas_ultralow0', 0.054=
6875,0.7109375,0.0859375,0.7421875)
-TexAtlas_RegisterMatTransform('tex_mushroom2', 'tex_atlas_ultralow0', 0.10=
15625,0.7109375,0.1328125,0.7421875)
-TexAtlas_RegisterMatTransform('tex_slidingdoor', 'tex_atlas_ultralow0', 0.=
1484375,0.7109375,0.1796875,0.7421875)
-TexAtlas_RegisterMatTransform('tex_lantern', 'tex_atlas_ultralow0', 0.1953=
125,0.7109375,0.2265625,0.7421875)
-TexAtlas_RegisterMatTransform('tex_stoneplate', 'tex_atlas_ultralow0', 0.2=
421875,0.7109375,0.2734375,0.7421875)
-TexAtlas_RegisterMatTransform('tex_rune1', 'tex_atlas_ultralow0', 0.289062=
5,0.7109375,0.3203125,0.7421875)
-TexAtlas_RegisterMatTransform('tex_marblewall', 'tex_atlas_ultralow0', 0.3=
359375,0.7109375,0.3671875,0.7421875)
-TexAtlas_RegisterMatTransform('tex_sattel', 'tex_atlas_ultralow0', 0.38281=
25,0.7109375,0.4140625,0.7421875)
-TexAtlas_RegisterMatTransform('tex_portrait', 'tex_atlas_ultralow0', 0.429=
6875,0.7109375,0.4609375,0.7421875)
+TexAtlas_RegisterMatTransform('tex_palmbark', 'tex_atlas_ultralow0', 0.085=
9375,0.6171875,0.1171875,0.6484375)
+TexAtlas_RegisterMatTransform('tex_7', 'tex_atlas_ultralow0', 0.1328125,0.=
6171875,0.1640625,0.6484375)
+TexAtlas_RegisterMatTransform('tex_413', 'tex_atlas_ultralow0', 0.1796875,=
0.6171875,0.2109375,0.6484375)
+TexAtlas_RegisterMatTransform('tex_332', 'tex_atlas_ultralow0', 0.2265625,=
0.6171875,0.2578125,0.6484375)
+TexAtlas_RegisterMatTransform('tex_216', 'tex_atlas_ultralow0', 0.2734375,=
0.6171875,0.3046875,0.6484375)
+TexAtlas_RegisterMatTransform('tex_491', 'tex_atlas_ultralow0', 0.3203125,=
0.6171875,0.3515625,0.6484375)
+TexAtlas_RegisterMatTransform('tex_537', 'tex_atlas_ultralow0', 0.3671875,=
0.6171875,0.3984375,0.6484375)
+TexAtlas_RegisterMatTransform('tex_456', 'tex_atlas_ultralow0', 0.4140625,=
0.6171875,0.4453125,0.6484375)
+TexAtlas_RegisterMatTransform('tex_375', 'tex_atlas_ultralow0', 0.4609375,=
0.6171875,0.4765625,0.6484375)
+TexAtlas_RegisterMatTransform('tex_178', 'tex_atlas_ultralow0', 0.4921875,=
0.6171875,0.5078125,0.6484375)
+TexAtlas_RegisterMatTransform('tex_259', 'tex_atlas_ultralow0', 0.5234375,=
0.6171875,0.5546875,0.6484375)
+TexAtlas_RegisterMatTransform('tex_33', 'tex_atlas_ultralow0', 0.5703125,0=
.6171875,0.6015625,0.6484375)
+TexAtlas_RegisterMatTransform('tex_101', 'tex_atlas_ultralow0', 0.6171875,=
0.6171875,0.625,0.6484375)
+TexAtlas_RegisterMatTransform('tex_422', 'tex_atlas_ultralow0', 0.640625,0=
.6171875,0.671875,0.6484375)
+TexAtlas_RegisterMatTransform('tex_341', 'tex_atlas_ultralow0', 0.6875,0.6=
171875,0.71875,0.6484375)
+TexAtlas_RegisterMatTransform('tex_260', 'tex_atlas_ultralow0', 0.734375,0=
.6171875,0.765625,0.6484375)
+TexAtlas_RegisterMatTransform('tex_225', 'tex_atlas_ultralow0', 0.78125,0.=
6171875,0.8125,0.6484375)
+TexAtlas_RegisterMatTransform('tex_306', 'tex_atlas_ultralow0', 0.828125,0=
.6171875,0.859375,0.6484375)
+TexAtlas_RegisterMatTransform('tex_109', 'tex_atlas_ultralow0', 0.875,0.61=
71875,0.890625,0.6484375)
+TexAtlas_RegisterMatTransform('tex_546', 'tex_atlas_ultralow0', 0.90625,0.=
6171875,0.9375,0.6484375)
+TexAtlas_RegisterMatTransform('tex_465', 'tex_atlas_ultralow0', 0.953125,0=
.6171875,0.984375,0.6484375)
+TexAtlas_RegisterMatTransform('tex_349', 'tex_atlas_ultralow0', 0.0078125,=
0.6640625,0.0390625,0.6953125)
+TexAtlas_RegisterMatTransform('tex_187', 'tex_atlas_ultralow0', 0.0546875,=
0.6640625,0.0859375,0.6953125)
+TexAtlas_RegisterMatTransform('tex_268', 'tex_atlas_ultralow0', 0.1015625,=
0.6640625,0.1328125,0.6953125)
+TexAtlas_RegisterMatTransform('tex_42', 'tex_atlas_ultralow0', 0.1484375,0=
.6640625,0.1640625,0.6953125)
+TexAtlas_RegisterMatTransform('tex_512', 'tex_atlas_ultralow0', 0.1796875,=
0.6640625,0.2109375,0.6953125)
+TexAtlas_RegisterMatTransform('tex_350', 'tex_atlas_ultralow0', 0.2265625,=
0.6640625,0.2578125,0.6953125)
+TexAtlas_RegisterMatTransform('tex_234', 'tex_atlas_ultralow0', 0.2734375,=
0.6640625,0.3046875,0.6953125)
+TexAtlas_RegisterMatTransform('tex_315', 'tex_atlas_ultralow0', 0.3203125,=
0.6640625,0.3515625,0.6953125)
+TexAtlas_RegisterMatTransform('tex_118', 'tex_atlas_ultralow0', 0.3671875,=
0.6640625,0.3984375,0.6953125)
+TexAtlas_RegisterMatTransform('tex_555', 'tex_atlas_ultralow0', 0.4140625,=
0.6640625,0.4453125,0.6953125)
+TexAtlas_RegisterMatTransform('tex_474', 'tex_atlas_ultralow0', 0.4609375,=
0.6640625,0.4921875,0.6953125)
+TexAtlas_RegisterMatTransform('tex_393', 'tex_atlas_ultralow0', 0.5078125,=
0.6640625,0.5390625,0.6953125)
+TexAtlas_RegisterMatTransform('tex_196', 'tex_atlas_ultralow0', 0.5546875,=
0.6640625,0.5859375,0.6953125)
+TexAtlas_RegisterMatTransform('tex_277', 'tex_atlas_ultralow0', 0.6015625,=
0.6640625,0.6328125,0.6953125)
+TexAtlas_RegisterMatTransform('tex_51', 'tex_atlas_ultralow0', 0.6484375,0=
.6640625,0.6640625,0.6953125)
+TexAtlas_RegisterMatTransform('tex_16', 'tex_atlas_ultralow0', 0.6796875,0=
.6640625,0.7109375,0.6953125)
+TexAtlas_RegisterMatTransform('tex_200', 'tex_atlas_ultralow0', 0.7265625,=
0.6640625,0.7578125,0.6953125)
+TexAtlas_RegisterMatTransform('tex_mud', 'tex_atlas_ultralow0', 0.7734375,=
0.6640625,0.8046875,0.6953125)
+TexAtlas_RegisterMatTransform('tex_405', 'tex_atlas_ultralow0', 0.8203125,=
0.6640625,0.8515625,0.6953125)
+TexAtlas_RegisterMatTransform('tex_243', 'tex_atlas_ultralow0', 0.8671875,=
0.6640625,0.8984375,0.6953125)
+TexAtlas_RegisterMatTransform('tex_324', 'tex_atlas_ultralow0', 0.9140625,=
0.6640625,0.9453125,0.6953125)
+TexAtlas_RegisterMatTransform('tex_208', 'tex_atlas_ultralow0', 0.9609375,=
0.6640625,0.9921875,0.6953125)
+TexAtlas_RegisterMatTransform('tex_5351', 'tex_atlas_ultralow0', 0.0078125=
,0.7109375,0.0390625,0.7421875)
+TexAtlas_RegisterMatTransform('tex_5634', 'tex_atlas_ultralow0', 0.0546875=
,0.7109375,0.0859375,0.7421875)
+TexAtlas_RegisterMatTransform('tex_mushroom', 'tex_atlas_ultralow0', 0.101=
5625,0.7109375,0.1328125,0.7421875)
+TexAtlas_RegisterMatTransform('tex_mushroom2', 'tex_atlas_ultralow0', 0.14=
84375,0.7109375,0.1796875,0.7421875)
+TexAtlas_RegisterMatTransform('tex_slidingdoor', 'tex_atlas_ultralow0', 0.=
1953125,0.7109375,0.2265625,0.7421875)
+TexAtlas_RegisterMatTransform('tex_lantern', 'tex_atlas_ultralow0', 0.2421=
875,0.7109375,0.2734375,0.7421875)
+TexAtlas_RegisterMatTransform('tex_stoneplate', 'tex_atlas_ultralow0', 0.2=
890625,0.7109375,0.3203125,0.7421875)
+TexAtlas_RegisterMatTransform('tex_rune1', 'tex_atlas_ultralow0', 0.335937=
5,0.7109375,0.3671875,0.7421875)
+TexAtlas_RegisterMatTransform('tex_marblewall', 'tex_atlas_ultralow0', 0.3=
828125,0.7109375,0.4140625,0.7421875)
+TexAtlas_RegisterMatTransform('tex_sattel', 'tex_atlas_ultralow0', 0.42968=
75,0.7109375,0.4609375,0.7421875)
+TexAtlas_RegisterMatTransform('tex_portrait', 'tex_atlas_ultralow0', 0.476=
5625,0.7109375,0.5078125,0.7421875)
+TexAtlas_RegisterMatTransform('tex_armoire_2637', 'tex_atlas_ultralow0', 0=
.5234375,0.7109375,0.5546875,0.7421875)
+TexAtlas_RegisterMatTransform('tex_armoire_2639', 'tex_atlas_ultralow0', 0=
.5703125,0.7109375,0.6015625,0.7421875)
 TexAtlas_RegisterMatTransform('tex_483', 'tex_atlas_ultralow0', 0.0078125,=
0.7578125,0.0390625,0.7734375)
 TexAtlas_RegisterMatTransform('tex_564', 'tex_atlas_ultralow0', 0.0546875,=
0.7578125,0.0859375,0.7734375)
 TexAtlas_RegisterMatTransform('tex_286', 'tex_atlas_ultralow0', 0.1015625,=
0.7578125,0.1328125,0.7734375)
@@ -391,26 +394,25 @@
 TexAtlas_RegisterMatTransform('tex_133', 'tex_atlas_ultralow0', 0.7578125,=
0.7890625,0.7890625,0.8046875)
 TexAtlas_RegisterMatTransform('tex_142', 'tex_atlas_ultralow0', 0.8046875,=
0.7890625,0.8359375,0.8046875)
 TexAtlas_RegisterMatTransform('tex_159', 'tex_atlas_ultralow0', 0.8515625,=
0.7890625,0.8828125,0.8046875)
-TexAtlas_RegisterMatTransform('tex_403', 'tex_atlas_ultralow0', 0.8984375,=
0.7890625,0.9296875,0.8046875)
-TexAtlas_RegisterMatTransform('tex_125', 'tex_atlas_ultralow0', 0.9453125,=
0.7890625,0.9765625,0.8046875)
-TexAtlas_RegisterMatTransform('tex_168', 'tex_atlas_ultralow0', 0.0078125,=
0.8203125,0.0390625,0.8359375)
-TexAtlas_RegisterMatTransform('tex_23', 'tex_atlas_ultralow0', 0.0546875,0=
.8203125,0.0859375,0.8359375)
-TexAtlas_RegisterMatTransform('tex_250', 'tex_atlas_ultralow0', 0.1015625,=
0.8203125,0.1328125,0.8359375)
-TexAtlas_RegisterMatTransform('tex_134', 'tex_atlas_ultralow0', 0.1484375,=
0.8203125,0.1796875,0.8359375)
-TexAtlas_RegisterMatTransform('tex_571', 'tex_atlas_ultralow0', 0.1953125,=
0.8203125,0.2265625,0.8359375)
-TexAtlas_RegisterMatTransform('tex_143', 'tex_atlas_ultralow0', 0.2421875,=
0.8203125,0.2734375,0.8359375)
-TexAtlas_RegisterMatTransform('tex_152', 'tex_atlas_ultralow0', 0.2890625,=
0.8203125,0.3203125,0.8359375)
-TexAtlas_RegisterMatTransform('tex_161', 'tex_atlas_ultralow0', 0.3359375,=
0.8203125,0.3671875,0.8359375)
-TexAtlas_RegisterMatTransform('tex_126', 'tex_atlas_ultralow0', 0.3828125,=
0.8203125,0.4140625,0.8359375)
-TexAtlas_RegisterMatTransform('tex_169', 'tex_atlas_ultralow0', 0.4296875,=
0.8203125,0.4609375,0.8359375)
-TexAtlas_RegisterMatTransform('tex_170', 'tex_atlas_ultralow0', 0.4765625,=
0.8203125,0.5078125,0.8359375)
-TexAtlas_RegisterMatTransform('tex_251', 'tex_atlas_ultralow0', 0.5234375,=
0.8203125,0.5546875,0.8359375)
-TexAtlas_RegisterMatTransform('tex_135', 'tex_atlas_ultralow0', 0.5703125,=
0.8203125,0.6015625,0.8359375)
-TexAtlas_RegisterMatTransform('tex_572', 'tex_atlas_ultralow0', 0.6171875,=
0.8203125,0.6484375,0.8359375)
-TexAtlas_RegisterMatTransform('tex_144', 'tex_atlas_ultralow0', 0.6640625,=
0.8203125,0.6953125,0.8359375)
-TexAtlas_RegisterMatTransform('tex_110', 'tex_atlas_ultralow0', 0.7109375,=
0.8203125,0.7421875,0.8359375)
-TexAtlas_RegisterMatTransform('tex_162', 'tex_atlas_ultralow0', 0.7578125,=
0.8203125,0.7890625,0.8359375)
-TexAtlas_RegisterMatTransform('tex_127', 'tex_atlas_ultralow0', 0.8046875,=
0.8203125,0.8359375,0.8359375)
+TexAtlas_RegisterMatTransform('tex_125', 'tex_atlas_ultralow0', 0.8984375,=
0.7890625,0.9296875,0.8046875)
+TexAtlas_RegisterMatTransform('tex_168', 'tex_atlas_ultralow0', 0.9453125,=
0.7890625,0.9765625,0.8046875)
+TexAtlas_RegisterMatTransform('tex_23', 'tex_atlas_ultralow0', 0.0078125,0=
.8203125,0.0390625,0.8359375)
+TexAtlas_RegisterMatTransform('tex_250', 'tex_atlas_ultralow0', 0.0546875,=
0.8203125,0.0859375,0.8359375)
+TexAtlas_RegisterMatTransform('tex_134', 'tex_atlas_ultralow0', 0.1015625,=
0.8203125,0.1328125,0.8359375)
+TexAtlas_RegisterMatTransform('tex_571', 'tex_atlas_ultralow0', 0.1484375,=
0.8203125,0.1796875,0.8359375)
+TexAtlas_RegisterMatTransform('tex_143', 'tex_atlas_ultralow0', 0.1953125,=
0.8203125,0.2265625,0.8359375)
+TexAtlas_RegisterMatTransform('tex_152', 'tex_atlas_ultralow0', 0.2421875,=
0.8203125,0.2734375,0.8359375)
+TexAtlas_RegisterMatTransform('tex_161', 'tex_atlas_ultralow0', 0.2890625,=
0.8203125,0.3203125,0.8359375)
+TexAtlas_RegisterMatTransform('tex_126', 'tex_atlas_ultralow0', 0.3359375,=
0.8203125,0.3671875,0.8359375)
+TexAtlas_RegisterMatTransform('tex_169', 'tex_atlas_ultralow0', 0.3828125,=
0.8203125,0.4140625,0.8359375)
+TexAtlas_RegisterMatTransform('tex_170', 'tex_atlas_ultralow0', 0.4296875,=
0.8203125,0.4609375,0.8359375)
+TexAtlas_RegisterMatTransform('tex_251', 'tex_atlas_ultralow0', 0.4765625,=
0.8203125,0.5078125,0.8359375)
+TexAtlas_RegisterMatTransform('tex_135', 'tex_atlas_ultralow0', 0.5234375,=
0.8203125,0.5546875,0.8359375)
+TexAtlas_RegisterMatTransform('tex_572', 'tex_atlas_ultralow0', 0.5703125,=
0.8203125,0.6015625,0.8359375)
+TexAtlas_RegisterMatTransform('tex_144', 'tex_atlas_ultralow0', 0.6171875,=
0.8203125,0.6484375,0.8359375)
+TexAtlas_RegisterMatTransform('tex_110', 'tex_atlas_ultralow0', 0.6640625,=
0.8203125,0.6953125,0.8359375)
+TexAtlas_RegisterMatTransform('tex_162', 'tex_atlas_ultralow0', 0.7109375,=
0.8203125,0.7421875,0.8359375)
+TexAtlas_RegisterMatTransform('tex_127', 'tex_atlas_ultralow0', 0.7578125,=
0.8203125,0.7890625,0.8359375)
 TexAtlas_RegisterMatTransform('tex_174', 'tex_atlas_ultralow0', 0.0078125,=
0.8515625,0.0390625,0.859375)
 TexAtlas_RegisterMatTransform('tex_247', 'tex_atlas_ultralow0', 0.0546875,=
0.8515625,0.0859375,0.859375)
 TexAtlas_RegisterMatTransform('tex_21', 'tex_atlas_ultralow0', 0.1015625,0=
.8515625,0.1328125,0.859375)

Modified: trunk/data/models/atlas/tex_atlas_ultralow0.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/models/generate_all.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/generate_all.sh (original)
+++ trunk/data/models/models/generate_all.sh Fri Apr  4 13:24:43 2008
@@ -29,3 +29,7 @@
 mv tex_atlas_* ../atlas
 =

 rm xml.txt
+
+cd ../atlas
+./convertalltodds.sh
+

Modified: trunk/data/models/models/textures_skipped_in_atlas.txt
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/models/textures_skipped_in_atlas.txt (original)
+++ trunk/data/models/models/textures_skipped_in_atlas.txt Fri Apr  4 13:24=
:43 2008
@@ -1,3 +1,4 @@
 tex_grass
 tex_fernleaf
 tex_cedars_firneedle
+tex_403



From no-reply at zwischenwelt.org  Fri Apr  4 18:24:46 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 04 Apr 2008 16:24:46 -0000
Subject: [Iris-commit] [IRIS] r2019 -
	/trunk/data/models/models/to_003000/mdl_002241.mesh
Message-ID: <20080404162448.1F4AF1C18751@zwischenwelt.org>

Author: hagish
Date: Fri Apr  4 18:24:44 2008
New Revision: 2019

Log:
new model

Added:
    trunk/data/models/models/to_003000/mdl_002241.mesh   (with props)



From no-reply at zwischenwelt.org  Fri Apr  4 18:25:28 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 04 Apr 2008 16:25:28 -0000
Subject: [Iris-commit] [IRIS] r2020 - in /trunk/lua: filter/filter.art.lua
 lib.debugmenu.lua lib.devtool.lua
Message-ID: <20080404162529.219391C1875B@zwischenwelt.org>

Author: hagish
Date: Fri Apr  4 18:25:27 2008
New Revision: 2020

Log:
improved debug mode, f10 to adjust art position/rotation like ingame

Modified:
    trunk/lua/filter/filter.art.lua
    trunk/lua/lib.debugmenu.lua
    trunk/lua/lib.devtool.lua

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Fri Apr  4 18:25:27 2008
@@ -173,6 +173,8 @@
 gArtFilter[10757]=3D{maptoid=3D10763,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1.85,zadd=3D0}
 gArtFilter[10760]=3D{maptoid=3D10762,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1.85,zadd=3D0}
 gArtFilter[10758]=3D{maptoid=3D10764,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1.85,zadd=3D0}
+
+gArtFilter[2242]=3D{maptoid=3D2241,rotation=3D"x:0,y:0,z:-90",xadd=3D-1.9,=
yadd=3D0,zadd=3D0}
 =

 -- boats
 gArtFilter[16093]=3D{xadd=3D  0,yadd=3D  0,zadd=3D-0.4}

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Fri Apr  4 18:25:27 2008
@@ -647,14 +647,14 @@
 =

 	Client_SetSkybox("bluesky") -- cube skybox sunset darksun =

 	Renderer3D:ChangeCamMode(Renderer3D.kCamMode_Third)
-	Renderer3D.gfCamAngV =3D 0.0
+	Renderer3D.gfCamAngV =3D -0.5
 =

 	local cam =3D GetMainCam()
 	--cam:SetFOVy(gfDeg2Rad*45)
 	cam:SetNearClipDistance(0.01) -- old : 1
 	--cam:SetFarClipDistance(2000) -- ogre defaul : 100000
 	=

-	Renderer3D.gThirdPersonDist =3D 4
+	Renderer3D.gThirdPersonDist =3D 6.5
 	=

 	-- grid
 	if (true) then
@@ -664,21 +664,33 @@
 		local mygfx =3D gDebugGridGfx
 		mygfx:SetSimpleRenderable()
 		mygfx:SetMaterial("debug_grid_3D")
-		mygfx:RenderableBegin(2 + 4*9,2 + 4*9,false,false,OT_LINE_LIST)
+		mygfx:RenderableBegin(2 + 4*9 + 4,2 + 4*9 + 8,false,false,OT_LINE_LIST)
 		local x,y,z =3D -1,1,2
 		local g =3D 8
-		mygfx:RenderableVertex(0,0,0)
-		mygfx:RenderableVertex(0,0,z)
+		mygfx:RenderableVertex(0,0,0, 1,1,1,1)
+		mygfx:RenderableVertex(0,0,z, 1,1,1,1)
 		mygfx:RenderableIndex2(0,1)
 		for j=3D0,8 do =

 			local i =3D j-4
-			mygfx:RenderableVertex(i,-g,0)
-			mygfx:RenderableVertex(i, g,0)
-			mygfx:RenderableVertex(-g,i,0)
-			mygfx:RenderableVertex( g,i,0)
+			mygfx:RenderableVertex(i,-g,0, 1,1,1,1)
+			mygfx:RenderableVertex(i, g,0, 1,1,1,1)
+			mygfx:RenderableVertex(-g,i,0, 1,1,1,1)
+			mygfx:RenderableVertex( g,i,0, 1,1,1,1)
 			mygfx:RenderableIndex2(2 + 4*j + 0,2 + 4*j + 1)
 			mygfx:RenderableIndex2(2 + 4*j + 2,2 + 4*j + 3)
 		end
+
+		local i =3D 38
+		mygfx:RenderableVertex(0,0,0.01, 1,0,0,1)
+		mygfx:RenderableVertex(-1,0,0.01, 1,0,0,1)
+		mygfx:RenderableVertex(-1,1,0.01, 1,0,0,1)
+		mygfx:RenderableVertex(0,1,0.01, 1,0,0,1)
+
+		mygfx:RenderableIndex2(i + 0, i + 1)
+		mygfx:RenderableIndex2(i + 1, i + 2)
+		mygfx:RenderableIndex2(i + 2, i + 3)
+		mygfx:RenderableIndex2(i + 3, i + 0)
+
 		mygfx:RenderableEnd()
 	end
 	=

@@ -690,6 +702,8 @@
 	BindDown("escape",	function () Terminate() end)
 	Bind("wheelup",		function (state) if (not gActiveEditText) then if (state=
 > 0) then gCurrentRenderer:CamChangeZoom( 0.3) end end end)
 	Bind("wheeldown",	function (state) if (not gActiveEditText) then if (stat=
e > 0) then gCurrentRenderer:CamChangeZoom(-0.3) end end end)
+	Bind("f10",		function (state) if (not gActiveEditText) then if (state > 0=
 and gCurDebugMode =3D=3D kDebugMode_Static) then =

+		AdjustArtPositionControlDialog(gDebugMenuModelIndex) end end end)
 	Bind("c",		function (state) if (not gActiveEditText) then if (state > 0) =
then gCurrentRenderer:ChangeCamMode() end end end)
 =

 	Bind("a", function (state) if (not gActiveEditText) then if (state > 0) t=
hen =


Modified: trunk/lua/lib.devtool.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.devtool.lua (original)
+++ trunk/lua/lib.devtool.lua Fri Apr  4 18:25:27 2008
@@ -185,6 +185,14 @@
 		xadd=3Ddialog.xadd,yadd=3Ddialog.yadd,zadd=3Ddialog.zadd,
 	}
 	print("filter.art.lua","gArtFilter["..dialog.tileid.."]=3D{maptoid=3D"..o=
therid..",rotation=3D\"x:"..dialog.xrot..",y:"..dialog.yrot..",z:"..dialog.=
zrot.."\",xadd=3D"..dialog.xadd..",yadd=3D"..dialog.yadd..",zadd=3D"..dialo=
g.zadd.."}")
+	-- update filter art for this session
+	gArtFilter[dialog.tileid] =3D {maptoid=3Dotherid,rotation=3D"x:"..dialog.=
xrot..",y:"..dialog.yrot..",z:"..dialog.zrot,xadd=3Ddialog.xadd,yadd=3Ddial=
og.yadd,zadd=3Ddialog.zadd}
+	=

+	-- reload model if this is in debug mode
+	if gCurDebugMode and gCurDebugMode =3D=3D kDebugMode_Static then
+		DebugMenuShowModel()
+	end
+	=

 	-- update geometry
 	Renderer3D:RebuildMap()
 	-- update dynamics



From no-reply at zwischenwelt.org  Fri Apr  4 18:41:25 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 04 Apr 2008 16:41:25 -0000
Subject: [Iris-commit] [IRIS] r2021 -
	/trunk/data/models/models/to_003000/mdl_002228.mesh
Message-ID: <20080404164126.6BFBD1C1875B@zwischenwelt.org>

Author: hagish
Date: Fri Apr  4 18:41:23 2008
New Revision: 2021

Log:
new model

Added:
    trunk/data/models/models/to_003000/mdl_002228.mesh   (with props)



From no-reply at zwischenwelt.org  Fri Apr  4 18:41:41 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 04 Apr 2008 16:41:41 -0000
Subject: [Iris-commit] [IRIS] r2022 - /trunk/lua/filter/filter.art.lua
Message-ID: <20080404164141.CFABF1C1875B@zwischenwelt.org>

Author: hagish
Date: Fri Apr  4 18:41:39 2008
New Revision: 2022

Log:
new models

Modified:
    trunk/lua/filter/filter.art.lua

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Fri Apr  4 18:41:39 2008
@@ -72,9 +72,6 @@
 --closed
 gArtFilter[2643]=3D{maptoid=3D2639,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
 =

-
-gArtFilter[2236]=3D{maptoid=3D2237,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D0,zadd=3D0}
-gArtFilter[2239]=3D{maptoid=3D2238,rotation=3D"x:0,y:0,z:-90",xadd=3D0,yad=
d=3D0,zadd=3D0}
 =

 gArtFilter[3343]=3D{maptoid=3D3340,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
 gArtFilter[3344]=3D{maptoid=3D3342,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
@@ -175,6 +172,13 @@
 gArtFilter[10758]=3D{maptoid=3D10764,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1.85,zadd=3D0}
 =

 gArtFilter[2242]=3D{maptoid=3D2241,rotation=3D"x:0,y:0,z:-90",xadd=3D-1.9,=
yadd=3D0,zadd=3D0}
+gArtFilter[2232]=3D{maptoid=3D2237,rotation=3D"x:0,y:0,z:0",xadd=3D-1,yadd=
=3D0,zadd=3D0}
+gArtFilter[2231]=3D{maptoid=3D2237,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D0.9,zadd=3D0}
+gArtFilter[2236]=3D{maptoid=3D2237,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D0,zadd=3D0}
+gArtFilter[2239]=3D{maptoid=3D2238,rotation=3D"x:0,y:0,z:-90",xadd=3D0,yad=
d=3D0,zadd=3D0}
+gArtFilter[2227]=3D{maptoid=3D2228,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,ya=
dd=3D0,zadd=3D0}
+gArtFilter[2226]=3D{maptoid=3D2228,rotation=3D"x:0,y:0,z:-90",xadd=3D-0.1,=
yadd=3D0,zadd=3D0}
+gArtFilter[2229]=3D{maptoid=3D2228,rotation=3D"x:0,y:0,z:0",xadd=3D0,yadd=
=3D0.9,zadd=3D0}
 =

 -- boats
 gArtFilter[16093]=3D{xadd=3D  0,yadd=3D  0,zadd=3D-0.4}



From no-reply at zwischenwelt.org  Fri Apr  4 18:42:34 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 04 Apr 2008 16:42:34 -0000
Subject: [Iris-commit] [IRIS] r2023 - /rawdata/sd_pd/items.blend
Message-ID: <20080404164235.22B3B1C1875B@zwischenwelt.org>

Author: hagish
Date: Fri Apr  4 18:42:33 2008
New Revision: 2023

Log:
raw data update

Modified:
    rawdata/sd_pd/items.blend

Modified: rawdata/sd_pd/items.blend
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Sat Apr  5 03:46:47 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Apr 2008 01:46:47 -0000
Subject: [Iris-commit] [IRIS] r2024 - in /trunk:
 data/models/models/to_006000/mdl_005588.mesh lua/filter/filter.art.lua
Message-ID: <20080405014648.09F5D1C1875B@zwischenwelt.org>

Author: hagish
Date: Sat Apr  5 03:46:47 2008
New Revision: 2024

Log:
new models

Added:
    trunk/data/models/models/to_006000/mdl_005588.mesh   (with props)
Modified:
    trunk/lua/filter/filter.art.lua

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Sat Apr  5 03:46:47 2008
@@ -180,6 +180,10 @@
 gArtFilter[2226]=3D{maptoid=3D2228,rotation=3D"x:0,y:0,z:-90",xadd=3D-0.1,=
yadd=3D0,zadd=3D0}
 gArtFilter[2229]=3D{maptoid=3D2228,rotation=3D"x:0,y:0,z:0",xadd=3D0,yadd=
=3D0.9,zadd=3D0}
 =

+gArtFilter[2234]=3D{maptoid=3D2238,rotation=3D"x:0,y:0,z:0",xadd=3D0,yadd=
=3D0.9,zadd=3D0}
+gArtFilter[2235]=3D{maptoid=3D2238,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,ya=
dd=3D0,zadd=3D0}
+gArtFilter[2233]=3D{maptoid=3D2240,rotation=3D"x:0,y:0,z:180",xadd=3D-1.9,=
yadd=3D1.45,zadd=3D0}
+
 -- boats
 gArtFilter[16093]=3D{xadd=3D  0,yadd=3D  0,zadd=3D-0.4}
 gArtFilter[15962]=3D{maptoid=3D16093,rotation=3D"x:0,y:0,z:270",xadd=3D1.0=
,yadd=3D  0,zadd=3D-0.25}
@@ -229,6 +233,10 @@
 gArtFilter[3808]=3D{skip=3Dtrue}
 gArtFilter[3809]=3D{maptoid=3D3810,rotation=3D"x:0,y:0,z:-90",xadd=3D1,yad=
d=3D0,zadd=3D0}
 gArtFilter[3807]=3D{skip=3Dtrue}
+
+
+-- flags
+gArtFilter[5589]=3D{maptoid=3D5588,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D0.9,zadd=3D0}
 =

 ----------------------------------------------------------------------
 =




From no-reply at zwischenwelt.org  Sun Apr  6 01:59:18 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 05 Apr 2008 23:59:18 -0000
Subject: [Iris-commit] [IRIS] r2025 - in /trunk/data/models:
 materials/textures.material models/to_005000/mdl_004464.mesh
 models/to_005000/mdl_004472.mesh textures/tex_gravestone2.png
 textures/tex_gravestone3.png
Message-ID: <20080405235918.48E451C18749@zwischenwelt.org>

Author: hagish
Date: Sun Apr  6 01:59:17 2008
New Revision: 2025

Log:
2 new gravestones

Added:
    trunk/data/models/models/to_005000/mdl_004464.mesh   (with props)
    trunk/data/models/models/to_005000/mdl_004472.mesh   (with props)
    trunk/data/models/textures/tex_gravestone2.png   (with props)
    trunk/data/models/textures/tex_gravestone3.png   (with props)
Modified:
    trunk/data/models/materials/textures.material

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Sun Apr  6 01:59:17 2008
@@ -8338,6 +8338,34 @@
 			texture_unit =

 			{ =

 				texture tex_sattel.png =

+			}	=

+		}
+	} =

+}
+
+material tex_gravestone2 : tex_base
+{ =

+	technique =

+	{ =

+		pass =

+		{		=

+			texture_unit =

+			{ =

+				texture tex_gravestone2.png =

+			}	=

+		}
+	} =

+}
+
+material tex_gravestone3 : tex_base
+{ =

+	technique =

+	{ =

+		pass =

+		{		=

+			texture_unit =

+			{ =

+				texture tex_gravestone3.png =

 			}	=

 		}
 	} =




From no-reply at zwischenwelt.org  Sun Apr  6 02:11:00 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Apr 2008 00:11:00 -0000
Subject: [Iris-commit] [IRIS] r2026 - /trunk/lua/filter/filter.art.lua
Message-ID: <20080406010014.245F81C186F4@zwischenwelt.org>

Author: hagish
Date: Sun Apr  6 02:10:59 2008
New Revision: 2026

Log:
rotationssvn stsvn st

Modified:
    trunk/lua/filter/filter.art.lua

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Sun Apr  6 02:10:59 2008
@@ -227,6 +227,8 @@
 =

 -- gravestone & mud
 gArtFilter[3799]=3D{maptoid=3D3800,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
+
+gArtFilter[4463]=3D{maptoid=3D4464,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
 =

 gArtFilter[3806]=3D{maptoid=3D3805,rotation=3D"x:0,y:0,z:-90",xadd=3D1,yad=
d=3D0,zadd=3D0}
 =




From no-reply at zwischenwelt.org  Sun Apr  6 17:17:27 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Apr 2008 15:17:27 -0000
Subject: [Iris-commit] [IRIS] r2027 - in /trunk/data/base/ui: bar07.png
 sd_pd_enemylist_bar_bg.png sd_pd_enemylist_icon_bg.png sd_pd_unknown.png
Message-ID: <20080406151729.C7CD31C18035@zwischenwelt.org>

Author: hagish
Date: Sun Apr  6 17:17:15 2008
New Revision: 2027

Log:
enemylist gfx

Added:
    trunk/data/base/ui/bar07.png   (with props)
    trunk/data/base/ui/sd_pd_enemylist_bar_bg.png   (with props)
    trunk/data/base/ui/sd_pd_enemylist_icon_bg.png   (with props)
    trunk/data/base/ui/sd_pd_unknown.png   (with props)



From no-reply at zwischenwelt.org  Sun Apr  6 17:19:23 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Apr 2008 15:19:23 -0000
Subject: [Iris-commit] [IRIS] r2028 - in /trunk: lua/gui/gui.healthbar.lua
 lua/lib.cursor.lua lua/main.lua lua/net/net.multi.lua
 lua/obj/obj.mobile.lua plugins/hudenemylist.lua
Message-ID: <20080406151923.7885A1C18036@zwischenwelt.org>

Author: hagish
Date: Sun Apr  6 17:19:22 2008
New Revision: 2028

Log:
healthbars can now be target of target cursor (bandage on widget), simple e=
nemylist plugin added

Added:
    trunk/plugins/hudenemylist.lua
Modified:
    trunk/lua/gui/gui.healthbar.lua
    trunk/lua/lib.cursor.lua
    trunk/lua/main.lua
    trunk/lua/net/net.multi.lua
    trunk/lua/obj/obj.mobile.lua

Modified: trunk/lua/gui/gui.healthbar.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.healthbar.lua (original)
+++ trunk/lua/gui/gui.healthbar.lua Sun Apr  6 17:19:22 2008
@@ -140,7 +140,14 @@
 	-- overwrite the onMouseDown function from gumpparser
 	dialog.onMouseDown =3D function (widget,mousebutton)
 		if (mousebutton =3D=3D 2) then widget.dialog:Close() end
-		if (mousebutton =3D=3D 1) then widget.dialog:BringToFront() gui.StartMov=
eDialog(widget.dialog.rootwidget) end
+		if (mousebutton =3D=3D 1) then =

+			widget.dialog:BringToFront() =

+			if IsTargetModeActive() then =

+				CompleteTargetModeWithTargetMobile(mobile) =

+			else =

+				gui.StartMoveDialog(widget.dialog.rootwidget) =

+			end =

+		end
 	end
 =

 	local r,g,b =3D GetNotorietyColor(mobile.notoriety)
@@ -154,6 +161,10 @@
 =

 	gHealthbarDialogs[mobile.serial] =3D dialog
 =

+	if x and y then
+		if dialog.rootwidget and dialog.rootwidget.gfx then dialog.rootwidget.gf=
x:SetPos(x,y) end
+	end
+	=

 	-- if this was the player status bar, also show warmode
 	if IsPlayerMobile(mobile) then SetWarmode(gActWarmode) end	=

 end

Modified: trunk/lua/lib.cursor.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.cursor.lua (original)
+++ trunk/lua/lib.cursor.lua Sun Apr  6 17:19:22 2008
@@ -116,6 +116,11 @@
 	CleanupTargetMode()
 end
 =

+function CompleteTargetModeWithTargetMobile (mobile)
+	local hit =3D { hittype =3D kMousePickHitType_Mobile,  mobile =3D mobile }
+	CompleteTargetMode(hit)
+end
+
 function CompleteTargetMode (hitobject)
 	if (not hitobject) then
 		gCurrentRenderer:MousePick()

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sun Apr  6 17:19:22 2008
@@ -330,6 +330,8 @@
 =

 	BindGeneralKeys()
 =

+	NotifyListener("Hook_PostLoad")
+
 	StartMainMenu()
 	=

 	if (gCommandLineSwitches["-fonttest"]) then FontTest() end

Modified: trunk/lua/net/net.multi.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.multi.lua (original)
+++ trunk/lua/net/net.multi.lua Sun Apr  6 17:19:22 2008
@@ -146,7 +146,7 @@
 		local w1 =3D s0 / h1
 		local w2 =3D s0 / h2
 =

-		printf("w1=3D%.1f h1=3D%.1f  |  w2=3D%.1f h2=3D%.1f\n",w1,h1,w2,h2)
+		-- printf("w1=3D%.1f h1=3D%.1f  |  w2=3D%.1f h2=3D%.1f\n",w1,h1,w2,h2)
 =

 		local width =3D 0
 		local height =3D 0

Modified: trunk/lua/obj/obj.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.mobile.lua (original)
+++ trunk/lua/obj/obj.mobile.lua Sun Apr  6 17:19:22 2008
@@ -78,6 +78,8 @@
 	mobile.ismobile =3D true -- needed to identify type in 2d renderer and fo=
r asserts
 	mobile:UpdateFlags()
 	=

+	NotifyListener("Hook_Object_CreateMobile",mobile)
+	=

 	return mobile
 end
 =

@@ -270,6 +272,7 @@
 	self.bDestructionInProgress =3D true
 	if (self.bIsDead) then print("warning, double free mobile") return end --=
 already destroyed before
 	self:NotifyListener("Mobile_Destroy")
+	NotifyListener("Hook_Object_DestroyMobile",self)
 	=

 	-- destroy Status Gump from NPC
 	CloseHealthbar(self)



From no-reply at zwischenwelt.org  Sun Apr  6 17:39:17 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Apr 2008 15:39:17 -0000
Subject: [Iris-commit] [IRIS] r2029 - /trunk/plugins/hudenemylist.lua
Message-ID: <20080406153917.E2BC9152402A@zwischenwelt.org>

Author: hagish
Date: Sun Apr  6 17:39:16 2008
New Revision: 2029

Log:
enemylist improved

Modified:
    trunk/plugins/hudenemylist.lua

Modified: trunk/plugins/hudenemylist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/plugins/hudenemylist.lua (original)
+++ trunk/plugins/hudenemylist.lua Sun Apr  6 17:39:16 2008
@@ -1,4 +1,8 @@
 -- displays the status of a list of enemys
+-- USAGE
+-- its possible to target an entry with the uo target cursor
+-- rightclick open the mobile health bar
+
 =

 -- position of the enemylist block (icon position)
 kPlugin_HudEnemylist_X =3D -170	-- from the right border
@@ -71,6 +75,9 @@
 		else =

 			gCurrentRenderer:SelectMobile(body.serial) =

 		end =

+	end
+	bar.widget_bg.on_mouse_right_down		=3D function (widget) =

+		OpenHealthbarAtMouse(body)
 	end
 	=

 =




From no-reply at zwischenwelt.org  Sun Apr  6 17:39:38 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Apr 2008 15:39:38 -0000
Subject: [Iris-commit] [IRIS] r2030 - in /trunk/lua: gui/gui.healthbar.lua
 gui/gui.status.lua lib.uodragdrop.lua
Message-ID: <20080406153940.D4B1C1C18117@zwischenwelt.org>

Author: hagish
Date: Sun Apr  6 17:39:38 2008
New Revision: 2030

Log:
its possible to drop items on healthbars

Modified:
    trunk/lua/gui/gui.healthbar.lua
    trunk/lua/gui/gui.status.lua
    trunk/lua/lib.uodragdrop.lua

Modified: trunk/lua/gui/gui.healthbar.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.healthbar.lua (original)
+++ trunk/lua/gui/gui.healthbar.lua Sun Apr  6 17:39:38 2008
@@ -123,6 +123,14 @@
 	gHealthbarDialogs[mobile.serial] =3D nil
 end
 =

+
+-- open healdbar at mouse pos
+function OpenHealthbarAtMouse (mobile)
+	local iMouseX,iMouseY =3D GetMousePos()
+	-- -50,-30 to place the dialog beneath the mouse
+	OpenHealthbar(mobile,iMouseX - 50,iMouseY - 30)
+end
+
 -- Open Healthbar Gump
 function OpenHealthbar (mobile,x,y)
 	if mobile =3D=3D nil then return end
@@ -161,6 +169,9 @@
 =

 	gHealthbarDialogs[mobile.serial] =3D dialog
 =

+	-- store mobile serial for item drop
+	dialog.dropOnMobileSerial =3D mobile.serial
+	=

 	if x and y then
 		if dialog.rootwidget and dialog.rootwidget.gfx then dialog.rootwidget.gf=
x:SetPos(x,y) end
 	end

Modified: trunk/lua/gui/gui.status.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.status.lua (original)
+++ trunk/lua/gui/gui.status.lua Sun Apr  6 17:39:38 2008
@@ -88,6 +88,9 @@
 			gStatusAosDialog =3D nil
 		end
 		=

+		-- store mobile serial for item drop
+		dialog.dropOnMobileSerial =3D gPlayerBodySerial
+		=

 		-- overwrite the onMouseDown function from gumpparser
 		dialog.onMouseDown =3D function (widget,mousebutton)
 			if (mousebutton =3D=3D 2) then widget.dialog:Close() end

Modified: trunk/lua/lib.uodragdrop.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uodragdrop.lua (original)
+++ trunk/lua/lib.uodragdrop.lua Sun Apr  6 17:39:38 2008
@@ -363,6 +363,9 @@
 		end
 		=

 		Send_Drop_Object(item.serial,x,y,z,target)
+	elseif (dialog_under_mouse and dialog_under_mouse.dropOnMobileSerial) then
+		-- support drop of stuff onto dialogs
+		Send_Drop_Object(item.serial,x,y,z,dialog_under_mouse.dropOnMobileSerial)
 	elseif (dialog_under_mouse and dialog_under_mouse.uoSecureTrade) then
 		-- drop on secure trade container
 		local mysectrade =3D dialog_under_mouse.uoSecureTrade



From no-reply at zwischenwelt.org  Sun Apr  6 18:18:34 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Apr 2008 16:18:34 -0000
Subject: [Iris-commit] [IRIS] r2031 - /trunk/lua/gui/gui.healthbar.lua
Message-ID: <20080406161834.26B671C1872C@zwischenwelt.org>

Author: hagish
Date: Sun Apr  6 18:18:33 2008
New Revision: 2031

Log:
doubleclick on healthbar possible

Modified:
    trunk/lua/gui/gui.healthbar.lua

Modified: trunk/lua/gui/gui.healthbar.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.healthbar.lua (original)
+++ trunk/lua/gui/gui.healthbar.lua Sun Apr  6 18:18:33 2008
@@ -146,16 +146,22 @@
 					CloseHealthbar(dialog.mobile)
 				   end
 	-- overwrite the onMouseDown function from gumpparser
-	dialog.onMouseDown =3D function (widget,mousebutton)
-		if (mousebutton =3D=3D 2) then widget.dialog:Close() end
-		if (mousebutton =3D=3D 1) then =

-			widget.dialog:BringToFront() =

-			if IsTargetModeActive() then =

-				CompleteTargetModeWithTargetMobile(mobile) =

-			else =

-				gui.StartMoveDialog(widget.dialog.rootwidget) =

-			end =

-		end
+	dialog.on_mouse_left_down =3D function ()
+		print("click left")
+		dialog:BringToFront() =

+		if IsTargetModeActive() then =

+			CompleteTargetModeWithTargetMobile(mobile) =

+		else =

+			gui.StartMoveDialog(dialog.rootwidget) =

+		end =

+	end
+	dialog.on_mouse_right_down =3D function ()
+		print("click right")
+		dialog:Close()
+	end
+	dialog.on_mouse_left_click_double =3D function ()
+		print("dbl click left")
+		Send_DoubleClick(mobile.serial)
 	end
 =

 	local r,g,b =3D GetNotorietyColor(mobile.notoriety)
@@ -164,7 +170,7 @@
 		dialog.controls["npcname"].gfx:SetCharHeight(gFontGumpSize)
 		dialog.controls["npcname"].gfx:SetColour({r,g,b,1.0})
 		dialog.controls["npcname"].gfx:SetFont(gFontNameDefault)
-		dialog.controls["npcname"].gfx:SetText(mobile.name)
+		dialog.controls["npcname"].gfx:SetText(mobile.name or "unknown")
 	end
 =

 	gHealthbarDialogs[mobile.serial] =3D dialog



From no-reply at zwischenwelt.org  Sun Apr  6 18:34:01 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Apr 2008 16:34:01 -0000
Subject: [Iris-commit] [IRIS] r2032 - /trunk/plugins/hudenemylist.lua
Message-ID: <20080406163403.3174B1C1872C@zwischenwelt.org>

Author: hagish
Date: Sun Apr  6 18:34:01 2008
New Revision: 2032

Log:
removed debug

Modified:
    trunk/plugins/hudenemylist.lua

Modified: trunk/plugins/hudenemylist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/plugins/hudenemylist.lua (original)
+++ trunk/plugins/hudenemylist.lua Sun Apr  6 18:34:01 2008
@@ -385,7 +385,6 @@
 end
 =

 RegisterListener("Hook_PostLoad",function () =

-	print("STARST LIST INGABME")
 	Plugin_HudEnemylist_GlobalInit()
 =

 	local vw,vh =3D GetViewportSize()



From no-reply at zwischenwelt.org  Sun Apr  6 19:08:03 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 06 Apr 2008 17:08:03 -0000
Subject: [Iris-commit] [IRIS] r2033 - in /trunk:
 data/base/ui/sd_pd_enemy.png data/base/ui/sd_pd_good.png
 data/base/ui/sd_pd_murderer.png data/base/ui/sd_pd_neutral.png
 data/base/ui/sd_pd_unknown.png plugins/hudenemylist.lua
Message-ID: <20080406180004.1F7121C186F1@zwischenwelt.org>

Author: hagish
Date: Sun Apr  6 19:08:02 2008
New Revision: 2033

Log:
added incredibly ugly icons

Added:
    trunk/data/base/ui/sd_pd_enemy.png   (with props)
    trunk/data/base/ui/sd_pd_good.png   (with props)
    trunk/data/base/ui/sd_pd_murderer.png   (with props)
    trunk/data/base/ui/sd_pd_neutral.png   (with props)
Modified:
    trunk/data/base/ui/sd_pd_unknown.png
    trunk/plugins/hudenemylist.lua

Modified: trunk/data/base/ui/sd_pd_unknown.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/plugins/hudenemylist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/plugins/hudenemylist.lua (original)
+++ trunk/plugins/hudenemylist.lua Sun Apr  6 19:08:02 2008
@@ -62,6 +62,7 @@
 =

 	local x,y =3D Plugin_HudEnemylist_CalBarPos(index)
 	=

+	bar.last_typename =3D Plugin_GetMobileTypeName(body)
 	bar.body =3D body
 	bar.index =3D index
 			=

@@ -124,6 +125,9 @@
 		=

 		self.widget_hull.gfx:SetDimensions(self.widget_hull.w * f_hull, self.wid=
get_hull.h)
 		self.widget_shield.gfx:SetDimensions(self.widget_shield.w * f_shield, se=
lf.widget_shield.h)
+		=

+		-- typename changed so reinsert this one
+		if bar.last_typename ~=3D Plugin_GetMobileTypeName(bar.body) then table.=
insert(gPlugin_HudEnemylist_ReinsertBodys, bar.body) end
 	end
 	=

 	-- get current index
@@ -336,7 +340,10 @@
 		-- type not available so create a block
 		local index =3D Plugin_HudEnemylist_GetNextBlockIndex()
 =

-		block =3D Plugin_HudEnemylist_MakeBlock(typename,index,"sd_pd_unknown.pn=
g",{})
+		local image =3D gTypenameToIcon[typename]
+		if not image then image =3D "sd_pd_unknown.png" end
+		=

+		block =3D Plugin_HudEnemylist_MakeBlock(typename,index,image,{})
 		gPlugin_HudEnemylist_Blocks[typename] =3D block
 		=

 		-- update positions
@@ -394,15 +401,60 @@
 =

 RegisterListener("Hook_HUDStep",function ()
 	-- update all blocks
+	gPlugin_HudEnemylist_ReinsertBodys =3D {}
 	if gPlugin_HudEnemylist_Blocks then =

 		for k,v in pairs(gPlugin_HudEnemylist_Blocks) do =

 			v:Update() =

 		end =

 	end
+	=

+	-- reinsert the listed bodys, for typechange
+	for k,v in pairs(gPlugin_HudEnemylist_ReinsertBodys) do
+		Plugin_HudEnemylist_RemoveBodyFromBlocks(v) =

+		local typename =3D Plugin_GetMobileTypeName(v)
+		local block =3D Plugin_HudEnemylist_GetBlockForTypeName(typename)
+		block:InsertBody(v)
+		-- print("TYPE",typename)
+	end
 end)
 =

+--[[
+function GetNotorietyColor (n)
+	if (n =3D=3D  0) then return 0.0 , 0.0 , 0.0 end -- 0.0 =3D invalid/acros=
s server line
+	if (n =3D=3D  1) then return 0.1 , 0.1 , 1.0 end -- 1 =3D innocent (blue)
+	if (n =3D=3D  2) then return 0.0 , 1.0 , 0.0 end -- 2 =3D guilded/ally (g=
reen)
+	if (n =3D=3D  3) then return 1.0 , 1.0 , 0.3 end -- 3 =3D attackable but =
not criminal (original : gray, here : yellow)
+	if (n =3D=3D  4) then return 0.5 , 0.5 , 0.5 end -- 4 =3D criminal (gray)
+	if (n =3D=3D  5) then return 1.0 , 0.5 , 0.0 end -- 5 =3D enemy (orange)
+	if (n =3D=3D  6) then return 1.0 , 0.0 , 0.0 end -- 6 =3D murderer (red)
+	if (n =3D=3D  7) then return 1.0 , 0.0 , 1.0 end -- 7 =3D unknown use (tr=
anslucent (like 0x4000 hue)) =

+	return 0.5,0.5,0.5
+]]
+
+gNotorietyToTypename =3D {
+	[1] =3D "good",
+	[2] =3D "good",
+	[3] =3D "neutral",
+	[4] =3D "enemy",
+	[5] =3D "enemy",
+	[6] =3D "murderer",
+}
+	=

+gTypenameToIcon =3D {
+	good =3D "sd_pd_good.png",
+	neutral =3D "sd_pd_neutral.png",
+	enemy =3D "sd_pd_enemy.png",
+	murderer =3D "sd_pd_murderer.png",
+}
+	=

+function Plugin_GetMobileTypeName	(obj)
+	local n =3D obj.notoriety
+	if n and gNotorietyToTypename[n] then return gNotorietyToTypename[n] end
+	return "not_"..n
+end
+
 RegisterListener("Hook_Object_CreateMobile",function (obj)
-	local typename =3D "unknown"
+	local typename =3D Plugin_GetMobileTypeName(obj)
 	=

 	if true then --obj:GetTeamID() =3D=3D gPlugin_HudEnemylist_TeamId then
 		-- show in block



From no-reply at zwischenwelt.org  Mon Apr  7 02:12:42 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 07 Apr 2008 00:12:42 -0000
Subject: [Iris-commit] [IRIS] r2034 - in /trunk: lua/lib.3d.dynamic.lua
 lua/lib.data.lua lua/lib.loading.lua lua/lib.protocol.lua
 lua/lib.uoutils.lua lua/lib.walking2.lua lua/lib.walking3.lua lua/main.lua
 src/data_L.cpp
Message-ID: <20080407001242.92FE4153C00B@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Apr  7 02:12:41 2008
New Revision: 2034

Log:
slightly faster access to ground tiles (c++), caching for GetStaticTileType=
, GetGroundTileType, moved a few previously misplaced util functions to lua=
/lib.uoutils.lua, removed debug code from GetStaticTileType that caused slo=
wdown, still available via config : gDebugTileTypeLoaderGetStaticTileType=
=3Dtrue , worked on walking3

Added:
    trunk/lua/lib.uoutils.lua
Modified:
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.data.lua
    trunk/lua/lib.loading.lua
    trunk/lua/lib.protocol.lua
    trunk/lua/lib.walking2.lua
    trunk/lua/lib.walking3.lua
    trunk/lua/main.lua
    trunk/src/data_L.cpp

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Mon Apr  7 02:12:41 2008
@@ -127,7 +127,7 @@
 			for k,v in pairs(item.lTile) do
 				-- create part
 				iTileTypeID =3D v.artid
-				iHue =3D 0				--<- TODO: hueing is WORNG !! Every part of an multi can=
 have its own hue!
+				iHue =3D 0				--<- TODO: hueing is WRONG !! Every part of an multi can=
 have its own hue!
 =

 				-- generate absolute coords
 				iX =3D item.xloc + v.x + item.xadd

Modified: trunk/lua/lib.data.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.data.lua (original)
+++ trunk/lua/lib.data.lua Mon Apr  7 02:12:41 2008
@@ -19,17 +19,50 @@
 end
 =

 -- info on statics, dynamics, items in containers, wearables etc  (everyth=
ing except terrain)
+gStaticTileTypeCache =3D {}
 function GetStaticTileType (iTileTypeID)
 	if (not gTileTypeLoader) then return end
-	local arr =3D {}
-	arr.miFlags,arr.miWeight,arr.miQuality,arr.miUnknown,
-	arr.miUnknown1,arr.miQuantity,arr.miAnimID,arr.miUnknown2,
-	arr.miHue,arr.miUnknown3,arr.miHeight,arr.msName =3D =

+	local t =3D gStaticTileTypeCache[iTileTypeID] =

+	if (t ~=3D nil) then return t end -- already in cache
+	=

+	-- not yet in cache, readout
+	t =3D {}
+	t.miFlags,t.miWeight,t.miQuality,t.miUnknown,
+	t.miUnknown1,t.miQuantity,t.miAnimID,t.miUnknown2,
+	t.miHue,t.miUnknown3,t.miHeight,t.msName =3D =

 		gTileTypeLoader:GetStaticTileType(iTileTypeID+32*512) -- add 0x00004000,=
 below are groundtypes
-	if arr.miFlags =3D=3D nil then arr=3Dnil end
-	return arr
-end
-
+	if (t.miFlags =3D=3D nil) then =

+		t =3D false =

+	else
+		-- precalc a bit for faster access (mainly for walk code performance)
+		 =

+		t.bBridge =3D TestMask(t.miFlags,kTileDataFlag_Bridge)
+		=

+		--~ RunUO1/src/TileData.cs:153: public int CalcHeight : =

+		t.iCalcHeight =3D t.bBridge and math.floor(t.miHeight / 2) or t.miHeight
+	end
+	gStaticTileTypeCache[iTileTypeID] =3D t
+	return t
+end
+
+gGroundTileTypeCache =3D {}
+function GetGroundTileType (iTileTypeID)
+	if (not gTileTypeLoader) then return end
+	local t =3D gGroundTileTypeCache[iTileTypeID] =

+	if (t ~=3D nil) then return t end -- already in cache
+	=

+	-- not yet in cache, readout
+	t =3D {}
+	t.miFlags,t.miTexID,t.msName =3D gTileTypeLoader:GetGroundTileType(iTileT=
ypeID) -- below 0x00004000
+	if (t.miFlags =3D=3D nil) then =

+		t =3D false =

+	else
+		-- precalc a bit for faster access (mainly for walk code performance)
+		=

+	end
+	gGroundTileTypeCache[iTileTypeID] =3D t
+	return t
+end
 =

 -- art bitmask loader with caching
 gArtBitMaskCache =3D {}

Modified: trunk/lua/lib.loading.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.loading.lua (original)
+++ trunk/lua/lib.loading.lua Mon Apr  7 02:12:41 2008
@@ -147,13 +147,15 @@
 	if (gTileTypeLoaderType) then
 		LoadingProfile("init TileTypeLoader")
 		gTileTypeLoader =3D CreateTileTypeLoader(gTileTypeLoaderType,CorrectPath=
( Addfilepath(gTiledataFile) ))
-		gTileTypeLoader._GetStaticTileType =3D gTileTypeLoader.GetStaticTileType
-		gTileTypeLoader.GetStaticTileType =3D function (...)
-			local arr =3D { gTileTypeLoader._GetStaticTileType(unpack(arg)) }
-			if (not arr[1]) then =

-				print("GetStaticTileType failed", arg[2],_TRACEBACK())
+		if (gDebugTileTypeLoaderGetStaticTileType) then -- slowdown : only done =
when activated explicitly via config
+			gTileTypeLoader._GetStaticTileType =3D gTileTypeLoader.GetStaticTileType
+			gTileTypeLoader.GetStaticTileType =3D function (...)
+				local arr =3D { gTileTypeLoader._GetStaticTileType(unpack(arg)) }
+				if (not arr[1]) then =

+					print("GetStaticTileType failed", arg[2],_TRACEBACK())
+				end
+				return unpack(arr)
 			end
-			return unpack(arr)
 		end
 	end
 	=


Modified: trunk/lua/lib.protocol.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.protocol.lua (original)
+++ trunk/lua/lib.protocol.lua Mon Apr  7 02:12:41 2008
@@ -35,36 +35,6 @@
 	for k,v in pairs(gPacketType) do gPacketTypeId2Name[v.id] =3D k end
 	for k,v in pairs(gPacketType) do _G[k] =3D v.id end -- make names availab=
le as global constants, like kPacket_Account_Login_Request, needed for send=
ing
 	=

-function DirWrap (iDir) -- wraps into [0,7], also removes runflag automati=
cally, but a bit expensive for that
-	while (iDir < 0) do iDir =3D iDir + 8 end
-	while (iDir > 7) do iDir =3D iDir - 8 end
-	return iDir
-end
-
-function DirFromLocalDxDy (dx,dy) =

-	for dir=3D0,7 do if (sign(dx) =3D=3D GetDirXLocal(dir) and sign(dy) =3D=
=3D GetDirYLocal(dir)) then return dir end end
-end
-function DirFromUODxDy (dx,dy) =

-	for dir=3D0,7 do if (sign(dx) =3D=3D GetDirX(dir) and sign(dy) =3D=3D Get=
DirY(dir)) then return dir end end
-end
-
--- interpret dircode in ogre coordinate system
-function GetDirXLocal (dir) local a =3D GetDirX(dir) return (a=3D=3D0) and=
 0 or (-a) end -- prevent "-0", float supports signed zero
-function GetDirYLocal (dir) return GetDirY(dir) end
-
--- interpret dircode in uo coordinate system  uneven numbers (1,3,5,7) are=
 diagonal
-function DirIsDiagonal (dir) return dir =3D=3D 1 or dir =3D=3D 3 or dir =
=3D=3D 5 or dir =3D=3D 7 end
-function GetDirX (dir) =

-	if (dir =3D=3D 1 or dir =3D=3D 2 or dir =3D=3D 3) then return 1 -- east
-	elseif (dir =3D=3D 5 or dir =3D=3D 6 or dir =3D=3D 7) then return -1 -- w=
est
-	else return 0 end
-end
-function GetDirY (dir) =

-	if (dir =3D=3D 0 or dir =3D=3D 1 or dir =3D=3D 7) then return -1 -- north
-	elseif (dir =3D=3D 3 or dir =3D=3D 4 or dir =3D=3D 5) then return 1 -- so=
uth
-	else return 0 end
-end
-
 -- check if packets are complete and handle them
 function HandlePackets ()
 	local input =3D GetRecvFIFO()

Modified: trunk/lua/lib.walking2.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.walking2.lua (original)
+++ trunk/lua/lib.walking2.lua Mon Apr  7 02:12:41 2008
@@ -23,14 +23,6 @@
 		=

 		=

 kHex02 =3D hex2num("0x02")
-
--- returns tiletype,zloc
-function GetAbsTile (xloc,yloc) =

-	return gGroundBlockLoader:GetTile(	math.floor(xloc/8), =

-										math.floor(yloc/8), =

-										math.mod(xloc,8), =

-										math.mod(yloc,8))
-end
 =

 --Calc the average Z Value for the new Player pos (don't use this for calc=
ulations)
 function AverageGroundHeight(bx,by,tx,ty)

Modified: trunk/lua/lib.walking3.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.walking3.lua (original)
+++ trunk/lua/lib.walking3.lua Mon Apr  7 02:12:41 2008
@@ -1,4 +1,6 @@
 -- started but not yet finished walk-code : client-side collision, based o=
n RunUO1 code (used by vetus-mundus for example)
+-- TODO : walk2 : bridge =3D kTileDataFlag_StairBack or kTileDataFlag_Stai=
rRight or bridge ???
+
 =

 --[[
 replaces the old GetNearestGroundLevel, was used like
@@ -26,41 +28,159 @@
 kAlwaysIgnoreDoors			=3D false
 kIgnoreMovableImpassables	=3D false
 =

-
-function ApplyDir (dir,posx,posy) =

-	dir =3D DirWrap(dir) -- warp and remove run bit
-	return posx+GetDirX(dir),posy+GetDirY(dir)
-end =

-
-function W3_GetItemsAtPos (xloc,yloc) =

-	local res =3D {}
-	-- TODO : consider multis as well ! (serverside & clientside)
-	-- TODO : local item=3D{ItemID=3D123,Z=3D0,Movable=3Dtrue,ItemID=3D123,It=
emData=3D{Impassable=3Dfalse,Flags=3D123}}
-	-- table.insert(res,item)
-	return res
-end
-
--- returns tiletype,z
-function W3_GetGround		(xloc,yloc)	=

-	-- todo : cached access			=

-	local tiletype,z =3D gGroundBlockLoader:GetTile(xloc,yloc)
-	return tiletype,z
-end
-
-function W3_GetMobile			(irismobile)			assert(false,"TODO") return {Z=3D0,=
CanSwim=3Dfalse,CantWalk=3Dfalse,Alive=3Dtrue,Body=3D{BodyID=3D123},IsDeadB=
ondedPet=3Dfalse} end
-function W3_GetMapW				()						assert(false,"TODO") return gGroundBlockLoa=
der:GetMapW() end
-function W3_GetMapH				()						assert(false,"TODO") return gGroundBlockLoa=
der:GetMapH() end
-function W3_GetLandTile			(xloc,yloc)				assert(false,"TODO")
-	local tiletype,z =3D W3_GetGround(xloc,yloc)
-	return {ID=3Dtiletype,Ignored=3Dfalse}
-end -- ID : iTileType for W3_GetLandTypeFlags, Ignored : =

-function W3_GetStaticTiles		(xloc,yloc,bUnknown)	assert(false,"TODO") retu=
rn {{ID=3D123,Z=3D0}} end --  : W3_IsOK : check
-function W3_GetAverageZ			(xloc,yloc)				assert(false,"TODO") local landZ,=
landCenter,landTop =3D 0,0,0 return landZ,landCenter,landTop end -- min,avg=
,max of 4 vertices
-function W3_GetLandTypeFlags	(iTileType)				assert(false,"TODO") return 0 =
end -- LandTable[landTileTypeID] =

-function W3_GetTileType			(iTileType)				assert(false,"TODO") return {Flag=
s=3D0,Height=3D0,CalcHeight=3D0,Bridge=3Dfalse} end -- ItemTable[iTileType]=
 itemData
-
---~ public int CalcHeight : if ( (m_Flags & TileFlag.Bridge) !=3D 0 ) and =
math.floor(m_Height / 2) or m_Height;   RunUO1/src/TileData.cs:153:
- =

+gW3CacheBlocks =3D {}
+gW3ItemTypeFlagsCache =3D {}
+kW3CacheBlocks_MaxSqDist =3D 8*8
+
+
+function W3_GetCacheBlock (xloc,yloc)
+	local bx =3D math.floor(xloc/8) -- block
+	local by =3D math.floor(yloc/8) -- block
+	local n =3D bx..","..by
+	local b =3D gW3CacheBlocks[n]
+	if (b) then return b end
+	=

+	-- create new cacheblock
+	b =3D { bx=3Dbx,by=3Dby }
+	gW3CacheBlocks[n] =3D b
+	=

+	-- erase blocks outside maxdist
+	for k,v in pairs(gW3CacheBlocks) do
+		if (sqdist2(v.bx,v.by,bx,by) > kW3CacheBlocks_MaxSqDist) then
+			gW3CacheBlocks[k] =3D nil -- erase block from cache
+		end
+	end
+	=

+	-- init block
+	b.statics =3D {}
+	for y =3D 0,7 do for x =3D 0,7 do b.statics[x..","..y] =3D {} end end
+	=

+	-- load statics
+	gStaticBlockLoader:Load(bx,by) -- following gStaticBlockLoader commands o=
perate on this loaded block
+	local iStaticCount =3D gStaticBlockLoader:Count()
+	for i =3D 0,iStaticCount-1 do
+		local iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i)
+		local xloc,yloc =3D bx*8 + iX,by*8 + iY
+		table.insert(b.statics[xloc..","..yloc],{zloc=3DiZ,artid=3DiTileTypeID,b=
IsStatic=3Dtrue})
+	end
+	=

+	b.ground =3D {}
+	for ty =3D 0,7 do
+	for tx =3D 0,7 do
+		local xloc,yloc =3D bx*8+tx,by*8+ty
+		local iTileType,zloc =3D gGroundBlockLoader:GetTile2(xloc,yloc)  -- TODO=
 : season translation ??? iTranstile	=

+		-- RunUO1.0/src/TileMatrix.cs:600: public bool Ignored
+		local bIgnored =3D iTileTypeID =3D=3D 2 or iTileTypeID =3D=3D 0x1DB or (=
 iTileTypeID >=3D 0x1AE and iTileTypeID <=3D 0x1B5 ) =

+		b.ground[xloc..","..yloc] =3D {iTileType=3DiTileType,zloc=3Dzloc,bIgnore=
d=3DbIgnored,flags=3DGetGroundTileType(iTileType).miFlags}
+	end
+	end
+	=

+	return b
+end
+
+function W3_GetStaticTiles		(xloc,yloc)	return W3_GetCacheBlock(xloc,yloc)=
.statics[xloc..","..yloc] end =

+function W3_GetLandTile			(xloc,yloc)	return W3_GetCacheBlock(xloc,yloc).g=
round[xloc..","..yloc] end
+function W3_GetMapW				()			return gGroundBlockLoader:GetMapW() end
+function W3_GetMapH				()			return gGroundBlockLoader:GetMapH() end
+
+-- old : Movable runuo:ImplFlag.Movable , probably true for dynamic, false=
 for static    (door?)
+function W3_ItemIsMovable		(item)		return not item.bIsStatic end
+
+
+function W3_ForAllMultiPartsAtPos	(xloc,yloc,multi_item,fun,param)
+	assert(false,"TODO")
+	local mycache =3D multi.cache
+	if (not mycache) then
+		mycache =3D {}
+		multi.cache =3D mycache
+		for k,v in pairs(multi.lparts or {}) do
+			local iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
+			local myarr =3D mycache[iX..","..iY]
+			if (not myarr) then myarr =3D {}   mycache[iX..","..iY] =3D myarr end
+			table.insert(myarr,{iZ=3DiZ,iTileTypeID=3DiTileTypeID,iHue=3DiHue})
+		end
+	end
+	return mycache[xloc..","..yloc] or {}
+	-- TODO : clientside multi
+	-- TODO : serverside multi
+	--~ see also lib.3d.dynamic.lua:114:	if item.artid >=3D gMulti_ID then
+	--~ see also lib.3d.dynamic.lua:151:	multi.id =3D item.artid - gMulti_ID
+	=

+	-- TODO : consider multis as well ! (serverside & clientside)   , walk2:G=
etMultiPartsAtPos()
+	--  lua/net/net.multi.lua gMultiLoader kPacket_Generic_SubCommand_Revisio=
nCustomHouse kPacket_Target_Multi
+	--- lua/lib.3d.dynamic.lua gMultis
+	--- lua/lib.3d.map.lua:510 : multi.lparts
+	--[[ =

+			/cavern/code/iris/lua/lib.3d.dynamic.lua:114:	if item.artid >=3D gMulti=
_ID then
+			/cavern/code/iris/lua/lib.3d.dynamic.lua:151:	multi.id =3D item.artid -=
 gMulti_ID
+			/cavern/code/iris/lua/lib.3d.dynamic.lua:144:	gMultis[multi] =3D true
+			/cavern/code/iris/lua/lib.3d.dynamic.lua:184:	gMultis[multi] =3D true
+			/cavern/code/iris/lua/lib.3d.dynamic.lua:388:	gMultis[dynamic.multi] =
=3D nil =

+			/cavern/code/iris/lua/lib.3d.map.lua:497:	if (gMultis) then
+			/cavern/code/iris/lua/lib.3d.map.lua:502:	for k,v in pairs(gMultis) do
+			/cavern/code/iris/lua/lib.3d.map.lua:658:	for k,v in pairs(gMultis) do
+			=

+			for k,v in pairs(gMultis) do
+				multi =3D k
+				if multi.lparts then
+					for k,v in pairs(multi.lparts) do
+						iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
+						if	iX =3D=3D x and iY =3D=3D y  and iZ >=3D playerheadpos then
+							playerIsInside =3D true
+							if ((not zloc_roof) or (zloc_roof > iZ)) then zloc_roof =3D iZ end
+						end
+					end
+				end
+			end
+	]]--
+end
+
+-- considers statics, dynamics and multis
+function W3_ForAllItemsAtPos	(xloc,yloc,fun,param)
+	local b =3D W3_GetCacheBlock(xloc,yloc)
+	local n =3D xloc..","..yloc
+	for k,static in pairs(b.statics[n]) do fun(static,param) end
+	for k,dynamic in pairs(GetDynamicList()) do
+		if (DynamicIsInWorld(dynamic) and dynamic.artid) then
+			if (dynamic.artid >=3D gMulti_ID) then -- multi =

+				W3_ForAllMultiPartsAtPos(xloc,yloc,multi_item,fun,param)
+			elseif (dynamic.xloc =3D=3D xloc and dynamic.yloc =3D=3D yloc) then -- =
normal
+				fun(dynamic,param)
+			end
+		end
+	end
+end
+
+
+
+function W3_GetMobile			(irismobile)			assert(false,"TODO") return {zloc=
=3D0,CanSwim=3Dfalse,CantWalk=3Dfalse,Alive=3Dtrue,Body=3D{BodyID=3D123},Is=
DeadBondedPet=3Dfalse} end
+
+-- returns min,avg,max of 4 vertices
+function W3_GetAverageZ			(xloc,yloc)			=

+	-- /cavern/RunUO1.0/src/Map.cs:173:        public void GetAverageZ
+	local zTop		=3D W3_GetLandTile(xloc  ,yloc  ).zloc
+	local zLeft		=3D W3_GetLandTile(xloc  ,yloc+1).zloc
+	local zRight	=3D W3_GetLandTile(xloc+1,yloc  ).zloc
+	local zBottom	=3D W3_GetLandTile(xloc+1,yloc+1).zloc
+
+	local z,top,avg =3D zTop,zTop
+	if ( zLeft   < z ) then z =3D zLeft	end
+	if ( zRight  < z ) then z =3D zRight	end
+	if ( zBottom < z ) then z =3D zBottom	end
+
+	if ( zLeft   > top ) then top =3D zLeft	end
+	if ( zRight  > top ) then top =3D zRight	end
+	if ( zBottom > top ) then top =3D zBottom	end
+
+	if ( math.abs( zTop - zBottom ) > math.abs( zLeft - zRight) ) then
+		avg =3D math.floor( (zLeft + zRight) / 2.0 )
+	else
+		avg =3D math.floor( (zTop + zBottom) / 2.0 )
+	end
+	return z,avg,top
+end
+
+
 --- bMoveIsOk,newZ =3D CheckMovement( Mobile mobile, Point3D loc, Directio=
n d, out int newZ )
 -- see also RunUO1.0/Scripts/Engines/Pathing/Movement.cs : CheckMovement a=
nd Check
 -- TODO : see also RunUO1.0/src/Mobile.cs : Move : checks items(dynamics?)=
 and mobiles
@@ -83,14 +203,15 @@
 =

 	if ( mobile.CanSwim ) then reqFlags =3D BitwiseOR(reqFlags,kTileFlag.Wet)=
 end
 =

-	local filterItemFun =3D function (item)
-		if ( ignoreMovableImpassables and item.Movable and item.ItemData.Impassa=
ble ) then return false end
-		if ( BitwiseAND(item.ItemData.Flags,reqFlags) =3D=3D 0 ) then return fal=
se end
-		return item.ItemID < 0x4000
-	end
-	=

-	local itemsStart	=3D FilterArray(W3_GetItemsAtPos(xStart		,yStart		),filt=
erItemFun)
-	local itemsForward	=3D FilterArray(W3_GetItemsAtPos(xForward	,yForward	),=
filterItemFun)
+	local filterItemFun =3D function (item,param)
+		local flags =3D GetStaticTileTypeFlags(item.artid)
+		if (ignoreMovableImpassables and W3_ItemIsMovable(item) and TestMask(fla=
gs,kTileFlag.Impassable)) then return end
+		if (BitwiseAND(flags,reqFlags) =3D=3D 0) then return end
+		if (item.artid < 0x4000) then table.insert(param,item) end
+	end
+	=

+	local itemsStart	=3D {} W3_ForAllItemsAtPos(xStart		,yStart		,filterItemF=
un	,itemsStart)
+	local itemsForward	=3D {} W3_ForAllItemsAtPos(xForward	,yForward	,filterI=
temFun	,itemsForward)
 	local items
 	=

 	local startZ,startTop =3D W3_GetStartZ( mobile, posx,posy,posz, itemsStar=
t)
@@ -98,8 +219,8 @@
 	moveIsOk,newZ =3D W3_Check( mobile, itemsForward, xForward, yForward, sta=
rtTop, startZ, mobile.CanSwim, mobile.CantWalk)
 =

 	if ( moveIsOk and checkDiagonals ) then
-		local itemsLeft		=3D FilterArray(W3_GetItemsAtPos(xLeft	,yLeft		),filter=
ItemFun)
-		local itemsRight	=3D FilterArray(W3_GetItemsAtPos(xRight	,yRight		),filt=
erItemFun)
+		local itemsLeft		=3D {} W3_ForAllItemsAtPos(xLeft	,yLeft	,filterItemFun	=
,itemsLeft)
+		local itemsRight	=3D {} W3_ForAllItemsAtPos(xRight	,yRight	,filterItemFu=
n	,itemsRight)
 		local myok1,ignored_z =3D W3_Check( mobile, itemsLeft , xLeft , yLeft , =
startTop, startZ, mobile.CanSwim, mobile.CantWalk)
 		local myok2,ignored_z =3D W3_Check( mobile, itemsRight, xRight, yRight, =
startTop, startZ, mobile.CanSwim, mobile.CantWalk)
 		if ( (not myok1) and (not myok2) ) then  moveIsOk =3D false  end
@@ -112,30 +233,30 @@
 =

 --~ private bool IsOk( bool ignoreDoors, int ourZ, int ourTop, Tile[] tile=
s, ArrayList items )
 function W3_IsOK(  ignoreDoors,  ourZ, ourTop, tiles, items )
-	for i,check in pairs(tiles) do -- Tile  ( check.ID check.Z )
-		local itemData =3D W3_GetTileType(BitwiseAND(check.ID,0x3FFF))
-		if ( TestMask(itemData.Flags,kImpassableSurface) ) then -- Impassable or=
 Surface
-			if ( check.Z + itemData.CalcHeight > ourZ and ourTop > check.Z ) then r=
eturn false end -- intersection =

+	for i,check in pairs(tiles) do
+		local itemtype =3D GetStaticTileType(BitwiseAND(check.artid,0x3FFF))
+		if ( TestMask(itemtype.miFlags,kImpassableSurface) ) then -- Impassable =
or Surface
+			if ( check.zloc + itemtype.iCalcHeight > ourZ and ourTop > check.zloc )=
 then return false end -- intersection =

 		end
 	end
 =

 	for i,item in pairs(items) do -- Item
-		local itemID =3D BitwiseAND(item.ItemID,0x3FFF) -- int
-		local itemData =3D W3_GetTileType(itemID) -- ItemData
-		local flags =3D itemData.Flags -- TileFlag
+		local iTileTypeID =3D BitwiseAND(item.artid,0x3FFF) -- int
+		local itemtype =3D GetStaticTileType(iTileTypeID) -- ItemData
+		local flags =3D itemtype.miFlags -- TileFlag
 =

 		if (TestMask(flags,kImpassableSurface)) then -- Impassable or Surface
 			if (ignoreDoors and -- doors
 				(	TestMask(flags,kTileFlag.Door) or =

-					itemID =3D=3D 0x692 or =

-					itemID =3D=3D 0x846 or =

-					itemID =3D=3D 0x873 or =

-					(itemID >=3D 0x6F5 and itemID <=3D 0x6F6)
+					iTileTypeID =3D=3D 0x692 or =

+					iTileTypeID =3D=3D 0x846 or =

+					iTileTypeID =3D=3D 0x873 or =

+					(iTileTypeID >=3D 0x6F5 and iTileTypeID <=3D 0x6F6)
 				) ) then
 				--continue
 			else
-				local checkZ =3D item.Z -- int
-				local checkTop =3D checkZ + itemData.CalcHeight -- int
+				local checkZ =3D item.zloc -- int
+				local checkTop =3D checkZ + itemtype.iCalcHeight -- int
 =

 				if ( checkTop > ourZ and ourTop > checkZ ) then return false end
 			end
@@ -151,14 +272,13 @@
 function W3_Check(  mobile,  items,  x,  y,  startTop,  startZ,  canSwim, =
 cantWalk )
 	local newZ =3D 0
 =

-	local tiles			 =3D W3_GetStaticTiles( x, y, true ) -- Tile[]
+	local tiles			 =3D W3_GetStaticTiles( x, y ) -- Tile[]
 	local landTile		 =3D W3_GetLandTile( x, y ) -- Tile
-	local landTileTypeID =3D BitwiseAND(landTile.ID,0x3FFF)
-	local landTileFlags  =3D W3_GetLandTypeFlags(landTileTypeID)
+	local landTileFlags  =3D landTile.flags
 	local landTileIsWet	 =3D TestMask(landTileFlags,kTileFlag.Wet)
 =

 	local landBlocks =3D TestMask(landTileFlags,kTileFlag.Impassable) -- bool
-	local considerLand =3D not landTile.Ignored -- bool
+	local considerLand =3D not landTile.bIgnored -- bool
 =

 	if ( landBlocks and canSwim and landTileIsWet ) then
 		landBlocks =3D false
@@ -180,24 +300,23 @@
 	local ignoreDoors =3D ( kAlwaysIgnoreDoors or (not mobile.Alive) or mobil=
e.Body.BodyID =3D=3D 0x3DB or mobile.IsDeadBondedPet )
 =

 	for i,tile in pairs(tiles) do -- Tile
-		local itemData =3D W3_GetTileType(BitwiseAND(tile.ID,0x3FFF)) -- ItemData
-		local flags =3D itemData.Flags -- TileFlag
+		local itemtype =3D GetStaticTileType(BitwiseAND(tile.artid,0x3FFF)) -- I=
temData
+		local flags =3D itemtype.miFlags -- TileFlag
 =

 		if ( BitwiseAND(flags,kImpassableSurface) =3D=3D kTileFlag.Surface or (c=
anSwim and TestMask(flags , kTileFlag.Wet)) ) then -- Surface and (not Impa=
ssable)
 			if ( cantWalk and BitwiseAND(flags , kTileFlag.Wet) =3D=3D 0 ) then
 				--continue
 			else
 =

-				local itemZ =3D tile.Z
+				local itemZ =3D tile.zloc
 				local itemTop =3D itemZ
-				local ourZ =3D itemZ + itemData.CalcHeight
+				local ourZ =3D itemZ + itemtype.iCalcHeight
 				local ourTop =3D ourZ + kPersonHeight
 				local testTop =3D checkTop
 =

 				local bMyContinue =3D false
-				if ( moveIsOk )
-				then
-					local cmp =3D math.abs( ourZ - mobile.Z ) - math.abs( newZ - mobile.Z=
 )
+				if ( moveIsOk ) then
+					local cmp =3D math.abs( ourZ - mobile.zloc ) - math.abs( newZ - mobil=
e.zloc )
 =

 					if ( cmp > 0 or (cmp =3D=3D 0 and ourZ > newZ) ) then bMyContinue =3D=
 true end
 				end
@@ -205,15 +324,15 @@
 				if (not bMyContinue) then
 					if ( ourZ + kPersonHeight > testTop ) then testTop =3D ourZ + kPerson=
Height end
 =

-					if ( not itemData.Bridge ) then itemTop =3D itemTop + itemData.Height=
 end
+					if ( not itemtype.bBridge ) then itemTop =3D itemTop + itemtype.miHei=
ght end
 =

 					if ( stepTop >=3D itemTop ) then
 						local landCheck =3D itemZ
 =

-						if ( itemData.Height >=3D kStepHeight ) then
+						if ( itemtype.miHeight >=3D kStepHeight ) then
 							landCheck =3D landCheck + kStepHeight
 						else
-							landCheck =3D landCheck + itemData.Height
+							landCheck =3D landCheck + itemtype.miHeight
 						end
 =

 						if ( considerLand and landCheck < landCenter and landCenter > ourZ a=
nd testTop > landZ ) then
@@ -231,26 +350,24 @@
 	end
 =

 	for i,item in pairs(items) do  -- Item
-		local itemData =3D item.ItemData --W3_GetTileType(BitwiseAND(item.ItemID=
 , 0x3FFF)) ItemData
-		local flags =3D itemData.Flags -- TileFlag
-
-		if ( BitwiseAND(flags , kImpassableSurface) =3D=3D kTileFlag.Surface or =
(mobile.CanSwim and TestMask(flags , kTileFlag.Wet)) ) -- Surface and (not =
Impassable)
-		then
+		local itemtype =3D GetStaticTileType(item.artid) --GetStaticTileType(Bit=
wiseAND(item.artid , 0x3FFF)) ItemData
+		local flags =3D GetStaticTileTypeFlags(item.artid)  -- itemtype.miFlags =
 TileFlag
+
+		if ( BitwiseAND(flags , kImpassableSurface) =3D=3D kTileFlag.Surface or =
(mobile.CanSwim and TestMask(flags , kTileFlag.Wet)) ) then -- Surface and =
(not Impassable)
 			if ( cantWalk and BitwiseAND(flags , kTileFlag.Wet) =3D=3D 0 ) then
 				--~ continue
 			else
 =

-				local itemZ =3D item.Z
+				local itemZ =3D item.zloc
 				local itemTop =3D itemZ
-				local ourZ =3D itemZ + itemData.CalcHeight
+				local ourZ =3D itemZ + itemtype.iCalcHeight
 				local ourTop =3D ourZ + kPersonHeight
 				local testTop =3D checkTop
 =

 				local bMyContinue =3D false
 				=

-				if ( moveIsOk )
-				then
-					local cmp =3D math.abs( ourZ - mobile.Z ) - math.abs( newZ - mobile.Z=
 )
+				if ( moveIsOk ) then
+					local cmp =3D math.abs( ourZ - mobile.zloc ) - math.abs( newZ - mobil=
e.zloc )
 =

 					if ( cmp > 0 or (cmp =3D=3D 0 and ourZ > newZ) ) then bMyContinue =3D=
 true end
 				end
@@ -258,23 +375,21 @@
 				if (not bMyContinue) then
 					if ( ourZ + kPersonHeight > testTop ) then testTop =3D ourZ + kPerson=
Height end
 =

-					if ( not itemData.Bridge ) then itemTop =3D itemTop + itemData.Height=
 end
-
-					if ( stepTop >=3D itemTop )
-					then
+					if ( not itemtype.bBridge ) then itemTop =3D itemTop + itemtype.miHei=
ght end
+
+					if ( stepTop >=3D itemTop ) then
 						local landCheck =3D itemZ
 =

-						if ( itemData.Height >=3D kStepHeight ) then
+						if ( itemtype.miHeight >=3D kStepHeight ) then
 							landCheck =3D landCheck + kStepHeight
 						else
-							landCheck =3D landCheck + itemData.Height
+							landCheck =3D landCheck + itemtype.miHeight
 						end
 =

 						if ( considerLand and landCheck < landCenter and landCenter > ourZ a=
nd testTop > landZ ) then
 							--continue
 						else
-							if ( W3_IsOK( ignoreDoors, ourZ, testTop, tiles, items ) )
-							then
+							if ( W3_IsOK( ignoreDoors, ourZ, testTop, tiles, items ) ) then
 								newZ =3D ourZ
 								moveIsOk =3D true
 							end
@@ -285,8 +400,7 @@
 		end
 	end
 =

-	if ( considerLand and (not landBlocks) and stepTop >=3D landZ )
-	then
+	if ( considerLand and (not landBlocks) and stepTop >=3D landZ ) then
 		local ourZ =3D landCenter
 		local ourTop =3D ourZ + kPersonHeight
 		local testTop =3D checkTop
@@ -295,15 +409,12 @@
 =

 		local shouldCheck =3D true
 =

-		if ( moveIsOk )
-		then
-			local cmp =3D math.abs( ourZ - mobile.Z ) - math.abs( newZ - mobile.Z )=
 -- int
-
+		if ( moveIsOk ) then
+			local cmp =3D math.abs( ourZ - mobile.zloc ) - math.abs( newZ - mobile.=
zloc ) -- int
 			if ( cmp > 0 or (cmp =3D=3D 0 and ourZ > newZ) ) then shouldCheck =3D f=
alse end
 		end
 =

-		if ( shouldCheck and W3_IsOK( ignoreDoors, ourZ, testTop, tiles, items )=
 )
-		then
+		if ( shouldCheck and W3_IsOK( ignoreDoors, ourZ, testTop, tiles, items )=
 ) then
 			newZ =3D ourZ
 			moveIsOk =3D true
 		end
@@ -317,13 +428,12 @@
 function W3_GetStartZ(  mobile,  posx,posy,posz,  itemList )
 	local zLow,zTop =3D 0,0
 =

-	local landTile =3D W3_GetLandTile( posx, posy ) -- Tile
-	local landZ =3D 0
-	local landCenter =3D 0
-	local landTop =3D 0
-	local landTileID =3D BitwiseAND(landTile.ID , 0x3FFF)
-	local landTileFlags =3D W3_GetLandTypeFlags(landTileID)
-	local landBlocks =3D TestMask(landTileFlags, kTileFlag.Impassable)
+	local landZ 		=3D 0
+	local landCenter	=3D 0
+	local landTop		=3D 0
+	local landTile 		=3D W3_GetLandTile( posx, posy ) -- Tile
+	local landTileFlags	=3D landTile.flags
+	local landBlocks	=3D TestMask(landTileFlags, kTileFlag.Impassable)
 =

 	if ( landBlocks and mobile.CanSwim and TestMask(landTileFlags , kTileFlag=
.Wet) ) then
 		landBlocks =3D false
@@ -333,37 +443,36 @@
 =

 	landZ,landCenter,landTop =3D W3_GetAverageZ( posx, posy)
 =

-	local considerLand =3D not landTile.Ignored
+	local considerLand =3D not landTile.bIgnored
 =

 	local zCenter =3D 0
 	local isSet =3D false
 =

-	if ( considerLand and (not landBlocks) and posz >=3D landCenter )
-	then
+	if ( considerLand and (not landBlocks) and posz >=3D landCenter ) then
 		zLow =3D landZ
 		zCenter =3D landCenter
-
 		if ( (not isSet) or landTop > zTop ) then zTop =3D landTop end
-
 		isSet =3D true
 	end
 =

-	local staticTiles =3D W3_GetStaticTiles( posx, posy, true ) -- Tile[]
+	local staticTiles =3D W3_GetStaticTiles( posx, posy ) -- Tile[]
 =

 	for i,tile in pairs(staticTiles) do -- Tile
-		local id =3D W3_GetTileType(BitwiseAND(tile.ID , 0x3FFF)) -- ItemData
-
-		local calcTop =3D (tile.Z + id.CalcHeight)
-
-		if ( ((not isSet) or calcTop >=3D zCenter) and ( TestMask(id.Flags , kTi=
leFlag.Surface) or ( mobile.CanSwim and TestMask(id.Flags,kTileFlag.Wet) ) =
) and posz >=3D calcTop )
-		then
-			if ( mobile.CantWalk and BitwiseAND(id.Flags , kTileFlag.Wet) =3D=3D 0 =
) then
+		local itemtype =3D GetStaticTileType(BitwiseAND(tile.artid , 0x3FFF)) --=
 ItemData
+
+		local calcTop =3D (tile.zloc + itemtype.iCalcHeight)
+
+		if	(((not isSet) or calcTop >=3D zCenter) and =

+			 (TestMask(itemtype.miFlags , kTileFlag.Surface) or (mobile.CanSwim and=
 TestMask(itemtype.miFlags,kTileFlag.Wet))) and =

+			 posz >=3D calcTop =

+			) then
+			if ( mobile.CantWalk and BitwiseAND(itemtype.miFlags , kTileFlag.Wet) =
=3D=3D 0 ) then
 				--continue
 			else
-				zLow =3D tile.Z
+				zLow =3D tile.zloc
 				zCenter =3D calcTop
 =

-				local top =3D tile.Z + id.Height
+				local top =3D tile.zloc + itemtype.miHeight
 =

 				if ( (not isSet) or top > zTop ) then zTop =3D top end
 =

@@ -373,22 +482,22 @@
 	end
 =

 	for i,item in pairs(itemList) do -- Item
-		local id =3D item.ItemData -- ItemData
-
-		local calcTop =3D item.Z + id.CalcHeight
+		local itemtype =3D GetStaticTileType(item.artid) -- ItemData
+
+		local calcTop =3D item.zloc + itemtype.iCalcHeight
 =

 		if (	((not isSet) or calcTop >=3D zCenter) and =

-				(	TestMask(id.Flags , kTileFlag.Surface) or =

-					( mobile.CanSwim and TestMask(id.Flags,kTileFlag.Wet) ) ) and =

+				(	TestMask(itemtype.miFlags , kTileFlag.Surface) or =

+					( mobile.CanSwim and TestMask(itemtype.miFlags,kTileFlag.Wet) ) ) and =

 				posz >=3D calcTop )
 		then
-			if ( mobile.CantWalk and BitwiseAND(id.Flags , kTileFlag.Wet) =3D=3D 0 =
) then
+			if ( mobile.CantWalk and BitwiseAND(itemtype.miFlags , kTileFlag.Wet) =
=3D=3D 0 ) then
 				--continue
 			else =

-				zLow =3D item.Z
+				zLow =3D item.zloc
 				zCenter =3D calcTop
 =

-				local top =3D item.Z + id.Height
+				local top =3D item.zloc + itemtype.miHeight
 =

 				if ( (not isSet) or top > zTop ) then zTop =3D top end
 =


Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Mon Apr  7 02:12:41 2008
@@ -81,6 +81,7 @@
 dofile(libpath .. "lib.unifont.lua")
 dofile(libpath .. "lib.pathfind.lua")
 dofile(libpath .. "lib.plugin.lua")
+dofile(libpath .. "lib.uoutils.lua")
 =

 dofile(libpath .. "gui/gui.main.lua")
 dofile(libpath .. "obj/obj.main.lua")

Modified: trunk/src/data_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data_L.cpp (original)
+++ trunk/src/data_L.cpp Mon Apr  7 02:12:41 2008
@@ -34,6 +34,7 @@
 			REGISTER_METHOD(GetMapH);
 			REGISTER_METHOD(WriteMapImageToFile);
 			REGISTER_METHOD(GetTile);
+			REGISTER_METHOD(GetTile2);
 			REGISTER_METHOD(GetNormals);
 			REGISTER_METHOD(GetHeightMap);
 			REGISTER_METHOD(CountTileTypes);
@@ -78,6 +79,22 @@
 			int tx =3D mymax(0,mymin(7,luaL_checkint(L,4)));
 			int ty =3D mymax(0,mymin(7,luaL_checkint(L,5)));
 			RawGroundTile* pTile =3D &pChunk->mTiles[ty][tx];
+			lua_pushnumber(L,pTile->miTileType);
+			lua_pushnumber(L,pTile->miZ);
+			return 2; =

+		}
+		=

+		/// for lua  tiletype,z		GetTile2	(xloc,yloc)
+		static int					GetTile2	(lua_State *L) { PROFILE =

+			int x =3D luaL_checkint(L,2);
+			int y =3D luaL_checkint(L,3);
+			if (x < 0 || y < 0) return 0;
+			cGroundBlockLoader* target =3D checkudata_alive(L);
+			cGroundBlock* pGroundBlock =3D target->GetGroundBlock(x/8,y/8);
+			if (!pGroundBlock) return 0;
+			RawGroundBlock* pChunk =3D pGroundBlock->mpRawGroundBlock;
+			if (!pChunk) return 0;
+			RawGroundTile* pTile =3D &pChunk->mTiles[y%8][x%8];
 			lua_pushnumber(L,pTile->miTileType);
 			lua_pushnumber(L,pTile->miZ);
 			return 2; =




From no-reply at zwischenwelt.org  Mon Apr  7 02:53:20 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 07 Apr 2008 00:53:20 -0000
Subject: [Iris-commit] [IRIS] r2035 - in /trunk: data/config.lua.dist
 lua/lib.walking2.lua lua/lib.walking3.lua lua/main.lua
Message-ID: <20080407005325.3F44D1C1872C@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Apr  7 02:53:15 2008
New Revision: 2035

Log:
working on walk3

Modified:
    trunk/data/config.lua.dist
    trunk/lua/lib.walking2.lua
    trunk/lua/lib.walking3.lua
    trunk/lua/main.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Mon Apr  7 02:53:15 2008
@@ -465,3 +465,5 @@
 =

 -- "ultralow", "low", "med", "high", "ultrahigh", "none"
 -- gGraphicProfile =3D "med"
+
+gUseWalk3 =3D false

Modified: trunk/lua/lib.walking2.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.walking2.lua (original)
+++ trunk/lua/lib.walking2.lua Mon Apr  7 02:53:15 2008
@@ -378,7 +378,7 @@
 -- Can walk the tile, the tile's height and if the tile's a stair
 -- (about 30 in int, or 3.0 in float (*0.1) is the height of a door)
 -- two values are returned: is walkable, new Z Level
-function GetNearestGroundLevel (xloc,yloc,iStartZ,iDir)
+function GetNearestGroundLevel_W2 (xloc,yloc,iStartZ,iDir)
 	if (gMyTicks > gWalkScanCacheTime) then gWalkScanCacheTime =3D gMyTicks +=
 2000 gWalkScanCache =3D {} end
 	local cachename =3D sprintf("%d,%d,%d,%d",xloc,yloc,iStartZ,iDir)
 	local cache =3D gWalkScanCache[cachename]

Modified: trunk/lua/lib.walking3.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.walking3.lua (original)
+++ trunk/lua/lib.walking3.lua Mon Apr  7 02:53:15 2008
@@ -1,16 +1,8 @@
 -- started but not yet finished walk-code : client-side collision, based o=
n RunUO1 code (used by vetus-mundus for example)
 -- TODO : walk2 : bridge =3D kTileDataFlag_StairBack or kTileDataFlag_Stai=
rRight or bridge ???
-
-
---[[
-replaces the old GetNearestGroundLevel, was used like
-
-function WalkStep_CanWalkInDir	(iDir) =

-	iDir =3D DirWrap(iDir)
-	return (GetNearestGroundLevel(gPlayerXLoc + GetDirX(iDir),gPlayerYLoc + G=
etDirY(iDir),gPlayerZLoc,iDir))
-	--(return value was bClientSidePassable,zloc)
-end
-]]--
+-- TODO : season translation
+
+
 =

 =

 kTileFlag =3D {}
@@ -31,6 +23,35 @@
 gW3CacheBlocks =3D {}
 gW3ItemTypeFlagsCache =3D {}
 kW3CacheBlocks_MaxSqDist =3D 8*8
+
+-- returns bClientSidePassable,zloc
+function GetNearestGroundLevel (xloc,yloc,iStartZ,iDir)
+	if (gUseWalk3) then return GetNearestGroundLevel_W3(xloc,yloc,iStartZ,iDi=
r) end
+	return GetNearestGroundLevel_W2(xloc,yloc,iStartZ,iDir)
+end
+
+--[[
+replaces the old GetNearestGroundLevel, was used like
+
+function WalkStep_CanWalkInDir	(iDir) =

+	iDir =3D DirWrap(iDir)
+	return (GetNearestGroundLevel(gPlayerXLoc + GetDirX(iDir),gPlayerYLoc + G=
etDirY(iDir),gPlayerZLoc,iDir))
+	--(return value was bClientSidePassable,zloc)
+end
+]]--
+
+-- returns bMoveIsOk,newZ
+function GetNearestGroundLevel_W3 (xloc,yloc,iStartZ,iDir)
+	local playermobile =3D GetPlayerMobile()
+	if (not playermobile) then return false end
+	local playerbodyid =3D playermobile.artid
+	local mobile =3D {zloc=3DiStartZ,CanSwim=3Dfalse,CantWalk=3Dfalse,Alive=
=3Dtrue,Body=3D{BodyID=3Dplayerbodyid},IsDeadBondedPet=3Dfalse}
+	local posx,posy,posz,d =3D xloc,yloc,iStartZ,iDir
+	local bMoveIsOk,newZ =3D W3_CheckMovement( mobile, posx,posy,posz, d)
+	return bMoveIsOk,newZ
+end
+
+
 =

 =

 function W3_GetCacheBlock (xloc,yloc)
@@ -51,11 +72,9 @@
 		end
 	end
 	=

-	-- init block
+	-- statics
 	b.statics =3D {}
 	for y =3D 0,7 do for x =3D 0,7 do b.statics[x..","..y] =3D {} end end
-	=

-	-- load statics
 	gStaticBlockLoader:Load(bx,by) -- following gStaticBlockLoader commands o=
perate on this loaded block
 	local iStaticCount =3D gStaticBlockLoader:Count()
 	for i =3D 0,iStaticCount-1 do
@@ -64,6 +83,7 @@
 		table.insert(b.statics[xloc..","..yloc],{zloc=3DiZ,artid=3DiTileTypeID,b=
IsStatic=3Dtrue})
 	end
 	=

+	-- ground
 	b.ground =3D {}
 	for ty =3D 0,7 do
 	for tx =3D 0,7 do
@@ -87,52 +107,22 @@
 function W3_ItemIsMovable		(item)		return not item.bIsStatic end
 =

 =

-function W3_ForAllMultiPartsAtPos	(xloc,yloc,multi_item,fun,param)
-	assert(false,"TODO")
-	local mycache =3D multi.cache
+-- handles clientside and serverside multis (no difference for us, just th=
e way they are loaded)
+function W3_ForAllMultiPartsAtPos	(xloc,yloc,item,fun,param)
+	local multidata =3D item.multi
+	local mycache =3D multi.w3_cache
 	if (not mycache) then
 		mycache =3D {}
-		multi.cache =3D mycache
+		multi.w3_cache =3D mycache
 		for k,v in pairs(multi.lparts or {}) do
 			local iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
-			local myarr =3D mycache[iX..","..iY]
-			if (not myarr) then myarr =3D {}   mycache[iX..","..iY] =3D myarr end
-			table.insert(myarr,{iZ=3DiZ,iTileTypeID=3DiTileTypeID,iHue=3DiHue})
-		end
-	end
-	return mycache[xloc..","..yloc] or {}
-	-- TODO : clientside multi
-	-- TODO : serverside multi
-	--~ see also lib.3d.dynamic.lua:114:	if item.artid >=3D gMulti_ID then
-	--~ see also lib.3d.dynamic.lua:151:	multi.id =3D item.artid - gMulti_ID
-	=

-	-- TODO : consider multis as well ! (serverside & clientside)   , walk2:G=
etMultiPartsAtPos()
-	--  lua/net/net.multi.lua gMultiLoader kPacket_Generic_SubCommand_Revisio=
nCustomHouse kPacket_Target_Multi
-	--- lua/lib.3d.dynamic.lua gMultis
-	--- lua/lib.3d.map.lua:510 : multi.lparts
-	--[[ =

-			/cavern/code/iris/lua/lib.3d.dynamic.lua:114:	if item.artid >=3D gMulti=
_ID then
-			/cavern/code/iris/lua/lib.3d.dynamic.lua:151:	multi.id =3D item.artid -=
 gMulti_ID
-			/cavern/code/iris/lua/lib.3d.dynamic.lua:144:	gMultis[multi] =3D true
-			/cavern/code/iris/lua/lib.3d.dynamic.lua:184:	gMultis[multi] =3D true
-			/cavern/code/iris/lua/lib.3d.dynamic.lua:388:	gMultis[dynamic.multi] =
=3D nil =

-			/cavern/code/iris/lua/lib.3d.map.lua:497:	if (gMultis) then
-			/cavern/code/iris/lua/lib.3d.map.lua:502:	for k,v in pairs(gMultis) do
-			/cavern/code/iris/lua/lib.3d.map.lua:658:	for k,v in pairs(gMultis) do
-			=

-			for k,v in pairs(gMultis) do
-				multi =3D k
-				if multi.lparts then
-					for k,v in pairs(multi.lparts) do
-						iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
-						if	iX =3D=3D x and iY =3D=3D y  and iZ >=3D playerheadpos then
-							playerIsInside =3D true
-							if ((not zloc_roof) or (zloc_roof > iZ)) then zloc_roof =3D iZ end
-						end
-					end
-				end
-			end
-	]]--
+			local n =3D iX..","..iY
+			local myarr =3D mycache[n]
+			if (not myarr) then myarr =3D {} mycache[n] =3D myarr end
+			table.insert(myarr,{zloc=3DiZ,artid=3DiTileTypeID,bIsStatic=3Dtrue})
+		end
+	end
+	for k,item in pairs(mycache[xloc..","..yloc]) do fun(item,param) end
 end
 =

 -- considers statics, dynamics and multis
@@ -153,8 +143,6 @@
 =

 =

 =

-function W3_GetMobile			(irismobile)			assert(false,"TODO") return {zloc=
=3D0,CanSwim=3Dfalse,CantWalk=3Dfalse,Alive=3Dtrue,Body=3D{BodyID=3D123},Is=
DeadBondedPet=3Dfalse} end
-
 -- returns min,avg,max of 4 vertices
 function W3_GetAverageZ			(xloc,yloc)			=

 	-- /cavern/RunUO1.0/src/Map.cs:173:        public void GetAverageZ
@@ -182,8 +170,7 @@
 =

 =

 --- bMoveIsOk,newZ =3D CheckMovement( Mobile mobile, Point3D loc, Directio=
n d, out int newZ )
--- see also RunUO1.0/Scripts/Engines/Pathing/Movement.cs : CheckMovement a=
nd Check
--- TODO : see also RunUO1.0/src/Mobile.cs : Move : checks items(dynamics?)=
 and mobiles
+-- see also RunUO1.0/Scripts/Engines/Pathing/Movement.cs : CheckMovement a=
nd Check  and  RunUO1.0/src/Mobile.cs
 function W3_CheckMovement( mobile, posx,posy,posz, d)
 	d =3D DirWrap(d) -- alsor removes runflag
 	local moveIsOk,newZ =3D false,0

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Mon Apr  7 02:53:15 2008
@@ -54,6 +54,7 @@
 dofile(libpath .. "lib.cliloc.lua")
 dofile(libpath .. "lib.macrolist.lua")
 dofile(libpath .. "lib.walking2.lua")
+dofile(libpath .. "lib.walking3.lua")
 dofile(libpath .. "lib.spellbooks.lua")
 dofile(libpath .. "lib.speech.lua")
 dofile(libpath .. "lib.granny.lua")



From no-reply at zwischenwelt.org  Mon Apr  7 03:20:26 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 07 Apr 2008 01:20:26 -0000
Subject: [Iris-commit] [IRIS] r2036 - in /trunk/lua: lib.walking3.lua
	main.lua
Message-ID: <20080407020005.070C81C186D9@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Apr  7 03:20:25 2008
New Revision: 2036

Log:
worked on walk3, working partially (start with -walk3) , but still strange =
bugs

Modified:
    trunk/lua/lib.walking3.lua
    trunk/lua/main.lua

Modified: trunk/lua/lib.walking3.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.walking3.lua (original)
+++ trunk/lua/lib.walking3.lua Mon Apr  7 03:20:25 2008
@@ -11,7 +11,7 @@
 kTileFlag.Surface		=3D kTileDataFlag_Surface
 kTileFlag.Door			=3D kTileDataFlag_Door
 =

-kTileFlag.kImpassableSurface =3D kTileFlag.Impassable + kTileFlag.Surface
+kImpassableSurface =3D kTileFlag.Impassable + kTileFlag.Surface
 =

 =

 =

@@ -43,9 +43,10 @@
 -- returns bMoveIsOk,newZ
 function GetNearestGroundLevel_W3 (xloc,yloc,iStartZ,iDir)
 	local playermobile =3D GetPlayerMobile()
-	if (not playermobile) then return false end
-	local playerbodyid =3D playermobile.artid
-	local mobile =3D {zloc=3DiStartZ,CanSwim=3Dfalse,CantWalk=3Dfalse,Alive=
=3Dtrue,Body=3D{BodyID=3Dplayerbodyid},IsDeadBondedPet=3Dfalse}
+	local playerbodyid =3D playermobile and playermobile.artid or 400
+	local bIsAlive =3D true
+	if (playermobile and playermobile.bIsGhost) then bIsAlive =3D false end
+	local mobile =3D {zloc=3DiStartZ,CanSwim=3Dfalse,CantWalk=3Dfalse,Alive=
=3DbIsAlive,Body=3D{BodyID=3Dplayerbodyid},IsDeadBondedPet=3Dfalse}
 	local posx,posy,posz,d =3D xloc,yloc,iStartZ,iDir
 	local bMoveIsOk,newZ =3D W3_CheckMovement( mobile, posx,posy,posz, d)
 	return bMoveIsOk,newZ
@@ -74,13 +75,15 @@
 	=

 	-- statics
 	b.statics =3D {}
-	for y =3D 0,7 do for x =3D 0,7 do b.statics[x..","..y] =3D {} end end
 	gStaticBlockLoader:Load(bx,by) -- following gStaticBlockLoader commands o=
perate on this loaded block
 	local iStaticCount =3D gStaticBlockLoader:Count()
 	for i =3D 0,iStaticCount-1 do
 		local iTileTypeID,iX,iY,iZ,iHue =3D gStaticBlockLoader:GetStatic(i)
 		local xloc,yloc =3D bx*8 + iX,by*8 + iY
-		table.insert(b.statics[xloc..","..yloc],{zloc=3DiZ,artid=3DiTileTypeID,b=
IsStatic=3Dtrue})
+		local n =3D xloc..","..yloc
+		local arr =3D b.statics[n]
+		if (not arr) then arr =3D {} b.statics[n] =3D arr end
+		table.insert(arr,{zloc=3DiZ,artid=3DiTileTypeID,bIsStatic=3Dtrue})
 	end
 	=

 	-- ground
@@ -90,7 +93,7 @@
 		local xloc,yloc =3D bx*8+tx,by*8+ty
 		local iTileType,zloc =3D gGroundBlockLoader:GetTile2(xloc,yloc)  -- TODO=
 : season translation ??? iTranstile	=

 		-- RunUO1.0/src/TileMatrix.cs:600: public bool Ignored
-		local bIgnored =3D iTileTypeID =3D=3D 2 or iTileTypeID =3D=3D 0x1DB or (=
 iTileTypeID >=3D 0x1AE and iTileTypeID <=3D 0x1B5 ) =

+		local bIgnored =3D iTileType =3D=3D 2 or iTileType =3D=3D 0x1DB or ( iTi=
leType >=3D 0x1AE and iTileType <=3D 0x1B5 )
 		b.ground[xloc..","..yloc] =3D {iTileType=3DiTileType,zloc=3Dzloc,bIgnore=
d=3DbIgnored,flags=3DGetGroundTileType(iTileType).miFlags}
 	end
 	end
@@ -98,10 +101,10 @@
 	return b
 end
 =

-function W3_GetStaticTiles		(xloc,yloc)	return W3_GetCacheBlock(xloc,yloc)=
.statics[xloc..","..yloc] end =

+function W3_GetStaticTiles		(xloc,yloc)	return W3_GetCacheBlock(xloc,yloc)=
.statics[xloc..","..yloc] or {} end =

 function W3_GetLandTile			(xloc,yloc)	return W3_GetCacheBlock(xloc,yloc).g=
round[xloc..","..yloc] end
-function W3_GetMapW				()			return gGroundBlockLoader:GetMapW() end
-function W3_GetMapH				()			return gGroundBlockLoader:GetMapH() end
+function W3_GetMapW				()			return gGroundBlockLoader:GetMapW() * 8 end
+function W3_GetMapH				()			return gGroundBlockLoader:GetMapH() * 8 end
 =

 -- old : Movable runuo:ImplFlag.Movable , probably true for dynamic, false=
 for static    (door?)
 function W3_ItemIsMovable		(item)		return not item.bIsStatic end
@@ -129,7 +132,7 @@
 function W3_ForAllItemsAtPos	(xloc,yloc,fun,param)
 	local b =3D W3_GetCacheBlock(xloc,yloc)
 	local n =3D xloc..","..yloc
-	for k,static in pairs(b.statics[n]) do fun(static,param) end
+	for k,static in pairs(b.statics[n] or {}) do fun(static,param) end
 	for k,dynamic in pairs(GetDynamicList()) do
 		if (DynamicIsInWorld(dynamic) and dynamic.artid) then
 			if (dynamic.artid >=3D gMulti_ID) then -- multi =

@@ -177,9 +180,9 @@
 =

 	local xStart =3D posx -- ints
 	local yStart =3D posy
-	local xForward	, yForward	=3D ApplyDir( d    , xForward	,yForward	)
-	local xLeft		, yLeft		=3D ApplyDir( d - 1, xLeft	,yLeft		)
-	local xRight	, yRight	=3D ApplyDir( d + 1, xRight	,yRight		)
+	local xForward	, yForward	=3D ApplyDir( d    , xStart	,yStart	)
+	local xLeft		, yLeft		=3D ApplyDir( d - 1, xStart	,yStart	)
+	local xRight	, yRight	=3D ApplyDir( d + 1, xStart	,yStart	)
 =

 	if ( xForward < 0 or yForward < 0 or xForward >=3D W3_GetMapW() or yForwa=
rd >=3D W3_GetMapH() ) then return false,newZ end
 	=


Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Mon Apr  7 03:20:25 2008
@@ -274,6 +274,7 @@
 	HandleCommandLine()
 	=

 	if (gCommandLineSwitches["-profile"]) then StartGlobalProfiler() end
+	if (gCommandLineSwitches["-walk3"]) then gUseWalk3 =3D true end
 	=

 	CheckUODir()
 	=




From no-reply at zwischenwelt.org  Mon Apr  7 14:05:57 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 07 Apr 2008 12:05:57 -0000
Subject: [Iris-commit] [IRIS] r2037 - /trunk/lua/gui/gui.healthbar.lua
Message-ID: <20080407120558.8D6AE1C18034@zwischenwelt.org>

Author: hagish
Date: Mon Apr  7 14:05:55 2008
New Revision: 2037

Log:
bugfix: mixed ups modes

Modified:
    trunk/lua/gui/gui.healthbar.lua

Modified: trunk/lua/gui/gui.healthbar.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.healthbar.lua (original)
+++ trunk/lua/gui/gui.healthbar.lua Mon Apr  7 14:05:55 2008
@@ -147,7 +147,6 @@
 				   end
 	-- overwrite the onMouseDown function from gumpparser
 	dialog.on_mouse_left_down =3D function ()
-		print("click left")
 		dialog:BringToFront() =

 		if IsTargetModeActive() then =

 			CompleteTargetModeWithTargetMobile(mobile) =

@@ -156,12 +155,14 @@
 		end =

 	end
 	dialog.on_mouse_right_down =3D function ()
-		print("click right")
 		dialog:Close()
 	end
 	dialog.on_mouse_left_click_double =3D function ()
-		print("dbl click left")
-		Send_DoubleClick(mobile.serial)
+		if (gActWarmode =3D=3D gWarmode_Combat) then
+			Send_AttackReq(mobile.serial)
+		else
+			Send_DoubleClick(mobile.serial)
+		end
 	end
 =

 	local r,g,b =3D GetNotorietyColor(mobile.notoriety)



From no-reply at zwischenwelt.org  Tue Apr  8 10:58:36 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 08 Apr 2008 08:58:36 -0000
Subject: [Iris-commit] [IRIS] r2038 - in /rawdata/sd_pd: houseparts.blend
 tex_gravestone2.png tex_gravestone3.png
Message-ID: <20080408090015.AFF671C181B5@zwischenwelt.org>

Author: hagish
Date: Tue Apr  8 10:58:34 2008
New Revision: 2038

Log:
rawdata update

Added:
    rawdata/sd_pd/tex_gravestone2.png   (with props)
    rawdata/sd_pd/tex_gravestone3.png   (with props)
Modified:
    rawdata/sd_pd/houseparts.blend

Modified: rawdata/sd_pd/houseparts.blend
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Tue Apr  8 11:49:11 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 08 Apr 2008 09:49:11 -0000
Subject: [Iris-commit] [IRIS] r2039 - /rawdata/sd_pd/houseparts.blend
Message-ID: <20080408094912.5C3921C18172@zwischenwelt.org>

Author: hagish
Date: Tue Apr  8 11:49:11 2008
New Revision: 2039

Log:
fixes broken uvs

Modified:
    rawdata/sd_pd/houseparts.blend

Modified: rawdata/sd_pd/houseparts.blend
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Tue Apr  8 14:13:40 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 08 Apr 2008 12:13:40 -0000
Subject: [Iris-commit] [IRIS] r2040 - in /rawdata/sd_pd: houseparts.blend
	tex_woodwalls.png
Message-ID: <20080408121340.715031C187B2@zwischenwelt.org>

Author: hagish
Date: Tue Apr  8 14:13:40 2008
New Revision: 2040

Log:
raw data update

Added:
    rawdata/sd_pd/tex_woodwalls.png   (with props)
Modified:
    rawdata/sd_pd/houseparts.blend

Modified: rawdata/sd_pd/houseparts.blend
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Wed Apr  9 00:17:56 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 08 Apr 2008 22:17:56 -0000
Subject: [Iris-commit] [IRIS] r2041 - in /trunk/lua: gui/gui.spellbook.lua
	lib.spellbooks.lua
Message-ID: <20080408230011.87D991C187B2@zwischenwelt.org>

Author: hagish
Date: Wed Apr  9 00:17:51 2008
New Revision: 2041

Log:
bugfix: chiv spellbook

Modified:
    trunk/lua/gui/gui.spellbook.lua
    trunk/lua/lib.spellbooks.lua

Modified: trunk/lua/gui/gui.spellbook.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.spellbook.lua (original)
+++ trunk/lua/gui/gui.spellbook.lua Wed Apr  9 00:17:51 2008
@@ -148,7 +148,9 @@
 				local spellcounter=3D0
 =

 				for spell=3D1, spellnumber do
-					if (TestBit(spellbook.matrix[circle], BitwiseSHL(1,spell-1))) then
+					print("SPELL",gSpellBooks[spellbook.itemid].ignore_available_flags,sp=
ell,spellnumber,spellbook.matrix[circle],BitwiseSHL(1,spell-1))
+					if (gSpellBooks[spellbook.itemid].ignore_available_flags or TestBit(s=
pellbook.matrix[circle], BitwiseSHL(1,spell-1))) then
+						print("ADD")
 						-- increase number of available spells
 						spellcounter=3Dspellcounter+1
 						local spellbutton =3D MakeBorderGumpPart(curparent, hex2num("0x837")=
, 60 + rightspacer, 20+((spellcounter+1)*15) - top_align)

Modified: trunk/lua/lib.spellbooks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.spellbooks.lua (original)
+++ trunk/lua/lib.spellbooks.lua Wed Apr  9 00:17:51 2008
@@ -101,7 +101,9 @@
 		[6]	=3D { [1]=3D{[1]=3D3,[2]=3D5,[3]=3D8}, [2]=3D{[1]=3D1,[2]=3D6}, [3]=
=3D{[1]=3D1,[2]=3D5,[3]=3D8}, [4]=3D{[1]=3D2,[2]=3D6}, [5]=3D{[1]=3D1,[2]=
=3D2,[3]=3D5}, [6]=3D{[1]=3D3,[2]=3D5,[3]=3D6,[4]=3D8}, [7]=3D{[1]=3D1,[2]=
=3D4,[3]=3D7}, [8]=3D{[1]=3D2,[2]=3D8} },
 		[7]	=3D { [1]=3D{[1]=3D1,[2]=3D2,[3]=3D5,[4]=3D8}, [2]=3D{[1]=3D1,[2]=3D=
5,[3]=3D7,[4]=3D8}, [3]=3D{[1]=3D7,[2]=3D8}, [4]=3D{[1]=3D1,[2]=3D5,[3]=3D8=
}, [5]=3D{[1]=3D1,[2]=3D2,[3]=3D5,[4]=3D7}, [6]=3D{[1]=3D1,[2]=3D3,[3]=3D5,=
[4]=3D8}, [7]=3D{[1]=3D2,[2]=3D5,[3]=3D7,[4]=3D8}, [8]=3D{[1]=3D2,[2]=3D5,[=
3]=3D7} },
 		[8]	=3D { [1]=3D{[1]=3D2,[2]=3D4,[3]=3D5,[4]=3D8}, [2]=3D{[1]=3D1,[2]=3D=
2,[3]=3D5,[4]=3D6}, [3]=3D{[1]=3D2,[2]=3D3,[3]=3D4}, [4]=3D{[1]=3D2,[2]=3D5=
,[3]=3D7}, [5]=3D{[1]=3D2,[2]=3D5,[3]=3D7,[4]=3D8}, [6]=3D{[1]=3D2,[2]=3D5,=
[3]=3D7}, [7]=3D{[1]=3D2,[2]=3D5,[3]=3D7,[4]=3D8}, [8]=3D{[1]=3D2,[2]=3D5,[=
3]=3D7} }
-	}
+	},
+	=

+	ignore_available_flags =3D false
 }
 =

 gSpellBooks[NecroSpellbook]	=3D {
@@ -124,7 +126,9 @@
 	spell_reags =3D {
 		[1]	=3D { [1]=3D{[1]=3D2,[2]=3D3}, [2]=3D{[1]=3D3}, [3]=3D{[1]=3D1,[2]=
=3D2}, [4]=3D{[1]=3D5}, [5]=3D{[1]=3D1,[2]=3D4}, [6]=3D{[1]=3D1,[2]=3D3}, [=
7]=3D{[1]=3D2,[2]=3D3,[3]=3D4}, [8]=3D{[1]=3D1,[2]=3D3,[3]=3D5} },
 		[2]	=3D { [1]=3D{[1]=3D2,[2]=3D5}, [2]=3D{[1]=3D4}, [3]=3D{[1]=3D3,[2]=
=3D4}, [4]=3D{[1]=3D1,[2]=3D2,[3]=3D3}, [5]=3D{[1]=3D1,[2]=3D4,[3]=3D5}, [6=
]=3D{[1]=3D1,[2]=3D3,[3]=3D5}, [7]=3D{[1]=3D2,[2]=3D4,[3]=3D5}, [8]=3D{[1]=
=3D4,[2]=3D5} }
-	}
+	},
+	=

+	ignore_available_flags =3D false
 }
 =

 gSpellBooks[ChivalrySpellbook]	=3D {
@@ -149,7 +153,9 @@
 	spell_reags =3D {
 		[1]	=3D { [1]=3D{[1]=3D1,[2]=3D4,[3]=3D8}, [2]=3D{[1]=3D1,[2]=3D4,[3]=3D=
7}, [3]=3D{[1]=3D1,[2]=3D4,[3]=3D9}, [4]=3D{[1]=3D1,[2]=3D4,[3]=3D11}, [5]=
=3D{[1]=3D1,[2]=3D5,[3]=3D10} },
 		[2] =3D {	[1]=3D{[1]=3D1,[2]=3D6,[3]=3D12}, [2]=3D{[1]=3D1,[2]=3D4,[3]=
=3D13}, [3]=3D{[1]=3D2,[2]=3D6,[3]=3D14}, [4]=3D{[1]=3D1,[2]=3D6,[3]=3D8}, =
[5]=3D{[1]=3D3,[2]=3D4,[3]=3D9} }
-	}
+	},
+
+	ignore_available_flags =3D true
 }
 =

 gSpellBooks[BushidoSpellbook] =3D {
@@ -174,7 +180,9 @@
 	spell_reags =3D {
 		[1]	=3D { [1]=3D{[1]=3D1,[2]=3D4}, [2]=3D{[1]=3D3,[2]=3D4}, [3]=3D{[1]=
=3D3,[2]=3D7}, [4]=3D{[1]=3D2,[2]=3D5}, [5]=3D{[1]=3D2,[2]=3D6}, [6]=3D{[1]=
=3D3,[2]=3D8}  },
 		[2] =3D {},
-	}
+	},
+
+	ignore_available_flags =3D false
 }
 =

 gSpellBooks[SpellweavingSpellbook] =3D {
@@ -199,7 +207,9 @@
 	spell_reags =3D {
 		[1] =3D { [1]=3D{[1]=3D1,[2]=3D7 }, [2]=3D{[1]=3D1,[2]=3D7 }, [3]=3D{[1]=
=3D2,[2]=3D8 }, [4]=3D{[1]=3D1,[2]=3D7 }, [5]=3D{[1]=3D2,[2]=3D8 }, [6]=3D{=
[1]=3D1,[2]=3D7}, [7]=3D{[1]=3D4,[2]=3D9}, [8]=3D{[1]=3D4,[2]=3D15} },
 		[2] =3D {	[1]=3D{[1]=3D5,[2]=3D11 }, [2]=3D{[1]=3D6,[2]=3D10}, [3]=3D{[1=
]=3D3,[2]=3D11 }, [4]=3D{[1]=3D3,[2]=3D12}, [5]=3D{[1]=3D2,[2]=3D15}, [6]=
=3D{[1]=3D6,[2]=3D12}, [7]=3D{[1]=3D14,[2]=3D9}, [8]=3D{[1]=3D6,[2]=3D9} }
-	}
+	},
+
+	ignore_available_flags =3D false
 }
 =

 --[[



From no-reply at zwischenwelt.org  Wed Apr  9 01:22:05 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 08 Apr 2008 23:22:05 -0000
Subject: [Iris-commit] [IRIS] r2042 - in /rawdata/sd_pd: houseparts.blend
	tex_woodwalls2.png
Message-ID: <20080408232205.5D8FD1C187B4@zwischenwelt.org>

Author: hagish
Date: Wed Apr  9 01:22:04 2008
New Revision: 2042

Log:
rawdata update!

Added:
    rawdata/sd_pd/tex_woodwalls2.png   (with props)
Modified:
    rawdata/sd_pd/houseparts.blend

Modified: rawdata/sd_pd/houseparts.blend
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Wed Apr  9 01:25:40 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 08 Apr 2008 23:25:40 -0000
Subject: [Iris-commit] [IRIS] r2043 - in /trunk/data/models: materials/
 models/to_010000/ models/to_011000/ textures/
Message-ID: <20080408232540.67A171C187B4@zwischenwelt.org>

Author: hagish
Date: Wed Apr  9 01:25:39 2008
New Revision: 2043

Log:
new models

Added:
    trunk/data/models/models/to_010000/mdl_009343.mesh   (with props)
    trunk/data/models/models/to_010000/mdl_009344.mesh   (with props)
    trunk/data/models/models/to_010000/mdl_009346.mesh   (with props)
    trunk/data/models/models/to_010000/mdl_009347.mesh   (with props)
    trunk/data/models/models/to_010000/mdl_009352.mesh   (with props)
    trunk/data/models/models/to_010000/mdl_009353.mesh   (with props)
    trunk/data/models/models/to_010000/mdl_009354.mesh   (with props)
    trunk/data/models/models/to_011000/mdl_010003.mesh   (with props)
    trunk/data/models/models/to_011000/mdl_010004.mesh   (with props)
    trunk/data/models/models/to_011000/mdl_010005.mesh   (with props)
    trunk/data/models/models/to_011000/mdl_010010.mesh   (with props)
    trunk/data/models/models/to_011000/mdl_010011.mesh   (with props)
    trunk/data/models/models/to_011000/mdl_010012.mesh   (with props)
    trunk/data/models/textures/tex_woodwalls.png   (with props)
    trunk/data/models/textures/tex_woodwalls2.png   (with props)
Removed:
    trunk/data/models/models/to_010000/mdl_009351.mesh
Modified:
    trunk/data/models/materials/textures.material
    trunk/data/models/models/to_010000/mdl_009349.mesh
    trunk/data/models/models/to_010000/mdl_009350.mesh

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Wed Apr  9 01:25:39 2008
@@ -8352,6 +8352,34 @@
 			texture_unit =

 			{ =

 				texture tex_gravestone2.png =

+			}	=

+		}
+	} =

+}
+
+material tex_woodwalls : tex_base
+{ =

+	technique =

+	{ =

+		pass =

+		{		=

+			texture_unit =

+			{ =

+				texture tex_woodwalls.png =

+			}	=

+		}
+	} =

+}
+
+material tex_woodwalls2 : tex_base
+{ =

+	technique =

+	{ =

+		pass =

+		{		=

+			texture_unit =

+			{ =

+				texture tex_woodwalls2.png =

 			}	=

 		}
 	} =


Modified: trunk/data/models/models/to_010000/mdl_009349.mesh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/models/to_010000/mdl_009350.mesh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Wed Apr  9 01:34:46 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 08 Apr 2008 23:34:46 -0000
Subject: [Iris-commit] [IRIS] r2044 - /trunk/lua/filter/filter.art.lua
Message-ID: <20080408233446.9185E1C187B2@zwischenwelt.org>

Author: hagish
Date: Wed Apr  9 01:34:44 2008
New Revision: 2044

Log:
new models

Modified:
    trunk/lua/filter/filter.art.lua

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Wed Apr  9 01:34:44 2008
@@ -171,6 +171,10 @@
 gArtFilter[10760]=3D{maptoid=3D10762,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1.85,zadd=3D0}
 gArtFilter[10758]=3D{maptoid=3D10764,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1.85,zadd=3D0}
 =

+gArtFilter[10013]=3D{maptoid=3D10010,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1.95,zadd=3D0}
+gArtFilter[10014]=3D{maptoid=3D10011,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1.95,zadd=3D0}
+gArtFilter[10015]=3D{maptoid=3D10012,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1.95,zadd=3D0}
+
 gArtFilter[2242]=3D{maptoid=3D2241,rotation=3D"x:0,y:0,z:-90",xadd=3D-1.9,=
yadd=3D0,zadd=3D0}
 gArtFilter[2232]=3D{maptoid=3D2237,rotation=3D"x:0,y:0,z:0",xadd=3D-1,yadd=
=3D0,zadd=3D0}
 gArtFilter[2231]=3D{maptoid=3D2237,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D0.9,zadd=3D0}
@@ -183,6 +187,10 @@
 gArtFilter[2234]=3D{maptoid=3D2238,rotation=3D"x:0,y:0,z:0",xadd=3D0,yadd=
=3D0.9,zadd=3D0}
 gArtFilter[2235]=3D{maptoid=3D2238,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,ya=
dd=3D0,zadd=3D0}
 gArtFilter[2233]=3D{maptoid=3D2240,rotation=3D"x:0,y:0,z:180",xadd=3D-1.9,=
yadd=3D1.45,zadd=3D0}
+
+gArtFilter[9345]=3D{maptoid=3D9344,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1.95,zadd=3D0}
+gArtFilter[9348]=3D{maptoid=3D9347,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1.95,zadd=3D0}
+gArtFilter[9351]=3D{maptoid=3D9350,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1.95,zadd=3D0}
 =

 -- boats
 gArtFilter[16093]=3D{xadd=3D  0,yadd=3D  0,zadd=3D-0.4}



From no-reply at zwischenwelt.org  Wed Apr  9 01:53:51 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 08 Apr 2008 23:53:51 -0000
Subject: [Iris-commit] [IRIS] r2045 - in /trunk: lua/gui/gui.skill.lua
 lua/net/net.skill.lua plugins/hudenemylist.lua
Message-ID: <20080408235352.4C9641C187B2@zwischenwelt.org>

Author: hagish
Date: Wed Apr  9 01:53:47 2008
New Revision: 2045

Log:
small enemylist improvements, skill changes gets displayed in fadelines

Modified:
    trunk/lua/gui/gui.skill.lua
    trunk/lua/net/net.skill.lua
    trunk/plugins/hudenemylist.lua

Modified: trunk/lua/gui/gui.skill.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.skill.lua (original)
+++ trunk/lua/gui/gui.skill.lua Wed Apr  9 01:53:47 2008
@@ -59,13 +59,23 @@
 =

 -- sets a skill value and lock state
 -- lockstate: (0=3Dup, 1=3Ddown, 2=3Dlocked)
-function SkillUpdate(skillid, value, base_value, lockstate)
+function SkillUpdate(skillid, value, base_value, lockstate, name)
 	if not gPlayerSkills then
 		gPlayerSkills =3D {}
 	end
 	=

 	-- add an empty entry if none present
 	if not gPlayerSkills[skillid] then gPlayerSkills[skillid] =3D {} end
+	=

+	-- is there and old entry?
+	local last_value =3D gPlayerSkills and gPlayerSkills[skillid] and gPlayer=
Skills[skillid].value or nil
+	local last_base_value =3D gPlayerSkills and gPlayerSkills[skillid] and gP=
layerSkills[skillid].last_base_value or nil
+	-- print("SKILL DEBUG",value,last_value,base_value,last_base_value)
+	if value and last_value and (last_value ~=3D value) then
+		-- display change
+		AddFadeLines("Skill "..name.." is now "..sprintf("%3.1f",value / 10).." =
-> "..sprintf("%3.1f",(value-last_value) / 10))
+	end
+	=

 	-- update entry
 	gPlayerSkills[skillid].value =3D value
 	gPlayerSkills[skillid].base_value =3D base_value
@@ -75,8 +85,8 @@
 	if gSkillDialog then
 		for k,skill in pairs(gSkillDialog.lSkill) do
 			if skill.skillid =3D=3D skillid then
+				-- print("skillupdate",k,skillid,skill.skillid,value,base_value,lockst=
ate)
 				-- skill found, so update
-				--print("skillupdate",k,skillid,skill.skillid,value,base_value,locksta=
te)
 				skill.button_lock.gfx:SetVisible(lockstate =3D=3D 2)
 				skill.button_up.gfx:SetVisible(lockstate =3D=3D 0)
 				skill.button_down.gfx:SetVisible(lockstate =3D=3D 1)

Modified: trunk/lua/net/net.skill.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.skill.lua (original)
+++ trunk/lua/net/net.skill.lua Wed Apr  9 01:53:47 2008
@@ -35,7 +35,7 @@
 	local id =3D input:PopNetUint8()
 	local size =3D input:PopNetUint16()
 	local skill_type =3D input:PopNetUint8()	--0x00=3D full list, 0x01 GodVie=
w, 0x02 full list with skillcap, 0x03 GodView+SkillCap, 0xDF single skill u=
pdate with cap, 0xFF =3D single skill update
-	printf("NET (todo): Skills id: %i Size: %i Loop_Value: %i\n",id,size,skil=
l_type)
+	-- printf("NET (todo): Skills id: %i Size: %i Loop_Value: %i\n",id,size,s=
kill_type)
 =

 	local bHasCap =3D skill_type =3D=3D hex2num("0x02") or skill_type =3D=3D =
hex2num("0x03") or skill_type =3D=3D hex2num("0xdf")
 	if (skill_type =3D=3D hex2num("0xFF")) then gSkillNumber =3D (size-4)/7 e=
nd
@@ -51,7 +51,7 @@
 			local skill_name =3D glSkillNames[skill_id] or "unknown"
 			if (bHasCap) then	local skill_cap =3D input:PopNetUint16() end
 			printdebug("skill",sprintf("NET (todo): skill: %s [id=3D%i] skill_value=
: %i skill_base_value: %i locked?: %i\n",skill_name,skill_id,skill_value,sk=
ill_base_value,skill_lock_state))
-			SkillUpdate(skill_id,skill_value,skill_base_value,skill_lock_state)
+			SkillUpdate(skill_id,skill_value,skill_base_value,skill_lock_state,skil=
l_name)
 		end
 		-- TODO : check for other Emus (RunUO sends always 0x0000)
 		--if (skill_type =3D=3D hex2num("0x00")) then
@@ -66,7 +66,7 @@
 		local skill_name =3D glSkillNames[skill_id] or "unknown"
 		if (bHasCap) then local skill_cap =3D input:PopNetUint16() end
 		printdebug("skill",sprintf("NET (todo): skill: %s [id=3D%i] skill_value:=
 %i skill_base_value: %i locked?: %i\n",skill_name,skill_id,skill_value,ski=
ll_base_value,skill_lock_state))
-		SkillUpdate(skill_id,skill_value,skill_base_value,skill_lock_state)
+		SkillUpdate(skill_id,skill_value,skill_base_value,skill_lock_state,skill=
_name)
 	end
 end
 =


Modified: trunk/plugins/hudenemylist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/plugins/hudenemylist.lua (original)
+++ trunk/plugins/hudenemylist.lua Wed Apr  9 01:53:47 2008
@@ -70,15 +70,26 @@
 	bar.widget_bg =3D guimaker.MakePlane(parent, GetPlainTextureMat("sd_pd_en=
emylist_bar_bg.png",true), x, y, 32, 16)
 	bar.widget_bg.mbClipChildsHitTest =3D false
 	bar.widget_bg.mbIgnoreMouseOver =3D false
+	=

+	bar.widget_bg.on_mouse_left_click		=3D function () =

+		if not IsTargetModeActive() then =

+			gCurrentRenderer:SelectMobile(body.serial) =

+		end
+	end
 	bar.widget_bg.on_mouse_left_down		=3D function (widget) =

 		if IsTargetModeActive() then =

 			CompleteTargetModeWithTargetMobile(body) =

-		else =

-			gCurrentRenderer:SelectMobile(body.serial) =

 		end =

 	end
 	bar.widget_bg.on_mouse_right_down		=3D function (widget) =

 		OpenHealthbarAtMouse(body)
+	end
+	bar.widget_bg.on_mouse_left_click_double =3D function ()
+		if (gActWarmode =3D=3D gWarmode_Combat) then
+			Send_AttackReq(body.serial)
+		else
+			Send_DoubleClick(body.serial)
+		end
 	end
 	=

 =




From no-reply at zwischenwelt.org  Wed Apr  9 10:48:49 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 09 Apr 2008 08:48:49 -0000
Subject: [Iris-commit] [IRIS] r2046 - in /trunk/lua: gui/gui.status.lua
	net/net.mobile.lua
Message-ID: <20080409084849.4E20E1C187B1@zwischenwelt.org>

Author: hagish
Date: Wed Apr  9 10:48:44 2008
New Revision: 2046

Log:
display overload in fadelines

Modified:
    trunk/lua/gui/gui.status.lua
    trunk/lua/net/net.mobile.lua

Modified: trunk/lua/gui/gui.status.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.status.lua (original)
+++ trunk/lua/gui/gui.status.lua Wed Apr  9 10:48:44 2008
@@ -143,20 +143,21 @@
 					if s["minDamage"] and s["maxDamage"] then =

 						dialog.controls["statusminmaxdamage"].gfx:SetText(s["minDamage"].."-=
"..s["maxDamage"]) =

 					else dialog.controls["statusminmaxdamage"].gfx:SetText("?") end =

+					=

 					-- weight
 					if s["curWeight"] then =

-						if s["maxWeight"] then =

-							-- max weight given
-							dialog.controls["statusweight"].gfx:SetText(s["curWeight"])
-							dialog.controls["statusmaxweight"].gfx:SetText(s["maxWeight"])
-						else =

-							-- no maxweight present
-							dialog.controls["statusweight"].gfx:SetText(s["curWeight"]) =

-							-- hardcoded fallback: 40 + floor(str*35/10)
-							dialog.controls["statusmaxweight"].gfx:SetText(""..
-								(40 + math.floor(s["str"]*35/10)))
-						end
-					else dialog.controls["statusweight"].gfx:SetText("?") end =

+						dialog.controls["statusweight"].gfx:SetText(s["curWeight"])
+					else
+						dialog.controls["statusweight"].gfx:SetText("?")
+					end
+					=

+					if s["maxWeight"] then =

+						-- max weight given
+						dialog.controls["statusmaxweight"].gfx:SetText(s["maxWeight"])
+					else =

+						dialog.controls["statusmaxweight"].gfx:SetText("?") =

+					end
+					=

 				end
 			end
 		end

Modified: trunk/lua/net/net.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.mobile.lua (original)
+++ trunk/lua/net/net.mobile.lua Wed Apr  9 10:48:44 2008
@@ -150,9 +150,32 @@
 	-- more data following
 	if (in_array( stats.flag, {1,3,4,5})) then
 		stats.sex			=3D MySave_PopNetUint8() -- * 0x00 - Male  * 0x01 - Female
+		=

+		local last_value =3D stats.str
 		stats.str			=3D MySave_PopNetUint16()
+		local value =3D stats.str
+		if value and last_value and (last_value ~=3D value) then
+			-- display change
+			AddFadeLines("Attribute Strength is now "..sprintf("%3.1f",value / 10).=
." -> "..sprintf("%3.1f",(value-last_value) / 10))
+		end
+		=

+		last_value =3D stats.dex
 		stats.dex			=3D MySave_PopNetUint16()
+		value =3D stats.dex
+		if value and last_value and (last_value ~=3D value) then
+			-- display change
+			AddFadeLines("Attribute Dexterity is now "..sprintf("%3.1f",value / 10)=
.." -> "..sprintf("%3.1f",(value-last_value) / 10))
+		end
+		=

+		last_value =3D stats.int
 		stats.int			=3D MySave_PopNetUint16()
+		value =3D stats.int
+		if value and last_value and (last_value ~=3D value) then
+			-- display change
+			AddFadeLines("Attribute Intelligence is now "..sprintf("%3.1f",value / =
10).." -> "..sprintf("%3.1f",(value-last_value) / 10))
+		end
+		=

+		=

 		stats.curStamina	=3D MySave_PopNetUint16()
 		stats.maxStamina	=3D MySave_PopNetUint16()
 		stats.curMana		=3D MySave_PopNetUint16()
@@ -164,8 +187,23 @@
 		if (stats.flag =3D=3D 5) then
 			stats.maxWeight	=3D MySave_PopNetUint16()
 			stats.race		=3D MySave_PopNetUint8()
-		end
-
+		elseif stats.curWeight then
+			-- set hardcoded max weight fallback
+			stats.maxWeight =3D (40 + math.floor(stats.str*35/10))
+		end
+		=

+		-- overload check
+		if stats.curWeight and stats.maxWeight then
+			if stats.curWeight > stats.maxWeight and gPlayerLastOverloadCheckWeight=
 ~=3D stats.curWeight then
+				AddFadeLines("You carry to much!!!! "..stats.curWeight.. " / "..stats.=
maxWeight)
+				gPlayerLastOverloadCheckWeight =3D stats.curWeight
+			end
+			if stats.curWeight < stats.maxWeight and gPlayerLastOverloadCheckWeight=
 then
+				AddFadeLines("Weight is normal! "..stats.curWeight.. " / "..stats.maxW=
eight)
+				gPlayerLastOverloadCheckWeight =3D nil
+			end
+		end
+		=

 		if (in_array( stats.flag, {3,4,5} )) then -- Followers (pets)
 			stats.statcap	=3D MySave_PopNetUint16()		-- The character's total allow=
able sum of Strength, Intelligence, and Dexterity
 			stats.curPet	=3D MySave_PopNetUint8()			=




From no-reply at zwischenwelt.org  Wed Apr  9 14:09:17 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 09 Apr 2008 12:09:17 -0000
Subject: [Iris-commit] [IRIS] r2047 - in /trunk: data/config.lua.dist
 lua/gui/gui.skill.lua lua/lib.keybinds.lua lua/net/net.mobile.lua
 lua/obj/obj.mobile.lua
Message-ID: <20080409120917.8580D1C187B1@zwischenwelt.org>

Author: hagish
Date: Wed Apr  9 14:09:14 2008
New Revision: 2047

Log:
display attribute changes

Modified:
    trunk/data/config.lua.dist
    trunk/lua/gui/gui.skill.lua
    trunk/lua/lib.keybinds.lua
    trunk/lua/net/net.mobile.lua
    trunk/lua/obj/obj.mobile.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Wed Apr  9 14:09:14 2008
@@ -117,6 +117,11 @@
 Renderer3D.gMapUpdateInterval =3D 40
 -- increase for free-flight-videos
 Renderer3D.gMaxMapBlocksLoadedPerUpdate =3D 1
+
+
+
+gStatsInfoFadeLineColor =3D {0,1,1,1}
+
 =

 -- Server Emulator Configuration
 --------------------------------

Modified: trunk/lua/gui/gui.skill.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.skill.lua (original)
+++ trunk/lua/gui/gui.skill.lua Wed Apr  9 14:09:14 2008
@@ -73,7 +73,7 @@
 	-- print("SKILL DEBUG",value,last_value,base_value,last_base_value)
 	if value and last_value and (last_value ~=3D value) then
 		-- display change
-		AddFadeLines("Skill "..name.." is now "..sprintf("%3.1f",value / 10).." =
-> "..sprintf("%3.1f",(value-last_value) / 10))
+		AddFadeLines("Skill "..name.." is now "..sprintf("%3.1f",value / 10).." =
-> "..sprintf("%3.1f",(value-last_value) / 10),gStatsInfoFadeLineColor)
 	end
 	=

 	-- update entry

Modified: trunk/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.keybinds.lua (original)
+++ trunk/lua/lib.keybinds.lua Wed Apr  9 14:09:14 2008
@@ -59,7 +59,7 @@
 	=

 	-------------------------------------------------------------------------=
----------
 =

-	if (true) then
+	if (false) then
 		Bind("f7",		function (state) if (not gActiveEditText) then if (state > 0=
) then
 			if (gAmbientLight.r < 1.0) then
 				gAmbientLight.r=3DgAmbientLight.r+0.1

Modified: trunk/lua/net/net.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.mobile.lua (original)
+++ trunk/lua/net/net.mobile.lua Wed Apr  9 14:09:14 2008
@@ -151,30 +151,9 @@
 	if (in_array( stats.flag, {1,3,4,5})) then
 		stats.sex			=3D MySave_PopNetUint8() -- * 0x00 - Male  * 0x01 - Female
 		=

-		local last_value =3D stats.str
 		stats.str			=3D MySave_PopNetUint16()
-		local value =3D stats.str
-		if value and last_value and (last_value ~=3D value) then
-			-- display change
-			AddFadeLines("Attribute Strength is now "..sprintf("%3.1f",value / 10).=
." -> "..sprintf("%3.1f",(value-last_value) / 10))
-		end
-		=

-		last_value =3D stats.dex
 		stats.dex			=3D MySave_PopNetUint16()
-		value =3D stats.dex
-		if value and last_value and (last_value ~=3D value) then
-			-- display change
-			AddFadeLines("Attribute Dexterity is now "..sprintf("%3.1f",value / 10)=
.." -> "..sprintf("%3.1f",(value-last_value) / 10))
-		end
-		=

-		last_value =3D stats.int
 		stats.int			=3D MySave_PopNetUint16()
-		value =3D stats.int
-		if value and last_value and (last_value ~=3D value) then
-			-- display change
-			AddFadeLines("Attribute Intelligence is now "..sprintf("%3.1f",value / =
10).." -> "..sprintf("%3.1f",(value-last_value) / 10))
-		end
-		=

 		=

 		stats.curStamina	=3D MySave_PopNetUint16()
 		stats.maxStamina	=3D MySave_PopNetUint16()
@@ -195,7 +174,7 @@
 		-- overload check
 		if stats.curWeight and stats.maxWeight then
 			if stats.curWeight > stats.maxWeight and gPlayerLastOverloadCheckWeight=
 ~=3D stats.curWeight then
-				AddFadeLines("You carry to much!!!! "..stats.curWeight.. " / "..stats.=
maxWeight)
+				AddFadeLines("You carry to much!!!! "..stats.curWeight.. " / "..stats.=
maxWeight,gStatsInfoFadeLineColor)
 				gPlayerLastOverloadCheckWeight =3D stats.curWeight
 			end
 			if stats.curWeight < stats.maxWeight and gPlayerLastOverloadCheckWeight=
 then

Modified: trunk/lua/obj/obj.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.mobile.lua (original)
+++ trunk/lua/obj/obj.mobile.lua Wed Apr  9 14:09:14 2008
@@ -190,11 +190,36 @@
 function gMobilePrototype:UpdateStats (stats)
 	-- local oldhp =3D mobile.stats.curHits or stats.curHits
 	self.name =3D stats.name
+	local oldstats =3D self.stats
 	self.stats =3D stats
 	self:NotifyListener("Mobile_UpdateStats")
 	-- not needed due to normal damage packet
 	-- TODO is this ok for every server?
 	-- gCurrentRenderer:NotifyHPChange(self.serial, oldhp, mobile.stats.curHi=
ts)
+	=

+	if (self.serial =3D=3D gPlayerBodySerial) then
+		local last_value =3D oldstats.str
+		local value =3D stats.str
+		if value and last_value and (last_value ~=3D value) then
+			-- display change
+			AddFadeLines("Attribute Strength is now "..sprintf("%3.1f",value / 10).=
." -> "..sprintf("%3.1f",(value-last_value) / 10),gStatsInfoFadeLineColor)
+		end
+		=

+		last_value =3D oldstats.dex
+		value =3D stats.dex
+		if value and last_value and (last_value ~=3D value) then
+			-- display change
+			AddFadeLines("Attribute Dexterity is now "..sprintf("%3.1f",value / 10)=
.." -> "..sprintf("%3.1f",(value-last_value) / 10),gStatsInfoFadeLineColor)
+		end
+		=

+		last_value =3D oldstats.int
+		value =3D stats.int
+		if value and last_value and (last_value ~=3D value) then
+			-- display change
+			AddFadeLines("Attribute Intelligence is now "..sprintf("%3.1f",value / =
10).." -> "..sprintf("%3.1f",(value-last_value) / 10),gStatsInfoFadeLineCol=
or)
+		end
+	end
+	=

 	self:Update()
 end
 =




From no-reply at zwischenwelt.org  Wed Apr  9 15:11:28 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 09 Apr 2008 13:11:28 -0000
Subject: [Iris-commit] [IRIS] r2048 - /trunk/bin/iris2.exe
Message-ID: <20080409131129.07CDC1C187B5@zwischenwelt.org>

Author: sience
Date: Wed Apr  9 15:11:27 2008
New Revision: 2048

Log:
-new win32 binary

Modified:
    trunk/bin/iris2.exe

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Thu Apr 10 17:03:38 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 10 Apr 2008 15:03:38 -0000
Subject: [Iris-commit] [IRIS] r2049 - /trunk/lua/obj/obj.mobile.lua
Message-ID: <20080410160009.51FF41524030@zwischenwelt.org>

Author: hagish
Date: Thu Apr 10 17:03:37 2008
New Revision: 2049

Log:
typo

Modified:
    trunk/lua/obj/obj.mobile.lua

Modified: trunk/lua/obj/obj.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.mobile.lua (original)
+++ trunk/lua/obj/obj.mobile.lua Thu Apr 10 17:03:37 2008
@@ -202,21 +202,21 @@
 		local value =3D stats.str
 		if value and last_value and (last_value ~=3D value) then
 			-- display change
-			AddFadeLines("Attribute Strength is now "..sprintf("%3.1f",value / 10).=
." -> "..sprintf("%3.1f",(value-last_value) / 10),gStatsInfoFadeLineColor)
+			AddFadeLines("Attribute Strength is now "..sprintf("%3f",value).." -> "=
..sprintf("%3f",(value-last_value)),gStatsInfoFadeLineColor)
 		end
 		=

 		last_value =3D oldstats.dex
 		value =3D stats.dex
 		if value and last_value and (last_value ~=3D value) then
 			-- display change
-			AddFadeLines("Attribute Dexterity is now "..sprintf("%3.1f",value / 10)=
.." -> "..sprintf("%3.1f",(value-last_value) / 10),gStatsInfoFadeLineColor)
+			AddFadeLines("Attribute Dexterity is now "..sprintf("%3f",value).." -> =
"..sprintf("%3f",(value-last_value)),gStatsInfoFadeLineColor)
 		end
 		=

 		last_value =3D oldstats.int
 		value =3D stats.int
 		if value and last_value and (last_value ~=3D value) then
 			-- display change
-			AddFadeLines("Attribute Intelligence is now "..sprintf("%3.1f",value / =
10).." -> "..sprintf("%3.1f",(value-last_value) / 10),gStatsInfoFadeLineCol=
or)
+			AddFadeLines("Attribute Intelligence is now "..sprintf("%3f",value).." =
-> "..sprintf("%3f",(value-last_value)),gStatsInfoFadeLineColor)
 		end
 	end
 	=




From no-reply at zwischenwelt.org  Wed Apr 16 00:20:39 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 15 Apr 2008 22:20:39 -0000
Subject: [Iris-commit] [IRIS] r2050 - /trunk/bin/fmodex.dll
Message-ID: <20080415222039.9D2551C1872F@zwischenwelt.org>

Author: sience
Date: Wed Apr 16 00:20:38 2008
New Revision: 2050

Log:
-new fmod binary (Version: 4.14.01)

Modified:
    trunk/bin/fmodex.dll

Modified: trunk/bin/fmodex.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Thu Apr 17 00:41:08 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 16 Apr 2008 22:41:08 -0000
Subject: [Iris-commit] [IRIS] r2051 - /trunk/lua/lib.protocol.lua
Message-ID: <20080416224109.21A151C18799@zwischenwelt.org>

Author: sience
Date: Thu Apr 17 00:41:04 2008
New Revision: 2051

Log:
-packets with unknown-packetlen no longer forces a crash (fix for servers w=
ith bad UO:KR implementation (pergon))

Modified:
    trunk/lua/lib.protocol.lua

Modified: trunk/lua/lib.protocol.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.protocol.lua (original)
+++ trunk/lua/lib.protocol.lua Thu Apr 17 00:41:04 2008
@@ -40,12 +40,12 @@
 	local input =3D GetRecvFIFO()
 	while (input:Size() >=3D 1) do
 		local iId =3D input:PeekNetUint8(0)
-		local iPacketSize =3D gPacketSizeById[iId]
-		if (not iPacketSize) then
-			print("Packet with unknown Packetsize received : ",iId)
-			print("WARNING : HandlePackets -> forced Crash")
-			Crash()	-- triggers only if nil, not for 0
-		end
+		local iPacketSize =3D gPacketSizeById[iId] or 0
+--		if (not iPacketSize) then
+--			print("Packet with unknown Packetsize received : ",iId)
+--			print("WARNING : HandlePackets -> forced Crash")
+--			Crash()	-- triggers only if nil, not for 0
+--		end
 		if (iPacketSize =3D=3D 0 and input:Size() < 3) then return end -- packet=
 incomplete
 		if (iPacketSize =3D=3D 0) then iPacketSize =3D input:PeekNetUint16(1) end
 		if (input:Size() < iPacketSize) then return end -- packet incomplete



From no-reply at zwischenwelt.org  Thu Apr 17 16:30:26 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 17 Apr 2008 14:30:26 -0000
Subject: [Iris-commit] [IRIS] r2052 - /trunk/lua/lib.protocol.lua
Message-ID: <20080417143026.EA7761C187B0@zwischenwelt.org>

Author: sience
Date: Thu Apr 17 16:30:25 2008
New Revision: 2052

Log:
-fix disabled. gServerSeed does this job also. everything is correct. The O=
Si devs used a hack to verify thier uo:kr client. They used an unused 255.2=
55.255.255 ip-adresse to check uokr. -> *grml

Modified:
    trunk/lua/lib.protocol.lua

Modified: trunk/lua/lib.protocol.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.protocol.lua (original)
+++ trunk/lua/lib.protocol.lua Thu Apr 17 16:30:25 2008
@@ -40,12 +40,12 @@
 	local input =3D GetRecvFIFO()
 	while (input:Size() >=3D 1) do
 		local iId =3D input:PeekNetUint8(0)
-		local iPacketSize =3D gPacketSizeById[iId] or 0
---		if (not iPacketSize) then
---			print("Packet with unknown Packetsize received : ",iId)
---			print("WARNING : HandlePackets -> forced Crash")
---			Crash()	-- triggers only if nil, not for 0
---		end
+		local iPacketSize =3D gPacketSizeById[iId]
+		if (not iPacketSize) then
+			print("Packet with unknown Packetsize received : ",iId)
+			print("WARNING : HandlePackets -> forced Crash")
+			Crash()	-- triggers only if nil, not for 0
+		end
 		if (iPacketSize =3D=3D 0 and input:Size() < 3) then return end -- packet=
 incomplete
 		if (iPacketSize =3D=3D 0) then iPacketSize =3D input:PeekNetUint16(1) end
 		if (input:Size() < iPacketSize) then return end -- packet incomplete



From no-reply at zwischenwelt.org  Thu Apr 17 17:58:57 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 17 Apr 2008 15:58:57 -0000
Subject: [Iris-commit] [IRIS] r2053 - in /trunk: include/data.h src/data.cpp
	src/data_L.cpp
Message-ID: <20080417155900.B02691524032@zwischenwelt.org>

Author: hagish
Date: Thu Apr 17 17:58:54 2008
New Revision: 2053

Log:
bugfix memleak

Modified:
    trunk/include/data.h
    trunk/src/data.cpp
    trunk/src/data_L.cpp

Modified: trunk/include/data.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/data.h (original)
+++ trunk/include/data.h Thu Apr 17 17:58:54 2008
@@ -620,6 +620,7 @@
 		cArtMap();
 		int	GetWidth	();
 		int	GetHeight	();
+		void	CalcVisibleAABB(int& minx, int& miny, int& maxx, int& maxy);
 		void	SearchCursorHotspot		(int& iX,int& iY); ///< returns hotspot coords=
 in iX,iY. search using different pixel on image border
 		template <class _T> void Decode( short *pBuffer, const int iPitch, _T& f=
ilter, short* ColorTable ) { PROFILE	///< decodes the art image into a pixe=
lbuffer (1short/pixel), pitch=3DLength of a surface scanline in bytes
 			int		iBufferSize =3D iPitch*GetHeight();

Modified: trunk/src/data.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data.cpp (original)
+++ trunk/src/data.cpp Thu Apr 17 17:58:54 2008
@@ -653,6 +653,40 @@
 	else return ((short *)mpRawData)[3];
 }
 =

+void	cArtMap::CalcVisibleAABB(int& minx, int& miny, int& maxx, int& maxy) {
+	// read the size
+	int w =3D GetWidth();
+	int h =3D GetHeight();
+	short *pBuffer =3D new short[w*h];
+	cIdentityFilter Filter;
+	Decode(pBuffer,w*sizeof(short),Filter,0);
+	=

+	bool found =3D false;
+	=

+	int offset;
+	for(int x=3D0;x<w;++x){
+		for(int y=3D0;y<h;++y){
+			offset =3D y*w+x;
+			if(pBuffer[offset] !=3D 0){
+				if(!found){
+					minx =3D x;
+					maxx =3D x;
+					miny =3D y;
+					maxy =3D y;
+					found =3D true;
+				} else {
+					minx =3D mymin(x,minx);
+					maxx =3D mymax(x,maxx);
+					miny =3D mymin(y,miny);
+					maxy =3D mymax(y,maxy);
+				}
+			}
+		}
+	}
+
+	delete [] pBuffer;
+}
+
 void	cArtMap::SearchCursorHotspot		(int& iX,int& iY) { PROFILE
 	// read the size
 	int w =3D GetWidth();
@@ -694,7 +728,7 @@
 			break;
 		}
 	}
-	delete pBuffer;
+	delete[] pBuffer;
 }
 =

 // ***** ***** ***** ***** ***** cSound

Modified: trunk/src/data_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data_L.cpp (original)
+++ trunk/src/data_L.cpp Thu Apr 17 17:58:54 2008
@@ -597,6 +597,7 @@
 			REGISTER_METHOD(CreateBitMask);
 			REGISTER_METHOD(Load);
 			REGISTER_METHOD(GetSize);
+			REGISTER_METHOD(CalcVisibleAABB);
 			REGISTER_METHOD(SearchCursorHotspot);
 			REGISTER_METHOD(GetCount);
 			REGISTER_METHOD(ExportToFile);
@@ -702,6 +703,19 @@
 			lua_pushnumber(L,iX); =

 			lua_pushnumber(L,iY); =

 			return 2; =

+		}
+		=

+		/// minx,miny,maxx,maxy =3D gArtMapLoader:CalcVisibleAABB() for last chu=
nk loaded by Load() for lua
+		static int	CalcVisibleAABB			(lua_State *L) { PROFILE =

+			cArtMap* pLastChunk =3D mLastChunk[checkudata_alive(L)];
+			int minx,miny,maxx,maxy;
+			=

+			if (pLastChunk) pLastChunk->CalcVisibleAABB(minx,miny,maxx,maxy);
+			lua_pushnumber(L,minx); =

+			lua_pushnumber(L,miny); =

+			lua_pushnumber(L,maxx); =

+			lua_pushnumber(L,maxy); =

+			return 4; =

 		}
 		=

 		virtual const char* GetLuaTypeName () { return "iris.artmaploader"; }



From no-reply at zwischenwelt.org  Thu Apr 17 18:13:01 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 17 Apr 2008 16:13:01 -0000
Subject: [Iris-commit] [IRIS] r2054 - in /trunk/lua: ./ gui/ net/ obj/
Message-ID: <20080417161302.6E642152402A@zwischenwelt.org>

Author: hagish
Date: Thu Apr 17 18:12:59 2008
New Revision: 2054

Log:
some bugfixes and stuff

Modified:
    trunk/lua/gui/gui.helper.lua
    trunk/lua/gui/gui.paperdoll.lua
    trunk/lua/gui/gui.spellbook.lua
    trunk/lua/lib.3d.mousepick.lua
    trunk/lua/lib.cursor.lua
    trunk/lua/lib.data.lua
    trunk/lua/lib.macrolist.lua
    trunk/lua/lib.mousepick.lua
    trunk/lua/lib.tilefreewalk.lua
    trunk/lua/lib.uoids.lua
    trunk/lua/net/net.mobile.lua
    trunk/lua/net/net.other.lua
    trunk/lua/net/net.uodragdrop.lua
    trunk/lua/obj/obj.container.lua
    trunk/lua/obj/obj.mobile.lua

Modified: trunk/lua/gui/gui.helper.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.helper.lua (original)
+++ trunk/lua/gui/gui.helper.lua Thu Apr 17 18:12:59 2008
@@ -47,4 +47,21 @@
 function Client_SetBottomLine (text) if (not gDisableBottomLine) then SetB=
ottomLine(text) end end -- from lugre
 =

 -- function is called by Lugre (lib.chatline.lua) from ChatLine_RepeatLast=
 and ChatLine_Init
-function SendChat (curtext) Send_UnicodeSpeech(curtext) end =

+function SendChat (curtext) =

+	if string.sub(curtext, 1, 4) =3D=3D "/lua" then
+		local cmd =3D string.sub(curtext, 5)
+		-- interpret this a lua command
+		-- /lua print("lalal")
+		if cmd then =

+			local f =3D loadstring(cmd)
+			local ok,result =3D pcall(f)
+			if not ok then
+				print("ERROR in lua call",cmd,"->",result)
+			else
+				print("OK in lua call",cmd,"->",result)
+			end
+		end
+	else =

+		Send_UnicodeSpeech(curtext) =

+	end
+end =


Modified: trunk/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.paperdoll.lua (original)
+++ trunk/lua/gui/gui.paperdoll.lua Thu Apr 17 18:12:59 2008
@@ -186,7 +186,7 @@
 =

 -- Don't call this directly, use RebuildPaperdoll() instead (need to rebui=
ld completely on change because of layerorder)
 -- item fields : serial artid layer hue (=3D-1 if not set)
-local function CreatePaperdollItemWidget(paperdoll, item, base_id)
+local function CreatePaperdollItemWidget(layer, paperdoll, item, base_id)
 	local dialog =3D paperdoll.dialog
 	local animid =3D nil
 	local typename =3D ""
@@ -208,8 +208,22 @@
 	if (GetGumpMat(gumpid) =3D=3D "" and base_id =3D=3D kGumpBaseId_Female) t=
hen gumpid =3D animid+kGumpBaseId_Male end -- fallback to male
 	if (item.layer =3D=3D kLayer_Backpack) then gumpid =3D animid+kGumpBaseId=
_Male end -- no female backpack ;)
 =

-	local widget =3D MakeBorderGumpPart(dialog.rootwidget, gumpid, BodyWidget=
_x, BodyWidget_y, 0, 0, 0, item.hue)
-
+	local widget
+	=

+	-- position and art overwrite?
+	if gLayerOrderPositionAndArtOverwrite[layer] then
+
+		local x,y =3D unpack(gLayerOrderPositionAndArtOverwrite[layer])
+		=

+		local minx,miny,maxx,maxy =3D GetArtVisibleAABB(item.artid + 16384)
+		local cx =3D (maxx - minx)/2
+		local cy =3D (maxy - miny)/2
+
+		widget =3D MakeArtGumpPart(  dialog.rootwidget, item.artid, x-cx,y-cy, n=
il,nil,nil, item.hue)
+	else
+		widget =3D MakeBorderGumpPart(dialog.rootwidget, gumpid, BodyWidget_x, B=
odyWidget_y, 0, 0, 0, item.hue)
+	end
+	=

 	widget.mbIgnoreMouseOver =3D false
 	widget.uoPaperdoll =3D paperdoll
 	widget.item =3D item
@@ -344,7 +358,7 @@
 		for index,layer in pairs(gLayerOrder) do =

 			local k =3D gLayerTypeName[layer]
 			local item =3D GetMobileEquipmentItem(mobile,layer)
-			if (item) then CreatePaperdollItemWidget(paperdoll,item,base_id) end
+			if (item) then CreatePaperdollItemWidget(layer,paperdoll,item,base_id) =
end
 		end
 	end
 =


Modified: trunk/lua/gui/gui.spellbook.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.spellbook.lua (original)
+++ trunk/lua/gui/gui.spellbook.lua Thu Apr 17 18:12:59 2008
@@ -148,9 +148,9 @@
 				local spellcounter=3D0
 =

 				for spell=3D1, spellnumber do
-					print("SPELL",gSpellBooks[spellbook.itemid].ignore_available_flags,sp=
ell,spellnumber,spellbook.matrix[circle],BitwiseSHL(1,spell-1))
+					-- print("SPELL",gSpellBooks[spellbook.itemid].ignore_available_flags=
,spell,spellnumber,spellbook.matrix[circle],BitwiseSHL(1,spell-1))
 					if (gSpellBooks[spellbook.itemid].ignore_available_flags or TestBit(s=
pellbook.matrix[circle], BitwiseSHL(1,spell-1))) then
-						print("ADD")
+						-- print("ADD")
 						-- increase number of available spells
 						spellcounter=3Dspellcounter+1
 						local spellbutton =3D MakeBorderGumpPart(curparent, hex2num("0x837")=
, 60 + rightspacer, 20+((spellcounter+1)*15) - top_align)
@@ -175,7 +175,7 @@
 							local x,y =3D GetMousePos()
 							CreateQuickCastButton(x,y,spellname,function () =

 								-- quick cast function
-								print("CAST SPELL",spellname)
+								-- print("CAST SPELL",spellname)
 								Send_Spell(spellbutton.spell+gSpellBooks[spellbook.itemid].startin=
dex,gSpellbookExpansion["AOS"])
 							end)
 							spellbutton.gfx:SetPos(spellbutton.mStartX,spellbutton.mStartY)

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Thu Apr 17 18:12:59 2008
@@ -60,11 +60,15 @@
 			gMousePickFoundHit.hittype =3D kMousePickHitType_ContainerItem
 			gMousePickFoundHit.item =3D widget.item
 			gMousePickFoundHit.is2DHit =3D true
-		end
-		if (widget.uoPaperdoll and widget.item) then
+		elseif (widget.uoPaperdoll and widget.item) then
 			gMousePickFoundHit =3D {}
 			gMousePickFoundHit.hittype =3D kMousePickHitType_PaperdollItem
 			gMousePickFoundHit.item =3D widget.item
+			gMousePickFoundHit.is2DHit =3D true
+		elseif widget.dialog and widget.dialog.uoContainer then
+			gMousePickFoundHit =3D {}
+			gMousePickFoundHit.hittype =3D kMousePickHitType_Container
+			gMousePickFoundHit.container =3D widget.dialog.uoContainer
 			gMousePickFoundHit.is2DHit =3D true
 		end
 	end
@@ -367,13 +371,16 @@
 			self.gMousePickBBox:SetVisible(true) =

 		end
 	elseif (o.hittype =3D=3D kMousePickHitType_ContainerItem) then
-		local mouseover =3D sprintf("(ContainerItem %s)",GetStaticTileTypeName(o=
.item.artid) or "unknown")
+		local mouseover =3D sprintf("(ContainerItem %s serial=3D0x%08x)",GetStat=
icTileTypeName(o.item.artid) or "unknown", o.item.serial)
 		Client_SetBottomLine(self.gMousePickTippOverride or mouseover)
 		-- see also gCurrentRenderer.gMousePickTippOverride ./net.container.lua:=
253:	=

 	elseif (o.hittype =3D=3D kMousePickHitType_PaperdollItem) then
 		local mouseover =3D sprintf("(PaperdollItem %s)",GetStaticTileTypeName(o=
.item.artid) or "unknown")
 		Client_SetBottomLine(self.gMousePickTippOverride or mouseover)
 		-- see also gCurrentRenderer.gMousePickTippOverride ./net.paperdoll.lua:=
224:	=

+	elseif (o.hittype =3D=3D kMousePickHitType_Container) then
+		local mouseover =3D sprintf("(Container serial=3D0x%08x)",o.container.se=
rial)
+		Client_SetBottomLine(self.gMousePickTippOverride or mouseover)
 	end
 end
 =

@@ -408,6 +415,7 @@
 		if (gMousePickFoundHit.hittype =3D=3D kMousePickHitType_Mobile)  	then r=
eturn gMousePickFoundHit.mobile.serial end
 		if (gMousePickFoundHit.hittype =3D=3D kMousePickHitType_ContainerItem) t=
hen return gMousePickFoundHit.item.serial end
 		if (gMousePickFoundHit.hittype =3D=3D kMousePickHitType_PaperdollItem) t=
hen return gMousePickFoundHit.item.serial end
+		print(vardump(gMousePickFoundHit))
 	end
 	return 0
 end

Modified: trunk/lua/lib.cursor.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.cursor.lua (original)
+++ trunk/lua/lib.cursor.lua Thu Apr 17 18:12:59 2008
@@ -147,6 +147,13 @@
 		local x,y,z =3D gCurrentRenderer:GetMouseHitTileCoords()
 		Send_Target_Static(x,y,z,hitobject.entity)
 	end
+	=

+	-- ground hit
+	if (hitobject.hittype =3D=3D kMousePickHitType_Ground) then
+		bSendPos =3D false =

+
+		Send_Target_Ground(hitobject.x,hitobject.y,hitobject.z)
+	end
 		=

 	if (bSendPos) then
 		-- target ground

Modified: trunk/lua/lib.data.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.data.lua (original)
+++ trunk/lua/lib.data.lua Thu Apr 17 18:12:59 2008
@@ -147,6 +147,26 @@
 	return res
 end
 =

+-- minx,miny,maxx,maxy =3D GetArtVisibleAABB(artid) : from gArtMatCache or=
 calculateSize
+gArtMatVisibleAABBCache =3D {}
+function GetArtVisibleAABB (iArtID)
+	local res =3D gArtMatVisibleAABBCache[iArtID]
+
+	if (not res and gArtMapLoader) then
+		gArtMapLoader:Load(iArtID)
+		local minx,miny,maxx,maxy =3D gArtMapLoader:CalcVisibleAABB()
+		gArtMatVisibleAABBCache[iArtID] =3D {minx,miny,maxx,maxy}
+		return minx,miny,maxx,maxy
+	end
+
+	if (res) then
+		return unpack(res)
+	end
+	=

+	return 0, 0
+end
+
+
 -- GetArtSize from gArtMatCache or generateSize
 function GetArtSize (iArtID,iHue)
 	if (not(iHue) or (tonumber(iHue) > gMaxHueValue)) then iHue=3D0 end
@@ -182,6 +202,12 @@
 	local res =3D gGumpMatCache[iGumpID.."_"..iHue]
 	if (not res and gGumpLoader) then
 		res =3D gGumpLoader:CreateMaterial(iGumpID,true,gHueLoader,iHue)
+		=

+		if ((not res) or res =3D=3D "") then
+			print("WARNING ! MakeBorderGumpPart : material load failed for gumpid=
=3D", iGumpID)
+			res =3D "hudUnknown"
+		end
+		=

 		gGumpMatCache[iGumpID.."_"..iHue] =3D res
 	end
 	return res

Modified: trunk/lua/lib.macrolist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.macrolist.lua (original)
+++ trunk/lua/lib.macrolist.lua Thu Apr 17 18:12:59 2008
@@ -26,6 +26,8 @@
 gMacroReadMobileStats.maxMana		=3D true
 gMacroReadMobileStats.curStamina	=3D true
 gMacroReadMobileStats.maxStamina	=3D true
+gMacroReadMobileStats.curWeight		=3D true
+gMacroReadMobileStats.maxWeight		=3D true
 =

 gMacroSpellsByName =3D nil
 =

@@ -62,6 +64,21 @@
 	RegisterListener("Hook_StartTargetMode",function () =

 			if (gMacroLastTargetMemory) then CompleteTargetMode(gMacroLastTargetMem=
ory) end
 			gMacroTargetLastRunning =3D false
+			if (completefun) then completefun() end
+			return true
+		end)
+end
+
+function MacroCmd_TargetGround	(x,y,z, completefun)
+	if (gMacroWaitForTargetActive) then return end
+	gMacroWaitForTargetActive =3D true
+	RegisterListener("Hook_StartTargetMode",function () =

+			print("MacroCmd_TargetGround hook triggered")
+			if x and y and z then =

+				print("#",x,y,z)
+				CompleteTargetMode({hittype=3DkMousePickHitType_Ground,x=3Dx,y=3Dy,z=
=3Dz}) =

+			end
+			gMacroWaitForTargetActive =3D false
 			if (completefun) then completefun() end
 			return true
 		end)

Modified: trunk/lua/lib.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mousepick.lua (original)
+++ trunk/lua/lib.mousepick.lua Thu Apr 17 18:12:59 2008
@@ -4,6 +4,8 @@
 kMousePickHitType_Mobile =3D 3
 kMousePickHitType_ContainerItem =3D 4
 kMousePickHitType_PaperdollItem =3D 5
+kMousePickHitType_Container =3D 6
+kMousePickHitType_Ground =3D 7
 =

 gMousePickFoundHit =3D false
 =

@@ -63,6 +65,11 @@
 		else
 			-- TODO is this too removey?
 			-- gCurrentRenderer:DeselectMobile()
+			=

+			if not GetWidgetUnderMouse() then
+				local x,y =3D gCurrentRenderer:GetMouseHitTileCoords()
+				SetAutoWalkTo(x,y)
+			end
 		end
 	end
 end

Modified: trunk/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.tilefreewalk.lua (original)
+++ trunk/lua/lib.tilefreewalk.lua Thu Apr 17 18:12:59 2008
@@ -223,7 +223,7 @@
 			end
 		end
 	end
-	=

+
 	-- execute movement (and collision/block handling)
 	if (bMoved) then	=

 		-- block movement here
@@ -271,6 +271,16 @@
 		self:UpdateClientPosMarker()
 	end
 	=

+	-- if the player does not move due to collision stop autowalk
+	if gFreewalkLastX and gWalkPathToGo then
+		local d =3D Vector.len(Vector.sub(x,y,z, gFreewalkLastX,gFreewalkLastY,g=
FreewalkLastZ))
+		if d < 0.001 then
+			gWalkPathToGo =3D nil
+		end
+	end
+	-- store current position
+	gFreewalkLastX,gFreewalkLastY,gFreewalkLastZ =3D x,y,z
+
 	-- debug markers
 	if (gShowTileFreeDebug) then
 		local x,y,z =3D self:GetPos_LastConfirmed()

Modified: trunk/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoids.lua (original)
+++ trunk/lua/lib.uoids.lua Thu Apr 17 18:12:59 2008
@@ -172,6 +172,15 @@
     hex2num("0x02"),                       -- - Two-Hand item/weapon (incl=
uding Shield)
     hex2num("0x15"),                       -- - BackPack
     hex2num("0x0F")
+}
+
+-- you can add a paperdoll layer here with a position to overwrite the pos=
tition in paperdoll (centered)
+-- if you overwrite something the artid is used instead of the gumpid
+-- this is used for brace/ring list ob the left side of the paperdoll
+gLayerOrderPositionAndArtOverwrite =3D {
+	[0x12] =3D {8,100},	-- Earrings
+	[0x0E] =3D {8,130},	-- Bracelet
+	[0x08] =3D {8,160},	-- Ring
 }
 =

 -- Tiledata Flags

Modified: trunk/lua/net/net.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.mobile.lua (original)
+++ trunk/lua/net/net.mobile.lua Thu Apr 17 18:12:59 2008
@@ -178,7 +178,7 @@
 				gPlayerLastOverloadCheckWeight =3D stats.curWeight
 			end
 			if stats.curWeight < stats.maxWeight and gPlayerLastOverloadCheckWeight=
 then
-				AddFadeLines("Weight is normal! "..stats.curWeight.. " / "..stats.maxW=
eight)
+				AddFadeLines("Weight is normal! "..stats.curWeight.. " / "..stats.maxW=
eight,gStatsInfoFadeLineColor)
 				gPlayerLastOverloadCheckWeight =3D nil
 			end
 		end

Modified: trunk/lua/net/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.other.lua (original)
+++ trunk/lua/net/net.other.lua Thu Apr 17 18:12:59 2008
@@ -202,6 +202,7 @@
 			end
 			popupmenu.entries[i] =3D entry
 		end
+		=

 		DisplayPopupMenu(popupmenu) -- see net.popup.lua
 	end
 =


Modified: trunk/lua/net/net.uodragdrop.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.uodragdrop.lua (original)
+++ trunk/lua/net/net.uodragdrop.lua Thu Apr 17 18:12:59 2008
@@ -1,6 +1,6 @@
 -- Equip Item Request   (answer is 0x2E, see also 0x78). 0x13
 function Send_Equip_Item_Request(serial,layer,player_serial)
-	printdebug("NET","NET: Send_Equip_Item_Request:",sprintf("0x%08x",serial)=
,layer,player_serial)
+	printdebug("net","NET: Send_Equip_Item_Request:",sprintf("0x%08x",serial)=
,layer,player_serial)
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_Equip_Item_Request)
 	out:PushNetUint32(serial)
@@ -11,7 +11,7 @@
 =

 -- This is sent by the client when the player picks up an item. 0x07
 function Send_Take_Object(serial,amount)
-	--print("NET: Send_Take_Object:",sprintf("0x%08x",serial),serial,amount)
+	printdebug("net","NET: Send_Take_Object:",sprintf("0x%08x",serial),serial=
,amount)
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_Take_Object)
 	out:PushNetUint32(serial)
@@ -22,7 +22,7 @@
 -- This is sent by the client when the player drops an item. 0x08
 -- containerid =3D 0xFFFFFFFF  when the container is the ground
 function Send_Drop_Object(serial,x,y,z,containerid)
-	printdebug("NET","NET: Send_Drop_Object:",sprintf("0x%08x",serial),x,y,z,=
containerid)
+	printdebug("net","NET: Send_Drop_Object:",sprintf("0x%08x",serial),x,y,z,=
containerid)
 	local out =3D GetSendFIFO()
 	out:PushNetUint8(kPacket_Drop_Object)
 	out:PushNetUint32(serial)
@@ -50,7 +50,7 @@
 	if (reason =3D=3D hex2num("0x06")) then -- No message.
 		reasontxt =3D false
 	end
-	printdebug("NET","NET : Get_Item_Failed",reasontxt)
+	printdebug("net","NET : Get_Item_Failed",reasontxt)
 	CancelUODragDrop() -- server side cancel
 end
 =

@@ -61,13 +61,13 @@
 	local xloc =3D input:PopNetUint16()
 	local yloc =3D input:PopNetUint16()
 	-- TODO ?
-	printdebug("NET","NET : Drop_Item_Failed --> nothing todo?")
+	printdebug("net","NET : Drop_Item_Failed --> nothing todo?")
 end
 =

 -- Drop Item OK ? Paperdoll Clothing Added ? (servers response to 0x08 ?)
 function gPacketHandler.kPacket_Drop_Item_OK() -- 0x29
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
-	printdebug("NET","NET : Drop_Item_OK --> nothing todo?")
+	printdebug("net","NET : Drop_Item_OK --> nothing todo?")
 end
  =


Modified: trunk/lua/obj/obj.container.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.container.lua (original)
+++ trunk/lua/obj/obj.container.lua Thu Apr 17 18:12:59 2008
@@ -173,6 +173,8 @@
 		dialog.backpane.mbIgnoreMouseOver =3D false
 		dialog.backpane.on_mouse_right_down	=3D function (widget) CloseContainer=
(widget.dialog.uoContainer.serial) end
 		dialog.backpane.on_mouse_left_down	=3D function (widget) widget.dialog:B=
ringToFront() gui.StartMoveDialog(widget.dialog.rootwidget) end
+		=

+		NotifyListener("Hook_Open_Container", dialog, container)
 	end
 	gLastDebugContainer =3D container
 	RefreshContainerItemWidgets(container)

Modified: trunk/lua/obj/obj.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.mobile.lua (original)
+++ trunk/lua/obj/obj.mobile.lua Thu Apr 17 18:12:59 2008
@@ -202,21 +202,21 @@
 		local value =3D stats.str
 		if value and last_value and (last_value ~=3D value) then
 			-- display change
-			AddFadeLines("Attribute Strength is now "..sprintf("%3f",value).." -> "=
..sprintf("%3f",(value-last_value)),gStatsInfoFadeLineColor)
+			AddFadeLines("Attribute Strength is now "..sprintf("%3.0f",value).." ->=
 "..sprintf("%3.0f",(value-last_value)),gStatsInfoFadeLineColor)
 		end
 		=

 		last_value =3D oldstats.dex
 		value =3D stats.dex
 		if value and last_value and (last_value ~=3D value) then
 			-- display change
-			AddFadeLines("Attribute Dexterity is now "..sprintf("%3f",value).." -> =
"..sprintf("%3f",(value-last_value)),gStatsInfoFadeLineColor)
+			AddFadeLines("Attribute Dexterity is now "..sprintf("%3.0f",value).." -=
> "..sprintf("%3.0f",(value-last_value)),gStatsInfoFadeLineColor)
 		end
 		=

 		last_value =3D oldstats.int
 		value =3D stats.int
 		if value and last_value and (last_value ~=3D value) then
 			-- display change
-			AddFadeLines("Attribute Intelligence is now "..sprintf("%3f",value).." =
-> "..sprintf("%3f",(value-last_value)),gStatsInfoFadeLineColor)
+			AddFadeLines("Attribute Intelligence is now "..sprintf("%3.0f",value)..=
" -> "..sprintf("%3.0f",(value-last_value)),gStatsInfoFadeLineColor)
 		end
 	end
 	=




From no-reply at zwischenwelt.org  Fri Apr 18 13:54:29 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 18 Apr 2008 11:54:29 -0000
Subject: [Iris-commit] [IRIS] r2055 - in /trunk: bin/iris2.exe
 lua/lib.3d.mousepick.lua lua/lib.uoids.lua vs8/iris.sln vs8/iris.vcproj
Message-ID: <20080418115437.2D96F152402A@zwischenwelt.org>

Author: sience
Date: Fri Apr 18 13:54:22 2008
New Revision: 2055

Log:
-new win32 binary
-2 small fixes
-vs2005 project updates

Modified:
    trunk/bin/iris2.exe
    trunk/lua/lib.3d.mousepick.lua
    trunk/lua/lib.uoids.lua
    trunk/vs8/iris.sln
    trunk/vs8/iris.vcproj

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Fri Apr 18 13:54:22 2008
@@ -415,7 +415,7 @@
 		if (gMousePickFoundHit.hittype =3D=3D kMousePickHitType_Mobile)  	then r=
eturn gMousePickFoundHit.mobile.serial end
 		if (gMousePickFoundHit.hittype =3D=3D kMousePickHitType_ContainerItem) t=
hen return gMousePickFoundHit.item.serial end
 		if (gMousePickFoundHit.hittype =3D=3D kMousePickHitType_PaperdollItem) t=
hen return gMousePickFoundHit.item.serial end
-		print(vardump(gMousePickFoundHit))
+		--print(vardump(gMousePickFoundHit))
 	end
 	return 0
 end

Modified: trunk/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoids.lua (original)
+++ trunk/lua/lib.uoids.lua Fri Apr 18 13:54:22 2008
@@ -174,7 +174,7 @@
     hex2num("0x0F")
 }
 =

--- you can add a paperdoll layer here with a position to overwrite the pos=
tition in paperdoll (centered)
+-- you can add a paperdoll layer here with a position to overwrite the pos=
ition in paperdoll (centered)
 -- if you overwrite something the artid is used instead of the gumpid
 -- this is used for brace/ring list ob the left side of the paperdoll
 gLayerOrderPositionAndArtOverwrite =3D {

Modified: trunk/vs8/iris.sln
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.sln (original)
+++ trunk/vs8/iris.sln Fri Apr 18 13:54:22 2008
@@ -3,11 +3,8 @@
 # Visual C++ Express 2005
 Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") =3D "iris", "iris.vcproj=
", "{E2D2CF97-591B-450F-B5EA-21CB9B6A5DA5}"
 	ProjectSection(ProjectDependencies) =3D postProject
-		{5A02700F-C389-4E19-AF35-C4C893E72A64} =3D {5A02700F-C389-4E19-AF35-C4C8=
93E72A64}
 		{D7488B96-456A-1E46-8B0B-0F698E025694} =3D {D7488B96-456A-1E46-8B0B-0F69=
8E025694}
 	EndProjectSection
-EndProject
-Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") =3D "pagedgeometry_lib",=
 "..\lugre\lib\paged_geometry\vs2005\pagedgeometry_lib.vcproj", "{5A02700F-=
C389-4E19-AF35-C4C893E72A64}"
 EndProject
 Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") =3D "lua5.1_lib", "..\lu=
gre\lib\lua-5.1.3\mak.vs2005\lua5.1_lib.vcproj", "{D7488B96-456A-1E46-8B0B-=
0F698E025694}"
 EndProject
@@ -21,10 +18,6 @@
 		{E2D2CF97-591B-450F-B5EA-21CB9B6A5DA5}.Debug|Win32.Build.0 =3D Debug|Win=
32
 		{E2D2CF97-591B-450F-B5EA-21CB9B6A5DA5}.Release|Win32.ActiveCfg =3D Relea=
se|Win32
 		{E2D2CF97-591B-450F-B5EA-21CB9B6A5DA5}.Release|Win32.Build.0 =3D Release=
|Win32
-		{5A02700F-C389-4E19-AF35-C4C893E72A64}.Debug|Win32.ActiveCfg =3D Debug|W=
in32
-		{5A02700F-C389-4E19-AF35-C4C893E72A64}.Debug|Win32.Build.0 =3D Debug|Win=
32
-		{5A02700F-C389-4E19-AF35-C4C893E72A64}.Release|Win32.ActiveCfg =3D Relea=
se|Win32
-		{5A02700F-C389-4E19-AF35-C4C893E72A64}.Release|Win32.Build.0 =3D Release=
|Win32
 		{D7488B96-456A-1E46-8B0B-0F698E025694}.Debug|Win32.ActiveCfg =3D Debug|W=
in32
 		{D7488B96-456A-1E46-8B0B-0F698E025694}.Debug|Win32.Build.0 =3D Debug|Win=
32
 		{D7488B96-456A-1E46-8B0B-0F698E025694}.Release|Win32.ActiveCfg =3D Relea=
se|Win32

Modified: trunk/vs8/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.vcproj (original)
+++ trunk/vs8/iris.vcproj Fri Apr 18 13:54:22 2008
@@ -127,7 +127,7 @@
 				EnableFiberSafeOptimizations=3D"false"
 				WholeProgramOptimization=3D"true"
 				AdditionalIncludeDirectories=3D"&quot;$(INCLUDE)&quot;;&quot;c:\Progra=
mme\Microsoft Platform SDK\Include\&quot;;&quot;$(OGRE_HOME)\include\&quot;=
;&quot;$(OGRE_HOME)\include\OIS\&quot;;..\include\;..\include\zlib;..\lugre=
\include;..\include\fmodx;&quot;..\lugre\lib\lua-5.1.3\src\&quot;;..\lugre\=
lib\md5\include;..\lugre\lib\cadune_tree\include;..\lugre\lib\paged_geometr=
y\include;..\lugre\lib\caelum\include;c:\Programme\boost\boost_1_34_1\"
-				PreprocessorDefinitions=3D"WIN32;NDEBUG;_WINDOWS;MAIN_WORKING_DIR=3D\&=
quot;../\&quot;;USE_FMOD;USE_LUGRE_LIB_MD5;USE_LUGRE_LIB_CADUNE_TREE;USE_LU=
GRE_LIB_CAELUM;USE_LUGRE_LIB_PAGED_GEOMETRY"
+				PreprocessorDefinitions=3D"WIN32;NDEBUG;_WINDOWS;MAIN_WORKING_DIR=3D\&=
quot;../\&quot;;USE_FMOD;USE_LUGRE_LIB_MD5;USE_LUGRE_LIB_CADUNE_TREE;USE_LU=
GRE_LIB_CAELUM"
 				GeneratePreprocessedFile=3D"0"
 				StringPooling=3D"true"
 				RuntimeLibrary=3D"0"
@@ -151,7 +151,7 @@
 			/>
 			<Tool
 				Name=3D"VCLinkerTool"
-				AdditionalDependencies=3D"AdvAPI32.Lib User32.Lib ws2_32.lib zlib.lib =
OgreMain.lib OIS.lib lua5.1.lib fmodex_vc.lib pagedgeometry_lib.lib"
+				AdditionalDependencies=3D"AdvAPI32.Lib User32.Lib ws2_32.lib zlib.lib =
OgreMain.lib OIS.lib lua5.1.lib fmodex_vc.lib"
 				OutputFile=3D"$(OutDir)\..\..\bin\iris2.exe"
 				AdditionalLibraryDirectories=3D"&quot;$(LIB)&quot;;&quot;$(OGRE_HOME)\=
lib\&quot;;..\libs\fmodx;..\libs\zlib;&quot;..\lugre\lib\lua-5.1.3\lib\stat=
ic&quot;;&quot;c:\Programme\Microsoft Platform SDK\Lib&quot;;..\lugre\lib\c=
aelum\lib\static;..\lugre\lib\paged_geometry\lib\static;c:\Programme\boost\=
boost_1_34_1\lib"
 				GenerateManifest=3D"true"



From no-reply at zwischenwelt.org  Fri Apr 18 19:38:37 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 18 Apr 2008 17:38:37 -0000
Subject: [Iris-commit] [IRIS] r2056 - in /trunk: bin/iris2.exe
 lua/lib.cursor.lua lua/net/net.login.lua
Message-ID: <20080418173837.1CCB31C187B4@zwischenwelt.org>

Author: sience
Date: Fri Apr 18 19:38:36 2008
New Revision: 2056

Log:
-old binary taken from commit 2048
-some small writing changes

Modified:
    trunk/bin/iris2.exe
    trunk/lua/lib.cursor.lua
    trunk/lua/net/net.login.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/lib.cursor.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.cursor.lua (original)
+++ trunk/lua/lib.cursor.lua Fri Apr 18 19:38:36 2008
@@ -131,19 +131,31 @@
 	MacroRememberTarget(hitobject)
 	local bSendPos =3D true
 =

---	if (gTargetModeType =3D=3D kTargetModeType_Object) then
-		if (hitobject.hittype =3D=3D kMousePickHitType_ContainerItem)  then bSen=
dPos =3D false Send_Target_Item(hitobject.item) end =

-		if (hitobject.hittype =3D=3D kMousePickHitType_PaperdollItem)  then bSen=
dPos =3D false Send_Target_Item(hitobject.item) end
---	end
+	if (hitobject.hittype =3D=3D kMousePickHitType_ContainerItem) then
+		bSendPos =3D false
+		Send_Target_Item(hitobject.item)
+	end
+
+	if (hitobject.hittype =3D=3D kMousePickHitType_PaperdollItem) then
+		bSendPos =3D false
+		Send_Target_Item(hitobject.item)
+	end
+
 	--targetcursormodetype must be ignored!
-	if (hitobject.hittype =3D=3D kMousePickHitType_Dynamic) 		then bSendPos =
=3D false Send_Target_Dynamic(hitobject.dynamic) end
+	if (hitobject.hittype =3D=3D kMousePickHitType_Dynamic) then
+		bSendPos =3D false
+		Send_Target_Dynamic(hitobject.dynamic)
+	end
+
 	--targetcursormodetype must be ignored!
-	if (hitobject.hittype =3D=3D kMousePickHitType_Mobile)  		then bSendPos =
=3D false Send_Target_Mobile(hitobject.mobile) end =

+	if (hitobject.hittype =3D=3D kMousePickHitType_Mobile) then
+		bSendPos =3D false
+		Send_Target_Mobile(hitobject.mobile)
+	end =

 	=

 	-- in object and pos pick ?
 	if (hitobject.hittype =3D=3D kMousePickHitType_Static) then =

 		bSendPos =3D false =

-
 		local x,y,z =3D gCurrentRenderer:GetMouseHitTileCoords()
 		Send_Target_Static(x,y,z,hitobject.entity)
 	end
@@ -151,10 +163,10 @@
 	-- ground hit
 	if (hitobject.hittype =3D=3D kMousePickHitType_Ground) then
 		bSendPos =3D false =

-
 		Send_Target_Ground(hitobject.x,hitobject.y,hitobject.z)
 	end
-		=

+	=

+	-- TODO: Obsolete ?! (SiENcE)
 	if (bSendPos) then
 		-- target ground
 		local x,y,z =3D gCurrentRenderer:GetMouseHitTileCoords()

Modified: trunk/lua/net/net.login.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.login.lua (original)
+++ trunk/lua/net/net.login.lua Fri Apr 18 19:38:36 2008
@@ -77,7 +77,7 @@
 	local gameserverip =3D input:PopNetUint32()
 	local gameserverport =3D input:PopNetUint16()
 	local gameserveraccount =3D input:PopNetUint32()
-	printdebug("login",sprintf("NET: server redirect: id=3D%i ip=3D%x port=3D=
%i AccountNr.:0x%08x\n",
+	printdebug("login",sprintf("NET: server redirect: id=3D0x%08x ip=3D%x por=
t=3D%i AccountNr.:0x%08x\n",
 			id,gameserverip,gameserverport,gameserveraccount))
 	printdebug("login",sprintf("DEBUG IP STRINGS %s <> %s\n",NtoA(gameserveri=
p),GetHostByName(gLoginServerIP)))
 =




From no-reply at zwischenwelt.org  Fri Apr 18 22:49:36 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 18 Apr 2008 20:49:36 -0000
Subject: [Iris-commit] [IRIS] r2057 - in /trunk: data/config.lua.dist
 lua/gui/gui.paperdoll.lua lua/lib.mousepick.lua
Message-ID: <20080418204936.91D931C187B3@zwischenwelt.org>

Author: hagish
Date: Fri Apr 18 22:49:36 2008
New Revision: 2057

Log:
bugfix: dismount paperdoll, click on landscape does not trigger move by def=
ault

Modified:
    trunk/data/config.lua.dist
    trunk/lua/gui/gui.paperdoll.lua
    trunk/lua/lib.mousepick.lua

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Fri Apr 18 22:49:36 2008
@@ -471,4 +471,6 @@
 -- "ultralow", "low", "med", "high", "ultrahigh", "none"
 -- gGraphicProfile =3D "med"
 =

+gEnableGotoOnClick =3D false
+
 gUseWalk3 =3D false

Modified: trunk/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.paperdoll.lua (original)
+++ trunk/lua/gui/gui.paperdoll.lua Fri Apr 18 22:49:36 2008
@@ -384,7 +384,7 @@
 		local playermobile =3D GetPlayerMobile()
 		=

 		if (playermobile) then =

-			Send_DoubleClick(playermobile.serial)
+			-- Send_DoubleClick(playermobile.serial)
 			=

 			Send_ClientQuery(gRequest_States,playermobile.serial)
 			Send_ClientQuery(gRequest_Skills,playermobile.serial)
@@ -394,6 +394,20 @@
 			NET: ProtocolPacketRecvHandler typeid=3D0x3a,size=3D349,typename=3DkPac=
ket_Skills
 			(see net/net.skill.lua)
 			]]--
+			=

+			local serial =3D playermobile.serial
+			local p =3D gPaperdolls[serial]
+			=

+			if p then
+				p:Close()
+			else
+				local paperdoll =3D {}
+				paperdoll.serial	=3D serial
+				paperdoll.name		=3D playermobile.name
+				paperdoll.flag		=3D 0
+				=

+				HandleOpenPaperdoll(paperdoll)
+			end
 		end
 	end
 end

Modified: trunk/lua/lib.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mousepick.lua (original)
+++ trunk/lua/lib.mousepick.lua Fri Apr 18 22:49:36 2008
@@ -66,7 +66,7 @@
 			-- TODO is this too removey?
 			-- gCurrentRenderer:DeselectMobile()
 			=

-			if not GetWidgetUnderMouse() then
+			if gEnableGotoOnClick and not GetWidgetUnderMouse() then
 				local x,y =3D gCurrentRenderer:GetMouseHitTileCoords()
 				SetAutoWalkTo(x,y)
 			end



From no-reply at zwischenwelt.org  Sat Apr 19 00:28:33 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 18 Apr 2008 22:28:33 -0000
Subject: [Iris-commit] [IRIS] r2058 - in /trunk/lua: lib.3d.dynamic.lua
 lib.bodygfx.lua lib.corpse.lua net/net.corpse.lua obj/obj.dynamic.lua
Message-ID: <20080418222833.8A5701C186E7@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Apr 19 00:28:33 2008
New Revision: 2058

Log:
corpses

Modified:
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.bodygfx.lua
    trunk/lua/lib.corpse.lua
    trunk/lua/net/net.corpse.lua
    trunk/lua/obj/obj.dynamic.lua

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sat Apr 19 00:28:33 2008
@@ -61,9 +61,7 @@
 end
 =

 function Renderer3D:UpdateDynamicItemPos ( dynamic )
-	if (dynamic.gfx) then
-		dynamic.gfx:SetPosition(self:UOPosToLocal(dynamic.xloc + dynamic.xadd,dy=
namic.yloc + dynamic.yadd,dynamic.zloc * 0.1 + dynamic.zadd))
-	end
+	if (dynamic.gfx) then dynamic.gfx:SetPosition(self:UOPosToLocal(dynamic.x=
loc + dynamic.xadd,dynamic.yloc + dynamic.yadd,dynamic.zloc * 0.1 + dynamic=
.zadd)) end	=

 	-- TODO update dynamic fastbatch?
 end
 =

@@ -102,16 +100,47 @@
 function Renderer3D:CreateDynamicGfx( item )
 	assert(not item.gfx)
 =

-	item.artid=3DCheckIfBoat(item.artid)
-	=

-	-- TODO: check if corpse
-	-- item.artid=3DCheckIfCorpse(item.artid)
-
+	item.artid =3D CheckIfBoat(item.artid)
+	=

 	-- FILTER: get correction
 	item.xadd,item.yadd,item.zadd =3D FilterPositionXYZ(item.artid)
-
-	-- Detect Multis
-	if item.artid >=3D gMulti_ID then
+	=

+	-- check if corpse
+	local bCorpse =3D item.artid_base =3D=3D kCorpseDynamicArtID
+	=

+	local bCorpseGFX =3D false
+	if (bCorpse) then
+		-- corpse
+		print("CORPSECODE,CreateDynamicGfx corpse",item.amount)
+		bCorpseGFX =3D true
+		=

+		local bodyid =3D item.amount
+		local hue =3D 0
+		local equip =3D {}
+		local bMoving,bTurning,bWarMode,bRunFlag =3D false,false,false,false
+		item.corpsegfx =3D CreateBodyGfx()
+		item.corpsegfx:SetCorpse()
+		item.corpsegfx:MarkForUpdate(bodyid,hue,equip)
+		item.corpsegfx:Update()
+		item.corpsegfx:SetState(bMoving,bTurning,bWarMode,bRunFlag)
+		item.gfx =3D item.corpsegfx.modelgfx
+		item.gfx:SetCastShadows(gDynamicsCastShadows)
+		--~ item.gfx:SetOrientation(qw,qx,qy,qz) -- GetStaticMeshOrientation(ite=
m.artid)
+	=

+		-- just add the dynamic as a scene node
+		=

+		item.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)
+		-- set's position and add's xadd,yadd,zadd corrections
+		self:UpdateDynamicItemPos(item)
+		-- updates the layer-visibility
+		self:UpdateDynamicVisibility(item)
+	end
+	=

+	if (bCorpseGFX) then
+		-- already handled above
+	elseif item.artid >=3D gMulti_ID then =

+		-- Multis
+	=

 		printdebug("multi","-----------------------------")
 		printdebug("multi", sprintf("Multi detected with ARTID",item.artid,vardu=
mp(item)) )
 =

@@ -391,6 +420,13 @@
 	-- remove lightsource from dynamic
 	if (dynamic.lightname) then Client_RemoveLight(dynamic.lightname) dynamic=
.lightname =3D nil end
 =

+	-- remove corpsegfx entry
+	if (dynamic.corpsegfx) then
+		if (dynamic.gfx =3D=3D dynamic.corpsegfx.modelgfx) then dynamic.gfx =3D =
nil end
+		dynamic.corpsegfx:Destroy()
+		dynamic.corpsegfx =3D nil
+	end
+	=

 	-- remove dynamic entry
 	if (dynamic.gfx) then
 		dynamic.gfx:Destroy()

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Sat Apr 19 00:28:33 2008
@@ -70,23 +70,27 @@
 	return hash
 end
 =

-function BodyGfxGetStateAnimID	(bodyid,bWalk,bRun,bIdle,bHasMount,bWarMode=
,bHasStaff)	=

+function BodyGfxGetStateAnimID	(bodyid,bWalk,bRun,bIdle,bHasMount,bWarMode=
,bHasStaff,bIsCorpse)	=

 	if (not gGrannyLoaderType) then return 0 end
 	local modelinfo =3D GetGrannyModelInfo(bodyid)
 	local animtypeid =3D (modelinfo and modelinfo.typeid) or kAnimTypeID_Other
 	if (animtypeid =3D=3D kAnimTypeID_Monster) then -- monster
+		if (bIsCorpse) then return 2	end	-- 2:Die1,3:Die2
 		if (bWalk) then	return 0	end -- Walk
 		if (bRun ) then return 1	end	-- Walk/Run -- TODO : maybe fly here ? chec=
k zloc
 		if (bIdle) then return 1	end	-- Idle
 	elseif (animtypeid =3D=3D kAnimTypeID_Sea) then -- sea
+		if (bIsCorpse) then return 8	end	-- 8:Die1
 		if (bWalk) then	return 0	end -- Walk
 		if (bRun ) then return 1	end	-- Run =

 		if (bIdle) then return 2	end	-- Idle
 	elseif (animtypeid =3D=3D kAnimTypeID_Animal) then -- animal
+		if (bIsCorpse) then return 8	end	-- 8:Die1,12:Die2
 		if (bWalk) then	return 0	end -- Walk
 		if (bRun ) then return 1	end	-- Run =

 		if (bIdle) then return 2	end	-- Idle
 	elseif (animtypeid =3D=3D kAnimTypeID_Human) then -- human
+		if (bIsCorpse) then return 8	end	-- 21:Die_Hard_Fwd_01,22:Die_Hard_Back_=
01,129:die_slow_fire_01
 		if (gDisableHumanClientSideAnim) then return 4 end -- force idle
 		if (bHasMount) then =

 			if (bWalk) then	return 23	end -- Horse_Walk_01
@@ -342,6 +346,10 @@
 -- ##### ##### ##### ##### ##### anim,step
 =

 =

+function gBodyGfxPrototype:SetCorpse ()
+	self.bIsCorpse =3D true
+end
+
 function gBodyGfxPrototype:Step		()
 	-- trigger update if marked
 	if (self.bDead) then return end
@@ -355,9 +363,10 @@
 	=

 	-- anim step
 	if (self.curanimid) then -- add time and loop
-		self.animtime =3D (self.animtime or 0) + gSecondsSinceLastFrame =

+		self.animtime =3D (self.animtime or 0) + gSecondsSinceLastFrame
 		while (self.animlen > 0 and self.animtime > self.animlen) do self.animti=
me =3D self.animtime - self.animlen end =

 	end
+	if (self.bIsCorpse) then self.animtime =3D self.animlen end =

 	for k,partgfx in pairs(self.modelparts or {}) do partgfx:SetAnimTimePos(s=
elf.animtime) end -- update parts
 end
 =

@@ -400,7 +409,9 @@
 	--~ print("PartsSetAnim",bodyid,self.curanimid)
 	for k,v in pairs(self.modelparts or {}) do =

 		if (v:HasSkeleton()) then
-			v:SetAnim(animname,self.iRepeatCount ~=3D 0) -- always manual abort usi=
ng animend
+			local bLoop =3D self.iRepeatCount ~=3D 0
+			if (self.bIsCorpse) then bLoop =3D false end
+			v:SetAnim(animname,bLoop) -- always manual abort using animend
 			animlen =3D math.max(animlen,v:GetAnimLength(animname))
 			--~ print(k,animname,v:GetAnimLength(animname))
 		end
@@ -464,5 +475,5 @@
 	local bRun	=3D (not bIdle) and (self.bRunFlag and self.bMoving)
 	local bWalk	=3D (not bIdle) and (not bRun)
 	=

-	return BodyGfxGetStateAnimID(bodyid,bWalk,bRun,bIdle,mount,self.bWarMode,=
bHasStaff)
-end
+	return BodyGfxGetStateAnimID(bodyid,bWalk,bRun,bIdle,mount,self.bWarMode,=
bHasStaff,self.bIsCorpse)
+end

Modified: trunk/lua/lib.corpse.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.corpse.lua (original)
+++ trunk/lua/lib.corpse.lua Sat Apr 19 00:28:33 2008
@@ -1,6 +1,7 @@
 -- handles special cases for corpses
 -- see also net.corpse.lua
 =

+kCorpseDynamicArtID =3D 0x2006
 =

 =

 --[[
@@ -15,7 +16,7 @@
 =

 anim
 		Die_Hard_Fwd_01
-       Die_Hard_Back_01
+		Die_Hard_Back_01
 =

 =

 ./lib.packet.lua:47:gPacketType.kPacket_Death	=3D { id=3Dhex2num("0x2C") }=
 -- PCK_DeathMenu	=3D hex2num("0x2C")

Modified: trunk/lua/net/net.corpse.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.corpse.lua (original)
+++ trunk/lua/net/net.corpse.lua Sat Apr 19 00:28:33 2008
@@ -20,7 +20,7 @@
 --21	Die_Hard_Fwd_01
 --22	Die_Hard_Back_01
 --sit anim id: 76
---0x2006 - corpse schrift
+--0x2006=3DkCorpseDynamicArtID
 -- TODO : what is the result of this packet?
 function  gPacketHandler.kPacket_Corpse_Equipment() -- [0x89]
 	local input =3D GetRecvFIFO()
@@ -30,11 +30,14 @@
 =

 	printdebug("equip",sprintf("NET: kPacket_Corpse_Equipment: blocksize: %i =
container_serial=3D0x%08x\n",blocksize,container_serial))
 =

+	=

 	blocksize=3Dblocksize-7
 	=

+	print("CORPSECODE,kPacket_Corpse_Equipment",(blocksize - 1)/5)
 	while (blocksize >=3D 5) do
 		local item_layer =3D input:PopNetUint8()
 		local item_serial =3D input:PopNetUint32()
+		print("CORPSECODE,kPacket_Corpse_Equipment + ",item_layer,item_serial)
 		printdebug("equip",sprintf("NET: kPacket_Corpse_Equipment_Items: item_la=
yer: %i item_serial=3D0x%08x\n",item_layer,item_serial))
 		blocksize=3Dblocksize-5
 	end
@@ -51,6 +54,7 @@
 	local player_serial =3D input:PopNetUint32()
 	local corpse_serial =3D input:PopNetUint32()
 	local terminator =3D input:PopNetUint32()
+	print("CORPSECODE,kPacket_Death_Animation",player_serial,corpse_serial,te=
rminator)
 	printdebug("animation",sprintf("NET: kPacket_Death_Animation: player_seri=
al: 0x%08x corpse_serial=3D0x%08x\n",player_serial,corpse_serial))
 --[[
 	local anim =3D {}

Modified: trunk/lua/obj/obj.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.dynamic.lua (original)
+++ trunk/lua/obj/obj.dynamic.lua Sat Apr 19 00:28:33 2008
@@ -84,10 +84,9 @@
 	self:ApplyArtidStackManipulation()
 	=

 	=

-	-- TODO : corpse is spawned
-	if (dynamicdata and dynamicdata.artid_base =3D=3D hex2num("0x2006")) then
-		print("TODO: char died. sethue,setdirection,setascorpse")
-	end =

+	-- corspe   =

+	-- if (dynamicdata and dynamicdata.artid_base =3D=3D kCorpseDynamicArtID)=
 then ... end =

+	-- nothing needs to be done for here, see gCurrentRenderer:AddDynamicItem=
/CreateDynamicGfx
 	=

 	-- self is mobile equipment
 	local mobile =3D mobile or GetMobile(self.iContainerSerial)
@@ -103,7 +102,7 @@
 		-- dynamicdata.artid_base		=

 		-- dynamicdata.layer			=

 		-- dynamicdata.iContainerSerial -- mobile serial
-		-- dynamicdata.hue	=

+		-- dynamicdata.hue 	=

 		=

 		self.iContainerSerial =3D mobile.serial
 		=




From no-reply at zwischenwelt.org  Sat Apr 19 01:47:14 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 18 Apr 2008 23:47:14 -0000
Subject: [Iris-commit] [IRIS] r2059 - in /trunk/lua: lib.3d.dynamic.lua
 lib.3d.mousepick.lua lib.bodygfx.lua net/net.corpse.lua net/net.mobile.lua
Message-ID: <20080418234714.C789B153C005@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Apr 19 01:47:14 2008
New Revision: 2059

Log:
corpse mousepicking, human ghost model normal pose (was war), human die ani=
m draft (not for monsters, only test), human corpse anim fix, corpse hue

Modified:
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.mousepick.lua
    trunk/lua/lib.bodygfx.lua
    trunk/lua/net/net.corpse.lua
    trunk/lua/net/net.mobile.lua

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sat Apr 19 01:47:14 2008
@@ -115,7 +115,7 @@
 		bCorpseGFX =3D true
 		=

 		local bodyid =3D item.amount
-		local hue =3D 0
+		local hue =3D item.hue
 		local equip =3D {}
 		local bMoving,bTurning,bWarMode,bRunFlag =3D false,false,false,false
 		item.corpsegfx =3D CreateBodyGfx()

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Sat Apr 19 01:47:14 2008
@@ -204,7 +204,24 @@
 		if (DynamicIsInWorld(dynamic) and (dynamic.artid < gMulti_ID) and not(Is=
ArtBillboardFallBackSkipped(dynamic.artid))) then
 			-- WARNING copy & paste code
 			if (self:IsZLayerVisible(dynamic.zloc)) then
-				if (dynamic.gfx and dynamic.gfx.billboard) then
+				if (dynamic.corpsegfx) then
+					-- corpse
+					if (gbUseExactGrannyMousepicking) then =

+						-- exact granny mousepick if possible
+						for k,partgfx in pairs(dynamic.corpsegfx:GetPartGfxList()) do =

+							--print("### grannymousepick start")
+							bHit,fHitDist =3D partgfx:RayPick(rx,ry,rz,rvx,rvy,rvz)
+							--print("### grannymousepick end,",bHit)
+							--if (bHit) then print("HIT ! HIT ! HIT ! HIT ! HIT !") end
+							if (bHit and ((not gMousePickFoundHit) or fHitDist < self.gMousePic=
kFoundDist)) then
+								self.gMousePickFoundDist =3D fHitDist
+								gMousePickFoundHit =3D {}
+								gMousePickFoundHit.hittype =3D kMousePickHitType_Dynamic
+								gMousePickFoundHit.dynamic =3D dynamic
+							end
+						end
+					end
+				elseif (dynamic.gfx and dynamic.gfx.billboard) then
 					-- fallback
 					local x,y,z =3D dynamic.gfx.billboard:GetDerivedPosition()
 					fHitDist =3D SphereRayPick(x,y,z,0.5,rx,ry,rz,rvx,rvy,rvz) -- 0.5 rad

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Sat Apr 19 01:47:14 2008
@@ -5,7 +5,7 @@
 -- see also lib.3d.walksmooth.lua
 -- interesting mobile artid : 400 401 (admin robe ? or base human ?)
 =

-
+kHumanGhostBodyID =3D 402 =

 gBodyGfxPrototype =3D {}
 =

 -- see config.lua.dist for kMountZAdd
@@ -90,7 +90,7 @@
 		if (bRun ) then return 1	end	-- Run =

 		if (bIdle) then return 2	end	-- Idle
 	elseif (animtypeid =3D=3D kAnimTypeID_Human) then -- human
-		if (bIsCorpse) then return 8	end	-- 21:Die_Hard_Fwd_01,22:Die_Hard_Back_=
01,129:die_slow_fire_01
+		if (bIsCorpse) then return 21	end	-- 21:Die_Hard_Fwd_01,22:Die_Hard_Back=
_01,129:die_slow_fire_01
 		if (gDisableHumanClientSideAnim) then return 4 end -- force idle
 		if (bHasMount) then =

 			if (bWalk) then	return 23	end -- Horse_Walk_01
@@ -349,6 +349,9 @@
 function gBodyGfxPrototype:SetCorpse ()
 	self.bIsCorpse =3D true
 end
+function gBodyGfxPrototype:SetDying ()
+	self.bIsDying =3D true
+end
 =

 function gBodyGfxPrototype:Step		()
 	-- trigger update if marked
@@ -364,6 +367,7 @@
 	-- anim step
 	if (self.curanimid) then -- add time and loop
 		self.animtime =3D (self.animtime or 0) + gSecondsSinceLastFrame
+		if (self.bIsDying and self.animtime > self.animlen) then self.bIsDying =
=3D false self:SetVisible(false) end
 		while (self.animlen > 0 and self.animtime > self.animlen) do self.animti=
me =3D self.animtime - self.animlen end =

 	end
 	if (self.bIsCorpse) then self.animtime =3D self.animlen end =

@@ -474,6 +478,8 @@
 	local bIdle	=3D (not self.bTurning) and (not self.bMoving)
 	local bRun	=3D (not bIdle) and (self.bRunFlag and self.bMoving)
 	local bWalk	=3D (not bIdle) and (not bRun)
-	=

-	return BodyGfxGetStateAnimID(bodyid,bWalk,bRun,bIdle,mount,self.bWarMode,=
bHasStaff,self.bIsCorpse)
-end
+	--~ if (self.bWarMode) then print("gBodyGfxPrototype:CalcStateAnim war",s=
elf:GetBodyID()) end
+	local bIsGhost =3D self:GetBodyID() =3D=3D kHumanGhostBodyID
+	=

+	return BodyGfxGetStateAnimID(bodyid,bWalk,bRun,bIdle,mount,self.bWarMode =
and (not bIsGhost),bHasStaff,self.bIsCorpse)
+end

Modified: trunk/lua/net/net.corpse.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.corpse.lua (original)
+++ trunk/lua/net/net.corpse.lua Sat Apr 19 01:47:14 2008
@@ -56,15 +56,20 @@
 	local terminator =3D input:PopNetUint32()
 	print("CORPSECODE,kPacket_Death_Animation",player_serial,corpse_serial,te=
rminator)
 	printdebug("animation",sprintf("NET: kPacket_Death_Animation: player_seri=
al: 0x%08x corpse_serial=3D0x%08x\n",player_serial,corpse_serial))
---[[
-	local anim =3D {}
-	animdata.mobileserial	=3D corpse_serial
-	animdata.m_animation	=3D 21
-	animdata.m_framecount	=3D 120
-	animdata.m_repeat		=3D 1
-	animdata.m_animForward	=3D 0
-	animdata.m_repeatFlag	=3D 0
-	animdata.m_frameDelay	=3D hex2num("0x80")
-	gCurrentRenderer:MobileStartServerSideAnim(animdata)
-]]--
+	=

+	-- TODO : really hide the mobile for a sec or so, as an naked-mob ubdate =
packet arrives in the same frame and it's not destroyed
+	-- TODO : play anim on corpse-item if kPacket_Death_Animation is sent (no=
t if only corpse is sent, e.g. arriving in an area with old)
+	=

+	local mobile =3D GetMobile(player_serial)
+	if (mobile) then =

+		local iRepeatCount =3D 0 -- 0 =3D play once, -1 =3D loop infinity,  1:pl=
aytwice=3Drepeatonce 2:play3times...
+		if (mobile.bodygfx) then =

+			local bWalk,bRun,bIdle,bHasMount,bWarMode,bHasStaff =3D false,false,fal=
se,false,false,false
+			local bIsCorpse =3D true
+			local iAnimID =3D BodyGfxGetStateAnimID(mobile.bodygfx:GetBodyID(),bWal=
k,bRun,bIdle,bHasMount,bWarMode,bHasStaff,bIsCorpse)
+			mobile.bodygfx:SetDying()
+			mobile.bodygfx:StartAnim(iAnimID,iRepeatCount) =

+		end
+	end
+	-- similar to gCurrentRenderer:MobileStartServerSideAnim(animdata)
 end

Modified: trunk/lua/net/net.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.mobile.lua (original)
+++ trunk/lua/net/net.mobile.lua Sat Apr 19 01:47:14 2008
@@ -13,6 +13,10 @@
 	mobiledata.hue			=3D input:PopNetUint16() -- hue/skin color
 	mobiledata.flag			=3D input:PopNetUint8()
 	mobiledata.notoriety	=3D input:PopNetUint8()
+	=

+	if (mobiledata.serial =3D=3D 0x001b5369) then
+		print("CORPSECODE kPacket_Naked_MOB",mobiledata.artid,mobiledata.flag,mo=
biledata.notoriety)
+	end
 	=

 	CreateOrUpdateMobile(mobiledata)
 end



From no-reply at zwischenwelt.org  Sat Apr 19 02:07:48 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Apr 2008 00:07:48 -0000
Subject: [Iris-commit] [IRIS] r2060 - in /trunk/lua/net: net.dynamic.lua
	net.login.lua
Message-ID: <20080419000749.47F401C187B5@zwischenwelt.org>

Author: hagish
Date: Sat Apr 19 02:07:47 2008
New Revision: 2060

Log:
bugfix: pol login not working

Modified:
    trunk/lua/net/net.dynamic.lua
    trunk/lua/net/net.login.lua

Modified: trunk/lua/net/net.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.dynamic.lua (original)
+++ trunk/lua/net/net.dynamic.lua Sat Apr 19 02:07:47 2008
@@ -45,7 +45,7 @@
 		dynamicdata.amount =3D 1
 	end
 	=

-	printdebug("login",sprintf("NET: Show_Item: artid_base=3D%d artidhex=3D0x=
%04x bitwiseand=3D%d\n",
+	printdebug("net",sprintf("NET: Show_Item: artid_base=3D%d artidhex=3D0x%0=
4x bitwiseand=3D%d\n",
 				dynamicdata.artid_base,dynamicdata.artid_base,BitwiseAND(dynamicdata.a=
rtid_base,hex2num("0x8000")) )) =

 	=

 	-- dynamicdata.artid_addstack : The number to add to the item's artwork w=
hen Amount > 1.

Modified: trunk/lua/net/net.login.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.login.lua (original)
+++ trunk/lua/net/net.login.lua Sat Apr 19 02:07:47 2008
@@ -74,21 +74,28 @@
 function gPacketHandler.kPacket_Server_Redirect ()
 	local input =3D GetRecvFIFO()
 	local id =3D input:PopNetUint8()
-	local gameserverip =3D input:PopNetUint32()
+	=

+	-- local gameserverip =3D input:PopNetUint32()
+	local ip1 =3D input:PopNetUint8()
+	local ip2 =3D input:PopNetUint8()
+	local ip3 =3D input:PopNetUint8()
+	local ip4 =3D input:PopNetUint8()
+	local gameserverip =3D ip1.."."..ip2.."."..ip3.."."..ip4
+	=

 	local gameserverport =3D input:PopNetUint16()
 	local gameserveraccount =3D input:PopNetUint32()
-	printdebug("login",sprintf("NET: server redirect: id=3D0x%08x ip=3D%x por=
t=3D%i AccountNr.:0x%08x\n",
+	printdebug("login",sprintf("NET: server redirect: id=3D0x%08x ip=3D%s por=
t=3D%i AccountNr.:0x%08x\n",
 			id,gameserverip,gameserverport,gameserveraccount))
-	printdebug("login",sprintf("DEBUG IP STRINGS %s <> %s\n",NtoA(gameserveri=
p),GetHostByName(gLoginServerIP)))
+	printdebug("login",sprintf("DEBUG IP STRINGS %s <> %s\n",gameserverip,Get=
HostByName(gLoginServerIP)))
 =

 	-- login & gameserver are not the same: redirect is received
-	if ((gServerType[gServerEmulator] =3D=3D "SpherePolUox3") or (NtoA(gamese=
rverip) ~=3D GetHostByName(gLoginServerIP)) or (gameserverport ~=3D gLoginS=
erverPort)) then
+	if ((gServerType[gServerEmulator] =3D=3D "SpherePolUox3") or (gameserveri=
p ~=3D GetHostByName(gLoginServerIP)) or (gameserverport ~=3D gLoginServerP=
ort)) then
 		--disconnect from Loginserver
 		printdebug("login","NET: disconnect from loginserver")
 		NetDisconnect()
 		--connect to gameserver
 		printdebug("login","NET: connect to gameserver")
-		local res =3D NetConnectWithKey(NtoA(gameserverip),gameserverport,gamese=
rveraccount)
+		local res =3D NetConnectWithKey(gameserverip,gameserverport,gameserverac=
count)
 		if (not res) then
 			FatalErrorMessage("kPacket_Server_Redirect : login server redirect fail=
ed")
 		end



From no-reply at zwischenwelt.org  Sat Apr 19 02:16:39 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Apr 2008 00:16:39 -0000
Subject: [Iris-commit] [IRIS] r2061 - in /trunk/lua: lib.bodygfx.lua
 lib.walking2.lua obj/obj.mobile.lua obj/obj.player.lua
Message-ID: <20080419001639.5F391153C005@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Apr 19 02:16:38 2008
New Revision: 2061

Log:
ghost can walk throughd doors

Modified:
    trunk/lua/lib.bodygfx.lua
    trunk/lua/lib.walking2.lua
    trunk/lua/obj/obj.mobile.lua
    trunk/lua/obj/obj.player.lua

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Sat Apr 19 02:16:38 2008
@@ -5,7 +5,6 @@
 -- see also lib.3d.walksmooth.lua
 -- interesting mobile artid : 400 401 (admin robe ? or base human ?)
 =

-kHumanGhostBodyID =3D 402 =

 gBodyGfxPrototype =3D {}
 =

 -- see config.lua.dist for kMountZAdd
@@ -479,7 +478,7 @@
 	local bRun	=3D (not bIdle) and (self.bRunFlag and self.bMoving)
 	local bWalk	=3D (not bIdle) and (not bRun)
 	--~ if (self.bWarMode) then print("gBodyGfxPrototype:CalcStateAnim war",s=
elf:GetBodyID()) end
-	local bIsGhost =3D self:GetBodyID() =3D=3D kHumanGhostBodyID
+	local bIsGhost =3D IsGhostBodyID(self:GetBodyID())
 	=

 	return BodyGfxGetStateAnimID(bodyid,bWalk,bRun,bIdle,mount,self.bWarMode =
and (not bIsGhost),bHasStaff,self.bIsCorpse)
 end

Modified: trunk/lua/lib.walking2.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.walking2.lua (original)
+++ trunk/lua/lib.walking2.lua Sat Apr 19 02:16:38 2008
@@ -65,7 +65,16 @@
 		local t_isBridge		=3D isBridge(t.miFlags)
 		local t_isImpassable	=3D isImpassable(t.miFlags)
 		local t_isSurface		=3D isSurface(t.miFlags)
-		if ( not(t_isBridge) and not(t_isImpassable) and not(t_isSurface) ) then
+		=

+		=

+		if (IsPlayerGhost() and (	TestBit(t.miFlags, kTileDataFlag_Door) or =

+									artid =3D=3D 0x692 or =

+									artid =3D=3D 0x846 or =

+									artid =3D=3D 0x873 or =

+									(artid >=3D 0x6F5 and artid <=3D 0x6F6)
+								)) then return end -- ghost can walk through doors
+						=

+		if ( not(t_isBridge) and not(t_isImpassable) and not(t_isSurface)  ) then
 			--~ printwalkdebug("----" .. t.msName .."  !impassable  !bridge  !surfa=
ceblocking")
 		else
 			local iHeight =3D t.miHeight

Modified: trunk/lua/obj/obj.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.mobile.lua (original)
+++ trunk/lua/obj/obj.mobile.lua Sat Apr 19 02:16:38 2008
@@ -29,6 +29,9 @@
 =

 each of those is also available as method you can call like mobile:(...) w=
ithout the first param and without the Mobile_
 ]]--
+
+-- kMobileGhostArtIDs =3D {402,403,607,608,970}
+function IsGhostBodyID (bodyid) return in_array(bodyid,kMobileGhostArtIDs)=
 end
 =

 gMobilePrototype =3D {}
 gbMobileMethodWrappersInitialized =3D false
@@ -156,7 +159,7 @@
 	self:NotifyListener("Mobile_Update")
 =

 	-- currently only for human (not elfs)
-	local bIsGhost =3D	in_array(self.artid,kMobileGhostArtIDs)
+	local bIsGhost =3D IsGhostBodyID(self.artid)	=

 	if (bIsGhost ~=3D self.bIsGhost) then
 		self.bIsGhost =3D bIsGhost
 		if (bIsGhost) then

Modified: trunk/lua/obj/obj.player.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.player.lua (original)
+++ trunk/lua/obj/obj.player.lua Sat Apr 19 02:16:38 2008
@@ -25,6 +25,11 @@
 		end
 	-- else TODO : maybe check if backpack was removed ? must look if playeri=
d is available so far
 	end
+end
+
+function IsPlayerGhost ()
+	local playermobile =3D GetPlayerMobile()
+	return playermobile and playermobile.bIsGhost
 end
 =

 function GetPlayerGold ()



From no-reply at zwischenwelt.org  Sat Apr 19 02:42:26 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Apr 2008 00:42:26 -0000
Subject: [Iris-commit] [IRIS] r2062 - /trunk/lua/gui/gui.paperdoll.lua
Message-ID: <20080419004227.DD66C1C187B5@zwischenwelt.org>

Author: hagish
Date: Sat Apr 19 02:42:25 2008
New Revision: 2062

Log:
bugfix: empty tooltips in paperdoll

Modified:
    trunk/lua/gui/gui.paperdoll.lua

Modified: trunk/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.paperdoll.lua (original)
+++ trunk/lua/gui/gui.paperdoll.lua Sat Apr 19 02:42:25 2008
@@ -244,6 +244,13 @@
 		Client_SetBottomLine("")
 	end
 =

+	=

+	-- request tooltip if there is no
+	local tt =3D AosToolTip_GetText(widget.item.serial)
+	if not tt or tt =3D=3D "" then
+		Send_ToolTipRequest(widget.item.serial)
+	end
+
 	if (gTooltipSupport) then
 		widget.tooltip_offx =3D kUOToolTippOffX
 		widget.tooltip_offy =3D kUOToolTippOffY



From no-reply at zwischenwelt.org  Sat Apr 19 03:34:17 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Apr 2008 01:34:17 -0000
Subject: [Iris-commit] [IRIS] r2063 - /trunk/lua/lib.macrolist.lua
Message-ID: <20080419020018.C75EE1C1872C@zwischenwelt.org>

Author: hagish
Date: Sat Apr 19 03:34:16 2008
New Revision: 2063

Log:
add macro: wait for journal text

Modified:
    trunk/lua/lib.macrolist.lua

Modified: trunk/lua/lib.macrolist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.macrolist.lua (original)
+++ trunk/lua/lib.macrolist.lua Sat Apr 19 03:34:16 2008
@@ -195,6 +195,23 @@
 	end
 	=

 	return nil
+end
+
+-- waits until a given text appears, list =3D {text=3Dreturnvalue, text=3D=
returnvalue, ...}
+function MacroJournal_WaitForText	(list)
+	if not list then return end
+	=

+	local lastcheck =3D Client_GetTicks()
+	=

+	while true do
+		for k,v in pairs(list) do
+			if MacroJournal_FindLineContainingSince(k, lastcheck) then
+				return v
+			end
+		end
+		lastcheck =3D Client_GetTicks()
+		job.wait(500)
+	end
 end
 =

 function MacroRead_GetPlayerPosition	()



From no-reply at zwischenwelt.org  Sat Apr 19 03:45:27 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Apr 2008 01:45:27 -0000
Subject: [Iris-commit] [IRIS] r2064 - in /trunk: lua/lib.bodygfx.lua
 lua/lib.mount.lua src/data_L.cpp
Message-ID: <20080419020020.8D6AC1C18729@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Apr 19 03:45:25 2008
New Revision: 2064

Log:
mount experiments

Modified:
    trunk/lua/lib.bodygfx.lua
    trunk/lua/lib.mount.lua
    trunk/src/data_L.cpp

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Sat Apr 19 03:45:25 2008
@@ -157,6 +157,7 @@
 	local mount =3D self:GetEquipmentAtLayer(kLayer_Mount)
 	if (mount) then
 		local mountbodyid =3D gMountTranslate[mount.artid]
+		print("gBodyGfxPrototype:Update",mount.artid,mountbodyid)
 		if ((not mountbodyid) or mountbodyid =3D=3D 0) then mountbodyid =3D gSta=
ndardHorse end
 		if (mountbodyid and mountbodyid ~=3D 0) then
 			local mountskeleton =3D GetOrCreateSkeleton(mountbodyid) -- skeleton is=
 determined by the bodyid, not possible from the wearables

Modified: trunk/lua/lib.mount.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mount.lua (original)
+++ trunk/lua/lib.mount.lua Sat Apr 19 03:45:25 2008
@@ -10,65 +10,74 @@
 --// Format: <MountItemId=3Dartid> <AnimationId>
 --Version 1
 gMountTranslate =3D {}
-gMountTranslate[hex2num("0x3FFE")] =3D hex2num("0xD5") --
-gMountTranslate[hex2num("0x3FFD")] =3D hex2num("0xF1") --
-gMountTranslate[hex2num("0x3FFC")] =3D hex2num("0xF3") --
-gMountTranslate[hex2num("0x3EA2")] =3D hex2num("0xCC") --// dark brown hor=
se
-gMountTranslate[hex2num("0x3E9F")] =3D hex2num("0xC8") --// light brown ho=
rse
-gMountTranslate[hex2num("0x3EA0")] =3D hex2num("0xE2") --// light grey hor=
se
-gMountTranslate[hex2num("0x3EA1")] =3D hex2num("0xE4") --// grey brown hor=
se
-gMountTranslate[hex2num("0x3EA6")] =3D hex2num("0xDC") --// Llama
-gMountTranslate[hex2num("0x3EA3")] =3D hex2num("0xD2") --// desert ostard
-gMountTranslate[hex2num("0x3EA4")] =3D hex2num("0xDA") --// frenzied ostard
-gMountTranslate[hex2num("0x3EA5")] =3D hex2num("0xDB") --// forest ostard
-gMountTranslate[hex2num("0x3F14")] =3D hex2num("0x3C") --// drake
-gMountTranslate[hex2num("0x3FFB")] =3D hex2num("0xD5") --// unknown?
-gMountTranslate[hex2num("0x3EA7")] =3D hex2num("0xB1") --// nightmare
-gMountTranslate[hex2num("0x3EA8")] =3D hex2num("0x75") --// silver steed
-gMountTranslate[hex2num("0x3EA9")] =3D hex2num("0x72") --// nightmare
-gMountTranslate[hex2num("0x3EAA")] =3D hex2num("0x73") --// etheral
-gMountTranslate[hex2num("0x3E9F")] =3D hex2num("0xC8") --// light brown ho=
rse
-gMountTranslate[hex2num("0x3EAF")] =3D hex2num("0x78") --// war horse (blo=
od red)
-gMountTranslate[hex2num("0x3EB0")] =3D hex2num("0x79") --// war horse (lig=
ht green)
-gMountTranslate[hex2num("0x3EB1")] =3D hex2num("0x77") --// war horse (lig=
ht blue)
-gMountTranslate[hex2num("0x3EB3")] =3D hex2num("0x90") --// sea horse (med=
ium blue)
-gMountTranslate[hex2num("0x3EB5")] =3D hex2num("0x74") --// nightmare
-gMountTranslate[hex2num("0x3EB6")] =3D hex2num("0xB2") --// nightmare 4
-gMountTranslate[hex2num("0x3EAD")] =3D hex2num("0x84") --// kirin
-gMountTranslate[hex2num("0x3EB2")] =3D hex2num("0x76") --// war horse (pur=
ple)
-gMountTranslate[hex2num("0x3EB7")] =3D hex2num("0xB3") --// dark steed
-gMountTranslate[hex2num("0x3EB8")] =3D hex2num("0xBB") --// ridgeback
-gMountTranslate[hex2num("0x3EBA")] =3D hex2num("0xBC") --// savage ridgeba=
ck
-gMountTranslate[hex2num("0x3E9E")] =3D hex2num("0xBE") --
-gMountTranslate[hex2num("0x3E93")] =3D hex2num("0xFB") -- // test
-gMountTranslate[hex2num("0x3EBB")] =3D hex2num("0x319") -- // skeletal mou=
nt
-gMountTranslate[hex2num("0x3EBC")] =3D hex2num("0x317") -- // beetle
-gMountTranslate[hex2num("0x3EBD")] =3D hex2num("0x31A") -- // swampdragon
-gMountTranslate[hex2num("0x3EBE")] =3D hex2num("0x31F") -- // armored swam=
p dragon
-gMountTranslate[hex2num("0x3E92")] =3D hex2num("0x11C") -- // mondain steed
-gMountTranslate[hex2num("0x3E94")] =3D hex2num("0xF3") -- // hiryu
+gMountTranslate[0x3EAA] =3D 0x73 --//=3D115, 0x20DD,  Ethereal Horse
+gMountTranslate[0x3EAB] =3D 0xAA --//=3D170, 0x20F6,  Ethereal Llama			 =

+gMountTranslate[0x3EAC] =3D 0xAB --//=3D171, 0x2135,  Ethereal Ostard			 =

+gMountTranslate[0x3E9A] =3D 0xC1 --//=3D193, 0x2615,  Ethereal Ridgeback		 =

+gMountTranslate[0x3E9B] =3D 0xC0 --//=3D192, 0x25CE,  Ethereal Unicorn			 =

+gMountTranslate[0x3E97] =3D 0xC3 --//=3D195, 0x260F,  Ethereal Beetle			 =

+gMountTranslate[0x3E9C] =3D 0xBF --//=3D191, 0x25A0,  Ethereal Kirin			 =

+gMountTranslate[0x3E98] =3D 0xC2 --//=3D194, 0x2619,  Ethereal SwampDragon=
		 =

+  =

+gMountTranslate[0x3FFE] =3D 0xD5  --
+gMountTranslate[0x3FFD] =3D 0xF1  --
+gMountTranslate[0x3FFC] =3D 0xF3  --
+gMountTranslate[0x3EB4] =3D 0x7A  --// unicorn
+gMountTranslate[0x3EA2] =3D 0xCC  --// dark brown horse
+gMountTranslate[0x3E9F] =3D 0xC8  --// light brown horse
+gMountTranslate[0x3EA0] =3D 0xE2  --// light grey horse
+gMountTranslate[0x3EA1] =3D 0xE4  --// grey brown horse
+gMountTranslate[0x3EA6] =3D 0xDC  --// Llama
+gMountTranslate[0x3EA3] =3D 0xD2  --// desert ostard
+gMountTranslate[0x3EA4] =3D 0xDA  --// frenzied ostard
+gMountTranslate[0x3EA5] =3D 0xDB  --// forest ostard
+gMountTranslate[0x3F14] =3D 0x3C  --// drake
+gMountTranslate[0x3FFB] =3D 0xD5  --// unknown?
+gMountTranslate[0x3EA7] =3D 0x74  --// nightmare 0xB1 ?
+gMountTranslate[0x3EA8] =3D 0x75  --// silver steed
+gMountTranslate[0x3EA9] =3D 0x72  --// nightmare
+gMountTranslate[0x3E9F] =3D 0xC8  --// light brown horse
+gMountTranslate[0x3EAF] =3D 0x78  --// war horse (blood red)
+gMountTranslate[0x3EB0] =3D 0x79  --// war horse (light green)
+gMountTranslate[0x3EB1] =3D 0x77  --// war horse (light blue)
+gMountTranslate[0x3EB3] =3D 0x90  --// sea horse (medium blue)
+gMountTranslate[0x3EB5] =3D 0x74  --// nightmare
+gMountTranslate[0x3EB6] =3D 0xB2  --// nightmare 4
+gMountTranslate[0x3EAD] =3D 0x84  --// kirin
+gMountTranslate[0x3EB2] =3D 0x76  --// war horse (purple)
+gMountTranslate[0x3EB7] =3D 0xB3  --// dark steed
+gMountTranslate[0x3EB8] =3D 0xBB  --// ridgeback
+gMountTranslate[0x3EBA] =3D 0xBC  --// savage ridgeback
+gMountTranslate[0x3E9E] =3D 0xBE  --
+gMountTranslate[0x3E93] =3D 0xFB  -- // test
+gMountTranslate[0x3EBB] =3D 0x319 -- // skeletal mount
+gMountTranslate[0x3EBC] =3D 0x317 -- // beetle
+gMountTranslate[0x3EBD] =3D 0x31A -- // swampdragon
+gMountTranslate[0x3EBE] =3D 0x31F -- // armored swamp dragon
+gMountTranslate[0x3E92] =3D 0x11C -- // mondain steed
+gMountTranslate[0x3E94] =3D 0xF3  -- // hiryu
 =

 gMountTranslate2D =3D {}
 for k,v in pairs(gMountTranslate) do gMountTranslate2D[k] =3D v end -- a c=
opy of the original data without granny overrides for varan
 =

 -- currently broken granny anims
 gMountGrannyOverride =3D {}
-gMountGrannyOverride[hex2num("0xCC")] =3D gStandardHorse
-gMountGrannyOverride[hex2num("0xE2")] =3D gStandardHorse =

-gMountGrannyOverride[hex2num("0xE4")] =3D gStandardHorse
-gMountGrannyOverride[hex2num("0xB1")] =3D gStandardHorse =

-gMountGrannyOverride[hex2num("0x75")] =3D gStandardHorse =

-gMountGrannyOverride[hex2num("0x72")] =3D gStandardHorse =

-gMountGrannyOverride[hex2num("0x73")] =3D gStandardHorse =

-gMountGrannyOverride[hex2num("0x74")] =3D gStandardHorse =

-gMountGrannyOverride[hex2num("0xB2")] =3D gStandardHorse =

-gMountGrannyOverride[hex2num("0xB3")] =3D gStandardHorse =

-gMountGrannyOverride[hex2num("0xBE")] =3D gStandardHorse =

-gMountGrannyOverride[hex2num("0x123")] =3D hex2num("0x76") -- packhorse, n=
ot C8 (standardhorse) =

-gMountGrannyOverride[hex2num("0x317")] =3D gStandardHorse
-gMountGrannyOverride[hex2num("0x31A")] =3D gStandardHorse
-gMountGrannyOverride[hex2num("0x31F")] =3D gStandardHorse
-gMountGrannyOverride[hex2num("0x11C")] =3D gStandardHorse
+gMountGrannyOverride[0xCC] =3D gStandardHorse
+gMountGrannyOverride[0xE2] =3D gStandardHorse =

+gMountGrannyOverride[0xE4] =3D gStandardHorse
+gMountGrannyOverride[0xB1] =3D gStandardHorse =

+gMountGrannyOverride[0x75] =3D gStandardHorse =

+gMountGrannyOverride[0x72] =3D gStandardHorse =

+gMountGrannyOverride[0x73] =3D gStandardHorse =

+gMountGrannyOverride[0x74] =3D gStandardHorse =

+gMountGrannyOverride[0xB2] =3D gStandardHorse =

+gMountGrannyOverride[0xB3] =3D gStandardHorse =

+gMountGrannyOverride[0xBE] =3D gStandardHorse =

+gMountGrannyOverride[0x123] =3D hex2num("0x76") -- packhorse, not C8 (stan=
dardhorse) =

+gMountGrannyOverride[0x317] =3D gStandardHorse
+gMountGrannyOverride[0x31A] =3D gStandardHorse
+gMountGrannyOverride[0x31F] =3D gStandardHorse
+gMountGrannyOverride[0x11C] =3D gStandardHorse
 for k,v in pairs(gMountTranslate) do if (gMountGrannyOverride[v]) then gMo=
untTranslate[k] =3D gMountGrannyOverride[v] end end
 =

 --[[
@@ -114,4 +123,46 @@
 swampdragon=3D0x3EBD
 armorswampdragon=3D0x3EBE
 kirin=3D0x3EAD
+
+
+RunUO1.0/Scripts/Engines/Factions/Mobiles/FactionWarHorse.cs:8:	public cla=
ss FactionWarHorse : BaseMount
+RunUO1.0/Scripts/Mobiles/Animals/Mounts :  int bodyID, int itemID,
+
+artid=3D8502	artid=3D0x2136	animid=3D0	animid=3D0x0000	frenzied ostard
+artid=3D9652	artid=3D0x25b4	animid=3D0	animid=3D0x0000	Frenzied Ostard
+
+FactionWarHorse			 0xE2	, 0x3EA0
+RidableLlama			 0xDC	, 0x3EA6
+Kirin					 0x84	, 0x3EAD
+DesertOstard			 0xD2	, 0x3EA3
+FireSteed				 0xBE	, 0x3E9E
+FrenziedOstard			 0xDA	, 0x3EA4
+SeaHorse				 0x90	, 0x3EB3
+Nightmare				 0x74	, 0x3EA7
+Ridgeback				 0xBB	, 0x3EBA
+ScaledSwampDragon		 0x31F	, 0x3EBE
+SilverSteed				 0x75	, 0x3EA8
+Horse					 0xE2	, 0x3EA0
+SwampDragon				 0x31A	, 0x3EBD
+CoMWarHorse				 0x77	, 0x3EB1
+MinaxWarHorse			 0x78	, 0x3EAF
+TBWarHorse				 0x76	, 0x3EB2
+SLWarHorse				 0x79	, 0x3EB0
+SkeletalMount			 0x319	, 0x3EBB
+HellSteed				 0x319	, 0x3EBB
+ForestOstard			 0xDB	, 0x3EA5
+Beetle					 0x317	, 0x3EBC
+Unicorn					 0x7A	, 0x3EB4
+SavageRidgeback			 0xBC	, 0x3EB8
+                  	 =

+
+EtherealHorse			 0x20DD, 0x3EAA    EtherealMount( int itemID, int mountID )
+EtherealLlama			 0x20F6, 0x3EAB =

+EtherealOstard			 0x2135, 0x3EAC =

+EtherealRidgeback		 0x2615, 0x3E9A =

+EtherealUnicorn			 0x25CE, 0x3E9B =

+EtherealBeetle			 0x260F, 0x3E97 =

+EtherealKirin			 0x25A0, 0x3E9C =

+EtherealSwampDragon		 0x2619, 0x3E98 =

+
 ]]--

Modified: trunk/src/data_L.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data_L.cpp (original)
+++ trunk/src/data_L.cpp Sat Apr 19 03:45:25 2008
@@ -423,8 +423,9 @@
 		static int	GetStaticTileType	(lua_State *L) { PROFILE =

 			cStaticTileType* pChunk =3D checkudata_alive(L)->GetStaticTileType(luaL=
_checkint(L,2));
 			RawStaticTileType* pRawChunk =3D pChunk ? pChunk->mpRawStaticTileType :=
 0;
-			if (!pRawChunk) { printf("GetStaticTileType : id (%d) not found c=3D%08=
x,rc=3D%08x\n",luaL_checkint(L,2),pChunk,pRawChunk);return 0; }
-			if (!pRawChunk) { MyCrash("GetStaticTileType debug\n"); }
+			//~ if (!pRawChunk) { printf("GetStaticTileType : id (%d) not found c=
=3D%08x,rc=3D%08x\n",luaL_checkint(L,2),pChunk,pRawChunk);return 0; }
+			//~ if (!pRawChunk) { MyCrash("GetStaticTileType debug\n"); }
+			if (!pRawChunk) return 0;
 			lua_pushnumber(L,pRawChunk->miFlags); =

 			lua_pushnumber(L,pRawChunk->miWeight); =

 			lua_pushnumber(L,pRawChunk->miQuality); =




From no-reply at zwischenwelt.org  Sat Apr 19 03:59:54 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Apr 2008 01:59:54 -0000
Subject: [Iris-commit] [IRIS] r2065 - in /trunk/lua: lib.bodygfx.lua
	lib.debugmenu.lua lib.mount.lua
Message-ID: <20080419020021.436A61C18729@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Apr 19 03:59:53 2008
New Revision: 2065

Log:
mount hue override to improve eth-transparency problems a bit

Modified:
    trunk/lua/lib.bodygfx.lua
    trunk/lua/lib.debugmenu.lua
    trunk/lua/lib.mount.lua

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Sat Apr 19 03:59:53 2008
@@ -157,7 +157,7 @@
 	local mount =3D self:GetEquipmentAtLayer(kLayer_Mount)
 	if (mount) then
 		local mountbodyid =3D gMountTranslate[mount.artid]
-		print("gBodyGfxPrototype:Update",mount.artid,mountbodyid)
+		print("gBodyGfxPrototype:Update",mount.artid,mountbodyid,mount.hue)
 		if ((not mountbodyid) or mountbodyid =3D=3D 0) then mountbodyid =3D gSta=
ndardHorse end
 		if (mountbodyid and mountbodyid ~=3D 0) then
 			local mountskeleton =3D GetOrCreateSkeleton(mountbodyid) -- skeleton is=
 determined by the bodyid, not possible from the wearables
@@ -171,7 +171,7 @@
 			=

 			if (not self.modelmountgfx) then self.modelmountgfx =3D CreateBodyGfx(s=
elf.modelgfx) end
 			self.modelmountgfx.artid =3D 0
-			self.modelmountgfx.hue =3D mount.hue or 0
+			self.modelmountgfx.hue =3D gMountHueOverride[mount.artid] or mount.hue =
or 0
 			self.modelmountgfx.equipmentlist =3D {}
 			self.modelmountgfx.bodyid =3D mountbodyid
 			self.modelmountgfx:SetState(self.bMoving,self.bTurning,self.bWarMode,se=
lf.bRunFlag)

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Sat Apr 19 03:59:53 2008
@@ -38,6 +38,8 @@
 --removed duplicates by hand
 --commented ones crashes (no shaders used)
 gDebugMenuModelTable =3D {
+	{artid=3D170 , hue=3D16385, content=3D{}}, -- eth llama original vm hue  =
16043   170     16385
+
 	--female
 	{artid=3D401, content=3D{}},
 	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
@@ -45,6 +47,7 @@
 	{artid=3D400, content=3D{}},
 	{artid=3D400, content=3D({{artid=3D5905,animid=3D476},{artid=3D5422,animi=
d=3D430},{artid=3D7933,animid=3D435},{artid=3D5909,animid=3D406},{artid=3D5=
441,animid=3D490},{artid=3D3701,animid=3D422},{artid=3D8251,animid=3D700},}=
)},
 =

+	=

 	{artid=3D153 , content=3D{}}, 	--walking_dead_ghoul
 	{artid=3D154 , content=3D{}}, 	--walking_dead_mummy
 	{artid=3D155 , content=3D{}}, 	--walking_dead_rotting_corpse

Modified: trunk/lua/lib.mount.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mount.lua (original)
+++ trunk/lua/lib.mount.lua Sat Apr 19 03:59:53 2008
@@ -9,6 +9,7 @@
 --// List of all MountItems and their corresponding AnimationIDs
 --// Format: <MountItemId=3Dartid> <AnimationId>
 --Version 1
+gMountHueOverride =3D {}
 gMountTranslate =3D {}
 gMountTranslate[0x3EAA] =3D 0x73 --//=3D115, 0x20DD,  Ethereal Horse
 gMountTranslate[0x3EAB] =3D 0xAA --//=3D170, 0x20F6,  Ethereal Llama			 =

@@ -17,7 +18,17 @@
 gMountTranslate[0x3E9B] =3D 0xC0 --//=3D192, 0x25CE,  Ethereal Unicorn			 =

 gMountTranslate[0x3E97] =3D 0xC3 --//=3D195, 0x260F,  Ethereal Beetle			 =

 gMountTranslate[0x3E9C] =3D 0xBF --//=3D191, 0x25A0,  Ethereal Kirin			 =

-gMountTranslate[0x3E98] =3D 0xC2 --//=3D194, 0x2619,  Ethereal SwampDragon=
		 =

+gMountTranslate[0x3E98] =3D 0xC2 --//=3D194, 0x2619,  Ethereal SwampDragon=
		=

+
+-- override eth hues to zero, to avoid errors
+gMountHueOverride[0x3EAA] =3D 0 =

+gMountHueOverride[0x3EAB] =3D 0 =

+gMountHueOverride[0x3EAC] =3D 0 =

+gMountHueOverride[0x3E9A] =3D 0 =

+gMountHueOverride[0x3E9B] =3D 0 =

+gMountHueOverride[0x3E97] =3D 0 =

+gMountHueOverride[0x3E9C] =3D 0 =

+gMountHueOverride[0x3E98] =3D 0 =

   =

 gMountTranslate[0x3FFE] =3D 0xD5  --
 gMountTranslate[0x3FFD] =3D 0xF1  --



From no-reply at zwischenwelt.org  Sat Apr 19 04:29:35 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Apr 2008 02:29:35 -0000
Subject: [Iris-commit] [IRIS] r2066 - in /trunk: lua/gui/gui.paperdoll.lua
 lua/lib.data.lua lua/lib.uoids.lua src/data.cpp
Message-ID: <20080419022935.A33F0153C005@zwischenwelt.org>

Author: hagish
Date: Sat Apr 19 04:29:34 2008
New Revision: 2066

Log:
bugfix: correct brace and stuff positions in paperdoll

Modified:
    trunk/lua/gui/gui.paperdoll.lua
    trunk/lua/lib.data.lua
    trunk/lua/lib.uoids.lua
    trunk/src/data.cpp

Modified: trunk/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.paperdoll.lua (original)
+++ trunk/lua/gui/gui.paperdoll.lua Sat Apr 19 04:29:34 2008
@@ -216,8 +216,8 @@
 		local x,y =3D unpack(gLayerOrderPositionAndArtOverwrite[layer])
 		=

 		local minx,miny,maxx,maxy =3D GetArtVisibleAABB(item.artid + 16384)
-		local cx =3D (maxx - minx)/2
-		local cy =3D (maxy - miny)/2
+		local cx =3D minx + (maxx - minx)/2
+		local cy =3D miny + (maxy - miny)/2
 =

 		widget =3D MakeArtGumpPart(  dialog.rootwidget, item.artid, x-cx,y-cy, n=
il,nil,nil, item.hue)
 	else

Modified: trunk/lua/lib.data.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.data.lua (original)
+++ trunk/lua/lib.data.lua Sat Apr 19 04:29:34 2008
@@ -156,6 +156,7 @@
 		gArtMapLoader:Load(iArtID)
 		local minx,miny,maxx,maxy =3D gArtMapLoader:CalcVisibleAABB()
 		gArtMatVisibleAABBCache[iArtID] =3D {minx,miny,maxx,maxy}
+		=

 		return minx,miny,maxx,maxy
 	end
 =


Modified: trunk/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoids.lua (original)
+++ trunk/lua/lib.uoids.lua Sat Apr 19 04:29:34 2008
@@ -178,9 +178,9 @@
 -- if you overwrite something the artid is used instead of the gumpid
 -- this is used for brace/ring list ob the left side of the paperdoll
 gLayerOrderPositionAndArtOverwrite =3D {
-	[0x12] =3D {8,100},	-- Earrings
-	[0x0E] =3D {8,130},	-- Bracelet
-	[0x08] =3D {8,160},	-- Ring
+	[0x12] =3D {14,100},	-- Earrings
+	[0x0E] =3D {14,120},	-- Bracelet
+	[0x08] =3D {14,140},	-- Ring
 }
 =

 -- Tiledata Flags

Modified: trunk/src/data.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data.cpp (original)
+++ trunk/src/data.cpp Sat Apr 19 04:29:34 2008
@@ -664,10 +664,11 @@
 	bool found =3D false;
 	=

 	int offset;
-	for(int x=3D0;x<w;++x){
-		for(int y=3D0;y<h;++y){
+	// this ignores and 1px border because of broken images or strange data i=
n the border
+	for(int y=3D1;y<h-2;++y){
+		for(int x=3D1;x<w-2;++x){
 			offset =3D y*w+x;
-			if(pBuffer[offset] !=3D 0){
+			if(pBuffer[offset]){
 				if(!found){
 					minx =3D x;
 					maxx =3D x;



From no-reply at zwischenwelt.org  Sat Apr 19 05:23:44 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Apr 2008 03:23:44 -0000
Subject: [Iris-commit] [IRIS] r2067 - in /trunk/lua: lib.bodygfx.lua
 lib.debugmenu.lua lib.granny.lua lib.mount.lua
Message-ID: <20080419032346.369671C187B4@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Apr 19 05:23:44 2008
New Revision: 2067

Log:
looked through granny models, added two that caused client crash to skiplis=
t, fixed crash when missing skeleton, added a few interesting ones to list =
in debugmenu

Modified:
    trunk/lua/lib.bodygfx.lua
    trunk/lua/lib.debugmenu.lua
    trunk/lua/lib.granny.lua
    trunk/lua/lib.mount.lua

Modified: trunk/lua/lib.bodygfx.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.bodygfx.lua (original)
+++ trunk/lua/lib.bodygfx.lua Sat Apr 19 05:23:44 2008
@@ -283,7 +283,7 @@
 function CreateBodyGfxPartsFromModelIDArray (bodyid,parentgfx,partsarr,mod=
elidarr,iPrimaryHandItem,iSecondaryHandItem)
 	if (not gGrannyLoaderType) then return end
 	local skeleton =3D GetOrCreateSkeleton(bodyid) -- skeleton is determined =
by the bodyid, not possible from the wearables
-	local skeleton_name =3D skeleton.name
+	local skeleton_name =3D skeleton and skeleton.name or "unknown_skeleton"
 	printdebug("granny","CreateBodyGfxPartsFromModelIDArray...",bodyid,bodyid=
,skeleton_name)
 	local leftHandEntity1
 	local leftHandEntity2

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Sat Apr 19 05:23:44 2008
@@ -37,9 +37,47 @@
 --used regular expression to make these "^(\d+)(.*?\s){8}(.*?)[\s]{0,}$" a=
nd replace with "{artid=3D$1 , content=3D{}}, \t--$3" in PSpad
 --removed duplicates by hand
 --commented ones crashes (no shaders used)
+
+
+
 gDebugMenuModelTable =3D {
+	{artid=3D0x25d , content=3D{}}, -- another human male			-- maybe samurai/=
elven scale ??
+	{artid=3D0x25e , content=3D{}}, -- another human female			-- maybe samura=
i/elven scale ??
+	{artid=3D0x25f , content=3D{}}, -- another human male			-- maybe samurai/=
elven scale ??
+	{artid=3D0x260 , content=3D{}}, -- another human male-taller	-- maybe sam=
urai/elven scale ??
+	{artid=3D0x2e8 , content=3D{}}, -- another human male			-- maybe samurai/=
elven scale ??
+	{artid=3D0x2e9 , content=3D{}}, -- another human female			-- maybe samura=
i/elven scale ??
+	{artid=3D0x2ee , content=3D{}}, -- another human 				-- maybe samurai/elv=
en scale ??
+	{artid=3D0x2ef , content=3D{}}, -- another human 				-- maybe samurai/elv=
en scale ??
+	{artid=3D0x3ca , content=3D{}}, -- another human 				-- maybe samurai/elv=
en scale ??
+	{artid=3D0x3db , content=3D{}}, -- another human 				-- maybe samurai/elv=
en scale ??
+	{artid=3D0x3df , content=3D{}}, -- another human 				-- maybe samurai/elv=
en scale ??
+	{artid=3D0x3e2 , content=3D{}}, -- another human 				-- maybe samurai/elv=
en scale ??
+	{artid=3D0x194 , content=3D{}}, -- 0x194 and following : equipment and cl=
othing
+	{artid=3D0x57c , content=3D{}}, -- 0x57c and following : equipment and cl=
othing
+	{artid=3D0x314 , content=3D{}}, -- bad scale (too large)
+	{artid=3D0x315 , content=3D{}}, -- bad scale (too large)
+	{artid=3D0x11c , content=3D{}}, -- broken anim
+	{artid=3D0x138 , content=3D{}}, -- broken anim
+	{artid=3D0x13a , content=3D{}}, -- broken anim
+	{artid=3D0x13b , content=3D{}}, -- broken anim
+	{artid=3D0x13c , content=3D{}}, -- broken anim
+	{artid=3D0x13f , content=3D{}}, -- broken anim
+	{artid=3D0x2ea , content=3D{}}, -- broken anim
+	{artid=3D0x2f0 , content=3D{}}, -- broken anim
+	{artid=3D0x307 , content=3D{}}, -- broken anim
+	{artid=3D0x309 , content=3D{}}, -- broken anim
+	{artid=3D0x311 , content=3D{}}, -- broken anim
+	{artid=3D0x317 , content=3D{}}, -- broken anim
+	{artid=3D0x31a , content=3D{}}, -- broken anim
+	{artid=3D0x31d , content=3D{}}, -- broken anim
+	{artid=3D0x31e , content=3D{}}, -- broken anim
+	{artid=3D0x31f , content=3D{}}, -- broken anim
 	{artid=3D170 , hue=3D16385, content=3D{}}, -- eth llama original vm hue  =
16043   170     16385
 =

+	{artid=3D0xdad , content=3D{}}, -- cloak anim frame a
+	{artid=3D0xdac , content=3D{}}, -- cloak anim frame b
+	=

 	--female
 	{artid=3D401, content=3D{}},
 	{artid=3D401, content=3D({{artid=3D5899,animid=3D477},{artid=3D5422,animi=
d=3D430},{artid=3D5399,animid=3D434},{artid=3D5435,animid=3D466},{artid=3D8=
251,animid=3D700},{artid=3D3701,animid=3D422},})},
@@ -405,7 +443,13 @@
 --#Time Lord
 =

 	{artid=3D689 , content=3D{}}, 	--shadowlords_shadowlord
-	{artid=3D704 , content=3D{}} 	--shadowlords_shadowlord
+	{artid=3D704 , content=3D{}}, 	--shadowlords_shadowlord
+	=

+	=

+	{artid=3D0x101 , content=3D{}}, 	--client crash, see also gBrokenGrannyMo=
delIdList
+	{artid=3D0x306 , content=3D{}}, 	--client crash, see also gBrokenGrannyMo=
delIdList
+	=

+	=

 --[[
 --------------------------------------------------------------------------
 --				custom assigned Models (only for testing)
@@ -528,6 +572,8 @@
 	{artid=3D3012, content=3D{}},
 ]]--
 }
+
+
 =

 -- 0:none 1:normal 2:invert 3:sample 4:sample-invert		-- bonestart
 -- 0:nothin 1:q 2:q.Inverse()							-- translationchange
@@ -631,6 +677,17 @@
 end
 =

 function StartDebugMenu ()
+
+
+	if (true) then
+		gDebugMenuModelTable =3D {}
+		kDebugMenuModelTable_EmptyContents =3D {}
+		for i=3D0xC00,0xFff do  -- max =3D 0x0f6b
+			if (GetGrannyModelInfo(i)) then table.insert(gDebugMenuModelTable,{arti=
d=3Di,content=3DkDebugMenuModelTable_EmptyContents}) end
+		end
+	end
+
+
 	-- dont show fallback boxes in debug mode
 	gUseWhiteBoxAsFallBack =3D false
 =


Modified: trunk/lua/lib.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.granny.lua (original)
+++ trunk/lua/lib.granny.lua Sat Apr 19 05:23:44 2008
@@ -9,6 +9,11 @@
 -- 0	Walk_01
 =

 -- uo/Models/Humans/H_Male_Walk_01.grn
+
+gBrokenGrannyModelIdList =3D {} -- TODO : those load to crash and are skip=
ped
+gBrokenGrannyModelIdList[0x101] =3D true -- client crash
+gBrokenGrannyModelIdList[0x306] =3D true -- client crash
+
 =

 gGrannyTypeAnimListFiles =3D {[0]=3D"Monster.lst",[1]=3D"Sea.lst",[2]=3D"A=
nimal.lst",[3]=3D"Human.lst"}
 gSkeletons =3D {}
@@ -394,7 +399,14 @@
 end
 =

 function GetGrannyModelInfo (modelid) =

-	if (not gGrannyModelInfo) then gGrannyModelInfo =3D LoadGrannyModelInfo( =
CorrectGrannyPath(gGrannyConfigFile) ) end
+	if (not gGrannyModelInfo) then =

+		gGrannyModelInfo =3D LoadGrannyModelInfo( CorrectGrannyPath(gGrannyConfi=
gFile) ) =

+		--~ local kmax =3D 0
+		--~ for k,v in pairs(gGrannyModelInfo) do kmax =3D math.max(kmax,k) end
+		--~ print("GetGrannyModelInfo : maxmodelid =3D ",kmax,sprintf("0x%04x",k=
max))
+	end
+	=

+	if (gBrokenGrannyModelIdList[modelid]) then return nil end
 	return gGrannyModelInfo[modelid]
 end
 =


Modified: trunk/lua/lib.mount.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mount.lua (original)
+++ trunk/lua/lib.mount.lua Sat Apr 19 05:23:44 2008
@@ -4,7 +4,7 @@
 -- we couldn't find any "trick" to get the correct anim id, so it seems to=
 be hardcoded
 =

 =

-gStandardHorse =3D hex2num("0xC8")
+gStandardHorse =3D hex2num("0xC8")  -- 0x334(med-brown) 0x338(dark brown) =
0x34e(dark-gray) 0x350(light brown)
 =

 --// List of all MountItems and their corresponding AnimationIDs
 --// Format: <MountItemId=3Dartid> <AnimationId>
@@ -21,19 +21,24 @@
 gMountTranslate[0x3E98] =3D 0xC2 --//=3D194, 0x2619,  Ethereal SwampDragon=
		=

 =

 -- override eth hues to zero, to avoid errors
-gMountHueOverride[0x3EAA] =3D 0 =

-gMountHueOverride[0x3EAB] =3D 0 =

-gMountHueOverride[0x3EAC] =3D 0 =

-gMountHueOverride[0x3E9A] =3D 0 =

-gMountHueOverride[0x3E9B] =3D 0 =

-gMountHueOverride[0x3E97] =3D 0 =

-gMountHueOverride[0x3E9C] =3D 0 =

-gMountHueOverride[0x3E98] =3D 0 =

+gMountHueOverride[0x3EAA] =3D 0 --Ethereal Horse
+gMountHueOverride[0x3EAB] =3D 0 --Ethereal Llama		=

+gMountHueOverride[0x3EAC] =3D 0 --Ethereal Ostard		=

+gMountHueOverride[0x3E9A] =3D 0 --Ethereal Ridgeback	=

+gMountHueOverride[0x3E9B] =3D 0 --Ethereal Unicorn		=

+gMountHueOverride[0x3E97] =3D 0 --Ethereal Beetle		=

+gMountHueOverride[0x3E9C] =3D 0 --Ethereal Kirin		=

+gMountHueOverride[0x3E98] =3D 0 --Ethereal SwampDragon
   =

+gMountTranslate[0x3E90] =3D 0x69  -- chimera (temporary placeholder model)=
 original is 0x114, but wing broken
+gMountTranslate[0x3E91] =3D 0x115  -- cusidhe (correct model?)  0x7f 0x64 =
0x62 0x17
+gMountTranslate[0x3E95] =3D 0x317  -- giantfirebeetle (temporary placehold=
er model)
+					=

+					=

 gMountTranslate[0x3FFE] =3D 0xD5  --
 gMountTranslate[0x3FFD] =3D 0xF1  --
 gMountTranslate[0x3FFC] =3D 0xF3  --
-gMountTranslate[0x3EB4] =3D 0x7A  --// unicorn
+gMountTranslate[0x3EB4] =3D 0x7A  --// unicorn (eth?)
 gMountTranslate[0x3EA2] =3D 0xCC  --// dark brown horse
 gMountTranslate[0x3E9F] =3D 0xC8  --// light brown horse
 gMountTranslate[0x3EA0] =3D 0xE2  --// light grey horse
@@ -59,81 +64,81 @@
 gMountTranslate[0x3EB7] =3D 0xB3  --// dark steed
 gMountTranslate[0x3EB8] =3D 0xBB  --// ridgeback
 gMountTranslate[0x3EBA] =3D 0xBC  --// savage ridgeback
-gMountTranslate[0x3E9E] =3D 0xBE  --
-gMountTranslate[0x3E93] =3D 0xFB  -- // test
-gMountTranslate[0x3EBB] =3D 0x319 -- // skeletal mount
-gMountTranslate[0x3EBC] =3D 0x317 -- // beetle
-gMountTranslate[0x3EBD] =3D 0x31A -- // swampdragon
-gMountTranslate[0x3EBE] =3D 0x31F -- // armored swamp dragon
-gMountTranslate[0x3E92] =3D 0x11C -- // mondain steed
-gMountTranslate[0x3E94] =3D 0xF3  -- // hiryu
+gMountTranslate[0x3E9E] =3D 0xBE  --// firesteed
+gMountTranslate[0x3E93] =3D 0xFB  --// test
+gMountTranslate[0x3EBB] =3D 0x319 --// skeletal mount
+gMountTranslate[0x3EBC] =3D 0x317 --// beetle
+gMountTranslate[0x3EBD] =3D 0x31A --// swampdragon
+gMountTranslate[0x3EBE] =3D 0x31F --// armored swamp dragon
+gMountTranslate[0x3E92] =3D 0x11C --// mondain steed
+gMountTranslate[0x3E94] =3D 0xF3  --// hiryu
 =

 gMountTranslate2D =3D {}
 for k,v in pairs(gMountTranslate) do gMountTranslate2D[k] =3D v end -- a c=
opy of the original data without granny overrides for varan
 =

 -- currently broken granny anims
 gMountGrannyOverride =3D {}
-gMountGrannyOverride[0xCC] =3D gStandardHorse
-gMountGrannyOverride[0xE2] =3D gStandardHorse =

-gMountGrannyOverride[0xE4] =3D gStandardHorse
-gMountGrannyOverride[0xB1] =3D gStandardHorse =

-gMountGrannyOverride[0x75] =3D gStandardHorse =

-gMountGrannyOverride[0x72] =3D gStandardHorse =

-gMountGrannyOverride[0x73] =3D gStandardHorse =

-gMountGrannyOverride[0x74] =3D gStandardHorse =

-gMountGrannyOverride[0xB2] =3D gStandardHorse =

-gMountGrannyOverride[0xB3] =3D gStandardHorse =

-gMountGrannyOverride[0xBE] =3D gStandardHorse =

+gMountGrannyOverride[0xCC] =3D gStandardHorse -- dark brown horse
+gMountGrannyOverride[0xE2] =3D gStandardHorse -- light grey horse
+gMountGrannyOverride[0xE4] =3D gStandardHorse -- grey brown horse
+gMountGrannyOverride[0xB1] =3D gStandardHorse -- nightmare
+gMountGrannyOverride[0x75] =3D gStandardHorse -- SilverSteed
+gMountGrannyOverride[0x72] =3D gStandardHorse -- nightmare
+gMountGrannyOverride[0x73] =3D gStandardHorse -- Ethereal Horse
+gMountGrannyOverride[0x74] =3D gStandardHorse -- Nightmare
+gMountGrannyOverride[0xB2] =3D gStandardHorse -- nightmare 4
+gMountGrannyOverride[0xB3] =3D gStandardHorse -- dark steed
+gMountGrannyOverride[0xBE] =3D gStandardHorse -- FireSteed
 gMountGrannyOverride[0x123] =3D hex2num("0x76") -- packhorse, not C8 (stan=
dardhorse) =

-gMountGrannyOverride[0x317] =3D gStandardHorse
-gMountGrannyOverride[0x31A] =3D gStandardHorse
-gMountGrannyOverride[0x31F] =3D gStandardHorse
-gMountGrannyOverride[0x11C] =3D gStandardHorse
+gMountGrannyOverride[0x317] =3D gStandardHorse -- Beetle
+gMountGrannyOverride[0x31A] =3D gStandardHorse -- SwampDragon
+gMountGrannyOverride[0x31F] =3D gStandardHorse -- ScaledSwampDragon
+gMountGrannyOverride[0x11C] =3D gStandardHorse -- mondain steed
 for k,v in pairs(gMountTranslate) do if (gMountGrannyOverride[v]) then gMo=
untTranslate[k] =3D gMountGrannyOverride[v] end end
 =

 --[[
 (tipp from btbn from uox3 code)
-skeletalmount=3D0x3EBB
-darksteed=3D0x3EA9
-etherealhorse=3D0x3EAA
-nightmare=3D0x3EB5
-silversteed=3D0x3EA8
-britwarhorse=3D0x3EB2
-comwarhorse=3D0x3EB1
-minaxwarhorse=3D0x3EAF
-slwarhorse=3D0x3EB0
-unicorn=3D0x3EB4
-kirin=3D0x3EAD
-seahorse=3D0x3EB3
-giantfirebeetle=3D0x3E95
-ethereal_llama=3D0x3EAB
-etherealostard=3D0x3EAC
-nightmare2=3D0x3EA7
-nightmare3=3D0x3EA9
-tdnightmare=3D0x3EB7
-ridgeback=3D0x3EB8
-firesteed=3D0x3E9E
-etherealkirin=3D0x3E9C
-horse1=3D0x3EA2
-etherealunicorn=3D0x3EB4
-etherealridgeback=3D0x3E9A
-etherealswampdragon=3D0x3E98
-etherealbeetle=3D0x3E97
-horse2=3D0x3E9F
-desertostard=3D0x3EA3
-frenziedostard=3D0x3EA4
-forestostard=3D0x3EA5
-llama=3D0x3EA6
-horse3=3D0x3EA0
-horse4=3D0x3EA1
-hiryu=3D0x3E94
-chimera=3D0x3E90  -- also known as reptalon/raptalon ?
-cusidhe=3D0x3E91
-mondainsteed=3D0x3E92
-giantbeetle=3D0x3EBC
-swampdragon=3D0x3EBD
-armorswampdragon=3D0x3EBE
-kirin=3D0x3EAD
+skeletalmount			0x3EBB
+darksteed				0x3EA9
+etherealhorse			0x3EAA
+nightmare				0x3EB5
+silversteed				0x3EA8
+britwarhorse			0x3EB2
+comwarhorse				0x3EB1
+minaxwarhorse			0x3EAF
+slwarhorse				0x3EB0
+unicorn					0x3EB4
+kirin					0x3EAD
+seahorse				0x3EB3
+giantfirebeetle			0x3E95 TODO =

+ethereal_llama			0x3EAB
+etherealostard			0x3EAC
+nightmare2				0x3EA7
+nightmare3				0x3EA9
+tdnightmare				0x3EB7
+ridgeback				0x3EB8
+firesteed				0x3E9E
+etherealkirin			0x3E9C
+horse1					0x3EA2
+etherealunicorn			0x3EB4
+etherealridgeback		0x3E9A
+etherealswampdragon		0x3E98
+etherealbeetle			0x3E97
+horse2					0x3E9F
+desertostard			0x3EA3
+frenziedostard			0x3EA4
+forestostard			0x3EA5
+llama					0x3EA6
+horse3					0x3EA0
+horse4					0x3EA1
+hiryu					0x3E94
+chimera					0x3E90  TODO -- also known as reptalon/raptalon ?  =

+cusidhe					0x3E91  TODO
+mondainsteed			0x3E92
+giantbeetle				0x3EBC
+swampdragon				0x3EBD
+armorswampdragon		0x3EBE
+kirin					0x3EAD
 =

 =

 RunUO1.0/Scripts/Engines/Factions/Mobiles/FactionWarHorse.cs:8:	public cla=
ss FactionWarHorse : BaseMount



From no-reply at zwischenwelt.org  Sat Apr 19 13:36:07 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Apr 2008 11:36:07 -0000
Subject: [Iris-commit] [IRIS] r2068 - in /trunk: bin/iris2.exe
 data/profiles/gfx_high.lua data/profiles/gfx_ultrahigh.lua
Message-ID: <20080419113610.29CF71C187B4@zwischenwelt.org>

Author: sience
Date: Sat Apr 19 13:36:06 2008
New Revision: 2068

Log:
-some graphic profile settings adjusted
-new win32 binary

Modified:
    trunk/bin/iris2.exe
    trunk/data/profiles/gfx_high.lua
    trunk/data/profiles/gfx_ultrahigh.lua

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/profiles/gfx_high.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/profiles/gfx_high.lua (original)
+++ trunk/data/profiles/gfx_high.lua Sat Apr 19 13:36:06 2008
@@ -7,4 +7,4 @@
 gDynamicsCastShadows =3D true
 gMobileCastShadows =3D true
 =

-gSightRange	=3D 5
+gSightRange	=3D 6

Modified: trunk/data/profiles/gfx_ultrahigh.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/profiles/gfx_ultrahigh.lua (original)
+++ trunk/data/profiles/gfx_ultrahigh.lua Sat Apr 19 13:36:06 2008
@@ -1,6 +1,6 @@
 -- ultrahigh gfx-profile uses no textureatlas and has (in future) depthsha=
dowmapping
 =

-gAtlasRes =3D "none"
+--gAtlasRes =3D "none"
 =

 gShadowTechnique =3D "texture_additive"
 gStaticsCastShadows =3D true
@@ -9,7 +9,9 @@
 =

 --gUseHumanSkinShader =3D true -- currently doesn't work
 =

-gSightRange	=3D 6
+gSightRange	=3D 8
+gEnableLowDetailTerrainFarSight =3D true
+gEnableLowDetailTerrainFarSightRangeAdd =3D 2
 =

 gPreloadStaticMesh =3D true
 =




From no-reply at zwischenwelt.org  Sat Apr 19 22:52:06 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Apr 2008 20:52:06 -0000
Subject: [Iris-commit] [IRIS] r2069 - /tools/installer/Iris_Setup.iss
	/trunk/data/config.lua.dist
Message-ID: <20080419205209.369161C187B4@zwischenwelt.org>

Author: sience
Date: Sat Apr 19 22:52:05 2008
New Revision: 2069

Log:
-ambient light decreased
-install script updated

Modified:
    tools/installer/Iris_Setup.iss
    trunk/data/config.lua.dist

Modified: tools/installer/Iris_Setup.iss
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- tools/installer/Iris_Setup.iss (original)
+++ tools/installer/Iris_Setup.iss Sat Apr 19 22:52:05 2008
@@ -3,7 +3,7 @@
 #define AppUpdaterName "Iris2 Updater"
 #define AppUpdaterName2 "Iris2 Emergency Updater"
 #define AppVersion "2.0"
-#define BuildNumber "build 1286"
+#define BuildNumber "build 2010"
 #define AppPublisher "Iris2 Developer Team"
 #define AppURL "http://www.iris2.de"
 #define AppExeName "iris2.exe"

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Apr 19 22:52:05 2008
@@ -100,7 +100,7 @@
 gSunLightSpecular =3D {r=3D1.0,g=3D1.0,b=3D1.0}
 =

 -- Ambient Light
-gAmbientLight =3D {r=3D0.6,g=3D0.6,b=3D0.6}
+gAmbientLight =3D {r=3D0.5,g=3D0.5,b=3D0.5}
 =

 -- Soundeffects & Music
 -- gUseSoundSystem =3D "openal"



From no-reply at zwischenwelt.org  Sun Apr 20 00:30:37 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Apr 2008 22:30:37 -0000
Subject: [Iris-commit] [IRIS] r2070 - in /trunk: data/mymacros.lua.dist
 lua/filter/filter.art.lua lua/gui/gui.paperdoll.lua lua/lib.3d.dynamic.lua
 lua/lib.3d.map.lua lua/lib.data.lua lua/lib.debugmenu.lua
 lua/lib.static.lua src/data.cpp
Message-ID: <20080419230019.8F2B5155C002@zwischenwelt.org>

Author: hagish
Date: Sun Apr 20 00:30:35 2008
New Revision: 2070

Log:
reworked loading and fastbatching, needs more testing

Modified:
    trunk/data/mymacros.lua.dist
    trunk/lua/filter/filter.art.lua
    trunk/lua/gui/gui.paperdoll.lua
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.data.lua
    trunk/lua/lib.debugmenu.lua
    trunk/lua/lib.static.lua
    trunk/src/data.cpp

Modified: trunk/data/mymacros.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/mymacros.lua.dist (original)
+++ trunk/data/mymacros.lua.dist Sun Apr 20 00:30:35 2008
@@ -68,7 +68,7 @@
 SetMacro("f3",			function() MacroCmd_ItemSlot_Use(3) end)
 SetMacro("f4",			function() MacroCmd_ItemSlot_Use(4) end)
 SetMacro("f5",			function() MacroCmd_ItemSlot_Use(1) MacroCmd_TargetLast()=
 end)
-SetMacro("f6",			function() MacroCmd_Item_UseByName("bandage") MacroCmd_Ta=
rgetSelf() end)
+SetMacro("f6",			function() MacroCmd_Item_UseByName("clean bandage") Macro=
Cmd_TargetSelf() end)
 =

 -- build commands for RunUO/SunUO and Iris Testshard
 SetMacro("pgup",		function() MacroCmd_Say("[xmove 0,0,1") end)

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Sun Apr 20 00:30:35 2008
@@ -250,7 +250,7 @@
 =

 ----------------------------------------------------------------------
 =

--- Seasonal Dynamic & Static Art Translation (run tiles)	-- eventuell (iTi=
leTypeID + 16384)
+-- Seasonal Dynamic & Static Art Translation (run tiles)	-- eventuell (iTi=
leTypeID + 0x4000)
 gSeasonStaticTranslators =3D {[0]=3DgStaticTable_Spring,[1]=3Dnil,[2]=3DgS=
taticTable_Fall,[3]=3DgStaticTable_Winter,[4]=3DgStaticTable_Desolation}
 function SeasonalStaticTranslation (iTileTypeID, iSeasonID)
 	local translator =3D gSeasonStaticTranslators[iSeasonID]

Modified: trunk/lua/gui/gui.paperdoll.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.paperdoll.lua (original)
+++ trunk/lua/gui/gui.paperdoll.lua Sun Apr 20 00:30:35 2008
@@ -215,7 +215,7 @@
 =

 		local x,y =3D unpack(gLayerOrderPositionAndArtOverwrite[layer])
 		=

-		local minx,miny,maxx,maxy =3D GetArtVisibleAABB(item.artid + 16384)
+		local minx,miny,maxx,maxy =3D GetArtVisibleAABB(item.artid + 0x4000)
 		local cx =3D minx + (maxx - minx)/2
 		local cy =3D miny + (maxy - miny)/2
 =


Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Sun Apr 20 00:30:35 2008
@@ -4,10 +4,10 @@
 gMultis =3D {}
 =

 -- fast batch geometry gfx3d that contains the dynamics
-Renderer3D.gFastBatchDynamics =3D nil
 Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
 Renderer3D.gFastBatchDynamicsUpdateNext =3D nil
-Renderer3D.gFastBatchDynamicsUpdateNextTimout =3D 1 * 1000
+Renderer3D.gFastBatchDynamicsUpdateNextTimout =3D 500
+Renderer3D.gFastBatchDynamicsMap =3D CreateArray2D()
 =

 -- helperfunction for CreateDynamicGfx. Please use always for function call
 function Renderer3D:AddDynamicItem( item )
@@ -16,8 +16,18 @@
 =

 -- for fastbatch
 function Renderer3D:UpdateDynamicDisplayRange ()
-	if (not self.gFastBatchDynamics) then return end
-	self.gFastBatchDynamics:FastBatch_SetDisplayRange(self:BlendoutGetVisible=
Range())
+	local a,b =3D self:BlendoutGetVisibleRange()
+	if (self.gFastBatchDynamicsMap) then
+		Array2DForAll(self.gFastBatchDynamicsMap, function(v,x,y)
+			if v.mFastBatch then v.mFastBatch:FastBatch_SetDisplayRange(a,b) end
+		end)
+	end
+	-- update multis
+	for k,v in pairs(gMultis) do
+		if k.staticGeometry then
+			k.staticGeometry:FastBatch_SetDisplayRange(a,b)
+		end
+	end
 end
 =

 function Renderer3D:CheckForFastBatchDynamicsUpdate ()
@@ -25,44 +35,53 @@
 		(not Renderer3D.gFastBatchDynamicsUpdateNext or Renderer3D.gFastBatchDyn=
amicsUpdateNext < gMyTicks) then
 =

 		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D false
-
-		-- on demand create
-		if not Renderer3D.gFastBatchDynamics then
-			Renderer3D.gFastBatchDynamics =3D CreateRootGfx3D()
-		end
-
-		-- clear
-		Renderer3D.gFastBatchDynamics:SetFastBatch()
-
-		local x,y,z
-		local qw,qx,qy,qz
-		-- add dynamics
-		for k,dynamic in pairs(GetDynamicList()) do
-			if (dynamic.meshname and DynamicIsInWorld(dynamic)) then
-				x,y,z =3D Renderer3D:UOPosToLocal(dynamic.xloc + dynamic.xadd,dynamic.=
yloc + dynamic.yadd,dynamic.zloc * 0.1 + dynamic.zadd) =

-				qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
-
-				local r,g,b,a =3D 1,1,1,1
-				if (gHueLoader and dynamic.hue > 0) then
-					r,g,b =3D gHueLoader:GetColor(dynamic.hue - 1,31) -- get first color
+	=

+		Array2DForAll(Renderer3D.gFastBatchDynamicsMap, function(v,x,y)
+			if v.mbUpdateNeeded then
+				-- on demand create
+				if not v.mFastBatch then
+					v.mFastBatch =3D CreateRootGfx3D()
+				end				=

+				-- clear
+				v.mFastBatch:SetFastBatch()
+				=

+				local x,y,z
+				local qw,qx,qy,qz
+				-- add dynamics
+				local count =3D 0
+
+				for k,dynamic in pairs(v.mlDynamic) do
+					if (dynamic.meshname and DynamicIsInWorld(dynamic)) then
+						count =3D count + 1
+						x,y,z =3D Renderer3D:UOPosToLocal(dynamic.xloc + dynamic.xadd,dynami=
c.yloc + dynamic.yadd,dynamic.zloc * 0.1 + dynamic.zadd) =

+						qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
+
+						local r,g,b,a =3D 1,1,1,1
+						if (gHueLoader and dynamic.hue > 0) then
+							r,g,b =3D gHueLoader:GetColor(dynamic.hue - 1,31) -- get first color
+						end
+
+						local orderval =3D dynamic.zloc -- used for blendout later (fastbatc=
h feature)
+						v.mFastBatch:FastBatch_AddMeshBuffer(GetMeshBuffer(dynamic.meshname)=
, orderval, x,y,z, qw,qx,qy,qz, -1,1,1, r,g,b,a)
+					end
 				end
 =

-				local orderval =3D dynamic.zloc -- used for blendout later (fastbatch =
feature)
-				Renderer3D.gFastBatchDynamics:FastBatch_AddMeshBuffer(GetMeshBuffer(dy=
namic.meshname), orderval, x,y,z, qw,qx,qy,qz, -1,1,1, r,g,b,a)
+				v.mFastBatch:SetCastShadows(gDynamicsCastShadows)
+				=

+				-- unset dirty flag
+				v.mbUpdateNeeded =3D false
+
+				v.mFastBatch:FastBatch_Build()
 			end
-		end
-
-		Renderer3D.gFastBatchDynamics:SetCastShadows(gDynamicsCastShadows)
-		Renderer3D.gFastBatchDynamics:FastBatch_Build()
-
+		end)
+		=

+		self:UpdateDynamicDisplayRange()
 		Renderer3D.gFastBatchDynamicsUpdateNext =3D gMyTicks + Renderer3D.gFastB=
atchDynamicsUpdateNextTimout
-		self:UpdateDynamicDisplayRange()
 	end
 end
 =

 function Renderer3D:UpdateDynamicItemPos ( dynamic )
 	if (dynamic.gfx) then dynamic.gfx:SetPosition(self:UOPosToLocal(dynamic.x=
loc + dynamic.xadd,dynamic.yloc + dynamic.yadd,dynamic.zloc * 0.1 + dynamic=
.zadd)) end	=

-	-- TODO update dynamic fastbatch?
 end
 =

 function Renderer3D:UpdateDynamicVisibility	(dynamic) =

@@ -73,13 +92,64 @@
 	end
 end
 =

+-- marks the dynamic block at uo position xy dirty, will get rebuild next =
time
+function Renderer3D:MarkDynamicBlockDirty	(x,y)
+	local bx =3D math.floor(x/8)
+	local by =3D math.floor(y/8)
+	if Array2DGet(Renderer3D.gFastBatchDynamicsMap, bx,by) then
+		local e =3D Array2DGet(Renderer3D.gFastBatchDynamicsMap, bx,by)
+		e.mbUpdateNeeded =3D true
+		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
+	end
+end
+
+function Renderer3D:AddDynamicToMap	(dynamic)
+	local bx =3D math.floor(dynamic.xloc/8)
+	local by =3D math.floor(dynamic.yloc/8)
+	=

+	if not Array2DGet(Renderer3D.gFastBatchDynamicsMap, bx,by) then
+		Array2DSet(Renderer3D.gFastBatchDynamicsMap, bx,by, {mbUpdateNeeded=3Dtr=
ue, miCount=3D0,mlDynamic=3D{}})
+	end
+	=

+	local e =3D Array2DGet(Renderer3D.gFastBatchDynamicsMap, bx,by)
+	-- add dynamic if not available
+	if not e.mlDynamic[dynamic.serial] then
+		e.mbUpdateNeeded =3D true
+		e.miCount =3D e.miCount + 1
+		e.mlDynamic[dynamic.serial] =3D dynamic
+		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
+	end
+end
+
+function Renderer3D:RemoveDynamicFromMap	(dynamic)
+	local bx =3D math.floor(dynamic.xloc/8)
+	local by =3D math.floor(dynamic.yloc/8)
+	=

+	if Array2DGet(Renderer3D.gFastBatchDynamicsMap, bx,by) then
+		local e =3D Array2DGet(Renderer3D.gFastBatchDynamicsMap, bx,by)
+		-- remove dynamic if available
+		if e.mlDynamic[dynamic.serial] then
+			e.mbUpdateNeeded =3D true
+			e.miCount =3D e.miCount - 1
+			e.mlDynamic[dynamic.serial] =3D nil
+			Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
+		end
+		=

+		-- remove block entry
+		if e.miCount =3D=3D 0 then
+			if e.mFastBatch then e.mFastBatch:Destroy() end
+			Array2DSet(Renderer3D.gFastBatchDynamicsMap, bx,by, nil)
+		end
+	end
+end
+
 -- rebuilds the graphic of the dynamics
 function Renderer3D:RebuildDynamic ( dynamic )
 	-- update position adjustments
 	dynamic.xadd,dynamic.yadd,dynamic.zadd =3D FilterPositionXYZ(dynamic.arti=
d)
 =

 	if gFastBatchDynamics then
-		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
+		MarkDynamicBlockDirty(dynamic.xloc, dynamic.yloc)
 	elseif dynamic.gfx then
 		-- update rotation
 		if dynamic.gfx then dynamic.gfx:SetOrientation(GetStaticMeshOrientation(=
dynamic.artid)) end
@@ -95,6 +165,62 @@
 		end
 	end
 end
+
+
+-- creates the geometry of the given multi and stores the gfx object in th=
is multi
+function Renderer3D:CreateMultiGraphic	(multi)
+	multi.staticGeometry =3D CreateRootGfx3D()
+	multi.staticGeometry:SetFastBatch()
+
+	for k,v in pairs(multi.lparts) do
+		-- table.insert(multi.lparts, {iTileTypeID,iX,iY,iZ,iHue})
+		=

+		local x,y,z
+		local qw,qx,qy,qz
+		local xadd,yadd,zadd
+
+		local iTileTypeID,iX,iY,iZ,iHue =3D unpack(v)
+		=

+		local meshname =3D GetMeshName(iTileTypeID)
+
+		if meshname then
+			xadd,yadd,zadd =3D FilterPositionXYZ(iTileTypeID)
+			x,y,z =3D Renderer3D:UOPosToLocal(iX + xadd,iY + yadd,iZ * 0.1 + zadd) =

+			qw,qx,qy,qz =3D GetStaticMeshOrientation(iTileTypeID)
+
+			local r,g,b,a =3D 1,1,1,1
+			if (gHueLoader and iHue > 0) then
+				r,g,b =3D gHueLoader:GetColor(iHue - 1,31) -- get first color
+			end
+
+			local orderval =3D iZ -- used for blendout later (fastbatch feature)
+			multi.staticGeometry:FastBatch_AddMeshBuffer(GetMeshBuffer(meshname), o=
rderval, x,y,z, qw,qx,qy,qz, -1,1,1, r,g,b,a)
+		else
+			--[[
+			entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc+0.5,entity=
.yloc+0.5,entity.zloc*0.1 + 0.5)
+			entity.gfx =3D CreateRootGfx3D()
+			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
+			entity.gfx.billboard =3D entity.gfx:CreateChild()
+			-- we have to add 0x4000 for fallbacks
+			self:CreateArtBillBoard(entity.gfx.billboard,iTranslatedTileTypeID + 0x=
4000,entity.iHue)
+			table.insert(chunk.lStaticEntities,entity)
+			printdebug("missing",sprintf("Fallback: Static Billboard created : iTra=
nslatedTileTypeID=3D%i\n", iTranslatedTileTypeID))
+			]]
+		end
+	end
+
+	multi.staticGeometry:SetCastShadows(gDynamicsCastShadows)
+	multi.staticGeometry:FastBatch_Build()
+end
+
+-- destroys the multi gfx static geometry
+function Renderer3D:DestroyMultiGraphic	(multi)
+	if multi.staticGeometry then =

+		multi.staticGeometry:Destroy() =

+		multi.staticGeometry =3D nil
+	end
+end
+
 =

 -- TODO: Multis & Serversidemultis don't recognize kTileDataFlag_LightSour=
ce yet
 function Renderer3D:CreateDynamicGfx( item )
@@ -165,12 +291,14 @@
 =

 				-- add part
 				table.insert(multi.lparts, {iTileTypeID,iX,iY,iZ,iHue})
-				Renderer3D:RebuildChunkAtUOPos(iX,iY)
+				-- Renderer3D:RebuildChunkAtUOPos(iX,iY)
 			end
 =

 			item.multi =3D multi
 			item.gfx =3D nil
 			gMultis[multi] =3D true
+			=

+			Renderer3D:CreateMultiGraphic(multi)
 			=

 		-- Clientside Multi Check
 		elseif gMultiLoader then
@@ -202,7 +330,7 @@
 				if iFlags =3D=3D 1 then
 					-- add part
 					table.insert(multi.lparts, {iTileTypeID,iX,iY,iZ,iHue})
-					Renderer3D:RebuildChunkAtUOPos(iX,iY)
+					-- Renderer3D:RebuildChunkAtUOPos(iX,iY)
 				end
 			end
 			=

@@ -211,6 +339,8 @@
 			item.multi =3D multi
 			item.gfx =3D nil
 			gMultis[multi] =3D true
+
+			Renderer3D:CreateMultiGraphic(multi)
 		else =

 			printdebug("missing",sprintf("Renderer3D:CreateDynamicGfx: failed loadi=
ng mesh for dynamic (multi): artid=3D%i z_typename=3D%s\n",item.artid or -1=
,GetStaticTileTypeName(item.artid) or ""))
 		end
@@ -223,8 +353,8 @@
 			-- trigger: burn all dynamics into the dynamic fastbatch
 			item.meshbuffer =3D GetMeshBuffer(item.meshname) -- for mousepicking
 			TexAtlas_AdjustMeshBufferIfNeeded(item.meshname,item.meshbuffer)
-			Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
-
+			=

+			Renderer3D:AddDynamicToMap	(item)
 		-- Old rendering method
 		elseif (not(gFastBatchDynamics) and item.meshname and item.meshname ~=3D=
 false) then
 			-- just add the dynamic as a scene node
@@ -258,7 +388,7 @@
 				item.xadd =3D item.xadd + 0.5
 				item.yadd =3D item.yadd + 0.5
 				item.zadd =3D item.zadd + 0.5
-				self:CreateArtBillBoard(item.gfx.billboard,iTranslatedTileTypeID + 163=
84,item.hue)
+				self:CreateArtBillBoard(item.gfx.billboard,iTranslatedTileTypeID + 0x4=
000,item.hue)
 				printdebug("missing",sprintf("Fallback: Dynamic Billboard created : iT=
ranslatedTileTypeID=3D%i\n", iTranslatedTileTypeID))
 				item.gfx:SetRenderingDistance(self.gDynamicMaxRenderDist)
 				-- set's position and add's xadd,yadd,zadd corrections
@@ -293,7 +423,7 @@
 	if (gArtImageLastTextureAtlas =3D=3D nil) then gArtImageLastTextureAtlas =
=3D CreateTexAtlas(w,w) end -- only first time
 	=

 	local img =3D CreateImage()
-	if gArtMapLoader and gArtMapLoader:ExportToImage(img,iArtID,gHueLoader,iH=
ue) then	-- + 16384
+	if gArtMapLoader and gArtMapLoader:ExportToImage(img,iArtID,gHueLoader,iH=
ue) then	-- + 0x4000
 	=

 		-- add to exisiting texatlas or start a new one if it doesn't fit
 		local bSuccess,l,r,t,b =3D gArtImageLastTextureAtlas:AddImage(img)
@@ -369,7 +499,7 @@
 		gfx:SetMaterial(matname)
 		gfx:SetCastShadows(false)
 		=

-		if IsGroundPlate(iArtID - 16384) then
+		if IsGroundPlate(iArtID - 0x4000) then
 			-- ground plate fallback
 			local tw =3D 0.5*w/texsize(w)
 			local th =3D 0.5*h/texsize(h)
@@ -415,6 +545,7 @@
 		printdebug("multi", sprintf("Multi destroyed with ARTID",dynamic.artid,v=
ardump(dynamic)) )
 		Renderer3D:RebuildChunkAtUOPos(dynamic.xloc,dynamic.yloc)
 		gMultis[dynamic.multi] =3D nil =

+		Renderer3D:DestroyMultiGraphic(dynamic.multi)
 	end
 	=

 	-- remove lightsource from dynamic
@@ -434,8 +565,7 @@
 	end
 =

 	if gFastBatchDynamics then =

-		-- just trigger dynamic fastbatch update
-		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
-	end
-	=

-end
+		Renderer3D:RemoveDynamicFromMap	(dynamic)
+	end
+	=

+end

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sun Apr 20 00:30:35 2008
@@ -7,7 +7,7 @@
 Renderer3D.giBlendOutPlayerHeight =3D 18	--eriminator: es galt grob, alles=
 was 18z =C3=AF=C2=BF=C2=BDberm char war wurd ausgebledent
 Renderer3D.giBlendOutCurZ =3D nil
 Renderer3D.gbBlendOutTerrainVisible =3D true
-Renderer3D.gMapUpdateInterval =3D 100 -- update the map not every frame, d=
ecrease for fly-videos
+Renderer3D.gMapUpdateInterval =3D 500 -- update the map not every frame, d=
ecrease for fly-videos
 Renderer3D.gMaxMapBlocksLoadedPerUpdate =3D 1 -- increase for fly-videos
 Renderer3D.gLowDetailTerrainNeedsRebuild =3D true
 =

@@ -27,6 +27,7 @@
 =

 function Renderer3D:UpdateMap ()
 	if (not self.gbActive) then return end
+	=

 	if (gMyTicks > self.gNextMapUpdate) then
 		-- get cam position + a little distance ahead of it (focal point?)
 		local camx,camy,camz =3D self:GetLookAheadCamPos()
@@ -170,21 +171,23 @@
 		iMidX =3D math.floor(iMidX / self.ROBMAP_CHUNK_SIZE)
 		iMidY =3D math.floor(iMidY / self.ROBMAP_CHUNK_SIZE)
 		=

-		-- rebuild chunks if needed
-		for y,row in pairs(self.gMapChunks) do
-			for x,chunk in pairs(row) do
-				if (chunk.mbRebuild) then
-					self:DestroyMapChunk(x,y,chunk)
-					self:LoadMapChunk(x,y)
-				end
-			end
-		end
-
 		-- release invisible chunks
 		for y,row in pairs(self.gMapChunks) do
 			for x,chunk in pairs(row) do
 				if (chunk.miX < minx or chunk.miY < miny or chunk.miX > maxx or chunk.=
miY > maxy) then
 					self:DestroyMapChunk(x,y,chunk)
+				end
+			end
+		end
+
+		local rebuilds_per_run =3D 1
+		-- rebuild chunks if needed
+		for y,row in pairs(self.gMapChunks) do
+			for x,chunk in pairs(row) do
+				if (chunk.mbRebuild) and rebuilds_per_run > 0 then
+					self:DestroyMapChunk(x,y,chunk)
+					self:LoadMapChunk(x,y)
+					rebuilds_per_run =3D rebuilds_per_run - 1
 				end
 			end
 		end
@@ -262,7 +265,8 @@
 end
 =

 -- handles the entity creation for CreateMapChunk and adds it to chunk.lSt=
aticEntities
-function Renderer3D:CreateMapChunkEntity (chunk,iTileTypeID,iXLoc,iYLoc,iZ=
Loc,iHue)
+function Renderer3D:CreateMapChunkEntity (chunk,iTileTypeID,iXLoc,iYLoc,iZ=
Loc,iHue,visible)
+	visible =3D visible or true
 	local entity =3D {}
 =

 	-- FILTER: correction
@@ -321,7 +325,7 @@
 			entity.meshbuffer =3D GetMeshBuffer(meshname) -- for mousepicking
 			TexAtlas_AdjustMeshBufferIfNeeded(meshname,entity.meshbuffer)
 			local orderval =3D entity.zloc -- used for blendout later (fastbatch fe=
ature)
-			chunk.fastbatch:FastBatch_AddMeshBuffer(entity.meshbuffer, orderval ,en=
tity.x,entity.y,entity.z, qw,qx,qy,qz, sx,sy,sz, r,g,b,a)
+			if visible then chunk.fastbatch:FastBatch_AddMeshBuffer(entity.meshbuff=
er, orderval ,entity.x,entity.y,entity.z, qw,qx,qy,qz, sx,sy,sz, r,g,b,a) e=
nd
 		else
 			entity.staticentity =3D CreateMeshEntity(meshname)
 			local myLayer =3D Renderer3D:ZToLayer(entity.zloc)
@@ -330,7 +334,7 @@
 				myLayerStaticGeom =3D CreateStaticGeometry()
 				chunk.pStaticGeometryLayers[myLayer] =3D myLayerStaticGeom
 			end
-			myLayerStaticGeom:AddEntity(entity.staticentity,entity.x,entity.y,entit=
y.z,qw,qx,qy,qz,sx,sy,sz)
+			if visible then myLayerStaticGeom:AddEntity(entity.staticentity,entity.=
x,entity.y,entity.z,qw,qx,qy,qz,sx,sy,sz) end
 		end
 =

 		table.insert(chunk.lStaticEntities,entity)
@@ -348,8 +352,8 @@
 			entity.gfx =3D CreateRootGfx3D()
 			entity.gfx:SetPosition(entity.x,entity.y,entity.z)
 			entity.gfx.billboard =3D entity.gfx:CreateChild()
-			-- we have to add 16384 for fallbacks
-			self:CreateArtBillBoard(entity.gfx.billboard,iTranslatedTileTypeID + 16=
384,entity.iHue)
+			-- we have to add 0x4000 for fallbacks
+			self:CreateArtBillBoard(entity.gfx.billboard,iTranslatedTileTypeID + 0x=
4000,entity.iHue)
 			table.insert(chunk.lStaticEntities,entity)
 			printdebug("missing",sprintf("Fallback: Static Billboard created : iTra=
nslatedTileTypeID=3D%i\n", iTranslatedTileTypeID))
 		end
@@ -512,7 +516,7 @@
 					if	iX >=3D UO_X and iX < UO_X+self.ROBMAP_CHUNK_SIZE*8 and =

 						iY >=3D UO_Y and iY < UO_Y+self.ROBMAP_CHUNK_SIZE*8 then
 						=

-						self:CreateMapChunkEntity(chunk,iTileTypeID,iX,iY,iZ,iHue)
+						self:CreateMapChunkEntity(chunk,iTileTypeID,iX,iY,iZ,iHue,false)
 					end
 				end
 			end

Modified: trunk/lua/lib.data.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.data.lua (original)
+++ trunk/lua/lib.data.lua Sun Apr 20 00:30:35 2008
@@ -80,7 +80,7 @@
 end
 =

 -- art material loader with caching
--- if someone what to view runned tiles (static tiles) he has to add (iArt=
ID + 16384)
+-- if someone what to view runned tiles (static tiles) he has to add (iArt=
ID + 0x4000)
 gArtMatCache =3D {}
 -- New GetArtMat with RTT support
 function GetArtMat (iArtID,iHue)
@@ -93,8 +93,8 @@
 =

 		-- check if RTT generated Art Tiles is enabled and try to generate a RTT=
 Tile out of an *.mesh
 		if (gEnableRTTModelImages) then
-			printdebug("static","try to create RTT from MeshID (static iArtID - 163=
84): "..iArtID - 16384)
-			local meshname =3D GetModelName(FilterMesh(iArtID - 16384))
+			printdebug("static","try to create RTT from MeshID (static iArtID - 0x4=
000): "..iArtID - 0x4000)
+			local meshname =3D GetModelName(FilterMesh(iArtID - 0x4000))
 =

 			if (OgreMeshAvailable(meshname)) then
 				local iMaxW=3D64	--48
@@ -153,10 +153,40 @@
 	local res =3D gArtMatVisibleAABBCache[iArtID]
 =

 	if (not res and gArtMapLoader) then
+		--[[
+		TODO this does not work correctly so its implemented via bitmask
+		=

 		gArtMapLoader:Load(iArtID)
 		local minx,miny,maxx,maxy =3D gArtMapLoader:CalcVisibleAABB()
 		gArtMatVisibleAABBCache[iArtID] =3D {minx,miny,maxx,maxy}
-		=

+		]]
+		=

+		local bitmask =3D GetArtBitMask (iArtID)
+		local minx,miny,maxx,maxy
+		=

+		local w,h =3D GetArtSize(iArtID)
+		=

+		for y =3D 1,h-1 do
+		for x =3D 1,w-1 do
+			if bitmask:TestBit(x,y) then
+				if minx =3D=3D nil then
+					minx =3D x
+					miny =3D y
+					maxx =3D x
+					maxy =3D y
+				else
+					minx =3D math.min(minx,x)
+					miny =3D math.min(miny,y)
+					maxx =3D math.max(maxx,x)
+					maxy =3D math.max(maxy,y)
+				end
+			end
+		end
+		end
+		=

+		bitmask:Destroy()
+		=

+		gArtMatVisibleAABBCache[iArtID] =3D {minx,miny,maxx,maxy}
 		return minx,miny,maxx,maxy
 	end
 =


Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Sun Apr 20 00:30:35 2008
@@ -641,7 +641,7 @@
 			-- position adjustment for statics and dynamics
 			xadd,yadd,zadd =3D FilterPositionXYZ(iTileType)
 		end
-		Renderer3D:CreateArtBillBoard(gDebugRootGfx2,iTileType+16384,iHue)
+		Renderer3D:CreateArtBillBoard(gDebugRootGfx2,iTileType+0x4000,iHue)
 	end
 	=

 	gDebugRootGfx:SetVisible(true)
@@ -855,8 +855,8 @@
 -- iMaxW,iMaxH : can be nil for unlimited size
 function MakeUOArtImageForDialog (iTileTypeID, iHue, iMaxW, iMaxH) =

 	iHue =3D iHue or 0
-	-- we have to add 16384 for fallbacks
-	iTileTypeID =3D iTileTypeID + 16384
+	-- we have to add 0x4000 for fallbacks
+	iTileTypeID =3D iTileTypeID + 0x4000
 	local matname =3D GetArtMat(iTileTypeID,iHue)
 	local isotilew =3D 44 / math.sqrt(2)
 	local w,h =3D GetArtSize(iTileTypeID,iHue)

Modified: trunk/lua/lib.static.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.static.lua (original)
+++ trunk/lua/lib.static.lua Sun Apr 20 00:30:35 2008
@@ -80,7 +80,7 @@
 			print("dump missing art",iTranslatedTileTypeID,filename)
 			-- render fallback image
 			local img =3D CreateImage()
-			if gArtMapLoader:ExportToImage(img,iTranslatedTileTypeID + 16384) then
+			if gArtMapLoader:ExportToImage(img,iTranslatedTileTypeID + 0x4000) then
 				img:SaveAsFile(filename)
 			end
 			img:Destroy()

Modified: trunk/src/data.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/data.cpp (original)
+++ trunk/src/data.cpp Sun Apr 20 00:30:35 2008
@@ -653,7 +653,9 @@
 	else return ((short *)mpRawData)[3];
 }
 =

-void	cArtMap::CalcVisibleAABB(int& minx, int& miny, int& maxx, int& maxy) {
+void	cArtMap::CalcVisibleAABB(int& minx, int& miny, int& maxx, int& maxy) =
{	=

+	// TODO this returns strange results so this functionality is implemented=
 via bitmasks
+	=

 	// read the size
 	int w =3D GetWidth();
 	int h =3D GetHeight();



From no-reply at zwischenwelt.org  Sun Apr 20 01:02:32 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 19 Apr 2008 23:02:32 -0000
Subject: [Iris-commit] [IRIS] r2071 - in /trunk/lua: lib.3d.map.lua
	lib.3d.mousepick.lua
Message-ID: <20080419230232.AF6E61C1853B@zwischenwelt.org>

Author: hagish
Date: Sun Apr 20 01:02:30 2008
New Revision: 2071

Log:
bugfix: wrong mousepicking on translated meshes

Modified:
    trunk/lua/lib.3d.map.lua
    trunk/lua/lib.3d.mousepick.lua

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Sun Apr 20 01:02:30 2008
@@ -276,7 +276,7 @@
 	entity.yloc =3D iYLoc + entity.yadd
 	entity.zloc =3D iZLoc + entity.zadd -- in tilecoords from uo
 =

-	entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc,entity.yloc,=
entity.zloc*0.1)
+	entity.x,entity.y,entity.z =3D self:UOPosToLocal(entity.xloc,entity.yloc,=
iZLoc * 0.1 + entity.zadd)
 	=

 	entity.iBlockX =3D math.floor(entity.xloc / 8)
 	entity.iBlockY =3D math.floor(entity.yloc / 8)

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Sun Apr 20 01:02:30 2008
@@ -228,7 +228,8 @@
 					bHit =3D (fHitDist ~=3D nil)
 				elseif ( dynamic.meshbuffer ) then
 						-- mesh mousepick
-						local x,y,z =3D Renderer3D:UOPosToLocal (dynamic.xloc,dynamic.yloc,d=
ynamic.zloc * 0.1) =

+						local xadd,yadd,zadd =3D FilterPositionXYZ(dynamic.artid)
+						local x,y,z =3D Renderer3D:UOPosToLocal (dynamic.xloc + xadd,dynamic=
.yloc + yadd,dynamic.zloc * 0.1 + zadd) =

 						local qw,qx,qy,qz =3D GetStaticMeshOrientation(dynamic.artid)
 						=

 						bHit,fHitDist =3D dynamic.meshbuffer:RayPick(rx,ry,rz,rvx,rvy,rvz,



From no-reply at zwischenwelt.org  Sun Apr 20 19:25:22 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Apr 2008 17:25:22 -0000
Subject: [Iris-commit] [IRIS] r2072 - in /trunk:
	data/models/models/to_001000/ lua/filter/
Message-ID: <20080420172522.8E2271C1872F@zwischenwelt.org>

Author: hagish
Date: Sun Apr 20 19:25:21 2008
New Revision: 2072

Log:
fixed some sandstone models

Removed:
    trunk/data/models/models/to_001000/mdl_000360.mesh
    trunk/data/models/models/to_001000/mdl_000361.mesh
    trunk/data/models/models/to_001000/mdl_000362.mesh
    trunk/data/models/models/to_001000/mdl_000372.mesh
    trunk/data/models/models/to_001000/mdl_000387.mesh
Modified:
    trunk/data/models/models/to_001000/mdl_000363.mesh
    trunk/data/models/models/to_001000/mdl_000386.mesh
    trunk/data/models/models/to_001000/mdl_000388.mesh
    trunk/lua/filter/filter.art.lua

Modified: trunk/data/models/models/to_001000/mdl_000363.mesh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/models/to_001000/mdl_000386.mesh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/models/to_001000/mdl_000388.mesh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Sun Apr 20 19:25:21 2008
@@ -76,6 +76,15 @@
 gArtFilter[3343]=3D{maptoid=3D3340,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
 gArtFilter[3344]=3D{maptoid=3D3342,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
 gArtFilter[3345]=3D{maptoid=3D3341,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
+
+-- sandstone
+gArtFilter[387]=3D{maptoid=3D386,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,yadd=
=3D0,zadd=3D0}
+gArtFilter[360]=3D{maptoid=3D386,rotation=3D"x:0,y:0,z:90",xadd=3D-0,yadd=
=3D1,zadd=3D0}
+gArtFilter[372]=3D{maptoid=3D386,rotation=3D"x:0,y:0,z:180",xadd=3D-1,yadd=
=3D1,zadd=3D0}
+
+gArtFilter[389]=3D{maptoid=3D388,rotation=3D"x:0,y:0,z:-90",xadd=3D-0.4,ya=
dd=3D0,zadd=3D0}
+gArtFilter[361]=3D{maptoid=3D388,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,yadd=
=3D0,zadd=3D0}
+gArtFilter[362]=3D{maptoid=3D388,rotation=3D"x:0,y:0,z:0",xadd=3D0,yadd=3D=
0.6,zadd=3D0}
 =

 -- lava
 gArtFilter[6682]=3D{maptoid=3D6681}



From no-reply at zwischenwelt.org  Sun Apr 20 19:47:09 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Apr 2008 17:47:09 -0000
Subject: [Iris-commit] [IRIS] r2073 - /rawdata/sd_pd/houseparts.blend
Message-ID: <20080420174709.AD98C1C1872F@zwischenwelt.org>

Author: hagish
Date: Sun Apr 20 19:47:09 2008
New Revision: 2073

Log:
rawdata update

Modified:
    rawdata/sd_pd/houseparts.blend

Modified: rawdata/sd_pd/houseparts.blend
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Sun Apr 20 19:48:47 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Apr 2008 17:48:47 -0000
Subject: [Iris-commit] [IRIS] r2074 - /rawdata/sd_pd/readme.txt
Message-ID: <20080420174847.BF1331C18729@zwischenwelt.org>

Author: hagish
Date: Sun Apr 20 19:48:47 2008
New Revision: 2074

Log:
rawdata update

Added:
    rawdata/sd_pd/readme.txt



From no-reply at zwischenwelt.org  Sun Apr 20 21:13:32 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Apr 2008 19:13:32 -0000
Subject: [Iris-commit] [IRIS] r2075 - /trunk/lua/lib.keybinds.lua
Message-ID: <20080420191332.BF42D1C18729@zwischenwelt.org>

Author: hagish
Date: Sun Apr 20 21:13:32 2008
New Revision: 2075

Log:
ctrl+f11 to switch between different polygon modes

Modified:
    trunk/lua/lib.keybinds.lua

Modified: trunk/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.keybinds.lua (original)
+++ trunk/lua/lib.keybinds.lua Sun Apr 20 21:13:32 2008
@@ -1,6 +1,16 @@
 gDoubleClickIntervall =3D 800 -- override lugre default interval
 =

 function BindGeneralKeys ()
+	Bind("f11", function (state) =

+		if (state > 0) and gKeyPressed[key_lcontrol] then
+			local r =3D GetMainCam():GetPolygonMode()
+			if r =3D=3D kCamera_PM_POINTS then GetMainCam():SetPolygonMode(kCamera_=
PM_WIREFRAME)
+			elseif r =3D=3D kCamera_PM_WIREFRAME then GetMainCam():SetPolygonMode(k=
Camera_PM_SOLID)
+			elseif r =3D=3D kCamera_PM_SOLID then GetMainCam():SetPolygonMode(kCame=
ra_PM_POINTS)
+			end
+		end
+	end)
+	=

 	Bind("f12", function (state) if (state > 0) then
 		if gKeyPressed[key_lshift] then
 			StartGlobalProfiler()



From no-reply at zwischenwelt.org  Sun Apr 20 21:16:28 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Apr 2008 19:16:28 -0000
Subject: [Iris-commit] [IRIS] r2076 - in /trunk/lua: lib.3d.renderer.lua
	lib.mainmenu.lua
Message-ID: <20080420191632.51AB01C1872F@zwischenwelt.org>

Author: hagish
Date: Sun Apr 20 21:16:26 2008
New Revision: 2076

Log:
ctrl+f11 to switch between different polygon modes

Modified:
    trunk/lua/lib.3d.renderer.lua
    trunk/lua/lib.mainmenu.lua

Modified: trunk/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.renderer.lua (original)
+++ trunk/lua/lib.3d.renderer.lua Sun Apr 20 21:16:26 2008
@@ -200,7 +200,7 @@
 	cam:SetFOVy(gfDeg2Rad*45)
 	cam:SetNearClipDistance(0.5) -- old : 1
 	cam:SetFarClipDistance(2000) -- ogre defaul : 100000
-	cam:SetProjectionType(0) -- perspective
+	cam:SetProjectionType(kCamera_PT_PERSPECTIVE) -- perspective
 =

 	-- for 2D/3D renderer switching
 	self.gbActive =3D true

Modified: trunk/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.lua (original)
+++ trunk/lua/lib.mainmenu.lua Sun Apr 20 21:16:26 2008
@@ -178,7 +178,7 @@
 	cam:SetFOVy(gfDeg2Rad*45)
 	cam:SetNearClipDistance(0.5) -- old : 1
 	cam:SetFarClipDistance(2000) -- ogre defaul : 100000
-	cam:SetProjectionType(0) -- perspective
+	cam:SetProjectionType(kCamera_PT_PERSPECTIVE) -- perspective
 	Client_SetSkybox("sunset") -- cleansky skybox sunset darksun
 	SetMainMenuCam(0,gfDeg2Rad)
 end



From no-reply at zwischenwelt.org  Mon Apr 21 01:12:09 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 20 Apr 2008 23:12:09 -0000
Subject: [Iris-commit] [IRIS] r2077 - in /trunk: README bin/iris2.exe
 data/models/models/to_001000/mdl_000389.mesh lua/filter/filter.art.lua
 lua/filter/filter.granny.lua
Message-ID: <20080421000009.513591C18681@zwischenwelt.org>

Author: sience
Date: Mon Apr 21 01:12:08 2008
New Revision: 2077

Log:
-sandstone filter tiles corrected
-mesh mdl_000389.mesh deleted (obsolete,because of filter)
-new win32 binary
-readme updated
-granny mapping of GM-Robe ID 987 diabled (it now shows the GM-Robe without=
 char and animation <- need to fix)

Removed:
    trunk/data/models/models/to_001000/mdl_000389.mesh
Modified:
    trunk/README
    trunk/bin/iris2.exe
    trunk/lua/filter/filter.art.lua
    trunk/lua/filter/filter.granny.lua

Modified: trunk/README
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/README (original)
+++ trunk/README Mon Apr 21 01:12:08 2008
@@ -48,7 +48,7 @@
 mousewheel up	: zoom camera
 mousewheel down : zoom camera
 =

-return	: activate or send chatline
+return	: activate or send chatline (arrow keys UP, DOWN for last chatmessa=
ge)
 space	: run to and attack selected mobile
 q	: select neares mobile
 e	: select next mobile

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Mon Apr 21 01:12:08 2008
@@ -78,12 +78,12 @@
 gArtFilter[3345]=3D{maptoid=3D3341,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
 =

 -- sandstone
-gArtFilter[387]=3D{maptoid=3D386,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,yadd=
=3D0,zadd=3D0}
+gArtFilter[387]=3D{maptoid=3D386,rotation=3D"x:0,y:0,z:-90",xadd=3D1,yadd=
=3D0,zadd=3D0}
 gArtFilter[360]=3D{maptoid=3D386,rotation=3D"x:0,y:0,z:90",xadd=3D-0,yadd=
=3D1,zadd=3D0}
-gArtFilter[372]=3D{maptoid=3D386,rotation=3D"x:0,y:0,z:180",xadd=3D-1,yadd=
=3D1,zadd=3D0}
-
-gArtFilter[389]=3D{maptoid=3D388,rotation=3D"x:0,y:0,z:-90",xadd=3D-0.4,ya=
dd=3D0,zadd=3D0}
-gArtFilter[361]=3D{maptoid=3D388,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,yadd=
=3D0,zadd=3D0}
+gArtFilter[372]=3D{maptoid=3D386,rotation=3D"x:0,y:0,z:180",xadd=3D1,yadd=
=3D1,zadd=3D0}
+
+gArtFilter[389]=3D{maptoid=3D388,rotation=3D"x:0,y:0,z:-90",xadd=3D0.4,yad=
d=3D0,zadd=3D0}
+gArtFilter[361]=3D{maptoid=3D388,rotation=3D"x:0,y:0,z:-90",xadd=3D1,yadd=
=3D0,zadd=3D0}
 gArtFilter[362]=3D{maptoid=3D388,rotation=3D"x:0,y:0,z:0",xadd=3D0,yadd=3D=
0.6,zadd=3D0}
 =

 -- lava

Modified: trunk/lua/filter/filter.granny.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.granny.lua (original)
+++ trunk/lua/filter/filter.granny.lua Mon Apr 21 01:12:08 2008
@@ -32,7 +32,7 @@
 --gGrannyFilter[618]	=3D{meshname=3D"sword.mesh"}
 --gGrannyFilter[577] =3D {meshname=3D"shield.mesh"}
 =

-gGrannyFilter[987]	=3D{grannyid=3D400}
+--gGrannyFilter[987]	=3D{grannyid=3D400}
 gGrannyFilter[1987]	=3D{grannyid=3D401}
 gGrannyFilter[778]	=3D{grannyid=3D16}
 gGrannyFilter[292]	=3D{grannyid=3D220}



From no-reply at zwischenwelt.org  Mon Apr 21 23:52:44 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 21 Apr 2008 21:52:44 -0000
Subject: [Iris-commit] [IRIS] r2078 - in /trunk: data/models/materials/
 data/models/models/to_010000/ data/models/models/to_011000/
 data/models/textures/ lua/filter/
Message-ID: <20080421215244.34A62153C005@zwischenwelt.org>

Author: hagish
Date: Mon Apr 21 23:52:43 2008
New Revision: 2078

Log:
added some roof models

Added:
    trunk/data/models/models/to_010000/mdl_009163.mesh   (with props)
    trunk/data/models/models/to_010000/mdl_009164.mesh   (with props)
    trunk/data/models/models/to_011000/mdl_010488.mesh   (with props)
    trunk/data/models/models/to_011000/mdl_010489.mesh   (with props)
    trunk/data/models/models/to_011000/mdl_010496.mesh   (with props)
    trunk/data/models/models/to_011000/mdl_010497.mesh   (with props)
    trunk/data/models/textures/tex_5552.png   (with props)
Removed:
    trunk/data/models/models/to_010000/mdl_009153.mesh
    trunk/data/models/models/to_010000/mdl_009154.mesh
    trunk/data/models/models/to_010000/mdl_009157.mesh
    trunk/data/models/models/to_010000/mdl_009158.mesh
    trunk/data/models/models/to_010000/mdl_009159.mesh
    trunk/data/models/models/to_010000/mdl_009160.mesh
Modified:
    trunk/data/models/materials/textures.material
    trunk/data/models/models/to_010000/mdl_009155.mesh
    trunk/data/models/models/to_010000/mdl_009156.mesh
    trunk/lua/filter/filter.art.lua

Modified: trunk/data/models/materials/textures.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/textures.material (original)
+++ trunk/data/models/materials/textures.material Mon Apr 21 23:52:43 2008
@@ -7126,6 +7126,20 @@
 			texture_unit =

 			{ =

 				texture tex_555.png =

+			}	=

+		}
+	} =

+}
+
+material tex_5552 : tex_base =

+{ =

+	technique =

+	{ =

+		pass =

+		{		=

+			texture_unit =

+			{ =

+				texture tex_5552.png =

 			}	=

 		}
 	} =


Modified: trunk/data/models/models/to_010000/mdl_009155.mesh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/models/models/to_010000/mdl_009156.mesh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Mon Apr 21 23:52:43 2008
@@ -76,6 +76,44 @@
 gArtFilter[3343]=3D{maptoid=3D3340,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
 gArtFilter[3344]=3D{maptoid=3D3342,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
 gArtFilter[3345]=3D{maptoid=3D3341,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
+
+-- ceramic roof blue
+gArtFilter[9157]=3D{maptoid=3D9155,rotation=3D"x:0,y:0,z:-180",xadd=3D-1,y=
add=3D1,zadd=3D0}
+gArtFilter[9153]=3D{maptoid=3D9155,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,ya=
dd=3D0,zadd=3D0}
+gArtFilter[9159]=3D{maptoid=3D9155,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
+
+gArtFilter[9158]=3D{maptoid=3D9156,rotation=3D"x:0,y:0,z:-180",xadd=3D-1,y=
add=3D1,zadd=3D0}
+gArtFilter[9154]=3D{maptoid=3D9156,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,ya=
dd=3D0,zadd=3D0}
+gArtFilter[9160]=3D{maptoid=3D9156,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
+
+gArtFilter[9161]=3D{maptoid=3D9163,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
+gArtFilter[9165]=3D{maptoid=3D9163,rotation=3D"x:0,y:0,z:-180",xadd=3D-1,y=
add=3D1,zadd=3D0}
+gArtFilter[9167]=3D{maptoid=3D9163,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,ya=
dd=3D0,zadd=3D0}
+
+gArtFilter[9162]=3D{maptoid=3D9164}
+gArtFilter[9166]=3D{maptoid=3D9164}
+gArtFilter[9168]=3D{maptoid=3D9164}
+
+gArtFilter[9162]=3D{maptoid=3D9164,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
+gArtFilter[9166]=3D{maptoid=3D9164,rotation=3D"x:0,y:0,z:180",xadd=3D-1,ya=
dd=3D1,zadd=3D0}
+gArtFilter[9168]=3D{maptoid=3D9164,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,ya=
dd=3D0,zadd=3D0}
+
+-- ceramic roof yellow
+gArtFilter[10491]=3D{maptoid=3D10489,rotation=3D"x:0,y:0,z:-180",xadd=3D-1=
,yadd=3D1,zadd=3D0}
+gArtFilter[10487]=3D{maptoid=3D10489,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,=
yadd=3D0,zadd=3D0}
+gArtFilter[10493]=3D{maptoid=3D10489,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1,zadd=3D0}
+
+gArtFilter[10490]=3D{maptoid=3D10488,rotation=3D"x:0,y:0,z:-180",xadd=3D-1=
,yadd=3D1,zadd=3D0}
+gArtFilter[10486]=3D{maptoid=3D10488,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,=
yadd=3D0,zadd=3D0}
+gArtFilter[10492]=3D{maptoid=3D10488,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1,zadd=3D0}
+
+gArtFilter[10495]=3D{maptoid=3D10497,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1,zadd=3D0}
+gArtFilter[10499]=3D{maptoid=3D10497,rotation=3D"x:0,y:0,z:180",xadd=3D-1,=
yadd=3D1,zadd=3D0}
+gArtFilter[10501]=3D{maptoid=3D10497,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,=
yadd=3D0,zadd=3D0}
+
+gArtFilter[10494]=3D{maptoid=3D10496,rotation=3D"x:0,y:0,z:90",xadd=3D0,ya=
dd=3D1,zadd=3D0}
+gArtFilter[10498]=3D{maptoid=3D10496,rotation=3D"x:0,y:0,z:-180",xadd=3D-1=
,yadd=3D1,zadd=3D0}
+gArtFilter[10500]=3D{maptoid=3D10496,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,=
yadd=3D0,zadd=3D0}
 =

 -- sandstone
 gArtFilter[387]=3D{maptoid=3D386,rotation=3D"x:0,y:0,z:-90",xadd=3D1,yadd=
=3D0,zadd=3D0}



From no-reply at zwischenwelt.org  Mon Apr 21 23:53:46 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 21 Apr 2008 21:53:46 -0000
Subject: [Iris-commit] [IRIS] r2079 - /rawdata/sd_pd/houseparts.blend
Message-ID: <20080421215348.984BA1C18684@zwischenwelt.org>

Author: hagish
Date: Mon Apr 21 23:53:40 2008
New Revision: 2079

Log:
raw data update

Modified:
    rawdata/sd_pd/houseparts.blend

Modified: rawdata/sd_pd/houseparts.blend
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Tue Apr 22 00:30:07 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 21 Apr 2008 22:30:07 -0000
Subject: [Iris-commit] [IRIS] r2080 - in /trunk:
 data/models/models/to_010000/mdl_009169.mesh
 data/models/models/to_010000/mdl_009170.mesh
 data/models/models/to_010000/mdl_009171.mesh lua/filter/filter.art.lua
Message-ID: <20080421223007.793511C18751@zwischenwelt.org>

Author: hagish
Date: Tue Apr 22 00:30:05 2008
New Revision: 2080

Log:
added some roof models

Added:
    trunk/data/models/models/to_010000/mdl_009169.mesh   (with props)
    trunk/data/models/models/to_010000/mdl_009170.mesh   (with props)
    trunk/data/models/models/to_010000/mdl_009171.mesh   (with props)
Modified:
    trunk/lua/filter/filter.art.lua

Modified: trunk/lua/filter/filter.art.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/filter/filter.art.lua (original)
+++ trunk/lua/filter/filter.art.lua Tue Apr 22 00:30:05 2008
@@ -90,13 +90,15 @@
 gArtFilter[9165]=3D{maptoid=3D9163,rotation=3D"x:0,y:0,z:-180",xadd=3D-1,y=
add=3D1,zadd=3D0}
 gArtFilter[9167]=3D{maptoid=3D9163,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,ya=
dd=3D0,zadd=3D0}
 =

-gArtFilter[9162]=3D{maptoid=3D9164}
-gArtFilter[9166]=3D{maptoid=3D9164}
-gArtFilter[9168]=3D{maptoid=3D9164}
-
 gArtFilter[9162]=3D{maptoid=3D9164,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
 gArtFilter[9166]=3D{maptoid=3D9164,rotation=3D"x:0,y:0,z:180",xadd=3D-1,ya=
dd=3D1,zadd=3D0}
 gArtFilter[9168]=3D{maptoid=3D9164,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,ya=
dd=3D0,zadd=3D0}
+
+gArtFilter[9171]=3D{maptoid=3D9170,rotation=3D"x:0,y:0,z:180",xadd=3D-1,ya=
dd=3D1,zadd=3D0}
+
+gArtFilter[9152]=3D{maptoid=3D9170,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
+gArtFilter[9151]=3D{maptoid=3D9170,rotation=3D"x:0,y:0,z:-90",xadd=3D-1,ya=
dd=3D0,zadd=3D0}
+gArtFilter[9150]=3D{maptoid=3D9169,rotation=3D"x:0,y:0,z:90",xadd=3D0,yadd=
=3D1,zadd=3D0}
 =

 -- ceramic roof yellow
 gArtFilter[10491]=3D{maptoid=3D10489,rotation=3D"x:0,y:0,z:-180",xadd=3D-1=
,yadd=3D1,zadd=3D0}



From no-reply at zwischenwelt.org  Wed Apr 23 09:40:04 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 23 Apr 2008 07:40:04 -0000
Subject: [Iris-commit] [IRIS] r2081 - in /trunk/lua: gui/gui.quit.lua
	lib.keybinds.lua
Message-ID: <20080423074004.ED4551C18578@zwischenwelt.org>

Author: hagish
Date: Wed Apr 23 09:40:03 2008
New Revision: 2081

Log:
quit confirm dialog on escape

Modified:
    trunk/lua/gui/gui.quit.lua
    trunk/lua/lib.keybinds.lua

Modified: trunk/lua/gui/gui.quit.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.quit.lua (original)
+++ trunk/lua/gui/gui.quit.lua Wed Apr 23 09:40:03 2008
@@ -2,8 +2,8 @@
 -- Exported Iris2 GumpExporter ver 1.0.
 local quitGump =3D {}
 quitGump.dialogId =3D 9000001
-quitGump.x =3D 100
-quitGump.y =3D 100
+quitGump.x =3D 300
+quitGump.y =3D 200
 quitGump.Data =3D
 	 "{ page 0 }" ..
 	 "{ gumppic 0 0 2070 quitpic }" ..
@@ -22,12 +22,20 @@
  [1]	=3D function (widget,mousebutton) if (mousebutton =3D=3D 1) then Term=
inate() end end,
 }
 =

+gQuitDialog =3D nil
 function OpenQuit()
-	local dialog =3D GumpParser( quitGump, true )
+	if gQuitDialog then
+		gQuitDialog:Close()
+		gQuitDialog =3D nil
+	else
+		local dialog =3D GumpParser( quitGump, true )
 =

-	-- overwrite the onMouseDown function from gumpparser
-	dialog.onMouseDown =3D function (widget,mousebutton)
-		if (mousebutton =3D=3D 2) then widget.dialog:Close() end
-		if (mousebutton =3D=3D 1) then widget.dialog:BringToFront() gui.StartMov=
eDialog(widget.dialog.rootwidget) end
+		-- overwrite the onMouseDown function from gumpparser
+		dialog.onMouseDown =3D function (widget,mousebutton)
+			if (mousebutton =3D=3D 2) then widget.dialog:Close() end
+			if (mousebutton =3D=3D 1) then widget.dialog:BringToFront() gui.StartMo=
veDialog(widget.dialog.rootwidget) end
+		end
+		=

+		gQuitDialog =3D dialog
 	end
 end

Modified: trunk/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.keybinds.lua (original)
+++ trunk/lua/lib.keybinds.lua Wed Apr 23 09:40:03 2008
@@ -26,7 +26,7 @@
 	Bind("escape",	function (state) =

 			if (state > 0) then =

 			if (not gActiveEditText) then =

-				if gTargetModeActive then CancelTargetMode() else GlobalProfilerOutput=
() Terminate() end =

+				if gTargetModeActive then CancelTargetMode() else OpenQuit() end =

 			else
 				DeactivateCurEditText()
 			end =




From no-reply at zwischenwelt.org  Wed Apr 23 10:08:56 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 23 Apr 2008 08:08:56 -0000
Subject: [Iris-commit] [IRIS] r2082 - /trunk/lua/lib.3d.dynamic.lua
Message-ID: <20080423090005.EA75B1C18578@zwischenwelt.org>

Author: hagish
Date: Wed Apr 23 10:08:56 2008
New Revision: 2082

Log:
3d renderer: delete dynamic from map on destroy callback

Modified:
    trunk/lua/lib.3d.dynamic.lua

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Wed Apr 23 10:08:56 2008
@@ -8,6 +8,7 @@
 Renderer3D.gFastBatchDynamicsUpdateNext =3D nil
 Renderer3D.gFastBatchDynamicsUpdateNextTimout =3D 500
 Renderer3D.gFastBatchDynamicsMap =3D CreateArray2D()
+Renderer3D.gFastBatchDynamicsMapDestroyListener =3D nil
 =

 -- helperfunction for CreateDynamicGfx. Please use always for function call
 function Renderer3D:AddDynamicItem( item )
@@ -103,7 +104,21 @@
 	end
 end
 =

+function Renderer3D:ShowDynamicMapStats	()
+	Array2DForAll(Renderer3D.gFastBatchDynamicsMap, function(v,x,y)
+		print("BLOCK",x,y,v.miCount)
+	end)
+end
+
 function Renderer3D:AddDynamicToMap	(dynamic)
+	-- initialise destroy listener
+	if not Renderer3D.gFastBatchDynamicsMapDestroyListener then
+		Renderer3D.gFastBatchDynamicsMapDestroyListener =3D RegisterListener("Dy=
namic_Destroy", function(dynamic)
+			Renderer3D:RemoveDynamicFromMap(dynamic)
+			Renderer3D:ShowDynamicMapStats()
+		end)
+	end
+
 	local bx =3D math.floor(dynamic.xloc/8)
 	local by =3D math.floor(dynamic.yloc/8)
 	=

@@ -119,6 +134,8 @@
 		e.mlDynamic[dynamic.serial] =3D dynamic
 		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
 	end
+	=

+	Renderer3D:ShowDynamicMapStats()
 end
 =

 function Renderer3D:RemoveDynamicFromMap	(dynamic)
@@ -140,6 +157,25 @@
 			if e.mFastBatch then e.mFastBatch:Destroy() end
 			Array2DSet(Renderer3D.gFastBatchDynamicsMap, bx,by, nil)
 		end
+	end
+end
+
+-- untested
+function Renderer3D:RemoveDynamicBlock	(blockx,blocky)
+	if Array2DGet(Renderer3D.gFastBatchDynamicsMap, blockx,blocky) then
+		print("RemoveDynamicBlock",blockx,blocky)
+		local e =3D Array2DGet(Renderer3D.gFastBatchDynamicsMap, blockx,blocky)
+		=

+		-- remove all dynamics
+		for k,v in pairs(e.mlDynamic) do
+			e.miCount =3D e.miCount - 1
+			e.mlDynamic[k] =3D nil
+			print("RemoveDynamicBlock: remove serial",k)
+		end
+
+		-- and kill the block
+		if e.mFastBatch then e.mFastBatch:Destroy() end
+		Array2DSet(Renderer3D.gFastBatchDynamicsMap, blockx,blocky, nil)
 	end
 end
 =

@@ -564,8 +600,9 @@
 		dynamic.gfx =3D nil
 	end
 =

+	--[[ handled by on destroy listener
 	if gFastBatchDynamics then =

 		Renderer3D:RemoveDynamicFromMap	(dynamic)
 	end
-	=

-end
+	]]
+end



From no-reply at zwischenwelt.org  Wed Apr 23 19:09:05 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 23 Apr 2008 17:09:05 -0000
Subject: [Iris-commit] [IRIS] r2083 - in /trunk/lua: lib.debugmenu.lua
 lib.mainmenu.lua lib.terrain.multitex.lua lib.tilefreewalk.lua
Message-ID: <20080423170906.04D441C18778@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Apr 23 19:09:05 2008
New Revision: 2083

Log:
black terrain, for dungeons etc

Modified:
    trunk/lua/lib.debugmenu.lua
    trunk/lua/lib.mainmenu.lua
    trunk/lua/lib.terrain.multitex.lua
    trunk/lua/lib.tilefreewalk.lua

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Wed Apr 23 19:09:05 2008
@@ -679,10 +679,10 @@
 function StartDebugMenu ()
 =

 =

-	if (true) then
+	if (false) then
 		gDebugMenuModelTable =3D {}
 		kDebugMenuModelTable_EmptyContents =3D {}
-		for i=3D0xC00,0xFff do  -- max =3D 0x0f6b
+		for i=3D0x000,0xFff do  -- max =3D 0x0f6b
 			if (GetGrannyModelInfo(i)) then table.insert(gDebugMenuModelTable,{arti=
d=3Di,content=3DkDebugMenuModelTable_EmptyContents}) end
 		end
 	end

Modified: trunk/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.mainmenu.lua (original)
+++ trunk/lua/lib.mainmenu.lua Wed Apr 23 19:09:05 2008
@@ -87,19 +87,30 @@
 	end
 end
 =

-local function StartOfflineMode ()
+-- postxt is a string for the position, e.g. 5260,1333  , can be nil
+local function StartOfflineMode (postxt)
 	gDialog_IrisLogo:SetVisible(false)
 =

 	gStartGameWithoutNetwork =3D true
 	MultiTexTerrain_NotifyMapChange()
 	=

-	local x,y,z =3D -183,203,0
+	--~ local x,y,z =3D -183,203,0
+	local x,y,z =3D -1483,1527,2 -- osi-britannia
+	=

 	--if (gGroundBlockLoader) then x,y,z =3D -gGroundBlockLoader:GetMapW()*8/=
2,gGroundBlockLoader:GetMapH()*8/2,0 end
 	if (gOfflineModeCamStart) then x,y,z =3D unpack(gOfflineModeCamStart) end
+	=

+	if (postxt) then
+		local t1,t2,t3 =3D unpack(strsplit(",",postxt))
+		x,y,z =3D tonumber(t1) and -tonumber(t1) or x, tonumber(t2) or y, tonumb=
er(t3) or z
+		print("StartOfflineMode ",x,y,z,t1,t2,t3)
+	end
+	=

 	gCurrentRenderer:InitLocalCam(x,y,z)
 =

 	-- Binds key and Inits all InGame-Data
 	StartInGame() -- otherwise handled by the serverpacket (kPacket_Login_Com=
plete)
+	gTileFreeWalk:SetPos_All(x+0.5,y+0.5,z) -- + for both might be wrong..
 =

 	-- offline : tilefree walk teleport
 	BindDown("f6",function ()
@@ -307,7 +318,7 @@
 	if (gCommandLineSwitches["-meshload"]) then StartMeshLoaderTest() end -- =
journaltest
 	if (gCommandLineSwitches["-jt"]) then ToggleJournal() return end -- journ=
altest
 	if (gCommandLineSwitches["-mt"]) then ToggleMacroList() return end -- mac=
rolist-test
-	if (gCommandLineSwitches["-so"]) then StartOfflineMode() return end -- st=
art in offline mode
+	if (gCommandLineSwitches["-so"]) then StartOfflineMode(gCommandLineArgume=
nts[gCommandLineSwitches["-so"]+1]) return end -- start in offline mode
 	if (gCommandLineSwitches["-sd"]) then StartDebugMenu() return end -- star=
t in debug mode
 	if (gCommandLineSwitches["-co"]) then =

 		local name =3D gCommandLineArguments[gCommandLineSwitches["-co"]+1]

Modified: trunk/lua/lib.terrain.multitex.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.terrain.multitex.lua (original)
+++ trunk/lua/lib.terrain.multitex.lua Wed Apr 23 19:09:05 2008
@@ -17,7 +17,8 @@
 gTerrain_MultiTexTypes.jungle		=3D {172,173,174,175,176,179,182,185,188,18=
9,190,191,236,252,253,254,255,256,257,258,259,264,265,266,267,496,497,498,4=
99,622,623,624,625,630,631,632,633,634,635,636,637,646,647,648,649,658,659,=
660,661,1409,1410,1411,1412,1413,1414,1415,1416,1417,1418,1421,1422,1423,14=
24,1439,1440,1441,1442,1443,1444,1445,1446,1459,1460,1461,1462,1463,1464,14=
65,1466,1525,1526,1527,1528,1541,1542,1543,1544,1545,1546,1547,1548,1549,15=
50,1551,1552,1557,1558,1559,1560,1831,1832,1833,1834,1843,1844,1845,1846,18=
47,1848,1849,1850}
 gTerrain_MultiTexTypes.cobblestone	=3D {1001,1002,1003,1004,1669,1670,1671=
,1672,1677,1678,1679,1680,1681,1682,1683,1684,1693,1694,1695,1696}
 gTerrain_MultiTexTypes.snow			=3D {268,269,270,271,276,277,278,279,282,283=
,284,285,377,378,379,380,381,382,383,384,385,386,387,388,389,390,391,392,39=
3,394,901,902,903,904,905,906,907,908,913,914,915,916,925,926,927,928,929,9=
30,931,932,937,938,939,940,1471,1472,1473,1474,1475,1476,1477,1478,1479,148=
0,1481,1482,1483,1484,1485,1486,1487,1488,1489,1490,1491,1492,1493,1494,150=
3,1504,1505,1506,1861,1862,1863,1864,1873,1874,1875,1876,1877,1878,1879,188=
0,1885,1886,1887,1888,1901,1902,1903,1904,1905,1906,1907}
-gTerrain_MultiTexTypes.void			=3D {506,507,508,509,510,511}
+gTerrain_MultiTexTypes.void			=3D {506,507,508,509,510,511, 580}
+--~ gTerrain_MultiTexTypes.black		=3D {580}  -- dungeon black wall
 =

 gTerrain_MultiTexTypes.water		=3D {168,169,170,171,310,311} --,100,94,91,9=
9,87,82,79,149,131}
 =

@@ -39,6 +40,8 @@
 gTerrain_MultiTexTypes.acid			=3D {11778,11779,11780,11781,11782,11783,117=
84,11785,11786,11787,11788,11789,11790,11791,11792,11793,11794,11795,11796,=
11797,11798,11799,11800,11801,11802,11803,11804,11805,11806,11807,11808,118=
09,11810,11811,11812,11813,11814,11815,11816,11817,11818,11819,11820,11821,=
11822,11823,11824,11825,11826,11827,11828,11829,11830,11831,11832,11833,118=
34,11835}
 gTerrain_MultiTexTypes.caveexit		=3D {2029,2030,2031,2032,2033,2100,2101,2=
102,2103,2104,2105}
 ]]--
+
+-- 0x0244  pos=3D5260,1333 block=3D1231,311
 =

 gTerrain_MultiTexType_Fallback =3D "dirt"
 gMultiTextureAtlasList_Span =3D {"grass","dirt","rock","sand","forest","ju=
ngle","cobblestone","snow","void"}

Modified: trunk/lua/lib.tilefreewalk.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.tilefreewalk.lua (original)
+++ trunk/lua/lib.tilefreewalk.lua Wed Apr 23 19:09:05 2008
@@ -94,7 +94,8 @@
 		Renderer3D:ChangeCamMode(Renderer3D.kCamMode_Third)
 		--~ self:SetPos_All(-1548.5,326.5,5.0) --  iris online canyons
 		--~ self:SetPos_All(-1489.5,402.5,-7.6)
-		self:SetPos_All(-1482.5,1527.5,2.0)  -- osi-britannia
+		--~ self:SetPos_All(-1482.5,1527.5,2.0)  -- osi-britannia  -- set in sta=
rtofflinemode in lib.mainmenu.lua
+		--~ self:SetPos_All(-1482.5,1527.5,2.0)  -- osi-britannia  -- set in sta=
rtofflinemode in lib.mainmenu.lua
 	end
 	RegisterStepper(function () gTileFreeWalk:Step() end) =

 end



From no-reply at zwischenwelt.org  Wed Apr 23 20:11:45 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 23 Apr 2008 18:11:45 -0000
Subject: [Iris-commit] [IRIS] r2084 - in /trunk/lua: lib.3d.dynamic.lua
 lib.keybinds.lua lib.uoids.lua
Message-ID: <20080423181145.7818B1C18789@zwischenwelt.org>

Author: ghoulsblade
Date: Wed Apr 23 20:11:45 2008
New Revision: 2084

Log:
sparkle teleporter model now visible (used moongate model instead)

Modified:
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.keybinds.lua
    trunk/lua/lib.uoids.lua

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Wed Apr 23 20:11:45 2008
@@ -382,7 +382,10 @@
 		end
 	else
 		-- normal 1 part object
-		item.meshname =3D (not gForceFallBackBillboards_Dynamics) and GetMeshNam=
e(item.artid, 0)
+		local artid =3D item.artid
+		if (in_array(artid,kSparkleArtIDs)) then artid =3D kMoongateGateArtID en=
d -- provisory fix
+	=

+		item.meshname =3D (not gForceFallBackBillboards_Dynamics) and GetMeshNam=
e(artid, 0)
 =

 		-- Fastbatch rendering
 		if (gFastBatchDynamics and item.meshname and item.meshname ~=3D false) t=
hen

Modified: trunk/lua/lib.keybinds.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.keybinds.lua (original)
+++ trunk/lua/lib.keybinds.lua Wed Apr 23 20:11:45 2008
@@ -7,6 +7,22 @@
 			if r =3D=3D kCamera_PM_POINTS then GetMainCam():SetPolygonMode(kCamera_=
PM_WIREFRAME)
 			elseif r =3D=3D kCamera_PM_WIREFRAME then GetMainCam():SetPolygonMode(k=
Camera_PM_SOLID)
 			elseif r =3D=3D kCamera_PM_SOLID then GetMainCam():SetPolygonMode(kCame=
ra_PM_POINTS)
+			end
+		end
+	end)
+	=

+	Bind("f7", function (state) =

+		if (state > 0) then
+			local playermobile =3D GetPlayerMobile()
+			local x,y,z =3D playermobile.xloc,playermobile.yloc,playermobile.zloc
+			=

+			for k,dynamic in pairs(GetDynamicList()) do
+				if (DynamicIsInWorld(dynamic)) then
+					local d =3D dist2(x,y,dynamic.xloc,dynamic.yloc)
+					if (d < 5) then
+						print("TELESEARCH",d,dynamic.artid,dynamic.artid_base,GetMeshName(dy=
namic.artid, 0),GetStaticTileTypeName(dynamic.artid))
+					end
+				end
 			end
 		end
 	end)

Modified: trunk/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoids.lua (original)
+++ trunk/lua/lib.uoids.lua Wed Apr 23 20:11:45 2008
@@ -22,6 +22,8 @@
 gMulti_ID =3D hex2num("0x4000")
 =

 kMobileGhostArtIDs =3D {402,403,607,608,970}
+kSparkleArtIDs =3D {0x373A} -- dynamic-teleporters
+kMoongateGateArtID =3D 3948 -- blue moongate, gate-travel-spell
 =

 -- the meaning of mobile.flag
 kMobileFlag_Unknown1		=3D hex2num("0x01")



From no-reply at zwischenwelt.org  Thu Apr 24 03:56:08 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 24 Apr 2008 01:56:08 -0000
Subject: [Iris-commit] [IRIS] r2085 - in /trunk/lua: lib.test.lua main.lua
Message-ID: <20080424020025.F3E141C18778@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Apr 24 03:56:07 2008
New Revision: 2085

Log:
test for image blit

Modified:
    trunk/lua/lib.test.lua
    trunk/lua/main.lua

Modified: trunk/lua/lib.test.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.test.lua (original)
+++ trunk/lua/lib.test.lua Thu Apr 24 03:56:07 2008
@@ -23,6 +23,14 @@
 	print("sd",sd)
 	=

 	Crash()
+end
+
+function Test_ImageBlit ()
+	local a =3D LoadImageFromFile("irislogo256x256bw.png")
+	local b =3D LoadImageFromFile("art_fallback.png")
+	ImageBlit(b,a,224,224)
+	a:SaveAsFile("myimagetest2.png")
+	os.exit(0)
 end
 =

 function TestSound()

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Thu Apr 24 03:56:07 2008
@@ -288,7 +288,6 @@
 	if (not InitOgre("Iris2",lugre_detect_ogre_plugin_path(),"../bin/")) then=
 Exit() end
 	CollectOgreResLocs()
 	SetCursorBaseOffset(0,0)
-
 	=

 	------------------------------------------ obsolete, just for testing ---=
--------------------------------
 	-- Lua test because Lua50 should not be compiled full-optimized with VS20=
05 Express (maybe also other compilers)



From no-reply at zwischenwelt.org  Thu Apr 24 13:04:29 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 24 Apr 2008 11:04:29 -0000
Subject: [Iris-commit] [IRIS] r2086 - in /trunk/lua: lib.3d.combat.lua
 lib.3d.dynamic.lua lib.debugmenu.lua lib.macrolist.lua lib.protocol.lua
 net/net.mobile.lua net/net.other.lua
Message-ID: <20080424110429.A81E41C18728@zwischenwelt.org>

Author: hagish
Date: Thu Apr 24 13:04:28 2008
New Revision: 2086

Log:
more macro functions, improved damage display

Modified:
    trunk/lua/lib.3d.combat.lua
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.debugmenu.lua
    trunk/lua/lib.macrolist.lua
    trunk/lua/lib.protocol.lua
    trunk/lua/net/net.mobile.lua
    trunk/lua/net/net.other.lua

Modified: trunk/lua/lib.3d.combat.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.combat.lua (original)
+++ trunk/lua/lib.3d.combat.lua Thu Apr 24 13:04:28 2008
@@ -38,16 +38,33 @@
 	table.insert(self.gCombatFadeDamageText,o)
 end
 =

--- helper to plop hp adds and damage
+-- helper to plop damage
+function Renderer3D:NotifyDamage (serial, damage)
+	print("DAMAGE",damage)
+	local mobile =3D GetMobile(serial)
+	if mobile and damage then
+		local r,g,b,a =3D 1.0, 1.0, 0.0, 0.8
+		local size =3D 0.50
+		local speed =3D 0.1
+		local lifetime =3D 2.5
+		Renderer3D:CombatCreateDamageText(damage, mobile.xloc, mobile.yloc, mobi=
le.zloc, r, g, b, a, size, speed, lifetime)
+	end
+end
+
+-- helper to plop hp adds
 function Renderer3D:NotifyHPChange (serial, oldhp, newhp)
+	print("HP CHANGE",oldhp,newhp)
 	local mobile =3D GetMobile(serial)
 	if mobile and oldhp and newhp then
-		local r,g,b =3D 0.0, 0.0, 0.0
+		local r,g,b,a =3D 0.0, 0.0, 0.0, 0.8
+		local size =3D 0.25
+		local speed =3D 0.1
+		local lifetime =3D 1.5
 		-- hp change, d<0 means damage, d>0 hp gain
 		local d =3D newhp - oldhp
 		if (d =3D=3D 0.0) then return end
 		if (d < 0.0) then r =3D 1.0 else g =3D 1.0 end
-		Renderer3D:CombatCreateDamageText(math.abs(d), mobile.xloc, mobile.yloc,=
 mobile.zloc, r, g, b)
+		Renderer3D:CombatCreateDamageText(math.abs(d), mobile.xloc, mobile.yloc,=
 mobile.zloc, r, g, b, a, size, speed, lifetime)
 	end
 end
 =


Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Thu Apr 24 13:04:28 2008
@@ -105,9 +105,11 @@
 end
 =

 function Renderer3D:ShowDynamicMapStats	()
+	print("#######")
 	Array2DForAll(Renderer3D.gFastBatchDynamicsMap, function(v,x,y)
 		print("BLOCK",x,y,v.miCount)
 	end)
+	print("#######")
 end
 =

 function Renderer3D:AddDynamicToMap	(dynamic)
@@ -115,7 +117,7 @@
 	if not Renderer3D.gFastBatchDynamicsMapDestroyListener then
 		Renderer3D.gFastBatchDynamicsMapDestroyListener =3D RegisterListener("Dy=
namic_Destroy", function(dynamic)
 			Renderer3D:RemoveDynamicFromMap(dynamic)
-			Renderer3D:ShowDynamicMapStats()
+			-- Renderer3D:ShowDynamicMapStats()
 		end)
 	end
 =

@@ -135,7 +137,7 @@
 		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
 	end
 	=

-	Renderer3D:ShowDynamicMapStats()
+	-- Renderer3D:ShowDynamicMapStats()
 end
 =

 function Renderer3D:RemoveDynamicFromMap	(dynamic)

Modified: trunk/lua/lib.debugmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.debugmenu.lua (original)
+++ trunk/lua/lib.debugmenu.lua Thu Apr 24 13:04:28 2008
@@ -825,6 +825,16 @@
 		end	=

 		end end end)
 ]]--	=

+	Bind("f11", function (state) =

+		if (state > 0) and gKeyPressed[key_lcontrol] then
+			local r =3D GetMainCam():GetPolygonMode()
+			if r =3D=3D kCamera_PM_POINTS then GetMainCam():SetPolygonMode(kCamera_=
PM_WIREFRAME)
+			elseif r =3D=3D kCamera_PM_WIREFRAME then GetMainCam():SetPolygonMode(k=
Camera_PM_SOLID)
+			elseif r =3D=3D kCamera_PM_SOLID then GetMainCam():SetPolygonMode(kCame=
ra_PM_POINTS)
+			end
+		end
+	end)
+
 	Bind("b", function (state) if (not gActiveEditText) then if (state > 0) t=
hen =

 		if (gCurDebugMode =3D=3D kDebugMode_Static) then
 			local i =3D gDebugMenuModelIndex

Modified: trunk/lua/lib.macrolist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.macrolist.lua (original)
+++ trunk/lua/lib.macrolist.lua Thu Apr 24 13:04:28 2008
@@ -198,10 +198,11 @@
 end
 =

 -- waits until a given text appears, list =3D {text=3Dreturnvalue, text=3D=
returnvalue, ...}
-function MacroJournal_WaitForText	(list)
+function MacroJournal_WaitForText	(list,timeout)
 	if not list then return end
 	=

 	local lastcheck =3D Client_GetTicks()
+	local endtime =3D timeout and lastcheck+timeout or nil
 	=

 	while true do
 		for k,v in pairs(list) do
@@ -210,7 +211,14 @@
 			end
 		end
 		lastcheck =3D Client_GetTicks()
-		job.wait(500)
+		=

+		-- timeout check
+		if endtime and lastcheck > endtime then
+			print("TIMEOUT")
+			return nil
+		end
+
+		job.wait(100)
 	end
 end
 =

@@ -416,3 +424,151 @@
 		print("STOP ATTACK")
 	end)
 end
+
+
+
+function MacroGoto(x,y)
+	SetAutoWalkTo(x,y)
+	while gWalkPathToGo do
+		job.wait(500)
+	end
+end
+
+
+function MacroGetItemFromBackpackByName(itemnamepart)
+	local backpack_container =3D GetPlayerBackPackContainer()
+	if backpack_container then return MacroGetItemFromContainerByName(itemnam=
epart, backpack_container.serial) end
+	return nil
+end
+
+function MacroGetItemFromContainerByArtidHue(artid, hue, container_serial)
+	MacroEnsureContainerIsOpen(container_serial)
+	=

+	local container =3D GetContainer(container_serial)
+	if (not container) then return nil end
+	for k,item in pairs(container:GetContent()) do =

+		if item.artid =3D=3D artid and (not hue or item.hue =3D=3D hue) then
+			return item
+		end
+	end
+
+	return nil
+end
+
+function MacroGetItemFromContainerByName(itemnamepart, container_serial)
+	MacroEnsureContainerIsOpen(container_serial)
+	=

+	local container =3D GetContainer(container_serial)
+	if (not container) then return nil end
+	for k,item in pairs(container:GetContent()) do =

+		local name =3D GetStaticTileTypeName(item.artid)
+		if (name and string.find(name,itemnamepart)) then
+			return item
+		end
+	end
+
+	return nil
+end
+
+function MacroDropItemIntoContainer(dropitem, container_serial, x,y)
+	x =3D x or 50
+	y =3D y or 50
+
+	MacroEnsureContainerIsOpen(container_serial)
+	=

+	local amount =3D dropitem.amount or 1
+	local target =3D container_serial
+	=

+	local container =3D GetContainer(container_serial)
+	if (not container) then return nil end
+	for k,item in pairs(container:GetContent()) do =

+		if item.serial ~=3D dropitem.serial and item.artid =3D=3D dropitem.artid=
 and (not dropitem.hue or item.hue =3D=3D dropitem.hue) then
+			target =3D item.serial
+		end
+	end
+
+	Send_Take_Object(dropitem.serial,amount)
+	job.wait(400)
+	Send_Drop_Object(dropitem.serial,x,y,0,target)
+	job.wait(400)
+end
+
+function MacroDropAllIntoContainer(itemnamepart, container_serial, x,y)
+	x =3D x or 50
+	y =3D y or 50
+	local item =3D MacroGetItemFromBackpackByName(itemnamepart)
+	local lastserial =3D nil
+	while item do
+		MacroDropItemIntoContainer(item, container_serial, x,y)
+		lastserial =3D item.serial
+		item =3D MacroGetItemFromBackpackByName(itemnamepart)
+		-- something went wrong so stop
+		if item and lastserial and item.serial =3D=3D lastserial then return end
+	end
+end
+
+function MacroEnsureContainerIsOpen	(container_serial)
+	if not GetContainer(container_serial) then
+		Send_DoubleClick(container_serial)
+	end
+	while not GetContainer(container_serial) do
+		job.wait(100)
+	end
+end
+
+function MacroStackEverytingInContainer	(container_serial)
+	MacroEnsureContainerIsOpen(container_serial)
+
+	local sx =3D 20
+	local sy =3D 20
+	local dx =3D 2
+	local dy =3D 2
+	local x =3D sx
+	local y =3D sy
+	local limit =3D 150
+	=

+	local rowh =3D 0
+	=

+	local container =3D GetContainer(container_serial)
+	if (not container) then return nil end
+
+	=

+	local l =3D {}
+	=

+	-- sort content by height
+	for k,v in pairs(container:GetContent()) do table.insert(l,v) end
+	table.sort(l, function(a,b)
+		local minx,miny,maxx,maxy =3D GetArtVisibleAABB(a.artid + 0x4000)
+		local ha =3D maxy-miny
+		minx,miny,maxx,maxy =3D GetArtVisibleAABB(b.artid + 0x4000)
+		local hb =3D maxy-miny
+		return ha < hb
+	end)
+	=

+	for k,item in ipairs(l) do =

+		-- print("DROP AT",x,y)
+		=

+		local minx,miny,maxx,maxy =3D GetArtVisibleAABB(item.artid + 0x4000)
+		-- print("AABB",minx,miny,maxx,maxy)
+		--local w,h =3D GetArtSize(item.artid + 0x4000)
+		local w,h =3D maxx-minx,maxy-miny
+		=

+		rowh =3D math.max(h, rowh)
+		=

+		-- print("w,h,rowh",w,h,rowh,x,y)
+		=

+		MacroDropItemIntoContainer(item, container_serial, x-minx,y-miny)
+		=

+		-- goto next position
+		x =3D x + w + dx
+		if x > limit then
+			x =3D sx
+			y =3D y + rowh + dy
+		end
+	end
+end
+
+function MacroGetSerialUnderMouse	()
+	gCurrentRenderer:MousePick()
+	return gCurrentRenderer:GetMouseHitSerial()
+end

Modified: trunk/lua/lib.protocol.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.protocol.lua (original)
+++ trunk/lua/lib.protocol.lua Thu Apr 24 13:04:28 2008
@@ -93,7 +93,7 @@
 function LogOutgoingPacket (fifo,len) LogPacket(fifo,len,"Client") end
 function LogIncomingPacket (fifo,len) LogPacket(fifo,len,"Server") end
 function LogPacket (fifo,len,direction) =

-	if (not gLogPackets) then return end
+	if (not gLogPackets or not (len > 0)) then return end
 	local cmd =3D fifo:PeekNetUint8(0)
 	local info =3D sprintf("Packet [%02x], Length: %d, Type: %s\n",cmd,len,di=
rection or "unknown")
 	local rowlen =3D 16
@@ -111,7 +111,7 @@
 			s =3D ""
 		end
 	end
-	info =3D info .. "\n\n"
+	info =3D info .. "\t".. s .."\n\n"
 =

 	if (gPacketLogInit) then
 		gPacketLogInit =3D false

Modified: trunk/lua/net/net.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.mobile.lua (original)
+++ trunk/lua/net/net.mobile.lua Thu Apr 24 13:04:28 2008
@@ -290,7 +290,7 @@
 	local damage		=3D input:PopNetUint16()
 	printdebug("mobile",sprintf("NET: kPacket_Damage: mobile_serial=3D0x%08x =
 damage=3D%i\n",mobile_serial,damage))
 	=

-	gCurrentRenderer:NotifyHPChange( mobile_serial, damage, 0 )
+	gCurrentRenderer:NotifyDamage( mobile_serial, damage)
 end
 =

 =


Modified: trunk/lua/net/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.other.lua (original)
+++ trunk/lua/net/net.other.lua Thu Apr 24 13:04:28 2008
@@ -299,7 +299,7 @@
 		=

 		-- show fading damage over the mobile
 		-- TODO totally untested
-		gCurrentRenderer:NotifyHPChange(olddamage_serial,olddamage_amount,0)
+		gCurrentRenderer:NotifyDamage(olddamage_serial,olddamage_amount)
 	end
 =

 	--Enable/Disable SE Spell Icons



From no-reply at zwischenwelt.org  Thu Apr 24 16:35:20 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 24 Apr 2008 14:35:20 -0000
Subject: [Iris-commit] [IRIS] r2087 - /trunk/src/grannyparser.cpp
Message-ID: <20080424143520.AA3181C18749@zwischenwelt.org>

Author: hagish
Date: Thu Apr 24 16:35:19 2008
New Revision: 2087

Log:
memoryleak

Modified:
    trunk/src/grannyparser.cpp

Modified: trunk/src/grannyparser.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/grannyparser.cpp (original)
+++ trunk/src/grannyparser.cpp Thu Apr 24 16:35:19 2008
@@ -246,7 +246,7 @@
 }
 =

 cGranny::~cGranny () {
-	if (mpBuf) { delete mpBuf; mpBuf =3D 0; }
+	if (mpBuf) { delete[] mpBuf; mpBuf =3D 0; }
 }
 =

 void	cGranny::AssertSize	(const char* p,const int iMinSize) {



From no-reply at zwischenwelt.org  Thu Apr 24 17:16:12 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 24 Apr 2008 15:16:12 -0000
Subject: [Iris-commit] [IRIS] r2088 - in /trunk/lua: lib.3d.dynamic.lua
	lib.3d.map.lua
Message-ID: <20080424151612.3B1F71C18749@zwischenwelt.org>

Author: hagish
Date: Thu Apr 24 17:16:11 2008
New Revision: 2088

Log:
bugfix: double doors, bugfix: double multi

Modified:
    trunk/lua/lib.3d.dynamic.lua
    trunk/lua/lib.3d.map.lua

Modified: trunk/lua/lib.3d.dynamic.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.dynamic.lua (original)
+++ trunk/lua/lib.3d.dynamic.lua Thu Apr 24 17:16:11 2008
@@ -37,7 +37,7 @@
 =

 		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D false
 	=

-		Array2DForAll(Renderer3D.gFastBatchDynamicsMap, function(v,x,y)
+		Array2DForAll(Renderer3D.gFastBatchDynamicsMap, function(v,bx,by)
 			if v.mbUpdateNeeded then
 				-- on demand create
 				if not v.mFastBatch then
@@ -64,6 +64,7 @@
 =

 						local orderval =3D dynamic.zloc -- used for blendout later (fastbatc=
h feature)
 						v.mFastBatch:FastBatch_AddMeshBuffer(GetMeshBuffer(dynamic.meshname)=
, orderval, x,y,z, qw,qx,qy,qz, -1,1,1, r,g,b,a)
+						-- print("->",bx,by,dynamic.serial)
 					end
 				end
 =

@@ -121,6 +122,8 @@
 		end)
 	end
 =

+	Renderer3D:RemoveDynamicFromMap(dynamic)
+
 	local bx =3D math.floor(dynamic.xloc/8)
 	local by =3D math.floor(dynamic.yloc/8)
 	=

@@ -131,23 +134,25 @@
 	local e =3D Array2DGet(Renderer3D.gFastBatchDynamicsMap, bx,by)
 	-- add dynamic if not available
 	if not e.mlDynamic[dynamic.serial] then
-		e.mbUpdateNeeded =3D true
+		-- print("ADD",bx,by,dynamic.serial)
 		e.miCount =3D e.miCount + 1
 		e.mlDynamic[dynamic.serial] =3D dynamic
-		Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
-	end
+	end
+
+	e.mbUpdateNeeded =3D true
+	Renderer3D.gFastBatchDynamicsUpdateNeeded =3D true
 	=

 	-- Renderer3D:ShowDynamicMapStats()
 end
 =

 function Renderer3D:RemoveDynamicFromMap	(dynamic)
-	local bx =3D math.floor(dynamic.xloc/8)
-	local by =3D math.floor(dynamic.yloc/8)
-	=

-	if Array2DGet(Renderer3D.gFastBatchDynamicsMap, bx,by) then
-		local e =3D Array2DGet(Renderer3D.gFastBatchDynamicsMap, bx,by)
+	-- local bx =3D math.floor(dynamic.xloc/8)
+	-- local by =3D math.floor(dynamic.yloc/8)
+	=

+	Array2DForAll(Renderer3D.gFastBatchDynamicsMap, function(e,bx,by)
 		-- remove dynamic if available
 		if e.mlDynamic[dynamic.serial] then
+			-- print("REMOVE",bx,by,dynamic.serial)
 			e.mbUpdateNeeded =3D true
 			e.miCount =3D e.miCount - 1
 			e.mlDynamic[dynamic.serial] =3D nil
@@ -159,7 +164,7 @@
 			if e.mFastBatch then e.mFastBatch:Destroy() end
 			Array2DSet(Renderer3D.gFastBatchDynamicsMap, bx,by, nil)
 		end
-	end
+	end)
 end
 =

 -- untested

Modified: trunk/lua/lib.3d.map.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.map.lua (original)
+++ trunk/lua/lib.3d.map.lua Thu Apr 24 17:16:11 2008
@@ -497,6 +497,7 @@
 		end end
 	end
 	=

+	--[[
 	-- MULTIS (add multis as statics)
 	if (gMultis) then
 		local iTileTypeID,iX,iY,iZ,iHue
@@ -517,11 +518,14 @@
 						iY >=3D UO_Y and iY < UO_Y+self.ROBMAP_CHUNK_SIZE*8 then
 						=

 						self:CreateMapChunkEntity(chunk,iTileTypeID,iX,iY,iZ,iHue,false)
-					end
-				end
-			end
-		end
-	end
+						=

+						print("MULTI PART")
+					end
+				end
+			end
+		end
+	end
+	]]
 =

 	-- TODO : fish in water ? other gimiks ?
 =




From no-reply at zwischenwelt.org  Thu Apr 24 19:16:30 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 24 Apr 2008 17:16:30 -0000
Subject: [Iris-commit] [IRIS] r2089 - in /trunk: include/builder.h
 lua/lib.test.lua lua/main.lua src/builder.cpp src/scripting.iris.cpp
Message-ID: <20080424171630.F16711C18749@zwischenwelt.org>

Author: ghoulsblade
Date: Thu Apr 24 19:16:30 2008
New Revision: 2089

Log:
GenerateRadarImage

Modified:
    trunk/include/builder.h
    trunk/lua/lib.test.lua
    trunk/lua/main.lua
    trunk/src/builder.cpp
    trunk/src/scripting.iris.cpp

Modified: trunk/include/builder.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/builder.h (original)
+++ trunk/include/builder.h Thu Apr 24 19:16:30 2008
@@ -41,10 +41,10 @@
 	class cBitMask;
 };
 =

-void	WriteMapImageToFile	(cGroundBlockLoader& oGroundBlockLoader,cRadarCol=
orLoader& radarColors,cStaticBlockLoader* pStaticBlockLoader,const char* sz=
OutPath,const bool bBig);
-Ogre::TexturePtr	GenerateRadarImageRaw (int iPosX, int iPosY, cGroundBlock=
Loader& oGroundBlockLoader, cStaticBlockLoader& oStaticBlockLoader, cRadarC=
olorLoader& oRadarColorLoader, const char* szMatName);
-void	GenerateMapImageRaw	(int iLeftTileNum,int iTopTileNum,int iImgW,int i=
ImgH,cGroundBlockLoader& oGroundBlockLoader,cRadarColorLoader& radarCols,cS=
taticBlockLoader* pStaticBlockLoader,short* pRawBuffer,bool bBig);
-
+void				WriteMapImageToFile		(cGroundBlockLoader& oGroundBlockLoader,cRada=
rColorLoader& radarColors,cStaticBlockLoader* pStaticBlockLoader,const char=
* szOutPath,const bool bBig);
+Ogre::TexturePtr	GenerateRadarImageRaw	(int iPosX, int iPosY, cGroundBlock=
Loader& oGroundBlockLoader, cStaticBlockLoader& oStaticBlockLoader, cRadarC=
olorLoader& oRadarColorLoader, const char* szMatName);
+bool				GenerateRadarImage		(Ogre::Image& pDest,const int bx0,const int by=
0,const int bx1,const int by1,cGroundBlockLoader& oGroundBlockLoader, cStat=
icBlockLoader& oStaticBlockLoader, cRadarColorLoader& oRadarColorLoader);
+void				GenerateMapImageRaw		(int iLeftTileNum,int iTopTileNum,int iImgW,i=
nt iImgH,cGroundBlockLoader& oGroundBlockLoader,cRadarColorLoader& radarCol=
s,cStaticBlockLoader* pStaticBlockLoader,short* pRawBuffer,bool bBig);
 =

 void	GenerateArtBitMask	(cArtMapLoader& oArtMapLoader,	const int iID,cBitM=
ask& bitmask);
 void	GenerateGumpBitMask	(cGumpLoader& oGumpLoader,		const int iID,cBitMas=
k& bitmask);

Modified: trunk/lua/lib.test.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.test.lua (original)
+++ trunk/lua/lib.test.lua Thu Apr 24 19:16:30 2008
@@ -30,6 +30,15 @@
 	local b =3D LoadImageFromFile("art_fallback.png")
 	ImageBlit(b,a,224,224)
 	a:SaveAsFile("myimagetest2.png")
+	os.exit(0)
+end
+
+function Test_GenerateRadarImage ()
+	local a =3D CreateImage()
+	local bx0,by0 =3D 160,160
+	local bx1,by1 =3D bx0+16*5,by0+16*5
+	GenerateRadarImage(a,bx0,by0,bx1,by1,gGroundBlockLoader,gStaticBlockLoade=
r,gRadarColorLoader)
+	a:SaveAsFile("myimagetest3.png")
 	os.exit(0)
 end
 =


Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Thu Apr 24 19:16:30 2008
@@ -392,7 +392,7 @@
 	ExecuteMapChangeIfNeeded()
 =

 	gCurrentRenderer:BlendOutLayersAbovePlayer()
-
+	=

 	-- Binds all InGame-Keys
 	BindInGameKeys()
 =


Modified: trunk/src/builder.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/builder.cpp (original)
+++ trunk/src/builder.cpp Thu Apr 24 19:16:30 2008
@@ -248,7 +248,7 @@
 	return true;
 }
 =

-
+// TODO : dublicate : WriteArtMapToImage
 bool	GenerateArtImage(Ogre::Image &image, cArtMapLoader& oArtMapLoader,con=
st int iID,const bool bPixelExact,const bool bInvertY,const bool bInvertX,c=
HueLoader* pHueLoader,const short iHue) { PROFILE
 	int iTexW, iTexH;
 	=

@@ -337,6 +337,7 @@
 	return true;
 }
 =

+// TODO : dublicate : GenerateArtImage
 bool	WriteArtMapToImage					(Ogre::Image& pDest,cArtMapLoader& oArtMapLoad=
er,const int iID,cHueLoader* pHueLoader,const short iHue) {
 	int iImgW, iImgH;
 	bool bPixelExact =3D false; // setting this to true would lead to image s=
ize being increased until a multiple of 2 is reached
@@ -479,6 +480,57 @@
 	=

 	delete [] pImgRaw;
 =

+	return true;
+}
+
+/// render radar map for blocks bx0 to bx1 , excluding bx1  [bx0;bx1[
+bool	GenerateRadarImage		(Ogre::Image& pDest,const int bx0,const int by0,c=
onst int bx1,const int by1,cGroundBlockLoader& oGroundBlockLoader, cStaticB=
lockLoader& oStaticBlockLoader, cRadarColorLoader& oRadarColorLoader) {
+	int dbx =3D bx1 - bx0;
+	int dby =3D by1 - by0;
+	int iImgW =3D dbx*8;
+	int iImgH =3D dby*8;
+	if (iImgW <=3D 0 || iImgH <=3D 0) return false;
+	=

+	// prepare vars
+	uint32* pBuf =3D new uint32[iImgW*iImgH];
+	int heightmap[8*8]; // like a z-buffer, for statics
+	=

+	// iterate over blocks
+	for (int ay=3D0;ay<dby;++ay)
+	for (int ax=3D0;ax<dbx;++ax) {
+		// first step, ground
+		cGroundBlock* pGroundBlock =3D oGroundBlockLoader.GetGroundBlock(bx0+ax,=
by0+ay);
+		if (pGroundBlock) {
+			for (int ty=3D0;ty<8;++ty)
+			for (int tx=3D0;tx<8;++tx) {
+				heightmap[ty*8+tx] =3D pGroundBlock->mpRawGroundBlock->mTiles[ty][tx].=
miZ;
+				pBuf[(ay*8+ty)*iImgW+ax*8+tx] =3D Color16To32( oRadarColorLoader.GetCo=
l16( pGroundBlock->mpRawGroundBlock->mTiles[ty][tx].miTileType ) );
+			}
+		} else {
+			for (int ty=3D0;ty<8;++ty)
+			for (int tx=3D0;tx<8;++tx) {
+				heightmap[ty*8+tx] =3D -128;
+				pBuf[(ay*8+ty)*iImgW+ax*8+tx] =3D 0;
+			}
+		}
+		=

+		// second step, statics
+		cStaticBlock* pStaticBlock =3D oStaticBlockLoader.GetStaticBlock(bx0+ax,=
by0+ay);
+		if (pStaticBlock) {
+			for( int s=3D0; s<pStaticBlock->Count(); s++ ) {
+				int tx =3D pStaticBlock->mpRawStaticList[s].miX;
+				int ty =3D pStaticBlock->mpRawStaticList[s].miY;
+				int tz =3D pStaticBlock->mpRawStaticList[s].miZ;
+				int iTileType =3D pStaticBlock->mpRawStaticList[s].miTileID;
+				//~ int iHue =3D pStaticBlock->mpRawStaticList[s].miHue; // TODO ? mod=
ify radar-color using hueloader ? is this needed ?
+				if (heightmap[ty*8+tx] <=3D tz) {
+					heightmap[ty*8+tx] =3D  tz;
+					pBuf[(ay*8+ty)*iImgW+ax*8+tx] =3D Color16To32( oRadarColorLoader.GetC=
ol16( 0x4000 + iTileType ) );
+				}
+			}
+		}
+	}
+	pDest.loadDynamicImage((Ogre::uchar*)pBuf,iImgW,iImgH,1,Ogre::PF_A8R8G8B8=
,true); // autoDelete pBuf32
 	return true;
 }
 =


Modified: trunk/src/scripting.iris.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.iris.cpp (original)
+++ trunk/src/scripting.iris.cpp Thu Apr 24 19:16:30 2008
@@ -16,6 +16,7 @@
 #include "ogremanualloader.h"
 #include "huffman.h"
 #include "lugre_sound.h"
+#include "lugre_image.h"
 =

 using namespace Lugre;
 =

@@ -445,10 +446,31 @@
 }
 =

 =

+
+
+		=

+/// return true on success
+/// renders radarmap into a Ogre::Image (lua wrapper : cImage)
+/// bSuccess	  GenerateRadarImage	(pImage,bx0,by0,bx1,by1,oGroundBlockLoad=
er,oStaticBlockLoader,oRadarColorLoader)
+static int		l_GenerateRadarImage	(lua_State *L) { PROFILE
+	Ogre::Image&			pImage				=3D cLuaBind<cImage>::checkudata_alive(L,1)->mIm=
age;
+	int						bx0					=3D luaL_checkint(L,2);
+	int						by0					=3D luaL_checkint(L,3);
+	int						bx1					=3D luaL_checkint(L,4);
+	int						by1					=3D luaL_checkint(L,5);
+	cGroundBlockLoader&		oGroundBlockLoader	=3D *cLuaBind<cGroundBlockLoader>=
::checkudata_alive(L,6);
+	cStaticBlockLoader&		oStaticBlockLoader	=3D *cLuaBind<cStaticBlockLoader>=
::checkudata_alive(L,7);
+	cRadarColorLoader&		oRadarColorLoader	=3D *cLuaBind<cRadarColorLoader>::c=
heckudata_alive(L,8);
+	if (!GenerateRadarImage(pImage,bx0,by0,bx1,by1,oGroundBlockLoader,oStatic=
BlockLoader,oRadarColorLoader)) return 0;
+	lua_pushboolean(L,true);
+	return 1;
+}
+
 void	Iris_RegisterLuaPlugin	() {
 	=

 	class cIris_ScriptingPlugin : public cScriptingPlugin { public:
 		void	RegisterLua_GlobalFunctions	(lua_State*	L) {
+			lua_register(L,"GenerateRadarImage",			l_GenerateRadarImage);
 			lua_register(L,"HuffmanCompress",				l_HuffmanCompress);
 			lua_register(L,"HuffmanDecompress",				l_HuffmanDecompress);
 			lua_register(L,"BuildTerrainEntity_Simple",		l_BuildTerrainEntity_Simpl=
e);



From no-reply at zwischenwelt.org  Fri Apr 25 01:36:15 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Thu, 24 Apr 2008 23:36:15 -0000
Subject: [Iris-commit] [IRIS] r2090 - in /trunk: data/config.lua.dist
 include/builder.h lua/lib.compass.lua src/builder.cpp
 src/scripting.iris.cpp
Message-ID: <20080424233616.0D1E21C18749@zwischenwelt.org>

Author: ghoulsblade
Date: Fri Apr 25 01:36:15 2008
New Revision: 2090

Log:
new detailcompass up and running

Modified:
    trunk/data/config.lua.dist
    trunk/include/builder.h
    trunk/lua/lib.compass.lua
    trunk/src/builder.cpp
    trunk/src/scripting.iris.cpp

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Fri Apr 25 01:36:15 2008
@@ -83,7 +83,7 @@
 gCompassZoomFactor =3D 1.5
 gCompassSize =3D 150 -- in pixels on screen, set to 0 to disable
 giCompassDetailLimit =3D 12 -- in mapblocks shown
-gCompassVisibleRad =3D giCompassDetailLimit * 4
+gCompassVisibleRad =3D giCompassDetailLimit -- start with detailcompass * 4
 -- todo : gMapImagePath_Small	=3D "tempmap_small.tga"
 -- todo : gMapImagePath_Big		=3D "tempmap_big.tga"
 =


Modified: trunk/include/builder.h
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/include/builder.h (original)
+++ trunk/include/builder.h Fri Apr 25 01:36:15 2008
@@ -43,7 +43,7 @@
 =

 void				WriteMapImageToFile		(cGroundBlockLoader& oGroundBlockLoader,cRada=
rColorLoader& radarColors,cStaticBlockLoader* pStaticBlockLoader,const char=
* szOutPath,const bool bBig);
 Ogre::TexturePtr	GenerateRadarImageRaw	(int iPosX, int iPosY, cGroundBlock=
Loader& oGroundBlockLoader, cStaticBlockLoader& oStaticBlockLoader, cRadarC=
olorLoader& oRadarColorLoader, const char* szMatName);
-bool				GenerateRadarImage		(Ogre::Image& pDest,const int bx0,const int by=
0,const int bx1,const int by1,cGroundBlockLoader& oGroundBlockLoader, cStat=
icBlockLoader& oStaticBlockLoader, cRadarColorLoader& oRadarColorLoader);
+bool				GenerateRadarImage		(Ogre::Image& pDest,const int bx0,const int by=
0,const int dbx,const int dby,cGroundBlockLoader& oGroundBlockLoader, cStat=
icBlockLoader& oStaticBlockLoader, cRadarColorLoader& oRadarColorLoader);
 void				GenerateMapImageRaw		(int iLeftTileNum,int iTopTileNum,int iImgW,i=
nt iImgH,cGroundBlockLoader& oGroundBlockLoader,cRadarColorLoader& radarCol=
s,cStaticBlockLoader* pStaticBlockLoader,short* pRawBuffer,bool bBig);
 =

 void	GenerateArtBitMask	(cArtMapLoader& oArtMapLoader,	const int iID,cBitM=
ask& bitmask);

Modified: trunk/lua/lib.compass.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.compass.lua (original)
+++ trunk/lua/lib.compass.lua Fri Apr 25 01:36:15 2008
@@ -1,6 +1,60 @@
 -- manages the small compass/radar/map thing in the upper right corner of =
the screen
 =

 gCompassOff =3D 20
+
+gDetailMapCacheImage =3D nil
+gDetailMapCacheTexture =3D nil
+gDetailMapCacheMaterial =3D nil
+gDetailMapCacheBX =3D nil
+gDetailMapCacheBY =3D nil
+kDetailMapCacheSize =3D 256
+kDetailMapCacheViewRad =3D 80
+
+-- param : compass-center-pos (player or cam)
+function UpdateDetailMapCacheIfNeeded (xloc,yloc)
+	-- check if we need to update cache, return if not
+	if (gDetailMapCacheBX) then
+		local r =3D kDetailMapCacheViewRad
+		local dx =3D xloc - gDetailMapCacheBX * 8
+		local dy =3D yloc - gDetailMapCacheBY * 8
+		if (dx >=3D r and dx <=3D kDetailMapCacheSize - r and
+			dy >=3D r and dy <=3D kDetailMapCacheSize - r) then return end -- no up=
date needed
+	end
+	=

+	-- first time init
+	if (not gDetailMapCacheImage) then
+		gDetailMapCacheImage =3D CreateImage()
+	end
+	=

+	print("UpdateDetailMapCacheIfNeeded : updating....")
+	=

+	-- update image
+	local bx0,dbx =3D math.floor((xloc-kDetailMapCacheSize/2)/8),kDetailMapCa=
cheSize/8
+	local by0,dby =3D math.floor((yloc-kDetailMapCacheSize/2)/8),kDetailMapCa=
cheSize/8
+	GenerateRadarImage(gDetailMapCacheImage,bx0,by0,dbx,dby,gGroundBlockLoade=
r,gStaticBlockLoader,gRadarColorLoader)
+	gDetailMapCacheBX =3D bx0
+	gDetailMapCacheBY =3D by0
+	=

+	-- create or update texture
+	if (gDetailMapCacheTexture) then =

+		gDetailMapCacheImage:LoadToTexture(gDetailMapCacheTexture) -- update exi=
sting texture
+	else
+		gDetailMapCacheTexture =3D gDetailMapCacheImage:MakeTexture() -- generat=
e new texture
+	end
+	=

+	-- create material on first time init
+	if (not gDetailMapCacheMaterial) then
+		gDetailMapCacheMaterial =3D GetPlainTextureMat(gDetailMapCacheTexture)
+	end
+end
+
+--[[
++       gDetailImage =3D CreateImage()
++       local bx0,by0 =3D 160,160
++       local bx1,by1 =3D bx0+16*5,by0+16*5
++       GenerateRadarImage(a,bx0,by0,bx1,by1,gGroundBlockLoader,gStaticBlo=
ckLoader,gRadarColorLoader)
++       a:SaveAsFile("myimagetest3.png")
+]]--
 =

 -- called from lib.gui.lua : gui.StartGame()
 function InitCompassIfNeeded () =

@@ -13,6 +67,7 @@
 	if (gCompassSize > 0) then
 		gIrisCompassDialog =3D guimaker.MakeSortedDialog()
 		gIrisCompassDialog.rootwidget.gfx:SetPos(vw-gCompassSize - gCompassOff,1=
5 + gCompassOff)
+		gIrisCompassDialog.detailcompass 		=3D gIrisCompassDialog.rootwidget:Cre=
ateChild()
 		gIrisCompassDialog.compass 				=3D gIrisCompassDialog.rootwidget:CreateC=
hild()
 		gIrisCompassDialog.mapdot 				=3D gIrisCompassDialog.rootwidget:CreateCh=
ild()
 		gIrisCompassDialog.compassframe_static	=3D gIrisCompassDialog.rootwidget=
:CreateChild()
@@ -25,6 +80,12 @@
 		if (gIrisCompassDialog.compass) then
 			gIrisCompassDialog.compass.gfx:InitCompass()
 			gIrisCompassDialog.compass.gfx:SetDimensions(gCompassSize,gCompassSize)
+		end
+		=

+		-- detail compass
+		if (gIrisCompassDialog.detailcompass) then
+			local mygfx =3D gIrisCompassDialog.detailcompass.gfx
+			mygfx:InitRROC()
 		end
 		=

 		gIrisCompassDialog.bDoUpdate =3D true
@@ -152,11 +213,15 @@
 	gCompassMapH =3D gGroundBlockLoader and gGroundBlockLoader:GetMapH() or 1
 	ZoomCompass(1.0)
 	=

-	if (gGroundBlockLoader and gStaticBlockLoader and gRadarColorLoader and g=
EnableCompassRadar) then
-		profile:StartSection("radar")
-		gIrisCompassDialog.radar:Destroy()
-		gIrisCompassDialog.radar =3D CreateRadar( gGroundBlockLoader, gStaticBlo=
ckLoader, gRadarColorLoader )
-	end
+	-- mapchange, reload detail map
+	gDetailMapCacheBX =3D nil
+	gDetailMapCacheBY =3D nil
+	=

+	--~ if (gGroundBlockLoader and gStaticBlockLoader and gRadarColorLoader a=
nd gEnableCompassRadar) then
+		--~ profile:StartSection("radar")
+		--~ gIrisCompassDialog.radar:Destroy()
+		--~ gIrisCompassDialog.radar =3D CreateRadar( gGroundBlockLoader, gStati=
cBlockLoader, gRadarColorLoader )
+	--~ end
 	=

 	-- to set geometry correctly
 	profile:StartSection("updategeom")
@@ -165,6 +230,11 @@
 	profile:Finish()
 end
 =

+
+function IsRoughCompassActive ()
+	return (gCompassVisibleRad > giCompassDetailLimit)
+end
+
 -- factor > 1 increases sight radius
 -- zoom map in compass, called from lib.input.lua on keypress (,.)
 function ZoomCompass (factor) =

@@ -172,9 +242,10 @@
 	if (not gIrisCompassDialog) then return end
 	gCompassVisibleRad =3D gCompassVisibleRad * factor
 	--AddFadeLines("visrad=3D"..gCompassVisibleRad)
-	local bRoughCompass =3D (gCompassVisibleRad > giCompassDetailLimit) or (n=
ot gIrisCompassDialog.radar)
 	gCompassVisibleRad =3D max(gCompassVisibleRad,giCompassDetailLimit)
-	gIrisCompassDialog.compass.gfx:SetVisible( bRoughCompass )
+	local bRough =3D IsRoughCompassActive()
+	gIrisCompassDialog.detailcompass.gfx:SetVisible( not bRough )
+	gIrisCompassDialog.compass.gfx:SetVisible( bRough )
 	gIrisCompassDialog.compass.gfx:SetUVRad(gCompassVisibleRad/gCompassMapW,
 											gCompassVisibleRad/gCompassMapH)
 end
@@ -199,7 +270,41 @@
 		local mx =3D vw - gCompassSize/2 - gCompassOff
 		local my =3D 15 + gCompassSize/2 + gCompassOff
 		local halfwidth =3D 128
-
+		local bRough =3D IsRoughCompassActive()
+		=

+		-- detail compass
+		if (not bRough) then
+			local xloc,yloc =3D iCamOverBlockX*8, iCamOverBlockY*8
+			UpdateDetailMapCacheIfNeeded(xloc,yloc)
+			local mygfx =3D gIrisCompassDialog.detailcompass.gfx
+			=

+			-- set material, only needed once
+			if (not mygfx.bDetailCompassMatHasBeenSet) then =

+				mygfx.bDetailCompassMatHasBeenSet =3D true
+				mygfx:SetMaterial(gDetailMapCacheMaterial) =

+			end
+			=

+			-- prepare vars
+			local e =3D 1/kDetailMapCacheSize
+			local dx =3D xloc - gDetailMapCacheBX * 8
+			local dy =3D yloc - gDetailMapCacheBY * 8
+			local k =3D 11
+			=

+			mygfx:RenderableBegin(k+2,0,true,false,OT_TRIANGLE_FAN)
+			mygfx:RenderableVertex((mx)/vw * 2.0 - 1.0,(my)/vh * (-2.0) + 1.0,z, dx=
*e,dy*e)
+			for i =3D 0,k do
+				local a =3D 360*gfDeg2Rad*i/k
+				local x =3D   kDetailMapCacheViewRad * math.sin(a)
+				local y =3D   kDetailMapCacheViewRad * math.cos(a)
+				local u =3D ( kDetailMapCacheViewRad * math.sin(a + ax + gfDeg2Rad*180=
) + dx)*e
+				local v =3D ( kDetailMapCacheViewRad * math.cos(a + ax + gfDeg2Rad*180=
) + dy)*e
+				mygfx:RenderableVertex((mx + x)/vw * 2.0 - 1.0,(my + y)/vh * (-2.0) + =
1.0,z, u,v)
+			end
+			mygfx:RenderableEnd()
+		end
+		=

+		-- old radar
+		--[[
 		if (gIrisCompassDialog.radar) then
 			--MemProfile("a")
 			gIrisCompassDialog.radar:SetLocation( iCamOverBlockX*8, iCamOverBlockY*=
8 ) -- TODO : memleak, old tiles (and textures?) not freed
@@ -213,8 +318,9 @@
 				gIrisCompassDialog.radar:SetMirrorX( false )
 			end
 		end
-
-		if (gIrisCompassDialog.compass.gfx) then
+		]]--
+
+		if (gIrisCompassDialog.compass.gfx and bRough) then
 			gIrisCompassDialog.compass.gfx:SetAngBias(ax)
 			gIrisCompassDialog.compass.gfx:SetUVMid(iCamOverBlockX/gCompassMapW, iC=
amOverBlockY/gCompassMapH)
 		end

Modified: trunk/src/builder.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/builder.cpp (original)
+++ trunk/src/builder.cpp Fri Apr 25 01:36:15 2008
@@ -483,10 +483,8 @@
 	return true;
 }
 =

-/// render radar map for blocks bx0 to bx1 , excluding bx1  [bx0;bx1[
-bool	GenerateRadarImage		(Ogre::Image& pDest,const int bx0,const int by0,c=
onst int bx1,const int by1,cGroundBlockLoader& oGroundBlockLoader, cStaticB=
lockLoader& oStaticBlockLoader, cRadarColorLoader& oRadarColorLoader) {
-	int dbx =3D bx1 - bx0;
-	int dby =3D by1 - by0;
+/// render radar map for dbx,dby blocks starting at bx0,by0
+bool	GenerateRadarImage		(Ogre::Image& pDest,const int bx0,const int by0,c=
onst int dbx,const int dby,cGroundBlockLoader& oGroundBlockLoader, cStaticB=
lockLoader& oStaticBlockLoader, cRadarColorLoader& oRadarColorLoader) {
 	int iImgW =3D dbx*8;
 	int iImgH =3D dby*8;
 	if (iImgW <=3D 0 || iImgH <=3D 0) return false;

Modified: trunk/src/scripting.iris.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.iris.cpp (original)
+++ trunk/src/scripting.iris.cpp Fri Apr 25 01:36:15 2008
@@ -450,18 +450,18 @@
 =

 		=

 /// return true on success
-/// renders radarmap into a Ogre::Image (lua wrapper : cImage)
-/// bSuccess	  GenerateRadarImage	(pImage,bx0,by0,bx1,by1,oGroundBlockLoad=
er,oStaticBlockLoader,oRadarColorLoader)
+/// renders radarmap into a Ogre::Image (lua wrapper : cImage)  for dbx,db=
y blocks starting at bx0,by0
+/// bSuccess	  GenerateRadarImage	(pImage,bx0,by0,dbx,dby,oGroundBlockLoad=
er,oStaticBlockLoader,oRadarColorLoader)
 static int		l_GenerateRadarImage	(lua_State *L) { PROFILE
 	Ogre::Image&			pImage				=3D cLuaBind<cImage>::checkudata_alive(L,1)->mIm=
age;
 	int						bx0					=3D luaL_checkint(L,2);
 	int						by0					=3D luaL_checkint(L,3);
-	int						bx1					=3D luaL_checkint(L,4);
-	int						by1					=3D luaL_checkint(L,5);
+	int						dbx					=3D luaL_checkint(L,4);
+	int						dby					=3D luaL_checkint(L,5);
 	cGroundBlockLoader&		oGroundBlockLoader	=3D *cLuaBind<cGroundBlockLoader>=
::checkudata_alive(L,6);
 	cStaticBlockLoader&		oStaticBlockLoader	=3D *cLuaBind<cStaticBlockLoader>=
::checkudata_alive(L,7);
 	cRadarColorLoader&		oRadarColorLoader	=3D *cLuaBind<cRadarColorLoader>::c=
heckudata_alive(L,8);
-	if (!GenerateRadarImage(pImage,bx0,by0,bx1,by1,oGroundBlockLoader,oStatic=
BlockLoader,oRadarColorLoader)) return 0;
+	if (!GenerateRadarImage(pImage,bx0,by0,dbx,dby,oGroundBlockLoader,oStatic=
BlockLoader,oRadarColorLoader)) return 0;
 	lua_pushboolean(L,true);
 	return 1;
 }



From no-reply at zwischenwelt.org  Fri Apr 25 19:09:40 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 25 Apr 2008 17:09:40 -0000
Subject: [Iris-commit] [IRIS] r2091 - in /trunk/lua: gui/gui.healthbar.lua
 lib.uoids.lua main.lua obj/obj.mobile.lua
Message-ID: <20080425170940.C84871C186F1@zwischenwelt.org>

Author: ghoulsblade
Date: Fri Apr 25 19:09:39 2008
New Revision: 2091

Log:
healthbar now supports green(poison) and golden(cannot heal,bleed), added g=
ump-exporter -eg

Modified:
    trunk/lua/gui/gui.healthbar.lua
    trunk/lua/lib.uoids.lua
    trunk/lua/main.lua
    trunk/lua/obj/obj.mobile.lua

Modified: trunk/lua/gui/gui.healthbar.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.healthbar.lua (original)
+++ trunk/lua/gui/gui.healthbar.lua Fri Apr 25 19:09:39 2008
@@ -4,6 +4,12 @@
 healthbarGump.dialogId =3D 2000001
 healthbarGump.x =3D 0
 healthbarGump.y =3D 0
+
+kStatBar_BarRed		=3D 2053
+kStatBar_BarBlue	=3D 2054
+kStatBar_BarGreen	=3D 2056
+kStatBar_BarGolden	=3D 2057
+ =

 healthbarGump.Data =3D
 	 "{ page 0 }" ..
 	 "{ gumppic 0 0 2051 healthbar }" ..
@@ -13,6 +19,7 @@
 	 "{ gumppic 35 11 2054 hitsbar }" ..
 	 "{ gumppic 35 25 2054 manabar }" ..
 	 "{ gumppic 35 39 2054 stambar }"
+	 =

 healthbarGump.textline =3D {
 }
 =

@@ -53,6 +60,36 @@
 	end
 end
 =

+-- color healthbar for poison/golden effect, called from mobile:UpdateFlag=
s()
+function StatBar_UpdateMobileFlags (mobile)
+	local dialog =3D gHealthbarDialogs[mobile.serial]
+	if (not dialog) then return end
+	local bPoisoned	=3D TestBit(mobile.flag,kMobileFlag_Poisoned) =

+	local bGolden	=3D TestBit(mobile.flag,kMobileFlag_GoldenHealth) =

+	local iGumpID =3D kStatBar_BarBlue
+	local hueid =3D 0
+	if (bPoisoned)	then iGumpID =3D kStatBar_BarGreen end
+	if (bGolden)	then iGumpID =3D kStatBar_BarGolden end
+	local mat =3D GetGumpMat(iGumpID,hueid)
+	local widget =3D dialog.controls["hitsbar"]
+	widget.gfx:SetMaterial(mat)
+	--[[ =

+	gui.gumpparser.lua:148:function GumpParser(Gumpdata, Clientsidemode)
+	{ gumppic 35 38 2054 hitsbar }
+	 { gumppic 35 11 2054 hitsbar }
+	 -- MakeBorderGumpPart( curparent, bToken[4], bToken[2], bToken[3], 0, 0,=
 0, tonumber(huenumber) )
+	local mat =3D GetGumpMat(iGumpID,hueid)
+	function gMobilePrototype:UpdateHealth (curvalue,maxvalue)
+			gCurrentRenderer:NotifyHPChange(self.serial, old, curvalue)
+			self.stats.curHits =3D curvalue
+			self.stats.maxHits =3D maxvalue
+			self:NotifyListener("Mobile_UpdateStats")
+		mobile:UpdateFlags
+			SetHitpoints(self.stats.curHits/self.stats.maxHits)
+			SetNpcHealthbarHitpoints(self, self.stats.curHits / self.stats.maxHits)
+	]]--
+end
+
 -- sets the current hitpoints (in %), x is between 0.0 and 1.0
 function SetHitpoints (x)
 	SetStatsBar("hitsbar",x)

Modified: trunk/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoids.lua (original)
+++ trunk/lua/lib.uoids.lua Fri Apr 25 19:09:39 2008
@@ -29,11 +29,11 @@
 kMobileFlag_Unknown1		=3D hex2num("0x01")
 kMobileFlag_Unknown2		=3D hex2num("0x02") -- either CanAlterPaperdoll (nec=
ro) or Female (jerrit)
 kMobileFlag_Poisoned		=3D hex2num("0x04")
-kMobileFlag_GoldenHealth	=3D hex2num("0x08") -- =3D YellowHits , healthbar=
 gets yellow
+kMobileFlag_GoldenHealth	=3D hex2num("0x08") -- =3D YellowHits , healthbar=
 gets yellow (bleed attack, caused by troglodytes for example, can't healt =
then)
 kMobileFlag_FactionShip		=3D hex2num("0x10") -- unsure why client needs to=
 know
 kMobileFlag_Movable			=3D hex2num("0x20") -- Movable if normally not
 kMobileFlag_WarMode			=3D hex2num("0x40")
-kMobileFlag_Hidden			=3D hex2num("0x80")
+kMobileFlag_Hidden			=3D hex2num("0x80") -- probably self while hiding/ste=
alth-walking, displayed as gray in original client
 =

 gSkillNumber =3D 55		--RunUO-ML
 =


Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Fri Apr 25 19:09:39 2008
@@ -457,6 +457,25 @@
 =

 -- exports data if some commandline parameters are set
 function InvokeExporters ()
+	if (gCommandLineArguments[1] =3D=3D "-eg") then -- export gumps
+		local iGumpIDMin =3D gCommandLineArguments[gCommandLineSwitches["-eg"]+1]
+		local iGumpIDMax =3D gCommandLineArguments[gCommandLineSwitches["-eg"]+2]
+		for iGumpID =3D iGumpIDMin,iGumpIDMax do
+			local iHue =3D 0
+			print("exporting gump : ",iGumpID)
+			local mat =3D GetGumpMat(iGumpID,iHue)
+			local tex =3D GetTexture(mat)
+			if (tex) then
+				local img =3D LoadImageFromTexture(tex)
+				local sFilePath =3D sprintf("../mygumps/gump%08d.png",iGumpID)
+				img:SaveAsFile(sFilePath)
+				img:Destroy()
+			end
+		end
+		print("done")
+		os.exit(0)
+	end
+	=

 	if (gCommandLineArguments[1] =3D=3D "-ea") then -- export artmaps
 		local count =3D hex2num("0x00004000")
 		print("exporting artmaps : ",count)

Modified: trunk/lua/obj/obj.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.mobile.lua (original)
+++ trunk/lua/obj/obj.mobile.lua Fri Apr 25 19:09:39 2008
@@ -186,6 +186,7 @@
 	=

 	if (self.old_flag ~=3D self.flag) then -- only if a change has occurred
 		self.old_flag  =3D self.flag
+		StatBar_UpdateMobileFlags(self)
 		self:NotifyListener("Mobile_UpdateFlags")
 	end
 end



From no-reply at zwischenwelt.org  Fri Apr 25 22:57:15 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 25 Apr 2008 20:57:15 -0000
Subject: [Iris-commit] [IRIS] r2092 - /trunk/lua/gui/gui.quit.lua
Message-ID: <20080425205716.6926B1C1870E@zwischenwelt.org>

Author: hagish
Date: Fri Apr 25 22:57:14 2008
New Revision: 2092

Log:
bugfix: invalid gfx2d pointer in quit dialog

Modified:
    trunk/lua/gui/gui.quit.lua

Modified: trunk/lua/gui/gui.quit.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.quit.lua (original)
+++ trunk/lua/gui/gui.quit.lua Fri Apr 25 22:57:14 2008
@@ -17,7 +17,7 @@
 }
 quitGump.functions =3D {
  -- quitcanel
- [0]	=3D function (widget,mousebutton) if (mousebutton =3D=3D 1) then widg=
et.dialog:Close() end end,
+ [0]	=3D function (widget,mousebutton) if (mousebutton =3D=3D 1) then widg=
et.dialog:Close() gQuitDialog =3D nil end end,
  -- quitok
  [1]	=3D function (widget,mousebutton) if (mousebutton =3D=3D 1) then Term=
inate() end end,
 }



From no-reply at zwischenwelt.org  Sat Apr 26 00:31:49 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 25 Apr 2008 22:31:49 -0000
Subject: [Iris-commit] [IRIS] r2093 - in /trunk/lua: gui/gui.status.lua
 net/net.other.lua obj/obj.mobile.lua
Message-ID: <20080425223149.236781C1870E@zwischenwelt.org>

Author: hagish
Date: Sat Apr 26 00:31:48 2008
New Revision: 2093

Log:
stat lock buttons in status display works

Modified:
    trunk/lua/gui/gui.status.lua
    trunk/lua/net/net.other.lua
    trunk/lua/obj/obj.mobile.lua

Modified: trunk/lua/gui/gui.status.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.status.lua (original)
+++ trunk/lua/gui/gui.status.lua Sat Apr 26 00:31:48 2008
@@ -63,6 +63,7 @@
 function UpdateStatusAos ()
 	if gStatusAosDialog then
 		gStatusAosDialog:UpdateStats()
+		gStatusAosDialog:UpdateStatsLock()
 	end
 end
 		=

@@ -167,7 +168,59 @@
 	=

 		-- set stats
 		dialog:UpdateStats()
+		=

+		-- lock buttons
+		if gPlayerBodySerial then
+			local mobile =3D GetMobile(gPlayerBodySerial)
+			if mobile.statslockstate then
+				local str, dex, int =3D unpack(mobile.statslockstate)
+				=

+				local dx,dy =3D -48,0
+
+				local x,y =3D dialog.controls["statusstr"].gfx:GetPos()
+				dialog.lockbutton_str =3D CreateStatusAOSLockButton(dialog.rootwidget,=
 x + dx, y + dy, 0, str)
+				local x,y =3D dialog.controls["statusdex"].gfx:GetPos()
+				dialog.lockbutton_dex =3D CreateStatusAOSLockButton(dialog.rootwidget,=
 x + dx, y + dy, 1, dex)
+				local x,y =3D dialog.controls["statusint"].gfx:GetPos()
+				dialog.lockbutton_int =3D CreateStatusAOSLockButton(dialog.rootwidget,=
 x + dx, y + dy, 2, int)
+			end
+		end
+		=

+		-- updates the lock buttons
+		dialog.UpdateStatsLock	=3D function	()
+			local mobile =3D GetMobile(gPlayerBodySerial)
+			if mobile.statslockstate then
+				local str, dex, int =3D unpack(mobile.statslockstate)
+				-- print("UpdateStatsLock",str, dex, int)
+				if dialog.lockbutton_str then dialog.lockbutton_str:SetLockState(str) =
end
+				if dialog.lockbutton_dex then dialog.lockbutton_dex:SetLockState(dex) =
end
+				if dialog.lockbutton_int then dialog.lockbutton_int:SetLockState(int) =
end
+			end
+		end
 	end
 end
 =

-
+-- creates a stats lock button, up/down/locked
+-- stat (0=3Dstr, 1=3Ddex, 2=3Dint)
+-- lockstate (0=3Dup, 1=3Ddown, 2=3Dlocked)
+function CreateStatusAOSLockButton	(dialog, x, y, stat, lockstate)
+	local button =3D {}
+	button.button_up =3D MakeGumpButtonFunctionOnClick(dialog, hex2num("0x983=
"), hex2num("0x984"), hex2num("0x984"), x+1, y, 9, 11,
+		function (widget,mousebutton) Send_StatsLockState(stat, 1) button:SetLoc=
kState(1) end)
+		=

+	button.button_down =3D MakeGumpButtonFunctionOnClick(dialog, hex2num("0x9=
85"), hex2num("0x986"), hex2num("0x986"), x+1, y, 9, 11,
+		function (widget,mousebutton) Send_StatsLockState(stat, 2) button:SetLoc=
kState(2) end)
+	=

+	button.button_lock =3D MakeGumpButtonFunctionOnClick(dialog, hex2num("0x8=
2c"), hex2num("0x82c"), hex2num("0x82c"), x, y, 12, 15,
+		function (widget,mousebutton) Send_StatsLockState(stat, 0) button:SetLoc=
kState(0) end)
+	=

+	button.SetLockState =3D function	(self, lockstate2)
+		self.button_up.gfx:SetVisible(lockstate2 =3D=3D 0)
+		self.button_down.gfx:SetVisible(lockstate2 =3D=3D 1)
+		self.button_lock.gfx:SetVisible(lockstate2 =3D=3D 2)
+	end
+	=

+	button:SetLockState(lockstate)
+	=

+	return button
+end

Modified: trunk/lua/net/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.other.lua (original)
+++ trunk/lua/net/net.other.lua Sat Apr 26 00:31:48 2008
@@ -110,6 +110,21 @@
 	return text
 end
 =

+
+-- sends the server the lock state of one stat
+-- stat (0=3Dstr, 1=3Ddex, 2=3Dint)
+-- lockstate (0=3Dup, 1=3Ddown, 2=3Dlocked)
+function Send_StatsLockState(stat, lockstate)
+	-- print("DEBUG","Send_StatsLockState",stat,lockstate)
+	local out =3D GetSendFIFO()
+	out:PushNetUint8(kPacket_Generic_Command)
+	out:PushNetUint16(7)
+	out:PushNetUint16(kPacket_Generic_SubCommand_ExtendedStats2)
+	out:PushNetUint8(stat)
+	out:PushNetUint8(lockstate)
+	out:SendPacket()
+end
+
 -- TODO : implement all subpackets
 function gPacketHandler.kPacket_Generic_Command()
 	local input =3D GetRecvFIFO()
@@ -226,11 +241,31 @@
 			local party_value  =3D input:PopNetUint8()
 			--printf("NET: States LockInfo party_cmd: 0x%02x party_serial: 0x%08x p=
arty_value: 0x%02x\n",party_cmd,party_serial,party_value)
 		end
+		-- statlock info
+		--[[
+			sent by server SERVER
+			Subcommand: 0x19: Extended stats
+			BYTE[1] type // always 2 ? never seen other value
+			BYTE[4] serial
+			BYTE[1] unknown // always 0 ?
+			BYTE[1] lockBits // Bits: XXSS DDII (s=3Dstrength, d=3Ddex, i=3Dint), 0=
 =3D up, 1 =3D down, 2 =3D locked
+		]]
 		if (party_cmd =3D=3D hex2num("0x02")) then
-			local party_serial =3D input:PopNetUint32()
-			local party_value  =3D input:PopNetUint8()
-			local party_lockflags  =3D input:PopNetUint8()
-			--printf("NET: States LockInfo party_cmd: 0x%02x party_serial: 0x%08x p=
arty_value: 0x%02x party_lockflags: 0x%02x\n",party_cmd,party_serial,party_=
value,party_lockflags)
+			local serial =3D input:PopNetUint32()
+			local value  =3D input:PopNetUint8()
+			local lockflags  =3D input:PopNetUint8()
+			local int =3D BitwiseAND(BitwiseSHR(lockflags, 0), 3)
+			local dex =3D BitwiseAND(BitwiseSHR(lockflags, 2), 3)
+			local str =3D BitwiseAND(BitwiseSHR(lockflags, 4), 3)
+			=

+			local mobile =3D GetMobile(serial)
+			if mobile then
+				mobile:UpdateStatsLockState(str, dex, int)
+			else
+				print("NET: got statsLockStats from unknown mobile", serial, str, dex,=
 int)
+			end
+			=

+			-- printf("NET: States LockInfo party_cmd: 0x%02x party_serial: 0x%08x =
party_value: 0x%02x party_lockflags: 0x%02x\n",party_cmd,party_serial,party=
_value,party_lockflags)
 		end
 		if (party_cmd =3D=3D hex2num("0x1a")) then
 			local party_stattype  =3D input:PopNetUint8()

Modified: trunk/lua/obj/obj.mobile.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/obj/obj.mobile.lua (original)
+++ trunk/lua/obj/obj.mobile.lua Sat Apr 26 00:31:48 2008
@@ -191,6 +191,15 @@
 	end
 end
 =

+
+-- sets the lockstate of the stats (send by server)
+-- lockstate (0=3Dup, 1=3Ddown, 2=3Dlocked)
+function gMobilePrototype:UpdateStatsLockState (str, dex, int)
+	-- print("DEBUG","StatsLockStateUpdate",self.serial, str, dex, int)
+	self.statslockstate =3D {str, dex, int}
+	UpdateStatusAos()
+end
+
 function gMobilePrototype:UpdateStats (stats)
 	-- local oldhp =3D mobile.stats.curHits or stats.curHits
 	self.name =3D stats.name



From no-reply at zwischenwelt.org  Sat Apr 26 01:20:59 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Fri, 25 Apr 2008 23:20:59 -0000
Subject: [Iris-commit] [IRIS] r2094 - /trunk/lua/lib.3d.combat.lua
Message-ID: <20080425232059.7EDCE1C1870E@zwischenwelt.org>

Author: hagish
Date: Sat Apr 26 01:20:59 2008
New Revision: 2094

Log:
small damage text improvements

Modified:
    trunk/lua/lib.3d.combat.lua

Modified: trunk/lua/lib.3d.combat.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.combat.lua (original)
+++ trunk/lua/lib.3d.combat.lua Sat Apr 26 01:20:59 2008
@@ -1,4 +1,7 @@
 Renderer3D.gCombatFadeDamageText =3D {}
+Renderer3D.gCombatFadeDamageTextQueue =3D {}
+Renderer3D.gCombatFadeDamageTextQueueNextPopTime =3D nil
+Renderer3D.gCombatFadeDamageTextQueueNextPopTimeout =3D 250
 =

 -- creates a moving and disapearing damage text at the given tile position=
 (x,y,z) (lifetime in sec, speed in ?)
 function Renderer3D:CombatCreateDamageText (text, x, y, z, r, g, b, a, siz=
e, speed, lifetime)
@@ -11,8 +14,7 @@
 	size =3D size or 0.50
 	lifetime =3D lifetime or 1.5
 	=

-	o.starttime =3D gMyTicks
-	o.deathtime =3D o.starttime + lifetime * 1000
+	o.lifetime =3D lifetime
 	o.speed =3D speed
 	=

 	-- tile -> realpos
@@ -34,13 +36,13 @@
 	o.gfx:SetText(text, size, r, g, b, a)
 	o.gfx:SetPosition(x,y,z)
 	o.gfx:SetCastShadows(false)
+	o.gfx:SetVisible(false)
 						 =

-	table.insert(self.gCombatFadeDamageText,o)
+	table.insert(self.gCombatFadeDamageTextQueue,o)
 end
 =

 -- helper to plop damage
 function Renderer3D:NotifyDamage (serial, damage)
-	print("DAMAGE",damage)
 	local mobile =3D GetMobile(serial)
 	if mobile and damage then
 		local r,g,b,a =3D 1.0, 1.0, 0.0, 0.8
@@ -53,7 +55,6 @@
 =

 -- helper to plop hp adds
 function Renderer3D:NotifyHPChange (serial, oldhp, newhp)
-	print("HP CHANGE",oldhp,newhp)
 	local mobile =3D GetMobile(serial)
 	if mobile and oldhp and newhp then
 		local r,g,b,a =3D 0.0, 0.0, 0.0, 0.8
@@ -69,7 +70,24 @@
 end
 =

 function Renderer3D:CombatGuiStep ()
-	local f =3D Client_GetPhysStepTime()
+	-- is the delay between the last one big enough?
+	if =

+		countarr(Renderer3D.gCombatFadeDamageTextQueue) > 0 and
+		(
+			not Renderer3D.gCombatFadeDamageTextQueueNextPopTime or =

+			Renderer3D.gCombatFadeDamageTextQueueNextPopTime <=3D gMyTicks
+		)
+	then
+		local o =3D table.remove(Renderer3D.gCombatFadeDamageTextQueue)
+		o.starttime =3D gMyTicks
+		o.deathtime =3D o.starttime + o.lifetime * 1000
+		=

+		table.insert(self.gCombatFadeDamageText,o)
+		o.gfx:SetVisible(true)
+		=

+		Renderer3D.gCombatFadeDamageTextQueueNextPopTime =3D gMyTicks + Renderer=
3D.gCombatFadeDamageTextQueueNextPopTimeout
+	end
+	=

 	for k,o in pairs(self.gCombatFadeDamageText) do =

 		-- move the text towards the sky :)
 		local p =3D (gMyTicks - o.starttime) / (o.deathtime - o.starttime)



From no-reply at zwischenwelt.org  Sat Apr 26 02:16:16 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 26 Apr 2008 00:16:16 -0000
Subject: [Iris-commit] [IRIS] r2095 - /trunk/lua/lib.unifont.lua
Message-ID: <20080426001616.46AD11C1870E@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Apr 26 02:16:14 2008
New Revision: 2095

Log:
small fix in example code

Modified:
    trunk/lua/lib.unifont.lua

Modified: trunk/lua/lib.unifont.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.unifont.lua (original)
+++ trunk/lua/lib.unifont.lua Sat Apr 26 02:16:14 2008
@@ -32,7 +32,7 @@
 	=

 	=

 	-- spritelist
-	local spritelist =3D CreateSpriteList(gRenderMan2D_Dialogs,false,true)
+	local spritelist =3D CreateSpriteList(GetGUILayer_Dialogs(),false,true)
 	spritelist.asgroup =3D spritelist:CastToRenderGroup2D()
 	spritelist.asgroup:SetClip(24,4,122,22)
 	spritelist:SetTexture("guibase.png")



From no-reply at zwischenwelt.org  Sat Apr 26 04:29:29 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 26 Apr 2008 02:29:29 -0000
Subject: [Iris-commit] [IRIS] r2096 - /trunk/lua/main.lua
Message-ID: <20080426022929.94BF21C186F1@zwischenwelt.org>

Author: ghoulsblade
Date: Sat Apr 26 04:29:28 2008
New Revision: 2096

Log:
guitest commandline param

Modified:
    trunk/lua/main.lua

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Sat Apr 26 04:29:28 2008
@@ -299,6 +299,7 @@
 	-- if (false) then TestMultiLoader() end
 	-- if (false) then TestZLib() end
 	-- if (false) then TestUniFontLoader() end
+	if (gCommandLineSwitches["-testbutton"]) then MyGuiSystemButtonTest() end
 	-------------------------------------------------------------------------=
---------------------------------
 =

 	-- maybe we should check here if in offline or online mode!?



From no-reply at zwischenwelt.org  Sat Apr 26 05:53:32 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sat, 26 Apr 2008 03:53:32 -0000
Subject: [Iris-commit] [IRIS] r2097 - in /trunk: data/base/mapdot.png
 data/config.lua.dist data/uoam/ lua/lib.compass.lua
Message-ID: <20080426035332.CF50D1C186F1@zwischenwelt.org>

Author: hagish
Date: Sat Apr 26 05:53:32 2008
New Revision: 2097

Log:
compass displays mobiles
first uoautomap file loading (just put .map files into data/uoam)

Added:
    trunk/data/uoam/
Modified:
    trunk/data/base/mapdot.png
    trunk/data/config.lua.dist
    trunk/lua/lib.compass.lua

Modified: trunk/data/base/mapdot.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/config.lua.dist
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/config.lua.dist (original)
+++ trunk/data/config.lua.dist Sat Apr 26 05:53:32 2008
@@ -82,6 +82,7 @@
 =

 gCompassZoomFactor =3D 1.5
 gCompassSize =3D 150 -- in pixels on screen, set to 0 to disable
+giCompassVisiblePixelRadius =3D 72 -- for limiting border points
 giCompassDetailLimit =3D 12 -- in mapblocks shown
 gCompassVisibleRad =3D giCompassDetailLimit -- start with detailcompass * 4
 -- todo : gMapImagePath_Small	=3D "tempmap_small.tga"
@@ -455,6 +456,7 @@
 =

 -- the detailed compass is rendered using stencil buffers and seems to cau=
se trouble with shadows
 gEnableCompassRadar =3D false
+gbCompassShowMobiles =3D true
 =

 --"med", "low", "ultralow", "none"	(none stands for: use highest single te=
xtures)
 gAtlasRes =3D "med"

Modified: trunk/lua/lib.compass.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.compass.lua (original)
+++ trunk/lua/lib.compass.lua Sat Apr 26 05:53:32 2008
@@ -9,6 +9,63 @@
 gDetailMapCacheBY =3D nil
 kDetailMapCacheSize =3D 256
 kDetailMapCacheViewRad =3D 80
+
+gPositionMarkers =3D {
+	-- [1] =3D {
+		--["Britain Moongate"]=3D{1336,1997,0,0,1,1},
+		--["Jhelom Moongate"]=3D{1500,3772,0,0,1,1},
+		--["Magincia Moongate"]=3D{3564,2140,0,0,1,1},
+	-- }
+}
+
+-- opens the given file and parses uo automap stuff
+function ParseUOAutomapFile	(file, markers)
+--[[
+-healer: 682 297 3 =

+-baker: 1514 611 3 =

++ruins: 1586 1004 3 abandoned building
++landmark: 478 1531 3 abandoned mage tower
+]]
+	if file_exists(file) then
+		for line in io.lines(file) do
+			-- for w in string.gfind(jline, "%S+") do
+			for sign,typename,xloc,yloc,map,name in string.gmatch(line, "([-+])([^:=
]+): (%d+) (%d+) (%d+)(.*)") do
+				-- print("MATCH",sign,typename,xloc,yloc,map,name)
+				map =3D map + 1
+				if not markers[map] then markers[map] =3D {} end
+				table.insert(markers[map], {xloc,yloc,1,0,0,1})
+			end
+		end
+	end
+end
+
+-- loads all files in a directory and tries to parse uo automap stuff
+function LoadUOAutomapFiles	(directory, markers)
+	-- lists all lua files in directory and parse them
+	local arr_files =3D dirlist(directory,false,true)
+
+	for k,filename in pairs(arr_files) do =

+		ParseUOAutomapFile(directory..filename, markers)
+	end
+end
+
+LoadUOAutomapFiles("../data/uoam/", gPositionMarkers)
+
+function SetPositionMarker(mapindex,name,xloc,yloc,r,g,b,a)
+	if not mapindex or not name or not xloc or not yloc then return end
+
+	r =3D r or 0
+	g =3D g or 1
+	b =3D b or 0
+	a =3D a or 1
+	=

+	if not gPositionMarkers[mapindex] then gPositionMarkers[mapindex] =3D {} =
end
+	gPositionMarkers[mapindex][name] =3D {xloc,yloc,r,g,b,a}
+end
+
+function DeletePositionMarker(mapindex, name)
+	if gPositionMarkers[mapindex] then gPositionMarkers[mapindex][name] =3D n=
il end
+end
 =

 -- param : compass-center-pos (player or cam)
 function UpdateDetailMapCacheIfNeeded (xloc,yloc)
@@ -55,6 +112,10 @@
 +       GenerateRadarImage(a,bx0,by0,bx1,by1,gGroundBlockLoader,gStaticBlo=
ckLoader,gRadarColorLoader)
 +       a:SaveAsFile("myimagetest3.png")
 ]]--
+
+-- NotifyListener("Hook_Object_CreateMobile",mobile)
+-- NotifyListener("Hook_Object_DestroyMobile",mobile)
+
 =

 -- called from lib.gui.lua : gui.StartGame()
 function InitCompassIfNeeded () =

@@ -100,15 +161,6 @@
 			local mygfx =3D gIrisCompassDialog.mapdot.gfx
 			mygfx:InitRROC()
 			mygfx:SetMaterial("mapdot")
-			mygfx:RenderableBegin(4,6,false,false,OT_TRIANGLE_LIST)
-			local halfwidth =3D 4
-			mygfx:RenderableVertex(((mx - halfwidth)/vw * 2.0 - 1.0),((my - halfwid=
th)/vh * (-2.0) + 1.0),z, 0,0)
-			mygfx:RenderableVertex(((mx + halfwidth)/vw * 2.0 - 1.0),((my - halfwid=
th)/vh * (-2.0) + 1.0),z, 1,0)
-			mygfx:RenderableVertex(((mx - halfwidth)/vw * 2.0 - 1.0),((my + halfwid=
th)/vh * (-2.0) + 1.0),z, 0,1)
-			mygfx:RenderableVertex(((mx + halfwidth)/vw * 2.0 - 1.0),((my + halfwid=
th)/vh * (-2.0) + 1.0),z, 1,1)
-			mygfx:RenderableIndex3(0,1,2)
-			mygfx:RenderableIndex3(1,3,2)
-			mygfx:RenderableEnd()
 		end
 		=

 		-- non-rotating compass part
@@ -170,6 +222,8 @@
 function SetCompassMapIndex	(iMapIndex) =

 	if (gDisableCompass) then return end
 	=

+	gCompassMapIndex =3D gMapIndex
+	=

 	local profile =3D MakeProfiler("compass")
 	profile:StartSection("init")
 	=

@@ -211,6 +265,8 @@
 	profile:StartSection("zoom")
 	gCompassMapW =3D gGroundBlockLoader and gGroundBlockLoader:GetMapW() or 1
 	gCompassMapH =3D gGroundBlockLoader and gGroundBlockLoader:GetMapH() or 1
+	=

+	gfCompassCurrentZoomFactor =3D 1
 	ZoomCompass(1.0)
 	=

 	-- mapchange, reload detail map
@@ -241,6 +297,9 @@
 	if (gDisableCompass) then return end
 	if (not gIrisCompassDialog) then return end
 	gCompassVisibleRad =3D gCompassVisibleRad * factor
+	=

+	gfCompassCurrentZoomFactor =3D math.min(1, gfCompassCurrentZoomFactor / f=
actor)
+	=

 	--AddFadeLines("visrad=3D"..gCompassVisibleRad)
 	gCompassVisibleRad =3D max(gCompassVisibleRad,giCompassDetailLimit)
 	local bRough =3D IsRoughCompassActive()
@@ -260,10 +319,43 @@
 	end
 end
 =

+-- returns the relative position in px (from the compass center) of a give=
n uo location in tiles
+function GetRelativeCompasUOPositionInPx	(xloc, yloc)
+	local angle, iCamOverBlockX, iCamOverBlockY, MirrorX =3D gCurrentRenderer=
:UpdateCompass()
+	local vw,vh =3D GetViewportSize() -- uses overlay manager
+	local z =3D GetMaxZ()
+	local mx =3D vw - gCompassSize/2 - gCompassOff
+	local my =3D 15 + gCompassSize/2 + gCompassOff
+	=

+	local cxloc =3D iCamOverBlockX*8
+	local cyloc =3D iCamOverBlockY*8
+	=

+	local px =3D xloc - cxloc
+	local py =3D yloc - cyloc
+	=

+	local f =3D gfCompassCurrentZoomFactor or 1
+	=

+	-- TODO rotate
+	px,py =3D rotate2(px,py,angle - 180 * gfDeg2Rad)
+	-- print("GetRelativeCompasUOPositionInPx",xloc,yloc,":",cxloc,cyloc,"->"=
,px,py)
+	=

+	px,py =3D px * f,py * f
+	=

+	-- limit dots to border of compass to see direction of far distance points
+	local len =3D len2(px,py)
+	local limit =3D giCompassVisiblePixelRadius
+	if len > limit then
+		px,py =3D tolen2(px,py,limit)
+	end
+				=

+	return px,py
+end
+
 -- called every frame
 function UpdateCompass ()
 	if (gDisableCompass) then return end
 	if (gIrisCompassDialog and gIrisCompassDialog.bDoUpdate) then	=

+		-- ax =3D camera angle, iCamOverBlockX*8 =3D tileposition, iCamOverBlock=
Y*8 =3D tileposition, MirrorX =3D strage mirror hack
 		local ax, iCamOverBlockX, iCamOverBlockY, MirrorX =3D gCurrentRenderer:U=
pdateCompass()
 		local vw,vh =3D GetViewportSize() -- uses overlay manager
 		local z =3D GetMaxZ()
@@ -301,6 +393,52 @@
 				mygfx:RenderableVertex((mx + x)/vw * 2.0 - 1.0,(my + y)/vh * (-2.0) + =
1.0,z, u,v)
 			end
 			mygfx:RenderableEnd()
+		end
+		=

+		if gbCompassShowMobiles then
+			-- update dots
+			local l =3D GetMobileList()
+			local count =3D countarr(l) + countarr(gPositionMarkers[gCompassMapInde=
x] or {})
+			=

+			local mygfx =3D gIrisCompassDialog.mapdot.gfx
+			mygfx:RenderableBegin(4 * count,6 * count,false,false,OT_TRIANGLE_LIST)
+
+			local halfwidth =3D 3
+			=

+			local index =3D 0
+			=

+			-- show mobiles
+			for k,mobile in pairs(l) do =

+				local px,py =3D GetRelativeCompasUOPositionInPx(mobile.xloc, mobile.yl=
oc)
+				local r,g,b =3D GetNotorietyColor(mobile.notoriety)
+				local a =3D 1
+								=

+				mygfx:RenderableVertex(((mx - halfwidth + px)/vw * 2.0 - 1.0),((my - h=
alfwidth + py)/vh * (-2.0) + 1.0),z, 0,0, r,g,b,a)
+				mygfx:RenderableVertex(((mx + halfwidth + px)/vw * 2.0 - 1.0),((my - h=
alfwidth + py)/vh * (-2.0) + 1.0),z, 1,0, r,g,b,a)
+				mygfx:RenderableVertex(((mx - halfwidth + px)/vw * 2.0 - 1.0),((my + h=
alfwidth + py)/vh * (-2.0) + 1.0),z, 0,1, r,g,b,a)
+				mygfx:RenderableVertex(((mx + halfwidth + px)/vw * 2.0 - 1.0),((my + h=
alfwidth + py)/vh * (-2.0) + 1.0),z, 1,1, r,g,b,a)
+				mygfx:RenderableIndex3(index+0,index+1,index+2)
+				mygfx:RenderableIndex3(index+1,index+3,index+2)
+				=

+				index =3D index + 4
+			end
+			-- show marked spots
+			for k,mark in pairs(gPositionMarkers[gCompassMapIndex] or {}) do =

+				local xloc,yloc,r,g,b,a =3D unpack(mark)
+				local px,py =3D GetRelativeCompasUOPositionInPx(xloc, yloc)
+				=

+				mygfx:RenderableVertex(((mx - halfwidth + px)/vw * 2.0 - 1.0),((my - h=
alfwidth + py)/vh * (-2.0) + 1.0),z, 0,0, r,g,b,a)
+				mygfx:RenderableVertex(((mx + halfwidth + px)/vw * 2.0 - 1.0),((my - h=
alfwidth + py)/vh * (-2.0) + 1.0),z, 1,0, r,g,b,a)
+				mygfx:RenderableVertex(((mx - halfwidth + px)/vw * 2.0 - 1.0),((my + h=
alfwidth + py)/vh * (-2.0) + 1.0),z, 0,1, r,g,b,a)
+				mygfx:RenderableVertex(((mx + halfwidth + px)/vw * 2.0 - 1.0),((my + h=
alfwidth + py)/vh * (-2.0) + 1.0),z, 1,1, r,g,b,a)
+				mygfx:RenderableIndex3(index+0,index+1,index+2)
+				mygfx:RenderableIndex3(index+1,index+3,index+2)
+				=

+				index =3D index + 4
+			end
+			=

+			mygfx:RenderableEnd()
+		=

 		end
 		=

 		-- old radar



From no-reply at zwischenwelt.org  Sun Apr 27 02:06:49 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 27 Apr 2008 00:06:49 -0000
Subject: [Iris-commit] [IRIS] r2098 - in /trunk: bin/fmodex.dll
 bin/iris2.exe linuxbin/iris vs9/ vs9/iris.sln vs9/iris.vcproj vs9/res/
 vs9/res/iris.ico vs9/res/resource.rc
Message-ID: <20080427000649.AF9DA1524030@zwischenwelt.org>

Author: sience
Date: Sun Apr 27 02:06:49 2008
New Revision: 2098

Log:
-obsolete linux binary deleted
-new win32 binary
-project files for visual studio express 2008 (VS9) added
-new fmodex.dll added (v. 41403)
-vs 2005 (vs8) project files updated for Microsoft Platform SDK for Windows=
 XP SP2

Added:
    trunk/vs9/
    trunk/vs9/iris.sln
    trunk/vs9/iris.vcproj
    trunk/vs9/res/
    trunk/vs9/res/iris.ico   (with props)
    trunk/vs9/res/resource.rc
Removed:
    trunk/linuxbin/iris
Modified:
    trunk/bin/fmodex.dll
    trunk/bin/iris2.exe

Modified: trunk/bin/fmodex.dll
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Sun Apr 27 14:22:31 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 27 Apr 2008 12:22:31 -0000
Subject: [Iris-commit] [IRIS] r2099 - /trunk/data/skippedfallbacks.lua
Message-ID: <20080427122231.41A831C18787@zwischenwelt.org>

Author: sience
Date: Sun Apr 27 14:22:30 2008
New Revision: 2099

Log:
-skipped ship fallbacks added

Modified:
    trunk/data/skippedfallbacks.lua

Modified: trunk/data/skippedfallbacks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/skippedfallbacks.lua (original)
+++ trunk/data/skippedfallbacks.lua Sun Apr 27 14:22:30 2008
@@ -426,3 +426,13 @@
 RegisterSkippedArtBillboardFallBack(4564) -- 0x11d4 name=3Dbed
 RegisterSkippedArtBillboardFallBack(4565) -- 0x11d5 name=3Dbed
 RegisterSkippedArtBillboardFallBack(4563) -- 0x11d3 name=3Dbed
+RegisterSkippedArtBillboardFallBack(16097) -- 0x3ee1 name=3Dsail
+RegisterSkippedArtBillboardFallBack(16053) -- 0x3eb5 name=3Dship
+RegisterSkippedArtBillboardFallBack(16052) -- 0x3eb4 name=3Dprow
+RegisterSkippedArtBillboardFallBack(16037) -- 0x3ea5 name=3Dship
+RegisterSkippedArtBillboardFallBack(16096) -- 0x3ee0 name=3Dsail
+RegisterSkippedArtBillboardFallBack(16038) -- 0x3ea6 name=3Dship
+RegisterSkippedArtBillboardFallBack(16042) -- 0x3eaa name=3Ddeck
+RegisterSkippedArtBillboardFallBack(16099) -- 0x3ee3 name=3Dsail
+RegisterSkippedArtBillboardFallBack(16068) -- 0x3ec4 name=3Dtiller
+RegisterSkippedArtBillboardFallBack(16049) -- 0x3eb1 name=3Dship



From no-reply at zwischenwelt.org  Sun Apr 27 16:13:07 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 27 Apr 2008 14:13:07 -0000
Subject: [Iris-commit] [IRIS] r2100 - /trunk/premake.lua
Message-ID: <20080427150002.EC67A1C187C6@zwischenwelt.org>

Author: hagish
Date: Sun Apr 27 16:13:07 2008
New Revision: 2100

Log:
its possible to statically link ois

Modified:
    trunk/premake.lua

Modified: trunk/premake.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/premake.lua (original)
+++ trunk/premake.lua Sun Apr 27 16:13:07 2008
@@ -6,15 +6,29 @@
 project.name =3D gName
 -- project.path =3D "build"
 -- project.bindir =3D "."
+
+-- default values
 gbExtraWarnings =3D false
-
+gbOptimize =3D true
+gOisPlatform =3D "linux"
+gbUseSystemOis =3D false
+
+-- build options
 addoption("wall","very verbose report, most warnings enabled")
+addoption("nooptimize","don't use optmize compile flags")
+addoption("usesystemois","use the systemwide installed ois not the one inc=
luded in lugre")
+addoption("oisplatform","select OIS platform (linux,mac,SDL,win32, default=
:linux), only valid if lugre ois is used")
+
 if (options["wall"]) then gbExtraWarnings =3D true print("extra warnings e=
nabled") end
+if (options["nooptimize"]) then gbOptimize =3D false print("optimization d=
isabled") end
+if (options["usesystemois"]) then gbUseSystemOis =3D true print("using sys=
temwide installed ois") end
+if (options["oisplatform"]) then gOisPlatform =3D options["oisplatform"] p=
rint("using oisplatform: "..gOisPlatform) end
 =

 gLugreDir =3D "lugre"
 if (io.open("mylugre/lua/lugre.lua")) then print("using mylugre dir overri=
de") gLugreDir =3D "mylugre" end
 =

 gLugreLuaSrcDir =3D "./"..gLugreDir.."/lib/lua-5.1.3/"
+gLugreOisDir =3D "./"..gLugreDir.."/baselib/ois/"
 =

 -- list of easy libs inclusion (located in lugre/lib/NAME). this will add =
lugre/lib/NAME/src and lugre/lib/NAME/include.
 gLugreLibList =3D {
@@ -27,16 +41,16 @@
 -- lugre dependencies, ie. ogre
 function AddLugreDeps(package)
 	package.defines =3D { =

-	"USE_OPENAL",
-	"MAIN_WORKING_DIR=3D\\\"..\\\"",
-	"LUA_DIR=3D\\\"lua\\\"",
-	"LUGRE_DIR=3D\\\""..gLugreDir.."\\\"",
-	"DATA_DIR=3D\\\"data\\\"",
-	"ENABLE_THREADS",
-}	=

+		"USE_OPENAL",
+		"MAIN_WORKING_DIR=3D\\\"..\\\"",
+		"LUA_DIR=3D\\\"lua\\\"",
+		"LUGRE_DIR=3D\\\""..gLugreDir.."\\\"",
+		"DATA_DIR=3D\\\"data\\\"",
+		"ENABLE_THREADS",
+	}	=

 =

 	addpkgconfiglib(package, "OGRE")
-	addpkgconfiglib(package, "OIS")
+	if gbUseSystemOis then addpkgconfiglib(package, "OIS") end
 	addpkgconfiglib(package, "openal")
 	addpkgconfiglib(package, "vorbisfile")
 =

@@ -95,7 +109,7 @@
 package.name =3D "lugrelua"
 package.kind =3D "lib"
 package.language =3D "c++"
-package.buildflags =3D { gbExtraWarnings and "extra-warnings" or nil, "opt=
imize" }
+package.buildflags =3D { gbExtraWarnings and "extra-warnings" or nil, gbOp=
timize and "optimize" or nil }
 package.buildoptions =3D {}
 package.includepaths =3D { gLugreLuaSrcDir.."/src" }
 package.defines =3D { =

@@ -106,6 +120,28 @@
 }
 =

 -- ---------------------------------------------
+-- OIS
+-- ---------------------------------------------
+if not gbUseSystemOis then
+	print("OIS platform: "..gOisPlatform)
+	gOisPlatform =3D "linux"
+	oisinclude =3D {gLugreOisDir.."/includes", gLugreOisDir.."/includes/"..gO=
isPlatform}
+	package =3D newpackage()
+	package.name =3D "lugreois"
+	package.kind =3D "lib"
+	package.language =3D "c++"
+	package.buildflags =3D { gbExtraWarnings and "extra-warnings" or nil, gbO=
ptimize and "optimize" or nil }
+	package.buildoptions =3D {}
+	package.includepaths =3D { unpack(oisinclude) }
+	package.defines =3D { =

+		--"LUA_USE_POPEN", -- execute shellcommands
+	}	=

+	package.files =3D {
+	  matchfiles(gLugreOisDir.."/src/*.h", gLugreOisDir.."/src/*.cpp"),
+	  matchfiles(gLugreOisDir.."/src/"..gOisPlatform.."/*.h", gLugreOisDir.."=
/src/"..gOisPlatform.."/*.cpp"),
+	}
+end
+-- ---------------------------------------------
 -- LUGRE LIBS
 -- ---------------------------------------------
 =

@@ -115,9 +151,9 @@
 	package.name =3D v.."lib"
 	package.kind =3D "lib"
 	package.language =3D "c++"
-	package.buildflags =3D { gbExtraWarnings and "extra-warnings" or nil, "op=
timize" }
+	package.buildflags =3D { gbExtraWarnings and "extra-warnings" or nil, gbO=
ptimize and "optimize" or nil }
 	package.buildoptions =3D {}
-	package.includepaths =3D { gLugreDir.."/include", gLugreLuaSrcDir.."/src/=
", "include" }
+	package.includepaths =3D { gLugreDir.."/include", gLugreLuaSrcDir.."/src/=
", "include", oisinclude and unpack(oisinclude) or nil }
 	package.files =3D {
 		matchfiles(gLugreLuaSrcDir.."/src/*.h", gLugreLuaSrcDir.."/src/*.c"),
 	}
@@ -136,8 +172,8 @@
 package.name =3D "lugrelib"
 package.kind =3D "lib"
 package.language =3D "c++"
-package.links =3D { "lugrelua" }
-package.buildflags =3D { bExtraWarnings and "extra-warnings" or nil, "opti=
mize" }
+package.links =3D {  }
+package.buildflags =3D { bExtraWarnings and "extra-warnings" or nil, gbOpt=
imize and "optimize" or nil }
 package.buildoptions =3D {}
 package.includepaths =3D { gLugreLuaSrcDir.."/src", gLugreDir.."/include" }
 package.files =3D {
@@ -154,7 +190,7 @@
 package.kind =3D "exe"
 package.language =3D "c++"
 package.bindir =3D "bin"
-package.buildflags =3D { gbExtraWarnings and "extra-warnings" or nil, "opt=
imize" }
+package.buildflags =3D { gbExtraWarnings and "extra-warnings" or nil, gbOp=
timize and "optimize" or nil }
 package.buildoptions =3D {}
 =

 package.includepaths =3D { gLugreDir.."/include", gLugreLuaSrcDir.."/src/"=
, "include" }
@@ -164,9 +200,7 @@
 end
 =

 package.linkoptions =3D {}
-package.links =3D { "lugrelua" }
-
-package.links =3D { "lugrelib" }
+package.links =3D { "lugrelib", "lugrelua", not gbUseSystemOis and "lugreo=
is" or nil  }
 AddLugreDeps(package)
 =

 package.files =3D {



From no-reply at zwischenwelt.org  Sun Apr 27 23:56:33 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Sun, 27 Apr 2008 21:56:33 -0000
Subject: [Iris-commit] [IRIS] r2101 - /trunk/linuxbin/
Message-ID: <20080427215633.E12F01C18787@zwischenwelt.org>

Author: sience
Date: Sun Apr 27 23:56:33 2008
New Revision: 2101

Log:
-obsolete

Removed:
    trunk/linuxbin/



From no-reply at zwischenwelt.org  Mon Apr 28 03:54:41 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 28 Apr 2008 01:54:41 -0000
Subject: [Iris-commit] [IRIS] r2102 - /trunk/premakelinux.sh
Message-ID: <20080428015442.0C3A71C1870E@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Apr 28 03:54:40 2008
New Revision: 2102

Log:
premakelinux.sh compiles in release mode by default now

Modified:
    trunk/premakelinux.sh

Modified: trunk/premakelinux.sh
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/premakelinux.sh (original)
+++ trunk/premakelinux.sh Mon Apr 28 03:54:40 2008
@@ -1,4 +1,4 @@
 #!/bin/bash
-./premake --target gnu && make
+./premake --target gnu && make CONFIG=3DRelease
 #~ ./premake --target gnu && make CONFIG=3DRelease
 # tipp : try "make -j 2" : start 2 jobs in parallel, to avoid wait-for-io =
and use multi-cpu processors efficiently during compile



From no-reply at zwischenwelt.org  Mon Apr 28 15:58:03 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 28 Apr 2008 13:58:03 -0000
Subject: [Iris-commit] [IRIS] r2103 - in /trunk: bin/iris2.exe
	vs8/iris.vcproj
Message-ID: <20080428135803.F167F1C186F8@zwischenwelt.org>

Author: sience
Date: Mon Apr 28 15:58:02 2008
New Revision: 2103

Log:
-new win32 binary
-vs8 projekt files updated for new windows sdk (former psdk)

Modified:
    trunk/bin/iris2.exe
    trunk/vs8/iris.vcproj

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/vs8/iris.vcproj
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/vs8/iris.vcproj (original)
+++ trunk/vs8/iris.vcproj Mon Apr 28 15:58:02 2008
@@ -126,7 +126,7 @@
 				OmitFramePointers=3D"true"
 				EnableFiberSafeOptimizations=3D"false"
 				WholeProgramOptimization=3D"true"
-				AdditionalIncludeDirectories=3D"&quot;$(INCLUDE)&quot;;&quot;c:\Progra=
mme\Microsoft Platform SDK\Include\&quot;;&quot;$(OGRE_HOME)\include\&quot;=
;&quot;$(OGRE_HOME)\include\OIS\&quot;;..\include\;..\include\zlib;..\lugre=
\include;..\include\fmodx;&quot;..\lugre\lib\lua-5.1.3\src\&quot;;..\lugre\=
lib\md5\include;..\lugre\lib\cadune_tree\include;..\lugre\lib\paged_geometr=
y\include;..\lugre\lib\caelum\include;c:\Programme\boost\boost_1_34_1\"
+				AdditionalIncludeDirectories=3D"&quot;C:\Programme\Microsoft SDKs\Wind=
ows\v6.1\Include\&quot;;&quot;$(OGRE_HOME)\include\&quot;;&quot;$(OGRE_HOME=
)\include\OIS\&quot;;..\include\;..\include\zlib;..\lugre\include;..\includ=
e\fmodx;&quot;..\lugre\lib\lua-5.1.3\src\&quot;;..\lugre\lib\md5\include;..=
\lugre\lib\cadune_tree\include;..\lugre\lib\paged_geometry\include;..\lugre=
\lib\caelum\include;c:\Programme\boost\boost_1_34_1\"
 				PreprocessorDefinitions=3D"WIN32;NDEBUG;_WINDOWS;MAIN_WORKING_DIR=3D\&=
quot;../\&quot;;USE_FMOD;USE_LUGRE_LIB_MD5;USE_LUGRE_LIB_CADUNE_TREE;USE_LU=
GRE_LIB_CAELUM"
 				GeneratePreprocessedFile=3D"0"
 				StringPooling=3D"true"
@@ -153,7 +153,7 @@
 				Name=3D"VCLinkerTool"
 				AdditionalDependencies=3D"AdvAPI32.Lib User32.Lib ws2_32.lib zlib.lib =
OgreMain.lib OIS.lib lua5.1.lib fmodex_vc.lib"
 				OutputFile=3D"$(OutDir)\..\..\bin\iris2.exe"
-				AdditionalLibraryDirectories=3D"&quot;$(LIB)&quot;;&quot;$(OGRE_HOME)\=
lib\&quot;;..\libs\fmodx;..\libs\zlib;&quot;..\lugre\lib\lua-5.1.3\lib\stat=
ic&quot;;&quot;c:\Programme\Microsoft Platform SDK\Lib&quot;;..\lugre\lib\c=
aelum\lib\static;..\lugre\lib\paged_geometry\lib\static;c:\Programme\boost\=
boost_1_34_1\lib"
+				AdditionalLibraryDirectories=3D"&quot;C:\Programme\Microsoft SDKs\Wind=
ows\v6.1\Lib\&quot;;&quot;$(OGRE_HOME)\lib\&quot;;..\libs\fmodx;..\libs\zli=
b;&quot;..\lugre\lib\lua-5.1.3\lib\static&quot;;..\lugre\lib\caelum\lib\sta=
tic;..\lugre\lib\paged_geometry\lib\static;c:\Programme\boost\boost_1_34_1\=
lib"
 				GenerateManifest=3D"true"
 				IgnoreAllDefaultLibraries=3D"false"
 				IgnoreDefaultLibraryNames=3D"LIBCMT.lib"



From no-reply at zwischenwelt.org  Mon Apr 28 22:39:33 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Mon, 28 Apr 2008 20:39:33 -0000
Subject: [Iris-commit] [IRIS] r2104 -
	/tags/knut_merge_complete_ghoulsblade_31_08_2007/
Message-ID: <20080428210007.1FDF51524040@zwischenwelt.org>

Author: ghoulsblade
Date: Mon Apr 28 22:39:31 2008
New Revision: 2104

Log:
not needed anymore


Removed:
    tags/knut_merge_complete_ghoulsblade_31_08_2007/



From no-reply at zwischenwelt.org  Tue Apr 29 18:19:02 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Tue, 29 Apr 2008 16:19:02 -0000
Subject: [Iris-commit] [IRIS] r2105 - /trunk/lua/main.lua
Message-ID: <20080429161903.196A01C18538@zwischenwelt.org>

Author: ghoulsblade
Date: Tue Apr 29 18:19:01 2008
New Revision: 2105

Log:
added map-exporter option

Modified:
    trunk/lua/main.lua

Modified: trunk/lua/main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/main.lua (original)
+++ trunk/lua/main.lua Tue Apr 29 18:19:01 2008
@@ -458,6 +458,21 @@
 =

 -- exports data if some commandline parameters are set
 function InvokeExporters ()
+	if (gCommandLineArguments[1] =3D=3D "-em") then -- export map xloc,yloc,m=
apblocksw,mapblocksh
+		local img =3D CreateImage()
+		local bx		=3D math.floor(tonumber(gCommandLineArguments[2])/8)
+		local by		=3D math.floor(tonumber(gCommandLineArguments[3])/8)
+		local dbx		=3D math.floor(tonumber(gCommandLineArguments[4] or 10))
+		local dby		=3D math.floor(tonumber(gCommandLineArguments[5] or 10))
+		local facet		=3D math.floor(tonumber(gCommandLineArguments[6] or 1))  --=
 1 =3D tram
+		MapChangeRequest(facet)
+		local bx0,by0 =3D math.floor(bx-dbx/2),math.floor(by-dby/2)
+		GenerateRadarImage(img,bx0,by0,dbx,dby,gGroundBlockLoader,gStaticBlockLo=
ader,gRadarColorLoader)
+		img:SaveAsFile("../mapexport.png")
+		img:Destroy()
+		os.exit(0)
+	end
+	=

 	if (gCommandLineArguments[1] =3D=3D "-eg") then -- export gumps
 		local iGumpIDMin =3D gCommandLineArguments[gCommandLineSwitches["-eg"]+1]
 		local iGumpIDMax =3D gCommandLineArguments[gCommandLineSwitches["-eg"]+2]



From no-reply at zwischenwelt.org  Wed Apr 30 12:09:59 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 30 Apr 2008 10:09:59 -0000
Subject: [Iris-commit] [IRIS] r2106 - in /rawdata/sd_pd: houseparts.blend
	tex_sculpture.png
Message-ID: <20080430100959.B17561524030@zwischenwelt.org>

Author: hagish
Date: Wed Apr 30 12:09:59 2008
New Revision: 2106

Log:
raw data update

Added:
    rawdata/sd_pd/tex_sculpture.png   (with props)
Modified:
    rawdata/sd_pd/houseparts.blend

Modified: rawdata/sd_pd/houseparts.blend
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.



From no-reply at zwischenwelt.org  Wed Apr 30 18:22:11 2008
From: no-reply at zwischenwelt.org (no-reply at zwischenwelt.org)
Date: Wed, 30 Apr 2008 16:22:11 -0000
Subject: [Iris-commit] [IRIS] r2107 - in /trunk: data/skippedfallbacks.lua
 lua/net.trade.lua lua/net/net.main.lua lua/net/net.trade.lua
Message-ID: <20080430162211.46F121C18533@zwischenwelt.org>

Author: sience
Date: Wed Apr 30 18:22:10 2008
New Revision: 2107

Log:
-skippedfallbacks added
-net.trade.lua moved to /net/net.trade.lua

Added:
    trunk/lua/net/net.trade.lua
Removed:
    trunk/lua/net.trade.lua
Modified:
    trunk/data/skippedfallbacks.lua
    trunk/lua/net/net.main.lua

Modified: trunk/data/skippedfallbacks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/skippedfallbacks.lua (original)
+++ trunk/data/skippedfallbacks.lua Wed Apr 30 18:22:10 2008
@@ -436,3 +436,47 @@
 RegisterSkippedArtBillboardFallBack(16099) -- 0x3ee3 name=3Dsail
 RegisterSkippedArtBillboardFallBack(16068) -- 0x3ec4 name=3Dtiller
 RegisterSkippedArtBillboardFallBack(16049) -- 0x3eb1 name=3Dship
+RegisterSkippedArtBillboardFallBack(15950) -- 0x3e4e name=3Dtiller man
+RegisterSkippedArtBillboardFallBack(16024) -- 0x3e98 name=3Ddeck
+RegisterSkippedArtBillboardFallBack(16092) -- 0x3edc name=3Dsail
+RegisterSkippedArtBillboardFallBack(16094) -- 0x3ede name=3Dsail
+RegisterSkippedArtBillboardFallBack(16095) -- 0x3edf name=3Dsail
+RegisterSkippedArtBillboardFallBack(15975) -- 0x3e67 name=3Dship
+RegisterSkippedArtBillboardFallBack(15964) -- 0x3e5c name=3Dsail
+RegisterSkippedArtBillboardFallBack(15996) -- 0x3e7c name=3Dship
+RegisterSkippedArtBillboardFallBack(15998) -- 0x3e7e name=3Dship
+RegisterSkippedArtBillboardFallBack(15963) -- 0x3e5b name=3Dsail
+RegisterSkippedArtBillboardFallBack(16010) -- 0x3e8a name=3Dship
+RegisterSkippedArtBillboardFallBack(15997) -- 0x3e7d name=3Dship
+RegisterSkippedArtBillboardFallBack(15999) -- 0x3e7f name=3Dship
+RegisterSkippedArtBillboardFallBack(16011) -- 0x3e8b name=3Ddeck
+RegisterSkippedArtBillboardFallBack(16008) -- 0x3e88 name=3Ddeck
+RegisterSkippedArtBillboardFallBack(15994) -- 0x3e7a name=3Ddeck
+RegisterSkippedArtBillboardFallBack(15977) -- 0x3e69 name=3Dprow
+RegisterSkippedArtBillboardFallBack(15993) -- 0x3e79 name=3Dship
+RegisterSkippedArtBillboardFallBack(16018) -- 0x3e92 name=3Dhold
+RegisterSkippedArtBillboardFallBack(16015) -- 0x3e8f name=3Ddeck
+RegisterSkippedArtBillboardFallBack(16016) -- 0x3e90 name=3Dship
+RegisterSkippedArtBillboardFallBack(16020) -- 0x3e94 name=3Dship
+RegisterSkippedArtBillboardFallBack(15971) -- 0x3e63 name=3Dtiller
+RegisterSkippedArtBillboardFallBack(15957) -- 0x3e55 name=3Dtiller man
+RegisterSkippedArtBillboardFallBack(15961) -- 0x3e59 name=3Dsail
+RegisterSkippedArtBillboardFallBack(16014) -- 0x3e8e name=3Dship
+RegisterSkippedArtBillboardFallBack(16013) -- 0x3e8d name=3Dship
+RegisterSkippedArtBillboardFallBack(16012) -- 0x3e8c name=3Dship
+RegisterSkippedArtBillboardFallBack(16017) -- 0x3e91 name=3Dship
+RegisterSkippedArtBillboardFallBack(15990) -- 0x3e76 name=3Drudder
+RegisterSkippedArtBillboardFallBack(15995) -- 0x3e7b name=3Dship
+RegisterSkippedArtBillboardFallBack(15952) -- 0x3e50 name=3Dtiller man
+RegisterSkippedArtBillboardFallBack(15991) -- 0x3e77 name=3Dtiller
+RegisterSkippedArtBillboardFallBack(15978) -- 0x3e6a name=3Dsail
+RegisterSkippedArtBillboardFallBack(15979) -- 0x3e6b name=3Dsail
+RegisterSkippedArtBillboardFallBack(15981) -- 0x3e6d name=3Dsail
+RegisterSkippedArtBillboardFallBack(16021) -- 0x3e95 name=3Dprow
+RegisterSkippedArtBillboardFallBack(16055) -- 0x3eb7 name=3Dhold
+RegisterSkippedArtBillboardFallBack(15947) -- 0x3e4b name=3Dtiller man
+RegisterSkippedArtBillboardFallBack(16047) -- 0x3eaf name=3Dhold
+RegisterSkippedArtBillboardFallBack(16019) -- 0x3e93 name=3Dhatch
+RegisterSkippedArtBillboardFallBack(15955) -- 0x3e53 name=3Dtiller man
+RegisterSkippedArtBillboardFallBack(15973) -- 0x3e65 name=3Dhatch
+RegisterSkippedArtBillboardFallBack(16057) -- 0x3eb9 name=3Dhatch

Modified: trunk/lua/net/net.main.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.main.lua (original)
+++ trunk/lua/net/net.main.lua Wed Apr 30 18:22:10 2008
@@ -14,12 +14,12 @@
 dofile(libpath .. "net/net.cursor.lua")
 dofile(libpath .. "net/net.other.lua")
 dofile(libpath .. "net/net.securetrade.lua")
+dofile(libpath .. "net/net.trade.lua")
 =

 -- only things that have at least 2 packets get its own file, everything e=
lse is handled here:
 dofile(libpath .. "net/net.packethandlers.lua")
 =

 dofile(libpath .. "net.popup.lua")
-dofile(libpath .. "net.trade.lua")
 dofile(libpath .. "net.walk.lua")
 =

 gLastDoubleClickSerial =3D 0



