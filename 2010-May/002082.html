<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r3322 - in /trunk: config/shards/vetus-mundus.xml lua/gui/gui.chat.lua lua/gui/gui.skill.lua lua/lib.shardlist.lua lua/lib.spellbooks.lua lua/lib.spellinfo.lua lua/lib.uoids.lua lua/net/net.other.lua lua/net/net.skill.lua
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2010-May/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r3322%20-%20in%20/trunk%3A%0A%20config/shards/vetus-mundus.xml%20lua/gui/gui.chat.lua%20lua/gui/gui.skill.lua%0A%20lua/lib.shardlist.lua%20lua/lib.spellbooks.lua%20lua/lib.spellinfo.lua%0A%20lua/lib.uoids.lua%20lua/net/net.other.lua%20lua/net/net.skill.lua&In-Reply-To=%3C20100502130044.EAFD17A98179%40simon%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="002083.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r3322 - in /trunk: config/shards/vetus-mundus.xml lua/gui/gui.chat.lua lua/gui/gui.skill.lua lua/lib.shardlist.lua lua/lib.spellbooks.lua lua/lib.spellinfo.lua lua/lib.uoids.lua lua/net/net.other.lua lua/net/net.skill.lua</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r3322%20-%20in%20/trunk%3A%0A%20config/shards/vetus-mundus.xml%20lua/gui/gui.chat.lua%20lua/gui/gui.skill.lua%0A%20lua/lib.shardlist.lua%20lua/lib.spellbooks.lua%20lua/lib.spellinfo.lua%0A%20lua/lib.uoids.lua%20lua/net/net.other.lua%20lua/net/net.skill.lua&In-Reply-To=%3C20100502130044.EAFD17A98179%40simon%3E"
       TITLE="[Iris-commit] [IRIS] r3322 - in /trunk: config/shards/vetus-mundus.xml lua/gui/gui.chat.lua lua/gui/gui.skill.lua lua/lib.shardlist.lua lua/lib.spellbooks.lua lua/lib.spellinfo.lua lua/lib.uoids.lua lua/net/net.other.lua lua/net/net.skill.lua">no-reply at zwischenwelt.org
       </A><BR>
    <I>Sun May  2 15:00:44 CEST 2010</I>
    <P><UL>
        
        <LI>Next message: <A HREF="002083.html">[Iris-commit] [IRIS] r3323 - in /trunk/lua: net/net.other.lua	obj/obj.mobile.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2082">[ date ]</a>
              <a href="thread.html#2082">[ thread ]</a>
              <a href="subject.html#2082">[ subject ]</a>
              <a href="author.html#2082">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: ghoulsblade
Date: Sun May  2 15:00:44 2010
New Revision: 3322

Log:
fixed poison display bug in uo v7+, added mysticism and imbuing skillids, s=
hardconfig:vetus-mundus: reported version set to 7.0.6.5

Modified:
    trunk/config/shards/vetus-mundus.xml
    trunk/lua/gui/gui.chat.lua
    trunk/lua/gui/gui.skill.lua
    trunk/lua/lib.shardlist.lua
    trunk/lua/lib.spellbooks.lua
    trunk/lua/lib.spellinfo.lua
    trunk/lua/lib.uoids.lua
    trunk/lua/net/net.other.lua
    trunk/lua/net/net.skill.lua

Modified: trunk/config/shards/vetus-mundus.xml
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/config/shards/vetus-mundus.xml (original)
+++ trunk/config/shards/vetus-mundus.xml Sun May  2 15:00:44 2010
@@ -1,6 +1,6 @@
 &lt;table&gt;
     &lt;string key=3D&quot;gLoginname&quot;&gt;&lt;/string&gt;
-    &lt;string key=3D&quot;gClientVersion&quot;&gt;7.0.0.0&lt;/string&gt;
+    &lt;string key=3D&quot;gClientVersion&quot;&gt;7.0.6.5&lt;/string&gt;
     &lt;boolean key=3D&quot;gPolServer&quot;&gt;false&lt;/boolean&gt;
     &lt;number key=3D&quot;gServerSeed&quot;&gt;4294967295&lt;/number&gt;
     &lt;number key=3D&quot;gLoginServerPort&quot;&gt;2594&lt;/number&gt;

Modified: trunk/lua/gui/gui.chat.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.chat.lua (original)
+++ trunk/lua/gui/gui.chat.lua Sun May  2 15:00:44 2010
@@ -125,6 +125,7 @@
 		--~ GuiChatDistributeLineToChannels(line)
 	--~ end
 	=

+	if (src =3D=3D &quot;skillupdate&quot;) then print(line) end
 	-- TODO : temporary fix, replace this with a split by newline and add ind=
ividual lines
 	AddSingleFadeLine(string.gsub(line, &quot;\n&quot;, &quot;&quot;),color)
 end

Modified: trunk/lua/gui/gui.skill.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/gui/gui.skill.lua (original)
+++ trunk/lua/gui/gui.skill.lua Sun May  2 15:00:44 2010
@@ -115,7 +115,7 @@
 	-- print(&quot;SKILL DEBUG&quot;,value,last_value,base_value,last_base_value)
 	if value and last_value and (last_value ~=3D value) then
 		-- display change
-		GuiAddChatLine(&quot;Skill &quot;..name..&quot; is now &quot;..sprintf(&quot;%3.1f&quot;,value / 10)..=
&quot; -&gt; &quot;..sprintf(&quot;%3.1f&quot;,(value-last_value) / 10),gStatsInfoFadeLineColor)
+		GuiAddChatLine(&quot;Skill &quot;..name..&quot; is now &quot;..sprintf(&quot;%3.1f&quot;,value / 10)..=
&quot; -&gt; &quot;..sprintf(&quot;%3.1f&quot;,(value-last_value) / 10),gStatsInfoFadeLineColor,&quot;s=
killupdate&quot;)
 	end
 	=

 	-- update entry

Modified: trunk/lua/lib.shardlist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.shardlist.lua (original)
+++ trunk/lua/lib.shardlist.lua Sun May  2 15:00:44 2010
@@ -69,7 +69,7 @@
 		for k,skill in pairs(chardata.skills) do skill.id =3D k end
 		local skills2 =3D SortedArrayFromAssocTable(chardata.skills,function (a,=
b) return a.value &gt; b.value end)
 		for k,skill in ipairs(skills2) do  -- skill.value &gt;=3D 50 -&gt; 5.0 skillpo=
ints
-			if (skill.value &gt;=3D 50) then table.insert(arr,glSkillNamesShort[skill.=
id]..&quot;:&quot;..(valname[skill.value] or sprintf(&quot;%0.1f&quot;,skill.value/10))) end
+			if (skill.value &gt;=3D 50) then table.insert(arr,(glSkillNamesShort[skill=
.id] or (&quot;s&quot;..skill.id))..&quot;:&quot;..(valname[skill.value] or sprintf(&quot;%0.1f&quot;,ski=
ll.value/10))) end
 			if (k &gt;=3D 7) then break end
 		end
 		charinfo =3D charinfo .. table.concat(arr,&quot;,&quot;)

Modified: trunk/lua/lib.spellbooks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.spellbooks.lua (original)
+++ trunk/lua/lib.spellbooks.lua Sun May  2 15:00:44 2010
@@ -315,6 +315,11 @@
 =

 =

 gSpellIDByName =3D {}
+
+-- mysticism
+gSpellIDByName[&quot;Healing Stone&quot;	] =3D 0x02A7 =

+gSpellIDByName[&quot;Enchant&quot;		] =3D 0x02A9 =

+
 gSpellNameByID =3D {}
 gSpellCircleByID =3D {}
 gSpellBookIDBySpellID =3D {}

Modified: trunk/lua/lib.spellinfo.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.spellinfo.lua (original)
+++ trunk/lua/lib.spellinfo.lua Sun May  2 15:00:44 2010
@@ -164,3 +164,15 @@
 RegisterSpell_Spellweaving( &quot;Gift of Life&quot;, &quot;Illorae&quot;, -1)
 RegisterSpell_Spellweaving( &quot;Arcane Empowerment&quot;, &quot;Aslavdra&quot;, -1) -- vm, n=
ot in runuo?
 =

+--[[
+TODO:mysticism: (see <A HREF="http://www.uoguide.com/Mysticism">http://www.uoguide.com/Mysticism</A>)
+nether bolt : in corp ylem  4 mana, 0skill, black perl, sulf ash
+healing stone: kal in mani  4 mana, 0skill, bone,garlic,ginseng,spidersilk
+purge magic: an ort sanct	6 mana, 8skill, fertiledirt,garlic,mandrake,sulf=
urash
+enchant: in ort ylem		6 mana, 8skill, spidersilk,mandrake,sulfurash
+sleep: in zu				9 mana,20skill,	nightshade,spidersilk,blackperl
+eagle strike:kal por xen	9 mana,20skill, bloodmoss,bone,spidersilk,mandrake
+...
+
+]]--
+

Modified: trunk/lua/lib.uoids.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.uoids.lua (original)
+++ trunk/lua/lib.uoids.lua Sun May  2 15:00:44 2010
@@ -420,7 +420,10 @@
 	[52]	=3D &quot;Chivalry&quot;,
 	[53]	=3D &quot;Bushido&quot;,
 	[54]	=3D &quot;Ninjitsu&quot;,
-	[55]	=3D &quot;Spellweaving&quot;	-- ? correct?
+	[55]	=3D &quot;Spellweaving&quot;,	-- ? correct?
+	=

+	[56]	=3D &quot;Mysticism&quot;,
+	[57]	=3D &quot;Imbuing&quot;,
 }
 =

 =


Modified: trunk/lua/net/net.other.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.other.lua (original)
+++ trunk/lua/net/net.other.lua Sun May  2 15:00:44 2010
@@ -60,7 +60,7 @@
 		local healthbarcol	=3D input:PopNetUint16() --  (1=3Dgreen, 2=3Dyellow, =
&gt;<i>2=3Dred?)
</I> 		local action		=3D input:PopNetUint8() --  BYTE[1] Flag (0=3DRemove healt=
h bar color, 1=3DEnable health bar color)
 		print(&quot;healthbarcol =3D &quot;,serial,unknown1,healthbarcol,action)
-		local bEnable		=3D action =3D=3D 1
+		local bEnable		=3D action ~=3D 0  -- poisonlevel ?  lesser:1 greater:3
 		local mask
 		if (healthbarcol =3D=3D 1) then mask =3D kMobileFlag_Poisoned end
 		if (healthbarcol =3D=3D 2) then mask =3D kMobileFlag_GoldenHealth end
@@ -81,8 +81,9 @@
 	end
 	=

 end
---~ 00 0d ba 5b 00 01 00 01 01                        |...[.....|
+--~ 00 0d ba 5b 00 01 00 01 01                        |...[.....| -- lesse=
r?
 --~ 00 0d ba 5b 00 01 00 01 00                        |...[.....|
+--~ 00 0d ba 5b 00 01 00 01 03                        |...[.....| -- great=
er poison
 =

 function gPacketHandler.kPacket_Change_Update_Range ()	-- 0xC8
 	local input =3D GetRecvFIFO()

Modified: trunk/lua/net/net.skill.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/net/net.skill.lua (original)
+++ trunk/lua/net/net.skill.lua Sun May  2 15:00:44 2010
@@ -50,7 +50,7 @@
 			local skill_value =3D input:PopNetUint16()		--skill_value*10
 			local skill_base_value =3D input:PopNetUint16()	--unmodified value *10
 			local skill_lock_state =3D input:PopNetUint8()	--(0=3Dup, 1=3Ddown, 2=
=3Dlocked)
-			local skill_name =3D glSkillNames[skill_id] or &quot;unknown&quot;
+			local skill_name =3D glSkillNames[skill_id] or (&quot;unknown_&quot;..skill_id)
 			local skill_cap
 			if (bHasCap) then skill_cap =3D input:PopNetUint16() end
 			printdebug(&quot;skill&quot;,sprintf(&quot;NET (todo): skill: %s [id=3D%i] skill_value=
:<i> %i skill_base_value: %i locked?: %i\n&quot;,skill_name,skill_id,skill_value,sk=
</I>ill_base_value,skill_lock_state))
@@ -66,7 +66,7 @@
 		local skill_value =3D input:PopNetUint16()		--skill_value*10
 		local skill_base_value =3D input:PopNetUint16()	--unmodified value *10
 		local skill_lock_state =3D input:PopNetUint8()	--(0=3Dup, 1=3Ddown, 2=3D=
locked)
-		local skill_name =3D glSkillNames[skill_id] or &quot;unknown&quot;
+		local skill_name =3D glSkillNames[skill_id] or (&quot;unknown_&quot;..skill_id)
 		local skill_cap
 		if (bHasCap) then skill_cap =3D input:PopNetUint16() end
 		printdebug(&quot;skill&quot;,sprintf(&quot;NET (todo): skill: %s [id=3D%i] skill_value:=
 %i skill_base_value: %i locked?: %i\n&quot;,skill_name,skill_id,skill_value,ski=
ll_base_value,skill_lock_state))


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="002083.html">[Iris-commit] [IRIS] r3323 - in /trunk/lua: net/net.other.lua	obj/obj.mobile.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2082">[ date ]</a>
              <a href="thread.html#2082">[ thread ]</a>
              <a href="subject.html#2082">[ subject ]</a>
              <a href="author.html#2082">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
