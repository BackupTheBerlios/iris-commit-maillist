<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r2213 - in /trunk: data/base/ui/sd_pd_enemy.png data/base/ui/sd_pd_enemylist_icon_bg.png data/base/ui/sd_pd_good.png data/base/ui/sd_pd_murderer.png data/base/ui/sd_pd_neutral.png data/base/ui/sd_pd_unknown.png plugins/hudenemylist.lua
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2008-May/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r2213%20-%20in%20/trunk%3A%0A%20data/base/ui/sd_pd_enemy.png%20data/base/ui/sd_pd_enemylist_icon_bg.png%0A%20data/base/ui/sd_pd_good.png%20data/base/ui/sd_pd_murderer.png%0A%20data/base/ui/sd_pd_neutral.png%20data/base/ui/sd_pd_unknown.png%0A%20plugins/hudenemylist.lua&In-Reply-To=%3C20080531014827.EF8571C180F1%40zwischenwelt.org%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001021.html">
   <LINK REL="Next"  HREF="001023.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r2213 - in /trunk: data/base/ui/sd_pd_enemy.png data/base/ui/sd_pd_enemylist_icon_bg.png data/base/ui/sd_pd_good.png data/base/ui/sd_pd_murderer.png data/base/ui/sd_pd_neutral.png data/base/ui/sd_pd_unknown.png plugins/hudenemylist.lua</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r2213%20-%20in%20/trunk%3A%0A%20data/base/ui/sd_pd_enemy.png%20data/base/ui/sd_pd_enemylist_icon_bg.png%0A%20data/base/ui/sd_pd_good.png%20data/base/ui/sd_pd_murderer.png%0A%20data/base/ui/sd_pd_neutral.png%20data/base/ui/sd_pd_unknown.png%0A%20plugins/hudenemylist.lua&In-Reply-To=%3C20080531014827.EF8571C180F1%40zwischenwelt.org%3E"
       TITLE="[Iris-commit] [IRIS] r2213 - in /trunk: data/base/ui/sd_pd_enemy.png data/base/ui/sd_pd_enemylist_icon_bg.png data/base/ui/sd_pd_good.png data/base/ui/sd_pd_murderer.png data/base/ui/sd_pd_neutral.png data/base/ui/sd_pd_unknown.png plugins/hudenemylist.lua">no-reply at zwischenwelt.org
       </A><BR>
    <I>Sat May 31 03:48:27 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001021.html">[Iris-commit] [IRIS] r2212 - in /trunk/lua: lib.2d.cam.lua lib.2d.map.lua lib.2d.mobile.lua lib.2d.renderer.lua lib.uoanim.lua lib.uoutils.lua
</A></li>
        <LI>Next message: <A HREF="001023.html">[Iris-commit] [IRIS] r2214 - in /trunk/lua: lib.2d.renderer.lua	lib.artatlas.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1022">[ date ]</a>
              <a href="thread.html#1022">[ thread ]</a>
              <a href="subject.html#1022">[ subject ]</a>
              <a href="author.html#1022">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: hagish
Date: Sat May 31 03:48:27 2008
New Revision: 2213

Log:
improved enemylist

Modified:
    trunk/data/base/ui/sd_pd_enemy.png
    trunk/data/base/ui/sd_pd_enemylist_icon_bg.png
    trunk/data/base/ui/sd_pd_good.png
    trunk/data/base/ui/sd_pd_murderer.png
    trunk/data/base/ui/sd_pd_neutral.png
    trunk/data/base/ui/sd_pd_unknown.png
    trunk/plugins/hudenemylist.lua

Modified: trunk/data/base/ui/sd_pd_enemy.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/base/ui/sd_pd_enemylist_icon_bg.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/base/ui/sd_pd_good.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/base/ui/sd_pd_murderer.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/base/ui/sd_pd_neutral.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/base/ui/sd_pd_unknown.png
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/plugins/hudenemylist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/plugins/hudenemylist.lua (original)
+++ trunk/plugins/hudenemylist.lua Sat May 31 03:48:27 2008
@@ -8,7 +8,7 @@
 kPlugin_HudEnemylist_X =3D -170	-- from the right border
 kPlugin_HudEnemylist_Y =3D 230
 -- delta position from icon to first min bar
-kPlugin_HudEnemylist_IconToBar_X =3D 54
+kPlugin_HudEnemylist_IconToBar_X =3D 36
 kPlugin_HudEnemylist_IconToBar_Y =3D 0
 -- delta bar to bar position
 kPlugin_HudEnemylist_Bar_DX =3D 26
@@ -16,11 +16,11 @@
 -- number of bars in x dimension
 kPlugin_HudEnemylist_Bar_CountX =3D 4
 -- border from one block to another
-kPlugin_HudEnemylist_BlockBorder =3D 10
+kPlugin_HudEnemylist_BlockBorder =3D 4
 =

 -- icon size
-kPlugin_HudEnemylist_Icon_W =3D 48
-kPlugin_HudEnemylist_Icon_H =3D 48
+kPlugin_HudEnemylist_Icon_W =3D 32
+kPlugin_HudEnemylist_Icon_H =3D 32
 =

 -- is initialized?
 gPlugin_HudEnemylist_Initialized =3D false
@@ -168,7 +168,7 @@
 =

 =

 -- creates a block + widget with icon and body bars at position x,y
-function Plugin_HudEnemylist_MakeBlock (typename, index, icon_image, body_=
list)
+function Plugin_HudEnemylist_MakeBlock (typename, index, icon_info, body_l=
ist)
 	local parent =3D gPlugin_HudEnemylist_Dialog
 	=

 	local x,y =3D 0,0
@@ -177,21 +177,45 @@
 	=

 	block.index =3D index
 	=

-	block.icon_image =3D icon_image
+	block.icon_info =3D icon_info
 	block.body_list =3D {}
 	block.bar_list =3D {}
 	=

 	block.typename =3D typename
 		=

-	local mat_icon =3D GetPlainTextureMat(icon_image,true)
+	local mat_icon,u1,v1,u2,v2 =3D unpack(icon_info)
+	if mat_icon =3D=3D nil then
+		-- unknown?
+		mat_icon =3D GetPlainTextureMat(&quot;sd_pd_unknown.png&quot;,true)
+		u1 =3D 0
+		v1 =3D 0
+		u2 =3D 1
+		v2 =3D 1
+	end
 	=

 	-- bg image
-	block.widget_icon_bg =3D guimaker.MakePlane(parent, GetPlainTextureMat(&quot;s=
d_pd_enemylist_icon_bg.png&quot;,true), x, y, 64, 64)
+	block.widget_icon_bg =3D guimaker.MakePlane(parent, GetPlainTextureMat(&quot;s=
d_pd_enemylist_icon_bg.png&quot;,true), x, y, 32, 32)
 	block.widget_icon_bg.mbClipChildsHitTest =3D false
 	block.widget_icon_bg.mbIgnoreMouseOver =3D true
 	=

 	-- icon image
-	block.widget_icon =3D guimaker.MakePlane(block.widget_icon_bg, mat_icon, =
2, 2, kPlugin_HudEnemylist_Icon_W, kPlugin_HudEnemylist_Icon_H)
+	local w,h =3D kPlugin_HudEnemylist_Icon_W, kPlugin_HudEnemylist_Icon_H
+	local iw,ih =3D u2-u1, v2-v1
+	local dx,dy =3D 0,0
+		=

+	if iw &gt; ih then
+		-- landscape image ratio
+		h =3D w*ih/iw
+		dy =3D math.floor((kPlugin_HudEnemylist_Icon_H - h)/2)
+	else
+		-- portrait image ratio
+		w =3D iw*h/ih
+		dx =3D math.floor((kPlugin_HudEnemylist_Icon_W - w)/2)
+	end
+	=

+	block.widget_icon =3D guimaker.MakePlane(block.widget_icon_bg, mat_icon, =
0, 0, w,h)
+	block.widget_icon.gfx:SetUV(u1,v1,u2,v2)
+	block.widget_icon.gfx:SetPos(dx,dy)
 	block.widget_icon.mbIgnoreMouseOver =3D true
 	=

 	-- root widget for later movement
@@ -362,7 +386,10 @@
 		local image =3D gTypenameToIcon[typename]
 		if not image then image =3D &quot;sd_pd_unknown.png&quot; end
 		=

-		block =3D Plugin_HudEnemylist_MakeBlock(typename,index,image,{})
+		local sMatName,iWidth,iHeight,iCenterX,iCenterY,iFrames,u0,v0,u1,v1 =3D =
Anim2DAtlas_Load(typename,2,0,0)
+		local image_info =3D {sMatName,u0,v0,u1,v1}
+		=

+		block =3D Plugin_HudEnemylist_MakeBlock(typename,index,image_info,{})
 		gPlugin_HudEnemylist_Blocks[typename] =3D block
 		=

 		-- update positions
@@ -467,9 +494,12 @@
 }
 	=

 function Plugin_GetMobileTypeName	(obj)
+	return obj.artid
+	--[[
 	local n =3D obj.notoriety
 	if n and gNotorietyToTypename[n] then return gNotorietyToTypename[n] end
 	return &quot;not_&quot;..n
+	]]
 end
 =

 RegisterListener(&quot;Hook_Object_CreateMobile&quot;,function (obj)


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001021.html">[Iris-commit] [IRIS] r2212 - in /trunk/lua: lib.2d.cam.lua lib.2d.map.lua lib.2d.mobile.lua lib.2d.renderer.lua lib.uoanim.lua lib.uoutils.lua
</A></li>
	<LI>Next message: <A HREF="001023.html">[Iris-commit] [IRIS] r2214 - in /trunk/lua: lib.2d.renderer.lua	lib.artatlas.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1022">[ date ]</a>
              <a href="thread.html#1022">[ thread ]</a>
              <a href="subject.html#1022">[ subject ]</a>
              <a href="author.html#1022">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
