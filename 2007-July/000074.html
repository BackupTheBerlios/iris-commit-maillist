<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r1258 - in /trunk: bin/ data/ data/lua/ data/models/materials/ data/terrain/materials/ data/terrain/programs/ data/terrain/textures/ src/
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2007-July/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1258%20-%20in%20/trunk%3A%20bin/%20data/%20data/lua/%0A%20data/models/materials/%20data/terrain/materials/%20data/terrain/programs/%0A%20data/terrain/textures/%20src/&In-Reply-To=%3C20070701224448.782D710701CE%40localhost.localdomain%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000073.html">
   <LINK REL="Next"  HREF="000075.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r1258 - in /trunk: bin/ data/ data/lua/ data/models/materials/ data/terrain/materials/ data/terrain/programs/ data/terrain/textures/ src/</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r1258%20-%20in%20/trunk%3A%20bin/%20data/%20data/lua/%0A%20data/models/materials/%20data/terrain/materials/%20data/terrain/programs/%0A%20data/terrain/textures/%20src/&In-Reply-To=%3C20070701224448.782D710701CE%40localhost.localdomain%3E"
       TITLE="[Iris-commit] [IRIS] r1258 - in /trunk: bin/ data/ data/lua/ data/models/materials/ data/terrain/materials/ data/terrain/programs/ data/terrain/textures/ src/">no-reply at zwischenwelt.org
       </A><BR>
    <I>Mon Jul  2 00:44:47 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000073.html">[Iris-commit] [IRIS] r1257 - in /branches/knut: data/lua/gui/gui.gumpmanager.lua data/lua/main.lua src/spritemanager.cpp
</A></li>
        <LI>Next message: <A HREF="000075.html">[Iris-commit] [IRIS] r1259 - in /trunk/data: lua/filter.granny.lua models/materials/armoire.material models/models/to_004000/OgreXMLConverter.log terrain/materials/terrain.material terrain/programs/terrain.program
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#74">[ date ]</a>
              <a href="thread.html#74">[ thread ]</a>
              <a href="subject.html#74">[ subject ]</a>
              <a href="author.html#74">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: sience
Date: Mon Jul  2 00:44:46 2007
New Revision: 1258

Log:
-new binary
-dirt texture changed
-glsl (opengl) terrainshader fixed (transitions should work now)
-F7 + F8 keys toggles the global ambient light

Added:
    trunk/data/terrain/textures/Dirt_large_pattern_512.dds   (with props)
Removed:
    trunk/data/terrain/textures/Dirt_large_pattern_1024.dds
Modified:
    trunk/bin/iris2.exe
    trunk/data/lua/lib.3d.renderer.lua
    trunk/data/lua/lib.input.lua
    trunk/data/lua/lib.mainmenu.lua
    trunk/data/models/materials/armoire.material
    trunk/data/skippedfallbacks.lua
    trunk/data/terrain/materials/terrain.material
    trunk/data/terrain/programs/terrain.program
    trunk/src/scripting.cpp

Modified: trunk/bin/iris2.exe
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
Binary files - no diff available.

Modified: trunk/data/lua/lib.3d.renderer.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.3d.renderer.lua (original)
+++ trunk/data/lua/lib.3d.renderer.lua Mon Jul  2 00:44:46 2007
@@ -79,7 +79,6 @@
 	Client_ClearLights()
 	Client_AddDirectionalLight(1,1,-1)
 	Client_SetAmbientLight(0.4, 0.4, 0.4, 1)
-	-- GetMainViewport():SetBackCol(ColourValue(0.5,0.5,1));
 	=

 	self.gbActive =3D true
 	self:SetMapEnvironment()
@@ -680,15 +679,23 @@
 			item.gfx:SetMesh(meshname)
 			item.gfx:SetScale(-1,1,1)
 =

+			--kTileDataFlag_LightSource
+			--void 	setDiffuseColour (Real red, Real green, Real blue)
+			if( BitwiseAND(GetStaticTileTypeFlags(item.artid) or 0,kTileDataFlag_Li=
ghtSource) ~=3D 0 ) then
+				local x,y,z =3D Renderer3D:UOPosToLocal(item.xloc,item.yloc,item.zloc =
* 0.1)
+				Client_AddPointLight(x,y,z+5, 0.3,0.3,0.0, 5.0,0.1,0.1,0.0) --5.0,0.00=
5,0.0005,0.0)
+				--print(&quot;lichtquelle artid=3D&quot;..item.artid)
+				--print(&quot;item.xloc+item.xadd=3D&quot;..item.xloc)
+				--print(&quot;item.yloc+item.yadd=3D&quot;..item.yloc)
+				--print(&quot;item.zloc+item.zadd=3D&quot;..item.zloc)
+			end
 			-- --------------------------------------------------------------------=
-----
 			-- todo: HACK here (zadd because dynamic street-tiles dont look good fl=
ying)
 			if (CountMeshTriangles(meshname) &lt;=3D 4) then =

 				if (gTileTypeLoader) then
-					local t =3D {}
-					local miFlags
-					t, miFlags =3D gTileTypeLoader:GetStaticTileType(item.artid+32*512) -=
- add 0x00004000
-					if not(isSurface(miFlags)) then
+					if not(isSurface( GetStaticTileTypeFlags(item.artid) or 0 )) then
 						item.zadd =3D self.gDynamicZAdd
+						--print(&quot;Surface unter 4 triangles nicht zadd=3D&quot;..item.artid)
 					end
 				end
 			end

Modified: trunk/data/lua/lib.input.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.input.lua (original)
+++ trunk/data/lua/lib.input.lua Mon Jul  2 00:44:46 2007
@@ -233,6 +233,33 @@
 	Bind(&quot;f11&quot;,		function (state) if (not gActiveEditText) then if ((state &gt; =
0) and (gCurrentRenderer =3D=3D Renderer3D)) then ShowFallBackTool() end en=
d end)
 	Bind(&quot;tab&quot;,		function (state) if (state &gt; 0) then if (gActWarmode=3D=3DgW=
armode_Normal) then Send_CombatMode(gWarmode_Combat) else Send_CombatMode(g=
Warmode_Normal) end end end)
 	Bind(&quot;m&quot;,		function (state) if (not gActiveEditText) then if (state &gt; 0) =
then MobileDisplayTextOverHead(gPlayerBodySerial,&quot;bla bla bla&quot;) end end end)
+
+	Bind(&quot;f7&quot;,		function (state) if (not gActiveEditText) then if (state &gt; 0)=
 then
+		if (gAmbientColor.r &lt; 1.0) then
+			gAmbientColor.r=3DgAmbientColor.r+0.1
+			gAmbientColor.g=3DgAmbientColor.g+0.1
+			gAmbientColor.b=3DgAmbientColor.b+0.1
+		else
+			gAmbientColor.r=3D1.0
+			gAmbientColor.g=3D1.0
+			gAmbientColor.b=3D1.0
+		end
+		print(&quot;gAmbientColor.r=3D&quot;..gAmbientColor.r)
+		Client_SetAmbientLight(gAmbientColor.r, gAmbientColor.g, gAmbientColor.b=
, 1)
+ 	end end end)
+		Bind(&quot;f8&quot;,		function (state) if (not gActiveEditText) then if (state &gt; 0=
) then
+		if (gAmbientColor.r &gt; 0.1) then
+			gAmbientColor.r=3DgAmbientColor.r-0.1
+			gAmbientColor.g=3DgAmbientColor.g-0.1
+			gAmbientColor.b=3DgAmbientColor.b-0.1
+		else
+			gAmbientColor.r=3D0.0
+			gAmbientColor.g=3D0.0
+			gAmbientColor.b=3D0.0
+		end
+		print(&quot;gAmbientColor.r=3D&quot;..gAmbientColor.r)
+		Client_SetAmbientLight(gAmbientColor.r, gAmbientColor.g, gAmbientColor.b=
, 1)
+ 	end end end)
 =

 	--[[
 	Bind(&quot;f9&quot;,		function (state) if (not gActiveEditText) then if (state &gt; 0)=
 then =


Modified: trunk/data/lua/lib.mainmenu.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/lua/lib.mainmenu.lua (original)
+++ trunk/data/lua/lib.mainmenu.lua Mon Jul  2 00:44:46 2007
@@ -335,12 +335,7 @@
 	cam:SetNearClipDistance(0.5) -- old : 1
 	cam:SetFarClipDistance(2000) -- ogre defaul : 100000
 	cam:SetProjectionType(0) -- perspective
-	Client_ClearLights()
-	Client_AddDirectionalLight(1,1,-1)
-	Client_SetAmbientLight(0.4, 0.4, 0.4, 1)
 	Client_SetSkybox(&quot;sunset&quot;) -- cleansky skybox sunset darksun =

-	=

---	SetMainMenuCam(0,(90 + 10) * gfDeg2Rad)
 	SetMainMenuCam(0,gfDeg2Rad)
 end
 =


Modified: trunk/data/models/materials/armoire.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/models/materials/armoire.material (original)
+++ trunk/data/models/materials/armoire.material Mon Jul  2 00:44:46 2007
@@ -3,6 +3,9 @@
 {
 	technique
 	{
+		lighting on
+		ambient 1.0 1.0 1.0
+		diffuse 1.0 1.0 1.0
 		pass
 		{
 			texture_unit
@@ -21,6 +24,9 @@
 {
 	technique
 	{
+		lighting on
+		ambient 1.0 1.0 1.0
+		diffuse 1.0 1.0 1.0
 		pass
 		{
 			texture_unit

Modified: trunk/data/skippedfallbacks.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/skippedfallbacks.lua (original)
+++ trunk/data/skippedfallbacks.lua Mon Jul  2 00:44:46 2007
@@ -291,54 +291,54 @@
 RegisterSkippedArtBillboardFallBack(5234) -- 0x1472 name=3Dtelescope
 RegisterSkippedArtBillboardFallBack(2271) -- 0x08df name=3Dfireplace
 RegisterSkippedArtBillboardFallBack(2256) -- 0x08d0 name=3Dfireplace
-RegisterSkippedArtBillboardFallBack(2259) -- 0x08d3 name=3Dfireplace
-RegisterSkippedArtBillboardFallBack(2350) -- 0x092e name=3Doven
-RegisterSkippedArtBillboardFallBack(7740) -- 0x1e3c name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7741) -- 0x1e3d name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7742) -- 0x1e3e name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7734) -- 0x1e36 name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7736) -- 0x1e38 name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7738) -- 0x1e3a name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7739) -- 0x1e3b name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7737) -- 0x1e39 name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(6042) -- 0x179a name=3Dwater
-RegisterSkippedArtBillboardFallBack(6044) -- 0x179c name=3Dwater
-RegisterSkippedArtBillboardFallBack(6039) -- 0x1797 name=3Dwater
-RegisterSkippedArtBillboardFallBack(6041) -- 0x1799 name=3Dwater
-RegisterSkippedArtBillboardFallBack(6040) -- 0x1798 name=3Dwater
-RegisterSkippedArtBillboardFallBack(6043) -- 0x179b name=3Dwater
-RegisterSkippedArtBillboardFallBack(6065) -- 0x17b1 name=3Dwater
-RegisterSkippedArtBillboardFallBack(6795) -- 0x1a8b name=3Dore cart
-RegisterSkippedArtBillboardFallBack(6790) -- 0x1a86 name=3Dore cart
-RegisterSkippedArtBillboardFallBack(8611) -- 0x21a3 name=3Dnodraw
-RegisterSkippedArtBillboardFallBack(3698) -- 0x0e72 name=3Dcannon
-RegisterSkippedArtBillboardFallBack(8601) -- 0x2199 name=3Dnodraw
-RegisterSkippedArtBillboardFallBack(7770) -- 0x1e5a name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7771) -- 0x1e5b name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7763) -- 0x1e53 name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7765) -- 0x1e55 name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7766) -- 0x1e56 name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7767) -- 0x1e57 name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7768) -- 0x1e58 name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(7769) -- 0x1e59 name=3Dbearskin rug
-RegisterSkippedArtBillboardFallBack(4808) -- 0x12c8 name=3Dscaffold
-RegisterSkippedArtBillboardFallBack(6553) -- 0x1999 name=3Dforge
-RegisterSkippedArtBillboardFallBack(6565) -- 0x19a5 name=3Dforge
-RegisterSkippedArtBillboardFallBack(12430) -- 0x308e name=3Delven table se=
ts
-RegisterSkippedArtBillboardFallBack(12428) -- 0x308c name=3Delven table se=
ts
-RegisterSkippedArtBillboardFallBack(12433) -- 0x3091 name=3Delven table se=
ts
-RegisterSkippedArtBillboardFallBack(12431) -- 0x308f name=3Delven table se=
ts
-RegisterSkippedArtBillboardFallBack(8636) -- 0x21bc name=3Dnodraw
-RegisterSkippedArtBillboardFallBack(3509) -- 0x0db5 name=3Dbed
-RegisterSkippedArtBillboardFallBack(3505) -- 0x0db1 name=3Dbed
-RegisterSkippedArtBillboardFallBack(3504) -- 0x0db0 name=3Dbed
-RegisterSkippedArtBillboardFallBack(6629) -- 0x19e5 name=3Dfountain
-RegisterSkippedArtBillboardFallBack(6610) -- 0x19d2 name=3Dfountain
-RegisterSkippedArtBillboardFallBack(6633) -- 0x19e9 name=3Dfountain
-RegisterSkippedArtBillboardFallBack(6635) -- 0x19eb name=3Dfountain
-RegisterSkippedArtBillboardFallBack(6631) -- 0x19e7 name=3Dfountain
-RegisterSkippedArtBillboardFallBack(3105) -- 0x0c21 name=3Dbroken dresser
-RegisterSkippedArtBillboardFallBack(12962) -- 0x32a2 name=3Dlava
-RegisterSkippedArtBillboardFallBack(12968) -- 0x32a8 name=3Dlava
-RegisterSkippedArtBillboardFallBack(12969) -- 0x32a9 name=3Dlava
-RegisterSkippedArtBillboardFallBack(12966) -- 0x32a6 name=3Dlava
+RegisterSkippedArtBillboardFallBack(2259) -- 0x08d3 name=3Dfireplace
+RegisterSkippedArtBillboardFallBack(2350) -- 0x092e name=3Doven
+RegisterSkippedArtBillboardFallBack(7740) -- 0x1e3c name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7741) -- 0x1e3d name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7742) -- 0x1e3e name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7734) -- 0x1e36 name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7736) -- 0x1e38 name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7738) -- 0x1e3a name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7739) -- 0x1e3b name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7737) -- 0x1e39 name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(6042) -- 0x179a name=3Dwater
+RegisterSkippedArtBillboardFallBack(6044) -- 0x179c name=3Dwater
+RegisterSkippedArtBillboardFallBack(6039) -- 0x1797 name=3Dwater
+RegisterSkippedArtBillboardFallBack(6041) -- 0x1799 name=3Dwater
+RegisterSkippedArtBillboardFallBack(6040) -- 0x1798 name=3Dwater
+RegisterSkippedArtBillboardFallBack(6043) -- 0x179b name=3Dwater
+RegisterSkippedArtBillboardFallBack(6065) -- 0x17b1 name=3Dwater
+RegisterSkippedArtBillboardFallBack(6795) -- 0x1a8b name=3Dore cart
+RegisterSkippedArtBillboardFallBack(6790) -- 0x1a86 name=3Dore cart
+RegisterSkippedArtBillboardFallBack(8611) -- 0x21a3 name=3Dnodraw
+RegisterSkippedArtBillboardFallBack(3698) -- 0x0e72 name=3Dcannon
+RegisterSkippedArtBillboardFallBack(8601) -- 0x2199 name=3Dnodraw
+RegisterSkippedArtBillboardFallBack(7770) -- 0x1e5a name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7771) -- 0x1e5b name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7763) -- 0x1e53 name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7765) -- 0x1e55 name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7766) -- 0x1e56 name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7767) -- 0x1e57 name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7768) -- 0x1e58 name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(7769) -- 0x1e59 name=3Dbearskin rug
+RegisterSkippedArtBillboardFallBack(4808) -- 0x12c8 name=3Dscaffold
+RegisterSkippedArtBillboardFallBack(6553) -- 0x1999 name=3Dforge
+RegisterSkippedArtBillboardFallBack(6565) -- 0x19a5 name=3Dforge
+RegisterSkippedArtBillboardFallBack(12430) -- 0x308e name=3Delven table se=
ts
+RegisterSkippedArtBillboardFallBack(12428) -- 0x308c name=3Delven table se=
ts
+RegisterSkippedArtBillboardFallBack(12433) -- 0x3091 name=3Delven table se=
ts
+RegisterSkippedArtBillboardFallBack(12431) -- 0x308f name=3Delven table se=
ts
+RegisterSkippedArtBillboardFallBack(8636) -- 0x21bc name=3Dnodraw
+RegisterSkippedArtBillboardFallBack(3509) -- 0x0db5 name=3Dbed
+RegisterSkippedArtBillboardFallBack(3505) -- 0x0db1 name=3Dbed
+RegisterSkippedArtBillboardFallBack(3504) -- 0x0db0 name=3Dbed
+RegisterSkippedArtBillboardFallBack(6629) -- 0x19e5 name=3Dfountain
+RegisterSkippedArtBillboardFallBack(6610) -- 0x19d2 name=3Dfountain
+RegisterSkippedArtBillboardFallBack(6633) -- 0x19e9 name=3Dfountain
+RegisterSkippedArtBillboardFallBack(6635) -- 0x19eb name=3Dfountain
+RegisterSkippedArtBillboardFallBack(6631) -- 0x19e7 name=3Dfountain
+RegisterSkippedArtBillboardFallBack(3105) -- 0x0c21 name=3Dbroken dresser
+RegisterSkippedArtBillboardFallBack(12962) -- 0x32a2 name=3Dlava
+RegisterSkippedArtBillboardFallBack(12968) -- 0x32a8 name=3Dlava
+RegisterSkippedArtBillboardFallBack(12969) -- 0x32a9 name=3Dlava
+RegisterSkippedArtBillboardFallBack(12966) -- 0x32a6 name=3Dlava

Modified: trunk/data/terrain/materials/terrain.material
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/materials/terrain.material (original)
+++ trunk/data/terrain/materials/terrain.material Mon Jul  2 00:44:46 2007
@@ -69,7 +69,8 @@
 			}
 			fragment_program_ref terrainBase_ps
 			{
-//				param_named texCoordDiffuse 0
+				param_named texCoordDiffuse 0
+				param_named sDiffuseTexture int 0
 			}
 			texture_unit 0
 			{ =

@@ -96,8 +97,10 @@
 			}
 			fragment_program_ref terrainBlend_ps
 			{
-//				param_named texCoordDiffuse 0
-//				param_named texCoordBlend 1
+				param_named texCoordDiffuse 0
+				param_named texCoordBlend 1
+				param_named sDiffuseTexture int 0
+				param_named sBlendTexture int 1
 			}
 			texture_unit 0
 			{
@@ -144,7 +147,7 @@
 		{
 			texture_unit
 			{
-				texture Dirt_large_pattern_1024.dds
+				texture Dirt_large_pattern_512.dds
 			}
 		}
 	}
@@ -246,7 +249,7 @@
 		{
 			texture_unit
 			{
-				texture Dirt_large_pattern_1024.dds
+				texture Dirt_large_pattern_512.dds
 			}
 		}
 		pass blend
@@ -297,7 +300,7 @@
 		{
 			texture_unit
 			{
-				texture Dirt_large_pattern_1024.dds
+				texture Dirt_large_pattern_512.dds
 			}
 		}
 	}
@@ -311,7 +314,7 @@
 		{
 			texture_unit
 			{
-				texture Dirt_large_pattern_1024.dds
+				texture Dirt_large_pattern_512.dds
 			}
 		}
 		pass blend
@@ -332,7 +335,7 @@
 		{
 			texture_unit
 			{
-				texture Dirt_large_pattern_1024.dds
+				texture Dirt_large_pattern_512.dds
 			}
 		}
 		pass blend

Modified: trunk/data/terrain/programs/terrain.program
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/data/terrain/programs/terrain.program (original)
+++ trunk/data/terrain/programs/terrain.program Mon Jul  2 00:44:46 2007
@@ -34,6 +34,10 @@
 	source terrainBase_ps.hlsl
 	target ps_2_0
 	entry_point main
+	default_params =

+	{ =

+		param_named sDiffuseTexture int 0 =

+	}
 }
 =

 //Terrain two texture blending - Pixel Shader
@@ -42,6 +46,11 @@
 	source terrainBlend_ps.hlsl
 	target ps_2_0
 	entry_point main
+	default_params =

+	{ =

+		param_named sDiffuseTexture int 0
+		param_named sBlendTexture int 1
+	}
 }
 =

 //--------------------------------------------------
@@ -70,7 +79,7 @@
 		param_named_auto cameraPosition camera_position
 =

 		//user defined
-//		param_named worldScale float 4		//scale of the texture (scale of 1 is =
1x1 tiles etc.)	=

+//		param_named worldScale float 4		//scale of the texture (scale of 1 is =
1x1 tiles etc.)
 	}
 }
 =

@@ -78,12 +87,21 @@
 fragment_program terrainBase_ps_glsl glsl
 {
 	source terrainBase_ps.glsl
+	default_params =

+	{ =

+		param_named sDiffuseTexture int 0 =

+	}
 }
 =

 //Terrain two texture blending - Pixel Shader
 fragment_program terrainBlend_ps_glsl glsl
 {
 	source terrainBlend_ps.glsl
+	default_params =

+	{ =

+		param_named sDiffuseTexture int 0
+		param_named sBlendTexture int 1
+	}
 }
 =

 //--------------------------------------------------

Modified: trunk/src/scripting.cpp
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/src/scripting.cpp (original)
+++ trunk/src/scripting.cpp Mon Jul  2 00:44:46 2007
@@ -42,8 +42,8 @@
 #ifdef PROFILE_LUACALLCOUNT
 std::map&lt;const char*,int&gt; gPROFILE_LUACALLCOUNT;
 struct cPROFILE_LUACALLCOUNTSetCmp {
-  inline bool operator() (const std::pair&lt;const char*,int&gt;&amp; x,const  std::=
pair&lt;const char*,int&gt;&amp; y) const { =

-	return x.second &gt; y.second; =

+  inline bool operator() (const std::pair&lt;const char*,int&gt;&amp; x,const  std::=
pair&lt;const char*,int&gt;&amp; y) const {
+	return x.second &gt; y.second;
   }
 };
 #endif
@@ -83,7 +83,7 @@
 		std::string sMyStackTrace;
 		cScripting::GetSingletonPtr()-&gt;LuaCall(&quot;_TRACEBACK&quot;,&quot;&gt;s&quot;,&amp;sMyStackTrace);
 		fprintf(f,&quot;%s\n&quot;,sMyStackTrace.c_str());
-		=

+
 		fclose(f);
 	}
 }
@@ -110,15 +110,15 @@
 /// called from lua : string keyname
 static int l_GetNamedKey (lua_State *L) { PROFILE
 	const char *keyname =3D luaL_checkstring(L, 1);
-	lua_pushnumber(L,cInput::GetSingleton().GetNamedKey(keyname));  // push r=
esult =

-	return 1;  // number of results =

+	lua_pushnumber(L,cInput::GetSingleton().GetNamedKey(keyname));  // push r=
esult
+	return 1;  // number of results
 }
 =

 /// called from lua : int keycode
 static int l_GetKeyName (lua_State *L) { PROFILE
 	int keycode =3D luaL_checkint(L, 1);
-	lua_pushstring(L,cInput::GetSingleton().GetKeyName(keycode));  // push re=
sult =

-	return 1;  // number of results =

+	lua_pushstring(L,cInput::GetSingleton().GetKeyName(keycode));  // push re=
sult
+	return 1;  // number of results
 }
 =

 /// terminates the application
@@ -143,7 +143,7 @@
 	lua_pushboolean(L,cShell::mbAlive);
 	return 1;
 }
-	=

+
 /// called from lua : no params, returns mousex,mousey,4xmousewheel info...
 static int l_PollInput (lua_State *L) { PROFILE
 	lua_pushnumber(L,cInput::iMouse[0]);
@@ -158,14 +158,14 @@
 =

 static int l_ProfileDumpCallCount (lua_State *L) { PROFILE
 	ProfileDumpCallCount();
-	=

+
 	#ifdef PROFILE_LUACALLCOUNT
 	printf(&quot;LuaCallCounts:\n\n&quot;);
-	=

+
 	std::multiset&lt;std::pair&lt;const char*,int&gt;,cPROFILE_LUACALLCOUNTSetCmp&gt; myC=
allCountProfileSet;
 	typedef std::multiset&lt;std::pair&lt;const char*,int&gt;,cPROFILE_LUACALLCOUNTSet=
Cmp&gt;::iterator tLuaCallCountProfileSetItor;
 	{ for (std::map&lt;const char*,int&gt;::iterator itor=3DgPROFILE_LUACALLCOUNT.b=
egin();itor !=3D gPROFILE_LUACALLCOUNT.end();++itor)
-		myCallCountProfileSet.insert(std::make_pair((*itor).first,(*itor).second=
)); =

+		myCallCountProfileSet.insert(std::make_pair((*itor).first,(*itor).second=
));
 	}
 	int i=3D0;
 	for (tLuaCallCountProfileSetItor itor=3DmyCallCountProfileSet.begin();ito=
r !=3D myCallCountProfileSet.end();++itor) {
@@ -211,7 +211,7 @@
 	if (ar.currentline &gt; 0)
 	  lua_pushfstring(L, &quot;%d:&quot;, ar.currentline);
 	switch (*ar.namewhat) {
-	  case 'g':  /* global */ =

+	  case 'g':  /* global */
 	  case 'l':  /* local */
 	  case 'f':  /* field */
 	  case 'm':  /* method */
@@ -290,7 +290,7 @@
 static int l_OgreMemoryUsage (lua_State *L) { PROFILE
 	std::string part(luaL_checkstring(L,1));
 	size_t mem =3D 0;
-	=

+
 #ifdef OGRE_VERSION_SUFFIX
 	if(part.find(&quot;compositor&quot;) !=3D std::string::npos || part.find(&quot;all&quot;) !=
=3D std::string::npos)mem +=3D Ogre::CompositorManager::getSingleton().getM=
emoryUsage();
 	if(part.find(&quot;font&quot;) !=3D std::string::npos || part.find(&quot;all&quot;) !=3D std:=
:<i>string::npos)mem +=3D Ogre::FontManager::getSingleton().getMemoryUsage();
</I>@@ -301,7 +301,7 @@
 	if(part.find(&quot;skeleton&quot;) !=3D std::string::npos || part.find(&quot;all&quot;) !=3D =
std::string::npos)mem +=3D Ogre::SkeletonManager::getSingleton().getMemoryU=
sage();
 	if(part.find(&quot;texture&quot;) !=3D std::string::npos || part.find(&quot;all&quot;) !=3D s=
td::string::npos)mem +=3D Ogre::TextureManager::getSingleton().getMemoryUsa=
ge();
 #endif
-	=

+
 	lua_pushnumber(L, mem);
 	return 1;
 }
@@ -310,14 +310,14 @@
 static int l_OgreMeshAvailable (lua_State *L) { PROFILE
 	const char *name =3D luaL_checkstring(L,1);
 	bool ret;
-	=

+
 	try {
 		Ogre::MeshManager::getSingleton().load(name,Ogre::ResourceGroupManager::=
DEFAULT_RESOURCE_GROUP_NAME);
 		ret =3D true;
 	} catch (...) {
 			ret =3D false;
 	}
-	=

+
 	lua_pushboolean(L, ret);
 	return 1;
 }
@@ -325,9 +325,9 @@
 /// see also OgreMaterialAvailable below
 /// bool =3D OgreMaterialNameKnown(ressourcename)
 /// returns false if name is empty string or nil
-static int l_OgreMaterialNameKnown (lua_State *L) { PROFILE =

+static int l_OgreMaterialNameKnown (lua_State *L) { PROFILE
 	std::string sMatName =3D (lua_gettop(L) &gt;=3D 1 &amp;&amp; !lua_isnil(L,1)) ? luaL=
_checkstring(L,1) : &quot;&quot;;
-	if (sMatName.size() &gt; 0) { =

+	if (sMatName.size() &gt; 0) {
 		Ogre::MaterialPtr pMaterial =3D Ogre::MaterialManager::getSingleton().ge=
tByName(sMatName.c_str());
 		lua_pushboolean(L,!pMaterial.isNull());
 	} else {
@@ -338,18 +338,18 @@
 =

 /// bool =3D OgreMaterialAvailable(ressourcename)
 static int l_OgreMaterialAvailable (lua_State *L) { PROFILE
-	assert(0 &amp;&amp; &quot;DON'T USE ME, ALWAYS RETURNS TRUE&quot;); =

+	assert(0 &amp;&amp; &quot;DON'T USE ME, ALWAYS RETURNS TRUE&quot;);
 	// TODO, this code does not work, use l_OgreMaterialNameKnown  above
 	const char *name =3D luaL_checkstring(L,1);
 	bool ret;
-	=

+
 	try {
 		Ogre::MaterialManager::getSingleton().load(name,Ogre::ResourceGroupManag=
er::DEFAULT_RESOURCE_GROUP_NAME);
 		ret =3D true;
 	} catch (...) {
 			ret =3D false;
 	}
-	=

+
 	lua_pushboolean(L, ret);
 	return 1;
 }
@@ -358,14 +358,14 @@
 static int l_OgreTextureAvailable (lua_State *L) { PROFILE
 	const char *name =3D luaL_checkstring(L,1);
 	bool ret;
-	=

+
 	try {
 		Ogre::TextureManager::getSingleton().load(name,Ogre::ResourceGroupManage=
r::DEFAULT_RESOURCE_GROUP_NAME);
 		ret =3D true;
 	} catch (...) {
 			ret =3D false;
 	}
-	=

+
 	lua_pushboolean(L, ret);
 	return 1;
 }
@@ -373,11 +373,11 @@
 /// r,g,b =3D Uo16Color2Rgb(color)
 static int l_Uo16Color2Rgb (lua_State *L) { PROFILE
 	unsigned short color =3D luaL_checkint(L,1);
-	=

+
 	float r =3D float((color &gt;&gt; 10) &amp; 0x1F)/float(0x1f);
 	float g =3D float((color &gt;&gt;  5) &amp; 0x1F)/float(0x1f);
 	float b =3D float((color &gt;&gt;  0) &amp; 0x1F)/float(0x1f);
-				=

+
 	lua_pushnumber(L, r);
 	lua_pushnumber(L, g);
 	lua_pushnumber(L, b);
@@ -390,16 +390,16 @@
 	std::string sMaskPath		=3D luaL_checkstring(L,2);
 	cHueLoader *hueLoader 		=3D cLuaBind&lt;cHueLoader&gt;::checkudata(L,3);
 	int iHue					=3D luaL_checkint(L,4);
-	=

+
 	if (iHue =3D=3D 0 || !hueLoader) {
 		lua_pushstring(L,sTexturePath.c_str());
 		return 1;
 	}
-	=

+
 	// load image
 	Ogre::Image myImage;
 	myImage.load(sTexturePath,Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GR=
OUP_NAME);
-	=

+
 	// get image infos
 	Ogre::PixelFormat myFormat =3D myImage.getFormat();
 	unsigned int size =3D myImage.getSize();
@@ -413,15 +413,15 @@
 	Ogre::uchar* src_start =3D src;
 	uint8 cr,cg,cb,ca1,ca2;
 	short col;
-	=

+
 	// debug info
 	//printf(&quot;image size=3D%d w=3D%d h=3D%d d=3D%d f=3D%d bpp=3D%d rowspan=3D=
%d bIsNonZero2=3D%d\n&quot;,size,w,h,
 	//	myImage.getDepth(),myImage.getNumFaces(),myImage.getBPP(),rowspan,bIsN=
onZero2?1:0);
-	=

+
 	// hue filter
 	cHueFilter Filter;
 	short* ColorTable =3D hueLoader-&gt;GetHue( iHue-1 )-&gt;GetColors();
-	=

+
 	// colorize the pixels
 	for(unsigned int y =3D 0; y &lt; h; y++){
 		for(unsigned int x =3D 0; x &lt; w; x++) {
@@ -439,23 +439,23 @@
 		}
 		src +=3D rowspan - w*pixelsize;
 	}
-	=

+
 	// and make a texture
 	std::string newtextname =3D cOgreWrapper::GetSingleton().GetUniqueName();
 	//Ogre::DataStreamPtr texstream(new Ogre::MemoryDataStream(dst_start, siz=
e));
 	//Ogre::TexturePtr tex_hue =3D Ogre::TextureManager::getSingleton().loadR=
awData(newtextname,
 	//	Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME,texstream, w,h=
,myFormat);
-	=

+
 	Ogre::TexturePtr tex_hue =3D Ogre::TextureManager::getSingleton().loadIma=
ge(newtextname,
 		Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME,myImage,Ogre::TE=
X_TYPE_2D,-1,1.0f,true,Ogre::PF_UNKNOWN);
-	=

+
 	// free memory
 	//delete [] dst_start;
 =

 	lua_pushstring(L,newtextname.c_str());
 	return 1;
 }
-	=

+
 /// void HueMesh(meshname, hueloader, hue)
 static int l_HueMesh (lua_State *L) { PROFILE
 	std::string sMeshName =3D luaL_checkstring(L,1);
@@ -471,11 +471,11 @@
 			if (!pMyHue) return 0;
 			short* ColorTable =3D pMyHue-&gt;GetColors();
 			if (!ColorTable) return 0;
-				=

+
 			// data seem ok, so read out the mesh
 			Ogre::MeshPtr mesh =3D Ogre::MeshManager::getSingleton().load(meshname,=
Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME);
 			if (mesh.isNull()) return 0;
-			=

+
 			//printf(&quot;mesh=3D%s\n&quot;,mesh-&gt;getName().c_str());
 =

 			// and iterate over all submeshes
@@ -483,13 +483,13 @@
 			while(sit.hasMoreElements()){
 				Ogre::SubMesh *submesh =3D sit.getNext();
 				//printf(&quot;submesh=3D%i\n&quot;,submesh);
-				=

+
 				if(!submesh) continue;
 				if(!submesh-&gt;isMatInitialised())continue;
-				=

+
 				//printf(&quot;matname=3D%s\n&quot;,submesh-&gt;getMaterialName().c_str());
 =

-				// create hued texture in the current material and update the current =

+				// create hued texture in the current material and update the current
 				Ogre::MaterialPtr mat =3D Ogre::MaterialManager::getSingleton().load(s=
ubmesh-&gt;getMaterialName(),Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROU=
P_NAME);
 				if(mat.isNull()){
 					printf(&quot;ERROR HueMesh: material %s is null\n&quot;,submesh-&gt;getMaterialNam=
e().c_str());
@@ -510,7 +510,7 @@
 					Ogre::Technique *tech =3D tit.getNext();
 					Ogre::Technique *tech_hue =3D tit_hue.getNext();
 					if (!tech || !tech_hue) continue;
-					=

+
 					// iterate over all passes
 					Ogre::Technique::PassIterator pit =3D tech-&gt;getPassIterator();
 					Ogre::Technique::PassIterator pit_hue =3D tech_hue-&gt;getPassIterator();
@@ -518,7 +518,7 @@
 						Ogre::Pass *pass =3D pit.getNext();
 						Ogre::Pass *pass_hue =3D pit_hue.getNext();
 						if (!pass || !pass_hue) continue;
-						=

+
 						// iterate over all tex units
 						Ogre::Pass::TextureUnitStateIterator uit =3D pass-&gt;getTextureUnitSta=
teIterator();
 						Ogre::Pass::TextureUnitStateIterator uit_hue =3D pass_hue-&gt;getTextur=
eUnitStateIterator();
@@ -530,7 +530,7 @@
 							// current texture
 							Ogre::TexturePtr tex =3D Ogre::TextureManager::getSingleton().load(=
unit-&gt;getTextureName(),Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_N=
AME);
 							if (tex.isNull()) continue;
-							=

+
 							// lock and read access buffer
 							Ogre::HardwarePixelBufferSharedPtr b =3D tex-&gt;getBuffer();
 							if (b.isNull()) continue;
@@ -538,12 +538,12 @@
 							Ogre::Image::Box area(0, 0, b-&gt;getWidth(), b-&gt;getHeight());
 							// and lock (ro)
 							const Ogre::PixelBox box =3D b-&gt;lock(area,Ogre::HardwareBuffer::HBL=
_READ_ONLY);
-							=

+
 							// size of one pixel in bytes
 							unsigned int pixelsize =3D Ogre::PixelUtil::getNumElemBytes(box.for=
mat);
 							// texture size in bytes
 							unsigned int size =3D box.getConsecutiveSize();
-							=

+
 							char *dst =3D new char[size+1024*32]; // add a little security over=
size
 							char *src =3D static_cast&lt;char *&gt;(box.data);
 =

@@ -553,7 +553,7 @@
 							uint8 cr,cg,cb,ca1,ca2;
 							short col;
 							int dummy =3D 0;
-							=

+
 							// colorize the pixels
 							for(unsigned int y =3D 0; y &lt; box.getHeight(); y++){
 								for(unsigned int x =3D 0; x &lt; box.getWidth(); x++){
@@ -579,10 +579,10 @@
 								Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME);
 							assert(!tex_hue.isNull() &amp;&amp; &quot;HueMesh bug&quot;);
 							tex_hue-&gt;loadRawData(texstream,box.getWidth(),box.getHeight(),box.f=
ormat);
-							=

+
 							// release the lock
 							b-&gt;unlock();
-		=

+
 							// set the texture
 							unit_hue-&gt;setTextureName(tex_hue-&gt;getName());
 =

@@ -609,15 +609,15 @@
 static int l_CreateLookupTableFromFile (lua_State *L) { PROFILE
 	const char *filename =3D luaL_checkstring(L, 1);
 	lua_newtable(L);
-	=

+
 	cFullFileLoader f(filename);
-	=

+
 	const uint32 *buffer =3D (const uint32 *)f.mpFullFileBuffer;
-	=

+
 	for(int i =3D 0;i &lt; f.miFullFileSize / 4; ++i){
 		lua_pushnumber(L,i); lua_rawseti(L,-2,buffer[i]);
 	}
-	=

+
 	return 1;
 }
 =

@@ -639,7 +639,7 @@
 	Ogre::Real linearStart 	=3D (numargs &gt; i &amp;&amp; !lua_isnil(L,i+1)) ? luaL_che=
cknumber(L, ++i) : 0.0;
 	Ogre::Real linearEnd 	=3D (numargs &gt; i &amp;&amp; !lua_isnil(L,i+1)) ? luaL_check=
number(L, ++i) : 1.0;
 	/*
-	void 	setFog (FogMode mode=3DFOG_NONE, const ColourValue &amp;colour=3DColour=
Value::White, =

+	void 	setFog (FogMode mode=3DFOG_NONE, const ColourValue &amp;colour=3DColour=
Value::White,
 					Real expDensity=3D0.001, Real linearStart=3D0.0, Real linearEnd=3D1.0)
     0=3DFOG_NONE 	No fog. Duh.
     1=3DFOG_EXP 	Fog density increases exponentially from the camera (fog =
=3D 1/e^(distance * density)).
@@ -701,6 +701,8 @@
 		Ogre::Light* pLight =3D pSceneMgr-&gt;createLight( cOgreWrapper::GetSinglet=
on().GetUniqueName() );
 		pLight-&gt;setType( Ogre::Light::LT_POINT );
 		pLight-&gt;setPosition(luaL_checknumber(L,1),luaL_checknumber(L,2),luaL_che=
cknumber(L,3));
+		pLight-&gt;setDiffuseColour(luaL_checknumber(L,4),luaL_checknumber(L,5),lua=
L_checknumber(L,6));
+		pLight-&gt;setAttenuation(luaL_checknumber(L,7),luaL_checknumber(L,8),luaL_=
checknumber(L,9),luaL_checknumber(L,10));
 	}
 	return 0;
 }
@@ -783,12 +785,12 @@
 static int l_TerrainRayPick (lua_State *L) { PROFILE
 	cGroundBlockLoader* pGroundBlockLoader =3D cLuaBind&lt;cGroundBlockLoader&gt;::=
checkudata(L,1);
 	if (!pGroundBlockLoader) return 0;
-	=

+
 	// don't use ++i or something here, the compiler might mix the order
 	Ogre::Vector3 	vBlockPos(luaL_checknumber(L,4),luaL_checknumber(L,5),luaL=
_checknumber(L,6));
 	Ogre::Vector3	vRayPos(luaL_checknumber(L,7),luaL_checknumber(L,8),luaL_ch=
ecknumber(L,9));
 	Ogre::Vector3	vRayDir(luaL_checknumber(L,10),luaL_checknumber(L,11),luaL_=
checknumber(L,12));
-	=

+
 	// feedback via lua callback TerrainRayIntersect_Hit()
 	TerrainRayIntersect(pGroundBlockLoader,luaL_checkint(L,2),luaL_checkint(L=
,3),vRayPos-vBlockPos,vRayDir);
 	return 0;
@@ -801,7 +803,7 @@
 	float			fSphereRad =3D luaL_checknumber(L,4);
 	Ogre::Vector3	vRayPos(	luaL_checknumber(L,5),luaL_checknumber(L,6),luaL_c=
hecknumber(L,7));
 	Ogre::Vector3	vRayDir(	luaL_checknumber(L,8),luaL_checknumber(L,9),luaL_c=
hecknumber(L,10));
-	=

+
 	std::pair&lt;bool, Real&gt; hit =3D Ogre::Ray(vRayPos,vRayDir).intersects(Ogre:=
:<i>Sphere(vSpherePos,fSphereRad));
</I> 	if (!hit.first) return 0;
 	lua_pushnumber(L,hit.second);
@@ -868,12 +870,12 @@
 static int l_GetRandomHexString 	(lua_State *L) { PROFILE lua_pushstring( =
L, strprintf(&quot;0x%08x&quot;,rand()).c_str()); return 1; }
 =

 /// converts &quot;0x1234&quot; to a number
-static int l_Hex2Num 	(lua_State *L) { PROFILE =

+static int l_Hex2Num 	(lua_State *L) { PROFILE
 	std::string hexcode =3D luaL_checkstring(L,1);
 	uint32 res =3D 0;
 	sscanf(hexcode.c_str(),&quot;0x%x&quot;,&amp;res);
-	lua_pushnumber(L, res); =

-	return 1; =

+	lua_pushnumber(L, res);
+	return 1;
 }
 =

 // bitwise operations, used for networking, packet manipulation etc
@@ -882,9 +884,9 @@
 	double g =3D luaL_checknumber(L,1);
 	double h =3D luaL_checknumber(L,2);
 	uint32 a =3D uint32(g);
-	uint32 b =3D uint32(h);	=

+	uint32 b =3D uint32(h);
 	uint32 c =3D a &amp; b;
-	lua_pushnumber( L, c); =

+	lua_pushnumber( L, c);
 	return 1;
 }
 static int l_BitwiseOR 		(lua_State *L) { PROFILE
@@ -892,9 +894,9 @@
 	double g =3D luaL_checknumber(L,1);
 	double h =3D luaL_checknumber(L,2);
 	uint32 a =3D uint32(g);
-	uint32 b =3D uint32(h);	=

+	uint32 b =3D uint32(h);
 	uint32 c =3D a | b;
-	lua_pushnumber( L, c); =

+	lua_pushnumber( L, c);
 	return 1;
 }
 =

@@ -904,72 +906,72 @@
 	double g =3D luaL_checknumber(L,1);
 	double h =3D luaL_checknumber(L,2);
 	uint32 a =3D uint32(g);
-	uint32 b =3D uint32(h);	=

+	uint32 b =3D uint32(h);
 	uint32 c =3D a ^ b;
-	lua_pushnumber( L, c); =

-	return 1;
-}
-
-// bitwise operations, used for networking, packet manipulation etc =

-static int l_BitwiseSHL 	(lua_State *L) { PROFILE =

-	// keep this spread out like this to avoid strange, 32 bi =

-	double g =3D luaL_checknumber(L,1); =

-	double h =3D luaL_checknumber(L,2); =

-	uint32 a =3D uint32(g); =

-	uint32 b =3D uint32(h);	 =

-	uint32 c =3D a &lt;&lt; b; =

-	lua_pushnumber( L, c);  =

-	return 1; =

-} =

-// bitwise operations, used for networking, packet manipulation etc =

-static int l_BitwiseSHR 	(lua_State *L) { PROFILE =

-	// keep this spread out like this to avoid strange, 32 bi =

-	double g =3D luaL_checknumber(L,1); =

-	double h =3D luaL_checknumber(L,2); =

-	uint32 a =3D uint32(g); =

-	uint32 b =3D uint32(h);	 =

-	uint32 c =3D a &gt;&gt; b; =

-	lua_pushnumber( L, c);  =

-	return 1; =

+	lua_pushnumber( L, c);
+	return 1;
+}
+
+// bitwise operations, used for networking, packet manipulation etc
+static int l_BitwiseSHL 	(lua_State *L) { PROFILE
+	// keep this spread out like this to avoid strange, 32 bi
+	double g =3D luaL_checknumber(L,1);
+	double h =3D luaL_checknumber(L,2);
+	uint32 a =3D uint32(g);
+	uint32 b =3D uint32(h);
+	uint32 c =3D a &lt;&lt; b;
+	lua_pushnumber( L, c);
+	return 1;
+}
+// bitwise operations, used for networking, packet manipulation etc
+static int l_BitwiseSHR 	(lua_State *L) { PROFILE
+	// keep this spread out like this to avoid strange, 32 bi
+	double g =3D luaL_checknumber(L,1);
+	double h =3D luaL_checknumber(L,2);
+	uint32 a =3D uint32(g);
+	uint32 b =3D uint32(h);
+	uint32 c =3D a &gt;&gt; b;
+	lua_pushnumber( L, c);
+	return 1;
 }
 =

 =

 static int l_TestBit 		(lua_State *L) { PROFILE lua_pushboolean(L,(uint32(=
luaL_checknumber(L,1)) &amp; (uint32(1) &lt;&lt; luaL_checkint(L,2))) !=3D 0); return=
 1; }
 static int l_SetBit 		(lua_State *L) { PROFILE lua_pushnumber( L,(uint32(l=
uaL_checknumber(L,1)) | (uint32(1) &lt;&lt; luaL_checkint(L,2)))); return 1; }
-static int l_ClearBit 		(lua_State *L) { PROFILE =

+static int l_ClearBit 		(lua_State *L) { PROFILE
 	uint32 input =3D uint32(luaL_checknumber(L,1));
 	uint32 mask =3D 1L &lt;&lt; uint32(luaL_checknumber(L,2));
 	lua_pushnumber(L,(input &amp; mask)?(input ^ mask):(input));  // XOR =3D ^ =
=3D toggle bit... toggle only if set (&amp;) to clear
-	return 1; =

-}
-
-
-static int l_Exit		 		(lua_State *L) { PROFILE =

-	exit((lua_gettop(L) &gt;=3D 1 &amp;&amp; !lua_isnil(L,1)) ? luaL_checkint(L,1) : 0); =

-	return 0; =

-}
-
-static int l_Crash		 		(lua_State *L) { PROFILE =

+	return 1;
+}
+
+
+static int l_Exit		 		(lua_State *L) { PROFILE
+	exit((lua_gettop(L) &gt;=3D 1 &amp;&amp; !lua_isnil(L,1)) ? luaL_checkint(L,1) : 0);
+	return 0;
+}
+
+static int l_Crash		 		(lua_State *L) { PROFILE
 	DisplayErrorMessage(&quot;CRASH triggered from script, see console for info (s=
tart with commandline option -c)&quot;);
-	exit(88); =

-	return 0; =

+	exit(88);
+	return 0;
 }
 =

 /// triggers a segfault, for testing our segfault handlers lua stacktrace
-static int l_CrashSegFault		 		(lua_State *L) { PROFILE =

+static int l_CrashSegFault		 		(lua_State *L) { PROFILE
 	DisplayErrorMessage(&quot;testing segfault handler...&quot;);
 	*((char*)0) =3D 0; // trigger segfault
-	return 0; =

-}
-
-
-static int l_DisplayNotice	(lua_State *L) { PROFILE =

+	return 0;
+}
+
+
+static int l_DisplayNotice	(lua_State *L) { PROFILE
 	DisplayNotice(luaL_checkstring(L,1));
 	return 0;
 }
 =

 =

-static int l_FatalErrorMessage	(lua_State *L) { PROFILE =

+static int l_FatalErrorMessage	(lua_State *L) { PROFILE
 	DisplayErrorMessage(luaL_checkstring(L,1));
 	exit(77);
 	return 0;
@@ -977,19 +979,19 @@
 =

 =

 /// for lua :   void  ExportMesh  (meshname,filename)
-static int l_ExportMesh		(lua_State *L) { PROFILE =

+static int l_ExportMesh		(lua_State *L) { PROFILE
 	Ogre::MeshPtr pMesh =3D Ogre::MeshManager::getSingleton().load(luaL_check=
string(L,1),
 					// autodetect group location
 					//Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME );
 					Ogre::ResourceGroupManager::AUTODETECT_RESOURCE_GROUP_NAME );
 	Ogre::MeshSerializer myExporter;
 	//Ogre::Mesh* pMesh =3D pEntity-&gt;getMesh().get();
-	myExporter.exportMesh(pMesh.get(),luaL_checkstring(L,2)); =

+	myExporter.exportMesh(pMesh.get(),luaL_checkstring(L,2));
 	return 0;
 }
 =

 /// for lua :   x,y,z,vx,vy,vz  GetMouseRay  ()
-static int l_GetMouseRay		(lua_State *L) { PROFILE =

+static int l_GetMouseRay		(lua_State *L) { PROFILE
 	cOgreWrapper&amp; ogrewrapper =3D cOgreWrapper::GetSingleton();
 	Ogre::Ray myray(	ogrewrapper.mCamera-&gt;getCameraToViewportRay(
 				Ogre::Real(cInput::iMouse[0]) / Ogre::Real(ogrewrapper.mViewport-&gt;getA=
ctualWidth()),
@@ -1004,14 +1006,14 @@
 }
 =

 /// for lua :   z  GetMaxZ  ()
-static int 		l_GetMaxZ		(lua_State *L) { PROFILE =

+static int 		l_GetMaxZ		(lua_State *L) { PROFILE
 	lua_pushnumber(L,Ogre::Root::getSingleton().getRenderSystem()-&gt;getMaximum=
DepthInputValue());
 	return 1;
 }
 =

 =

 /// for lua :   bIsInFront,px,py  ProjectPos  (x,y,z)
-static int l_ProjectPos		(lua_State *L) { PROFILE =

+static int l_ProjectPos		(lua_State *L) { PROFILE
 	bool 		bIsInFront;
 	Ogre::Real	fX,fY;
 	bIsInFront =3D cOgreWrapper::GetSingleton().ProjectPos(
@@ -1023,7 +1025,7 @@
 }
 =

 /// for lua :   bIsInFront,px,py,cx,cy  ProjectSizeAndPos  (x,y,z,r)
-static int l_ProjectSizeAndPos		(lua_State *L) { PROFILE =

+static int l_ProjectSizeAndPos		(lua_State *L) { PROFILE
 	bool 		bIsInFront;
 	Ogre::Real	fX,fY,fCX,fCY;
 	bIsInFront =3D cOgreWrapper::GetSingleton().ProjectSizeAndPos(
@@ -1048,9 +1050,9 @@
 static int l_OgreMeshTextures	(lua_State *L) { PROFILE  // TODO : move to =
seperate file ?
 	Ogre::MeshSerializer* meshSerializer =3D new Ogre::MeshSerializer();
 	const char *szMeshName =3D luaL_checkstring(L,1);
-	=

+
 	lua_newtable(L);
-		=

+
 	//printf(&quot;open file: %s\n&quot;,szMeshName);
 	// model file
 	std::ifstream ifs;
@@ -1060,13 +1062,13 @@
 	if(ifs.is_open()){
 		//printf(&quot;create tmp mesh\n&quot;);
 		// create tmp mesh import resource
-		Ogre::MeshPtr mesh =3D Ogre::MeshManager::getSingleton().create(&quot;l_OgreM=
eshTextureMissing_conversion&quot;, =

+		Ogre::MeshPtr mesh =3D Ogre::MeshManager::getSingleton().create(&quot;l_OgreM=
eshTextureMissing_conversion&quot;,
 			Ogre::ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME);
 =

 		//printf(&quot;import\n&quot;);
 		// import
 		meshSerializer-&gt;importMesh(stream, mesh.getPointer());
-		=

+
 		if(!mesh.isNull()){
 			// iterator over submeshes
 			Ogre::Mesh::SubMeshIterator it =3D mesh-&gt;getSubMeshIterator();
@@ -1079,17 +1081,17 @@
 				++i;
 			}
 		}
-		=

+
 		// remove all stuff
 		Ogre::MeshManager::getSingleton().remove(&quot;l_OgreMeshTextureMissing_conve=
rsion&quot;);
-		=

+
 		ifs.close();
 	} else {
 		printf(&quot;ERROR can't open file: %s\n&quot;,szMeshName);
 	}
 =

 	delete meshSerializer;
-		=

+
 	return 1;
 }
 =

@@ -1098,7 +1100,7 @@
 static int l_OgreShadowTechnique	(lua_State *L) { PROFILE  // TODO : move =
to seperate file ?
 	const char *tech =3D luaL_checkstring(L,1);
 	Ogre::SceneManager *p =3D cOgreWrapper::GetSingleton().mSceneMgr;
-	=

+
 	if(p){
 		if(strcmp(tech,&quot;stencil_modulative&quot;) =3D=3D 0)p-&gt;setShadowTechnique(Ogre=
::<i>SHADOWTYPE_STENCIL_MODULATIVE);
</I> 		else if(strcmp(tech,&quot;stencil_additive&quot;) =3D=3D 0)p-&gt;setShadowTechnique(O=
gre::SHADOWTYPE_STENCIL_ADDITIVE);
@@ -1108,12 +1110,12 @@
 		else if(strcmp(tech,&quot;texture_modulative_integrated&quot;) =3D=3D 0)p-&gt;setShad=
owTechnique(Ogre::SHADOWTYPE_TEXTURE_MODULATIVE_INTEGRATED);
 		else p-&gt;setShadowTechnique(Ogre::SHADOWTYPE_NONE);
 	}
-		=

+
 	return 0;
 }
 =

 /// for lua :   void	  OgreSetShadowTextureSize  (int size)
-static int 				l_OgreSetShadowTextureSize	(lua_State *L) { PROFILE  =

+static int 				l_OgreSetShadowTextureSize	(lua_State *L) { PROFILE
 	cOgreWrapper::GetSingleton().mSceneMgr-&gt;setShadowTextureSize(luaL_checkin=
t(L,1));
 	return 0;
 }
@@ -1121,31 +1123,31 @@
 =

 =

 /// for lua :   void	  OgreSetShadowFarDistance	(float x)
-static int 				l_OgreSetShadowFarDistance	(lua_State *L) { PROFILE  =

+static int 				l_OgreSetShadowFarDistance	(lua_State *L) { PROFILE
 	cOgreWrapper::GetSingleton().mSceneMgr-&gt;setShadowFarDistance(luaL_checknu=
mber(L,1));
 	return 0;
 }
 =

 /// for lua :   void	  OgreSetShadowDirLightTextureOffset	(float x)
-static int 				l_OgreSetShadowDirLightTextureOffset	(lua_State *L) { PROFI=
LE  =

+static int 				l_OgreSetShadowDirLightTextureOffset	(lua_State *L) { PROFI=
LE
 	cOgreWrapper::GetSingleton().mSceneMgr-&gt;setShadowDirLightTextureOffset(lu=
aL_checknumber(L,1));
 	return 0;
 }
 =

 /// for lua :   void	  OgreSetShadowTextureFadeStart	(float x)
-static int 				l_OgreSetShadowTextureFadeStart	(lua_State *L) { PROFILE  =

+static int 				l_OgreSetShadowTextureFadeStart	(lua_State *L) { PROFILE
 	cOgreWrapper::GetSingleton().mSceneMgr-&gt;setShadowTextureFadeStart(luaL_ch=
ecknumber(L,1));
 	return 0;
 }
 =

 /// for lua :   void	  OgreSetShadowTextureFadeEnd	(float x)
-static int 				l_OgreSetShadowTextureFadeEnd	(lua_State *L) { PROFILE  =

+static int 				l_OgreSetShadowTextureFadeEnd	(lua_State *L) { PROFILE
 	cOgreWrapper::GetSingleton().mSceneMgr-&gt;setShadowTextureFadeEnd(luaL_chec=
knumber(L,1));
 	return 0;
 }
 =

 /// for lua :   void	  OgreSetShadowTexturePixelFormat	()
-static int 				l_OgreSetShadowTexturePixelFormat	(lua_State *L) { PROFILE  =

+static int 				l_OgreSetShadowTexturePixelFormat	(lua_State *L) { PROFILE
 	Ogre::PixelFormat pf =3D (lua_gettop(L) &gt;=3D 2 &amp;&amp; !lua_isnil(L,1)) ? ((Og=
re::PixelFormat)luaL_checkint(L,1)) : Ogre::PF_FLOAT16_R;
 	cOgreWrapper::GetSingleton().mSceneMgr-&gt;setShadowTexturePixelFormat(pf);
 	return 0;
@@ -1153,16 +1155,16 @@
 =

 =

 /// for lua :   table	  OgrePixelFormatList  ()
-static int 				l_OgrePixelFormatList	(lua_State *L) { PROFILE  =

+static int 				l_OgrePixelFormatList	(lua_State *L) { PROFILE
 	lua_newtable(L);
 	#define OgrePixelFormatList_REGISTER(pf) lua_pushstring(L,#pf); lua_rawse=
ti(L,-2,(int)Ogre::pf);
 	OgrePixelFormatList_REGISTER(PF_UNKNOWN)		// 	Unknown pixel format.
 	OgrePixelFormatList_REGISTER(PF_L8)				// 		8-bit pixel format, all bits =
luminace.
-	OgrePixelFormatList_REGISTER(PF_BYTE_L)			// 	=

+	OgrePixelFormatList_REGISTER(PF_BYTE_L)			//
 	OgrePixelFormatList_REGISTER(PF_L16)			// 		16-bit pixel format, all bits=
 luminace.
-	OgrePixelFormatList_REGISTER(PF_SHORT_L)		// 	=

+	OgrePixelFormatList_REGISTER(PF_SHORT_L)		//
 	OgrePixelFormatList_REGISTER(PF_A8)				// 		8-bit pixel format, all bits =
alpha.
-	OgrePixelFormatList_REGISTER(PF_BYTE_A)			// 	=

+	OgrePixelFormatList_REGISTER(PF_BYTE_A)			//
 	OgrePixelFormatList_REGISTER(PF_A4L4)			// 	8-bit pixel format, 4 bits al=
pha, 4 bits luminace.
 	OgrePixelFormatList_REGISTER(PF_BYTE_LA)		// 	2 byte pixel format, 1 byte=
 luminance, 1 byte alpha
 	OgrePixelFormatList_REGISTER(PF_R5G6B5)			// 	16-bit pixel format, 5 bits=
 red, 6 bits green, 5 bits blue.
@@ -1189,35 +1191,35 @@
 	OgrePixelFormatList_REGISTER(PF_DXT3)			// 	DDS (DirectDraw Surface) DXT3=
 format.
 	OgrePixelFormatList_REGISTER(PF_DXT4)			// 	DDS (DirectDraw Surface) DXT4=
 format.
 	OgrePixelFormatList_REGISTER(PF_DXT5)			// 	DDS (DirectDraw Surface) DXT5=
 format.
-	OgrePixelFormatList_REGISTER(PF_FLOAT16_R)		// 	=

-	OgrePixelFormatList_REGISTER(PF_FLOAT16_RGB)	// 	=

-	OgrePixelFormatList_REGISTER(PF_FLOAT16_RGBA)	// 	=

-	OgrePixelFormatList_REGISTER(PF_FLOAT32_R)		// 	=

-	OgrePixelFormatList_REGISTER(PF_FLOAT32_RGB)	// 	=

-	OgrePixelFormatList_REGISTER(PF_FLOAT32_RGBA)	// 	=

-	OgrePixelFormatList_REGISTER(PF_FLOAT16_GR)		// 	=

-	OgrePixelFormatList_REGISTER(PF_FLOAT32_GR)		// 	=

-	OgrePixelFormatList_REGISTER(PF_DEPTH)			// 	=

-	OgrePixelFormatList_REGISTER(PF_SHORT_RGBA)		// 	=

-	OgrePixelFormatList_REGISTER(PF_SHORT_GR)		// 	=

-	OgrePixelFormatList_REGISTER(PF_SHORT_RGB)		// 	=

-	OgrePixelFormatList_REGISTER(PF_COUNT)			// =

+	OgrePixelFormatList_REGISTER(PF_FLOAT16_R)		//
+	OgrePixelFormatList_REGISTER(PF_FLOAT16_RGB)	//
+	OgrePixelFormatList_REGISTER(PF_FLOAT16_RGBA)	//
+	OgrePixelFormatList_REGISTER(PF_FLOAT32_R)		//
+	OgrePixelFormatList_REGISTER(PF_FLOAT32_RGB)	//
+	OgrePixelFormatList_REGISTER(PF_FLOAT32_RGBA)	//
+	OgrePixelFormatList_REGISTER(PF_FLOAT16_GR)		//
+	OgrePixelFormatList_REGISTER(PF_FLOAT32_GR)		//
+	OgrePixelFormatList_REGISTER(PF_DEPTH)			//
+	OgrePixelFormatList_REGISTER(PF_SHORT_RGBA)		//
+	OgrePixelFormatList_REGISTER(PF_SHORT_GR)		//
+	OgrePixelFormatList_REGISTER(PF_SHORT_RGB)		//
+	OgrePixelFormatList_REGISTER(PF_COUNT)			//
 	return 1;
 }
 =

 =

 /// for lua :   void	  OgreSetShadowTextureSelfShadow  (bool)
-static int 				l_OgreSetShadowTextureSelfShadow	(lua_State *L) { PROFILE  =

+static int 				l_OgreSetShadowTextureSelfShadow	(lua_State *L) { PROFILE
 	cOgreWrapper::GetSingleton().mSceneMgr-&gt;setShadowTextureSelfShadow(lua_to=
boolean(L,1));
 	return 0;
 }
 =

 /// for lua :   void 	  OgreSetShadowTextureCasterMaterial  (sMatName)
-static int 				l_OgreSetShadowTextureCasterMaterial			(lua_State *L) { PRO=
FILE =

+static int 				l_OgreSetShadowTextureCasterMaterial			(lua_State *L) { PRO=
FILE
 	cOgreWrapper::GetSingleton().mSceneMgr-&gt;setShadowTextureCasterMaterial(lu=
aL_checkstring(L,1));
 	return 0;
 }
-	=

+
 /// for lua :   void	  OgreSetShadowTextureReceiverMaterial  (sMatName)
 static int 				l_OgreSetShadowTextureReceiverMaterial	(lua_State *L) { PRO=
FILE  // TODO : move to seperate file ?
 	cOgreWrapper::GetSingleton().mSceneMgr-&gt;setShadowTextureReceiverMaterial(=
luaL_checkstring(L,1));
@@ -1230,11 +1232,11 @@
 	float g =3D luaL_checknumber(L,2);
 	float b =3D luaL_checknumber(L,3);
 	Ogre::SceneManager *p =3D cOgreWrapper::GetSingleton().mSceneMgr;
-	=

+
 	if(p){
 		p-&gt;setAmbientLight( ColourValue( r, g, b ) );
 	}
-	=

+
 	return 0;
 }
 =

@@ -1330,20 +1332,20 @@
 /// don't use directly, used by LuaCall
 int 	PCallWithErrFuncWrapper (lua_State *L,int narg, int nret) { PROFILE
 	int status;
-	int base =3D lua_gettop(L) - narg;  // function index =

+	int base =3D lua_gettop(L) - narg;  // function index
 	lua_pushliteral(L, &quot;_TRACEBACK&quot;);
-	lua_rawget(L, LUA_GLOBALSINDEX); // get traceback function =

-	lua_insert(L, base);  // put it under chunk and args =

+	lua_rawget(L, LUA_GLOBALSINDEX); // get traceback function
+	lua_insert(L, base);  // put it under chunk and args
 	// signal(SIGINT, laction); // copyed from example, no idea what this is =
good for =3D(
 	status =3D lua_pcall(L, narg, (nret=3D=3D-1) ? LUA_MULTRET : nret, base);
-	=

+
 	//printf(&quot;pcall end, cleaning up....\n&quot;);
-	=

+
 	// signal(SIGINT, SIG_DFL); // copyed from example, no idea what this is =
good for =3D(
-	lua_remove(L, base);  // remove traceback function // TODO : this might c=
rash if error handler closed the lua state =

-	=

+	lua_remove(L, base);  // remove traceback function // TODO : this might c=
rash if error handler closed the lua state
+
 	//printf(&quot;pcall end\n&quot;);
-	=

+
 	return status;
 }
 =

@@ -1352,19 +1354,19 @@
 =

 void LuaErrorHandler (lua_State *L, const char *fmt, ...) { PROFILE
 	printf(&quot;LuaErrorHandler start\n&quot;);
-	=

+
 	va_list argp;
 	va_start(argp, fmt);
 	gRobStringBuffer[0] =3D 0;
 	vsnprintf(gRobStringBuffer,kRobStringBufferSize-1,fmt, argp);
 	std::string s(gRobStringBuffer);
 	va_end(argp);
-	=

+
 	std::string mystr(&quot;LuaError\n&quot;);
 	mystr +=3D s;
-	=

+
 	printf(&quot;\nLuaErrorHandler end\n&quot;);
-	=

+
 	//lua_close(L);
 	MyCrash(mystr.c_str());
 	// todo : attempt recovery in case of protected function call ?
@@ -1464,7 +1466,7 @@
 	//if (lua_pcall(L, narg, nres, 0) !=3D 0)  { // old
 		/* do the call */
 		LuaErrorHandler(L, &quot;error running function `%s': %s&quot;,func, lua_tostring(=
L, -1));
-		=

+
 		/*
 		doku for lua_pcall last argument (errorfunc)
 		if 0 ... else that argument should be the index in the stack where the e=
rror handler function is located. Notice that, in such cases, the handler m=
ust be pushed in the stack before the function to be called and its argumen=
ts.
@@ -1510,7 +1512,7 @@
 			}
 			nres++;
 		}
-		// pop stack    =

+		// pop stack
 		lua_pop(L, popamount);
 	}
 	va_end(vl);
@@ -1526,7 +1528,7 @@
 		DisplayErrorMessage(&quot;ERROR : lua-precision wrong&quot;);
 		exit(43);
 	}
-	=

+
 	L =3D lua_open();
 	assert(L);
 	luaopen_base(L);
@@ -1535,7 +1537,7 @@
 	luaopen_string(L);
 	luaopen_math(L);
 	luaopen_debug(L);
-	=

+
 	lua_register(L,&quot;GetNamedKey&quot;,		l_GetNamedKey);
 	lua_register(L,&quot;GetKeyName&quot;,		l_GetKeyName);
 	lua_register(L,&quot;PollInput&quot;,			l_PollInput);
@@ -1629,7 +1631,7 @@
 	lua_register(L,&quot;OgreRemoveCompositor&quot;,						l_OgreRemoveCompositor);
 	lua_register(L,&quot;CreateLookupTableFromFile&quot;,			l_CreateLookupTableFromFile=
);
 	lua_register(L,&quot;Uo16Color2Rgb&quot;,			l_Uo16Color2Rgb);
-	// shadow stuff	=

+	// shadow stuff
 	lua_register(L,&quot;OgreSetShadowTextureFadeStart&quot;,						l_OgreSetShadowTextu=
reFadeStart);
 	lua_register(L,&quot;OgreSetShadowTextureFadeEnd&quot;,						l_OgreSetShadowTexture=
FadeEnd);
 	lua_register(L,&quot;OgreSetShadowDirLightTextureOffset&quot;,				l_OgreSetShadowDi=
rLightTextureOffset);
@@ -1655,13 +1657,13 @@
 		exit(34);
 	}
 	myFileStream.close();
-	=

+
 	// load utils
 	int res;
 	res	=3D lua_dofile(L,szLuaUDataPath); // loads function used for register=
ing udatatypes
-	if (res) { =

-		MyCrash(&quot;error in udata script-initialisation\n&quot;); =

-		exit(44); =

+	if (res) {
+		MyCrash(&quot;error in udata script-initialisation\n&quot;);
+		exit(44);
 	}
 =

 	RegisterLuaXML(L);
@@ -1689,8 +1691,8 @@
 =

 	res =3D lua_dofile(L,szLuaMainPath);
 	if (res) {
-		MyCrash(&quot;error in main script-initialisation\n&quot;); =

-		exit(-1); =

+		MyCrash(&quot;error in main script-initialisation\n&quot;);
+		exit(-1);
 	}
 }
 =



</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000073.html">[Iris-commit] [IRIS] r1257 - in /branches/knut: data/lua/gui/gui.gumpmanager.lua data/lua/main.lua src/spritemanager.cpp
</A></li>
	<LI>Next message: <A HREF="000075.html">[Iris-commit] [IRIS] r1259 - in /trunk/data: lua/filter.granny.lua models/materials/armoire.material models/models/to_004000/OgreXMLConverter.log terrain/materials/terrain.material terrain/programs/terrain.program
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#74">[ date ]</a>
              <a href="thread.html#74">[ thread ]</a>
              <a href="subject.html#74">[ subject ]</a>
              <a href="author.html#74">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
