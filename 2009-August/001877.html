<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Iris-commit] [IRIS] r3114 - in /trunk/lua: config_macros_declarations.lua lib.3d.mousepick.lua lib.fallback.lua lib.macrolist.lua
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/iris-commit/2009-August/index.html" >
   <LINK REL="made" HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r3114%20-%20in%20/trunk/lua%3A%0A%20config_macros_declarations.lua%20lib.3d.mousepick.lua%20lib.fallback.lua%0A%20lib.macrolist.lua&In-Reply-To=%3C20090824195717.C46947A9810A%40simon%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001876.html">
   <LINK REL="Next"  HREF="001878.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Iris-commit] [IRIS] r3114 - in /trunk/lua: config_macros_declarations.lua lib.3d.mousepick.lua lib.fallback.lua lib.macrolist.lua</H1>
    <B>no-reply at zwischenwelt.org</B> 
    <A HREF="mailto:iris-commit%40lists.berlios.de?Subject=Re%3A%20%5BIris-commit%5D%20%5BIRIS%5D%20r3114%20-%20in%20/trunk/lua%3A%0A%20config_macros_declarations.lua%20lib.3d.mousepick.lua%20lib.fallback.lua%0A%20lib.macrolist.lua&In-Reply-To=%3C20090824195717.C46947A9810A%40simon%3E"
       TITLE="[Iris-commit] [IRIS] r3114 - in /trunk/lua: config_macros_declarations.lua lib.3d.mousepick.lua lib.fallback.lua lib.macrolist.lua">no-reply at zwischenwelt.org
       </A><BR>
    <I>Mon Aug 24 21:57:17 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001876.html">[Iris-commit] [IRIS] r3113 - /trunk/makeclean.sh
</A></li>
        <LI>Next message: <A HREF="001878.html">[Iris-commit] [IRIS] r3115 -	/trunk/lua/config_macros_declarations.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1877">[ date ]</a>
              <a href="thread.html#1877">[ thread ]</a>
              <a href="subject.html#1877">[ subject ]</a>
              <a href="author.html#1877">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: sience
Date: Mon Aug 24 21:57:17 2009
New Revision: 3114

Log:
-some old mouspick code removed
-fallbacktool disabled because it uses old mapcode which doesn't work

Modified:
    trunk/lua/config_macros_declarations.lua
    trunk/lua/lib.3d.mousepick.lua
    trunk/lua/lib.fallback.lua
    trunk/lua/lib.macrolist.lua

Modified: trunk/lua/config_macros_declarations.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/config_macros_declarations.lua (original)
+++ trunk/lua/config_macros_declarations.lua Mon Aug 24 21:57:17 2009
@@ -33,8 +33,12 @@
 SetMacro(&quot;k&quot;,		function() MacroCmd_Open(&quot;Skill&quot;) end)	-- Open Skills
 SetMacro(&quot;c&quot;,		function() MacroCmd_NextCamMode() end)	-- change cam mode
 =

--- SetMacro(&quot;ctrl+h&quot;,	function() MacroCmd_Spell(&quot;Heal&quot;) end)
--- SetMacro(&quot;ctrl+a&quot;,	function() MacroCmd_Skill(&quot;Anatomy&quot;) end)
+--[[ old uo pre-set default :  (not yet implemented in iris)
+--~  SetMacro(&quot;ctrl+h&quot;,	function() MacroCmd_Spell(&quot;Heal&quot;) end)
+--~  SetMacro(&quot;ctrl+a&quot;,	function() MacroCmd_Skill(&quot;Anatomy&quot;) end)
+--~ SetMacro(&quot;alt+b&quot;,function() MacroCmd_Open(&quot;Spellbook&quot;) end) -- Open Sp=
ellbook -- not yet implemented
+--~ SetMacro(&quot;alt+r&quot;,function() MacroCmd_Open(&quot;&quot;) end)  -- Open Overhead V=
iew -- not yet implemented
+--~ SetMacro(&quot;alt+o&quot;,function() MacroCmd_Open(&quot;&quot;) end)  -- Open Options wi=
ndow -- not yet implemented
 =

 SetMacro(&quot;l&quot;,			function() MacroCmd_Open(&quot;Logo&quot;) end)
 SetMacro(&quot;n&quot;,			function() MacroCmd_Open(&quot;Compass&quot;) end)
@@ -42,7 +46,6 @@
 SetMacro(&quot;komma&quot;,		function() MacroCmd_ZoomCompass(1*1.5) end)
 SetMacro(&quot;point&quot;,		function() MacroCmd_ZoomCompass(1/1.5) end)
 SetMacro(&quot;f10&quot;,			function() MacroCmd_ShowDevTool() end)
-SetMacro(&quot;f11&quot;,			function() MacroCmd_ShowFallBackTool() end)
 SetMacro(&quot;shift+f12&quot;,	function() MacroCmd_GridScreenshot() end)
 SetMacro(&quot;f12&quot;,			function() FadeLineToggleShowAll() end)
 SetMacro(&quot;v&quot;,			function() MacroCmd_Screenshot() end)
@@ -56,7 +59,6 @@
 SetMacro(&quot;h&quot;,			function() MacroCmd_RepeatLastDoubleClick() end)
 SetMacro(&quot;q&quot;,			function() MacroCmd_SelectNearestMobile() end)
 SetMacro(&quot;e&quot;,			function() MacroCmd_SelectNextMobile() end)
---SetMacro(&quot;space&quot;,		function() MacroCmd_AttackSelectedMobile() end) -- cu=
rrently broken
 SetMacro(&quot;ctrl+r&quot;,			function() MacroCmd_ActivateNextRenderer() end)
 =

 SetMacro(&quot;ctrl+f1&quot;,		function() MacroCmd_ItemSlot_Set(1) end)
@@ -79,6 +81,12 @@
 SetMacro(&quot;home&quot;,		function() MacroCmd_Say(&quot;[tele&quot;) end)
 SetMacro(&quot;end&quot;,			function() MacroCmd_Say(&quot;[get z&quot;) end)
 =

+SetMacro(&quot;shift+f11&quot;,	function() ImportRazorProfileDialog() end)
+ImportRazorProfile(&quot;C:\\Program Files\\Razor\\Profiles\\default.xml&quot;) -- i=
mport default config
+
+--~ SetMacro(&quot;space&quot;,		function() MacroCmd_AttackSelectedMobile() end) -- =
currently broken
+--~ SetMacro(&quot;f11&quot;,			function() MacroCmd_ShowFallBackTool() end) -- curre=
ntly broken
+
 --[[
 SetMacro(&quot;F1&quot;,	function() MacroCmd_Item_UseByArtID(3852) end)	-- greater h=
ealth
 SetMacro(&quot;F2&quot;,	function() MacroCmd_Item_UseByArtID(3847) end)	-- greater c=
ure
@@ -98,6 +106,3 @@
 SetMacro(&quot;alt+Z&quot;,	function() MacroCmd_Spell(&quot;Invisibility&quot;) end)
 SetMacro(&quot;alt+X&quot;,	function() MacroCmd_Spell(&quot;Meteor Swarm&quot;) end)
 ]]--
-
-SetMacro(&quot;shift+f11&quot;,	function() ImportRazorProfileDialog() end)
-ImportRazorProfile(&quot;C:\\Program Files\\Razor\\Profiles\\default.xml&quot;) -- i=
mport default config

Modified: trunk/lua/lib.3d.mousepick.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.3d.mousepick.lua (original)
+++ trunk/lua/lib.3d.mousepick.lua Mon Aug 24 21:57:17 2009
@@ -199,69 +199,6 @@
         gCustomQuadInfoWritten =3D true
         print(&quot;mousepick info numgfx=3D&quot;,numgfx,&quot;numcustomquads=3D&quot;,numcus=
tomquads,&quot; (each has its own scenenode)&quot;)
     end
-	--[[
-	for chunky,row in pairs(self.gMapChunks) do
-		for chunkx,chunk in pairs(row) do
-			if (not chunk.bIsDead) then
-				-- terrain
-				if (gGroundBlockLoader and self.gbBlendOutTerrainVisible) then
-					local iBlockUO_X =3D chunk.miX * self.ROBMAP_CHUNK_SIZE
-					local iBlockUO_Y =3D chunk.miY * self.ROBMAP_CHUNK_SIZE
-													=

-					if (chunk.pStaticGeometryTerrain) then -- old terrain : static-geom
-						local x,y =3D self:UOPosToLocal(iBlockUO_X*8,iBlockUO_Y*8)
-						bHit,fHitDist =3D chunk.pTerrainEntity:RayPick(rx,ry,rz,rvx,rvy,rvz,=
x,y,0)
-					elseif (chunk.terrain_multitex_gfx) then -- new terrain multitex
-						local gfx =3D chunk.terrain_multitex_gfx
-						local d =3D kMultiTexTerrainChunkSize
-						local bx,by =3D gfx.bx,gfx.by
-						local tx,ty
-
-						bHit,fHitDist,tx,ty =3D TerrainMultiTex_RayPick(gGroundBlockLoader,g=
fx.bx,gfx.by,d,d,0.1, rx-gfx.x,ry-gfx.y,rz-gfx.z, rvx,rvy,rvz)
-						if (bHit) then
-							if (tx &gt;=3D 8) then bx =3D bx + 1   tx =3D tx - 8 end
-							if (ty &gt;=3D 8) then by =3D by + 1   ty =3D ty - 8 end
-						end
-					else
-						if (chunk.terraingfx) then -- old terrain : meshentities
-							bHit,fHitDist =3D chunk.terraingfx:RayPick(rx,ry,rz,rvx,rvy,rvz)
-						else
-							bHit =3D false
-						end
-					end
-					=

-					if (bHit and ((not gMousePickFoundHit) or fHitDist &lt; self.gMousePickF=
oundDist)) then
-						self.gMousePickFoundDist =3D fHitDist
-						gMousePickFoundHit =3D {}
-						gMousePickFoundHit.hittype =3D kMousePickHitType_Terrain
-						gMousePickFoundHit.chunk =3D chunk
-						=

-						local x,y =3D Renderer3D:LocalToUOPos(rx + fHitDist * rvx, ry + fHit=
Dist * rvy)
-						x,y =3D math.floor(x),math.floor(y)
-						local iTileType,iZLoc =3D GetAbsTile(x,y) =

-						local bx =3D math.floor((x - iBlockUO_X)/8)
-						local by =3D math.floor((y - iBlockUO_Y)/8)
-						local origin_abs_x =3D self.giMapOriginX * self.ROBMAP_CHUNK_SIZE
-						local origin_abs_y =3D self.giMapOriginY * self.ROBMAP_CHUNK_SIZE
-						local originoffx =3D 8.0*(iBlockUO_X-origin_abs_x)
-						local originoffy =3D 8.0*(iBlockUO_Y-origin_abs_y)
-						=

-						gMousePickFoundHit.tiletype =3D iTileType
-						gMousePickFoundHit.minz =3D iZLoc*0.1 =

-						gMousePickFoundHit.maxz =3D iZLoc*0.1
-						gMousePickFoundHit.x =3D x
-						gMousePickFoundHit.y =3D y
-						gMousePickFoundHit.tx =3D math.mod(x,8)
-						gMousePickFoundHit.ty =3D math.mod(y,8)
-						gMousePickFoundHit.iBlockX =3D iBlockUO_X+bx
-						gMousePickFoundHit.iBlockY =3D iBlockUO_Y+by
-						gMousePickFoundHit.blockorigin_x =3D originoffx+bx*8
-						gMousePickFoundHit.blockorigin_y =3D originoffy+by*8
-					end
-				end
-			end
-	end end
-	]]--
     =

     -- dynamics
     for k,dynamic in pairs(GetDynamicList()) do

Modified: trunk/lua/lib.fallback.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.fallback.lua (original)
+++ trunk/lua/lib.fallback.lua Mon Aug 24 21:57:17 2009
@@ -37,6 +37,8 @@
     gCurrentRenderer:ClearMapCache()
 end
 =

+-- currently broken (uses old mapcode)
+--[[
 function ShowFallBackTool (x,y,z,radius)
     if (gCurrentRenderer ~=3D Renderer3D) then return end
     if (not x) then =

@@ -110,6 +112,7 @@
     end
     return res
 end
+]]--
 =

 function GetFallBackBoxMesh ()
     if not gFallBackBoxMesh then

Modified: trunk/lua/lib.macrolist.lua
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D
--- trunk/lua/lib.macrolist.lua (original)
+++ trunk/lua/lib.macrolist.lua Mon Aug 24 21:57:17 2009
@@ -3,11 +3,6 @@
         handles macro list
 ]]--
 =

---[[ old uo pre-set default :  (not yet implemented in iris)
---~ SetMacro(&quot;alt+b&quot;,function() MacroCmd_Open(&quot;Spellbook&quot;) end) -- Open Sp=
ellbook -- not yet implemented
---~ SetMacro(&quot;alt+r&quot;,function() MacroCmd_Open(&quot;&quot;) end)  -- Open Overhead V=
iew -- not yet implemented
---~ SetMacro(&quot;alt+o&quot;,function() MacroCmd_Open(&quot;&quot;) end)  -- Open Options wi=
ndow -- not yet implemented
-]]--
 gMacroList =3D {}
 =

 gMacroOpenCommands =3D {}
@@ -467,7 +462,8 @@
         end)
 end
 =

-function MacroCmd_ShowFallBackTool      ()              if (gInGameStarted=
) then ShowFallBackTool() end end
+-- currently broken
+--~ function MacroCmd_ShowFallBackTool      ()              if (gInGameSta=
rted) then ShowFallBackTool() end end
 function MacroCmd_ShowDevTool           ()              if (gInGameStarted=
) then ShowDevTool() end end =

 function MacroCmd_ZoomCompass           (zoomfactor)    if (gInGameStarted=
) then ZoomCompass(zoomfactor) end end
 function MacroCmd_ActivateNextRenderer  ()              if (gInGameStarted=
) then ActivateNextRenderer() end end


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001876.html">[Iris-commit] [IRIS] r3113 - /trunk/makeclean.sh
</A></li>
	<LI>Next message: <A HREF="001878.html">[Iris-commit] [IRIS] r3115 -	/trunk/lua/config_macros_declarations.lua
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1877">[ date ]</a>
              <a href="thread.html#1877">[ thread ]</a>
              <a href="subject.html#1877">[ subject ]</a>
              <a href="author.html#1877">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/iris-commit">More information about the Iris-commit
mailing list</a><br>
</body></html>
